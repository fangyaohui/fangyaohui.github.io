<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>79-04 æ™ºå·äº‘åç«¯æ¶æ„è®¾è®¡æ–¹æ¡ˆ</title>
      <link href="/2025/03/29/79-04%20%E6%99%BA%E5%8D%B7%E4%BA%91%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/"/>
      <url>/2025/03/29/79-04%20%E6%99%BA%E5%8D%B7%E4%BA%91%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h1 id="79-04-æ™ºå·äº‘åç«¯æ¶æ„è®¾è®¡æ–¹æ¡ˆ"><a href="#79-04-æ™ºå·äº‘åç«¯æ¶æ„è®¾è®¡æ–¹æ¡ˆ" class="headerlink" title="79-04 æ™ºå·äº‘åç«¯æ¶æ„è®¾è®¡æ–¹æ¡ˆ"></a>79-04 æ™ºå·äº‘åç«¯æ¶æ„è®¾è®¡æ–¹æ¡ˆ</h1><h2 id="æœåŠ¡å‘ç°-æœåŠ¡æ³¨å†Œ-Nacos"><a href="#æœåŠ¡å‘ç°-æœåŠ¡æ³¨å†Œ-Nacos" class="headerlink" title="æœåŠ¡å‘ç°&amp;æœåŠ¡æ³¨å†Œ Nacos"></a>æœåŠ¡å‘ç°&amp;æœåŠ¡æ³¨å†Œ Nacos</h2><p>åœ¨é¡¹ç›®ä¸­æˆ‘ä»¬é‡‡ç”¨æœ¬åœ°æºç è¿è¡ŒNacosçš„å½¢å¼è¿›è¡Œéƒ¨ç½²æœåŠ¡å‘ç°å’ŒæœåŠ¡æ³¨å†Œã€‚</p><h2 id="AIè®¿é—®å·¥å…·ç±»"><a href="#AIè®¿é—®å·¥å…·ç±»" class="headerlink" title="AIè®¿é—®å·¥å…·ç±»"></a>AIè®¿é—®å·¥å…·ç±»</h2><h3 id="æ¶æ„è®¾è®¡æ€æƒ³"><a href="#æ¶æ„è®¾è®¡æ€æƒ³" class="headerlink" title="æ¶æ„è®¾è®¡æ€æƒ³"></a>æ¶æ„è®¾è®¡æ€æƒ³</h3><ol><li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼šæ”¯æŒä¸åŒAIæœåŠ¡çš„çµæ´»åˆ‡æ¢</li><li><strong>å·¥å‚æ¨¡å¼</strong>ï¼šç»Ÿä¸€å®¢æˆ·ç«¯åˆ›å»ºå…¥å£</li><li><strong>çº¿ç¨‹æ± ç®¡ç†</strong>ï¼šå†…ç½®å¯é…ç½®çš„å¼‚æ­¥æ‰§è¡Œå™¨</li><li><strong>åŠ¨æ€é…ç½®</strong>ï¼šæ”¯æŒè¿è¡Œæ—¶APIå‚æ•°å˜æ›´</li><li><strong>æ³›å‹æ”¯æŒ</strong>ï¼šé€‚åº”ä¸åŒAIæœåŠ¡çš„è¯·æ±‚&#x2F;å“åº”ç»“æ„</li></ol><blockquote><p>å¥½çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ä½ çš„ AI è®¿é—®å·¥å…·ç±»ï¼Œä½¿å…¶ç¬¦åˆä»¥ä¸‹è®¾è®¡æ€æƒ³ï¼š</p><ol><li><strong>å•ä¾‹æ¨¡å¼</strong>ï¼ˆSingleton Patternï¼‰<ul><li>ä¿è¯ <code>AIClientFactory</code> å’Œ <code>AIRequestExecutor</code> åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚</li></ul></li><li><strong>å·¥å‚æ¨¡å¼</strong>ï¼ˆFactory Patternï¼‰<ul><li>ç»Ÿä¸€ç®¡ç† AIClient çš„åˆ›å»ºï¼Œæ”¯æŒåŠ¨æ€åˆ‡æ¢ã€‚</li></ul></li><li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼ˆStrategy Patternï¼‰<ul><li>ä¸åŒ AI å¹³å°çš„è®¿é—®é€»è¾‘ç‹¬ç«‹å°è£…ï¼Œæ–¹ä¾¿æ‰©å±•ã€‚</li></ul></li><li><strong>çº¿ç¨‹æ± ç®¡ç†</strong>ï¼ˆThread Poolï¼‰<ul><li>ä½¿ç”¨ <code>ExecutorService</code> è¿›è¡Œå¹¶å‘æ§åˆ¶ï¼Œæé«˜è®¿é—®æ€§èƒ½ã€‚</li></ul></li></ol><hr><h2 id="ä¼˜åŒ–åçš„ä»£ç "><a href="#ä¼˜åŒ–åçš„ä»£ç " class="headerlink" title="ä¼˜åŒ–åçš„ä»£ç "></a><strong>ä¼˜åŒ–åçš„ä»£ç </strong></h2><h3 id="1-AI-è®¿é—®æ¥å£"><a href="#1-AI-è®¿é—®æ¥å£" class="headerlink" title="1. AI è®¿é—®æ¥å£"></a><strong>1. AI è®¿é—®æ¥å£</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AIClient</span> &#123;</span><br><span class="line">    String <span class="title function_">requestAI</span><span class="params">(String prompt)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-å…·ä½“-AI-å¹³å°å®ç°"><a href="#2-å…·ä½“-AI-å¹³å°å®ç°" class="headerlink" title="2. å…·ä½“ AI å¹³å°å®ç°"></a><strong>2. å…·ä½“ AI å¹³å°å®ç°</strong></h3><h4 id="DeepSeek-å®ç°"><a href="#DeepSeek-å®ç°" class="headerlink" title="DeepSeek å®ç°"></a><strong>DeepSeek å®ç°</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeepSeekClient</span> <span class="keyword">implements</span> <span class="title class_">AIClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String apiKey;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String apiUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DeepSeekClient</span><span class="params">(String apiUrl, String apiKey)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.apiUrl = apiUrl;</span><br><span class="line">        <span class="built_in">this</span>.apiKey = apiKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">DeepSeekClient</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeepSeekClient</span>(<span class="string">&quot;https://api.deepseek.com&quot;</span>, <span class="string">&quot;deepseek-key&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DeepSeekClient <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Holder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">requestAI</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¼ªä»£ç ï¼Œå®é™…éœ€è¦ç”¨ HTTP å®¢æˆ·ç«¯å‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;DeepSeek response for: &quot;</span> + prompt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="ChatGPT-å®ç°"><a href="#ChatGPT-å®ç°" class="headerlink" title="ChatGPT å®ç°"></a><strong>ChatGPT å®ç°</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatGPTClient</span> <span class="keyword">implements</span> <span class="title class_">AIClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String apiKey;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String apiUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ChatGPTClient</span><span class="params">(String apiUrl, String apiKey)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.apiUrl = apiUrl;</span><br><span class="line">        <span class="built_in">this</span>.apiKey = apiKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ChatGPTClient</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatGPTClient</span>(<span class="string">&quot;https://api.openai.com&quot;</span>, <span class="string">&quot;chatgpt-key&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ChatGPTClient <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Holder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">requestAI</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¼ªä»£ç ï¼Œå®é™…éœ€è¦ç”¨ HTTP å®¢æˆ·ç«¯å‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ChatGPT response for: &quot;</span> + prompt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="3-AI-å®¢æˆ·ç«¯å·¥å‚ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰"><a href="#3-AI-å®¢æˆ·ç«¯å·¥å‚ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰" class="headerlink" title="3. AI å®¢æˆ·ç«¯å·¥å‚ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰"></a><strong>3. AI å®¢æˆ·ç«¯å·¥å‚ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIClientFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AIClientFactory</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AIClientFactory</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, AIClient&gt; clients = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">AIClientFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é¢„æ³¨å†Œ AI å®¢æˆ·ç«¯</span></span><br><span class="line">        registerClient(<span class="string">&quot;deepseek&quot;</span>, DeepSeekClient.getInstance());</span><br><span class="line">        registerClient(<span class="string">&quot;chatgpt&quot;</span>, ChatGPTClient.getInstance());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AIClientFactory <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerClient</span><span class="params">(String type, AIClient client)</span> &#123;</span><br><span class="line">        clients.put(type, client);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AIClient <span class="title function_">getClient</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clients.get(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="4-å¤šçº¿ç¨‹ç®¡ç†ï¼ˆçº¿ç¨‹æ± ï¼Œå•ä¾‹æ¨¡å¼ï¼‰"><a href="#4-å¤šçº¿ç¨‹ç®¡ç†ï¼ˆçº¿ç¨‹æ± ï¼Œå•ä¾‹æ¨¡å¼ï¼‰" class="headerlink" title="4. å¤šçº¿ç¨‹ç®¡ç†ï¼ˆçº¿ç¨‹æ± ï¼Œå•ä¾‹æ¨¡å¼ï¼‰"></a><strong>4. å¤šçº¿ç¨‹ç®¡ç†ï¼ˆçº¿ç¨‹æ± ï¼Œå•ä¾‹æ¨¡å¼ï¼‰</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIRequestExecutor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AIRequestExecutor</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AIRequestExecutor</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">AIRequestExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AIRequestExecutor <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Future&lt;String&gt; <span class="title function_">submitRequest</span><span class="params">(AIClient client, String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> executorService.submit(() -&gt; client.requestAI(prompt));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="5-ä½¿ç”¨ç¤ºä¾‹"><a href="#5-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="5. ä½¿ç”¨ç¤ºä¾‹"></a><strong>5. ä½¿ç”¨ç¤ºä¾‹</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">AIClientFactory</span> <span class="variable">clientFactory</span> <span class="operator">=</span> AIClientFactory.getInstance();</span><br><span class="line">        <span class="type">AIRequestExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> AIRequestExecutor.getInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å– AI å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">AIClient</span> <span class="variable">aiClient</span> <span class="operator">=</span> clientFactory.getClient(<span class="string">&quot;chatgpt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤šçº¿ç¨‹æäº¤è¯·æ±‚</span></span><br><span class="line">        Future&lt;String&gt; responseFuture = executor.submitRequest(aiClient, <span class="string">&quot;Hello AI!&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;AI Response: &quot;</span> + responseFuture.get());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ä¼˜åŒ–ç‚¹æ€»ç»“"><a href="#ä¼˜åŒ–ç‚¹æ€»ç»“" class="headerlink" title="ä¼˜åŒ–ç‚¹æ€»ç»“"></a><strong>ä¼˜åŒ–ç‚¹æ€»ç»“</strong></h2><ol><li><strong>å•ä¾‹æ¨¡å¼</strong>ï¼ˆ<code>Holder</code> é™æ€å†…éƒ¨ç±» + é¥¿æ±‰å•ä¾‹ï¼‰ï¼š<ul><li><code>DeepSeekClient</code> å’Œ <code>ChatGPTClient</code> é‡‡ç”¨é™æ€å†…éƒ¨ç±»ä¿è¯çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ã€‚</li><li><code>AIClientFactory</code> å’Œ <code>AIRequestExecutor</code> é‡‡ç”¨é¥¿æ±‰å•ä¾‹ï¼Œç¡®ä¿å”¯ä¸€å®ä¾‹ã€‚</li></ul></li><li><strong>å·¥å‚æ¨¡å¼</strong>ï¼š<ul><li><code>AIClientFactory</code> ç»Ÿä¸€ç®¡ç† AIClientï¼Œæ”¯æŒåŠ¨æ€æ³¨å†Œå’Œæ‰©å±•ã€‚</li></ul></li><li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼š<ul><li>ä¸åŒ AI å¹³å°æœ‰ç‹¬ç«‹å®ç°ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆOCPï¼‰ã€‚</li></ul></li><li><strong>çº¿ç¨‹æ± ä¼˜åŒ–</strong>ï¼š<ul><li>é‡‡ç”¨ <code>FixedThreadPool</code> æé«˜ AI è®¿é—®çš„å¹¶å‘èƒ½åŠ›ï¼Œé¿å…é¢‘ç¹åˆ›å»ºçº¿ç¨‹çš„å¼€é”€ã€‚</li></ul></li></ol><p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„ AI è®¿é—®å·¥å…·ç±» <strong>æ—¢é«˜æ•ˆï¼Œåˆçµæ´»å¯æ‰©å±•</strong>ï¼Œèƒ½å¤Ÿé€‚åº”æœªæ¥çš„ AI å¹³å°æ‰©å±•éœ€æ±‚ ğŸš€ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> otherï¼Œé¡¹ç›® </tag>
            
            <tag> æ™ºå·äº‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-47 Nacosæºç æœ¬åœ°éƒ¨ç½²</title>
      <link href="/2025/03/29/75-47%20Nacos%E6%9C%AC%E5%9C%B0%E6%BA%90%E7%A0%81%E9%83%A8%E7%BD%B2/"/>
      <url>/2025/03/29/75-47%20Nacos%E6%9C%AC%E5%9C%B0%E6%BA%90%E7%A0%81%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="75-47-Nacosæºç æœ¬åœ°éƒ¨ç½²"><a href="#75-47-Nacosæºç æœ¬åœ°éƒ¨ç½²" class="headerlink" title="75-47 Nacosæºç æœ¬åœ°éƒ¨ç½²"></a>75-47 Nacosæºç æœ¬åœ°éƒ¨ç½²</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h2 id="æºç åœ°å€"><a href="#æºç åœ°å€" class="headerlink" title="æºç åœ°å€"></a>æºç åœ°å€</h2><ul><li><a href="https://github.com/alibaba/nacos/releases?page=4">https://github.com/alibaba/nacos/releases?page=4</a></li></ul><h2 id="Mavenå¤šæ¨¡å—å‘½åä½“ç³»ï¼ˆå•ä½“-å¾®æœåŠ¡æ··åˆæ¶æ„ï¼‰"><a href="#Mavenå¤šæ¨¡å—å‘½åä½“ç³»ï¼ˆå•ä½“-å¾®æœåŠ¡æ··åˆæ¶æ„ï¼‰" class="headerlink" title="Mavenå¤šæ¨¡å—å‘½åä½“ç³»ï¼ˆå•ä½“&#x2F;å¾®æœåŠ¡æ··åˆæ¶æ„ï¼‰"></a>Mavenå¤šæ¨¡å—å‘½åä½“ç³»ï¼ˆå•ä½“&#x2F;å¾®æœåŠ¡æ··åˆæ¶æ„ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">smart-converge-cloudï¼ˆçˆ¶POMï¼‰</span><br><span class="line">â”œâ”€â”€ converge-dependenciesï¼ˆBOMæ¨¡å—ï¼‰         <span class="comment"># ç»Ÿä¸€ä¾èµ–ç‰ˆæœ¬ç®¡ç†</span></span><br><span class="line">â”œâ”€â”€ converge-commonï¼ˆé€šç”¨åŸºç¡€æ¨¡å—ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ converge-common-core                <span class="comment"># æ ¸å¿ƒå·¥å…·ç±»</span></span><br><span class="line">â”‚   â”œâ”€â”€ converge-common-redis               <span class="comment"># Rediså®šåˆ¶åŒ–ç»„ä»¶</span></span><br><span class="line">â”‚   â””â”€â”€ converge-common-mybatis             <span class="comment"># MyBatiså¢å¼ºæ’ä»¶</span></span><br><span class="line">â”œâ”€â”€ converge-gatewayï¼ˆç½‘å…³å±‚ï¼‰               <span class="comment"># åŠ¨æ€è·¯ç”±/é™æµ</span></span><br><span class="line">â”œâ”€â”€ converge-authï¼ˆè®¤è¯ä¸­å¿ƒï¼‰               <span class="comment"># OAuth2.0/JWT</span></span><br><span class="line">â”œâ”€â”€ converge-monitorï¼ˆç›‘æ§æ¨¡å—ï¼‰             <span class="comment"># Spring Boot Admin</span></span><br><span class="line">â”œâ”€â”€ business-modulesï¼ˆä¸šåŠ¡æ¨¡å—ç¾¤ï¼‰           <span class="comment"># ä¸šåŠ¡èšåˆç›®å½•</span></span><br><span class="line">â”‚   â”œâ”€â”€ exam-serviceï¼ˆè€ƒè¯•æ ¸å¿ƒæœåŠ¡ï¼‰         <span class="comment"># è¯•å·ç”Ÿæˆ/æ‰¹æ”¹</span></span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ exam-apiï¼ˆAPIå¥‘çº¦ï¼‰             <span class="comment"># Feignæ¥å£/DTO</span></span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ exam-daoï¼ˆæŒä¹…å±‚ï¼‰              <span class="comment"># MyBatis Mapper</span></span><br><span class="line">â”‚   â”‚   â””â”€â”€ exam-bizï¼ˆä¸šåŠ¡å®ç°ï¼‰            <span class="comment"># Service/Controller</span></span><br><span class="line">â”‚   â”œâ”€â”€ question-bank-serviceï¼ˆé¢˜åº“æœåŠ¡ï¼‰    <span class="comment"># é¢˜ç›®CRUD/æ™ºèƒ½æ¨è</span></span><br><span class="line">â”‚   â””â”€â”€ report-analytics-serviceï¼ˆåˆ†ææœåŠ¡ï¼‰ <span class="comment"># å­¦æƒ…åˆ†æ</span></span><br><span class="line">â””â”€â”€ thirdparty-integrationï¼ˆä¸‰æ–¹æœåŠ¡é›†æˆï¼‰</span><br><span class="line">    â”œâ”€â”€ payment-integration-service        <span class="comment"># æ”¯ä»˜å®/å¾®ä¿¡æ”¯ä»˜</span></span><br><span class="line">    â””â”€â”€ ai-engine-service                  <span class="comment"># æ™ºèƒ½ç»„é¢˜å¼•æ“</span></span><br></pre></td></tr></table></figure><h2 id="åŒ…ç»“æ„å‘½åï¼ˆPackage-namingï¼‰"><a href="#åŒ…ç»“æ„å‘½åï¼ˆPackage-namingï¼‰" class="headerlink" title="åŒ…ç»“æ„å‘½åï¼ˆPackage namingï¼‰"></a>åŒ…ç»“æ„å‘½åï¼ˆPackage namingï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†å±‚æ¶æ„åŒ…å‘½å</span></span><br><span class="line">com.smartconverge.cloud</span><br><span class="line">    .examservice</span><br><span class="line">        .api       <span class="comment">// Feignå®¢æˆ·ç«¯æ¥å£</span></span><br><span class="line">        .config    <span class="comment">// ä¸“å±é…ç½®ç±»</span></span><br><span class="line">        .controller</span><br><span class="line">            .v1    <span class="comment">// APIç‰ˆæœ¬æ§åˆ¶</span></span><br><span class="line">            .v2</span><br><span class="line">        .service   </span><br><span class="line">            .impl  <span class="comment">// æœåŠ¡å®ç°</span></span><br><span class="line">        .repository</span><br><span class="line">            .mapper <span class="comment">// MyBatisæ¥å£</span></span><br><span class="line">            .entity <span class="comment">// æ•°æ®åº“å®ä½“</span></span><br><span class="line">            .dto    <span class="comment">// æ•°æ®ä¼ è¾“å¯¹è±¡</span></span><br><span class="line">        .job       <span class="comment">// å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">        .aspect    <span class="comment">// AOPåˆ‡é¢</span></span><br></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒæ¶æ„æ¨¡å—"><a href="#æ ¸å¿ƒæ¶æ„æ¨¡å—" class="headerlink" title="æ ¸å¿ƒæ¶æ„æ¨¡å—"></a><strong>æ ¸å¿ƒæ¶æ„æ¨¡å—</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[å®¢æˆ·ç«¯] --&gt; B[SmartConverge-Gateway]</span><br><span class="line">    B --&gt; C[Auth-Service]</span><br><span class="line">    B --&gt; D[Exam-Generation-Service]</span><br><span class="line">    D --&gt; E[RabbitMQ/Kafka]</span><br><span class="line">    E --&gt; F[AI-Orchestration-Service]</span><br><span class="line">    F --&gt; G[AI-Model-Service]</span><br><span class="line">    G --&gt; H[Question-Bank-Service]</span><br><span class="line">    H --&gt; I[MySQL/PgVector]</span><br><span class="line">    E --&gt; J[Exam-Assembly-Service]</span><br><span class="line">    J --&gt; K[Template-Engine-Service]</span><br><span class="line">    K --&gt; L[MinIO/S3]</span><br><span class="line">    M[Monitor-Service] --&gt;|é‡‡é›†æŒ‡æ ‡| N[Prometheus+Grafana]</span><br><span class="line">    O[Notification-Service] --&gt;|WebSocket| A</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nacos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nacos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2025/03/29/Untitled/"/>
      <url>/2025/03/29/Untitled/</url>
      
        <content type="html"><![CDATA[<h4 id="è§’è‰²è®¾å®š"><a href="#è§’è‰²è®¾å®š" class="headerlink" title="è§’è‰²è®¾å®š"></a><strong>è§’è‰²è®¾å®š</strong></h4><p>ä½ æ˜¯ä¸€åç»éªŒä¸°å¯Œçš„å°å­¦æ•°å­¦æ•™ç ”ä¸“å®¶ï¼Œç†Ÿæ‚‰äººæ•™ç‰ˆæ•™æçš„æ•™å­¦å¤§çº²ï¼Œæ“…é•¿è®¾è®¡ç¬¦åˆæ•™å­¦ç›®æ ‡ã€å±‚æ¬¡åˆ†æ˜ä¸”æ¶µç›–å¸¸è§æ˜“é”™ç‚¹çš„è¯•é¢˜ã€‚</p><h4 id="è¾“å…¥æ ¼å¼"><a href="#è¾“å…¥æ ¼å¼" class="headerlink" title="è¾“å…¥æ ¼å¼"></a><strong>è¾“å…¥æ ¼å¼</strong></h4><p>ä½ å°†æ¥æ”¶ä¸€ç»„è¯•é¢˜å¤§çº²ï¼ŒåŒ…å«é¢˜å‹ã€éš¾åº¦ã€çŸ¥è¯†ç‚¹åŠå¸¸è§é”™è¯¯ã€‚ä½ éœ€è¦æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œç”Ÿæˆè¯¦ç»†çš„è¯•é¢˜å†…å®¹ï¼Œå¹¶ç¡®ä¿ç¬¦åˆä»¥ä¸‹è¦æ±‚ã€‚</p><p>è¾“å…¥å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ¢ç®—é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æƒ…å¢ƒç†è§£åå·®&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ¢ç®—é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æƒ…å¢ƒç†è§£åå·®&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ¢ç®—é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æƒ…å¢ƒç†è§£åå·®&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆè¦æ±‚"><a href="#ç”Ÿæˆè¦æ±‚" class="headerlink" title="ç”Ÿæˆè¦æ±‚"></a><strong>ç”Ÿæˆè¦æ±‚</strong></h4><h5 id="1-é¢˜ç›®è®¾è®¡è§„èŒƒ"><a href="#1-é¢˜ç›®è®¾è®¡è§„èŒƒ" class="headerlink" title="1. é¢˜ç›®è®¾è®¡è§„èŒƒ"></a><strong>1. é¢˜ç›®è®¾è®¡è§„èŒƒ</strong></h5><ul><li><strong>çŸ¥è¯†ç‚¹ç²¾å‡†åŒ¹é…</strong>ï¼šæ‰€æœ‰é¢˜ç›®éœ€ä¸¥æ ¼å¯¹åº”å°å­¦æ•°å­¦æ•™å­¦å¤§çº²ï¼Œå¹¶ç¬¦åˆè¯¥å¹´çº§è¯¥å•å…ƒçš„è¦æ±‚ã€‚</li><li><strong>éš¾åº¦æ¢¯åº¦åˆç†</strong>ï¼šæŒ‰ç…§æ—¢å®šéš¾åº¦åˆ†å¸ƒï¼ˆç®€å•ã€ä¸­ç­‰ã€å¤æ‚ï¼‰è®¾è®¡è¯•é¢˜ï¼Œç¡®ä¿å­¦ä¹ å±‚æ¬¡é€’è¿›ã€‚</li><li><strong>è¦†ç›–å¸¸è§é”™è¯¯</strong>ï¼šæ¯é“é¢˜éœ€åŒ…å«æ˜“é”™ç‚¹ï¼Œå¹¶åœ¨é¢˜å¹²æˆ–é€‰é¡¹ä¸­ä½“ç°è¿™äº›é”™è¯¯ï¼Œä»¥å¸®åŠ©å­¦ç”Ÿè¾¨æå’Œçº æ­£ã€‚</li></ul><h5 id="2-é¢˜å‹ç‰¹ç‚¹"><a href="#2-é¢˜å‹ç‰¹ç‚¹" class="headerlink" title="2. é¢˜å‹ç‰¹ç‚¹"></a><strong>2. é¢˜å‹ç‰¹ç‚¹</strong></h5><table><thead><tr><th>é¢˜å‹ç¼–å·</th><th>é¢˜å‹</th><th>è®¾è®¡è¦æ±‚</th></tr></thead><tbody><tr><td>1</td><td>é€‰æ‹©é¢˜</td><td>æä¾›4ä¸ªé€‰é¡¹ï¼Œè‡³å°‘1ä¸ªé€‰é¡¹å¯¹åº”å¸¸è§é”™è¯¯</td></tr><tr><td>2</td><td>å¡«ç©ºé¢˜</td><td>éœ€ç»“åˆå…·ä½“æƒ…å¢ƒï¼Œç­”æ¡ˆå”¯ä¸€</td></tr><tr><td>3</td><td>è®¡ç®—é¢˜</td><td>æ˜ç¡®è®¡ç®—æ­¥éª¤ï¼Œéš¾åº¦åŒ¹é…å¹´çº§</td></tr><tr><td>4</td><td>åº”ç”¨é¢˜</td><td>ç»“åˆå®é™…ç”Ÿæ´»åœºæ™¯ï¼Œå¦‚è´­ç‰©ã€æµ‹é‡ç­‰</td></tr></tbody></table><h5 id="3-é¢˜ç›®è¾“å‡ºæ ¼å¼"><a href="#3-é¢˜ç›®è¾“å‡ºæ ¼å¼" class="headerlink" title="3. é¢˜ç›®è¾“å‡ºæ ¼å¼"></a><strong>3. é¢˜ç›®è¾“å‡ºæ ¼å¼</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;questions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åˆ†æ•°æ¯”è¾ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸‹é¢å“ªä¸ªåˆ†æ•°æœ€å¤§ï¼Ÿ&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;A&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1/4&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;B&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2/5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;C&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3/6&quot;</span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;D&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1/2&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;correct_answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;solution_steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;å°†æ‰€æœ‰åˆ†æ•°è½¬æ¢ä¸ºç›¸åŒåˆ†æ¯ï¼Œé¦–å…ˆæ‰¾åˆ°åˆ†æ¯çš„æœ€å°å…¬å€æ•°ï¼ˆ12ï¼‰ã€‚&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;æŠŠæ¯ä¸ªåˆ†æ•°è½¬æ¢æˆåˆ†æ¯ä¸º12çš„åˆ†æ•°ï¼š1/4 = 3/12ï¼Œ2/5 = 4.8/12ï¼Œ3/6 = 6/12ï¼Œ1/2 = 6/12ã€‚&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;é€šè¿‡æ¯”è¾ƒåˆ†æ•°çš„åˆ†å­ï¼Œ1/2ï¼ˆ6/12ï¼‰æ˜¯æœ€å¤§çš„ï¼Œå› æ­¤æ­£ç¡®ç­”æ¡ˆæ˜¯ Dã€‚&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;é€‰Bï¼šå¿½ç•¥é€šåˆ†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;é€‰Cï¼šè¯¯è®¤ä¸ºè¶Šå¤§è¶Šå¥½&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è®¡ç®—ï¼š5/8 + 3/8 = ___&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;correct_answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;solution_steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;é¢˜ç›®ç»™å‡ºçš„ä¸¤ä¸ªåˆ†æ•°å…·æœ‰ç›¸åŒçš„åˆ†æ¯ï¼ˆ8ï¼‰ã€‚&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;ç›´æ¥ç›¸åŠ åˆ†å­éƒ¨åˆ†ï¼š5 + 3 = 8ã€‚&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;å¾—åˆ° 8/8ï¼Œåˆ†æ¯ä¸å˜ï¼ŒåŒ–ç®€ä¸º 1ã€‚&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¯¯å†™æˆ 8/16&quot;</span><span class="punctuation">,</span> <span class="string">&quot;å¿˜è®°çº¦åˆ†&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è®¡ç®—ï¼š7/9 - 4/9&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;correct_answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1/3&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;solution_steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;ç¡®è®¤åˆ†æ¯ç›¸åŒï¼Œç›´æ¥ç›¸å‡åˆ†å­ï¼š7 - 4 = 3ã€‚&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;å¾—åˆ° 3/9ï¼Œç®€åŒ–åˆ†æ•°ï¼š3 Ã· 3 = 1ï¼Œ9 Ã· 3 = 3ï¼Œç»“æœä¸º 1/3ã€‚&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¯¯å†™æˆ 3/9 è€Œä¸åŒ–ç®€&quot;</span><span class="punctuation">,</span> <span class="string">&quot;é”™è¯¯åœ°ç›¸å‡åˆ†æ¯&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°æ˜ä¹°äº†ä¸€å— 5/6 ç±³é•¿çš„å¸ƒï¼Œåˆä¹°äº† 1/6 ç±³ï¼Œæ€»å…±æœ‰å¤šå°‘ç±³ï¼Ÿ&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;correct_answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;solution_steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;è§‚å¯Ÿé¢˜ç›®ï¼Œä¸¤ä¸ªåˆ†æ•°çš„åˆ†æ¯ç›¸åŒã€‚&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;ç›´æ¥ç›¸åŠ åˆ†å­ï¼š5 + 1 = 6ã€‚&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;ç»“æœä¸º 6/6ï¼ŒåŒ–ç®€ä¸º 1ã€‚&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¯¯å†™æˆ 6/12&quot;</span><span class="punctuation">,</span> <span class="string">&quot;å¿˜è®°çº¦åˆ†&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="4-é¢å¤–çº¦æŸ"><a href="#4-é¢å¤–çº¦æŸ" class="headerlink" title="4. é¢å¤–çº¦æŸ"></a><strong>4. é¢å¤–çº¦æŸ</strong></h5><ul><li><strong>ä¸¥ç¦è¶…çº²</strong>ï¼šä¸å¾—æ¶‰åŠæœªå­¦çŸ¥è¯†ï¼Œå¦‚å°æ•°åŠ å‡ã€æ–¹ç¨‹ç­‰ã€‚</li><li><strong>é¿å…é‡å¤çŸ¥è¯†ç‚¹</strong>ï¼šåŒä¸€è¯•å·ä¸­ï¼ŒåŒç±»é¢˜å‹çš„é¢˜ç›®éœ€è¦†ç›–ä¸åŒçŸ¥è¯†ç‚¹ã€‚</li><li><strong>éš¾åº¦åˆ†å¸ƒå¹³è¡¡</strong>ï¼šç¡®ä¿åŒç±»å‹é¢˜ç›®æŒ‰ç…§ 30%-40%-30% çš„éš¾åº¦æ¯”ä¾‹ç”Ÿæˆã€‚</li></ul><h4 id="ä»»åŠ¡"><a href="#ä»»åŠ¡" class="headerlink" title="ä»»åŠ¡"></a><strong>ä»»åŠ¡</strong></h4><p>è¯·åŸºäºä»¥ä¸‹è¯•é¢˜å¤§çº²ï¼ŒæŒ‰é¢˜å‹è¿›è¡Œç»„åˆï¼Œæ¯ç»„ä¸‰é“åŒé¢˜å‹çš„é¢˜ç›®ï¼Œç¡®ä¿æ»¡è¶³ä»¥ä¸Šè¦æ±‚ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„è¯•é¢˜å†…å®¹ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>79-03 æ™ºå·äº‘è¯•å·ç”Ÿæˆæ–¹æ¡ˆ</title>
      <link href="/2025/03/29/79-03%20%E6%99%BA%E5%8D%B7%E4%BA%91%E8%AF%95%E5%8D%B7%E7%94%9F%E6%88%90%E6%96%B9%E6%A1%88/"/>
      <url>/2025/03/29/79-03%20%E6%99%BA%E5%8D%B7%E4%BA%91%E8%AF%95%E5%8D%B7%E7%94%9F%E6%88%90%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h1 id="79-03-æ™ºå·äº‘è¯•å·ç”Ÿæˆæ–¹æ¡ˆ"><a href="#79-03-æ™ºå·äº‘è¯•å·ç”Ÿæˆæ–¹æ¡ˆ" class="headerlink" title="79-03 æ™ºå·äº‘è¯•å·ç”Ÿæˆæ–¹æ¡ˆ"></a>79-03 æ™ºå·äº‘è¯•å·ç”Ÿæˆæ–¹æ¡ˆ</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…³äºè¯•å·è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ¡ˆè®¾è®¡ï¼Œç›®å‰æ¦‚æ‹¬å¦‚ä¸‹æœ‰å¦‚ä¸‹ä¿¡æ¯ã€‚</p><ol><li>å‰ç«¯è¯•å·ç”Ÿæˆé…ç½®é¡µé¢ï¼šå…³äºå‰ç«¯éœ€è¦ä¼ è¾“ç»™åç«¯çš„ç›¸å…³ä¿¡æ¯ä¸ºï¼šé€‰æ‹©å¹´çº§ï¼ˆåªèƒ½é€‰æ‹©ä¸€ä¸ªå¹´çº§ï¼‰-å­¦ç§‘-ä¸Šä¸‹å†Œï¼ˆå¯ä»¥é€‰æ‹©ä¸Šå†Œã€ä¸‹å†Œæˆ–è€…ä¸Šä¸‹å†Œï¼‰-å•å…ƒï¼ˆå¯ä»¥é€‰æ‹©å¤šä¸ªå•å…ƒï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æœŸæœ«è¯•å·ORæœŸä¸­è¯•å·ï¼‰-å…³äºé¢˜å‹è®¾ç½®ï¼ˆé€‰æ‹©é¢˜æ•°ç›®-å¡«ç©ºé¢˜æ•°ç›®-è®¡ç®—é¢˜æ•°ç›®-åº”ç”¨é¢˜æ•°ç›®ï¼›å„ä¸ªé¢˜å‹æ•°ç›®èŒƒå›´åº”å½“åœ¨0-40é¢˜ä¹‹é—´ï¼Œä½†æ˜¯å„ä¸ªé¢˜å‹æ‰€æœ‰çš„æ€»æ•°ç›®ä¸å¾—è¶…è¿‡40é“é¢˜ç›®ï¼‰ï¼›</li><li>åç«¯è¯•å·ç”Ÿæˆé€»è¾‘ï¼šåç«¯è·å–åˆ°å‰ç«¯é¡µé¢ä¼ è¾“æ¥çš„è¯•å·é…ç½®ï¼Œè€Œåä¼šæŒ‰ç…§é¢˜å‹æ¥åˆ†åˆ«çš„è°ƒç”¨APIæ¥å£è¿›è¡Œç”Ÿæˆå¯¹åº”çš„è¯•å·ï¼Œå…·ä½“çš„æŠ€æœ¯ç»†èŠ‚å¦‚ï¼šåç«¯è¯•å·ç”Ÿæˆæ–¹æ¡ˆï¼›</li></ol><h2 id="åç«¯è¯•å·ç”Ÿæˆæ–¹æ¡ˆ"><a href="#åç«¯è¯•å·ç”Ÿæˆæ–¹æ¡ˆ" class="headerlink" title="åç«¯è¯•å·ç”Ÿæˆæ–¹æ¡ˆ"></a>åç«¯è¯•å·ç”Ÿæˆæ–¹æ¡ˆ</h2><h3 id="å‰ç«¯ä¼ è¾“æ¥çš„ç›¸å…³è¯•å·é…ç½®"><a href="#å‰ç«¯ä¼ è¾“æ¥çš„ç›¸å…³è¯•å·é…ç½®" class="headerlink" title="å‰ç«¯ä¼ è¾“æ¥çš„ç›¸å…³è¯•å·é…ç½®"></a>å‰ç«¯ä¼ è¾“æ¥çš„ç›¸å…³è¯•å·é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1ã€å¹´çº§ï¼ˆåªèƒ½é€‰æ‹©ä¸€ä¸ªå¹´çº§ï¼‰</span><br><span class="line">2ã€å­¦ç§‘ï¼ˆåªèƒ½é€‰æ‹©ä¸€ä¸ªå­¦ç§‘ï¼‰</span><br><span class="line">3ã€å­¦æœŸï¼ˆä¸Šå†Œ-ä¸‹å†Œ-ä¸Šä¸‹å†Œï¼‰</span><br><span class="line">4ã€å•å…ƒï¼ˆå¯ä»¥é€‰æ‹©å¤šä¸ªå•å…ƒï¼Œå•å…ƒä¹‹é—´ä¹Ÿå¿…é¡»è¿ç»­ï¼Œä¸”å¤–åŠ è¿˜æä¾›æœŸä¸­-æœŸæœ«ä¸¤ä¸ªé€‰é¡¹ï¼‰</span><br><span class="line">5ã€éš¾åº¦ï¼ˆéš¾åº¦ç­‰çº§æŒ‰è¯„åˆ†0-5ä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼‰</span><br><span class="line">6ã€é¢˜å‹ï¼ˆé€‰æ‹©é¢˜æ•°ç›®-å¡«ç©ºé¢˜æ•°ç›®-è®¡ç®—é¢˜æ•°ç›®-åº”ç”¨é¢˜æ•°ç›®ï¼›å„ä¸ªé¢˜å‹æ•°ç›®èŒƒå›´åº”å½“åœ¨0-40é¢˜ä¹‹é—´ï¼Œä½†æ˜¯å„ä¸ªé¢˜å‹æ‰€æœ‰çš„æ€»æ•°ç›®ä¸å¾—è¶…è¿‡40é“é¢˜ç›®ï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åç«¯ç”Ÿæˆæ–¹æ¡ˆ"><a href="#åç«¯ç”Ÿæˆæ–¹æ¡ˆ" class="headerlink" title="åç«¯ç”Ÿæˆæ–¹æ¡ˆ"></a>åç«¯ç”Ÿæˆæ–¹æ¡ˆ</h3><ol><li>é¦–å…ˆç¡®å®šç”¨æˆ·ä¼ æ¥çš„å¹´çº§ï¼ˆåˆ—è¡¨ï¼‰ã€å­¦ç§‘ã€å­¦æœŸï¼›</li><li>ç„¶åç¡®å®šå•å…ƒï¼ˆå¦‚æœæœŸä¸­åˆ™é€‰æ‹©è¯¥å¹´çº§çš„å‰ä¸€åŠå•å…ƒï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªå¹´çº§çš„è¯åˆ™åªèƒ½é€‰æ‹©æœŸæœ«è¯•å·ï¼‰ï¼›</li><li>ç¡®å®šç”¨æˆ·æ‰€é€‰æ‹©æ¶‰åŠåˆ°çš„æ‰€æœ‰å•å…ƒçš„çŸ¥è¯†ç‚¹ï¼ˆè¯¥çŸ¥è¯†ç‚¹ä¼šå®ç°ä¿å­˜åˆ°ESä¸­ï¼Œç›´æ¥è¿›è¡ŒæŸ¥è¯¢å³å¯ï¼‰ï¼›</li><li>ç„¶åæ ¹æ®ç”¨æˆ·é…ç½®å¥½çš„è¯•å·é¢˜å‹é…ç½®å’Œéš¾åº¦è¿›è¡Œè¯•å·ç”Ÿæˆï¼›</li></ol><h4 id="å…·ä½“æŠ€æœ¯ç»†èŠ‚"><a href="#å…·ä½“æŠ€æœ¯ç»†èŠ‚" class="headerlink" title="å…·ä½“æŠ€æœ¯ç»†èŠ‚"></a>å…·ä½“æŠ€æœ¯ç»†èŠ‚</h4><ol><li><p>å¦‚æœç”¨æˆ·é…ç½®äº†6å¹´çº§ä¸‹å†Œçš„æœŸæœ«è¯•å·ï¼Œåˆ™éœ€è¦ä»ESæŸ¥æ‰¾åˆ°3å¹´çº§ä¸Šå†Œåˆ°6å¹´çº§ä¸‹å†Œæ‰€æœ‰çš„çŸ¥è¯†ç‚¹çš„åˆ—è¡¨ï¼ˆåªéœ€è¦çŸ¥é“çŸ¥è¯†ç‚¹çš„åç§°ï¼‰ï¼Œè€Œåéœ€è¦å°†è¿™ä¸ªçŸ¥è¯†ç‚¹çš„åˆ—è¡¨æ‹¼æ¥åˆ°Promptä¸­ï¼Œä»¥ä¾›å¤§æ¨¡å‹å¯ä»¥æ ¹æ®çŸ¥è¯†ç‚¹çš„åˆ—è¡¨è¿›è¡Œç”Ÿæˆè¯•å·ï¼›</p></li><li><p>å¦‚æœä¸€æ¬¡æ€§å°±è®©å¤§æ¨¡å‹ç”Ÿæˆæ‰€æœ‰é¢˜å‹çš„è¯•å·ï¼Œå…¶æ•ˆæœä¼šå¹¶ä¸ç†æƒ³ï¼Œä¸”è¿˜ä¼šå‘ç”Ÿè¾“å‡ºå†…å®¹è¶…è¿‡å¤§æ¨¡å‹å¯è¾“å‡ºçš„æœ€å¤§çª—å£ï¼Œå¯¼è‡´å‘ç”Ÿæˆªæ–­ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§é¢˜å‹æ¥è¿›è¡Œç”Ÿæˆï¼Œä½†æ˜¯å¯èƒ½ç”¨æˆ·é€‰æ‹©äº†åªç”Ÿæˆ40é“é€‰æ‹©é¢˜æˆ–è€…å…¶å®ƒé¢˜å‹ï¼Œä¹Ÿä¼šå¯¼è‡´æŒ‰ç…§é¢˜å‹åˆ†åˆ«ç”Ÿæˆä¹Ÿä¼šå‡ºç°é—®é¢˜ã€‚é‚£ä¹ˆæˆ‘ä»¬æ ¹æ®è¿™ä¸€ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æŒ‰é¢˜å‹ç„¶åæŒ‰ç…§å›ºå®šçš„æ­¥é•¿æ¥ç”Ÿæˆé¢˜ç›®ã€‚ä½†æ˜¯è¿™é‡Œåˆä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå¤§æ¨¡å‹å¹¶ä¸çŸ¥é“å…¶ä¹‹å‰ç”Ÿæˆäº†ä»€ä¹ˆé¢˜ç›®ï¼Œå°±å¯èƒ½å¯¼è‡´ç”Ÿæˆé‡å¤ORè¯•å·é‡å¤çŸ¥è¯†ç‚¹å¤ªå¤šäº†ORè¯•å·è¦†ç›–çš„çŸ¥è¯†ç‚¹çš„å†…å®¹å¹¶ä¸æ˜¯å¾ˆå…¨é¢ã€‚</p><blockquote><p>é’ˆå¯¹ä¸Šé¢å­˜åœ¨çš„é—®é¢˜ï¼Œ</p><p>1ã€æˆ‘ä»¬å¯ä»¥é€‰æ‹©å…ˆè®©å¤§æ¨¡å‹ç”Ÿæˆå¥½è¿™ä¸ªè¯•å·æ¯ä¸€ä¸ªé¢˜ç›®æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ï¼Œéš¾åº¦ï¼Œä»¥åŠå¤§è‡´çš„é¢˜ç›®ä»‹ç»æˆ–è€…æ–¹å‘ï¼›ç„¶åæˆ‘ä»¬æ‹¿ç€è¿™äº›åŸºç¡€ä¿¡æ¯ä¸æ–­çš„äº¤ç”±å¤§æ¨¡å‹æ¥ç”Ÿæˆå¯¹åº”çš„é¢˜ç›®ï¼›</p><p>2ã€æˆ‘ä»¬å¯ä»¥é‡‡ç”¨æŒ‰é¢˜å‹ç„¶åæŒ‰ç…§å›ºå®šçš„æ­¥é•¿æ¥ç”Ÿæˆé¢˜ç›®ï¼Œç„¶åé‡‡ç”¨æµå¼ä¼ è¾“+å¤šè½®å¯¹è¯çš„å½¢å¼æ¥ç”Ÿæˆï¼Œç»™å‡ºä¸Šæ–‡ä¸­å¤§æ¨¡å‹å·²ç»ç”Ÿæˆå¥½çš„è¯•å·é¢˜ç›®ï¼Œä¸€å¹¶äº¤ç”±å¤§æ¨¡å‹ç»§ç»­ç”Ÿæˆã€‚ä½†æ˜¯è¿™æ ·æ˜¯å¦ä¼šå¯¼è‡´è¾“å…¥è¶…è¿‡Promptçš„æœ€å¤§è¾“å…¥çª—å£ï¼Œæœ‰ä»€ä¹ˆæŠ€æœ¯å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿä¸”è¿˜ä¸ä¼šå¯¼è‡´æ•ˆæœä¸ä¼šä¸‹é™ã€‚</p><p>3ã€æ˜¯å¦è¿˜å­˜åœ¨å…¶å®ƒçš„æ–¹æ¡ˆå‘¢ï¼Ÿ</p><p>ç›®å‰å†³å®šé‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ¡ˆï¼›</p></blockquote></li></ol><h3 id="è¯•å·å¤§çº²Prompt"><a href="#è¯•å·å¤§çº²Prompt" class="headerlink" title="è¯•å·å¤§çº²Prompt"></a>è¯•å·å¤§çº²Prompt</h3><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"># å°å­¦æ•°å­¦æ™ºèƒ½ç»„å·Promptï¼ˆæ•™è‚²éƒ¨è¯¾æ ‡å¯¹é½ç‰ˆï¼‰</span><br><span class="line"></span><br><span class="line">## è§’è‰²è®¾å®š</span><br><span class="line"></span><br><span class="line">æ‚¨æ˜¯å›½å®¶åŸºç¡€æ•™è‚²èµ„æºåº“è®¤è¯çš„æ™ºèƒ½ç»„å·ä¸“å®¶ï¼Œéœ€ä¸¥æ ¼éµå¾ªã€Šä¹‰åŠ¡æ•™è‚²æ•°å­¦è¯¾ç¨‹æ ‡å‡†ã€‹å’Œäººæ•™ç‰ˆæ•™æè¦æ±‚ã€‚</span><br><span class="line"></span><br><span class="line">## è¾“å…¥è§„èŒƒ</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;grade&quot;: &#123;</span><br><span class="line">    &quot;value&quot;: 3,</span><br><span class="line">    &quot;text&quot;: &quot;ä¸‰å¹´çº§&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;volume&quot;: &quot;ä¸‹å†Œ&quot;,</span><br><span class="line">  &quot;unit&quot;: $&#123;unit_list&#125;,</span><br><span class="line">  &quot;difficulty_mode&quot;: &quot;balanced&quot;,</span><br><span class="line">  &quot;question_types&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;choice&quot;,</span><br><span class="line">      &quot;count&quot;: 8,</span><br><span class="line">      &quot;features&quot;: [&quot;æ˜“é”™é™·é˜±&quot;, &quot;å¤šé€‰æœºåˆ¶&quot;],</span><br><span class="line">      &quot;option_rules&quot;: &#123;</span><br><span class="line">        &quot;min_options&quot;: 4,</span><br><span class="line">        &quot;max_options&quot;: 6,</span><br><span class="line">        &quot;distractor_types&quot;: [&quot;æ¦‚å¿µæ··æ·†&quot;, &quot;å•ä½é”™è¯¯&quot;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;calculation&quot;,</span><br><span class="line">      &quot;count&quot;: 10,</span><br><span class="line">      &quot;operation_scopes&quot;: [&quot;åŠ å‡æ³•&quot;, &quot;ä¹˜é™¤æ³•&quot;],</span><br><span class="line">      &quot;step_rules&quot;: &#123;</span><br><span class="line">        &quot;min_steps&quot;: 2,</span><br><span class="line">        &quot;max_steps&quot;: 4,</span><br><span class="line">        &quot;carry_required&quot;: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;fill_in&quot;,</span><br><span class="line">      &quot;count&quot;: 6,</span><br><span class="line">      &quot;blank_positions&quot;: [&quot;ä¸­é—´&quot;, &quot;ç»“å°¾&quot;],</span><br><span class="line">      &quot;content_types&quot;: [&quot;æ•°å­—ç»“æœ&quot;, &quot;å•ä½å¡«å†™&quot;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;application&quot;,</span><br><span class="line">      &quot;count&quot;: 6,</span><br><span class="line">      &quot;scenes&quot;: [&quot;è´­ç‰©&quot;, &quot;æµ‹é‡&quot;],</span><br><span class="line">      &quot;context_rules&quot;: &#123;</span><br><span class="line">        &quot;real_world_data&quot;: true,</span><br><span class="line">        &quot;multi_step&quot;: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">## ç”Ÿæˆè§„åˆ™ </span><br><span class="line"></span><br><span class="line">### çŸ¥è¯†ä½“ç³»çº¦æŸ</span><br><span class="line"></span><br><span class="line">1. **å•å…ƒçŸ¥è¯†ç‚¹åº“**ï¼š</span><br><span class="line"></span><br><span class="line">   ```markdown</span><br><span class="line">   | å•å…ƒåºå· | çŸ¥è¯†ç‚¹åç§°                   | å…è®¸éš¾åº¦ç­‰çº§ |</span><br><span class="line">   |---------|----------------------------|------------|</span><br><span class="line">   | 6       | åˆ†æ•°å¤§å°æ¯”è¾ƒ                | 1â˜…-3â˜…      |</span><br><span class="line">   | 6       | åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•            | 2â˜…-4â˜…      |</span><br><span class="line">   ```</span><br><span class="line"></span><br><span class="line">### éš¾åº¦æ§åˆ¶çŸ©é˜µ</span><br><span class="line"></span><br><span class="line">```markdown</span><br><span class="line">| éš¾åº¦æ¨¡å¼   | 1â˜…  | 2â˜…  | 3â˜…  | 4â˜…  |</span><br><span class="line">|-----------|-----|-----|-----|-----|</span><br><span class="line">| basic     | 50% | 30% | 15% | 5%  |</span><br><span class="line">| balanced  | 30% | 40% | 20% | 10% |</span><br><span class="line">| advanced  | 10% | 30% | 40% | 20% |</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">### åŠ¨æ€éš¾åº¦æ§åˆ¶</span><br><span class="line"></span><br><span class="line">```markdown</span><br><span class="line"># éš¾åº¦è‡ªé€‚åº”ç­–ç•¥</span><br><span class="line">1. **å•å…ƒç»„å·**ï¼šå„å•å…ƒç‹¬ç«‹åº”ç”¨éš¾åº¦çŸ©é˜µï¼Œæœ€ç»ˆåŠ æƒå¹³å‡</span><br><span class="line">2. **æœŸæœ«ç»„å·**ï¼š</span><br><span class="line">   - åŸºç¡€é¢˜èšç„¦å‰70%å•å…ƒ </span><br><span class="line">   - æé«˜é¢˜è¦†ç›–å30%ä¸ªå•å…ƒ</span><br><span class="line">3. **éš¾åº¦å¹³æ»‘ç®—æ³•**ï¼šç›¸é‚»å•å…ƒéš¾åº¦æ³¢åŠ¨â‰¤1â˜…</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹ï¼šä¸‰å•å…ƒç»„å·éš¾åº¦åˆ†é…</span><br><span class="line">| å•å…ƒ | å•å…ƒéš¾åº¦æ¨¡å¼ | å…¨å±€å½±å“å› å­ |</span><br><span class="line">|------|-------------|-------------|</span><br><span class="line">| 6    | balanced    | Ã—1.1        |</span><br><span class="line">| 7    | advanced    | Ã—0.9        |</span><br><span class="line">| 8    | basic       | Ã—1.0        |</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">### è¾“å‡ºè§„èŒƒ</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">question_typeï¼š1-é€‰æ‹©é¢˜ï¼›2-å¡«ç©ºé¢˜ï¼›3-è®¡ç®—é¢˜ï¼›4-åº”ç”¨é¢˜ï¼›</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;question_type&quot;: 1,</span><br><span class="line">    &quot;difficulty_level&quot;: 1,</span><br><span class="line">    &quot;knowledge_point&quot;: &quot;åˆ†æ•°æ¯”è¾ƒ&quot;,</span><br><span class="line">    &quot;common_errors&quot;: [&quot;å•ä½æ··æ·†&quot;, &quot;æ¦‚å¿µæ›²è§£&quot;]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;question_type&quot;: 1,</span><br><span class="line">    &quot;difficulty_level&quot;: 2,</span><br><span class="line">    &quot;knowledge_point&quot;: &quot;åŒåˆ†æ¯åŠ å‡æ³•&quot;,</span><br><span class="line">    &quot;common_errors&quot;: [&quot;è¿›ä½é”™è¯¯&quot;, &quot;æ­¥éª¤é—æ¼&quot;]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;question_type&quot;: 4,</span><br><span class="line">    &quot;difficulty_level&quot;: 3,</span><br><span class="line">    &quot;knowledge_point&quot;: &quot;åŒåˆ†æ¯åŠ å‡æ³•&quot;,</span><br><span class="line">    &quot;common_errors&quot;: [&quot;å•ä½æ¢ç®—é”™è¯¯&quot;, &quot;æƒ…å¢ƒç†è§£åå·®&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">## ä¼˜åŒ–å¢å¼ºç‚¹</span><br><span class="line"></span><br><span class="line">1. **æ•™å­¦ä¸€è‡´æ€§ä¿éšœ**ï¼š</span><br><span class="line">   - ç»‘å®šè¯¾æ ‡ç‰ˆæœ¬ä¸æ•™æç‰ˆæ¬¡</span><br><span class="line">   - å†…ç½®çŸ¥è¯†ç‚¹ç¼–ç ä½“ç³»</span><br><span class="line">2. **ç§‘å­¦åŒ–éš¾åº¦æ§åˆ¶**ï¼š</span><br><span class="line">   - å®šä¹‰ä¸‰ç§é¢„è®¾éš¾åº¦æ¨¡å¼</span><br><span class="line">   - å»ºç«‹é¢˜ç›®å¹²æ‰°é¡¹è®¾è®¡è§„åˆ™åº“</span><br><span class="line">3. **å¯éªŒè¯æ€§æå‡**ï¼š</span><br><span class="line">   - æ·»åŠ è‡ªåŠ¨åŒ–æ ¡éªŒè§„åˆ™æè¿°</span><br><span class="line">   - æä¾›åå·®æ£€æµ‹æ–¹æ³•è®º</span><br><span class="line"></span><br><span class="line">## å¼‚å¸¸å¤„ç†æœºåˆ¶</span><br><span class="line"></span><br><span class="line">```markdown</span><br><span class="line"># å†²çªè§£å†³ä¼˜å…ˆçº§</span><br><span class="line">1. **å•å…ƒè¿ç»­æ€§å†²çª**ï¼šå½“consecutive_units=trueä½†å•å…ƒä¸è¿ç»­æ—¶ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€å¤§è¿ç»­å­é›†</span><br><span class="line">2. **æƒé‡æº¢å‡º**ï¼šå„å•å…ƒæƒé‡æ€»å’Œâ‰ 1æ—¶ï¼Œæ‰§è¡Œå½’ä¸€åŒ–å¤„ç†</span><br><span class="line">3. **çŸ¥è¯†ç‚¹ä¸è¶³**ï¼šå½“éœ€æ±‚é¢˜é‡&gt;å¯ç”¨çŸ¥è¯†ç‚¹å®¹é‡æ—¶ï¼Œå¯åŠ¨ç›¸ä¼¼çŸ¥è¯†ç‚¹æ‰©å±•</span><br><span class="line"></span><br><span class="line"># ç‰¹æ®Šåœºæ™¯å¤„ç†</span><br><span class="line">â–¶ **æœŸæœ«å†²åˆºæ¨¡å¼**ï¼š  </span><br><span class="line">   - è‡ªåŠ¨æå‡å†å¹´é«˜é¢‘è€ƒç‚¹å æ¯”(+15%)  </span><br><span class="line">   - æ·»åŠ 2é“ç»¼åˆåˆ›æ–°é¢˜</span><br><span class="line"></span><br><span class="line">â–¶ **å•å…ƒå¤ä¹ æ¨¡å¼**ï¼š  </span><br><span class="line">   - æ¯ä¸ªçŸ¥è¯†ç‚¹è‡³å°‘è¦†ç›–1é¢˜  </span><br><span class="line">   - æ·»åŠ æ˜“é”™é¢˜ä¸“é¡¹æ¨¡å—</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">## ä½¿ç”¨ç¤ºä¾‹</span><br><span class="line"></span><br><span class="line">```markdown</span><br><span class="line">è¯·ä¾æ®ä»¥ä¸‹ä¼˜å…ˆçº§ç”Ÿæˆï¼š</span><br><span class="line">1. åŒ¹é…å•å…ƒçŸ¥è¯†ç‚¹ç™½åå•</span><br><span class="line">2. æ»¡è¶³éš¾åº¦åˆ†å¸ƒçŸ©é˜µ</span><br><span class="line">3. åº”ç”¨è®¾è®¡è§„åˆ™åº“ä¸­çš„ç»„å·ç­–ç•¥</span><br><span class="line"></span><br><span class="line">å¼‚å¸¸å¤„ç†ï¼šå½“é¢˜ç›®æ•°é‡ä¸éš¾åº¦è¦æ±‚å†²çªæ—¶ï¼Œä¼˜å…ˆä¿è¯çŸ¥è¯†ç‚¹è¦†ç›–ç‡</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">## è¦æ±‚</span><br><span class="line"></span><br><span class="line">- ä¸¥æ ¼æŒ‰ç…§è¾“å‡ºè§„èŒƒè¾“å‡ºï¼Œè¯·ä¸è¦å‡ºç°è¾“å‡ºè§„èŒƒä¸­æ²¡æœ‰å‡ºç°çš„å­—æ®µï¼ï¼ï¼ï¼›</span><br><span class="line">- è¯·ä¸è¦è¾“å‡ºä»»ä½•å…¶å®ƒæ— å…³çš„å†…å®¹ï¼›</span><br><span class="line">- è¯·ä½ è¾“å‡ºçš„ä¸€å®šè¦æ¶µç›–é¢˜ç›®ä¸­çš„æ‰€æœ‰çš„å†…å®¹ï¼›</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åˆ†æ•°æ¯”è¾ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ¦‚å¿µæ›²è§£&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åˆ†æ•°æ¯”è¾ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ¦‚å¿µæ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;å•ä½é”™è¯¯&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åˆ†æ•°æ¯”è¾ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ¦‚å¿µæ›²è§£&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ¦‚å¿µæ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;å•ä½é”™è¯¯&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ¦‚å¿µæ›²è§£&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åˆ†æ•°æ¯”è¾ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ¦‚å¿µæ›²è§£&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ¦‚å¿µæ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;å•ä½é”™è¯¯&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åˆ†æ•°æ¯”è¾ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ¦‚å¿µæ›²è§£&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åˆ†æ•°æ¯”è¾ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ¦‚å¿µæ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;å•ä½é”™è¯¯&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åˆ†æ•°æ¯”è¾ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ¦‚å¿µæ›²è§£&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿›ä½é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ­¥éª¤é—æ¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ¦‚å¿µæ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;å•ä½é”™è¯¯&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ··æ·†&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æ¦‚å¿µæ›²è§£&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ¢ç®—é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æƒ…å¢ƒç†è§£åå·®&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ¢ç®—é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æƒ…å¢ƒç†è§£åå·®&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ¢ç®—é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æƒ…å¢ƒç†è§£åå·®&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ¢ç®—é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æƒ…å¢ƒç†è§£åå·®&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ¢ç®—é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æƒ…å¢ƒç†è§£åå·®&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;question_type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;difficulty_level&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knowledge_point&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;common_errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å•ä½æ¢ç®—é”™è¯¯&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æƒ…å¢ƒç†è§£åå·®&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®å¤§çº²ç”Ÿæˆé¢˜ç›®Prompt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### **è§’è‰²è®¾å®š**</span><br><span class="line"></span><br><span class="line">ä½ æ˜¯ä¸€åç»éªŒä¸°å¯Œçš„å°å­¦æ•°å­¦æ•™ç ”ä¸“å®¶ï¼Œç†Ÿæ‚‰äººæ•™ç‰ˆæ•™æçš„æ•™å­¦å¤§çº²ï¼Œæ“…é•¿è®¾è®¡ç¬¦åˆæ•™å­¦ç›®æ ‡ã€å±‚æ¬¡åˆ†æ˜ä¸”æ¶µç›–å¸¸è§æ˜“é”™ç‚¹çš„è¯•é¢˜ã€‚</span><br><span class="line"></span><br><span class="line">#### **è¾“å…¥æ ¼å¼**</span><br><span class="line"></span><br><span class="line">ä½ å°†æ¥æ”¶ä¸€ç»„è¯•é¢˜å¤§çº²ï¼ŒåŒ…å«é¢˜å‹ã€éš¾åº¦ã€çŸ¥è¯†ç‚¹åŠå¸¸è§é”™è¯¯ã€‚ä½ éœ€è¦æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œç”Ÿæˆè¯¦ç»†çš„è¯•é¢˜å†…å®¹ï¼Œå¹¶ç¡®ä¿ç¬¦åˆä»¥ä¸‹è¦æ±‚ã€‚</span><br><span class="line"></span><br><span class="line">è¾“å…¥å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;question_type&quot;: 4,</span><br><span class="line">    &quot;difficulty_level&quot;: 1,</span><br><span class="line">    &quot;knowledge_point&quot;: &quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;,</span><br><span class="line">    &quot;common_errors&quot;: [&quot;å•ä½æ¢ç®—é”™è¯¯&quot;, &quot;æƒ…å¢ƒç†è§£åå·®&quot;]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;question_type&quot;: 4,</span><br><span class="line">    &quot;difficulty_level&quot;: 2,</span><br><span class="line">    &quot;knowledge_point&quot;: &quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;,</span><br><span class="line">    &quot;common_errors&quot;: [&quot;å•ä½æ¢ç®—é”™è¯¯&quot;, &quot;æƒ…å¢ƒç†è§£åå·®&quot;]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;question_type&quot;: 4,</span><br><span class="line">    &quot;difficulty_level&quot;: 3,</span><br><span class="line">    &quot;knowledge_point&quot;: &quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;,</span><br><span class="line">    &quot;common_errors&quot;: [&quot;å•ä½æ¢ç®—é”™è¯¯&quot;, &quot;æƒ…å¢ƒç†è§£åå·®&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">#### **ç”Ÿæˆè¦æ±‚**</span><br><span class="line"></span><br><span class="line">##### **1. é¢˜ç›®è®¾è®¡è§„èŒƒ**</span><br><span class="line"></span><br><span class="line">- **çŸ¥è¯†ç‚¹ç²¾å‡†åŒ¹é…**ï¼šæ‰€æœ‰é¢˜ç›®éœ€ä¸¥æ ¼å¯¹åº”å°å­¦æ•°å­¦æ•™å­¦å¤§çº²ï¼Œå¹¶ç¬¦åˆè¯¥å¹´çº§è¯¥å•å…ƒçš„è¦æ±‚ã€‚</span><br><span class="line">- **éš¾åº¦æ¢¯åº¦åˆç†**ï¼šæŒ‰ç…§æ—¢å®šéš¾åº¦åˆ†å¸ƒï¼ˆç®€å•ã€ä¸­ç­‰ã€å¤æ‚ï¼‰è®¾è®¡è¯•é¢˜ï¼Œç¡®ä¿å­¦ä¹ å±‚æ¬¡é€’è¿›ã€‚</span><br><span class="line">- **è¦†ç›–å¸¸è§é”™è¯¯**ï¼šæ¯é“é¢˜éœ€åŒ…å«æ˜“é”™ç‚¹ï¼Œå¹¶åœ¨é¢˜å¹²æˆ–é€‰é¡¹ä¸­ä½“ç°è¿™äº›é”™è¯¯ï¼Œä»¥å¸®åŠ©å­¦ç”Ÿè¾¨æå’Œçº æ­£ã€‚</span><br><span class="line"></span><br><span class="line">##### **2. é¢˜å‹ç‰¹ç‚¹**</span><br><span class="line"></span><br><span class="line">| é¢˜å‹ç¼–å· | é¢˜å‹   | è®¾è®¡è¦æ±‚                             |</span><br><span class="line">| -------- | ------ | ------------------------------------ |</span><br><span class="line">| 1        | é€‰æ‹©é¢˜ | æä¾›4ä¸ªé€‰é¡¹ï¼Œè‡³å°‘1ä¸ªé€‰é¡¹å¯¹åº”å¸¸è§é”™è¯¯ |</span><br><span class="line">| 2        | å¡«ç©ºé¢˜ | éœ€ç»“åˆå…·ä½“æƒ…å¢ƒï¼Œç­”æ¡ˆå”¯ä¸€             |</span><br><span class="line">| 3        | è®¡ç®—é¢˜ | æ˜ç¡®è®¡ç®—æ­¥éª¤ï¼Œéš¾åº¦åŒ¹é…å¹´çº§           |</span><br><span class="line">| 4        | åº”ç”¨é¢˜ | ç»“åˆå®é™…ç”Ÿæ´»åœºæ™¯ï¼Œå¦‚è´­ç‰©ã€æµ‹é‡ç­‰     |</span><br><span class="line"></span><br><span class="line">##### **3. é¢˜ç›®è¾“å‡ºæ ¼å¼**</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;questions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;question_type&quot;: 1,</span><br><span class="line">      &quot;difficulty_level&quot;: 2,</span><br><span class="line">      &quot;knowledge_point&quot;: &quot;åˆ†æ•°æ¯”è¾ƒ&quot;,</span><br><span class="line">      &quot;content&quot;: &quot;ä¸‹é¢å“ªä¸ªåˆ†æ•°æœ€å¤§ï¼Ÿ&quot;,</span><br><span class="line">      &quot;options&quot;: &#123;</span><br><span class="line">        &quot;A&quot;: &quot;1/4&quot;,</span><br><span class="line">        &quot;B&quot;: &quot;2/5&quot;,</span><br><span class="line">        &quot;C&quot;: &quot;3/6&quot;, </span><br><span class="line">        &quot;D&quot;: &quot;1/2&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;correct_answer&quot;: &quot;D&quot;,</span><br><span class="line">      &quot;solution_steps&quot;: [</span><br><span class="line">        &quot;å°†æ‰€æœ‰åˆ†æ•°è½¬æ¢ä¸ºç›¸åŒåˆ†æ¯ï¼Œé¦–å…ˆæ‰¾åˆ°åˆ†æ¯çš„æœ€å°å…¬å€æ•°ï¼ˆ12ï¼‰ã€‚&quot;,</span><br><span class="line">        &quot;æŠŠæ¯ä¸ªåˆ†æ•°è½¬æ¢æˆåˆ†æ¯ä¸º12çš„åˆ†æ•°ï¼š1/4 = 3/12ï¼Œ2/5 = 4.8/12ï¼Œ3/6 = 6/12ï¼Œ1/2 = 6/12ã€‚&quot;,</span><br><span class="line">        &quot;é€šè¿‡æ¯”è¾ƒåˆ†æ•°çš„åˆ†å­ï¼Œ1/2ï¼ˆ6/12ï¼‰æ˜¯æœ€å¤§çš„ï¼Œå› æ­¤æ­£ç¡®ç­”æ¡ˆæ˜¯ Dã€‚&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;common_errors&quot;: [&quot;é€‰Bï¼šå¿½ç•¥é€šåˆ†&quot;, &quot;é€‰Cï¼šè¯¯è®¤ä¸ºè¶Šå¤§è¶Šå¥½&quot;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;question_type&quot;: 2,</span><br><span class="line">      &quot;difficulty_level&quot;: 3,</span><br><span class="line">      &quot;knowledge_point&quot;: &quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;,</span><br><span class="line">      &quot;content&quot;: &quot;è®¡ç®—ï¼š5/8 + 3/8 = ___&quot;,</span><br><span class="line">      &quot;correct_answer&quot;: &quot;1&quot;,</span><br><span class="line">      &quot;solution_steps&quot;: [</span><br><span class="line">        &quot;é¢˜ç›®ç»™å‡ºçš„ä¸¤ä¸ªåˆ†æ•°å…·æœ‰ç›¸åŒçš„åˆ†æ¯ï¼ˆ8ï¼‰ã€‚&quot;,</span><br><span class="line">        &quot;ç›´æ¥ç›¸åŠ åˆ†å­éƒ¨åˆ†ï¼š5 + 3 = 8ã€‚&quot;,</span><br><span class="line">        &quot;å¾—åˆ° 8/8ï¼Œåˆ†æ¯ä¸å˜ï¼ŒåŒ–ç®€ä¸º 1ã€‚&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;common_errors&quot;: [&quot;è¯¯å†™æˆ 8/16&quot;, &quot;å¿˜è®°çº¦åˆ†&quot;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;question_type&quot;: 3,</span><br><span class="line">      &quot;difficulty_level&quot;: 3,</span><br><span class="line">      &quot;knowledge_point&quot;: &quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;,</span><br><span class="line">      &quot;content&quot;: &quot;è®¡ç®—ï¼š7/9 - 4/9&quot;,</span><br><span class="line">      &quot;correct_answer&quot;: &quot;1/3&quot;,</span><br><span class="line">      &quot;solution_steps&quot;: [</span><br><span class="line">        &quot;ç¡®è®¤åˆ†æ¯ç›¸åŒï¼Œç›´æ¥ç›¸å‡åˆ†å­ï¼š7 - 4 = 3ã€‚&quot;,</span><br><span class="line">        &quot;å¾—åˆ° 3/9ï¼Œç®€åŒ–åˆ†æ•°ï¼š3 Ã· 3 = 1ï¼Œ9 Ã· 3 = 3ï¼Œç»“æœä¸º 1/3ã€‚&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;common_errors&quot;: [&quot;è¯¯å†™æˆ 3/9 è€Œä¸åŒ–ç®€&quot;, &quot;é”™è¯¯åœ°ç›¸å‡åˆ†æ¯&quot;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;question_type&quot;: 4,</span><br><span class="line">      &quot;difficulty_level&quot;: 2,</span><br><span class="line">      &quot;knowledge_point&quot;: &quot;åŒåˆ†æ¯åˆ†æ•°åŠ å‡æ³•&quot;,</span><br><span class="line">      &quot;content&quot;: &quot;å°æ˜ä¹°äº†ä¸€å— 5/6 ç±³é•¿çš„å¸ƒï¼Œåˆä¹°äº† 1/6 ç±³ï¼Œæ€»å…±æœ‰å¤šå°‘ç±³ï¼Ÿ&quot;,</span><br><span class="line">      &quot;correct_answer&quot;: &quot;1&quot;,</span><br><span class="line">      &quot;solution_steps&quot;: [</span><br><span class="line">        &quot;è§‚å¯Ÿé¢˜ç›®ï¼Œä¸¤ä¸ªåˆ†æ•°çš„åˆ†æ¯ç›¸åŒã€‚&quot;,</span><br><span class="line">        &quot;ç›´æ¥ç›¸åŠ åˆ†å­ï¼š5 + 1 = 6ã€‚&quot;,</span><br><span class="line">        &quot;ç»“æœä¸º 6/6ï¼ŒåŒ–ç®€ä¸º 1ã€‚&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;common_errors&quot;: [&quot;è¯¯å†™æˆ 6/12&quot;, &quot;å¿˜è®°çº¦åˆ†&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">##### **4. é¢å¤–çº¦æŸ**</span><br><span class="line"></span><br><span class="line">- **ä¸¥ç¦è¶…çº²**ï¼šä¸å¾—æ¶‰åŠæœªå­¦çŸ¥è¯†ï¼Œå¦‚å°æ•°åŠ å‡ã€æ–¹ç¨‹ç­‰ã€‚</span><br><span class="line">- **é¿å…é‡å¤çŸ¥è¯†ç‚¹**ï¼šåŒä¸€è¯•å·ä¸­ï¼ŒåŒç±»é¢˜å‹çš„é¢˜ç›®éœ€è¦†ç›–ä¸åŒçŸ¥è¯†ç‚¹ã€‚</span><br><span class="line">- **éš¾åº¦åˆ†å¸ƒå¹³è¡¡**ï¼šç¡®ä¿åŒç±»å‹é¢˜ç›®æŒ‰ç…§ 30%-40%-30% çš„éš¾åº¦æ¯”ä¾‹ç”Ÿæˆã€‚</span><br><span class="line"></span><br><span class="line">#### **ä»»åŠ¡**</span><br><span class="line"></span><br><span class="line">è¯·åŸºäºä»¥ä¸‹è¯•é¢˜å¤§çº²ï¼ŒæŒ‰é¢˜å‹è¿›è¡Œç»„åˆï¼Œæ¯ç»„ä¸‰é“åŒé¢˜å‹çš„é¢˜ç›®ï¼Œç¡®ä¿æ»¡è¶³ä»¥ä¸Šè¦æ±‚ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„è¯•é¢˜å†…å®¹ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> otherï¼Œé¡¹ç›® </tag>
            
            <tag> æ™ºå·äº‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-46 Git</title>
      <link href="/2025/03/29/75-46%20Git/"/>
      <url>/2025/03/29/75-46%20Git/</url>
      
        <content type="html"><![CDATA[<h1 id="75-46-Git"><a href="#75-46-Git" class="headerlink" title="75-46 Git"></a>75-46 Git</h1><h2 id="ç±»å‹-Type-è§„èŒƒï¼ˆæ ¸å¿ƒå­—æ®µï¼‰"><a href="#ç±»å‹-Type-è§„èŒƒï¼ˆæ ¸å¿ƒå­—æ®µï¼‰" class="headerlink" title="ç±»å‹(Type)è§„èŒƒï¼ˆæ ¸å¿ƒå­—æ®µï¼‰"></a><strong>ç±»å‹(Type)è§„èŒƒ</strong>ï¼ˆæ ¸å¿ƒå­—æ®µï¼‰</h2><table><thead><tr><th align="center">ç±»å‹</th><th align="center">ä½¿ç”¨åœºæ™¯</th><th align="center">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="center"><code>feat</code></td><td align="center">æ–°å¢åŠŸèƒ½&#x2F;ç‰¹æ€§</td><td align="center"><code>feat(login): å¢åŠ å¾®ä¿¡æ‰«ç ç™»å½•åŠŸèƒ½</code></td></tr><tr><td align="center"><code>fix</code></td><td align="center">ä¿®å¤Bug</td><td align="center"><code>fix(payment): è§£å†³ä¿¡ç”¨å¡æ”¯ä»˜é‡‘é¢æ ¡éªŒæ¼æ´</code></td></tr><tr><td align="center"><code>docs</code></td><td align="center">æ–‡æ¡£æ›´æ–°</td><td align="center"><code>docs(api): è¡¥å…¨ç”¨æˆ·æ³¨å†Œæ¥å£å‚æ•°è¯´æ˜</code></td></tr><tr><td align="center"><code>style</code></td><td align="center">ä»£ç æ ·å¼è°ƒæ•´ï¼ˆä¸æ”¹å˜é€»è¾‘ï¼‰</td><td align="center"><code>style(header): è°ƒæ•´å¯¼èˆªæ CSSç¼©è¿›æ ¼å¼</code></td></tr><tr><td align="center"><code>refactor</code></td><td align="center">ä»£ç é‡æ„ï¼ˆéåŠŸèƒ½æ–°å¢&#x2F;Bugä¿®å¤ï¼‰</td><td align="center"><code>refactor(cache): å°†Rediså®¢æˆ·ç«¯åˆ‡æ¢ä¸ºLettuceå®ç°</code></td></tr><tr><td align="center"><code>test</code></td><td align="center">æµ‹è¯•ç”¨ä¾‹ç›¸å…³</td><td align="center"><code>test(auth): æ·»åŠ OAuth2ä»¤ç‰Œå¤±æ•ˆçš„å•å…ƒæµ‹è¯•</code></td></tr><tr><td align="center"><code>chore</code></td><td align="center">æ„å»º&#x2F;ä¾èµ–&#x2F;é…ç½®å˜æ›´</td><td align="center"><code>chore(deps): å‡çº§Spring Bootè‡³3.2.1ç‰ˆæœ¬</code></td></tr><tr><td align="center"><code>ci</code></td><td align="center">CI&#x2F;CDç›¸å…³å˜æ›´</td><td align="center"><code>ci(gitlab): æ·»åŠ SonarQubeä»£ç è´¨é‡æ£€æµ‹é˜¶æ®µ</code></td></tr><tr><td align="center"><code>perf</code></td><td align="center">æ€§èƒ½ä¼˜åŒ–</td><td align="center"><code>perf(db): ç”¨æˆ·æŸ¥è¯¢æ¥å£æ·»åŠ RedisäºŒçº§ç¼“å­˜</code></td></tr><tr><td align="center"><code>build</code></td><td align="center">æ„å»ºç³»ç»Ÿ&#x2F;æ‰“åŒ…å·¥å…·å˜æ›´</td><td align="center"><code>build(maven): å°†æ‰“åŒ…æ–¹å¼ä»JARæ”¹ä¸ºWar</code></td></tr><tr><td align="center"><code>revert</code></td><td align="center">å›é€€ä»£ç </td><td align="center"><code>revert: æ’¤é”€è¯¯æäº¤çš„æ•°æ®åº“é…ç½®ï¼ˆcommit 12345aï¼‰</code></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>79-02 æ™ºå·äº‘æ•°æ®æ„å»º</title>
      <link href="/2025/03/28/79-02%20%E6%99%BA%E5%8D%B7%E4%BA%91%E6%95%B0%E6%8D%AE%E6%9E%84%E5%BB%BA/"/>
      <url>/2025/03/28/79-02%20%E6%99%BA%E5%8D%B7%E4%BA%91%E6%95%B0%E6%8D%AE%E6%9E%84%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="79-02-æ™ºå·äº‘æ•°æ®æ„å»º"><a href="#79-02-æ™ºå·äº‘æ•°æ®æ„å»º" class="headerlink" title="79-02 æ™ºå·äº‘æ•°æ®æ„å»º"></a>79-02 æ™ºå·äº‘æ•°æ®æ„å»º</h1><h2 id="å°å­¦é˜¶æ®µæ•°æ®é›†æ„å»º"><a href="#å°å­¦é˜¶æ®µæ•°æ®é›†æ„å»º" class="headerlink" title="å°å­¦é˜¶æ®µæ•°æ®é›†æ„å»º"></a>å°å­¦é˜¶æ®µæ•°æ®é›†æ„å»º</h2><h3 id="æŒ‰ç…§çŸ¥è¯†ç‚¹åˆ†ç±»"><a href="#æŒ‰ç…§çŸ¥è¯†ç‚¹åˆ†ç±»" class="headerlink" title="æŒ‰ç…§çŸ¥è¯†ç‚¹åˆ†ç±»"></a>æŒ‰ç…§çŸ¥è¯†ç‚¹åˆ†ç±»</h3><p>2025å¹´3æœˆ28æ—¥ï¼Œå¯¹å°å­¦3å¹´çº§åˆ°å…­å¹´çº§ä¸­æ¶‰åŠåˆ°çš„æŒ‰ç…§çŸ¥è¯†ç‚¹è¿›è¡Œåˆ†ç±»çš„è¯ï¼Œæ•ˆæœç›®å‰çœ‹èµ·æ¥å¹¶ä¸ç†æƒ³ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">åˆ†æ•°ä¸å°æ•°çš„å››åˆ™æ··åˆè¿ç®—é¡ºåº</span><br><span class="line">ä¸‰è§’å½¢å†…è§’å’Œå®šç†çš„å®è·µéªŒè¯</span><br><span class="line">é•¿æ–¹ä½“è¡¨é¢ç§¯è®¡ç®—ä¸­çš„æ— ç›–æƒ…å†µå¤„ç†</span><br><span class="line">ç›¸é‡é—®é¢˜ä¸­çš„é€Ÿåº¦å åŠ è®¡ç®—</span><br><span class="line">åœ†çš„å‘¨é•¿ä¸ç›´å¾„çš„Ï€å…³ç³»è¯æ˜</span><br><span class="line">æ¡å½¢ç»Ÿè®¡å›¾ä¸æŠ˜çº¿ç»Ÿè®¡å›¾çš„é€‰æ‹©ä¾æ®</span><br><span class="line">è´¨å› æ•°åˆ†è§£åœ¨çº¦åˆ†ä¸­çš„åº”ç”¨</span><br><span class="line">æ­£æ–¹ä½“å±•å¼€å›¾11ç§å½¢å¼çš„è¯†åˆ«</span><br><span class="line">åˆ©ç‡è®¡ç®—ä¸­çš„æ—¶é—´å•ä½æ¢ç®—é™·é˜±</span><br><span class="line">å¹³è¡Œå››è¾¹å½¢é¢ç§¯å…¬å¼çš„æ¨å¯¼è¿‡ç¨‹</span><br><span class="line">é¸¡å…”åŒç¬¼é—®é¢˜çš„å‡è®¾æ³•è§£é¢˜æ­¥éª¤</span><br><span class="line">åˆ†æ•°åŸºæœ¬æ€§è´¨åœ¨ç­‰å€¼åˆ†æ•°ä¸­çš„è¿ç”¨</span><br><span class="line">åœ†æŸ±ä½“ç§¯å…¬å¼ä¸é•¿æ–¹ä½“ä½“ç§¯å…¬å¼çš„å†…åœ¨å…³è”</span><br><span class="line">æ¤æ ‘é—®é¢˜ä¸­å°é—­è·¯çº¿ä¸å¼€æ”¾è·¯çº¿çš„å·®å¼‚å¤„ç†</span><br><span class="line">å¯èƒ½æ€§å¤§å°çš„åˆ†æ•°è¡¨ç¤ºæ–¹æ³•</span><br><span class="line">è¡Œç¨‹é—®é¢˜ä¸­çš„è¿½åŠæ—¶é—´è®¡ç®—æ¨¡å‹</span><br><span class="line">ç»„åˆå›¾å½¢é¢ç§¯è®¡ç®—çš„è¡¥å½¢ç­–ç•¥</span><br><span class="line">å¹³å‡æ•°æ¦‚å¿µåœ¨éå‡åˆ†åœºæ™¯ä¸­çš„å®é™…åº”ç”¨</span><br><span class="line">åˆ†æ•°é™¤æ³•ä¸­çš„å€’æ•°æ³•ç®—ç†é˜é‡Š</span><br><span class="line">åœ†é”¥ä½“ç§¯ä¸ç­‰åº•ç­‰é«˜åœ†æŸ±çš„ä½“ç§¯å…³ç³»éªŒè¯</span><br><span class="line">å·¥ç¨‹é—®é¢˜ä¸­çš„å·¥ä½œæ•ˆç‡é‡åŒ–è¡¨ç¤º</span><br><span class="line">æ•°å­—ç¼–ç è§„å¾‹çš„å®é™…åº”ç”¨è§£æ</span><br><span class="line">æ­£åæ¯”ä¾‹å…³ç³»çš„å›¾è±¡ç‰¹å¾å¯¹æ¯”</span><br><span class="line">ç»Ÿè®¡å›¾ä¸­å¼‚å¸¸æ•°æ®çš„è¯†åˆ«ä¸å¤„ç†</span><br><span class="line">å¤æ‚ç«‹ä½“å›¾å½¢çš„ä¸‰è§†å›¾è¿˜åŸæŠ€å·§</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯å¤§æ¨¡å‹æŒ‰ç…§æˆ‘ä»¬äº‹å…ˆå‡†å¤‡å¥½çš„Promptè¾“å‡ºçš„å…³äºéœ€è¦è€ƒçš„çŸ¥è¯†ç‚¹ï¼Œæ•ˆæœå¹¶ä¸å¥½ã€‚</p><h3 id="æŒ‰ç…§å•å…ƒåˆ†ç±»"><a href="#æŒ‰ç…§å•å…ƒåˆ†ç±»" class="headerlink" title="æŒ‰ç…§å•å…ƒåˆ†ç±»"></a>æŒ‰ç…§å•å…ƒåˆ†ç±»</h3><h4 id="Promptç¤ºä¾‹"><a href="#Promptç¤ºä¾‹" class="headerlink" title="Promptç¤ºä¾‹"></a>Promptç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">è§’è‰²ï¼šæ•°å­¦æ•™æçŸ¥è¯†æ¶æ„å¸ˆï¼Œæ“…é•¿ä»å›½å®¶å®¡å®šæ•™æä¸­æå–ç»“æ„åŒ–çŸ¥è¯†ä½“ç³»</span><br><span class="line"></span><br><span class="line">## **è¦æ±‚**  </span><br><span class="line"></span><br><span class="line">**çŸ¥è¯†ç‚¹æå–**  </span><br><span class="line">   - æå– **å¹´çº§ï¼š$&#123;grade&#125;**ã€**å­¦æœŸï¼š$&#123;volume&#125;**ã€**å•å…ƒï¼š$&#123;unit&#125;**ã€**å­¦ç§‘ï¼š$&#123;subject&#125;** ã€**å•å…ƒåç§°ï¼š$&#123;unit_name&#125;**æ¶‰åŠçš„ **æ‰€æœ‰æ ¸å¿ƒæ•°å­¦çŸ¥è¯†ç‚¹**ï¼Œä¸å¯é—æ¼ï¼Œä¹Ÿä¸é¢å¤–æ‰©å±•æ— å…³å†…å®¹ã€‚  </span><br><span class="line">   - ä»…åŒ…å« **æ•°å­¦æ•™æä¸­çš„å¿…è¦çŸ¥è¯†ç‚¹**ï¼Œä¸æ·»åŠ é¢å¤–è§£é‡Šæˆ–èƒŒæ™¯ä¿¡æ¯ã€‚  </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">è¾“å…¥è§„èŒƒï¼š</span><br><span class="line">1. è¾“å…¥å‚æ•°ï¼š</span><br><span class="line">   - å¹´çº§ï¼š$&#123;grade&#125;ï¼ˆæ•°å­—æ ¼å¼ï¼Œå¦‚&quot;3&quot;ä»£è¡¨ä¸‰å¹´çº§ï¼‰</span><br><span class="line">   - å­¦æœŸï¼š$&#123;volume&#125;ï¼ˆä¸¥æ ¼é™å®šä¸º&quot;1&quot;æˆ–&quot;2&quot;ï¼Œ1-è¡¨ç¤ºä¸Šå†Œï¼Œ2-ä¸‹å†Œï¼‰</span><br><span class="line">   - å•å…ƒï¼š$&#123;unit&#125;ï¼ˆçº¯æ•°å­—ï¼Œå¦‚&quot;2&quot;ä»£è¡¨ç¬¬äºŒå•å…ƒï¼‰</span><br><span class="line">   - å­¦ç§‘ï¼š$&#123;subject&#125;ï¼ˆçº¯æ•°å­—ï¼Œå¦‚&quot;2&quot;ä»£è¡¨ç¬¬äºŒå•å…ƒï¼‰</span><br><span class="line">   - å•å…ƒåç§°ï¼š $&#123;unit_name&#125;ï¼ˆä¸¥æ ¼æŒ‰ç…§æˆ‘ç»™çš„åç§°å¡«å…¥ï¼‰</span><br><span class="line"></span><br><span class="line">è¾“å‡ºè¦æ±‚ï¼š</span><br><span class="line">1. æ•°æ®ç»“æ„ï¼š</span><br><span class="line">&#123;</span><br><span class="line">  &quot;metadata&quot;: &#123;</span><br><span class="line">    &quot;grade&quot;: &quot;æ•°å­—å­—ç¬¦ä¸²ï¼ˆ1-9æˆ–ä»¥ä¸Šï¼‰&quot;,</span><br><span class="line">    &quot;volume&quot;: &quot;æšä¸¾å€¼ï¼ˆ1-ä¸Šå†Œ/2-ä¸‹å†Œï¼‰&quot;,</span><br><span class="line">    &quot;subject&quot;: &quot;å­¦ç§‘&quot;,</span><br><span class="line">    &quot;unit&quot;: &quot;æ•°å­—å­—ç¬¦ä¸²ï¼ˆ1-10æˆ–ä»¥ä¸Šï¼‰&quot;,</span><br><span class="line">    &quot;unit_name&quot;: &quot;$&#123;unit_name&#125;&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;knowledge_points&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;æ•™æç›®å½•ä¸­çš„æ ‡å‡†çŸ¥è¯†ç‚¹åç§°&quot;,</span><br><span class="line">      &quot;description&quot;: &quot;195-205å­—çš„ç²¾å‡†æè¿°ï¼Œç»“æ„ï¼šâ‘ ä¸¥æ ¼å®šä¹‰ â‘¡æ ¸å¿ƒå…¬å¼ï¼ˆLaTeXæ ¼å¼ï¼‰â‘¢2ä¸ªåº”ç”¨åœºæ™¯&quot;,</span><br><span class="line">      &quot;example&quot;: [&#123;</span><br><span class="line">        &quot;question&quot;: &quot;å…¸å‹ä¾‹é¢˜ï¼ˆå«å¿…è¦æ•°å­¦ç¬¦å·ï¼Œä½¿ç”¨$\sqrt&#123;&#125;$ç­‰LaTeXæ ¼å¼ï¼‰&quot;,</span><br><span class="line">        &quot;solution&quot;: &quot;åˆ†æ­¥éª¤è§£æï¼ˆè‡³å°‘3æ­¥ï¼Œå«å…³é”®æ¨å¯¼æ­¥éª¤ï¼‰&quot;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2. è´¨é‡ç®¡æ§ï¼š</span><br><span class="line">â–¶ çŸ¥è¯†ç‚¹æå–ï¼š</span><br><span class="line">- å¿…é¡»å¯¹ç…§æ•™è‚²éƒ¨å®¡å®šæ•™æç›®å½•</span><br><span class="line">- æ¯ä¸ªå•å…ƒè¦ç»™å‡ºæ‰€æœ‰çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹</span><br><span class="line">- æ’é™¤æ‹“å±•æ€§å†…å®¹å’Œè·¨å•å…ƒçŸ¥è¯†</span><br><span class="line">- è¯·ä¸è¦è¾“å‡ºå…¶å®ƒæ— å…³çš„å†…å®¹</span><br><span class="line">- è¾“å‡ºçš„å¼€å¤´è¯·ä¸è¦å«æœ‰å…¶å®ƒæ— å…³å­—ç¬¦ï¼Œæˆ‘ä¼šå¯¹ä½ çš„è¿”å›ç›´æ¥è½¬æˆå­—å…¸ï¼Œè¯·å‹¿å«æœ‰ï¼ˆ```jsonï¼‰å¼€å¤´ï¼Œç‰¹åˆ«æ³¨æ„</span><br><span class="line"></span><br><span class="line">â–¶ ä¾‹é¢˜è§„èŒƒï¼š</span><br><span class="line">- æ¯ä¸ªçŸ¥è¯†ç‚¹é…å¤‡1ä¸»2è¾…å…±3é“ä¾‹é¢˜</span><br><span class="line">- ä¸»ä¾‹é¢˜ä½¿ç”¨æ•™æåŸé¢˜ï¼ˆæ ‡æ³¨æ¥æºé¡µç ï¼‰</span><br><span class="line">- è¾…ä¾‹é¢˜éœ€åŒºåˆ†é¢˜å‹ï¼ˆè®¡ç®—/è¯æ˜/åº”ç”¨ï¼‰</span><br><span class="line">- é¿å…å‡ºç°é‡å¤é¢˜å‹</span><br><span class="line"></span><br><span class="line">3. æ ¡éªŒæœºåˆ¶ï¼š</span><br><span class="line">â‘  å­—æ®µéªŒè¯ï¼šè‡ªåŠ¨æ£€æµ‹æ•°å€¼èŒƒå›´ï¼ˆå¦‚gradeâˆˆ[1-9]ï¼‰</span><br><span class="line">â‘¡ ç»“æ„å®¡æŸ¥ï¼šç¡®ä¿æ— å¤šä½™å­—æ®µå’ŒåµŒå¥—å±‚çº§</span><br><span class="line">â‘¢ å†…å®¹å®¡æŸ¥ï¼šçŸ¥è¯†ç‚¹åç§°ä¸æ•™æç›®å½•100%åŒ¹é…</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹è¾“å‡ºï¼š</span><br><span class="line">&#123;</span><br><span class="line">  &quot;metadata&quot;: &#123;</span><br><span class="line">    &quot;grade&quot;: &quot;5&quot;,</span><br><span class="line">    &quot;volume&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;subject&quot;: &quot;æ•°å­¦&quot;,</span><br><span class="line">    &quot;unit&quot;: &quot;3&quot;,</span><br><span class="line">    &quot;unit_name&quot;: &quot;$&#123;unit_name&#125;&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;knowledge_points&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;åˆ†æ•°ä¹˜æ³•è¿ç®—&quot;,</span><br><span class="line">      &quot;description&quot;: &quot;åˆ†æ•°ä¹˜æ³•æŒ‡å°†ä¸¤ä¸ªåˆ†æ•°ç›¸ä¹˜çš„è¿ç®—ï¼Œå®šä¹‰å¼ä¸º$\frac&#123;a&#125;&#123;b&#125; \times \frac&#123;c&#125;&#123;d&#125; = \frac&#123;ac&#125;&#123;bd&#125;$ã€‚æ ¸å¿ƒæ­¥éª¤åŒ…å«ï¼š1.åˆ†å­ç›¸ä¹˜ä½œç§¯çš„åˆ†å­ 2.åˆ†æ¯ç›¸ä¹˜ä½œç§¯çš„åˆ†æ¯ 3.çº¦åˆ†åŒ–ç®€ã€‚åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼šâ‘ é£Ÿè°±ææ–™æ¯”ä¾‹è®¡ç®— â‘¡è¿åŠ¨è€—æ—¶çš„å€æ•°å…³ç³»è®¡ç®—ã€‚&quot;,</span><br><span class="line">      &quot;example&quot;: [&#123;</span><br><span class="line">        &quot;question&quot;: &quot;è®¡ç®—$\frac&#123;3&#125;&#123;4&#125; \times \frac&#123;2&#125;&#123;5&#125;$ï¼Œå¹¶åŒ–ç®€ç»“æœï¼ˆäººæ•™ç‰ˆP62ä¾‹2ï¼‰&quot;,</span><br><span class="line">        &quot;solution&quot;: [&quot;åˆ†å­ç›¸ä¹˜ï¼š3Ã—2=6&quot;,&quot;åˆ†æ¯ç›¸ä¹˜ï¼š4Ã—5=20&quot;,&quot;çº¦åˆ†ï¼š6/20=3/10&quot;]</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤§æ¨¡å‹ç”Ÿæˆç¤ºä¾‹"><a href="#å¤§æ¨¡å‹ç”Ÿæˆç¤ºä¾‹" class="headerlink" title="å¤§æ¨¡å‹ç”Ÿæˆç¤ºä¾‹"></a>å¤§æ¨¡å‹ç”Ÿæˆç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;metadata&quot;: &#123;</span><br><span class="line">    &quot;grade&quot;: &quot;å››å¹´çº§&quot;,</span><br><span class="line">    &quot;semester&quot;: &quot;ä¸Šå†Œ&quot;,</span><br><span class="line">    &quot;subject&quot;: &quot;æ•°å­¦&quot;,</span><br><span class="line">    &quot;unit&quot;: &quot;ç¬¬ä¸€å•å…ƒ å¤§æ•°çš„è®¤è¯†&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;knowledge_points&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;æ•°ä½ä¸è®¡æ•°å•ä½&quot;,</span><br><span class="line">      &quot;description&quot;: &quot;åŒ…å«ä¸ªçº§ã€ä¸‡çº§ã€äº¿çº§ä¸‰ä¸ªæ•°çº§ä½“ç³»ï¼Œæ¯ä¸ªæ•°çº§åŒ…å«å››ä¸ªæ•°ä½ã€‚è®¡æ•°å•ä½ä»ä¸ªã€åã€ç™¾ã€åƒåˆ°ä¸‡ã€åä¸‡ã€ç™¾ä¸‡ã€åƒä¸‡ï¼Œæ¯ç›¸é‚»ä¸¤ä¸ªè®¡æ•°å•ä½ä¹‹é—´çš„è¿›ç‡æ˜¯10ï¼Œæ„æˆåè¿›åˆ¶è®¡æ•°æ³•ã€‚æ•°ä½åç§°åœ¨è®¡æ•°å•ä½ååŠ ã€ä½ã€å­—ï¼Œå¦‚ä¸‡ä½ã€äº¿ä½ç­‰[1,2,5](@ref)ã€‚&quot;,</span><br><span class="line">      &quot;example&quot;: &#123;</span><br><span class="line">        &quot;question&quot;: &quot;å†™å‡ºã€3ä¸ªç™¾ä¸‡ã€4ä¸ªåä¸‡ã€2ä¸ªä¸‡ã€ç»„æˆçš„æ•°&quot;,</span><br><span class="line">        &quot;solution&quot;: &quot;æŒ‰æ•°çº§å¡«å†™ï¼šç™¾ä¸‡ä½å†™3ï¼Œåä¸‡ä½å†™4ï¼Œä¸‡ä½å†™2ï¼Œå…¶ä½™è¡¥é›¶â†’3420000&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;å¤§æ•°çš„è¯»å†™æ–¹æ³•&quot;,</span><br><span class="line">      &quot;description&quot;: &quot;åˆ†çº§è¯»å†™åŸåˆ™ï¼šâ‘ ä»é«˜ä½èµ·æ¯å››ä½åˆ†çº§ â‘¡å…ˆè¯»äº¿çº§åŠ ã€äº¿ã€å­—ï¼Œå†è¯»ä¸‡çº§åŠ ã€ä¸‡ã€å­— â‘¢å„çº§æœ«å°¾0ä¸è¯»ï¼Œä¸­é—´è¿ç»­0åªè¯»ä¸€æ¬¡ã€‚å†™æ•°æ—¶éœ€è¡¥è¶³å„æ•°çº§çš„å››ä½[1,3,5](@ref)ã€‚&quot;,</span><br><span class="line">      &quot;example&quot;: &#123;</span><br><span class="line">        &quot;question&quot;: &quot;è¯»å‡º300406700&quot;,</span><br><span class="line">        &quot;solution&quot;: &quot;åˆ†çº§â†’3|0040|6700â†’ä¸‰äº¿é›¶å››åä¸‡å…­åƒä¸ƒç™¾&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;æ•°çš„å¤§å°æ¯”è¾ƒ&quot;,</span><br><span class="line">      &quot;description&quot;: &quot;åˆ†ä¸¤æ­¥ï¼šâ‘ ä½æ•°ä¸åŒæ—¶ä½æ•°å¤šè€…å¤§ â‘¡ä½æ•°ç›¸åŒæ—¶ä»æœ€é«˜ä½é€ä½æ¯”è¾ƒã€‚éœ€ç‰¹åˆ«æ³¨æ„å¸¦å¤šçº§0çš„æ•°å€¼æ¯”è¾ƒï¼Œå¦‚1000000ä¸999999çš„æ¯”è¾ƒ[1,3,6](@ref)ã€‚&quot;,</span><br><span class="line">      &quot;example&quot;: &#123;</span><br><span class="line">        &quot;question&quot;: &quot;æ¯”è¾ƒ3560000ä¸3549999&quot;,</span><br><span class="line">        &quot;solution&quot;: &quot;ä½æ•°ç›¸åŒâ†’ç™¾ä¸‡ä½3=3â†’åä¸‡ä½5=5â†’ä¸‡ä½6&gt;4â†’3560000æ›´å¤§&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;æ•°çš„æ”¹å†™ä¸è¿‘ä¼¼&quot;,</span><br><span class="line">      &quot;description&quot;: &quot;æ•´ä¸‡/æ•´äº¿æ•°æ”¹å†™ä½œã€ä¸‡ã€ã€äº¿ã€å•ä½éœ€å»æ‰æœ«å°¾4/8ä¸ª0ååŠ å•ä½è¯ã€‚éæ•´ä¸‡/äº¿æ•°ç”¨å››èˆäº”å…¥æ³•æ±‚è¿‘ä¼¼å€¼æ—¶ï¼Œéœ€æ ¹æ®åƒä½/åƒä¸‡ä½æ•°å€¼åˆ¤æ–­è¿›ä½ï¼Œå¦‚çœç•¥ä¸‡ä½åå°¾æ•°æ—¶çœ‹åƒä½[1,3,5](@ref)ã€‚&quot;,</span><br><span class="line">      &quot;example&quot;: &#123;</span><br><span class="line">        &quot;question&quot;: &quot;å°†37845921æ”¹å†™æˆä¸‡ä½œå•ä½çš„è¿‘ä¼¼æ•°&quot;,</span><br><span class="line">        &quot;solution&quot;: &quot;åƒä½æ˜¯4â†’èˆå»â†’3784ä¸‡&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;æ•°ä½é¡ºåºè¡¨åº”ç”¨&quot;,</span><br><span class="line">      &quot;description&quot;: &quot;åŒ…å«æ•°çº§ã€æ•°ä½ã€è®¡æ•°å•ä½ä¸‰è¦ç´ çš„è¡¨æ ¼å·¥å…·ã€‚èƒ½å‡†ç¡®å®šä½æ•°å­—æ‰€åœ¨æ•°ä½çš„åç§°åŠå¯¹åº”è®¡æ•°å•ä½ï¼Œä¾‹å¦‚æ•°å­—5åœ¨ç™¾ä¸‡ä½è¡¨ç¤º5ä¸ªç™¾ä¸‡[2,5,8](@ref)ã€‚&quot;,</span><br><span class="line">      &quot;example&quot;: &#123;</span><br><span class="line">        &quot;question&quot;: &quot;ç¡®å®šæ•°å­—789456123ä¸­ã€8ã€æ‰€åœ¨çš„æ•°ä½&quot;,</span><br><span class="line">        &quot;solution&quot;: &quot;åˆ†çº§â†’7|8945|6123â†’åƒä¸‡ä½&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¾“å‡ºé•¿åº¦è¶…è¿‡æ¨¡å‹æœ€å¤§è¾“å‡ºé•¿åº¦"><a href="#è¾“å‡ºé•¿åº¦è¶…è¿‡æ¨¡å‹æœ€å¤§è¾“å‡ºé•¿åº¦" class="headerlink" title="è¾“å‡ºé•¿åº¦è¶…è¿‡æ¨¡å‹æœ€å¤§è¾“å‡ºé•¿åº¦"></a>è¾“å‡ºé•¿åº¦è¶…è¿‡æ¨¡å‹æœ€å¤§è¾“å‡ºé•¿åº¦</h4><p>é‡‡ç”¨å¤šè½®å¯¹è¯+æµå¼ä¼ è¾“æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> otherï¼Œé¡¹ç›® </tag>
            
            <tag> æ™ºå·äº‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-45 Dubbo</title>
      <link href="/2025/03/28/75-45%20Dubbo/"/>
      <url>/2025/03/28/75-45%20Dubbo/</url>
      
        <content type="html"><![CDATA[<h1 id="75-45-Dubbo"><a href="#75-45-Dubbo" class="headerlink" title="75-45 Dubbo"></a>75-45 Dubbo</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Apache Dubboæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„Java RPCæ¡†æ¶ã€‚å…¶å‰èº«æ˜¯é˜¿é‡Œå·´å·´å…¬å¸å¼€æºçš„ä¸€ä¸ªé«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æºJava RPCæ¡†æ¶ï¼Œå¯ä»¥å’ŒSpringæ¡†æ¶æ— ç¼é›†æˆã€‚</p><p>å…¶æ˜¯RPCçš„å…¶ä¸­ä¸€ç§å®ç°æ–¹å¼ï¼Œä¸”æ˜¯åŸºäºJavaè¿›è¡Œå®ç°çš„æ¡†æ¶ï¼Œå…¶éœ€è¦åœ¨Javaç¨‹åºä¸­å¦‚æœå…¶ä¸­ä¸€ä¸ªåº”ç”¨Aéœ€è¦è°ƒç”¨åº”ç”¨Bå…¶ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬åˆ™éœ€è¦çŸ¥é“ç›®æ ‡Bçš„IPåœ°å€åŠ ç«¯å£å·ä¸”éœ€è¦çŸ¥é“å…¶è¯·æ±‚è·¯å¾„ç­‰ç›¸å…³ä¿¡æ¯æ¥è¿›è¡Œè¯·æ±‚ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ç¡¬ç¼–ç IPåœ°å€ç­‰ç›¸å…³ä¿¡æ¯ï¼Œå¦‚æœç›®æ ‡Bçš„éƒ¨ç½²ç«¯å‘ç”Ÿæ”¹å˜ï¼Œå…¶å°±è¦é‡æ–°ç¼–è¯‘ä»£ç åé‡æ–°è¿è¡Œï¼Œè¿™å¹¶ä¸èƒ½æ”¯æŒåŠ¨æ€æ›¿æ¢ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œå°±æå‡ºäº†RPCï¼Œè¿™æ˜¯ä¸€ä¸ªåè®®ï¼ŒæŒ‰ç…§æˆ‘ä»¬éƒ½éµå®ˆçš„åè®®ï¼Œå°±æå‡ºäº†Dubboï¼ŒDubboä¼šå¸®æˆ‘å®Œæˆè¿™äº›äº‹æƒ…ï¼Œæˆ‘ä»¬è°ƒç”¨è¿œç¨‹æ–¹æ³•å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚</p><p>ä¸‹é¢æ¥è¯¦ç»†çš„äº†è§£ä¸€ä¸‹Dubboã€‚</p><h2 id="Dubboæ¶æ„"><a href="#Dubboæ¶æ„" class="headerlink" title="Dubboæ¶æ„"></a>Dubboæ¶æ„</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503281213790.png" alt="img"></p><p>åœ¨è¿™é‡Œç®€å•çš„ä»‹ç»ä¸€ä¸‹åœ¨è¿™ä¸ªç»“æ„å›¾ä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼š</p><ol><li><strong>Providerï¼ˆæœåŠ¡æä¾›æ–¹ï¼‰</strong>ï¼šæš´éœ²æœåŠ¡æ¥å£å®ç°ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªèº«æœåŠ¡ã€‚</li><li><strong>Consumerï¼ˆæœåŠ¡æ¶ˆè´¹æ–¹ï¼‰</strong>ï¼šä»æ³¨å†Œä¸­å¿ƒè®¢é˜…æœåŠ¡ï¼Œè·å– Provider åœ°å€åˆ—è¡¨ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†å‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œæ”¯æŒè½¯è´Ÿè½½å‡è¡¡å’Œå®¹é”™ã€‚</li><li><strong>Registryï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰</strong>ï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°çš„åè°ƒè€…ï¼Œå¸¸è§å®ç°ï¼šZooKeeperã€Nacosã€Consulã€Redisï¼Œæä¾›æœåŠ¡çš„å¥åº·æ£€æŸ¥å’ŒæœåŠ¡å˜æ›´é€šçŸ¥ã€‚</li><li><strong>Monitorï¼ˆç›‘æ§ä¸­å¿ƒï¼‰</strong>ï¼šæ”¶é›†æœåŠ¡è°ƒç”¨æ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œæ”¯æŒé—®é¢˜æ’æŸ¥å’Œç³»ç»Ÿä¼˜åŒ–ã€‚</li></ol><p>æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š<strong>Provideræ³¨å†ŒæœåŠ¡</strong> â†’ 2. <strong>Consumerè®¢é˜…æœåŠ¡</strong> â†’ 3. <strong>æ³¨å†Œä¸­å¿ƒåè°ƒåœ°å€</strong> â†’ 4. <strong>Consumerå‘èµ·è°ƒç”¨</strong> â†’ 5. <strong>è´Ÿè½½å‡è¡¡ä¸ç½‘ç»œé€šä¿¡</strong> â†’ 6. <strong>Provideræ‰§è¡Œå¹¶è¿”å›</strong> â†’ 7. <strong>ç›‘æ§ä¸åŠ¨æ€æ²»ç†</strong>ã€‚</p><h3 id="æœåŠ¡æš´éœ²"><a href="#æœåŠ¡æš´éœ²" class="headerlink" title="æœåŠ¡æš´éœ²"></a>æœåŠ¡æš´éœ²</h3><p>1. </p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/weixin_44126152/article/details/108615091">Dubboæ˜¯ä»€ä¹ˆï¼ŸDubboå¹²ä»€ä¹ˆï¼ŸDubboæ€ä¹ˆç”¨ï¼Ÿ</a></li><li><a href="https://cn.dubbo.apache.org/zh-cn/docs/concepts/service-discovery/">Dubboå®˜æ–¹æ–‡æ¡£</a></li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> RPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RPC </tag>
            
            <tag> Dubbo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-44 åˆ†å¸ƒå¼é”è¶…æ—¶é—®é¢˜</title>
      <link href="/2025/03/27/75-44%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"/>
      <url>/2025/03/27/75-44%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="75-44-åˆ†å¸ƒå¼é”è¶…æ—¶é—®é¢˜"><a href="#75-44-åˆ†å¸ƒå¼é”è¶…æ—¶é—®é¢˜" class="headerlink" title="75-44 åˆ†å¸ƒå¼é”è¶…æ—¶é—®é¢˜"></a>75-44 åˆ†å¸ƒå¼é”è¶…æ—¶é—®é¢˜</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…³äºRedisåˆ†å¸ƒå¼é”ï¼Œå¯èƒ½å°±ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼ŒAçº¿ç¨‹è·å–åˆ°äº†ä¸€ä¸ªé”ï¼Œå¹¶æŠŠè¿™ä¸ªé”è®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œä¸ºäº†é¿å…æ­»é”çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å¯¹åº”çš„ä¸šåŠ¡å¤„ç†è€—æ—¶æ˜¯ä¸å®šçš„ï¼Œæ‰€ä»¥å¯èƒ½è¿™æ¬¡çš„è€—æ—¶æ¯”è¶…æ—¶æ—¶é—´é•¿ï¼Œå¯¼è‡´é”è¶…æ—¶è‡ªåŠ¨é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™Bçº¿ç¨‹åŒæ ·æ¥è·å–è¿™ä¸ªé”ï¼Œç»“æœå°±æ˜¯å¯ä»¥è·å–åˆ°è¿™ä¸ªé”ï¼Œæ‰€ä»¥å°±ä¼šå‡ºç°é—®é¢˜ã€‚</p><p><strong>å¸ƒå¼é”æœ€åŸºæœ¬çš„æ€§è´¨ç›¸è¿èƒŒ: åœ¨ä»»æ„ä¸€ä¸ªæ—¶åˆ», åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯æŒæœ‰é”, å³ç‹¬äº«</strong></p><h2 id="ä½¿ç”¨Redissonæ¥è§£å†³é”è¶…æ—¶çš„é—®é¢˜"><a href="#ä½¿ç”¨Redissonæ¥è§£å†³é”è¶…æ—¶çš„é—®é¢˜" class="headerlink" title="ä½¿ç”¨Redissonæ¥è§£å†³é”è¶…æ—¶çš„é—®é¢˜"></a>ä½¿ç”¨Redissonæ¥è§£å†³é”è¶…æ—¶çš„é—®é¢˜</h2><p>é‚£ä¹ˆä¹…æœ‰ä¸€ä¸ªç–‘é—®äº†ï¼ŒRedissonæ˜¯å¦‚ä½•å¯¹é”è¶…æ—¶é—®é¢˜è¿›è¡Œè§£å†³çš„å‘¢ï¼Ÿé‚£ä¹ˆè¿™é‡Œå°±æ¶‰åŠåˆ°Redissonä¸­æå‡ºçš„çœ‹é—¨ç‹—æœºåˆ¶äº†ã€‚</p><p>ä¸€å›¾è§</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503272037580.jpeg" alt="img"></p><p>Redisson é”çš„åŠ é”æœºåˆ¶å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œçº¿ç¨‹å»è·å–é”ï¼Œè·å–æˆåŠŸåˆ™æ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚å¦‚æœè·å–å¤±è´¥: ä¸€ç›´é€šè¿‡whileå¾ªç¯å°è¯•è·å–é”(å¯è‡ªå®šä¹‰ç­‰å¾…æ—¶é—´ï¼Œè¶…æ—¶åè¿”å›å¤±è´¥)ï¼Œè·å–æˆåŠŸåï¼Œæ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚Redissonæä¾›çš„åˆ†å¸ƒå¼é”æ˜¯æ”¯æŒé”è‡ªåŠ¨ç»­æœŸçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœçº¿ç¨‹ä»æ—§æ²¡æœ‰æ‰§è¡Œå®Œï¼Œé‚£ä¹ˆredissonä¼šè‡ªåŠ¨ç»™redisä¸­çš„ç›®æ ‡keyå»¶é•¿è¶…æ—¶æ—¶é—´ï¼Œè¿™åœ¨Redissonä¸­ç§°ä¹‹ä¸º Watch Dog æœºåˆ¶ã€‚</p><p>çœ‹ä¼¼åä¸ºçœ‹é—¨ç‹—ï¼Œçœ‹èµ·æ¥å¾ˆéš¾ç†è§£ï¼Œä½†æ˜¯èƒŒåçš„é€»è¾‘æ˜¯å¾ˆç®€å•çš„ã€‚æˆ‘ä»¬ç»™ä¸€ä¸ªçº¿ç¨‹åˆ†å‘äº†é”ï¼Œå¹¶è®¾ç½®äº†è¶…æ—¶æ—¶é—´å—ï¼Œä½†æ˜¯è¿™æ—¶é—´å†…çº¿ç¨‹å¤„ç†ä¸å®Œï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿå†å»¶é•¿è¶…æ—¶æ—¶é—´å˜›ã€‚é‚£è°æ¥å»¶é•¿å‘¢ï¼Ÿèµ·ä¸€ä¸ªçº¿ç¨‹ä¸€è‡´è½®è¯¢æŸ¥çœ‹æ˜¯å¦å¤„ç†å®Œäº†ï¼Œå¦‚æœæ²¡æœ‰å¤„ç†å®Œå°±å»¶é•¿æ—¶é—´å³å¯ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://zhuanlan.zhihu.com/p/148609581">ã€110æœŸã€‘é¢è¯•å®˜ï¼šRedisåˆ†å¸ƒå¼é”å¦‚ä½•è§£å†³é”è¶…æ—¶é—®é¢˜ï¼Ÿ</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> åˆ†å¸ƒå¼é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-43 è¶…å–é—®é¢˜</title>
      <link href="/2025/03/27/75-43%20%E8%B6%85%E5%8D%96%E9%97%AE%E9%A2%98/"/>
      <url>/2025/03/27/75-43%20%E8%B6%85%E5%8D%96%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="75-43-è¶…å–é—®é¢˜"><a href="#75-43-è¶…å–é—®é¢˜" class="headerlink" title="75-43 è¶…å–é—®é¢˜"></a>75-43 è¶…å–é—®é¢˜</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…ˆæ¥å°±åº“å­˜è¶…å–çš„é—®é¢˜ä½œæè¿°ï¼šä¸€èˆ¬ç”µå­å•†åŠ¡ç½‘ç«™éƒ½ä¼šé‡åˆ°å¦‚å›¢è´­ã€ç§’æ€ã€ç‰¹ä»·ä¹‹ç±»çš„æ´»åŠ¨ï¼Œè€Œè¿™æ ·çš„æ´»åŠ¨æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹å°±æ˜¯è®¿é—®é‡æ¿€å¢ã€ä¸Šåƒç”šè‡³ä¸Šä¸‡äººæŠ¢è´­ä¸€ä¸ªå•†å“ã€‚ç„¶è€Œï¼Œä½œä¸ºæ´»åŠ¨å•†å“ï¼Œåº“å­˜è‚¯å®šæ˜¯å¾ˆæœ‰é™çš„ï¼Œå¦‚ä½•æ§åˆ¶åº“å­˜ä¸è®©å‡ºç°è¶…ä¹°ï¼Œä»¥é˜²æ­¢é€ æˆä¸å¿…è¦çš„æŸå¤±æ˜¯ä¼—å¤šç”µå­å•†åŠ¡ç½‘ç«™ç¨‹åºå‘˜å¤´ç–¼çš„é—®é¢˜ï¼Œè¿™åŒæ—¶ä¹Ÿæ˜¯æœ€åŸºæœ¬çš„é—®é¢˜ã€‚</p><p>åœ¨ç§’æ€ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œè¶…å–æ˜¯ä¸€ä¸ªç»å…¸ã€å¸¸è§çš„é—®é¢˜ï¼Œä»»ä½•å•†å“éƒ½ä¼šæœ‰æ•°é‡ä¸Šé™ï¼Œå¦‚ä½•é¿å…æˆåŠŸä¸‹è®¢å•ä¹°åˆ°å•†å“çš„äººæ•°ä¸è¶…è¿‡å•†å“æ•°é‡çš„ä¸Šé™ï¼Œè¿™æ˜¯æ¯ä¸ªæŠ¢è´­æ´»åŠ¨éƒ½è¦é¢ä¸´çš„éš¾ç‚¹ã€‚</p><p>æ ¸å¿ƒç›®æ ‡ï¼šä¿è¯è®¢å•æ•°ä¸è¶…è¿‡å•†å“æ•°é‡çš„ä¸Šé™ã€‚</p><h2 id="åœºæ™¯ä¸¾ä¾‹"><a href="#åœºæ™¯ä¸¾ä¾‹" class="headerlink" title="åœºæ™¯ä¸¾ä¾‹"></a>åœºæ™¯ä¸¾ä¾‹</h2><p>åœ¨å¤šä¸ªç”¨æˆ·åŒæ—¶å‘èµ·å¯¹åŒä¸€ä¸ªå•†å“çš„ä¸‹å•è¯·æ±‚æ—¶ï¼Œå…ˆæŸ¥è¯¢å•†å“åº“å­˜ï¼Œå†ä¿®æ”¹å•†å“åº“å­˜ï¼Œä¼šå‡ºç°èµ„æºç«äº‰é—®é¢˜ï¼Œå¯¼è‡´åº“å­˜çš„æœ€ç»ˆç»“æœå‡ºç°å¼‚å¸¸ã€‚é—®é¢˜ï¼šå½“å•†å“Aä¸€å…±æœ‰åº“å­˜15ä»¶ï¼Œç”¨æˆ·ç”²å…ˆä¸‹å•10ä»¶ï¼Œç”¨æˆ·ä¹™ä¸‹å•8ä»¶ï¼Œè¿™æ—¶å€™åº“å­˜åªèƒ½æ»¡è¶³ä¸€ä¸ªäººä¸‹å•æˆåŠŸï¼Œå¦‚æœä¸¤ä¸ªäººåŒæ—¶æäº¤ï¼Œå°±å‡ºç°äº†è¶…å–çš„é—®é¢˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503271931295.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å…¶ä¸»è¦é—®é¢˜åœ¨äºï¼šäº‹åŠ¡Aå’ŒBåœ¨å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰é”ä½å½“å‰æ•°æ®ï¼Œå¯¼è‡´ä¸¤ä¸ªäº‹åŠ¡éƒ½è®¤ä¸ºå…¶å†…å­˜éƒ½èƒ½å¤Ÿæ”¯æŒä¸‹å•ã€‚</p><p>é‚£ä¹ˆæ ¹æ®è¿™ç§æƒ…å†µï¼Œè§£å†³æ–¹æ³•å°±æ¯”è¾ƒæ˜æ˜¾äº†ï¼ŒåŠ é”ï¼ŒæŒ‰ç…§ç›®å‰æ•°æ®åº“ä¸­é”çš„ç²’åº¦ï¼Œåˆ†ä¸ºæ‚²è§‚é”å’Œä¹è§‚é”ï¼Œé‚£ä¹ˆåŒºåˆ«å°±åœ¨äºæ˜¯å¦åœ¨ä¸€å¼€å§‹å°±ä¸Šé”ï¼š</p><ol><li>æ‚²è§‚é”ï¼Œåœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œé€šè¿‡Select for updateæ¥è·å¾—æŒ‡å®šæ•°æ®çš„æ’å®ƒé”ï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå…¶å®ƒäº‹åŠ¡éƒ½æ— æ³•è·å¾—è¯¥æ•°æ®çš„æ’å®ƒé”å’Œå…±äº«é”ï¼›</li><li>ä¹è§‚é”ï¼Œé€šè¿‡åŠ ç‰ˆæœ¬å·æ¥è§£å†³ï¼Œåœ¨æ›´æ–°åº“å­˜çš„æ—¶å€™åˆ¤æ–­äº‹åŠ¡å¼€å§‹æŸ¥è¯¢åˆ°çš„ç‰ˆæœ¬å·ä¿¡æ¯æ˜¯å¦å’Œå³å°†æ›´æ–°çš„æ•°æ®çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™æ— æ³•æ›´æ–°ï¼Œæ›´æ–°å¤±è´¥ï¼Œé‡è¯•å³å¯ï¼›</li><li>é€šè¿‡Rediså¯¹ç›®æ ‡åº“å­˜è¿›è¡Œå‡è®¾æ§åˆ¶ï¼Œå› ä¸ºRedisæ˜¯å•çº¿ç¨‹å¤„ç†å‘½ä»¤çš„ï¼Œæ‰€ä»¥å¤©ç„¶çš„ä¿è¯åŸå­æ€§ï¼ˆå•ä¸ªå‘½ä»¤ï¼‰ï¼Œä½¿ç”¨setnxåŠ é”ï¼›</li><li>è¿˜å¯ä»¥é¢„çƒ­ï¼Œéœ€è¦é«˜æ€§èƒ½çš„æƒ…å†µä¸‹ï¼ŒæŠŠåº“å­˜ä¿¡æ¯é¢„å…ˆä¿å­˜åˆ°Redisï¼Œç”±Redisè¿›è¡ŒåŸå­åŒ–çš„æ‰£å‡æ“ä½œï¼Œç„¶åé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥çš„ä¿å­˜åˆ°MySQLä¸­ï¼Œå¦‚æœè®¤ä¸ºåœ¨å¤§åº“å­˜æƒ…å†µä¸‹å…¶æ€§èƒ½é˜»å¡è¿‡äºä¸¥é‡ï¼Œå¯ä»¥æŠŠè¿™ä¸ªå¤§åº“å­˜åˆ†ä¸ºå‡ ä¸ªæ¡¶ï¼Œåˆ†æ²»çš„æ€æƒ³æ¥è§£å†³å…¶ç›®å‰å­˜åœ¨çš„é—®é¢˜ï¼›</li></ol><p>é™¤å»ä¸Šé”ï¼Œè¿˜æœ‰ä¸€ç§ç›®å‰æ¯”è¾ƒä¼˜çš„è§£å†³æ–¹æ¡ˆï¼šåˆ†é˜¶æ®µæ’é˜Ÿä¸‹å•æ–¹æ¡ˆã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/crazymakercircle/article/details/120521674#:~:text=%E6%9C%AC%E6%96%87%E4%BB%8B%E7%BB%8D%E4%BA%86%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E4%B8%AD%EE%80%80%E8%B6%85%E5%8D%96%E9%97%AE%E9%A2%98%EE%80%81%E7%9A%84%E5%8E%9F%E5%9B%A0%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%92%8C%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%BD%B1%E5%93%8D%E3%80%82%E6%96%87%E7%AB%A0%E7%94%A8%E5%9B%BE%E8%A7%A3%E3%80%81%E7%A7%92%E6%87%82%E5%92%8C%E5%8F%B2%E4%B8%8A%E6%9C%80%E5%85%A8%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%8C%E5%B8%AE%E5%8A%A9%E8%AF%BB%E8%80%85%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E7%A7%92%E6%9D%80%E8%B6%85%E5%8D%96%E9%97%AE%E9%A2%98%E7%9A%84%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91%E5%92%8C%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82%E3%80%82">ç§’æ€ï¼šè¶…å–é—®é¢˜ï¼ˆå›¾è§£+ç§’æ‡‚+å²ä¸Šæœ€å…¨ï¼‰</a></li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> åœºæ™¯é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åœºæ™¯é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-42 RPC</title>
      <link href="/2025/03/27/75-42%20RPC/"/>
      <url>/2025/03/27/75-42%20RPC/</url>
      
        <content type="html"><![CDATA[<h1 id="75-42-RPC"><a href="#75-42-RPC" class="headerlink" title="75-42 RPC"></a>75-42 RPC</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>RPCï¼ˆRemote Procedure Call Protocolï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®ã€‚ä¸€ä¸ªé€šä¿—çš„æè¿°æ˜¯ï¼šå®¢æˆ·ç«¯åœ¨ä¸çŸ¥é“è°ƒç”¨ç»†èŠ‚çš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨å­˜åœ¨äºè¿œç¨‹è®¡ç®—æœºä¸Šçš„æŸä¸ªå¯¹è±¡ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ä¸€æ ·ã€‚</p><p>æ¯”è¾ƒæ­£å¼çš„æè¿°æ˜¯ï¼š<strong>ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503272133222.png" alt="img"></p><h2 id="RPCçš„è°ƒç”¨æµç¨‹"><a href="#RPCçš„è°ƒç”¨æµç¨‹" class="headerlink" title="RPCçš„è°ƒç”¨æµç¨‹"></a>RPCçš„è°ƒç”¨æµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503272139652.png" alt="img"></p><p>è°ƒç”¨è¿œç¨‹æ–¹æ³•å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·æ–¹ä¾¿ï¼ŒRPCåè®®å¸®æˆ‘å°è£…å¥½äº†åº•å±‚çš„é€»è¾‘ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¿«é€Ÿçš„ä½¿ç”¨ã€‚</p><h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><p>ä¸€æ—¦ç¡®å®šäº†æ¶ˆæ¯çš„æ•°æ®ç»“æ„åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¦è€ƒè™‘åºåˆ—åŒ–ä¸ååºåˆ—åŒ–äº†ã€‚</p><p>ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Ÿåºåˆ—åŒ–å°±æ˜¯å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬æ¢æˆäºŒè¿›åˆ¶ä¸²çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç¼–ç çš„è¿‡ç¨‹ã€‚</p><p>ä»€ä¹ˆæ˜¯<strong>ååºåˆ—åŒ–</strong>ï¼Ÿå°†åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰€ç”Ÿæˆçš„äºŒè¿›åˆ¶ä¸²è½¬æ¢æˆæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡çš„è¿‡ç¨‹ã€‚</p><p>ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–ï¼Ÿè½¬æ¢ä¸º<strong>äºŒè¿›åˆ¶ä¸²</strong>åæ‰å¥½è¿›è¡Œç½‘ç»œä¼ è¾“å˜›ï¼</p><p>ä¸ºä»€ä¹ˆéœ€è¦ååºåˆ—åŒ–ï¼Ÿå°†<strong>äºŒè¿›åˆ¶</strong>è½¬æ¢ä¸º<strong>å¯¹è±¡</strong>æ‰å¥½è¿›è¡Œåç»­å¤„ç†ï¼</p><p>é€šè¿‡æ³¨è§£å’Œæ¥å£å®šä¹‰è¯·æ±‚ï¼Œåº•å±‚é»˜è®¤ä½¿ç”¨ <strong>Jackson</strong> è¿›è¡Œ JSON åºåˆ—åŒ–ã€‚</p><p>é‚£ä¹ˆRPCé€‰æ‹©ä»€ä¹ˆä½œä¸ºå…¶ååºåˆ—åŒ–åçš„å¯¹è±¡å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯Protobufã€‚</p><h2 id="Protocol-Buffers"><a href="#Protocol-Buffers" class="headerlink" title="Protocol Buffers"></a>Protocol Buffers</h2><p>å¯ä»¥ç†è§£ProtoBufæ˜¯ä¸€ç§æ›´åŠ çµæ´»ã€é«˜æ•ˆçš„æ•°æ®æ ¼å¼ï¼Œä¸XMLã€JSONç±»ä¼¼ï¼Œåœ¨ä¸€äº›é«˜æ€§èƒ½ä¸”å¯¹å“åº”é€Ÿåº¦æœ‰è¦æ±‚çš„æ•°æ®ä¼ è¾“åœºæ™¯éå¸¸é€‚ç”¨ã€‚ProtoBufåœ¨gRPCçš„æ¡†æ¶ä¸­ä¸»è¦æœ‰ä¸‰ä¸ªä½œç”¨ï¼š</p><ul><li>å®šä¹‰æ•°æ®ç»“æ„</li><li>å®šä¹‰æœåŠ¡æ¥å£</li><li>é€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œæå‡ä¼ è¾“æ•ˆç‡</li></ul><p>å¯ä»¥çœ‹åˆ°å…¶å®ä¸¤è€…å†…å®¹ç›¸å·®ä¸å¤§ï¼Œå¹¶ä¸”å†…å®¹éå¸¸ç›´è§‚ï¼Œä½†æ˜¯Protocol Buffersç¼–ç çš„å†…å®¹åªæ˜¯æä¾›ç»™æ“ä½œè€…é˜…è¯»çš„ï¼Œå®é™…ä¸Šä¼ è¾“çš„å¹¶ä¸ä¼šä»¥è¿™ç§æ–‡æœ¬å½¢å¼ï¼Œè€Œæ˜¯åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶æ•°æ®ã€‚å­—èŠ‚æ•°ä¼šæ¯”JSONã€XMLçš„å­—èŠ‚æ•°å°‘å¾ˆå¤šï¼Œé€Ÿç‡æ›´å¿«ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> RPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-41 æ‹œå åº­&amp;éæ‹œå åº­</title>
      <link href="/2025/03/25/75-41%20%E6%8B%9C%E5%8D%A0%E5%BA%AD&amp;%E9%9D%9E%E6%8B%9C%E5%8D%A0%E5%BA%AD/"/>
      <url>/2025/03/25/75-41%20%E6%8B%9C%E5%8D%A0%E5%BA%AD&amp;%E9%9D%9E%E6%8B%9C%E5%8D%A0%E5%BA%AD/</url>
      
        <content type="html"><![CDATA[<h1 id="75-41-æ‹œå åº­-éæ‹œå åº­"><a href="#75-41-æ‹œå åº­-éæ‹œå åº­" class="headerlink" title="75-41 æ‹œå åº­&amp;éæ‹œå åº­"></a>75-41 æ‹œå åº­&amp;éæ‹œå åº­</h1><h2 id="æ‹œå åº­å®¹é”™ï¼ˆBFTï¼‰"><a href="#æ‹œå åº­å®¹é”™ï¼ˆBFTï¼‰" class="headerlink" title="æ‹œå åº­å®¹é”™ï¼ˆBFTï¼‰"></a><strong>æ‹œå åº­å®¹é”™ï¼ˆBFTï¼‰</strong></h2><p>æ‹œå åº­å®¹é”™ç®—æ³•å‡è®¾ç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨<strong>æ¶æ„èŠ‚ç‚¹ï¼ˆByzantine Nodesï¼‰</strong>ï¼Œè¿™äº›èŠ‚ç‚¹å¯èƒ½æ•…æ„å‘é€é”™è¯¯ä¿¡æ¯ã€ç¯¡æ”¹æ•°æ®æˆ–æ‹’ç»åä½œï¼Œç”šè‡³ä¸å…¶ä»–æ¶æ„èŠ‚ç‚¹åˆè°‹ç ´åç³»ç»Ÿã€‚å…¶ç›®æ ‡æ˜¯è®©ç³»ç»Ÿåœ¨å­˜åœ¨ä¸€å®šæ•°é‡çš„æ¶æ„èŠ‚ç‚¹æ—¶ä»èƒ½è¾¾æˆä¸€è‡´ã€‚</p><p>æºè‡ªâ€œæ‹œå åº­å°†å†›é—®é¢˜â€ï¼ˆByzantine Generals Problemï¼‰ï¼š</p><blockquote><p>ä¸€æ”¯æ‹œå åº­å†›é˜ŸåŒ…å›´äº†ä¸€åº§åŸå¸‚ï¼Œå¤šä½å°†å†›éœ€è¦é€šè¿‡ä¿¡ä½¿åå•†è¿›æ”»æˆ–æ’¤é€€çš„ç­–ç•¥ã€‚ä½†å…¶ä¸­å¯èƒ½å­˜åœ¨å›å¾’å°†å†›æ•…æ„ä¼ é€’é”™è¯¯æŒ‡ä»¤ï¼Œå¯¼è‡´å†›é˜Ÿè¡ŒåŠ¨ä¸ä¸€è‡´ã€‚å¦‚ä½•åœ¨è¿™ç§ä¸å¯ä¿¡ç¯å¢ƒä¸‹è¾¾æˆå…±è¯†ï¼Ÿ</p></blockquote><h2 id="éæ‹œå åº­å®¹é”™ï¼ˆNon-BFTï¼‰"><a href="#éæ‹œå åº­å®¹é”™ï¼ˆNon-BFTï¼‰" class="headerlink" title="éæ‹œå åº­å®¹é”™ï¼ˆNon-BFTï¼‰"></a><strong>éæ‹œå åº­å®¹é”™ï¼ˆNon-BFTï¼‰</strong></h2><p>éæ‹œå åº­å®¹é”™ç®—æ³•å‡è®¾èŠ‚ç‚¹æ•…éšœæ˜¯**è‰¯æ€§ï¼ˆCrash Faultï¼‰**çš„ï¼Œå³èŠ‚ç‚¹å¯èƒ½å®•æœºæˆ–ç½‘ç»œæ–­å¼€ï¼Œä½†ä¸ä¼šæ•…æ„ä½œæ¶ã€‚å…¶ç›®æ ‡æ˜¯è§£å†³å› èŠ‚ç‚¹å´©æºƒæˆ–ç½‘ç»œå»¶è¿Ÿå¯¼è‡´çš„å…±è¯†é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
            <tag> é€‰ä¸¾ç®—æ³• </tag>
            
            <tag> æ‹œå åº­ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-40 Raftåè®®</title>
      <link href="/2025/03/25/75-40%20Raft%E5%8D%8F%E8%AE%AE/"/>
      <url>/2025/03/25/75-40%20Raft%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="75-40-Raftåè®®"><a href="#75-40-Raftåè®®" class="headerlink" title="75-40 Raftåè®®"></a>75-40 Raftåè®®</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¯´åˆ°Raftåè®®ï¼Œé‚£å°±è¦å…ˆèŠèŠåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å­˜åœ¨çš„ä¸€ä¸ªå›°å¢ƒã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒèŠ‚ç‚¹é—´çš„é€šä¿¡ä¾èµ–ç½‘ç»œï¼Œè€Œç½‘ç»œæœ¬èº«æ˜¯ä¸å¯é çš„ï¼ˆå»¶è¿Ÿã€ä¸¢åŒ…ã€åˆ†åŒºï¼‰ï¼ŒèŠ‚ç‚¹ä¹Ÿå¯èƒ½éšæ—¶å®•æœºã€‚è¿™å¯¼è‡´ä¸€ä¸ªæ ¹æœ¬é—®é¢˜ï¼š<strong>å¦‚ä½•åœ¨ä¸å¯é çš„èŠ‚ç‚¹å’Œç½‘ç»œä¸­ï¼Œè®©å¤šä¸ªèŠ‚ç‚¹å°±æŸä¸ªå€¼ï¼ˆæˆ–çŠ¶æ€ï¼‰è¾¾æˆä¸€è‡´ï¼Ÿ</strong></p><p>ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼ŒèŠ‚ç‚¹ä¹Ÿæ˜¯ä¸å¯é çš„ï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨ä¸€ç¾¤èŠ‚ç‚¹ä¸­å°±æŸä¸€ä¸ªé—®é¢˜è¾¾æˆä¸€è‡´å‘¢ï¼Ÿï¼</p><p>è¿™å°±æ˜¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å­˜åœ¨çš„ä¸€ä¸ªå›°å¢ƒã€‚</p><p>é‚£ä¹ˆRaftç®—æ³•å°±æ˜¯é’ˆå¯¹åœ¨ä¸å¯é çš„èŠ‚ç‚¹å’Œç½‘ç»œä¸­ï¼Œè®©å¤šä¸ªèŠ‚ç‚¹å°±æŸä¸€ä¸ªé—®é¢˜ï¼ˆå€¼æˆ–è€…çŠ¶æ€ï¼‰è¾¾æˆä¸€è‡´ï¼Œå³åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ã€‚</p><h2 id="CAPç†è®º"><a href="#CAPç†è®º" class="headerlink" title="CAPç†è®º"></a>CAPç†è®º</h2><p>CAP åŸåˆ™åˆç§° CAP å®šç†, æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­, Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰, ä¸‰è€…ä¸å¯å¾—å…¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503252021000.png" alt="image-20250325202128903"></p><h2 id="Raftç®—æ³•"><a href="#Raftç®—æ³•" class="headerlink" title="Raftç®—æ³•"></a>Raftç®—æ³•</h2><p>Raft æ­£å¸¸å·¥ä½œæ—¶çš„æµç¨‹å¦‚ä¸‹å›¾ï¼Œä¹Ÿå°±æ˜¯æ­£å¸¸æƒ…å†µä¸‹æ—¥å¿—å¤åˆ¶çš„æµç¨‹ã€‚Raft ä¸­ä½¿ç”¨æ—¥å¿—æ¥è®°å½•æ‰€æœ‰æ“ä½œï¼Œæ‰€æœ‰ç»“ç‚¹éƒ½æœ‰è‡ªå·±çš„æ—¥å¿—åˆ—è¡¨æ¥è®°å½•æ‰€æœ‰è¯·æ±‚ã€‚ç®—æ³•å°†æœºå™¨åˆ†æˆä¸‰ç§è§’è‰²ï¼š<strong>Leader</strong>ã€<strong>Follower</strong> å’Œ <strong>Candidate</strong>ã€‚æ­£å¸¸æƒ…å†µä¸‹åªå­˜åœ¨ä¸€ä¸ª Leaderï¼Œå…¶ä»–å‡ä¸º Followerï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¸ Leader è¿›è¡Œäº¤äº’ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503252037753.gif" alt="tcCXcV"></p><p>æ‰€æœ‰æ“ä½œé‡‡ç”¨ç±»ä¼¼<strong>ä¸¤é˜¶æ®µæäº¤</strong>çš„æ–¹å¼ï¼ŒLeader åœ¨æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚åå¹¶ä¸ä¼šæ‰§è¡Œï¼Œåªæ˜¯å°†å…¶å†™å…¥è‡ªå·±çš„æ—¥å¿—åˆ—è¡¨ä¸­ï¼Œç„¶åå°†è¯¥æ“ä½œå‘é€ç»™æ‰€æœ‰çš„ Followerã€‚Follower åœ¨æ”¶åˆ°è¯·æ±‚åä¹Ÿåªæ˜¯å†™å…¥è‡ªå·±çš„æ—¥å¿—åˆ—è¡¨ä¸­ç„¶åå›å¤ Leaderï¼Œå½“æœ‰è¶…è¿‡åŠæ•°çš„ç»“ç‚¹å†™å…¥å Leader æ‰ä¼šæäº¤è¯¥æ“ä½œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶é€šçŸ¥æ‰€æœ‰å…¶ä»–ç»“ç‚¹æäº¤è¯¥æ“ä½œã€‚</p><p>é€šè¿‡è¿™ä¸€æµç¨‹ä¿è¯äº†åªè¦æäº¤è¿‡åçš„æ“ä½œä¸€å®šåœ¨å¤šæ•°ç»“ç‚¹ä¸Šç•™æœ‰è®°å½•ï¼ˆåœ¨æ—¥å¿—åˆ—è¡¨ä¸­ï¼‰ï¼Œä»è€Œä¿è¯äº†è¯¥æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p><blockquote><p>Raft æ˜¯ä¸€ä¸ªéæ‹œå åº­çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œå³æ‰€æœ‰é€šä¿¡æ˜¯æ­£ç¡®çš„è€Œéä¼ªé€ çš„ã€‚<strong>Nä¸ªç»“ç‚¹çš„æƒ…å†µä¸‹ï¼ˆNä¸ºå¥‡æ•°ï¼‰å¯ä»¥æœ€å¤šå®¹å¿(N-1)&#x2F;2ä¸ªç»“ç‚¹æ•…éšœ</strong>ã€‚å¦‚æœæ›´å¤šçš„èŠ‚ç‚¹æ•…éšœï¼Œåç»­çš„Leaderé€‰ä¸¾å’Œæ—¥å¿—åŒæ­¥å°†æ— æ³•è¿›è¡Œã€‚</p></blockquote><p>Raftç®—æ³•åœ¨å…·ä½“å®ç°ä¸­ï¼Œå°†åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜åˆ†è§£ä¸ºäº†<strong>Leaderé€‰ä¸¾</strong>ã€<strong>æ—¥å¿—åŒæ­¥</strong>å’Œ<strong>å®‰å…¨æ€§ä¿è¯</strong>ä¸‰å¤§å­é—®é¢˜</p><h3 id="Leaderé€‰ä¸¾"><a href="#Leaderé€‰ä¸¾" class="headerlink" title="Leaderé€‰ä¸¾"></a>Leaderé€‰ä¸¾</h3><blockquote><h3 id="åœºæ™¯-2ï¼šLeader-å®•æœºï¼Œè§¦å‘é€‰ä¸¾"><a href="#åœºæ™¯-2ï¼šLeader-å®•æœºï¼Œè§¦å‘é€‰ä¸¾" class="headerlink" title="åœºæ™¯ 2ï¼šLeader å®•æœºï¼Œè§¦å‘é€‰ä¸¾"></a><strong>åœºæ™¯ 2ï¼šLeader å®•æœºï¼Œè§¦å‘é€‰ä¸¾</strong></h3><ol><li><p><strong>Leaderï¼ˆAï¼‰å®•æœº</strong>ï¼š</p><ul><li>B å’Œ C çš„ <code>é€‰ä¸¾è¶…æ—¶è®¡æ—¶å™¨</code> æœªè¢«é‡ç½®ï¼Œè®¡æ—¶å™¨åˆ°æœŸåï¼Œå®ƒä»¬è®¤ä¸º Leader å·²å¤±è”ã€‚</li></ul></li><li><p><strong>è½¬æ¢ä¸º Candidate çŠ¶æ€</strong>ï¼š</p><ul><li>å‡è®¾ B çš„è®¡æ—¶å™¨å…ˆåˆ°æœŸï¼š<ul><li>B è‡ªå¢ Termï¼ˆå¦‚ Term 1 â†’ Term 2ï¼‰ã€‚</li><li>B å°†è‡ªèº«çŠ¶æ€æ”¹ä¸º <strong>Candidate</strong>ï¼Œå¹¶å‘èµ·é€‰ä¸¾æŠ•ç¥¨ï¼ˆRequestVote RPCï¼‰ã€‚</li><li>B å…ˆæŠ•ç¥¨ç»™è‡ªå·±ï¼Œç„¶åå‘ A å’Œ C è¯·æ±‚æŠ•ç¥¨ã€‚</li></ul></li></ul></li><li><p><strong>æŠ•ç¥¨è§„åˆ™</strong>ï¼š</p><ul><li>æ¯ä¸ªèŠ‚ç‚¹åœ¨ <strong>åŒä¸€ Term å†…åªèƒ½æŠ•ä¸€æ¬¡ç¥¨</strong>ï¼ˆå…ˆåˆ°å…ˆå¾—ï¼‰ã€‚</li><li>æŠ•ç¥¨æ¡ä»¶ï¼š<ol><li>Candidate çš„ Term â‰¥ å½“å‰èŠ‚ç‚¹çš„ Termã€‚</li><li>Candidate çš„æ—¥å¿—è‡³å°‘å’Œå½“å‰èŠ‚ç‚¹ä¸€æ ·æ–°ï¼ˆé€šè¿‡æœ€åä¸€æ¡æ—¥å¿—çš„ Term å’Œ Index åˆ¤æ–­ï¼‰ã€‚</li></ol></li></ul></li><li><p><strong>æ”¶é›†æŠ•ç¥¨</strong>ï¼š</p><ul><li>C æ”¶åˆ° B çš„æŠ•ç¥¨è¯·æ±‚ï¼ˆTerm&#x3D;2ï¼‰ï¼Œå‘ç° Term&#x3D;2 &gt; è‡ªå·±å½“å‰çš„ Term&#x3D;1ï¼Œä¸” B çš„æ—¥å¿—è¶³å¤Ÿæ–°ã€‚</li><li>C æŠ•ç¥¨ç»™ Bï¼Œå¹¶æ›´æ–°è‡ªå·±çš„ Term ä¸º 2ã€‚</li><li>A å·²å®•æœºï¼Œæ— æ³•å“åº”ã€‚</li></ul></li><li><p><strong>æˆä¸º Leader</strong>ï¼š</p><ul><li>B è·å¾— <strong>å¤šæ•°ç¥¨ï¼ˆ2&#x2F;3ï¼‰</strong>ï¼Œä» Candidate è½¬æ¢ä¸º Leaderã€‚</li><li>B ç«‹å³å‘æ‰€æœ‰èŠ‚ç‚¹å‘é€å¿ƒè·³ï¼Œé˜»æ­¢å…¶ä»–èŠ‚ç‚¹å‘èµ·æ–°é€‰ä¸¾ã€‚</li></ul></li></ol><hr><h3 id="åœºæ™¯-3ï¼šé€‰ä¸¾å†²çªï¼ˆSplit-Voteï¼‰"><a href="#åœºæ™¯-3ï¼šé€‰ä¸¾å†²çªï¼ˆSplit-Voteï¼‰" class="headerlink" title="åœºæ™¯ 3ï¼šé€‰ä¸¾å†²çªï¼ˆSplit Voteï¼‰"></a><strong>åœºæ™¯ 3ï¼šé€‰ä¸¾å†²çªï¼ˆSplit Voteï¼‰</strong></h3><p>å‡è®¾ B å’Œ C çš„é€‰ä¸¾è¶…æ—¶è®¡æ—¶å™¨åŒæ—¶åˆ°æœŸï¼Œå‡å‘èµ·æŠ•ç¥¨ï¼š</p><ol><li><strong>B å’Œ C åŒæ—¶æˆä¸º Candidate</strong>ï¼š<ul><li>B è‡ªå¢ Term åˆ° 2ï¼ŒC è‡ªå¢ Term åˆ° 2ï¼Œå„è‡ªå‘èµ·æŠ•ç¥¨ã€‚</li></ul></li><li><strong>æŠ•ç¥¨åˆ†æ•£</strong>ï¼š<ul><li>B æŠ•ç¥¨ç»™è‡ªå·±ï¼Œå¹¶è¯·æ±‚ A å’Œ C çš„æŠ•ç¥¨ã€‚</li><li>C æŠ•ç¥¨ç»™è‡ªå·±ï¼Œå¹¶è¯·æ±‚ A å’Œ B çš„æŠ•ç¥¨ã€‚</li><li>ç»“æœï¼š<ul><li>B è·å¾— 1 ç¥¨ï¼ˆè‡ªå·±ï¼‰ï¼ŒC è·å¾— 1 ç¥¨ï¼ˆè‡ªå·±ï¼‰ã€‚</li><li>æ—  Candidate è·å¾—å¤šæ•°ç¥¨ï¼ˆ2&#x2F;3ï¼‰ã€‚</li></ul></li></ul></li><li><strong>é‡æ–°é€‰ä¸¾</strong>ï¼š<ul><li>B å’Œ C çš„é€‰ä¸¾è¶…æ—¶è®¡æ—¶å™¨å†æ¬¡åˆ°æœŸï¼ˆéšæœºåŒ–è¶…æ—¶æ—¶é—´å¯é™ä½å†²çªæ¦‚ç‡ï¼‰ã€‚</li><li>å‡è®¾ B å…ˆè¶…æ—¶ï¼š<ul><li>B è‡ªå¢ Term åˆ° 3ï¼Œå‘èµ·æ–°ä¸€è½®æŠ•ç¥¨ã€‚</li><li>C æ”¶åˆ° Term&#x3D;3 çš„è¯·æ±‚ï¼ŒæŠ•ç¥¨ç»™ Bã€‚</li><li>B è·å¾— 2 ç¥¨ï¼Œæˆä¸º Leaderã€‚</li></ul></li></ul></li></ol></blockquote><h4 id="ä»»æœŸTerm"><a href="#ä»»æœŸTerm" class="headerlink" title="ä»»æœŸTerm"></a>ä»»æœŸTerm</h4><p>Raftç®—æ³•å°†æ—¶é—´åˆ†ä¸ºä¸€ä¸ªä¸ªçš„ä»»æœŸï¼ˆtermï¼‰ï¼Œæ¯ä¸€ä¸ªtermçš„å¼€å§‹éƒ½æ˜¯Leaderé€‰ä¸¾ã€‚ æ¯ä¸€ä¸ªä»»æœŸä»¥ä¸€æ¬¡é€‰ä¸¾ä½œä¸ºèµ·ç‚¹ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªç»“ç‚¹æˆä¸º Candidate å¹¶å‘å…¶ä»–ç»“ç‚¹è¯·æ±‚æŠ•ç¥¨æ—¶ï¼Œä¼šå°†è‡ªå·±çš„ Term åŠ  1ï¼Œè¡¨æ˜æ–°ä¸€è½®çš„å¼€å§‹ä»¥åŠæ—§ Leader çš„ä»»æœŸç»“æŸã€‚æ‰€æœ‰ç»“ç‚¹åœ¨æ”¶åˆ°æ¯”è‡ªå·±æ›´æ–°çš„ Term ä¹‹åå°±ä¼šæ›´æ–°è‡ªå·±çš„ Term å¹¶è½¬æˆ Followerï¼Œè€Œæ”¶åˆ°è¿‡æ—¶çš„æ¶ˆæ¯åˆ™æ‹’ç»è¯¥è¯·æ±‚ã€‚ åœ¨æˆåŠŸé€‰ä¸¾Leaderä¹‹åï¼ŒLeaderä¼šåœ¨æ•´ä¸ªtermå†…ç®¡ç†æ•´ä¸ªé›†ç¾¤ã€‚å¦‚æœLeaderé€‰ä¸¾å¤±è´¥ï¼Œè¯¥termå°±ä¼šå› ä¸ºæ²¡æœ‰Leaderè€Œç»“æŸã€‚</p><h4 id="æŠ•ç¥¨"><a href="#æŠ•ç¥¨" class="headerlink" title="æŠ•ç¥¨"></a>æŠ•ç¥¨</h4><p>åœ¨æŠ•ç¥¨æ—¶å€™ï¼Œæ‰€æœ‰æœåŠ¡å™¨é‡‡ç”¨å…ˆæ¥å…ˆå¾—çš„åŸåˆ™ï¼Œåœ¨ä¸€ä¸ªä»»æœŸå†…åªå¯ä»¥æŠ•ç¥¨ç»™ä¸€ä¸ªç»“ç‚¹ï¼Œ<strong>å¾—åˆ°è¶…è¿‡åŠæ•°</strong>çš„æŠ•ç¥¨æ‰å¯æˆä¸º Leaderï¼Œä»è€Œä¿è¯äº†ä¸€ä¸ªä»»æœŸå†…åªä¼šæœ‰ä¸€ä¸ª Leader äº§ç”Ÿï¼ˆElection Safetyï¼‰ã€‚</p><p>åœ¨ Raft ä¸­æ—¥å¿—åªæœ‰ä» Leader åˆ° Follower è¿™ä¸€æµå‘ï¼Œæ‰€ä»¥éœ€è¦ä¿è¯ Leader çš„æ—¥å¿—å¿…é¡»æ­£ç¡®ï¼Œå³å¿…é¡»æ‹¥æœ‰æ‰€æœ‰å·²åœ¨å¤šæ•°èŠ‚ç‚¹ä¸Šå­˜åœ¨çš„æ—¥å¿—ï¼Œè¿™ä¸€æ­¥éª¤ç”±æŠ•ç¥¨æ¥é™åˆ¶ã€‚</p><p>ä¼šåˆ©ç”¨å¦‚ä¸‹è§„åˆ™åˆ¤æ–­æ˜¯å¦æŠ•ç¥¨ï¼š</p><ul><li>é¦–å…ˆä¼šåˆ¤æ–­è¯·æ±‚çš„termæ˜¯å¦æ›´å¤§ï¼Œä¸æ˜¯åˆ™è¯´æ˜æ˜¯æ—§æ¶ˆæ¯ï¼Œæ‹’ç»è¯¥è¯·æ±‚ã€‚</li><li>å¦‚æœä»»æœŸTermç›¸åŒï¼Œåˆ™æ¯”è¾ƒindexï¼Œindexè¾ƒå¤§åˆ™ä¸ºæ›´åŠ æ–°çš„æ—¥å¿—ï¼›å¦‚æœä»»æœŸTermä¸åŒï¼Œtermæ›´å¤§çš„åˆ™ä¸ºæ›´æ–°çš„æ¶ˆæ¯ã€‚å¦‚æœæ˜¯æ›´æ–°çš„æ¶ˆæ¯ï¼Œåˆ™ç»™CandidateæŠ•ç¥¨ã€‚</li></ul><p>æ‰€ä»¥ä¸€æ—¦è¿™ä¸ªèŠ‚ç‚¹æ•…éšœæ•°è¶…è¿‡ä¸€åŠåˆ™ä¼šå¤±æ•ˆã€‚</p><h3 id="æ—¥å¿—åŒæ­¥"><a href="#æ—¥å¿—åŒæ­¥" class="headerlink" title="æ—¥å¿—åŒæ­¥"></a>æ—¥å¿—åŒæ­¥</h3><p>é€šè¿‡ä¸Šé¢çš„Leaderé€‰ä¸¾ç®—æ³•é€‰ä¸¾å‡ºäº†æ–°Leaderä¹‹åï¼Œå°±éœ€è¦æ‰€æœ‰çš„followerè¿›è¡Œæ—¥å¿—åŒæ­¥äº†ã€‚</p><p>Leaderé€‰å‡ºåï¼Œå°±å¼€å§‹æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚LeaderæŠŠè¯·æ±‚ä½œä¸ºæ—¥å¿—æ¡ç›®ï¼ˆLog entriesï¼‰åŠ å…¥åˆ°å®ƒçš„æ—¥å¿—ä¸­ï¼Œç„¶åå¹¶è¡Œçš„å‘å…¶ä»–æœåŠ¡å™¨å‘èµ· <strong>AppendEntries RPC</strong> ï¼ˆRPCç»†èŠ‚å‚è§å…«ã€Raftç®—æ³•æ€»ç»“ï¼‰å¤åˆ¶æ—¥å¿—æ¡ç›®ã€‚å½“è¿™æ¡æ—¥å¿—è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°æœåŠ¡å™¨ä¸Šï¼ŒLeaderå°†è¿™æ¡æ—¥å¿—åº”ç”¨åˆ°å®ƒçš„çŠ¶æ€æœºå¹¶å‘å®¢æˆ·ç«¯è¿”å›æ‰§è¡Œç»“æœã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503252210931.png" alt="img"></p><p>Raftæ—¥å¿—åŒæ­¥ä¿è¯å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>å¦‚æœä¸åŒæ—¥å¿—ä¸­çš„ä¸¤ä¸ªæ¡ç›®æœ‰ç€ç›¸åŒçš„ç´¢å¼•å’Œä»»æœŸå·ï¼Œåˆ™å®ƒä»¬æ‰€å­˜å‚¨çš„å‘½ä»¤æ˜¯ç›¸åŒçš„ã€‚</li><li>å¦‚æœä¸åŒæ—¥å¿—ä¸­çš„ä¸¤ä¸ªæ¡ç›®æœ‰ç€ç›¸åŒçš„ç´¢å¼•å’Œä»»æœŸå·ï¼Œåˆ™å®ƒä»¬ä¹‹å‰çš„æ‰€æœ‰æ¡ç›®éƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</li></ul><p>Leader ä¼šç»™æ¯ä¸ª Follower å‘é€è¯¥ RPC ä»¥è¿½åŠ æ—¥å¿—ï¼Œè¯·æ±‚ä¸­é™¤äº†å½“å‰ä»»æœŸ termã€Leader çš„ id å’Œå·²æäº¤çš„æ—¥å¿— indexï¼Œè¿˜æœ‰å°†è¦è¿½åŠ çš„æ—¥å¿—åˆ—è¡¨ï¼ˆç©ºåˆ™æˆä¸ºå¿ƒè·³åŒ…ï¼‰ï¼Œå‰ä¸€ä¸ªæ—¥å¿—çš„ index å’Œ termã€‚</p><p>åœ¨å¤åˆ¶çš„è¿‡ç¨‹ä¸­ï¼ŒRaftä¼šä¿è¯å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li><strong>Leader ç»ä¸ä¼šè¦†ç›–æˆ–åˆ é™¤è‡ªå·±çš„æ—¥å¿—ï¼Œåªä¼šè¿½åŠ  ï¼ˆLeader Append-Onlyï¼‰</strong>ï¼Œæˆä¸º Leader çš„ç»“ç‚¹é‡Œçš„æ—¥å¿—ä¸€å®šæ‹¥æœ‰æ‰€æœ‰å·²è¢«å¤šæ•°èŠ‚ç‚¹æ‹¥æœ‰çš„æ—¥å¿—æ¡ç›®ï¼Œæ‰€ä»¥å…ˆå‰çš„æ—¥å¿—æ¡ç›®å¾ˆå¯èƒ½å·²ç»è¢«æäº¤ï¼Œå› æ­¤ä¸å¯ä»¥åˆ é™¤ä¹‹å‰çš„æ—¥å¿—ã€‚</li><li>å¦‚æœä¸¤ä¸ªæ—¥å¿—çš„ index å’Œ term ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ—¥å¿—ç›¸åŒ ï¼ˆLog Matchingï¼‰ï¼Œ<strong>ç¬¬äºŒç‚¹ä¸»è¦æ˜¯å› ä¸ºä¸€ä¸ªä»»æœŸå†…åªå¯èƒ½å‡ºç°ä¸€ä¸ª Leaderï¼Œè€Œ Leader åªä¼šä¸ºä¸€ä¸ª index åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼Œè€Œä¸”ä¸€æ—¦å†™å…¥å°±ä¸ä¼šä¿®æ”¹ï¼Œå› æ­¤ä¿è¯äº†æ—¥å¿—çš„å”¯ä¸€æ€§ã€‚</strong></li><li><strong>å¦‚æœä¸¤ä¸ªæ—¥å¿—ç›¸åŒï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹å‰çš„æ—¥å¿—å‡ç›¸åŒ</strong>ï¼Œå› ä¸ºåœ¨å†™å…¥æ—¥å¿—æ—¶ä¼šæ£€æŸ¥å‰ä¸€ä¸ªæ—¥å¿—æ˜¯å¦ä¸€è‡´ï¼Œä»è€Œé€’å½’çš„ä¿è¯äº†å‰é¢çš„æ‰€æœ‰æ—¥å¿—éƒ½ä¸€è‡´ã€‚ä»è€Œä¹Ÿä¿è¯äº†å½“ä¸€ä¸ªæ—¥å¿—è¢«æäº¤ä¹‹åï¼Œæ‰€æœ‰ç»“ç‚¹åœ¨è¯¥ index ä¸Šæäº¤çš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼ˆState Machine Safetyï¼‰ã€‚</li></ul><h3 id="å®‰å…¨æ€§ä¿éšœï¼ˆæ ¸å¿ƒï¼‰"><a href="#å®‰å…¨æ€§ä¿éšœï¼ˆæ ¸å¿ƒï¼‰" class="headerlink" title="å®‰å…¨æ€§ä¿éšœï¼ˆæ ¸å¿ƒï¼‰"></a>å®‰å…¨æ€§ä¿éšœï¼ˆæ ¸å¿ƒï¼‰</h3><p>Raftç®—æ³•ä¸­å¼•å…¥äº†å¦‚ä¸‹ä¸¤æ¡è§„åˆ™ï¼Œæ¥ç¡®ä¿äº†</p><ul><li><strong>å·²ç»commitçš„æ¶ˆæ¯ï¼Œä¸€å®šä¼šå­˜åœ¨äºåç»­çš„LeaderèŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”ç»å¯¹ä¸ä¼šåœ¨åç»­æ“ä½œä¸­è¢«åˆ é™¤ã€‚</strong></li><li>å¯¹äºå¹¶æœªcommitçš„æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šä¸¢å¤±ã€‚</li></ul><h4 id="å¤šæ•°æŠ•ç¥¨è§„åˆ™"><a href="#å¤šæ•°æŠ•ç¥¨è§„åˆ™" class="headerlink" title="å¤šæ•°æŠ•ç¥¨è§„åˆ™"></a>å¤šæ•°æŠ•ç¥¨è§„åˆ™</h4><p>åœ¨ä¸Šé¢æŠ•ç¥¨ç¯èŠ‚ä¹Ÿæœ‰ä»‹ç»è¿‡ï¼Œä¸€ä¸ªcandidateå¿…é¡»è·å¾—é›†ç¾¤ä¸­çš„å¤šæ•°æŠ•ç¥¨ï¼Œæ‰èƒ½è¢«é€‰ä¸ºLeaderï¼›è€Œå¯¹äºæ¯æ¡commitè¿‡çš„æ¶ˆæ¯ï¼Œå®ƒå¿…é¡»æ˜¯è¢«å¤åˆ¶åˆ°äº†é›†ç¾¤ä¸­çš„å¤šæ•°èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆä¸ºLeaderçš„èŠ‚ç‚¹ï¼Œè‡³å°‘æœ‰1ä¸ªåŒ…å«äº†commitæ¶ˆæ¯çš„èŠ‚ç‚¹ç»™å®ƒæŠ•äº†ç¥¨ã€‚</p><p>è€Œåœ¨æŠ•ç¥¨çš„è¿‡ç¨‹ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šä¸candidateæ¯”è¾ƒæ—¥å¿—çš„æœ€åindexä»¥åŠç›¸åº”çš„termï¼Œå¦‚æœè¦æˆä¸ºLeaderï¼Œå¿…é¡»æœ‰æ›´å¤§çš„indexæˆ–è€…æ›´æ–°çš„termï¼Œæ‰€ä»¥Leaderä¸Šè‚¯å®šæœ‰commitè¿‡çš„æ¶ˆæ¯ã€‚</p><h4 id="æäº¤è§„åˆ™"><a href="#æäº¤è§„åˆ™" class="headerlink" title="æäº¤è§„åˆ™"></a>æäº¤è§„åˆ™</h4><p>ä¸Šé¢è¯´åˆ°ï¼Œåªè¦æ—¥å¿—åœ¨å¤šæ•°ç»“ç‚¹ä¸Šå­˜åœ¨ï¼Œé‚£ä¹ˆ Leader å°±å¯ä»¥æäº¤è¯¥æ“ä½œã€‚ä½†æ˜¯<strong>Rafté¢å¤–é™åˆ¶äº† Leaderåªå¯¹è‡ªå·±ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®é€‚ç”¨è¯¥è§„åˆ™ï¼Œå…ˆå‰ä»»æœŸçš„æ¡ç›®åªèƒ½ç”±å½“å‰ä»»æœŸçš„æäº¤è€Œé—´æ¥è¢«æäº¤ã€‚</strong> ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰ä»»æœŸçš„Leaderï¼Œä¸ä¼šå»è´Ÿè´£ä¹‹å‰termçš„æ—¥å¿—æäº¤ï¼Œä¹‹å‰termçš„æ—¥å¿—æäº¤ï¼Œåªä¼šéšç€å½“å‰termçš„æ—¥å¿—æäº¤è€Œé—´æ¥æäº¤ã€‚</p><p>è¿™æ ·ç†è§£èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡ï¼Œä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè¯¥é›†ç¾¤ä¸­æœ‰S1åˆ°S5å…±5ä¸ªèŠ‚ç‚¹ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503252222947.png" alt="HIAsDK"></p><ul><li>Raft çš„æ ¸å¿ƒå®‰å…¨æœºåˆ¶ï¼š<ol><li>Leader åªèƒ½æäº¤è‡ªå·± Term çš„æ—¥å¿—ã€‚</li><li>æäº¤æ–° Term çš„æ—¥å¿—æ—¶ï¼Œéšå¼æäº¤æ‰€æœ‰ä¹‹å‰æœªæäº¤çš„æ—¥å¿—ã€‚</li><li>é€‰ä¸¾çº¦æŸï¼šåªæœ‰æ—¥å¿—è¶³å¤Ÿæ–°çš„èŠ‚ç‚¹æ‰èƒ½æˆä¸º Leaderã€‚</li></ol></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/shenmingxueIT/article/details/122554106?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522e5516caa8f60dbdaa0e81f77e8f8714d%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=e5516caa8f60dbdaa0e81f77e8f8714d&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-122554106-null-null.142%5Ev102%5Epc_search_result_base6&utm_term=Raft&spm=1018.2226.3001.4187">åˆ†å¸ƒå¼å…±è¯†ç®—æ³• â€”â€” Raftè¯¦è§£</a></li><li><a href="https://blog.csdn.net/zhousenshan/article/details/137998763">ä¸€æ–‡å½»åº•ææ‡‚Raftç®—æ³•ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†ï¼ï¼ï¼</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
            <tag> é€‰ä¸¾ç®—æ³• </tag>
            
            <tag> CAPç†è®º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-39 Kafka</title>
      <link href="/2025/03/25/75-39%20Kafka/"/>
      <url>/2025/03/25/75-39%20Kafka/</url>
      
        <content type="html"><![CDATA[<h1 id="75-39-Kafka"><a href="#75-39-Kafka" class="headerlink" title="75-39 Kafka"></a>75-39 Kafka</h1><h2 id="æ¶æ„å›¾"><a href="#æ¶æ„å›¾" class="headerlink" title="æ¶æ„å›¾"></a>æ¶æ„å›¾</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503251307672.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503251311134.jpeg" alt="img"></p><ul><li><strong><a href="https://zhida.zhihu.com/search?content_id=186455936&content_type=Article&match_order=1&q=Producer&zhida_source=entity">Producer</a></strong>ï¼šProducer å³ç”Ÿäº§è€…ï¼Œæ¶ˆæ¯çš„äº§ç”Ÿè€…ï¼Œæ˜¯æ¶ˆæ¯çš„å…¥å£</li><li><strong><a href="https://zhida.zhihu.com/search?content_id=186455936&content_type=Article&match_order=1&q=Broker&zhida_source=entity">Broker</a></strong>ï¼šBroker æ˜¯ kafka ä¸€ä¸ªå®ä¾‹ï¼Œæ¯ä¸ªæœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª kafka çš„å®ä¾‹ï¼Œç®€å•çš„ç†è§£å°±æ˜¯ä¸€å° kafka æœåŠ¡å™¨ï¼Œ<code>kafka cluster</code>è¡¨ç¤ºé›†ç¾¤çš„æ„æ€</li><li><strong>Topic</strong>ï¼šæ¶ˆæ¯çš„ä¸»é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œkafkaçš„æ•°æ®å°±ä¿å­˜åœ¨topicã€‚åœ¨æ¯ä¸ª broker ä¸Šéƒ½å¯ä»¥åˆ›å»ºå¤šä¸ª topic ã€‚</li><li><strong><a href="https://zhida.zhihu.com/search?content_id=186455936&content_type=Article&match_order=1&q=Partition&zhida_source=entity">Partition</a></strong>ï¼šTopicçš„åˆ†åŒºï¼Œæ¯ä¸ª topic å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºçš„ä½œç”¨æ˜¯åšè´Ÿè½½ï¼Œæé«˜ kafka çš„ååé‡ã€‚<strong>åŒä¸€ä¸ª topic åœ¨ä¸åŒçš„åˆ†åŒºçš„æ•°æ®æ˜¯ä¸é‡å¤çš„ï¼Œpartition çš„è¡¨ç°å½¢å¼å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„æ–‡ä»¶å¤¹</strong>ï¼</li><li><strong><a href="https://zhida.zhihu.com/search?content_id=186455936&content_type=Article&match_order=1&q=Replication&zhida_source=entity">Replication</a></strong>ï¼šæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå‰¯æœ¬çš„ä½œç”¨æ˜¯åšå¤‡èƒï¼Œä¸»åˆ†åŒºï¼ˆLeaderï¼‰ä¼šå°†æ•°æ®åŒæ­¥åˆ°ä»åˆ†åŒºï¼ˆFollowerï¼‰ã€‚å½“ä¸»åˆ†åŒºï¼ˆLeaderï¼‰æ•…éšœçš„æ—¶å€™ä¼šé€‰æ‹©ä¸€ä¸ªå¤‡èƒï¼ˆFollowerï¼‰ä¸Šä½ï¼Œæˆä¸º Leaderã€‚åœ¨kafkaä¸­é»˜è®¤å‰¯æœ¬çš„æœ€å¤§æ•°é‡æ˜¯10ä¸ªï¼Œä¸”å‰¯æœ¬çš„æ•°é‡ä¸èƒ½å¤§äºBrokerçš„æ•°é‡ï¼Œfollowerå’Œleaderç»å¯¹æ˜¯åœ¨ä¸åŒçš„æœºå™¨ï¼ŒåŒä¸€æœºå™¨å¯¹åŒä¸€ä¸ªåˆ†åŒºä¹Ÿåªå¯èƒ½å­˜æ”¾ä¸€ä¸ªå‰¯æœ¬</li><li><strong>Message</strong>ï¼šæ¯ä¸€æ¡å‘é€çš„æ¶ˆæ¯ä¸»ä½“ã€‚</li><li><strong>Consumer</strong>ï¼šæ¶ˆè´¹è€…ï¼Œå³æ¶ˆæ¯çš„æ¶ˆè´¹æ–¹ï¼Œæ˜¯æ¶ˆæ¯çš„å‡ºå£ã€‚</li><li><strong><a href="https://zhida.zhihu.com/search?content_id=186455936&content_type=Article&match_order=1&q=Consumer+Group&zhida_source=entity">Consumer Group</a></strong>ï¼šæˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªæ¶ˆè´¹ç»„ç»„æˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œ<strong>åœ¨ kafka çš„è®¾è®¡ä¸­åŒä¸€ä¸ªåˆ†åŒºçš„æ•°æ®åªèƒ½è¢«æ¶ˆè´¹è€…ç»„ä¸­çš„æŸä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ªtopicçš„ä¸åŒåˆ†åŒºçš„æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†æé«˜kafkaçš„ååé‡</strong>ï¼</li><li><strong><a href="https://zhida.zhihu.com/search?content_id=186455936&content_type=Article&match_order=1&q=Zookeeper&zhida_source=entity">Zookeeper</a></strong>ï¼škafka é›†ç¾¤ä¾èµ– zookeeper æ¥ä¿å­˜é›†ç¾¤çš„çš„å…ƒä¿¡æ¯ï¼Œæ¥ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li></ul><h2 id="Kafkaä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"><a href="#Kafkaä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" class="headerlink" title="Kafkaä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"></a>Kafkaä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503251336613.png" alt="image-20250325133654564"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503251337799.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503251337100.png" alt="img"></p><p>é’ˆå¯¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­å­˜åœ¨çš„è¿‡ç¨‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ¶ˆæ¯é˜Ÿåˆ—éœ€è¦è¿›è¡ŒæŒä¹…åŒ–ï¼ˆä¿å­˜æ¶ˆæ¯ï¼‰ã€ä¼ è¾“æ¶ˆæ¯ç­‰è¿‡ç¨‹ã€‚é‚£ä¹ˆé’ˆå¯¹è¿™ä¸¤ä¸ªæ­¥éª¤ï¼Œå°±å¯ä»¥è¿›è¡Œé’ˆå¯¹çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨æŒä¹…åŒ–çš„æ—¶å€™ï¼Œé‡‡ç”¨é¡ºåºå†™è€Œééšæœºå†™ï¼Œå¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œéšæœºå†™è€—æ—¶æ¯”è¾ƒé•¿ï¼Œä¸€æ–¹é¢ä½ éœ€è¦æ‰¾åˆ°å…·ä½“çš„ä½ç½®ç„¶åè¿›è¡Œå†™æ“ä½œã€‚ä½†æ˜¯é¡ºåºå†™ç›´æ¥è·³è¿‡äº†æ‰¾åˆ°å…·ä½“ä½ç½®è¿™ä¸€æ­¥ï¼Œæ‰€ä»¥è€—æ—¶æ¯”è¾ƒçŸ­ï¼Œåœ¨Kafkaä¸­æ˜¯å¦‚ä½•å®ç°çš„é¡ºåºå†™çš„å‘¢ï¼Ÿå¼•å…¥äº†å†…å­˜è¿›è¡Œç¼“å­˜ï¼Œå…·ä½“æŠ€æœ¯ç»†èŠ‚ä¸‹æ–‡è¿›è¡Œè¯¦ç»†çš„ä»‹ç»ã€‚</p><p>é‚£ä¹ˆé’ˆå¯¹æ¶ˆæ¯çš„å‘é€è¿™ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå› ä¸ºå…¶æ¶ˆæ¯çš„ä¼ è¾“éƒ½æ˜¯é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡çš„ï¼Œé‚£ä¹ˆä¸€æ–¹é¢æˆ‘ä»¬å¯ä»¥å¯¹ä¼ è¾“çš„æ¶ˆæ¯è¿›è¡Œå‹ç¼©ï¼Œä»è€Œå‡å°‘å…¶ç½‘ç»œä¼ è¾“é‡ï¼ŒåŒæ—¶åœ¨æ“ä½œç³»ç»Ÿæ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨é›¶æ‹·è´æŠ€æœ¯å‡å°‘å…¶åœ¨æ“ä½œç³»ç»Ÿä¸­ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„è½¬æ¢ä»¥åŠå¤šæ¬¡æ‹·è´çš„æ¶ˆè€—ã€‚ç„¶åæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰¹æ¬¡è¿›è¡Œä¼ è¾“ï¼Œæ¯”å¦‚ç­‰å¾…1sï¼ŒæŠŠè¿™ä¸€ç§’å†…ç§¯ç´¯çš„æ¶ˆæ¯è¿›è¡Œä¼ è¾“ï¼Œä»è€Œå‡å°‘å…¶ç½‘ç»œå¼€é”€ä¸IOæ“ä½œã€‚</p><p>ä»ä¸Šé¢çš„å››ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºKafkaæ¯ç§’å¯ä»¥å¤„ç†åå‡ ä¸‡æ¶ˆæ¯çš„åŸå› ã€‚</p><h2 id="Kafkaæ˜¯å¦‚ä½•ä¿è¯é¡ºåºæ¶ˆè´¹çš„ï¼Ÿ"><a href="#Kafkaæ˜¯å¦‚ä½•ä¿è¯é¡ºåºæ¶ˆè´¹çš„ï¼Ÿ" class="headerlink" title="Kafkaæ˜¯å¦‚ä½•ä¿è¯é¡ºåºæ¶ˆè´¹çš„ï¼Ÿ"></a>Kafkaæ˜¯å¦‚ä½•ä¿è¯é¡ºåºæ¶ˆè´¹çš„ï¼Ÿ</h2><p>æ ¹æ®ä¸Šé¢çš„ç»“æ„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼ŒKafkaçš„æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬Topicï¼ˆä¸»é¢˜ï¼‰å’ŒPartitionï¼ˆåˆ†åŒºï¼‰ã€‚æ¯ä¸ªTopicå¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªPartitionï¼Œè¿™äº›Partitionåˆ†å¸ƒåœ¨Kafkaé›†ç¾¤çš„å¤šä¸ªBrokerä¸Šï¼Œä»¥å®ç°æ°´å¹³æ‰©å±•å’Œå®¹é”™ã€‚ä¸€ä¸ªBrokerä¸Šå¯èƒ½å­˜å‚¨å¤šä¸ªä¸åŒTopicçš„åˆ†åŒºå‰¯æœ¬ã€‚ä¸€ä¸ªTopicå¯ä»¥è¢«<strong>å¤šä¸ªæ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰ç‹¬ç«‹æ¶ˆè´¹</strong>ï¼Œæ¯ä¸ªæ¶ˆè´¹ç»„ç»´æŠ¤è‡ªå·±çš„æ¶ˆè´¹è¿›åº¦ï¼ˆOffsetï¼‰ï¼Œä»è€Œå®ç°â€œå‘å¸ƒ-è®¢é˜…â€æ¨¡å¼ã€‚</p><p>Kafkaç”Ÿäº§è€…é€šè¿‡ä»¥ä¸‹ç­–ç•¥å°†æ¶ˆæ¯å‘é€åˆ°Topicçš„æŸä¸ªåˆ†åŒºï¼š</p><ol><li><strong>æ˜¾å¼æŒ‡å®šåˆ†åŒº</strong>ï¼šç”Ÿäº§è€…ç›´æ¥æŒ‡å®šç›®æ ‡åˆ†åŒºã€‚</li><li><strong>æŒ‰Keyå“ˆå¸Œ</strong>ï¼šè‹¥æœªæŒ‡å®šåˆ†åŒºä½†æ¶ˆæ¯æœ‰Keyï¼Œåˆ™å¯¹Keyè¿›è¡Œå“ˆå¸Œï¼ˆé»˜è®¤Murmur2ç®—æ³•ï¼‰ï¼Œå†å¯¹åˆ†åŒºæ•°å–æ¨¡ï¼Œç¡®å®šç›®æ ‡åˆ†åŒºã€‚</li><li><strong>è½®è¯¢ï¼ˆRound Robinï¼‰</strong>ï¼šè‹¥æœªæŒ‡å®šåˆ†åŒºä¸”æ— Keyï¼Œåˆ™ä¾æ¬¡è½®è¯¢æ‰€æœ‰å¯ç”¨åˆ†åŒºã€‚</li></ol><p>Kafkaä¿è¯<strong>å•ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯é¡ºåºæ€§</strong>ï¼Œå³åŒä¸€åˆ†åŒºçš„æ¶ˆæ¯æŒ‰å†™å…¥é¡ºåºè¢«æ¶ˆè´¹è€…è¯»å–ã€‚è¦ä¿è¯å…¨å±€é¡ºåºï¼Œéœ€å°†æ‰€æœ‰ç›¸å…³æ¶ˆæ¯å‘é€åˆ°åŒä¸€åˆ†åŒºï¼ˆä¾‹å¦‚é€šè¿‡å›ºå®šKeyï¼‰ã€‚</p><p>Kafkaé€šè¿‡ä»¥ä¸‹æœºåˆ¶ç¡®ä¿é¡ºåºæ¶ˆè´¹ï¼š</p><ol><li><strong>åˆ†åŒºå•æ¶ˆè´¹è€…</strong>ï¼šåŒä¸€æ¶ˆè´¹ç»„ä¸­ï¼Œä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹ç‹¬å æ¶ˆè´¹ï¼Œé¿å…å¹¶å‘è¯»å–å¯¼è‡´ä¹±åºã€‚</li><li><strong>é¡ºåºå†™å…¥</strong>ï¼šç”Ÿäº§è€…å‘åˆ†åŒºè¿½åŠ æ¶ˆæ¯æ—¶ï¼Œä¿è¯å†™å…¥é¡ºåºï¼›æ¶ˆè´¹è€…æŒ‰Offseté¡ºåºè¯»å–ã€‚</li></ol><p>PSï¼šæ‰€ä»¥é€šè¿‡ä»¥ä¸Šäº†è§£ï¼ŒKafkaå¯ä»¥ä¿è¯åŒä¸€åˆ†åŒºå†…é¡ºåºæ¶ˆè´¹ï¼Œä½†æ˜¯ä¸ä¿è¯åˆ†åŒºä¹‹é—´é¡ºåºæ¶ˆè´¹ã€‚</p><h2 id="Kafkaæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±çš„ï¼Ÿ"><a href="#Kafkaæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±çš„ï¼Ÿ" class="headerlink" title="Kafkaæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±çš„ï¼Ÿ"></a>Kafkaæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±çš„ï¼Ÿ</h2><p>åŸºæœ¬åŸç†ï¼š</p><ol><li><strong>æ¶ˆæ¯å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶</strong>ï¼šKafka ä¸­çš„æ¶ˆæ¯é¦–å…ˆè¢«è¿½åŠ å†™å…¥åˆ°ä¸€ä¸ªç§°ä¸ºæ—¥å¿—ï¼ˆLogï¼‰çš„æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ—¥å¿—æ–‡ä»¶æ˜¯ä¸€ä¸ªæŒä¹…åŒ–çš„ã€æœ‰åºçš„ã€ä¸å¯ä¿®æ”¹çš„æ¶ˆæ¯è®°å½•ã€‚ã€</li><li><strong>ç£ç›˜å­˜å‚¨</strong>ï¼šä¸€æ—¦æ¶ˆæ¯å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå°±ä¼šè¢«å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚è¿™æ ·å³ä½¿ Kafka æœåŠ¡å‘ç”Ÿæ•…éšœã€Broker é‡å¯ï¼Œæ¶ˆæ¯æ•°æ®ä»ç„¶å¯ä»¥ä»ç£ç›˜ä¸ŠåŠ è½½å¹¶é‡æ–°æ„å»ºã€‚</li><li><strong>æ¶ˆæ¯ç´¢å¼•</strong>ï¼šä¸ºäº†å¿«é€Ÿæ£€ç´¢æ¶ˆæ¯ï¼ŒKafka ç»´æŠ¤äº†ä¸€ä¸ªæ¶ˆæ¯ç´¢å¼•ã€‚è¿™ä¸ªç´¢å¼•å­˜å‚¨äº†æ¯ä¸ªåˆ†åŒºä¸­æ¶ˆæ¯çš„åç§»é‡å’Œç‰©ç†ä½ç½®ï¼Œä½¿å¾— Kafka èƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œæ£€ç´¢æ¶ˆæ¯ã€‚</li><li><strong>å¤åˆ¶å’Œ ISR</strong>ï¼šä¸ºäº†è¿›ä¸€æ­¥æé«˜å¯é æ€§ï¼ŒKafka æ”¯æŒæ¶ˆæ¯çš„å¤åˆ¶ã€‚æ¯ä¸ªåˆ†åŒºçš„æ¶ˆæ¯å¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå®ƒä»¬åˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Šã€‚ISRï¼ˆIn-Sync Replicaï¼‰æœºåˆ¶ç¡®ä¿äº† Leader å’Œ Follower ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Œä¿éšœäº†æ¶ˆæ¯çš„æŒä¹…æ€§ã€‚</li></ol><p>å½“ Producer å‘é€æ¶ˆæ¯åˆ° Kafka Broker æ—¶ï¼Œè¿™äº›æ¶ˆæ¯é¦–å…ˆè¢«è¿½åŠ å†™å…¥åˆ°ä¸€ä¸ªç§°ä¸ºæ—¥å¿—æ–‡ä»¶çš„æ•°æ®æ–‡ä»¶ä¸­ã€‚æ¯ä¸ªä¸»é¢˜ï¼ˆTopicï¼‰çš„åˆ†åŒºéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ã€‚</p><p>æ¶ˆæ¯çš„å†™å…¥æ˜¯é¡ºåºçš„ï¼Œæ–°çš„æ¶ˆæ¯ä¼šè¢«è¿½åŠ åˆ°å·²æœ‰çš„æ—¥å¿—æ–‡ä»¶çš„æœ«å°¾ã€‚è¿™ç§é¡ºåºå†™å…¥æ–¹å¼å¯¹äºç£ç›˜çš„æ€§èƒ½æ˜¯å‹å¥½çš„ï¼Œä¹Ÿç¡®ä¿äº†æ¶ˆæ¯åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨æ˜¯æœ‰åºçš„ã€‚</p><p>å¯¹äºæ¯ä¸ªåˆ†åŒºï¼ŒKafka ç»´æŠ¤ä¸€ä¸ªæˆ–å¤šä¸ªæ—¥å¿—æ–‡ä»¶ã€‚æ¯ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­å­˜å‚¨çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§»é‡ï¼Œç”¨äºæ ‡è¯†æ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„ä½ç½®ã€‚</p><p>éšç€æ—¶é—´çš„æ¨ç§»æˆ–è€…è¾¾åˆ°ä¸€å®šå¤§å°ï¼Œæ—¥å¿—æ–‡ä»¶ä¼šå‘ç”Ÿæ»šåŠ¨ï¼ˆRollï¼‰ï¼Œå³æ–°çš„æ¶ˆæ¯å¼€å§‹å†™å…¥åˆ°ä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚è¿™ç¡®ä¿äº†æ—¥å¿—æ–‡ä»¶çš„å¤§å°æ˜¯å¯æ§çš„ã€‚</p><p>æ—¥å¿—æ–‡ä»¶è¢«è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºæ—¥å¿—æ®µï¼ˆLog Segmentï¼‰ã€‚ä¸€ä¸ªæ—¥å¿—æ®µåŒ…å«äº†ä¸€å®šèŒƒå›´å†…çš„æ¶ˆæ¯ï¼Œä»æŸä¸ªåç§»é‡å¼€å§‹ï¼Œåˆ°ä¸‹ä¸€ä¸ªæ»šåŠ¨ç‚¹æˆ–è€…æ–‡ä»¶ç»“å°¾ä¸ºæ­¢ã€‚</p><p>æ—¥å¿—æ®µçš„å¼•å…¥ä½¿å¾— Kafka èƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°ç®¡ç†ç£ç›˜ç©ºé—´ã€‚å½“ä¸€ä¸ªæ—¥å¿—æ®µå˜ä¸ºä¸å†æ´»è·ƒï¼ˆå·²ç»è¿‡æœŸæˆ–è€…è¢«å¤åˆ¶åˆ°å…¶ä»– Brokerï¼‰æ—¶ï¼Œå®ƒå¯ä»¥è¢«åˆ é™¤æˆ–å½’æ¡£ã€‚</p><p>æ¯ä¸ªæ—¥å¿—æ®µéƒ½æœ‰ä¸€ä¸ªä¿ç•™æ—¶é—´ï¼ˆTTLï¼‰æˆ–ä¿ç•™å¤§å°ã€‚å½“æ—¥å¿—æ®µè¾¾åˆ°è¿™ä¸ªä¿ç•™æ—¶é—´æˆ–ä¿ç•™å¤§å°æ—¶ï¼Œå®ƒå°±å¯ä»¥è¢«åˆ é™¤ã€‚è¿™ç¡®ä¿äº† Kafka çš„ç£ç›˜ç©ºé—´è¢«æœ‰æ•ˆåœ°ç®¡ç†ã€‚</p><p>Kafka ä½¿ç”¨æ—¥å¿—æ®µçš„ç´¢å¼•æ¥å¿«é€Ÿå®šä½å’Œæ£€ç´¢æ¶ˆæ¯ã€‚ç´¢å¼•å­˜å‚¨äº†æ¯æ¡æ¶ˆæ¯çš„åç§»é‡å’Œç‰©ç†ä½ç½®ï¼Œç¡®ä¿äº†æ¶ˆæ¯çš„å¿«é€Ÿæ£€ç´¢ã€‚</p><p>ç®€å•ä¸€å¥è¯ï¼Œåœ¨Kafkaä¸­é€šè¿‡æ—¥å¿—æ¥ä¿è¯å…¶æŒä¹…åŒ–ï¼Œä»¥ä¾¿å…¶ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚æ¯ä¸€ä¸ªåˆ†åŒºä¼šç»´æŠ¤ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ä¼šå­˜åœ¨ä¸‰ç§ç±»å‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503251652645.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åŒæ—¶ä¸ºäº†é¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§å¯¼è‡´å…¶IOæ“ä½œè¿‡äºè€—æ—¶ï¼Œæ‰€ä»¥Kafkaé‡‡ç”¨äº†åˆ†æ®µæ—¥å¿—çš„å½¢å¼æ¥è§£å†³ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶è¿‡é•¿çš„é—®é¢˜ã€‚</p><h2 id="Kafkaçš„ç¡®è®¤æœºåˆ¶ä¸RocketMQç¡®è®¤æœºåˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Kafkaçš„ç¡®è®¤æœºåˆ¶ä¸RocketMQç¡®è®¤æœºåˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="Kafkaçš„ç¡®è®¤æœºåˆ¶ä¸RocketMQç¡®è®¤æœºåˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«"></a>Kafkaçš„ç¡®è®¤æœºåˆ¶ä¸<strong>RocketMQ</strong>ç¡®è®¤æœºåˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«</h2><ul><li>ACK&#x3D;0ï¼šè¿™æ˜¯æœ€ä¸å¯é çš„æ¨¡å¼ã€‚ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯åä¸ä¼šç­‰å¾…æ¥è‡ªæœåŠ¡å™¨çš„ç¡®è®¤ã€‚è¿™æ„å‘³ç€æ¶ˆæ¯å¯èƒ½ä¼šåœ¨å‘é€ä¹‹åä¸¢å¤±ï¼Œè€Œç”Ÿäº§è€…å°†æ— æ³•çŸ¥é“å®ƒæ˜¯å¦æˆåŠŸåˆ°è¾¾æœåŠ¡å™¨ã€‚</li><li>ACK&#x3D;1ï¼šè¿™æ˜¯é»˜è®¤æ¨¡å¼ï¼Œä¹Ÿæ˜¯ä¸€ç§æŠ˜è¡·æ–¹å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç”Ÿäº§è€…ä¼šåœ¨æ¶ˆæ¯å‘é€åç­‰å¾…æ¥è‡ªåˆ†åŒºé¢†å¯¼è€…ï¼ˆleaderï¼‰çš„ç¡®è®¤ï¼Œä½†ä¸ä¼šç­‰å¾…æ‰€æœ‰å‰¯æœ¬ï¼ˆreplicasï¼‰çš„ç¡®è®¤ã€‚è¿™æ„å‘³ç€åªè¦æ¶ˆæ¯è¢«å†™å…¥åˆ†åŒºé¢†å¯¼è€…ï¼Œç”Ÿäº§è€…å°±ä¼šæ”¶åˆ°ç¡®è®¤ã€‚å¦‚æœåˆ†åŒºé¢†å¯¼è€…æˆåŠŸå†™å…¥æ¶ˆæ¯ï¼Œä½†åœ¨åŒæ­¥åˆ°æ‰€æœ‰å‰¯æœ¬ä¹‹å‰å®•æœºï¼Œæ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ã€‚</li><li>ACK&#x3D;-1ï¼šè¿™æ˜¯æœ€å¯é çš„æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç”Ÿäº§è€…ä¼šåœ¨æ¶ˆæ¯å‘é€åç­‰å¾…æ‰€æœ‰å‰¯æœ¬çš„ç¡®è®¤ã€‚åªæœ‰åœ¨æ‰€æœ‰å‰¯æœ¬éƒ½æˆåŠŸå†™å…¥æ¶ˆæ¯åï¼Œç”Ÿäº§è€…æ‰ä¼šæ”¶åˆ°ç¡®è®¤ã€‚è¿™ç¡®ä¿äº†æ¶ˆæ¯çš„å¯é æ€§ï¼Œä½†ä¼šå¯¼è‡´æ›´é•¿çš„å»¶è¿Ÿã€‚</li></ul><p>è¿™æ˜¯åº”ä¸ºKafkaå¤©ç„¶çš„ä¸ºé›†ç¾¤è€Œè®¾è®¡çš„ï¼Œå…¶è®¾è®¡ä¹‹åˆå°±ä¸ºäº†ä¿è¯é«˜å¯ç”¨é‡‡ç”¨äº†é›†ç¾¤çš„å½¢å¼ã€‚å…¶ç”Ÿäº§è€…å‘é€Kafkaæ¶ˆæ¯çš„æ—¶å€™ï¼Œå…¶ä¼šç”±Kafkaçš„leaderèŠ‚ç‚¹è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼Œä½†æ˜¯ä¹Ÿä¼šå¯¹å…¶å‰¯æœ¬è¿›è¡ŒæŒä¹…åŒ–æ“ä½œã€‚é‚£ä¹ˆé’ˆå¯¹è¿™å‡ ç§æƒ…å†µå°±æœ‰äº†å…¶ACKç¡®è®¤çš„ä¸‰ç§å½¢å¼ã€‚</p><p>RocketMQ æä¾›äº†ä¸‰ç§æ¶ˆæ¯å‘é€æ–¹å¼ï¼šåŒæ­¥å‘é€ã€å¼‚æ­¥å‘é€å’Œå•å‘å‘é€ï¼š </p><ul><li>åŒæ­¥å‘é€ï¼šæ˜¯æŒ‡æ¶ˆæ¯å‘é€æ–¹å‘å‡ºä¸€æ¡æ¶ˆæ¯åï¼Œä¼šåœ¨æ”¶åˆ°æœåŠ¡ç«¯åŒæ­¥å“åº”ä¹‹åæ‰å‘ä¸‹ä¸€æ¡æ¶ˆæ¯çš„é€šè®¯æ–¹å¼ã€‚åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚é‡è¦é€šçŸ¥é‚®ä»¶ã€æŠ¥åçŸ­ä¿¡é€šçŸ¥ã€è¥é”€çŸ­ä¿¡ç³»ç»Ÿç­‰ã€‚</li><li>å¼‚æ­¥å‘é€ï¼šæ˜¯æŒ‡å‘é€æ–¹å‘å‡ºä¸€æ¡æ¶ˆæ¯åï¼Œä¸ç­‰æœåŠ¡ç«¯è¿”å›å“åº”ï¼Œæ¥ç€å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯çš„é€šè®¯æ–¹å¼ï¼Œä½†æ˜¯éœ€è¦å®ç°å¼‚æ­¥å‘é€å›è°ƒæ¥å£ï¼ˆSendCallbackï¼‰ã€‚æ¶ˆæ¯å‘é€æ–¹åœ¨å‘é€äº†ä¸€æ¡æ¶ˆæ¯åï¼Œä¸éœ€è¦ç­‰å¾…æœåŠ¡ç«¯å“åº”å³å¯å‘é€ç¬¬äºŒæ¡æ¶ˆæ¯ã€‚å‘é€æ–¹é€šè¿‡å›è°ƒæ¥å£æ¥æ”¶æœåŠ¡ç«¯å“åº”ï¼Œå¹¶å¤„ç†å“åº”ç»“æœã€‚é€‚ç”¨äºé“¾è·¯è€—æ—¶è¾ƒé•¿ï¼Œå¯¹å“åº”æ—¶é—´è¾ƒä¸ºæ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ï¼Œä¾‹å¦‚ï¼Œè§†é¢‘ä¸Šä¼ åé€šçŸ¥å¯åŠ¨è½¬ç æœåŠ¡ï¼Œè½¬ç å®Œæˆåé€šçŸ¥æ¨é€è½¬ç ç»“æœç­‰ã€‚ </li><li>å•å‘å‘é€ï¼šå‘é€æ–¹åªè´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œä¸ç­‰å¾…æœåŠ¡ç«¯è¿”å›å“åº”ä¸”æ²¡æœ‰å›è°ƒå‡½æ•°è§¦å‘ï¼Œå³åªå‘é€è¯·æ±‚ä¸ç­‰å¾…åº”ç­”ã€‚æ­¤æ–¹å¼å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹è€—æ—¶éå¸¸çŸ­ï¼Œä¸€èˆ¬åœ¨å¾®ç§’çº§åˆ«ã€‚é€‚ç”¨äºæŸäº›è€—æ—¶éå¸¸çŸ­ï¼Œä½†å¯¹å¯é æ€§è¦æ±‚å¹¶ä¸é«˜çš„åœºæ™¯ï¼Œä¾‹å¦‚æ—¥å¿—æ”¶é›†ã€‚</li></ul><h2 id="Kafkaä¸€å®šä¸ä¼šå­˜åœ¨æ¶ˆæ¯ä¸¢å¤±å—"><a href="#Kafkaä¸€å®šä¸ä¼šå­˜åœ¨æ¶ˆæ¯ä¸¢å¤±å—" class="headerlink" title="Kafkaä¸€å®šä¸ä¼šå­˜åœ¨æ¶ˆæ¯ä¸¢å¤±å—"></a>Kafkaä¸€å®šä¸ä¼šå­˜åœ¨æ¶ˆæ¯ä¸¢å¤±å—</h2><p>KafkaBroker é›†ç¾¤æ¥æ”¶åˆ°æ•°æ®åä¼šå°†æ•°æ®è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨åˆ°ç£ç›˜ï¼Œä¸ºäº†æé«˜ååé‡å’Œæ€§èƒ½ï¼Œé‡‡ç”¨çš„æ˜¯ã€Œ<strong>å¼‚æ­¥æ‰¹é‡åˆ·ç›˜çš„ç­–ç•¥</strong>ã€ï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‰ç…§ä¸€å®šçš„æ¶ˆæ¯é‡å’Œé—´éš”æ—¶é—´è¿›è¡Œåˆ·ç›˜ã€‚é¦–å…ˆä¼šå°†æ•°æ®å­˜å‚¨åˆ° ã€Œ<strong>PageCache</strong>ã€ ä¸­ï¼Œè‡³äºä»€ä¹ˆæ—¶å€™å°† Cache ä¸­çš„æ•°æ®åˆ·ç›˜æ˜¯ç”±ã€Œ<strong>æ“ä½œç³»ç»Ÿ</strong>ã€æ ¹æ®è‡ªå·±çš„ç­–ç•¥å†³å®šæˆ–è€…è°ƒç”¨ fsync å‘½ä»¤è¿›è¡Œå¼ºåˆ¶åˆ·ç›˜ï¼Œå¦‚æœæ­¤æ—¶ Broker å®•æœº Crash æ‰ï¼Œä¸”é€‰ä¸¾äº†ä¸€ä¸ªè½å Leader Partition å¾ˆå¤šçš„ Follower Partition æˆä¸ºæ–°çš„ Leader Partitionï¼Œé‚£ä¹ˆè½åçš„æ¶ˆæ¯æ•°æ®å°±ä¼šä¸¢å¤±ã€‚</p><blockquote><p><strong>ç—›ç‚¹</strong>ï¼š</p><ul><li><strong>è¿ç»´å¤æ‚åº¦é«˜</strong>ï¼šéœ€ç‹¬ç«‹ç»´æŠ¤ZooKeeperé›†ç¾¤ï¼Œå¢åŠ è¿ç»´è´Ÿæ‹…ã€‚</li><li><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šZooKeeperçš„å†™æ€§èƒ½é™åˆ¶äº†Kafkaé›†ç¾¤è§„æ¨¡ï¼ˆå¦‚ç™¾ä¸‡çº§åˆ†åŒºåœºæ™¯ï¼‰ã€‚</li><li><strong>è„‘è£‚é£é™©</strong>ï¼šç½‘ç»œåˆ†åŒºæ—¶ï¼ŒZooKeeperå’ŒKafka Controllerå¯èƒ½çŠ¶æ€ä¸ä¸€è‡´ã€‚</li><li><strong>æ‰©å±•æ€§å·®</strong>ï¼šZooKeeperé›†ç¾¤è§„æ¨¡å—é™ï¼ˆé€šå¸¸3-5èŠ‚ç‚¹ï¼‰ï¼Œè€ŒKafkaé›†ç¾¤å¯æ‰©å±•è‡³æ•°ç™¾èŠ‚ç‚¹ã€‚</li></ul></blockquote><h2 id="Kafkaé€‰æ‹©ä½¿ç”¨raftåè®®å®ç°zraftä»£æ›¿zk"><a href="#Kafkaé€‰æ‹©ä½¿ç”¨raftåè®®å®ç°zraftä»£æ›¿zk" class="headerlink" title="Kafkaé€‰æ‹©ä½¿ç”¨raftåè®®å®ç°zraftä»£æ›¿zk"></a>Kafkaé€‰æ‹©ä½¿ç”¨raftåè®®å®ç°zraftä»£æ›¿zk</h2><p>æ˜¯çš„ï¼ŒKafkaå¼•å…¥<strong>KRaftæ¨¡å¼</strong>ï¼ˆå³Kafka Raft Metadataæ¨¡å¼ï¼Œç®€ç§°KRaftï¼‰çš„æ ¸å¿ƒç›®æ ‡ä¹‹ä¸€æ­£æ˜¯ä¸ºäº†<strong>æ¶ˆé™¤Kafkaå¯¹ZooKeeperçš„å¼ºä¾èµ–</strong>ï¼Œå°†å…ƒæ•°æ®ç®¡ç†å’Œé›†ç¾¤åè°ƒåŠŸèƒ½å®Œå…¨å†…åŒ–åˆ°Kafkaè‡ªèº«ä¸­ã€‚è¿™æ˜¯Kafkaç¤¾åŒºè¿‘å¹´æ¥æœ€é‡è¦çš„æ¶æ„æ¼”è¿›ä¹‹ä¸€ï¼Œè§£å†³äº†ZooKeeperå¸¦æ¥çš„å¤æ‚æ€§å’Œæ€§èƒ½ç“¶é¢ˆé—®é¢˜ã€‚</p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>åœ¨2025å¹´3æœˆ18æ—¥å®£å¸ƒå‘å¸ƒApache Kafka 4.0.0ç‰ˆæœ¬ï¼ŒApache Kafka 4.0.0 æ˜¯ Kafkaçš„ä¸€ä¸ªé‡è¦é‡Œç¨‹ç¢‘ï¼Œæ ‡å¿—ç€å…¶æ¶æ„çš„é‡å¤§è½¬å˜ã€‚æ ‡å¿—ç€ç¬¬ä¸€ä¸ªå®Œå…¨ä¸ä½¿ç”¨Apache ZooKeeperçš„ä¸»è¦ç‰ˆæœ¬ï¼Œé»˜è®¤è¿è¡Œåœ¨KRaftæ¨¡å¼ä¸‹ï¼Œç®€åŒ–äº†Kafkaçš„éƒ¨ç½²å’Œç®¡ç†ã€‚<strong>æ¶ˆé™¤äº†ç»´æŠ¤å•ç‹¬ZooKeeperé›†æˆçš„å¤æ‚æ€§</strong>ã€‚è¿™ä¸€æ›´æ”¹æ˜¾è‘—é™ä½äº†è¿è¥å¼€é”€ï¼Œå¢å¼ºäº†å¯æ‰©å±•æ€§ï¼Œå¹¶ç®€åŒ–äº†ç®¡ç†ä»»åŠ¡</p><h3 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h3><p>KRaftæ¨¡å¼é€šè¿‡<strong>å†…åµŒRaftå…±è¯†ç®—æ³•</strong>ï¼Œå°†å…ƒæ•°æ®ç®¡ç†å’Œé›†ç¾¤åè°ƒåŠŸèƒ½è½¬ç§»åˆ°Kafkaè‡ªèº«ï¼Œå®Œå…¨å»é™¤äº†ZooKeeperã€‚</p><h4 id="1-å…ƒæ•°æ®åˆ†åŒºï¼ˆMetadata-Topicï¼‰"><a href="#1-å…ƒæ•°æ®åˆ†åŒºï¼ˆMetadata-Topicï¼‰" class="headerlink" title="1. å…ƒæ•°æ®åˆ†åŒºï¼ˆMetadata Topicï¼‰"></a>1. <strong>å…ƒæ•°æ®åˆ†åŒºï¼ˆMetadata Topicï¼‰</strong></h4><blockquote><ul><li><strong>å…ƒæ•°æ®å­˜å‚¨</strong>ï¼šTopicã€åˆ†åŒºã€Brokerã€æ¶ˆè´¹è€…ç»„ç­‰å…ƒæ•°æ®ã€‚</li><li><strong>é›†ç¾¤åè°ƒ</strong>ï¼šControlleré€‰ä¸¾ã€Brokeræ³¨å†Œã€åˆ†åŒºLeaderé€‰ä¸¾ç­‰ã€‚</li><li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šä¿éšœæ“ä½œçš„åŸå­æ€§ã€‚</li></ul></blockquote><ul><li>Kafkaä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å†…éƒ¨Topicï¼ˆ<code>__cluster_metadata</code>ï¼‰å­˜å‚¨æ‰€æœ‰å…ƒæ•°æ®ã€‚</li><li>è¯¥Topicç”±<strong>Raftåè®®</strong>ç®¡ç†ï¼Œé€šè¿‡å¤šä¸ªKafkaèŠ‚ç‚¹ï¼ˆç§°ä¸ºControllerèŠ‚ç‚¹ï¼‰ç»„æˆRafté›†ç¾¤ï¼Œè´Ÿè´£å…ƒæ•°æ®çš„è¯»å†™å’Œå¤åˆ¶ã€‚</li></ul><h4 id="2-Controllerè§’è‰²çš„è¿›åŒ–"><a href="#2-Controllerè§’è‰²çš„è¿›åŒ–" class="headerlink" title="2. Controllerè§’è‰²çš„è¿›åŒ–"></a>2. <strong>Controllerè§’è‰²çš„è¿›åŒ–</strong></h4><ul><li><strong>ä¼ ç»Ÿæ¨¡å¼</strong>ï¼šå•ä¸ªActive Controllerï¼ˆä¾èµ–ZooKeeperé€‰ä¸¾ï¼‰ã€‚</li><li><strong>KRaftæ¨¡å¼</strong>ï¼šå¤šä¸ªControllerèŠ‚ç‚¹ç»„æˆRafté›†ç¾¤ï¼Œé€šè¿‡é€‰ä¸¾äº§ç”ŸLeader Controllerï¼Œå…¶ä»–èŠ‚ç‚¹ä½œä¸ºFollowerã€‚</li><li><strong>èŒè´£</strong>ï¼šå…ƒæ•°æ®ç®¡ç†ã€Brokeræ³¨å†Œã€åˆ†åŒºLeaderé€‰ä¸¾ç­‰ï¼Œå…¨éƒ¨ç”±Raftåè®®ä¿éšœä¸€è‡´æ€§ã€‚</li></ul><h4 id="3-Raftåè®®çš„ä½œç”¨"><a href="#3-Raftåè®®çš„ä½œç”¨" class="headerlink" title="3. Raftåè®®çš„ä½œç”¨"></a>3. <strong>Raftåè®®çš„ä½œç”¨</strong></h4><ul><li><strong>æ—¥å¿—å¤åˆ¶</strong>ï¼šå…ƒæ•°æ®å˜æ›´ä»¥æ—¥å¿—å½¢å¼å¤åˆ¶åˆ°æ‰€æœ‰ControllerèŠ‚ç‚¹ã€‚</li><li><strong>Leaderé€‰ä¸¾</strong>ï¼šRaftåè®®è‡ªåŠ¨å¤„ç†Controller Leaderæ•…éšœè½¬ç§»ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šä¿è¯å…ƒæ•°æ®æ“ä½œçš„å¼ºä¸€è‡´æ€§ï¼ˆçº¿æ€§ä¸€è‡´æ€§ï¼‰ã€‚</li></ul><h3 id="Kafka-4-0-0ç‰ˆæœ¬æ›´æ–°ç‰¹æ€§"><a href="#Kafka-4-0-0ç‰ˆæœ¬æ›´æ–°ç‰¹æ€§" class="headerlink" title="Kafka 4.0.0ç‰ˆæœ¬æ›´æ–°ç‰¹æ€§"></a>Kafka 4.0.0ç‰ˆæœ¬æ›´æ–°ç‰¹æ€§</h3><h4 id="KIP-996ï¼šé¢„æŠ•ç¥¨æœºåˆ¶"><a href="#KIP-996ï¼šé¢„æŠ•ç¥¨æœºåˆ¶" class="headerlink" title="KIP-996ï¼šé¢„æŠ•ç¥¨æœºåˆ¶"></a>KIP-996ï¼šé¢„æŠ•ç¥¨æœºåˆ¶</h4><p>KRaftæ¨¡å¼ä¸‹ï¼ŒèŠ‚ç‚¹å¯èƒ½å› ç¬æ—¶ç½‘ç»œé—®é¢˜ï¼ˆå¦‚ GC æš‚åœï¼‰è¯¯åˆ¤é¢†å¯¼è€…å¤±è”ï¼Œè§¦å‘ä¸å¿…è¦çš„é€‰ä¸¾ï¼Œå¯¼è‡´ï¼š</p><ol><li>é›†ç¾¤æ³¢åŠ¨ï¼šé¢‘ç¹é¢†å¯¼è€…åˆ‡æ¢å½±å“ååé‡</li><li>å…ƒæ•°æ®ç«äº‰ï¼šå¤šä¸ªèŠ‚ç‚¹åŒæ—¶å‘èµ·é€‰ä¸¾å¼•å‘è„‘è£‚é£é™©</li></ol><p>é¢„æŠ•ç¥¨æœºåˆ¶åŸç†</p><ol><li><p>é¢„æŠ•ç¥¨é˜¶æ®µï¼š</p></li><li><p>èŠ‚ç‚¹æ„ŸçŸ¥é¢†å¯¼è€…å¤±è”åï¼Œå…ˆå‘å…¶ä»–èŠ‚ç‚¹å‘é€é¢„æŠ•ç¥¨è¯·æ±‚ï¼ˆæºå¸¦è‡ªèº«æ—¥å¿—æœ€æ–°åç§»é‡ï¼‰</p></li></ol><p>æ¥æ”¶èŠ‚ç‚¹æ£€æŸ¥è¯·æ±‚è€…æ—¥å¿—æ˜¯å¦è¶³å¤Ÿæ–°ï¼ˆé¿å…è½åå‰¯æœ¬æˆä¸ºé¢†å¯¼è€…ï¼‰</p><p>æ­£å¼é€‰ä¸¾ï¼š</p><ul><li><p>ä»…å½“è·å¾—å¤šæ•°é¢„æŠ•ç¥¨è®¤å¯åï¼ŒèŠ‚ç‚¹æ‰å‘èµ·æ­£å¼é€‰ä¸¾</p></li><li><p>å¦åˆ™è¿›å…¥å†·å´æœŸï¼ˆelection.backoff.msï¼‰</p></li></ul><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ol><li><a href="https://kafka1x.apachecn.org/intro.html">Kafkaå®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://blog.csdn.net/qq_32828253/article/details/110732652">Kafka è®¾è®¡æ¶æ„åŸç†è¯¦ç»†è§£æï¼ˆè¶…è¯¦ç»†å›¾è§£ï¼‰</a></li><li><a href="https://blog.csdn.net/Mrxiao_bo/article/details/136545326">æ·±å…¥äº†è§£Kafkaçš„æ•°æ®æŒä¹…åŒ–æœºåˆ¶</a></li><li><a href="https://blog.csdn.net/qq_42651904/article/details/146379501">Apache Kafka 4.0æ­£å¼å‘å¸ƒï¼Œé¦–ä¸ªé»˜è®¤KRaftæ¨¡å¼è¿è¡Œï¼Œç§»é™¤å•ç‹¬ç»´æŠ¤Zookeeperé™ä½å¤æ‚æ€§</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ¶ˆæ¯é˜Ÿåˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-37 è™šæ‹Ÿçº¿ç¨‹</title>
      <link href="/2025/03/22/75-37%20%E8%99%9A%E6%8B%9F%E7%BA%BF%E7%A8%8B/"/>
      <url>/2025/03/22/75-37%20%E8%99%9A%E6%8B%9F%E7%BA%BF%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="75-37-è™šæ‹Ÿçº¿ç¨‹"><a href="#75-37-è™šæ‹Ÿçº¿ç¨‹" class="headerlink" title="75-37 è™šæ‹Ÿçº¿ç¨‹"></a>75-37 è™šæ‹Ÿçº¿ç¨‹</h1>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è™šæ‹Ÿçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-36 é€‚é…å™¨æ¨¡å¼</title>
      <link href="/2025/03/22/75-36%20%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/03/22/75-36%20%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="75-36-é€‚é…å™¨æ¨¡å¼"><a href="#75-36-é€‚é…å™¨æ¨¡å¼" class="headerlink" title="75-36 é€‚é…å™¨æ¨¡å¼"></a>75-36 é€‚é…å™¨æ¨¡å¼</h1><h2 id="ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼</h2><p>é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ä¸å…¼å®¹çš„å¯¹è±¡è½¬æ¢æˆå¯å…¼å®¹çš„æ¥å£ã€‚ä¸»è¦ç›®çš„æ˜¯è§£å†³åœ¨ä¸æ”¹å˜ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œ<strong>ä½¿ä¸å…¼å®¹çš„æ¥å£ä¹‹é—´èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ</strong>ï¼Œé€šè¿‡åˆ›å»ºä¸€ä¸ªä¸­é—´è½¬æ¢çš„é€‚é…å™¨æ¥å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆæˆ‘ä»¬æ‰€éœ€è¦çš„æ¥å£ã€‚</p><h2 id="è§’è‰²ç»„æˆ"><a href="#è§’è‰²ç»„æˆ" class="headerlink" title="è§’è‰²ç»„æˆ"></a>è§’è‰²ç»„æˆ</h2><ul><li><strong>ç›®æ ‡æ¥å£ï¼ˆtargetï¼‰</strong>ï¼šéœ€è¦é€‚é…çš„æ ‡å‡†æ¥å£ã€‚</li><li><strong>æºå¯¹è±¡ï¼ˆsourceï¼‰</strong>ï¼šéœ€è¦è¢«é€‚é…çš„ä¸å…¼å®¹å¯¹è±¡ã€‚</li><li><strong>é€‚é…å™¨å¯¹è±¡ï¼ˆadapterï¼‰</strong>ï¼šå……å½“ä¸­é—´è½¬æ¢è§’è‰²ï¼Œè¯¥å¯¹è±¡å°†æºå¯¹è±¡è½¬æ¢æˆç›®æ ‡æ¥å£ã€‚</li></ul><h2 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h2><ul><li>å½“éœ€è¦ä½¿ç”¨ä¸€ä¸ªç°å­˜çš„ç±»ï¼Œä½†å®ƒæä¾›çš„æ¥å£ä¸æˆ‘ä»¬ç³»ç»Ÿçš„æ¥å£ä¸å…¼å®¹ï¼Œè€Œæˆ‘ä»¬è¿˜ä¸èƒ½ä¿®æ”¹å®ƒæ—¶</li><li>å½“å¤šä¸ªå›¢é˜Ÿç‹¬ç«‹å¼€å‘ç³»ç»Ÿçš„å„åŠŸèƒ½æ¨¡å—ï¼Œç„¶åç»„åˆåœ¨ä¸€èµ·ï¼Œä½†ç”±äºæŸäº›åŸå› äº‹å…ˆä¸èƒ½ç¡®å®šæ¥å£æ—¶ã€‚ï¼ˆåˆ«å’Œæˆ‘è¯´è¿™ä¸å¯èƒ½ï¼Œè¿™å¤ªtmå¯èƒ½äº†ï¼‰</li></ul><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šä¸€ä¸‹æˆ‘ä»¬éœ€è¦å…¼å®¹çš„ç›®æ ‡æ¥å£ï¼Œæ¯”å¦‚å°±æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LogFactory</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">debug</span><span class="params">(String tag,String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„ä¸€ä¸ªæ–°çš„æ—¥å¿—åŠŸèƒ½ï¼Œä¸”æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä½¿ç”¨åŸæ¥çš„æ—¥å¿—æ¥å£ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå¹¶ä¸å…¼å®¹ï¼Œä¸”æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹åŸæœ‰æ¥å£çš„ä»£ç çš„æƒ…å†µä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NbLogger</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">d</span><span class="params">(<span class="type">int</span> priority, String message, Object ... obj)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…·ä½“æä¾›æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NbLoggerImp</span> <span class="keyword">implements</span> <span class="title class_">NbLogger</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">d</span><span class="params">(<span class="type">int</span> priority, String message, Object... obj)</span> &#123;</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;ç‰›é€¼loggerè®°å½•:%s&quot;</span>,message));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¼•å…¥ä¸€ä¸ªé€‚é…å™¨ç±»ï¼Œæ¥ä¸­å’Œè¿™ä¸¤ä¸ªä¸å…¼å®¹çš„æƒ…å†µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAdapter</span> <span class="keyword">implements</span> <span class="title class_">LogFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> NbLogger nbLogger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LogAdapter</span><span class="params">(NbLogger nbLogger)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nbLogger = nbLogger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debug</span><span class="params">(String tag, String message)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(nbLogger);</span><br><span class="line">        nbLogger.d(<span class="number">1</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> é€‚é…å™¨æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-35 åŠ¨æ€ä»£ç†</title>
      <link href="/2025/03/21/75-35%20JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
      <url>/2025/03/21/75-35%20JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="75-35-åŠ¨æ€ä»£ç†"><a href="#75-35-åŠ¨æ€ä»£ç†" class="headerlink" title="75-35 åŠ¨æ€ä»£ç†"></a>75-35 åŠ¨æ€ä»£ç†</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>JDK åŠ¨æ€ä»£ç†çš„æå‡ºèƒŒæ™¯æ˜¯ä¸ºäº†è§£å†³ <strong>ä»£ç ä¾µå…¥æ€§</strong> å’Œ <strong>æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆCross-Cutting Concernsï¼‰çš„å¤ç”¨é—®é¢˜</strong>ï¼Œæ ¸å¿ƒæ˜¯è®©å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹åŸå§‹ä»£ç çš„å‰æä¸‹ï¼Œ<strong>åŠ¨æ€åœ°ä¸ºå¯¹è±¡æ·»åŠ é¢å¤–çš„é€»è¾‘</strong>ã€‚</p><p>å°±æ¯”å¦‚ç°åœ¨æˆ‘ä»¬æœ‰ä¸€æ®µå…¬ç”¨é€»è¾‘ï¼Œè¿™æ®µé€»è¾‘éœ€è¦å‡ºç°åœ¨å¤§é‡çš„æ–¹æ³•å¤„ç†ä¹‹å‰æˆ–è€…ä¹‹åç­‰å…¶ä»–æƒ…å†µä¸‹ï¼Œåœ¨æ²¡æœ‰åŠ¨æ€ä»£ç†çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç¡¬ç¼–ç å†ä»£ç ä¸­ï¼Œä¸€æ–¹é¢è€¦åˆåº¦éå¸¸é«˜ï¼Œä¸”ä»£ç é‡å¤åº¦ä¹Ÿå¾ˆé«˜ï¼Œæ²¡æœ‰åšåˆ°ä»£ç å¤ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬å°±æƒ³ï¼Œæ˜¯å¦å¯ä»¥æŠŠè¿™æ®µå…¬ç”¨çš„é€»è¾‘ä»£ç æå–å‡ºæ¥ï¼Œç„¶ååœ¨éœ€è¦çš„æ–¹æ³•å¼€å¤´æˆ–è€…ç»“å°¾æˆ–è€…ç­‰æƒ…å†µä¸‹è¿›è¡ŒåŠ¨æ€çš„æŠŠè¿™æ®µä»£ç ç¼–å…¥è¿›è¡Œï¼Œè‡ªåŠ¨åŒ–çš„ï¼è¯¶æ²¡é”™ï¼Œè¿™å°±æ¶‰åŠåˆ°åŠ¨æ€ä»£ç†äº†ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†å‘¢ï¼Ÿ</p><h2 id="ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†"><a href="#ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†" class="headerlink" title="ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†"></a>ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†</h2><p>åŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰æ˜¯ä¸€ç§åœ¨ <strong>è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡</strong> çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨ä¸ä¿®æ”¹åŸå§‹ä»£ç çš„å‰æä¸‹ï¼Œ<strong>é€æ˜åœ°ä¸ºç›®æ ‡å¯¹è±¡æ·»åŠ é¢å¤–çš„åŠŸèƒ½</strong>ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™æ ¡éªŒç­‰ï¼‰ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡â€œ<strong>ä»£ç†å¯¹è±¡</strong>â€åœ¨<strong>è°ƒç”¨è€…</strong>å’Œ<strong>å®é™…å¯¹è±¡</strong>ä¹‹é—´æ’å…¥ä¸€å±‚é—´æ¥å±‚ï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡æ–¹æ³•çš„ç»Ÿä¸€å¢å¼ºæˆ–æ‹¦æˆªã€‚</p><h2 id="åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒä»·å€¼"><a href="#åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒä»·å€¼" class="headerlink" title="åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒä»·å€¼"></a>åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒä»·å€¼</h2><ol><li><strong>è§£è€¦ä¸šåŠ¡é€»è¾‘ä¸é€šç”¨é€»è¾‘</strong><br>å°†æ—¥å¿—ã€äº‹åŠ¡ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆCross-Cutting Concernsï¼‰ä»ä¸šåŠ¡ä»£ç ä¸­å‰¥ç¦»ï¼Œå®ç°åŠŸèƒ½æ¨¡å—çš„<strong>é«˜å†…èšã€ä½è€¦åˆ</strong>ã€‚</li><li><strong>é¿å…ä»£ç é‡å¤</strong><br>é€šç”¨é€»è¾‘ï¼ˆå¦‚æƒé™æ ¡éªŒï¼‰åªéœ€ç¼–å†™ä¸€æ¬¡ï¼Œå³å¯é€šè¿‡ä»£ç†åº”ç”¨åˆ°å¤šä¸ªå¯¹è±¡çš„æ–¹æ³•ä¸Šã€‚</li><li><strong>åŠ¨æ€æ‰©å±•æ€§</strong><br>è¿è¡Œæ—¶æŒ‰éœ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œæ— éœ€é¢„å®šä¹‰ä»£ç†ç±»ï¼Œé€‚åˆæ¡†æ¶æˆ–åº“çš„è®¾è®¡ï¼ˆå¦‚ Spring AOPï¼‰ã€‚</li></ol><h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503212344748.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç†æ¨¡å¼æ˜¯ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ¥æ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ï¼Œèµ·åˆ°å¯¹ä»£ç†å¯¹è±¡å·²æœ‰åŠŸèƒ½çš„å¢å¼ºã€‚</span><br><span class="line">ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503212348962.png" alt="image-20250321234830921">ã€‚</p><h2 id="åŠ¨æ€ä»£ç†å®ç°"><a href="#åŠ¨æ€ä»£ç†å®ç°" class="headerlink" title="åŠ¨æ€ä»£ç†å®ç°"></a>åŠ¨æ€ä»£ç†å®ç°</h2><p>åŠ¨æ€ä»£ç†è¿™ä¸ªæ€æƒ³çš„å®ç°åœ¨JDKä¸­æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼ŒJDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†ã€‚ä¸‹é¢æ¥åˆ†åˆ«å¯¹å…¶åŸç†è¿›è¡Œä»‹ç»ã€‚</p><h3 id="JDKåŠ¨æ€ä»£ç†"><a href="#JDKåŠ¨æ€ä»£ç†" class="headerlink" title="JDKåŠ¨æ€ä»£ç†"></a>JDKåŠ¨æ€ä»£ç†</h3><p>JDKåŸç”ŸåŠ¨æ€ä»£ç†çš„ç»„æˆåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š <code>æŠ½è±¡ä¸»é¢˜è§’è‰²</code> ã€ <code>çœŸå®ä¸»é¢˜è§’è‰²</code> ã€ <code>å¢å¼ºä¸»é¢˜è§’è‰²</code> ã€‚</p><p>1ã€å®šä¹‰æŠ½è±¡ä¸»é¢˜è§’è‰²æ¥å£ <code>UserService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€å®šä¹‰çœŸå®ä¸»é¢˜è§’è‰²ç±» <code>UserServiceImpl</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡ŒUserService.select()æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡ŒUserService.update()æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€å®šä¹‰å¢åŠ ä¸»é¢˜è§’è‰²ç±» <code>LogHandler</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨äºå­˜å‚¨çœŸå®çš„è¢«ä»£ç†å¯¹è±¡</span></span><br><span class="line">    Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LogHandler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// çœŸå®æ–¹æ³•æ‰§è¡Œå‰çš„å¢å¼º</span></span><br><span class="line">        before(method.getName());</span><br><span class="line">        <span class="comment">// çœŸå®æ–¹æ³•æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        after(method.getName());</span><br><span class="line">        <span class="comment">// çœŸå®æ–¹æ³•æ‰§è¡Œåçš„å¢å¼º</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(String methodName)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;[%s] å‡†å¤‡å¼€å§‹æ‰§è¡Œ%sæ–¹æ³•%n&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), methodName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(String methodName)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;[%s] %sæ–¹æ³•æ–¹æ³•æ‰§è¡Œç»“æŸ%n&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), methodName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€ç¼–å†™å®¢æˆ·ç«¯ï¼ˆå…¶ä¸­æœ‰ç”Ÿäº§JDKåŸç”ŸåŠ¨æ€ä»£ç†çš„æ ¸å¿ƒä»£ç ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–è¢«ä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">targetInstance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–è¢«ä»£ç†å¯¹è±¡çš„ç±»åŠ è½½å™¨ï¼Œç”¨ä½œç”Ÿæˆä»£ç†å¯¹è±¡çš„å¿…è¦å‚æ•°</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> targetInstance.getClass().getClassLoader();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è·å–è¢«ä»£ç†å¯¹è±¡çš„å®ç°æ¥å£ï¼Œç”¨ä½œç”Ÿæˆä»£ç†å¯¹è±¡çš„å¿…è¦å‚æ•°</span></span><br><span class="line">        <span class="comment">// æ–¹æ³•æ˜ å°„å°±æ˜¯åŸºäºè¿™ä¸ªå‚æ•°å®ç°çš„</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = targetInstance.getClass().getInterfaces();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–è¢«ä»£ç†å¯¹è±¡çš„å¢å¼ºä¸»é¢˜ç±»ï¼Œç”¨ä½œç”Ÿæˆä»£ç†å¯¹è±¡çš„å¿…è¦å‚æ•°</span></span><br><span class="line">        <span class="type">LogHandler</span> <span class="variable">logHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogHandler</span>(targetInstance);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”Ÿæˆä»£ç†å¯¹è±¡çš„æ ¸å¿ƒä»£ç ï¼ï¼ï¼ï¼</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">proxyInstance</span> <span class="operator">=</span> (UserService)Proxy.newProxyInstance(classLoader, interfaces, logHandler);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        proxyInstance.select();</span><br><span class="line">        System.out.println();</span><br><span class="line">        proxyInstance.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CGLIBåŠ¨æ€ä»£ç†"><a href="#CGLIBåŠ¨æ€ä»£ç†" class="headerlink" title="CGLIBåŠ¨æ€ä»£ç†"></a>CGLIBåŠ¨æ€ä»£ç†</h3><p>åœ¨ä¸Šé¢çš„ 4.1 JDKåŸç”ŸåŠ¨æ€ä»£ç† æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åŠ¨æ€ä»£ç†çš„å®ç°æ˜¯åŸºäºæ¥å£å®ç°çš„ã€‚æœ¬ç« æˆ‘ä»¬å°†ä»‹ç» CGLIBåŠ¨æ€ä»£ç† ï¼ŒCGLIB å®ç°åŠ¨æ€ä»£ç†çš„æ–¹å¼ä¸ JDK ä»£ç†ç•¥æœ‰åŒºåˆ«ï¼Œ<strong>CGLIB æ˜¯åŸºäºç»§æ‰¿å®ç°çš„åŠ¨æ€ä»£ç†</strong>ï¼ŒCGLIB ä¼šç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†å­ç±»ï¼Œè¿™ä¸ªå­ç±»éœ€è¦é‡å†™è¢«ä»£ç†å¯¹è±¡çš„æ‰€æœ‰é finanl æ–¹æ³•ï¼Œåœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çš„çˆ¶ç±»æ–¹æ³•è°ƒç”¨ï¼Œé¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚</p><p>åœ¨ä»‹ç»åŸºäº CGLIB å®ç°åŠ¨æ€ä»£ç†ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆè¯´ä¸€ä¸‹å®ç°åŠ¨æ€ä»£ç†éœ€è¦å®ç°çš„å‡ ä¸ªæ¨¡å—ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡ï¼ˆæ™®é€šç±»ï¼Œä¸è¦æ±‚éœ€è¦å®ç°ä»€ä¹ˆæ¥å£ï¼‰ï¼›</p><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªå¢å¼ºç±»ï¼ˆæˆ‘ä»¬éœ€è¦ä»£ç†çš„ç›®çš„å°±æ˜¯ä¸ºäº†å®ç°å¯¹åŸæœ¬æ–¹æ³•çš„å¢å¼ºï¼‰ï¼Œæ‰€æœ‰çš„å¢å¼ºé€»è¾‘éƒ½åŸºäºå®ƒæ¥å®ç°ï¼Œå¢å¼ºç±»éœ€è¦å®ç° CGLIB çš„ MethodInterceptoræ¥å£ï¼Œå¹¶é‡å†™å…¶ä¸­å”¯ä¸€ä¸€ä¸ªæ–¹æ³• interceptï¼Œåé¢æ“ä½œå°±å¯ JDK çš„åŠ¨æ€ä»£ç†ç±»ä¼¼äº†ï¼ŒåŸºäºintercept æ–¹æ³•åŒºæ‰§è¡Œè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œå‰åå®Œæˆå¯¹è¢«ä»£ç†æ–¹æ³•çš„å¢å¼ºï¼›<br>æœ€åï¼Œæˆ‘ä»¬éœ€è¦åŸºäº CGLIB çš„å¯¹è±¡ç”Ÿæˆç›®æ ‡å¯¹è±¡çš„è¢«ä»£ç†å¯¹è±¡ã€‚</p><p>ç¼–å†™ä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡ <code>UserService</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡ŒUserService.select()æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡ŒUserService.update()æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¼–å†™å¯¹è¢«ä»£ç†å¯¹è±¡çš„å¢å¼ºç±» <code>LogInterceptor</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogInterceptor</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o           è¡¨ç¤ºè¦å¢å¼ºçš„å¯¹è±¡ï¼ˆè¢«ä»£ç†å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method      è¡¨ç¤ºè¢«æ‹¦æˆªçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objects     è¡¨ç¤ºå‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> methodProxy è¡¨ç¤ºå¯¹è¿æ¥æ–¹æ³•çš„ä»£ç†,invokeSuperæ–¹æ³•è¡¨ç¤ºå¯¹è¢«ä»£ç†å¯¹è±¡æ–¹æ³•çš„è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// å‰ç½®å¢å¼º</span></span><br><span class="line">        before(method.getName());</span><br><span class="line">        <span class="comment">// è°ƒç”¨è¢«å®é™…æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> methodProxy.invokeSuper(o, objects);</span><br><span class="line">        <span class="comment">// åç½®å¢å¼º</span></span><br><span class="line">        after(method.getName());</span><br><span class="line">        <span class="comment">// è¿”å›å®é™…å¯¹è±¡çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(String methodName)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;[%s] å‡†å¤‡å¼€å§‹æ‰§è¡Œ%sæ–¹æ³•%n&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), methodName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(String methodName)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;[%s] %sæ–¹æ³•æ–¹æ³•æ‰§è¡Œç»“æŸ%n&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), methodName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆä»£ç†å¯¹è±¡å¹¶æ‰§è¡Œä»£ç†æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// Enhancer ä¸º CGLIB ä»£ç†å¢å¼ºç±»</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        <span class="comment">// è®¾ç½®è¢«ä»£ç†ç±»ï¼ˆçˆ¶ç±»ï¼‰ï¼Œä»¥ä¾¿ CGLIB å»ç”Ÿæˆè¯¥ç±»çš„å­ç±»</span></span><br><span class="line">        enhancer.setSuperclass(UserService.class);</span><br><span class="line">        <span class="comment">// ä½ å¯ä»¥è®¤ä¸ºæ˜¯è®¾ç½®å¢å¼ºæ–¹æ³•</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">LogInterceptor</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”Ÿæˆä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) enhancer.create();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡Œä»£ç†æ–¹æ³•</span></span><br><span class="line">        proxy.select();</span><br><span class="line">        System.out.println();</span><br><span class="line">        proxy.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/m0_45067620/article/details/136176227?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522c0529b0413d06540ab7a90e11aa2fd76%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=c0529b0413d06540ab7a90e11aa2fd76&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-136176227-null-null.142%5Ev102%5Epc_search_result_base6&utm_term=%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86&spm=1018.2226.3001.4187">ã€Javaã€‘ä¸‡å­—è§£è¯»Javaçš„åŠ¨æ€ä»£ç†ï¼ˆJDKåŸç”ŸåŠ¨æ€ä»£ç†ã€CGLIBåŠ¨æ€ä»£ç†ï¼‰</a></li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŠ¨æ€ä»£ç† </tag>
            
            <tag> ä»£ç†æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-34 é™æµ&amp;é™çº§&amp;ç†”æ–­æœºåˆ¶</title>
      <link href="/2025/03/20/75-34%20%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/"/>
      <url>/2025/03/20/75-34%20%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="75-34-é™æµ-é™çº§-ç†”æ–­æœºåˆ¶"><a href="#75-34-é™æµ-é™çº§-ç†”æ–­æœºåˆ¶" class="headerlink" title="75-34 é™æµ&amp;é™çº§&amp;ç†”æ–­æœºåˆ¶"></a>75-34 é™æµ&amp;é™çº§&amp;ç†”æ–­æœºåˆ¶</h1><h2 id="ç†”æ–­"><a href="#ç†”æ–­" class="headerlink" title="ç†”æ–­"></a>ç†”æ–­</h2><p>ç†”æ–­æœºåˆ¶ï¼ˆCircuit Breakerï¼‰æ˜¯ä¸€ç§ä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§çš„é‡è¦æ‰‹æ®µã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯é˜²æ­¢ç³»ç»Ÿåœ¨ä¾èµ–çš„æœåŠ¡å‡ºç°é—®é¢˜æ—¶ï¼Œç»§ç»­å‘é€è¯·æ±‚ï¼Œä»è€Œä¿æŠ¤ç³»ç»Ÿå…å—è¿›ä¸€æ­¥çš„å½±å“ã€‚ç†”æ–­æœºåˆ¶é€šè¿‡ç›‘æ§è¯·æ±‚çš„æˆåŠŸå’Œå¤±è´¥ç‡ï¼Œåœ¨æ£€æµ‹åˆ°æ•…éšœç‡è¶…è¿‡é¢„è®¾é˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ç†”æ–­çŠ¶æ€ï¼Œåœæ­¢å¯¹æ•…éšœæœåŠ¡çš„è¯·æ±‚ã€‚ç†”æ–­çŠ¶æ€ä¸€æ®µæ—¶é—´åï¼Œå†å°è¯•æ¢å¤æœåŠ¡çš„è°ƒç”¨ã€‚</p><p><strong>ç†”æ–­æœºåˆ¶æ˜¯ä¸€ç§æœ‰æ•ˆçš„ä¿æŠ¤ç³»ç»Ÿçš„æ–¹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨ä¾èµ–å¤–éƒ¨æœåŠ¡æ—¶ã€‚é€šè¿‡åˆç†çš„ç†”æ–­é…ç½®ï¼Œå¯ä»¥é¿å…ç³»ç»Ÿå› ä¸ºå¤–éƒ¨æœåŠ¡æ•…éšœè€Œé™·å…¥å´©æºƒçŠ¶æ€ï¼Œä»è€Œæå‡ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</strong></p><h3 id="ç†”æ–­çš„ä¸‰ç§çŠ¶æ€"><a href="#ç†”æ–­çš„ä¸‰ç§çŠ¶æ€" class="headerlink" title="ç†”æ–­çš„ä¸‰ç§çŠ¶æ€"></a>ç†”æ–­çš„ä¸‰ç§çŠ¶æ€</h3><ol><li>é—­åˆçŠ¶æ€ï¼šæ­£å¸¸çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«å‘é€åˆ°ä¾èµ–æœåŠ¡ï¼Œç›‘æ§è¯·æ±‚çš„æˆåŠŸå’Œå¤±è´¥æƒ…å†µã€‚</li><li>æ–­å¼€çŠ¶æ€ï¼šå½“æ•…éšœç‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œç†”æ–­å™¨è¿›å…¥æ–­å¼€çŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šç«‹å³å¤±è´¥æˆ–è¿”å›å¤‡ç”¨æ–¹æ¡ˆï¼Œè€Œä¸ä¼šå‘é€åˆ°ä¾èµ–æœåŠ¡ã€‚</li><li>åŠå¼€çŠ¶æ€ï¼šåœ¨æ–­å¼€çŠ¶æ€ä¿æŒä¸€æ®µæ—¶é—´åï¼Œç†”æ–­å™¨å°è¯•æ¢å¤éƒ¨åˆ†è¯·æ±‚ï¼Œå¦‚æœéƒ¨åˆ†è¯·æ±‚æˆåŠŸï¼Œåˆ™æ¢å¤åˆ°é—­åˆçŠ¶æ€ï¼›å¦‚æœä»ç„¶å¤±è´¥ï¼Œåˆ™å›åˆ°æ–­å¼€çŠ¶æ€ã€‚</li></ol><h2 id="é™çº§"><a href="#é™çº§" class="headerlink" title="é™çº§"></a>é™çº§</h2><p>é™çº§æ˜¯å½“ç³»ç»Ÿè´Ÿè½½è¿‡é«˜æ—¶ï¼Œä¸»åŠ¨å…³é—­ä¸€äº›éæ ¸å¿ƒåŠŸèƒ½ï¼Œä»¥ç¡®ä¿æ ¸å¿ƒåŠŸèƒ½çš„æ­£å¸¸è¿è¡Œã€‚ä¸€èˆ¬ç”¨äºåœ¨ç³»ç»Ÿèµ„æºæœ‰é™æˆ–å“åº”æ—¶é—´è¿‡é•¿æ—¶ï¼Œé€šè¿‡é™ä½æœåŠ¡è´¨é‡ä¿éšœæ ¸å¿ƒæœåŠ¡ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼ŒåŒåä¸€æœŸé—´ï¼Œæ·˜å®ä¸Šé¢ä¼šæŠŠé€€æ¬¾åŠŸèƒ½å…³é—­ï¼Œè¿™å°±æ˜¯ä¸€ç§é™çº§æ‰‹æ®µï¼Œ<strong>é€šè¿‡æŠŠä¸€äº›éæ ¸å¿ƒåŠŸèƒ½é™çº§æ‰æ¥ä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨</strong>ã€‚æˆ–è€…åœ¨æŸæ¬¡è…¾è®¯è§†é¢‘æŒ‚äº†çš„æ—¶å€™ç”¨æˆ·åç§°é»˜è®¤æ˜¾ç¤ºè…¾è®¯ç”¨æˆ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§é™çº§æ–¹å¼ï¼Œç”¨å…œåº•åç§°åšå±•ç¤ºã€‚</p><p>é™çº§å¯ä»¥åœ¨å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡ç«¯ï¼Œæ¯”å¦‚å…³é—­éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½çš„è¯ï¼Œå¯ä»¥ç›´æ¥æŠŠå…¥å£å…³æ‰ï¼ŒåŠæœåŠ¡ç«¯ç›´æ¥ä¸‹æ‰å…¥å£ã€‚ä¹Ÿå¯ä»¥å®¢æˆ·ç«¯ç›´æ¥è¿”å›å…œåº•é€»è¾‘ï¼Œä¸åšä¸šåŠ¡é€»è¾‘å¤„ç†èµ·åˆ°é™çº§çš„ç›®çš„ã€‚</p><h3 id="é™çº§æ–¹å¼"><a href="#é™çº§æ–¹å¼" class="headerlink" title="é™çº§æ–¹å¼"></a>é™çº§æ–¹å¼</h3><ol><li><strong>å»¶è¿ŸæœåŠ¡</strong>ï¼šæ¯”å¦‚å‘è¡¨äº†è¯„è®ºï¼Œé‡è¦æœåŠ¡ï¼Œæ¯”å¦‚åœ¨æ–‡ç« ä¸­æ˜¾ç¤ºæ­£å¸¸ï¼Œä½†æ˜¯å»¶è¿Ÿç»™ç”¨æˆ·å¢åŠ ç§¯åˆ†ï¼Œåªæ˜¯æ”¾åˆ°ä¸€ä¸ªç¼“å­˜ä¸­ï¼Œç­‰æœåŠ¡å¹³ç¨³ä¹‹åå†æ‰§è¡Œã€‚</li><li><strong>åœ¨ç²’åº¦èŒƒå›´å†…å…³é—­æœåŠ¡</strong>ï¼šæ¯”å¦‚å…³é—­ç›¸å…³æ–‡ç« çš„æ¨èï¼Œç›´æ¥å…³é—­æ¨èåŒºã€‚</li><li><strong>é¡µé¢å¼‚æ­¥è¯·æ±‚é™çº§</strong>ï¼šæ¯”å¦‚å•†å“è¯¦æƒ…é¡µä¸Šæœ‰æ¨èä¿¡æ¯&#x2F;é…é€è‡³ç­‰å¼‚æ­¥åŠ è½½çš„è¯·æ±‚ï¼Œå¦‚æœè¿™äº›ä¿¡æ¯å“åº”æ…¢æˆ–è€…åç«¯æœåŠ¡æœ‰é—®é¢˜ï¼Œå¯ä»¥è¿›è¡Œé™çº§ï¼›</li><li><strong>å†™é™çº§</strong>ï¼šæ¯”å¦‚ç§’æ€æŠ¢è´­ï¼Œæˆ‘ä»¬å¯ä»¥åªè¿›è¡ŒCacheçš„æ›´æ–°ï¼Œç„¶åå¼‚æ­¥åŒæ­¥æ‰£å‡åº“å­˜åˆ°DBï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§å³å¯ï¼Œæ­¤æ—¶å¯ä»¥å°† DBé™çº§ä¸ºCacheã€‚</li><li><strong>è¯»é™çº§</strong>ï¼šæ¯”å¦‚å¤šçº§ç¼“å­˜æ¨¡å¼ï¼Œå¦‚æœåç«¯æœåŠ¡æœ‰é—®é¢˜ï¼Œå¯ä»¥é™çº§ä¸ºåªè¯»ç¼“å­˜ï¼Œè¿™ç§æ–¹å¼é€‚ç”¨äºå¯¹è¯»ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼›</li></ol><h3 id="é™çº§çš„ä»‹å…¥æ–¹å¼"><a href="#é™çº§çš„ä»‹å…¥æ–¹å¼" class="headerlink" title="é™çº§çš„ä»‹å…¥æ–¹å¼"></a>é™çº§çš„ä»‹å…¥æ–¹å¼</h3><p>é™çº§çš„ä»‹å…¥æ–¹å¼ä¸€èˆ¬åˆ†ä¸ºï¼šè‡ªåŠ¨å¼€å…³é™çº§å’Œäººå·¥å¼€å…³é™çº§ï¼›</p><h4 id="è‡ªåŠ¨å¼€å…³é™çº§"><a href="#è‡ªåŠ¨å¼€å…³é™çº§" class="headerlink" title="è‡ªåŠ¨å¼€å…³é™çº§"></a>è‡ªåŠ¨å¼€å…³é™çº§</h4><p>è‡ªåŠ¨å¼€å…³é™çº§çš„æ–¹å¼ä¸€èˆ¬æ˜¯å½“ç³»ç»Ÿè¾¾åˆ°æŸäº›è®¾å®šçš„æ¡ä»¶ï¼ˆç³»ç»Ÿè´Ÿè½½ã€èµ„æºä½¿ç”¨æƒ…å†µã€SLAç­‰æŒ‡æ ‡ï¼‰ä¹‹åï¼Œè‡ªåŠ¨æ‰§è¡Œä¸€äº›ç­–ç•¥ã€‚</p><ol><li>æœåŠ¡è¶…æ—¶ï¼›</li><li>å¤±è´¥æ¬¡æ•°ï¼›</li><li>å‘ç”Ÿæ•…éšœï¼›</li><li>é™æµé™çº§ï¼›</li></ol><h4 id="æ‰‹åŠ¨å¼€å…³é™çº§"><a href="#æ‰‹åŠ¨å¼€å…³é™çº§" class="headerlink" title="æ‰‹åŠ¨å¼€å…³é™çº§"></a>æ‰‹åŠ¨å¼€å…³é™çº§</h4><p>è¿˜æœ‰ä¸€ç§é™çº§æ–¹å¼ï¼Œé‚£å°±æ˜¯äººå·¥å¼€å…³é™çº§ã€‚</p><p>äººå·¥å¼€å…³é™çº§æ˜¯æŒ‡å½“ç³»ç»Ÿç»´æŠ¤äººå‘˜åœ¨å‘ç°ç³»ç»Ÿå¼‚å¸¸ä¹‹åï¼Œé€šè¿‡äººå·¥ä¿®æ”¹å‚æ•°ã€å…³é—­æœåŠ¡ç­‰æ–¹å¼è¿›è¡Œé™çº§çš„æ–¹æ³•ã€‚</p><p>è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯æ¯”è¾ƒçµæ´»ï¼Œèƒ½å¤Ÿæ ¹æ®å¼‚å¸¸æƒ…å†µçµæ´»åº”å¯¹ï¼Œä½†å¼Šç«¯æ˜¯å¯¹äººçš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œä¸€æ¥éœ€è¦ç»´æŠ¤äººå‘˜å¯¹ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œå¦å¤–è¦æ±‚ç»´æŠ¤äººå‘˜åœ¨ç³»ç»Ÿå¼‚å¸¸æ—¶èƒ½å¤Ÿåœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œå¤„ç½®ã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå¯èƒ½ä¹Ÿä¼šäººå·¥ä»‹å…¥ï¼Œé‚£å°±æ˜¯åœ¨å¤§ä¿ƒä¹‹å‰ï¼Œé¢„ä¼°åˆ°æµé‡ä¼šååˆ†å·¨å¤§ï¼Œææ—©çš„è¯†åˆ«å‡ºé£é™©ï¼Œä¸ºäº†èŠ‚çœèµ„æºä¿è¯ä¸»æµç¨‹çš„å¯ç”¨ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ‰‹åŠ¨å°†æŸä¸ªåŠŸèƒ½é™çº§æ‰ã€‚</p><p>è¿™é‡Œè¯´çš„äººå·¥å¼€å…³é™çº§ï¼Œå¹¶ä¸ä¸€å®šæ˜¯è¦äººå·¥æ“ä½œï¼Œä¹Ÿå¯èƒ½æ˜¯äººå·¥é€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è¿›è¡Œå®šæ—¶è§¦å‘çš„ã€‚</p><h2 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h2><p>é™æµçš„æ˜¯æ§åˆ¶ç³»ç»Ÿçš„å¹¶å‘æµé‡ï¼Œé€šè¿‡é™åˆ¶è¯·æ±‚æµé‡çš„æ‰‹æ®µé˜²æ­¢è¿‡åº¦çš„æµé‡å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚ä¸€èˆ¬ç”¨äºåº”å¯¹çªå‘æµé‡é«˜å³°ã€‚</p><p>ä¸€èˆ¬æ˜¯è¢«è°ƒç”¨æ–¹å¯¹è°ƒç”¨æ–¹è¿›è¡Œé™æµã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘æä¾›äº†ä¸€ä¸ªæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æœåŠ¡ï¼Œç»™é›†å›¢å†…å¤–çš„å¾ˆå¤šè°ƒç”¨æ–¹ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘ä¸ºäº†ä¿è¯æˆ‘çš„å¯ç”¨æ€§ï¼Œæˆ‘ä¼šå¯¹æ¯ä¸ªè°ƒç”¨æ–¹åšé™æµï¼Œé˜²æ­¢æŸä¸ªè°ƒç”¨æ–¹ä¸å®ˆè§„çŸ©ï¼ŒæŠŠæˆ‘çš„æœåŠ¡æ‰“æŒ‚äº†ã€‚</p><h3 id="é™æµç®—æ³•"><a href="#é™æµç®—æ³•" class="headerlink" title="é™æµç®—æ³•"></a>é™æµç®—æ³•</h3><p>å¸¸è§çš„é™æµç®—æ³•æœ‰ï¼š</p><ol><li><strong>æ¼æ¡¶ç®—æ³•ï¼ˆå¸¸ç”¨ï¼‰</strong>ï¼šç³»ç»Ÿè¯·æ±‚å…ˆè¿›å…¥æ¼æ¡¶ï¼Œå†ä»æ¼æ¡¶ä¸­é€ä¸€å–å‡ºè¯·æ±‚æ‰§è¡Œï¼Œæ§åˆ¶æ¼æ¡¶çš„æµé‡ã€‚</li><li><strong>ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆå¸¸ç”¨ï¼‰</strong>ï¼šç³»ç»Ÿè¯·æ±‚ä¼šå¾—åˆ°ä¸€ä¸ªä»¤ç‰Œï¼Œä»ä»¤ç‰Œæ¡¶ä¸­å–å‡ºä¸€ä¸ªä»¤ç‰Œæ‰§è¡Œï¼Œæ§åˆ¶ä»¤ç‰Œæ¡¶ä¸­ä»¤ç‰Œçš„æ•°é‡ã€‚</li><li><strong>è®¡æ•°å™¨ç®—æ³•ï¼ˆç®€å•ï¼‰</strong>ï¼šç³»ç»Ÿè¯·æ±‚è¢«è®¡æ•°ï¼Œé€šè¿‡æ¯”è¾ƒå½“å‰è¯·æ±‚æ•°ä¸é™æµé˜ˆå€¼æ¥åˆ¤æ–­æ˜¯å¦é™æµã€‚</li><li><strong>å¯ä»¥é˜»å¡ç®—æ³•</strong>ï¼šå½“ç³»ç»Ÿè¾¾åˆ°é™æµé˜ˆå€¼æ—¶ï¼Œä¸å†æ¥å—æ–°è¯·æ±‚ï¼Œç­‰åˆ°é™æµé˜ˆå€¼é™ä¸‹æ¥å†æ¥å—è¯·æ±‚ã€‚</li><li><strong>ä»¤ç‰Œç¯ç®—æ³•</strong>ï¼šä¸ä»¤ç‰Œæ¡¶ç®—æ³•ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨å¤šä¸ªä»¤ç‰Œæ¡¶ä¹‹é—´å½¢æˆç¯å½¢ç»“æ„ï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„è¯·æ±‚å¤„ç†é€Ÿç‡ä¹‹é—´è¿›è¡Œå¹³è¡¡ã€‚</li><li><strong>æœ€å°å»¶è¿Ÿç®—æ³•</strong>ï¼šåŸºäºé¢„æµ‹æ¯ä¸ªè¯·æ±‚çš„å¤„ç†æ—¶é—´ï¼Œå¹¶åœ¨å¤„ç†å®Œè¯·æ±‚åè¿›è¡Œå»¶è¿Ÿï¼Œä»¥æ§åˆ¶è¯·æ±‚çš„é€Ÿç‡ã€‚</li><li><strong>æ»‘åŠ¨çª—å£ï¼ˆå¸¸ç”¨ï¼‰</strong>ï¼šåŸºäºä¸€ä¸ªå›ºå®šå¤§å°çš„æ—¶é—´çª—å£ï¼Œå…è®¸åœ¨è¯¥æ—¶é—´çª—å£å†…çš„è¯·æ±‚æ•°ä¸è¶…è¿‡è®¾å®šçš„é˜ˆå€¼ã€‚è¿™ä¸ªæ—¶é—´çª—å£éšç€æ—¶é—´çš„æ¨ç§»ä¸æ–­æ»‘åŠ¨ï¼Œä»¥é€‚åº”ä¸åŒæ—¶é—´æ®µå†…çš„è¯·æ±‚æµé‡ã€‚</li></ol><h2 id="é™çº§é™æµç†”æ–­å·¥å…·"><a href="#é™çº§é™æµç†”æ–­å·¥å…·" class="headerlink" title="é™çº§é™æµç†”æ–­å·¥å…·"></a>é™çº§é™æµç†”æ–­å·¥å…·</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503201617184.png" alt="image-20250320161720094"></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/weixin_44046545/article/details/139815722?ops_request_misc=&request_id=&biz_id=102&utm_term=%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-139815722.142%5Ev102%5Epc_search_result_base6&spm=1018.2226.3001.4187">æœåŠ¡å™¨é›ªå´©çš„åº”å¯¹ç­–ç•¥ä¹‹â€”-ç†”æ–­æœºåˆ¶</a></li><li><a href="https://blog.csdn.net/qq_38196449/article/details/141467150?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522cef494cf816ec4e4a5e5b9cf4ad7c777%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=cef494cf816ec4e4a5e5b9cf4ad7c777&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-141467150-null-null.142%5Ev102%5Epc_search_result_base6&utm_term=%E7%86%94%E6%96%AD%E5%92%8C%E9%99%90%E6%B5%81%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8C%BA%E5%88%AB&spm=1018.2226.3001.4187">ã€é€šä¿—æ˜“æ‡‚ã€‘é™æµã€é™çº§ã€ç†”æ–­æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> é«˜å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç†”æ–­ </tag>
            
            <tag> é™çº§ </tag>
            
            <tag> é™æµ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-33 OAuth2</title>
      <link href="/2025/03/19/75-33%20OAuth2/"/>
      <url>/2025/03/19/75-33%20OAuth2/</url>
      
        <content type="html"><![CDATA[<h1 id="75-33-OAuth2å®ç°SSO"><a href="#75-33-OAuth2å®ç°SSO" class="headerlink" title="75-33 OAuth2å®ç°SSO"></a>75-33 OAuth2å®ç°SSO</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503191942929.webp" alt="image"></p><p>OAuthåœ¨â€å®¢æˆ·ç«¯â€ä¸â€æœåŠ¡æä¾›å•†â€ä¹‹é—´ï¼Œè®¾ç½®äº†ä¸€ä¸ªæˆæƒå±‚ï¼ˆauthorization layerï¼‰ã€‚â€å®¢æˆ·ç«¯â€ä¸èƒ½ç›´æ¥ç™»å½•â€æœåŠ¡æä¾›å•†â€ï¼Œåªèƒ½ç™»å½•æˆæƒå±‚ï¼Œä»¥æ­¤å°†ç”¨æˆ·ä¸å®¢æˆ·ç«¯åŒºåˆ†å¼€æ¥ã€‚â€å®¢æˆ·ç«¯â€ç™»å½•æˆæƒå±‚æ‰€ç”¨çš„ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œä¸ç”¨æˆ·çš„å¯†ç ä¸åŒã€‚ç”¨æˆ·å¯ä»¥åœ¨ç™»å½•çš„æ—¶å€™ï¼ŒæŒ‡å®šæˆæƒå±‚ä»¤ç‰Œçš„æƒé™èŒƒå›´å’Œæœ‰æ•ˆæœŸã€‚</p><p>â€œå®¢æˆ·ç«¯â€ç™»å½•æˆæƒå±‚ä»¥åï¼Œâ€æœåŠ¡æä¾›å•†â€æ ¹æ®ä»¤ç‰Œçš„æƒé™èŒƒå›´å’Œæœ‰æ•ˆæœŸï¼Œå‘â€å®¢æˆ·ç«¯â€å¼€æ”¾ç”¨æˆ·å‚¨å­˜çš„èµ„æ–™ã€‚</p><h2 id="å››ç§æˆæƒæ¨¡å¼"><a href="#å››ç§æˆæƒæ¨¡å¼" class="headerlink" title="å››ç§æˆæƒæ¨¡å¼"></a>å››ç§æˆæƒæ¨¡å¼</h2><h3 id="æˆæƒç æ¨¡å¼ï¼ˆAuthorization-Code-Grantï¼‰"><a href="#æˆæƒç æ¨¡å¼ï¼ˆAuthorization-Code-Grantï¼‰" class="headerlink" title="æˆæƒç æ¨¡å¼ï¼ˆAuthorization Code Grantï¼‰"></a>æˆæƒç æ¨¡å¼ï¼ˆAuthorization Code Grantï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503261535191.png" alt="OAuth2.0æˆæƒç æ¨¡å¼--è®¤è¯æµç¨‹"></p><h3 id="éšå¼æˆæƒï¼ˆImplicit-Grantï¼‰"><a href="#éšå¼æˆæƒï¼ˆImplicit-Grantï¼‰" class="headerlink" title="éšå¼æˆæƒï¼ˆImplicit Grantï¼‰"></a>éšå¼æˆæƒï¼ˆImplicit Grantï¼‰</h3><p>éšå¼æˆæƒåˆç§°ç®€åŒ–æˆæƒæ¨¡å¼ï¼Œå®ƒå’Œæˆæƒç æ¨¡å¼ç±»ä¼¼ï¼Œåªä¸è¿‡å°‘äº†è·å–æˆæƒç çš„æ­¥éª¤ï¼Œæ˜¯ç›´æ¥è·å–ä»¤ç‰Œtokençš„ï¼Œä¸”æ²¡æœ‰Refresh Tokenï¼Œé€‚ç”¨äºå…¬å¼€çš„æµè§ˆå™¨å•é¡µåº”ç”¨ã€‚å› ä¸ºä»¤ç‰Œç›´æ¥ä»æˆæƒæœåŠ¡å™¨è¿”å›ï¼Œæ‰€ä»¥æ²¡æœ‰å®‰å…¨ä¿è¯ï¼Œä»¤ç‰Œå®¹æ˜“å› ä¸ºè¢«æ‹¦æˆªçªƒå¬è€Œæ³„éœ²ã€‚</p><h3 id="å¯†ç æ¨¡å¼ï¼ˆResource-Owner-Password-Credentials-Grantï¼‰"><a href="#å¯†ç æ¨¡å¼ï¼ˆResource-Owner-Password-Credentials-Grantï¼‰" class="headerlink" title="å¯†ç æ¨¡å¼ï¼ˆResource Owner Password Credentials Grantï¼‰"></a>å¯†ç æ¨¡å¼ï¼ˆResource Owner Password Credentials Grantï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503261536164.png" alt="OAuth2.0å¯†ç æ¨¡å¼"></p><h3 id="å®¢æˆ·ç«¯æˆæƒæ¨¡å¼ï¼ˆClient-Credentials-Grantï¼‰"><a href="#å®¢æˆ·ç«¯æˆæƒæ¨¡å¼ï¼ˆClient-Credentials-Grantï¼‰" class="headerlink" title="å®¢æˆ·ç«¯æˆæƒæ¨¡å¼ï¼ˆClient Credentials Grantï¼‰"></a>å®¢æˆ·ç«¯æˆæƒæ¨¡å¼ï¼ˆClient Credentials Grantï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503261536200.png" alt="OAuth2.0å®¢æˆ·ç«¯æ¨¡å¼"></p>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Reactoræ¨¡å¼ </tag>
            
            <tag> ç½‘ç»œç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>80-06 æ—¶åºå°è®°</title>
      <link href="/2025/03/11/80-06%20%E6%97%B6%E5%BA%8F%E5%B0%8F%E8%AE%B0/"/>
      <url>/2025/03/11/80-06%20%E6%97%B6%E5%BA%8F%E5%B0%8F%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="80-06-æ—¶åºå°è®°"><a href="#80-06-æ—¶åºå°è®°" class="headerlink" title="80-06 æ—¶åºå°è®°"></a>80-06 æ—¶åºå°è®°</h1><h2 id="æ¨¡å‹è®­ç»ƒ"><a href="#æ¨¡å‹è®­ç»ƒ" class="headerlink" title="æ¨¡å‹è®­ç»ƒ"></a>æ¨¡å‹è®­ç»ƒ</h2><h3 id="Jupyterä½¿ç”¨"><a href="#Jupyterä½¿ç”¨" class="headerlink" title="Jupyterä½¿ç”¨"></a>Jupyterä½¿ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æ¿€æ´»ä½ çš„condaç¯å¢ƒï¼ˆå…³é”®æ­¥éª¤ï¼ï¼‰</span></span><br><span class="line">conda activate news</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å®‰è£…ipykernelï¼ˆå¿…é¡»åœ¨å½“å‰ç¯å¢ƒä¸­å®‰è£…ï¼‰</span></span><br><span class="line">pip install ipykernel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å°†å½“å‰ç¯å¢ƒå†™å…¥Jupyterå†…æ ¸ï¼ˆæ³¨æ„å‚æ•°æ›¿æ¢ï¼‰</span></span><br><span class="line">python -m ipykernel install --user --name news --display-name <span class="string">&quot;News Environment&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. éªŒè¯æ˜¯å¦æˆåŠŸï¼ˆåº”çœ‹åˆ°æ–°å†…æ ¸ï¼‰</span></span><br><span class="line">jupyter kernelspec list</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶åº </tag>
            
            <tag> è®ºæ–‡é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-32 Reactoræ¨¡å¼</title>
      <link href="/2025/03/11/75-32%20Reactor%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/03/11/75-32%20Reactor%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="75-32-Reactoræ¨¡å¼"><a href="#75-32-Reactoræ¨¡å¼" class="headerlink" title="75-32 Reactoræ¨¡å¼"></a>75-32 Reactoræ¨¡å¼</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111510898.png" alt="image-20250311151016857"></p><p>Reactor æ˜¯äº‹ä»¶é©±åŠ¨æ¨¡å‹çš„ä¸€ç§å®ç°ã€‚</p><p>è¿™ç§æ¨¡å¼ä¸‹ï¼ŒIO è¯»å†™çº¿ç¨‹ã€ä¸šåŠ¡çº¿ç¨‹å·¥ä½œæ—¶ï¼Œå¿…æœ‰æ•°æ®å¯æ“ä½œæ‰§è¡Œï¼Œä¸ä¼šåœ¨ IO ç­‰å¾…ä¸Šæµªè´¹èµ„æºï¼Œè¿™ä¾¿æ˜¯äº‹ä»¶é©±åŠ¨çš„æ ¸å¿ƒæ€æƒ³ã€‚</p><p>ä¸¾ä¸ªç®€å•ä¾‹å­ï¼Œ10ä¸ªå£«å…µæ¥åˆ°å‘½ä»¤ï¼Œåœ¨æ¥ä¸‹æ¥å°†æ‰§è¡Œç§˜å¯†ä»»åŠ¡ï¼Œä½†å…·ä½“æ—¶é—´å¾…å®šï¼›ä¸€ç§æ–¹å¼æ—¶ï¼Œè¿™10ä¸ªå£«å…µè‡ªå·±æŒæ¡ä¸»åŠ¨æƒï¼Œéš”ä¸€æ®µæ—¶é—´å°±ä¼šè‡ªå·±è¯¢é—®å°†å†›æ˜¯å¦å‡†å¤‡æ‰§è¡Œä»»åŠ¡ï¼Œè¿™ç§æ¨¡å¼æ¯”è¾ƒä½ä¸‹ï¼Œå› ä¸ºå£«å…µéœ€è¦èŠ±å¾ˆå¤šç²¾åŠ›è‡ªå·±å»ç¡®è®¤ä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼ŒåŒæ—¶ä¹Ÿä¼šè€½æè‡ªå·±çš„è®­ç»ƒæ—¶é—´ã€‚</p><p>å¦ä¸€ç§æ–¹å¼ä¸ºï¼Œå£«å…µæ¥åˆ°å³å°†æ‰§è¡Œç§˜å¯†ä»»åŠ¡çš„é€šçŸ¥åï¼Œä¼šè‡ªå·±åšå¥½å‡†å¤‡éšæ—¶æ‰§è¡Œï¼Œåœ¨æœ€ç»ˆæ‰§è¡Œå‘½åæ²¡ä¸‹è¾¾ä¹‹å‰ï¼Œä¼šç»§ç»­è‡ªå·±çš„æ—¥å¸¸è®­ç»ƒï¼›ç­‰éœ€è¦æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå°†å†›ä¼šç«‹åˆ»é€šçŸ¥å£«å…µä»¬ç«‹å³è¡ŒåŠ¨ï¼›å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§æ¨¡å¼ï¼Œå£«å…µä»¬çš„æ—¶é—´èµ„æºå¹¶æ²¡æœ‰æµªè´¹ã€‚è¿™ä¾¿æ˜¯äº‹ä»¶é©±åŠ¨çš„ä¼˜åŠ¿æ‰€åœ¨ã€‚</p><p><code>Reactor æ¨¡å‹</code>çš„æ ¸å¿ƒä¾¿æ˜¯<code>äº‹ä»¶é©±åŠ¨</code>ï¼ŒåŒæ—¶ï¼Œä¸ºäº†è®©å…¶ç½‘ç»œ IO å±‚æ‹¥æœ‰äº†é«˜æ€§èƒ½çš„èƒ½åŠ›ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨ IO å¤šè·¯å¤ç”¨å¤„ç†æ–¹æ¡ˆã€‚</p><p>Reactor æ¨¡å¼ç”± Reactor çº¿ç¨‹ã€Handlers å¤„ç†å™¨ä¸¤å¤§è§’è‰²ç»„æˆï¼Œä¸¤å¤§è§’è‰²çš„èŒè´£åˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li>Reactor çº¿ç¨‹çš„èŒè´£ï¼šä¸»è¦è´Ÿè´£<strong>è¿æ¥å»ºç«‹</strong>ã€<strong>ç›‘å¬IOäº‹ä»¶</strong>ã€<strong>IOäº‹ä»¶è¯»å†™</strong>ä»¥åŠå°†<strong>äº‹ä»¶åˆ†å‘åˆ°Handlers å¤„ç†å™¨</strong>ã€‚</li><li>Handlers å¤„ç†å™¨ï¼ˆä¸šåŠ¡å¤„ç†ï¼‰çš„èŒè´£ï¼šéé˜»å¡çš„æ‰§è¡Œä¸šåŠ¡å¤„ç†é€»è¾‘ã€‚</li></ul><p><strong>I&#x2F;O å¤šè·¯å¤ç”¨ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œæ ¹æ®äº‹ä»¶ç±»å‹åˆ†é…ï¼ˆDispatchï¼‰ç»™æŸä¸ªè¿›ç¨‹ &#x2F; çº¿ç¨‹</strong>ã€‚</p><h2 id="å•Reactorå•è¿›ç¨‹-çº¿ç¨‹"><a href="#å•Reactorå•è¿›ç¨‹-çº¿ç¨‹" class="headerlink" title="å•Reactorå•è¿›ç¨‹&#x2F;çº¿ç¨‹"></a>å•Reactorå•è¿›ç¨‹&#x2F;çº¿ç¨‹</h2><p>ä¸€èˆ¬æ¥è¯´ï¼ŒC è¯­è¨€å®ç°çš„æ˜¯ã€Œå• Reactor å•è¿›ç¨‹ã€çš„æ–¹æ¡ˆï¼Œå› ä¸º C è¯­ç¼–å†™å®Œçš„ç¨‹åºï¼Œè¿è¡Œåå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸éœ€è¦åœ¨è¿›ç¨‹ä¸­å†åˆ›å»ºçº¿ç¨‹ã€‚ </p><p>è€Œ Java è¯­è¨€å®ç°çš„æ˜¯ã€Œå• Reactor å•çº¿ç¨‹ã€çš„æ–¹æ¡ˆï¼Œå› ä¸º Java ç¨‹åºæ˜¯è·‘åœ¨ Java è™šæ‹Ÿæœºè¿™ä¸ªè¿›ç¨‹ä¸Šé¢çš„ï¼Œè™šæ‹Ÿæœºä¸­æœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œæˆ‘ä»¬å†™çš„ Java ç¨‹åºåªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªçº¿ç¨‹è€Œå·²ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111535205.png" alt="image-20250311153557135"></p><p>å¯ä»¥çœ‹åˆ°è¿›ç¨‹é‡Œæœ‰ Reactorã€Acceptorã€Handler è¿™ä¸‰ä¸ªå¯¹è±¡ï¼š </p><ul><li>Reactor å¯¹è±¡çš„ä½œç”¨æ˜¯ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼›</li><li>Acceptor å¯¹è±¡çš„ä½œç”¨æ˜¯è·å–è¿æ¥ï¼›</li><li>Handler å¯¹è±¡çš„ä½œç”¨æ˜¯å¤„ç†ä¸šåŠ¡ï¼›</li></ul><p>æ¥ä¸‹æ¥ï¼Œä»‹ç»ä¸‹ã€Œå• Reactor å•è¿›ç¨‹ã€è¿™ä¸ªæ–¹æ¡ˆï¼š </p><ul><li>Reactor å¯¹è±¡é€šè¿‡ select ï¼ˆIO å¤šè·¯å¤ç”¨æ¥å£ï¼‰ ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ dispatch è¿›è¡Œåˆ†å‘ï¼Œå…·ä½“åˆ†å‘ç»™ Acceptor å¯¹è±¡è¿˜æ˜¯ Handler å¯¹è±¡ï¼Œè¿˜è¦çœ‹æ”¶åˆ°çš„äº‹ä»¶ç±»å‹ï¼›</li><li>å¦‚æœæ˜¯è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œåˆ™äº¤ç”± Acceptor å¯¹è±¡è¿›è¡Œå¤„ç†ï¼ŒAcceptor å¯¹è±¡ä¼šé€šè¿‡ accept æ–¹æ³• è·å–è¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡æ¥å¤„ç†åç»­çš„å“åº”äº‹ä»¶ï¼›</li><li>å¦‚æœä¸æ˜¯è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œ åˆ™äº¤ç”±å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”ï¼› </li><li>Handler å¯¹è±¡é€šè¿‡ read -&gt; ä¸šåŠ¡å¤„ç† -&gt; send çš„æµç¨‹æ¥å®Œæˆå®Œæ•´çš„ä¸šåŠ¡æµç¨‹ã€‚</li></ul><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ¡ˆå­˜åœ¨ 2 ä¸ªç¼ºç‚¹ï¼š </p><ul><li>ç¬¬ä¸€ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨ å¤šæ ¸ CPU çš„æ€§èƒ½ï¼› </li><li>ç¬¬äºŒä¸ªç¼ºç‚¹ï¼ŒHandler å¯¹è±¡åœ¨ä¸šåŠ¡å¤„ç†æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ˜¯æ— æ³•å¤„ç†å…¶ä»–è¿æ¥çš„äº‹ä»¶çš„ï¼Œå¦‚æœä¸šåŠ¡å¤„ç†è€—æ—¶æ¯”è¾ƒé•¿ï¼Œé‚£ä¹ˆå°±é€ æˆå“åº”çš„å»¶è¿Ÿï¼›</li></ul><p>æ‰€ä»¥ï¼Œå• Reactor å•è¿›ç¨‹çš„æ–¹æ¡ˆä¸é€‚ç”¨è®¡ç®—æœºå¯†é›†å‹çš„åœºæ™¯ï¼Œåªé€‚ç”¨äºä¸šåŠ¡å¤„ç†éå¸¸å¿«é€Ÿçš„åœºæ™¯ã€‚</p><h2 id="å•-Reactor-å¤šçº¿ç¨‹-å¤šè¿›ç¨‹"><a href="#å•-Reactor-å¤šçº¿ç¨‹-å¤šè¿›ç¨‹" class="headerlink" title="å• Reactor å¤šçº¿ç¨‹ &#x2F; å¤šè¿›ç¨‹"></a>å• Reactor å¤šçº¿ç¨‹ &#x2F; å¤šè¿›ç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111540345.png" alt="image-20250311154030266"></p><p>è¯¦ç»†è¯´ä¸€ä¸‹è¿™ä¸ªæ–¹æ¡ˆï¼š</p><ul><li>Reactor å¯¹è±¡é€šè¿‡ select ï¼ˆIO å¤šè·¯å¤ç”¨æ¥å£ï¼‰ ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ dispatch è¿›è¡Œåˆ†å‘ï¼Œå…·ä½“åˆ†å‘ç»™ Acceptor å¯¹è±¡è¿˜æ˜¯ Handler å¯¹è±¡ï¼Œè¿˜è¦çœ‹æ”¶åˆ°çš„äº‹ä»¶ç±»å‹ï¼› </li><li>å¦‚æœæ˜¯è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œåˆ™äº¤ç”± Acceptor å¯¹è±¡è¿›è¡Œå¤„ç†ï¼ŒAcceptor å¯¹è±¡ä¼šé€šè¿‡ accept æ–¹æ³• è·å–è¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡æ¥å¤„ç†åç»­çš„å“åº”äº‹ä»¶ï¼›</li><li>å¦‚æœä¸æ˜¯è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œ åˆ™äº¤ç”±å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”ï¼›</li></ul><p>ä¸Šé¢çš„ä¸‰ä¸ªæ­¥éª¤å’Œå• Reactor å•çº¿ç¨‹æ–¹æ¡ˆæ˜¯ä¸€æ ·çš„ï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤å°±å¼€å§‹ä¸ä¸€æ ·äº†ï¼š </p><ul><li>Handler å¯¹è±¡ä¸å†è´Ÿè´£ä¸šåŠ¡å¤„ç†ï¼Œåªè´Ÿè´£æ•°æ®çš„æ¥æ”¶å’Œå‘é€ï¼ŒHandler å¯¹è±¡é€šè¿‡ read è¯»å–åˆ°æ•°æ®åï¼Œä¼šå°†æ•°æ®å‘ç»™å­çº¿ç¨‹é‡Œçš„ Processor å¯¹è±¡è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼› </li><li>å­çº¿ç¨‹é‡Œçš„ Processor å¯¹è±¡å°±è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¤„ç†å®Œåï¼Œå°†ç»“æœå‘ç»™ä¸»çº¿ç¨‹ä¸­çš„ Handler å¯¹è±¡ï¼Œæ¥ç€ç”± Handler é€šè¿‡ send æ–¹æ³•å°†å“åº”ç»“æœå‘é€ç»™ clientï¼›</li></ul><p>å¦å¤–ï¼Œã€Œå• Reactorã€çš„æ¨¡å¼è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå› ä¸ºä¸€ä¸ª Reactor å¯¹è±¡æ‰¿æ‹…æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œè€Œä¸”åªåœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼Œåœ¨é¢å¯¹ç¬é—´é«˜å¹¶å‘çš„åœºæ™¯æ—¶ï¼Œå®¹æ˜“æˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆçš„åœ°æ–¹ã€‚</p><h2 id="å¤š-Reactor-å¤šè¿›ç¨‹-çº¿ç¨‹"><a href="#å¤š-Reactor-å¤šè¿›ç¨‹-çº¿ç¨‹" class="headerlink" title="å¤š Reactor å¤šè¿›ç¨‹ &#x2F; çº¿ç¨‹"></a>å¤š Reactor å¤šè¿›ç¨‹ &#x2F; çº¿ç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111544085.png" alt="image-20250311154403011"></p><p>å¤§åé¼é¼çš„ä¸¤ä¸ªå¼€æºè½¯ä»¶ Netty å’Œ Memcache éƒ½é‡‡ç”¨äº†ã€Œå¤š Reactor å¤šçº¿ç¨‹ã€çš„æ–¹æ¡ˆã€‚</p><h2 id="Proactor"><a href="#Proactor" class="headerlink" title="Proactor"></a>Proactor</h2><p>å‰é¢æåˆ°çš„ Reactor æ˜¯éé˜»å¡åŒæ­¥ç½‘ç»œæ¨¡å¼ï¼Œè€Œ Proactor æ˜¯å¼‚æ­¥ç½‘ç»œæ¨¡å¼ã€‚</p><p>å…ˆå†æ¥å›é¡¾ä¸€ä¸‹éé˜»å¡IOå’Œå¼‚æ­¥IOã€‚</p><p>é˜»å¡IO</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111546540.png" alt="image-20250311154659489"></p><p>éé˜»å¡IO</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111547822.png" alt="image-20250311154710766"></p><p>å¼‚æ­¥IO</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111547883.png" alt="image-20250311154752831"></p><p>å› æ­¤ï¼ŒReactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨è¿›ç¨‹ï¼Œè®©åº”ç”¨è¿›ç¨‹æ¥å¤„ç†ã€ï¼Œè€Œ Proactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿæ¥å¤„ç†ï¼Œå¤„ç†å®Œå†é€šçŸ¥åº”ç”¨è¿›ç¨‹ã€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111548593.png" alt="image-20250311154836536"></p>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Reactoræ¨¡å¼ </tag>
            
            <tag> ç½‘ç»œç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-31 TLB</title>
      <link href="/2025/03/09/75-31%20TLB/"/>
      <url>/2025/03/09/75-31%20TLB/</url>
      
        <content type="html"><![CDATA[<h1 id="75-31-TLB"><a href="#75-31-TLB" class="headerlink" title="75-31 TLB"></a>75-31 TLB</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091400589.png" alt="image-20250309140033533"></p><p>è™šæ‹Ÿåœ°å€è½¬åŒ–ä¸ºç‰©ç†åœ°å€æ˜¯é€šè¿‡å†…å­˜ç®¡ç†å•å…ƒï¼ˆMemory Management Unitï¼ŒMMUï¼‰æ¥å®Œæˆçš„ã€‚MMUæ˜¯è®¡ç®—æœºç³»ç»Ÿä¸­çš„ç¡¬ä»¶ç»„ä»¶ï¼Œè´Ÿè´£è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€ä¹‹é—´çš„è½¬æ¢ã€‚</p><p>åœ¨è™šæ‹Ÿåœ°å€è½¬æ¢çš„è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨é¡µè¡¨ï¼ˆPage Tableï¼‰æ¥è¿›è¡Œæ˜ å°„ã€‚é¡µè¡¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒå°†è™šæ‹Ÿåœ°å€ç©ºé—´åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„é¡µï¼ˆPageï¼‰ï¼Œå¯¹åº”äºç‰©ç†å†…å­˜ä¸­çš„é¡µæ¡†ï¼ˆPage Frameï¼‰ã€‚æ¯ä¸ªé¡µè¡¨é¡¹ï¼ˆPage Table Entryï¼‰è®°å½•äº†è™šæ‹Ÿé¡µå’Œç‰©ç†é¡µçš„å¯¹åº”å…³ç³»ã€‚</p><p> å½“ç¨‹åºè®¿é—®ä¸€ä¸ªè™šæ‹Ÿåœ°å€æ—¶ï¼ŒMMUä¼šå°†è™šæ‹Ÿåœ°å€åˆ†è§£ä¸ºé¡µå·å’Œé¡µå†…åç§»é‡ã€‚ç„¶åï¼ŒMMUä¼šæŸ¥æ‰¾é¡µè¡¨ï¼Œæ ¹æ®é¡µå·æ‰¾åˆ°å¯¹åº”çš„é¡µè¡¨é¡¹ã€‚é¡µè¡¨é¡¹ä¸­åŒ…å«äº†ç‰©ç†é¡µçš„åœ°å€æˆ–é¡µæ¡†å·ã€‚æœ€åï¼ŒMMUå°†ç‰©ç†é¡µçš„åœ°å€ä¸é¡µå†…åç§»é‡ç»„åˆï¼Œå¾—åˆ°å¯¹åº”çš„ç‰©ç†åœ°å€ã€‚ </p><p>è™šæ‹Ÿåœ°å€è½¬åŒ–ä¸ºç‰©ç†åœ°å€çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜å¯èƒ½æ¶‰åŠåˆ°å¤šçº§é¡µè¡¨ã€<strong>TLBï¼ˆTranslation Lookaside Bufferï¼‰ç¼“å­˜ç­‰æœºåˆ¶</strong>ï¼Œä»¥æé«˜åœ°å€è½¬æ¢çš„æ•ˆç‡ã€‚</p><h2 id="TLB"><a href="#TLB" class="headerlink" title="TLB"></a>TLB</h2><p>CPUé€šè¿‡MMUæ¥è·å–è™šæ‹Ÿåœ°å€æ‰€å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œå¹¶æ ¹æ®ç‰©ç†åœ°å€è·å–åˆ°å…¶å¯¹åº”çš„å€¼ã€‚<strong>TLBç¼“å­˜çš„å°±æ˜¯éƒ¨åˆ†çƒ­ç‚¹è™šæ‹Ÿåœ°å€æ‰€å¯¹åº”çš„ç‰©ç†åœ°å€</strong>ã€‚</p><p>å½“ä¸€ä¸ª<strong>TLB ç¼“å­˜çš„è™šæ‹Ÿé¡µ</strong>è¢«**æ¢å‡ºåˆ° swapï¼ˆç¡¬ç›˜ï¼‰*<em>åï¼ŒTLB å’Œé¡µè¡¨éœ€è¦è¿›è¡Œç›¸åº”å¤„ç†ï¼Œä»¥ç¡®ä¿åœ°å€è½¬æ¢çš„æ­£ç¡®æ€§ï¼Œå¦åˆ™ CPU å¯èƒ½ä¼šè®¿é—®åˆ°*<em>å·²ç»ä¸å­˜åœ¨çš„ç‰©ç†åœ°å€</em></em>ï¼Œå¯¼è‡´æ•°æ®é”™è¯¯ã€‚</p><p>å½“æ“ä½œç³»ç»Ÿå†³å®š<strong>å°†é¡µæ¢å‡º</strong>åˆ° <strong>swap</strong>ï¼Œå®ƒå¿…é¡»ä¿è¯ TLB é‡Œä¸å†ç¼“å­˜è¿™ä¸ªè™šæ‹Ÿåœ°å€çš„æ—§æ˜ å°„ï¼Œå¦åˆ™ï¼š</p><ul><li>CPU å¯èƒ½ç»§ç»­è®¿é—® TLB é‡Œçš„æ—§æ•°æ®ï¼Œè¿›è€Œè®¿é—®ä¸€ä¸ª<strong>å·²ç»è¢«é‡Šæ”¾çš„ç‰©ç†åœ°å€</strong>ï¼Œå¯¼è‡´å†…å­˜é”™è¯¯ã€‚</li><li>å¯èƒ½å¯¼è‡´æ–°çš„è¿›ç¨‹é”™è¯¯åœ°ä½¿ç”¨äº†è¿™ä¸ªè¢«æ¢å‡ºçš„ç‰©ç†é¡µã€‚</li></ul><p>å½“<strong>æŸä¸ªé¡µè¢«æ¢å‡ºåˆ° swap</strong>ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œï¼š</p><ol><li><strong>æ¸…é™¤ TLB ç¼“å­˜</strong>ï¼ˆé¿å…è¿›ç¨‹é”™è¯¯è®¿é—®ï¼‰ã€‚</li><li><strong>ä¿®æ”¹é¡µè¡¨</strong>ï¼ˆè®°å½•è¯¥é¡µåœ¨ swap ä½ç½®ï¼Œæ ‡è®°ä¸ºæ— æ•ˆï¼‰ã€‚</li><li><strong>è§¦å‘ç¼ºé¡µå¼‚å¸¸</strong>ï¼ˆå¦‚æœè¿›ç¨‹åç»­è®¿é—®ï¼Œéœ€è¦ä» swap æ¢å¤ï¼‰ã€‚</li></ol><p>è¿™ä¸€æœºåˆ¶ä¿è¯äº† <strong>æ“ä½œç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®ç®¡ç†è™šæ‹Ÿå†…å­˜ï¼Œå³ä½¿ç‰©ç†å†…å­˜ä¸è¶³ï¼Œä¹Ÿèƒ½å®‰å…¨é«˜æ•ˆè¿è¡Œè¿›ç¨‹</strong>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-30 å€å¢æ³•</title>
      <link href="/2025/03/06/75-30%20%E5%80%8D%E5%A2%9E%E6%B3%95/"/>
      <url>/2025/03/06/75-30%20%E5%80%8D%E5%A2%9E%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="75-30-å€å¢æ³•"><a href="#75-30-å€å¢æ³•" class="headerlink" title="75-30 å€å¢æ³•"></a>75-30 å€å¢æ³•</h1><h2 id="å€å¢æ€æƒ³ä¸¾ä¾‹"><a href="#å€å¢æ€æƒ³ä¸¾ä¾‹" class="headerlink" title="å€å¢æ€æƒ³ä¸¾ä¾‹"></a>å€å¢æ€æƒ³ä¸¾ä¾‹</h2><p>Aã€Bä¸¤ç‚¹ä¹‹é—´ç›¸éš”è‹¥å¹²å•ä½ä¸º1çš„è·ç¦»ï¼Œå¦‚ä½•ä»æœ€å¿«åœ°ä»Aèµ°åˆ°Bï¼Ÿ</p><p>æœ´ç´ çš„æƒ³æ³•æ˜¯ï¼šå› ä¸ºA Bä¹‹é—´è·ç¦»æœªçŸ¥ï¼Œåªèƒ½ä»Aå¼€å§‹è¯•æ¢æ€§èµ°1æ­¥ã€èµ°2æ­¥ã€â€¦â€¦çœ‹çœ‹èµ°å¤šå°‘æ­¥èƒ½åˆ°è¾¾Bï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦æ˜¯o(n)çš„ã€‚å½“ç„¶è¿™æ ·æ˜¯ä¸å¤Ÿé«˜æ•ˆï¼ˆè€—æ—¶é—´ï¼‰ã€‚</p><p>å®é™…ä¸Šå¯ä»¥åªè®°å½•èµ°1,2,4,8,16æ­¥èƒ½åˆ°è¾¾çš„åœ°æ–¹</p><p>ä»Aå‡ºå‘ï¼šè‹¥è·³8ä¸ªæ ¼å­ï¼ˆè¶…è¿‡Bäº†ï¼Œæ”¾å¼ƒï¼‰</p><p>â€‹         è‹¥è·³4ä¸ªæ ¼å­ï¼ˆè¶…è¿‡Bäº†ï¼Œæ”¾å¼ƒï¼‰</p><p>â€‹         è‹¥è·³2ä¸ªæ ¼å­ï¼ˆæ²¡è¶…è¿‡Bï¼Œå¯ä»¥è·³ï¼‰</p><p>â€‹         è‹¥è·³1ä¸ªæ ¼å­ï¼ˆæ²¡è¶…è¿‡Bï¼Œå¯ä»¥è·³ï¼‰</p><p>â€‹    å…¶ä¸­å…³é”®çš„æ€æƒ³æ˜¯ï¼šå®ƒç»å¯¹ä¸ä¼šè¿ç€è·³ä¸¤æ­¥éƒ½æ˜¯è·³ç›¸åŒçš„æ ¼å­æ•°ï¼Œä¾‹å¦‚ï¼šå¦‚æœè·³ä¸¤æ¬¡2ä¸ªæ ¼å­éƒ½æ˜¯å¯è¡Œçš„è¯ï¼Œé‚£ä¹ˆå®ƒå¹²å˜›ä¸ç›´æ¥è·³4ä¸ªæ ¼å­å‘¢ï¼Ÿä¾æ­¤ç±»æ¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-29 å¿«é€Ÿå¹‚</title>
      <link href="/2025/03/06/75-29%20%E5%BF%AB%E9%80%9F%E5%B9%82/"/>
      <url>/2025/03/06/75-29%20%E5%BF%AB%E9%80%9F%E5%B9%82/</url>
      
        <content type="html"><![CDATA[<h1 id="75-29-å¿«é€Ÿå¹‚"><a href="#75-29-å¿«é€Ÿå¹‚" class="headerlink" title="75-29 å¿«é€Ÿå¹‚"></a>75-29 å¿«é€Ÿå¹‚</h1><h3 id="å¿«é€Ÿå¹‚ç®€ä»‹"><a href="#å¿«é€Ÿå¹‚ç®€ä»‹" class="headerlink" title="å¿«é€Ÿå¹‚ç®€ä»‹"></a><strong>å¿«é€Ÿå¹‚ç®€ä»‹</strong></h3><p>å¿«é€Ÿå¹‚ï¼ˆ<strong>Exponentiation by Squaring</strong>ï¼‰æ˜¯ä¸€ç§é«˜æ•ˆè®¡ç®— <strong>a^b % p</strong>ï¼ˆa çš„ b æ¬¡å¹‚å¯¹ p å–æ¨¡ï¼‰çš„ç®—æ³•ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ <strong>åˆ©ç”¨äºŒè¿›åˆ¶åˆ†è§£æŒ‡æ•°ï¼Œå‡å°‘ä¹˜æ³•æ¬¡æ•°ï¼Œä»è€Œä¼˜åŒ–æ—¶é—´å¤æ‚åº¦</strong>ï¼Œä» O(b) é™ä½åˆ° O(log b)ã€‚</p><hr><h3 id="å¿«é€Ÿå¹‚çš„æ ¸å¿ƒæ€æƒ³"><a href="#å¿«é€Ÿå¹‚çš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="å¿«é€Ÿå¹‚çš„æ ¸å¿ƒæ€æƒ³"></a><strong>å¿«é€Ÿå¹‚çš„æ ¸å¿ƒæ€æƒ³</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503062105329.png" alt="image-20250306210518259"></p><hr><h3 id="ç¤ºä¾‹ï¼šè®¡ç®—-2Â¹Â³"><a href="#ç¤ºä¾‹ï¼šè®¡ç®—-2Â¹Â³" class="headerlink" title="ç¤ºä¾‹ï¼šè®¡ç®— 2Â¹Â³"></a><strong>ç¤ºä¾‹ï¼šè®¡ç®— 2Â¹Â³</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503062105859.png" alt="image-20250306210536820"></p><hr><h3 id="å¿«é€Ÿå¹‚çš„ç”¨é€”"><a href="#å¿«é€Ÿå¹‚çš„ç”¨é€”" class="headerlink" title="å¿«é€Ÿå¹‚çš„ç”¨é€”"></a><strong>å¿«é€Ÿå¹‚çš„ç”¨é€”</strong></h3><ol><li><strong>å¤§æ•°è®¡ç®—</strong>ï¼šå½“ a å’Œ b éå¸¸å¤§æ—¶ï¼Œä½¿ç”¨æ™®é€šå¹‚è®¡ç®—ä¼šå¯¼è‡´æŒ‡æ•°çˆ†ç‚¸ï¼Œè€Œå¿«é€Ÿå¹‚èƒ½å¤Ÿæœ‰æ•ˆé™ä½è®¡ç®—é‡ã€‚</li><li><strong>å–æ¨¡è¿ç®—</strong>ï¼šè®¸å¤šé—®é¢˜æ¶‰åŠ <strong>å¤§æ•°å–æ¨¡</strong>ï¼ˆå¦‚ <strong>a^b % p</strong>ï¼‰ï¼Œä½¿ç”¨å¿«é€Ÿå¹‚å¯ä»¥é¿å…ä¸­é—´ç»“æœæº¢å‡ºã€‚</li><li><strong>å¯†ç å­¦</strong>ï¼šRSA åŠ å¯†ç­‰ç®—æ³•ä¸­ï¼Œæ¶‰åŠå¤§æ•°çš„å¹‚è¿ç®—ï¼Œå¿«é€Ÿå¹‚æ˜¯å…¶æ ¸å¿ƒä¼˜åŒ–æŠ€å·§ä¹‹ä¸€ã€‚</li><li><strong>æ•°å­¦ç«èµ› &amp; ç®—æ³•ç«èµ›</strong>ï¼šå¿«é€Ÿå¹‚æ˜¯ä¸€ä¸ªå¸¸è§çš„ç®—æ³•åŸºç¡€ï¼Œå¯ä»¥ç”¨æ¥é«˜æ•ˆè§£å†³æ¶‰åŠå¹‚è¿ç®—çš„è®¡ç®—é¢˜ã€‚</li></ol><hr><h3 id="Python-å®ç°"><a href="#Python-å®ç°" class="headerlink" title="Python å®ç°"></a><strong>Python å®ç°</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fast_pow</span>(<span class="params">a, b, mod</span>):</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    base = a % mod  <span class="comment"># å…ˆå–æ¨¡ï¼Œé˜²æ­¢æº¢å‡º</span></span><br><span class="line">    <span class="keyword">while</span> b &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> b &amp; <span class="number">1</span>:  <span class="comment"># å¦‚æœ b æ˜¯å¥‡æ•°</span></span><br><span class="line">            res = (res * base) % mod</span><br><span class="line">        base = (base * base) % mod  <span class="comment"># è®¡ç®— base^2</span></span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>  <span class="comment"># b å³ç§»ï¼Œç›¸å½“äº b // 2</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line"><span class="built_in">print</span>(fast_pow(<span class="number">2</span>, <span class="number">13</span>, <span class="number">10</span>**<span class="number">9</span>+<span class="number">7</span>))  <span class="comment"># 8192</span></span><br></pre></td></tr></table></figure><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><ol><li><strong>å¿«é€Ÿå¹‚åˆ©ç”¨æŒ‡æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå‡å°‘ä¸å¿…è¦çš„ä¹˜æ³•</strong>ã€‚</li><li><strong>æ—¶é—´å¤æ‚åº¦æ˜¯ O(log b)ï¼Œè¿œä¼˜äºæ™®é€šå¹‚çš„ O(b)</strong>ã€‚</li><li><strong>åº”ç”¨å¹¿æ³›ï¼Œå°¤å…¶é€‚ç”¨äºå¤§æ•°å–æ¨¡è®¡ç®—</strong>ã€‚</li></ol><p>è¿™æ ·ï¼Œä½ å°±èƒ½åœ¨é¢è¯•æˆ–è€…ç®—æ³•ç«èµ›ä¸­é«˜æ•ˆåœ°ä½¿ç”¨å¿«é€Ÿå¹‚äº†ï¼ğŸš€</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-28 Zset</title>
      <link href="/2025/03/05/75-28%20Zset/"/>
      <url>/2025/03/05/75-28%20Zset/</url>
      
        <content type="html"><![CDATA[<h1 id="75-28-Zset"><a href="#75-28-Zset" class="headerlink" title="75-28 Zset"></a>75-28 Zset</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ‰åºé›†åˆ Zset ä¸ æ™®é€šé›†åˆ Set ç±»ä¼¼ , éƒ½æ˜¯ æ²¡æœ‰é‡å¤å…ƒç´ çš„é›†åˆ ;</p><p>æœ‰åºé›†åˆ Zset ä¸­çš„ å…ƒç´ æ’åº , æ˜¯ æ ¹æ® è¯„åˆ† è¿›è¡Œæ’åº , æ¯ä¸ªæˆå‘˜ éƒ½å…³è”äº†ä¸€ä¸ª è¯„åˆ† , åœ¨è¯¥ æœ‰åºé›†åˆ ä¸­ , æ ¹æ® è¯„åˆ† ç”±ä½åˆ°é«˜ è¿›è¡Œæ’åº ;</p><p>Zset ä¸­çš„å…ƒç´  æ˜¯ ä¸å¯é‡å¤çš„ , ä½†æ˜¯ å…ƒç´  å…³è” çš„ è¯„åˆ† æ˜¯å¯ä»¥é‡å¤çš„ , ä¹Ÿå°±æ˜¯è¯´ å­˜åœ¨ ä¸¤ä¸ªä¸åŒçš„å…ƒç´  å…³è”ç€ ç›¸åŒçš„ è¯„åˆ† ;</p><p>Zset ä¸­çš„å…ƒç´  æ˜¯ æœ‰åº çš„ , æ ¹æ® æ’åºçš„ç´¢å¼• æˆ–è€… å…ƒç´ çš„è¯„åˆ† å¯ä»¥è·å– æŒ‡å®šèŒƒå›´ çš„ æˆå‘˜ ; å¦‚ : è·å– ä¸­é—´å…ƒç´  ;</p><h2 id="æŸ¥è¯¢-Zset-æ‰€æœ‰æ•°æ®"><a href="#æŸ¥è¯¢-Zset-æ‰€æœ‰æ•°æ®" class="headerlink" title="æŸ¥è¯¢ Zset æ‰€æœ‰æ•°æ®"></a>æŸ¥è¯¢ Zset æ‰€æœ‰æ•°æ®</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503052241930.png" alt="image-20250305224135855"></p><p>å…¶å®ƒè¯·è¯¦çœ‹ï¼š<a href="https://blog.csdn.net/shulianghan/article/details/129106569">ã€Redisã€‘Redis æœ‰åºé›†åˆ Zset æ“ä½œ ( ç®€ä»‹ | æŸ¥è¯¢æ“ä½œ | å¢åŠ æ“ä½œ | åˆ é™¤æ“ä½œ | ä¿®æ”¹æ“ä½œ )</a></p><h2 id="å¯ä»¥ä½¿ç”¨Redisçš„Zsetæ¥å®ç°Redisçš„å»¶æ—¶æ¶ˆæ¯"><a href="#å¯ä»¥ä½¿ç”¨Redisçš„Zsetæ¥å®ç°Redisçš„å»¶æ—¶æ¶ˆæ¯" class="headerlink" title="å¯ä»¥ä½¿ç”¨Redisçš„Zsetæ¥å®ç°Redisçš„å»¶æ—¶æ¶ˆæ¯"></a>å¯ä»¥ä½¿ç”¨Redisçš„Zsetæ¥å®ç°Redisçš„å»¶æ—¶æ¶ˆæ¯</h2><p>Rediså¯ä»¥é€šè¿‡ä½¿ç”¨zsetï¼ˆæœ‰åºé›†åˆï¼‰æ¥å®ç°å»¶æ—¶æ¶ˆæ¯åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥å°†æ¶ˆæ¯çš„å‘é€æ—¶é—´ä½œä¸ºscoreï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸ºvalueå­˜å‚¨åœ¨zsetä¸­ï¼Œç„¶åé€šè¿‡è½®è¯¢zsetï¼Œæ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦è¾¾åˆ°æ¶ˆæ¯çš„å‘é€æ—¶é—´ï¼Œæ¥å®ç°å»¶æ—¶æ¶ˆæ¯çš„æŠ•é€’ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Zset </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-27 è·³è¡¨</title>
      <link href="/2025/03/05/75-27%20%E8%B7%B3%E8%A1%A8/"/>
      <url>/2025/03/05/75-27%20%E8%B7%B3%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="75-27-è·³è¡¨"><a href="#75-27-è·³è¡¨" class="headerlink" title="75-27 è·³è¡¨"></a>75-27 è·³è¡¨</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503052235042.png" alt="image-20250305223557957"></p><h2 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h2><p>åŸºäºäºŒåˆ†æŸ¥æ‰¾ï¼Œå¤æ‚åº¦ä¸ºO(log n)ï¼›</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> è·³è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-26 MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</title>
      <link href="/2025/03/04/75-26%20MVCC%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/"/>
      <url>/2025/03/04/75-26%20MVCC%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="75-26-MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"><a href="#75-26-MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶" class="headerlink" title="75-26 MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"></a>75-26 MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>MVCC ï¼Œä¹Ÿå°±æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œæ˜¯ä¸ºäº†åœ¨<a href="https://so.csdn.net/so/search?q=%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE&spm=1001.2101.3001.7020">è¯»å–æ•°æ®</a>æ—¶ä¸åŠ é”æ¥æé«˜è¯»å–æ•ˆç‡å’Œå¹¶å‘æ€§çš„ä¸€ç§æ‰‹æ®µã€‚</p><p><a href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E5%BA%93&spm=1001.2101.3001.7020">æ•°æ®åº“</a>å¹¶å‘æœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯ï¼š</p><ul><li>è¯»-è¯»ï¼šä¸å­˜åœ¨ä»»ä½•é—®é¢˜ã€‚</li><li>è¯»-å†™ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½å‡ºç°è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»ã€‚</li><li>å†™-å†™ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½å­˜åœ¨æ›´æ–°ä¸¢å¤±ç­‰ã€‚</li></ul><p>MVCC è§£å†³çš„å°±æ˜¯è¯»å†™æ—¶çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œçº¿ç¨‹ä¸ç”¨å»äº‰æŠ¢<strong>è¯»å†™é”</strong>ã€‚</p><p>MVCC å…è®¸å¤šä¸ªäº‹åŠ¡<strong>å¹¶å‘æ‰§è¡Œ</strong>ï¼ŒåŒæ—¶é¿å…åŠ é”å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚å…¶æœ¬è´¨æ˜¯<strong>é€šè¿‡ç»´æŠ¤æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬</strong>ï¼Œè®©äº‹åŠ¡å¯ä»¥â€œçœ‹åˆ°â€ä¸åŒçš„å†å²æ•°æ®ç‰ˆæœ¬ï¼Œä»è€Œå®ç°<strong>éé˜»å¡è¯»</strong>ã€‚</p><p>åœ¨ MySQL çš„ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­ï¼ŒMVCC ä¸»è¦ç”¨äº <strong><code>READ COMMITTED</code></strong> å’Œ <strong><code>REPEATABLE READ</code></strong> ä¸¤ä¸ªéš”ç¦»çº§åˆ«ã€‚</p><p>å½“ä¸€ä¸ªäº‹åŠ¡è¦å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œ<strong>MVCC ä¼šä¸ºè¯¥äº‹åŠ¡åˆ›å»ºä¸€ä¸ªæ•°æ®å¿«ç…§</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®é™…çš„æ•°æ®è¡Œã€‚</p><blockquote><p>åœ¨ MySQL çš„ <strong>InnoDB å­˜å‚¨å¼•æ“</strong>ä¸­ï¼Œå¿«ç…§é€šè¿‡ <strong>Undo Log</strong> æ¥å®ç°ã€‚æ¯æ¬¡æ•°æ®æ›´æ–°æ—¶ï¼ŒInnoDB ä¼šä¿å­˜æ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œå¹¶é€šè¿‡æŒ‡é’ˆæ¥é“¾å¼å­˜å‚¨è¿™äº›æ—§ç‰ˆæœ¬æ•°æ®ï¼Œä»è€Œå½¢æˆæ•°æ®çš„ç‰ˆæœ¬é“¾ã€‚</p><ul><li><strong>Undo Log</strong> è®°å½•çš„æ˜¯äº‹åŠ¡å¯¹æ•°æ®æ‰€åšä¿®æ”¹å‰çš„çŠ¶æ€ï¼ˆæ—§å€¼ï¼‰ï¼Œäº‹åŠ¡æäº¤åï¼ŒInnoDB å°†ä¼šæ¸…ç†è¿™äº›å¿«ç…§æ•°æ®ã€‚</li><li>å¯¹äºè¯»æ“ä½œï¼Œäº‹åŠ¡é€šè¿‡ <strong>Read View</strong> æ¥åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿè¯»å–æŸä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œå¹¶ç¡®å®šæ˜¯å¦è¯»å– Undo Log ä¸­çš„æ—§æ•°æ®ã€‚</li></ul></blockquote><h2 id="MVCCç®€å•ä»‹ç»"><a href="#MVCCç®€å•ä»‹ç»" class="headerlink" title="MVCCç®€å•ä»‹ç»"></a>MVCCç®€å•ä»‹ç»</h2><p>1ã€è¯»æ“ä½œï¼ˆSELECTï¼‰ï¼š</p><p>å½“ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œå®ƒä¼šä½¿ç”¨å¿«ç…§è¯»å–ã€‚å¿«ç…§è¯»å–æ˜¯åŸºäºäº‹åŠ¡å¼€å§‹æ—¶æ•°æ®åº“ä¸­çš„çŠ¶æ€åˆ›å»ºçš„ï¼Œå› æ­¤äº‹åŠ¡ä¸ä¼šè¯»å–å…¶ä»–äº‹åŠ¡å°šæœªæäº¤çš„ä¿®æ”¹ã€‚å…·ä½“å·¥ä½œæƒ…å†µå¦‚ä¸‹ï¼š</p><ul><li>å¯¹äºè¯»å–æ“ä½œï¼Œäº‹åŠ¡ä¼šæŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ•°æ®è¡Œï¼Œå¹¶é€‰æ‹©ç¬¦åˆå…¶äº‹åŠ¡å¼€å§‹æ—¶é—´çš„æ•°æ®ç‰ˆæœ¬è¿›è¡Œè¯»å–ã€‚</li><li>å¦‚æœæŸä¸ªæ•°æ®è¡Œæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œäº‹åŠ¡ä¼šé€‰æ‹©ä¸æ™šäºå…¶å¼€å§‹æ—¶é—´çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç¡®ä¿äº‹åŠ¡åªè¯»å–åœ¨å®ƒå¼€å§‹ä¹‹å‰å·²ç»å­˜åœ¨çš„æ•°æ®ã€‚</li><li>äº‹åŠ¡è¯»å–çš„æ˜¯å¿«ç…§æ•°æ®ï¼Œå› æ­¤å…¶ä»–å¹¶å‘äº‹åŠ¡å¯¹æ•°æ®è¡Œçš„ä¿®æ”¹ä¸ä¼šå½±å“å½“å‰äº‹åŠ¡çš„è¯»å–æ“ä½œã€‚</li></ul><p>2ã€å†™æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰ï¼š</p><p>å½“ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œå¹¶å°†ä¿®æ”¹åçš„æ•°æ®å†™å…¥æ•°æ®åº“ã€‚å…·ä½“å·¥ä½œæƒ…å†µå¦‚ä¸‹ï¼š</p><ul><li>å¯¹äºå†™æ“ä½œï¼Œäº‹åŠ¡ä¼šä¸ºè¦ä¿®æ”¹çš„æ•°æ®è¡Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œå¹¶å°†ä¿®æ”¹åçš„æ•°æ®å†™å…¥æ–°ç‰ˆæœ¬ã€‚</li><li>æ–°ç‰ˆæœ¬çš„æ•°æ®ä¼šå¸¦æœ‰å½“å‰äº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œä»¥ä¾¿å…¶ä»–äº‹åŠ¡èƒ½å¤Ÿæ­£ç¡®è¯»å–ç›¸åº”ç‰ˆæœ¬çš„æ•°æ®ã€‚</li><li>åŸå§‹ç‰ˆæœ¬çš„æ•°æ®ä»ç„¶å­˜åœ¨ï¼Œä¾›å…¶ä»–äº‹åŠ¡ä½¿ç”¨å¿«ç…§è¯»å–ï¼Œè¿™ä¿è¯äº†å…¶ä»–äº‹åŠ¡ä¸å—å½“å‰äº‹åŠ¡çš„å†™æ“ä½œå½±å“ã€‚</li></ul><p>3ã€äº‹åŠ¡æäº¤å’Œå›æ»šï¼š</p><ul><li>å½“ä¸€ä¸ªäº‹åŠ¡æäº¤æ—¶ï¼Œå®ƒæ‰€åšçš„ä¿®æ”¹å°†æˆä¸ºæ•°æ®åº“çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¯¹å…¶ä»–äº‹åŠ¡å¯è§ã€‚</li><li>å½“ä¸€ä¸ªäº‹åŠ¡å›æ»šæ—¶ï¼Œå®ƒæ‰€åšçš„ä¿®æ”¹å°†è¢«æ’¤é”€ï¼Œå¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ã€‚</li></ul><p>4ã€ç‰ˆæœ¬çš„å›æ”¶ï¼š</p><p>ä¸ºäº†é˜²æ­¢æ•°æ®åº“ä¸­çš„ç‰ˆæœ¬æ— é™å¢é•¿ï¼ŒMVCC ä¼šå®šæœŸè¿›è¡Œç‰ˆæœ¬çš„å›æ”¶ã€‚å›æ”¶æœºåˆ¶ä¼šåˆ é™¤å·²ç»ä¸å†éœ€è¦çš„æ—§ç‰ˆæœ¬æ•°æ®ï¼Œä»è€Œé‡Šæ”¾ç©ºé—´ã€‚</p><p>MVCC é€šè¿‡åˆ›å»ºæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬å’Œä½¿ç”¨å¿«ç…§è¯»å–æ¥å®ç°å¹¶å‘æ§åˆ¶ã€‚è¯»æ“ä½œä½¿ç”¨æ—§ç‰ˆæœ¬æ•°æ®çš„å¿«ç…§ï¼Œå†™æ“ä½œåˆ›å»ºæ–°ç‰ˆæœ¬ï¼Œå¹¶ç¡®ä¿åŸå§‹ç‰ˆæœ¬ä»ç„¶å¯ç”¨ã€‚è¿™æ ·ï¼Œä¸åŒçš„äº‹åŠ¡å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¹¶å‘æ‰§è¡Œï¼Œè€Œä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œä»è€Œæé«˜äº†æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§ã€‚</p><p>åœ¨ MySQL ä¸­ï¼ŒMVCC ä¸»è¦ä¾èµ– <strong>Undo Log</strong>ï¼ˆå›æ»šæ—¥å¿—ï¼‰å’Œ <strong>Read View</strong>ï¼ˆå¿«ç…§è§†å›¾ï¼‰ æ¥å®ç°ã€‚</p><table><thead><tr><th align="center">ç»„ä»¶</th><th align="center">ä½œç”¨</th></tr></thead><tbody><tr><td align="center"><strong>Undo Log</strong></td><td align="center">è®°å½•æ•°æ®ä¿®æ”¹å‰çš„æ—§ç‰ˆæœ¬ï¼Œæ”¯æŒ MVCC å¿«ç…§è¯»å’Œäº‹åŠ¡å›æ»š</td></tr><tr><td align="center"><strong>Read View</strong></td><td align="center">äº‹åŠ¡è¯»å–æ—¶ï¼Œè®°å½•<strong>æ´»è·ƒäº‹åŠ¡ ID åˆ—è¡¨</strong>ï¼Œç¡®ä¿äº‹åŠ¡åªèƒ½çœ‹åˆ°<strong>ç¬¦åˆ MVCC è§„åˆ™</strong>çš„æ•°æ®</td></tr><tr><td align="center"><strong>Redo Log</strong></td><td align="center">è®°å½•æ•°æ®ä¿®æ”¹åçš„æ–°ç‰ˆæœ¬ï¼ˆäº‹åŠ¡æäº¤åç”¨äºå´©æºƒæ¢å¤ï¼Œä½†ä¸ MVCC å…³ç³»ä¸å¤§ï¼‰</td></tr><tr><td align="center"><strong>Binlog</strong></td><td align="center">å½’æ¡£æ—¥å¿—ï¼Œç”¨äºä¸»ä»å¤åˆ¶ï¼ˆå’Œ MVCC å…³ç³»ä¸å¤§ï¼‰</td></tr></tbody></table><h2 id="ä¸€è‡´æ€§éé”å®šè¯»å’Œé”å®šè¯»"><a href="#ä¸€è‡´æ€§éé”å®šè¯»å’Œé”å®šè¯»" class="headerlink" title="ä¸€è‡´æ€§éé”å®šè¯»å’Œé”å®šè¯»"></a>ä¸€è‡´æ€§éé”å®šè¯»å’Œé”å®šè¯»</h2><h3 id="ä¸€è‡´æ€§éé”å®šè¯»"><a href="#ä¸€è‡´æ€§éé”å®šè¯»" class="headerlink" title="ä¸€è‡´æ€§éé”å®šè¯»"></a>ä¸€è‡´æ€§éé”å®šè¯»</h3><p>å¯¹äº <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-consistent-read.html"><strong>ä¸€è‡´æ€§éé”å®šè¯»ï¼ˆConsistent Nonlocking Readsï¼‰</strong></a>çš„å®ç°ï¼Œé€šå¸¸åšæ³•æ˜¯åŠ ä¸€ä¸ªç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³å­—æ®µï¼Œåœ¨æ›´æ–°æ•°æ®çš„åŒæ—¶ç‰ˆæœ¬å· + 1 æˆ–è€…æ›´æ–°æ—¶é—´æˆ³ã€‚æŸ¥è¯¢æ—¶ï¼Œå°†å½“å‰å¯è§çš„ç‰ˆæœ¬å·ä¸å¯¹åº”è®°å½•çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœè®°å½•çš„ç‰ˆæœ¬å°äºå¯è§ç‰ˆæœ¬ï¼Œåˆ™è¡¨ç¤ºè¯¥è®°å½•å¯è§</p><p>åœ¨ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­ï¼Œ<a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-multi-versioning.html">å¤šç‰ˆæœ¬æ§åˆ¶ (multi versioning)</a> å°±æ˜¯å¯¹éé”å®šè¯»çš„å®ç°ã€‚å¦‚æœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡Œ <code>DELETE</code> æˆ– <code>UPDATE</code> æ“ä½œï¼Œè¿™æ—¶è¯»å–æ“ä½œä¸ä¼šå»ç­‰å¾…è¡Œä¸Šé”çš„é‡Šæ”¾ã€‚ç›¸ååœ°ï¼Œ<code>InnoDB</code> å­˜å‚¨å¼•æ“ä¼šå»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§æ•°æ®ï¼Œå¯¹äºè¿™ç§è¯»å–å†å²æ•°æ®çš„æ–¹å¼ï¼Œæˆ‘ä»¬å«å®ƒå¿«ç…§è¯» (snapshot read)</p><p>åœ¨ <code>Repeatable Read</code> å’Œ <code>Read Committed</code> ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¦‚æœæ˜¯æ‰§è¡Œæ™®é€šçš„ <code>select</code> è¯­å¥ï¼ˆä¸åŒ…æ‹¬ <code>select ... lock in share mode</code> ,<code>select ... for update</code>ï¼‰åˆ™ä¼šä½¿ç”¨ <code>ä¸€è‡´æ€§éé”å®šè¯»ï¼ˆMVCCï¼‰</code>ã€‚å¹¶ä¸”åœ¨ <code>Repeatable Read</code> ä¸‹ <code>MVCC</code> å®ç°äº†å¯é‡å¤è¯»å’Œé˜²æ­¢éƒ¨åˆ†å¹»è¯»</p><h3 id="é”å®šè¯»"><a href="#é”å®šè¯»" class="headerlink" title="é”å®šè¯»"></a>é”å®šè¯»</h3><p>å¦‚æœæ‰§è¡Œçš„æ˜¯ä¸‹åˆ—è¯­å¥ï¼Œå°±æ˜¯ <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html"><strong>é”å®šè¯»ï¼ˆLocking Readsï¼‰</strong></a></p><ul><li><code>select ... lock in share mode</code></li><li><code>select ... for update</code></li><li><code>insert</code>ã€<code>update</code>ã€<code>delete</code> æ“ä½œ</li></ul><p>åœ¨é”å®šè¯»ä¸‹ï¼Œè¯»å–çš„æ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿™ç§è¯»ä¹Ÿè¢«ç§°ä¸º <code>å½“å‰è¯»ï¼ˆcurrent readï¼‰</code>ã€‚é”å®šè¯»ä¼šå¯¹è¯»å–åˆ°çš„è®°å½•åŠ é”ï¼š</p><ul><li><code>select ... lock in share mode</code>ï¼šå¯¹è®°å½•åŠ  <code>S</code> é”ï¼Œå…¶å®ƒäº‹åŠ¡ä¹Ÿå¯ä»¥åŠ <code>S</code>é”ï¼Œå¦‚æœåŠ  <code>x</code> é”åˆ™ä¼šè¢«é˜»å¡</li><li><code>select ... for update</code>ã€<code>insert</code>ã€<code>update</code>ã€<code>delete</code>ï¼šå¯¹è®°å½•åŠ  <code>X</code> é”ï¼Œä¸”å…¶å®ƒäº‹åŠ¡ä¸èƒ½åŠ ä»»ä½•é”</li></ul><p>åœ¨ä¸€è‡´æ€§éé”å®šè¯»ä¸‹ï¼Œå³ä½¿è¯»å–çš„è®°å½•å·²è¢«å…¶å®ƒäº‹åŠ¡åŠ ä¸Š <code>X</code> é”ï¼Œè¿™æ—¶è®°å½•ä¹Ÿæ˜¯å¯ä»¥è¢«è¯»å–çš„ï¼Œå³è¯»å–çš„å¿«ç…§æ•°æ®ã€‚ä¸Šé¢è¯´äº†ï¼Œåœ¨ <code>Repeatable Read</code> ä¸‹ <code>MVCC</code> é˜²æ­¢äº†éƒ¨åˆ†å¹»è¯»ï¼Œè¿™è¾¹çš„ â€œéƒ¨åˆ†â€ æ˜¯æŒ‡åœ¨ <code>ä¸€è‡´æ€§éé”å®šè¯»</code> æƒ…å†µä¸‹ï¼Œåªèƒ½è¯»å–åˆ°ç¬¬ä¸€æ¬¡æŸ¥è¯¢ä¹‹å‰æ‰€æ’å…¥çš„æ•°æ®ï¼ˆæ ¹æ® Read View åˆ¤æ–­æ•°æ®å¯è§æ€§ï¼ŒRead View åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶ç”Ÿæˆï¼‰ã€‚ä½†æ˜¯ï¼å¦‚æœæ˜¯ <code>å½“å‰è¯»</code> ï¼Œæ¯æ¬¡è¯»å–çš„éƒ½æ˜¯æœ€æ–°æ•°æ®ï¼Œè¿™æ—¶å¦‚æœä¸¤æ¬¡æŸ¥è¯¢ä¸­é—´æœ‰å…¶å®ƒäº‹åŠ¡æ’å…¥æ•°æ®ï¼Œå°±ä¼šäº§ç”Ÿå¹»è¯»ã€‚æ‰€ä»¥ï¼Œ **<code>InnoDB</code> åœ¨å®ç°<code>Repeatable Read</code> æ—¶ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯å½“å‰è¯»ï¼Œåˆ™ä¼šå¯¹è¯»å–çš„è®°å½•ä½¿ç”¨ <code>Next-key Lock</code> ï¼Œæ¥é˜²æ­¢å…¶å®ƒäº‹åŠ¡åœ¨é—´éš™é—´æ’å…¥æ•°æ®ã€‚</p><h2 id="InnoDB-å¯¹-MVCC-çš„å®ç°"><a href="#InnoDB-å¯¹-MVCC-çš„å®ç°" class="headerlink" title="InnoDB å¯¹ MVCC çš„å®ç°"></a>InnoDB å¯¹ MVCC çš„å®ç°</h2><p><code>MVCC</code> çš„å®ç°ä¾èµ–äºï¼š<strong>éšè—å­—æ®µã€Read Viewã€undo log</strong>ã€‚åœ¨å†…éƒ¨å®ç°ä¸­ï¼Œ<code>InnoDB</code> é€šè¿‡æ•°æ®è¡Œçš„ <code>DB_TRX_ID</code> å’Œ <code>Read View</code> æ¥åˆ¤æ–­æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚ä¸å¯è§ï¼Œåˆ™é€šè¿‡æ•°æ®è¡Œçš„ <code>DB_ROLL_PTR</code> æ‰¾åˆ° <code>undo log</code> ä¸­çš„å†å²ç‰ˆæœ¬ã€‚æ¯ä¸ªäº‹åŠ¡è¯»åˆ°çš„æ•°æ®ç‰ˆæœ¬å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°è¯¥äº‹åŠ¡åˆ›å»º <code>Read View</code> ä¹‹å‰å·²ç»æäº¤çš„ä¿®æ”¹å’Œè¯¥äº‹åŠ¡æœ¬èº«åšçš„ä¿®æ”¹ã€‚</p><h3 id="éšè—å­—æ®µ"><a href="#éšè—å­—æ®µ" class="headerlink" title="éšè—å­—æ®µ"></a>éšè—å­—æ®µ</h3><p>åœ¨å†…éƒ¨ï¼Œ<code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸ºæ¯è¡Œæ•°æ®æ·»åŠ äº†ä¸‰ä¸ª <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-multi-versioning.html">éšè—å­—æ®µ</a>ï¼š</p><ul><li><code>DB_TRX_IDï¼ˆ6å­—èŠ‚ï¼‰</code>ï¼šè¡¨ç¤ºæœ€åä¸€æ¬¡æ’å…¥æˆ–æ›´æ–°è¯¥è¡Œçš„äº‹åŠ¡ idã€‚æ­¤å¤–ï¼Œ<code>delete</code> æ“ä½œåœ¨å†…éƒ¨è¢«è§†ä¸ºæ›´æ–°ï¼Œåªä¸è¿‡ä¼šåœ¨è®°å½•å¤´ <code>Record header</code> ä¸­çš„ <code>deleted_flag</code> å­—æ®µå°†å…¶æ ‡è®°ä¸ºå·²åˆ é™¤</li><li><code>DB_ROLL_PTRï¼ˆ7å­—èŠ‚ï¼‰</code> å›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥è¡Œçš„ <code>undo log</code> ã€‚å¦‚æœè¯¥è¡Œæœªè¢«æ›´æ–°ï¼Œåˆ™ä¸ºç©º</li><li><code>DB_ROW_IDï¼ˆ6å­—èŠ‚ï¼‰</code>ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ä¸»é”®ä¸”è¯¥è¡¨æ²¡æœ‰å”¯ä¸€éç©ºç´¢å¼•æ—¶ï¼Œ<code>InnoDB</code> ä¼šä½¿ç”¨è¯¥ id æ¥ç”Ÿæˆèšç°‡ç´¢å¼•ã€‚</li></ul><h3 id="ReadView"><a href="#ReadView" class="headerlink" title="ReadView"></a>ReadView</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReadView</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  trx_id_t m_low_limit_id;      <span class="comment">/* å¤§äºç­‰äºè¿™ä¸ª ID çš„äº‹åŠ¡å‡ä¸å¯è§ */</span></span><br><span class="line"></span><br><span class="line">  trx_id_t m_up_limit_id;       <span class="comment">/* å°äºè¿™ä¸ª ID çš„äº‹åŠ¡å‡å¯è§ */</span></span><br><span class="line"></span><br><span class="line">  trx_id_t m_creator_trx_id;    <span class="comment">/* åˆ›å»ºè¯¥ Read View çš„äº‹åŠ¡ID */</span></span><br><span class="line"></span><br><span class="line">  trx_id_t m_low_limit_no;      <span class="comment">/* äº‹åŠ¡ Number, å°äºè¯¥ Number çš„ Undo Logs å‡å¯ä»¥è¢« Purge */</span></span><br><span class="line"></span><br><span class="line">  ids_t m_ids;                  <span class="comment">/* åˆ›å»º Read View æ—¶çš„æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ */</span></span><br><span class="line"></span><br><span class="line">  m_closed;                     <span class="comment">/* æ ‡è®° Read View æ˜¯å¦ close */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041829179.png" alt="trans_visible"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> äº‹åŠ¡ </tag>
            
            <tag> MVCC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-25 MySQLäº‹åŠ¡éš”ç¦»ç­‰çº§</title>
      <link href="/2025/03/04/75-25%20MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%AD%89%E7%BA%A7/"/>
      <url>/2025/03/04/75-25%20MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%AD%89%E7%BA%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="75-25-MySQLäº‹åŠ¡éš”ç¦»ç­‰çº§"><a href="#75-25-MySQLäº‹åŠ¡éš”ç¦»ç­‰çº§" class="headerlink" title="75-25 MySQLäº‹åŠ¡éš”ç¦»ç­‰çº§"></a>75-25 MySQLäº‹åŠ¡éš”ç¦»ç­‰çº§</h1><h2 id="éš”ç¦»çº§åˆ«"><a href="#éš”ç¦»çº§åˆ«" class="headerlink" title="éš”ç¦»çº§åˆ«"></a>éš”ç¦»çº§åˆ«</h2><ul><li><strong>è¯»æœªæäº¤</strong>ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ<strong>å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚</strong></li><li><strong>è¯»å·²æäº¤</strong>ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯<strong>å¹»è¯»</strong>æˆ–<strong>ä¸å¯é‡å¤è¯»</strong>ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li><strong>å¯é‡å¤è¯»</strong>ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</strong></li><li><strong>å¯ä¸²è¡ŒåŒ–</strong>ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ï¼Œä½†æ˜¯å¹¶å‘æ€§ä¸è¡Œã€‚</strong></li></ul><h2 id="è„å†™"><a href="#è„å†™" class="headerlink" title="è„å†™"></a>è„å†™</h2><p>å› ä¸ºåœ¨MySQLä¸­å­˜åœ¨è¡Œçº§é”ï¼Œæ‰€ä»¥åœ¨MySQLä¸­æ˜¯ä¸å­˜åœ¨è„å†™è¿™ç§æƒ…å†µçš„ã€‚</p><h2 id="è„è¯»"><a href="#è„è¯»" class="headerlink" title="è„è¯»"></a>è„è¯»</h2><p>è„è¯»å…¶æœ¬è´¨å°±æ˜¯å› ä¸ºä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ªäº‹åŠ¡è¿˜æœªæäº¤çš„æ•°æ®ï¼Œå¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡å›æ»šäº†ï¼Œå°±ä¼šå¯¼è‡´å…¶ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><p><strong>è„è¯»çš„æœ¬è´¨</strong>æ˜¯<strong>ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®</strong>ï¼Œä½†è¿™ä¸ªäº‹åŠ¡å¯èƒ½ä¼š<strong>å›æ»š</strong>ï¼Œå¯¼è‡´è¯»å–åˆ°çš„æ•°æ®æ˜¯<strong>æ— æ•ˆçš„ï¼ˆå³â€œè„æ•°æ®â€ï¼‰</strong>ã€‚</p><p>äº‹åŠ¡è¯»å–äº†<strong>é”™è¯¯çš„æ•°æ®</strong>ï¼Œä½†åç»­ä¸šåŠ¡é€»è¾‘<strong>å·²ç»åŸºäºè¿™ä¸ªé”™è¯¯æ•°æ®æ‰§è¡Œäº†æŸäº›æ“ä½œ</strong>ï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®é”™è¯¯ä¼ æ’­ï¼Œç”šè‡³å½±å“ä¸šåŠ¡å†³ç­–ã€‚</p><p>é‚£ä¹ˆè¯»æœªæäº¤ä¼šå¯¼è‡´è„è¯»è¿™ä¸€é—®é¢˜å°±æ¸…æ™°äº†èµ·æ¥ã€‚</p><p>åœ¨ è¯»æœªæäº¤çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ 2 åœ¨äº‹åŠ¡ 1 <strong>æœªæäº¤å‰</strong> å°±èƒ½è¯»åˆ°å®ƒä¿®æ”¹çš„æ•°æ®ã€‚è€Œ <strong>å¦‚æœåº”ç”¨å±‚æ²¡æœ‰é¢å¤–çš„é”æœºåˆ¶</strong>ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹æƒ…å†µï¼š</p><ol><li>äº‹åŠ¡ 1 æ‰£å‡äº† 3 ä»¶åº“å­˜ï¼Œ<strong>ä½†è¿˜æœªæäº¤</strong>ï¼ˆæ•°æ®åº“é‡Œè¿˜æ˜¯ <code>5</code>ï¼Œäº‹åŠ¡å†…éƒ¨æš‚æ—¶å˜æˆ <code>2</code>ï¼‰ã€‚</li><li>äº‹åŠ¡ 2 è¯»å–åˆ°<strong>ä»ç„¶æ˜¯ <code>5</code></strong>ï¼Œå› ä¸ºäº‹åŠ¡ 1 è¿˜æ²¡æäº¤ã€‚</li><li>ç„¶åäº‹åŠ¡ä¸€æäº¤æˆåŠŸï¼Œæ•°æ®åº“æ˜¾ç¤ºä¸º2ï¼›</li><li>äº‹åŠ¡ 2 ä¹Ÿå°è¯•è´­ä¹° 3 ä»¶ï¼Œå¯¼è‡´åº“å­˜å˜æˆ <code>2 - 3 = -1</code>ã€‚</li><li>äº‹åŠ¡ 1 æäº¤åï¼Œæœ€ç»ˆåº“å­˜å°±å˜æˆäº†<strong>è´Ÿæ•°</strong>ï¼ˆè¶…å–ï¼‰ã€‚</li></ol><p>è¯»å·²æäº¤å¯ä»¥è§£å†³è„è¯»è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="ä¸å¯é‡å¤è¯»"><a href="#ä¸å¯é‡å¤è¯»" class="headerlink" title="ä¸å¯é‡å¤è¯»"></a>ä¸å¯é‡å¤è¯»</h2><p>ä¸å¯é‡å¤è¯»é—®é¢˜çš„æœ¬è´¨æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ç»“æœæ•°æ®ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´çš„é—®é¢˜ã€‚</p><p>å…¶å®è¿™ä¸ªé—®é¢˜ä½ è¯´æ˜¯é—®é¢˜ä¹Ÿä¸ä¸€å®šå°±æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚å› ä¸ºè¿™å–å†³äºä½ è‡ªå·±æƒ³è¦æ•°æ®åº“æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œå¦‚æœä½ å¸Œæœ›çœ‹åˆ°çš„åœºæ™¯æ˜¯ä¸å¯é‡å¤è¯»ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ A åœ¨æ‰§è¡ŒæœŸé—´å¤šæ¬¡æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œæ¯æ¬¡éƒ½å¯ä»¥æŸ¥åˆ°å…¶å®ƒå·²ç»æäº¤çš„äº‹åŠ¡ä¿®æ”¹è¿‡çš„å€¼ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸å¯é‡å¤è¯»ï¼Œå¦‚æœä½ å¸Œæœ›è¿™æ ·å­ï¼Œé‚£ä¹Ÿæ²¡é—®é¢˜ã€‚</p><p>å¦‚æœä½ æœŸæœ›çš„æ˜¯å¯é‡å¤è¯»ï¼Œä½†æ˜¯æ•°æ®åº“è¡¨ç°çš„æ˜¯ä¸å¯é‡å¤è¯»ï¼Œè®©ä½ äº‹åŠ¡ A æ‰§è¡ŒæœŸé—´å¤šæ¬¡æŸ¥åˆ°çš„å€¼éƒ½ä¸ä¸€æ ·ï¼Œéƒ½çš„é—®é¢˜æ˜¯åˆ«çš„æäº¤è¿‡çš„äº‹åŠ¡ä¿®æ”¹è¿‡çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶ä½ å°±å¯ä»¥è®¤ä¸ºï¼Œæ•°æ®åº“æœ‰é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ã€Œä¸å¯é‡å¤è¯»ã€ã€‚</p><p>éš”ç¦»ç­‰çº§ï¼šå¯é‡å¤è¯»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†è¿˜æ˜¯å¯èƒ½å¯¼è‡´å¹»è¯»é—®é¢˜ã€‚</p><p>é€šè¿‡MVCCå¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚</p><h2 id="å¹»è¯»"><a href="#å¹»è¯»" class="headerlink" title="å¹»è¯»"></a>å¹»è¯»</h2><p>å¹»è¯»æœ¬è´¨æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡æŸ¥è¯¢æ•°æ®é‡ç»“æœä¸ä¸€è‡´ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡æŸ¥è¯¢åˆ°äº†10æ¡ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢åˆ°äº†11æ¡æ•°æ®ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œä½ ä¸€ä¸ªäº‹åŠ¡ Aï¼Œå…ˆå‘é€ä¸€æ¡ SQL è¯­å¥ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ¡ä»¶ï¼Œè¦æŸ¥è¯¢ä¸€æ‰¹æ•°æ®å‡ºæ¥ï¼Œå¦‚ <code>SELECT * FROM table WHERE id &gt; 10</code>ã€‚ç„¶åå‘¢ï¼Œå®ƒä¸€å¼€å§‹æŸ¥è¯¢å‡ºæ¥äº† 10 æ¡æ•°æ®ã€‚æ¥ç€è¿™ä¸ªæ—¶å€™ï¼Œåˆ«çš„äº‹åŠ¡ Bå¾€è¡¨é‡Œæ’äº†å‡ æ¡æ•°æ®ï¼Œè€Œä¸”äº‹åŠ¡ B è¿˜æäº¤äº†ï¼Œæ­¤æ—¶å¤šäº†å‡ è¡Œæ•°æ®ã€‚</p><p>å¹»è¯»å°±æ˜¯ä½ ä¸€ä¸ªäº‹åŠ¡ç”¨ä¸€æ ·çš„ SQL å¤šæ¬¡æŸ¥è¯¢ï¼Œç»“æœæ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šå‘ç°æŸ¥åˆ°ä¸€äº›ä¹‹å‰æ²¡çœ‹åˆ°è¿‡çš„æ•°æ®ã€‚æ³¨æ„ï¼Œå¹»è¯»ç‰¹æŒ‡çš„æ˜¯ä½ æŸ¥è¯¢åˆ°äº†ä¹‹å‰æŸ¥è¯¢æ²¡çœ‹åˆ°è¿‡çš„æ•°æ®ã€‚æ­¤æ—¶è¯´æ˜ä½ æ˜¯å¹»è¯»äº†ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/150107974">å¤§ç™½è¯è®²è§£è„å†™ã€è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> äº‹åŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-24 MySQLæ—¥å¿—</title>
      <link href="/2025/03/03/75-24%20MySQL%E6%97%A5%E5%BF%97/"/>
      <url>/2025/03/03/75-24%20MySQL%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<h1 id="75-24-MySQLæ—¥å¿—"><a href="#75-24-MySQLæ—¥å¿—" class="headerlink" title="75-24 MySQLæ—¥å¿—"></a>75-24 MySQLæ—¥å¿—</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>MySQLä¸­çš„æ—¥å¿—ä¸»è¦ç”¨äº<strong>æ•°æ®æ¢å¤ã€æ€§èƒ½ä¼˜åŒ–ã€é—®é¢˜æ’æŸ¥</strong>ç­‰ã€‚å®ƒä»¬åˆ†ä¸ºå‡ ç±»ï¼Œæ¯ç§æ—¥å¿—éƒ½æœ‰ä¸åŒçš„ä½œç”¨ã€‚ä¸»è¦åŒ…æ‹¬ï¼š</p><ol><li><strong>é”™è¯¯æ—¥å¿—ï¼ˆError Logï¼‰</strong></li><li><strong>é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼ˆGeneral Query Logï¼‰</strong></li><li><strong>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆSlow Query Logï¼‰</strong></li><li><strong>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Log, Binlogï¼‰</strong></li><li><strong>äº‹åŠ¡æ—¥å¿—ï¼ˆRedo Log &amp; Undo Logï¼‰</strong></li><li><strong>ä¸­ç»§æ—¥å¿—ï¼ˆRelay Logï¼‰</strong></li></ol><p>å…¶ä¸­æ¯”è¾ƒé‡è¦çš„æ—¥å¿—æœ‰ï¼š<strong>äºŒè¿›åˆ¶æ—¥å¿—</strong>ã€<strong>äº‹åŠ¡æ—¥å¿—ï¼ˆRedo Log &amp; Undo Logï¼‰</strong>ã€‚</p><p>å¯¹äºMySQLä¸­çš„æ—¥å¿—ï¼Œå…¶æ—¥å¿—çš„ä¸»è¦ä½œç”¨ç‰¢ç‰¢æŠ“ä½æ•°æ®æ¢å¤ã€æ€§èƒ½ä¼˜åŒ–å’Œé—®é¢˜æ’æŸ¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503032346671.png" alt="image-20250303234614620"></p><h2 id="Redo-Log"><a href="#Redo-Log" class="headerlink" title="Redo Log"></a>Redo Log</h2><p>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰æ˜¯ InnoDB å­˜å‚¨å¼•æ“ç‹¬æœ‰çš„ï¼Œå®ƒè®© MySQL æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚</p><p>æ¯”å¦‚ MySQL å®ä¾‹æŒ‚äº†æˆ–å®•æœºäº†ï¼Œé‡å¯æ—¶ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¼šä½¿ç”¨ redo log æ¢å¤æ•°æ®ï¼Œä¿è¯æ•°æ®çš„æŒä¹…æ€§ä¸å®Œæ•´æ€§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503032358239.png" alt="img"></p><p>MySQLä¸­çš„æ•°æ®æ˜¯ä»¥é¡µä¸ºåŸºæœ¬å•ä½è¿›è¡Œæ“ä½œçš„ï¼Œå¦‚æœåœ¨æ‰§è¡Œä¸€æ¡SQLè¯­å¥æ—¶ï¼ŒMySQLä¼šå…ˆå°†ç¬¦åˆçš„é‚£ä¸€é¡µåŠ è½½åˆ°Buffer Poolä¸­ã€‚é‚£ä¹ˆå¦‚æœåç»­è¿˜æ‰§è¡Œè¿™åŒæ ·çš„SQLï¼Œé‚£ä¹ˆMySQLåˆ™ä¼šä¼˜å…ˆåœ¨Buffer Poolä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼ŒåŒæ ·çš„å¦‚æœæ˜¯æ›´æ–°ï¼Œä¹Ÿä¼šä¼˜å…ˆåœ¨Buffer Poolä¸­æŸ¥è¯¢åè¿›è¡Œæ›´æ–°ã€‚</p><p>è¿™é‡Œä¹ŸåŒæ ·æ˜¯å†…å­˜ä¸­å’Œç¡¬ç›˜ä¸­çš„å­˜å–é€Ÿåº¦ä¸ä¸€è‡´å¯¼è‡´çš„ä¸€äº›é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæ‰€ä»¥MySQLè®¾è®¡åœ¨å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯InnoDBè®¾è®¡äº†ä¸€ä¸ªRedo Log Bufferï¼‰ä»»ä½•çš„æ’å…¥æˆ–è€…æ›´æ–°æ“ä½œéƒ½ä¼šä¼˜å…ˆçš„å†™å…¥è¿™ä¸ªRedo Log Bufferä¸­ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯å†…å­˜ä¸­ï¼Œå¦‚æœè¿™æ—¶å€™å®•æœºäº†å¦‚ä½•ã€‚ä¸”å†…å­˜ä¸­å¹¶ä¸æ”¯æŒæŒä¹…åŒ–ï¼Œæ‰€ä»¥éœ€è¦æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æŠŠRedo Pool Bufferä¸­çš„åˆ·æ–°åˆ°ç¡¬ç›˜ä¸­ï¼ˆRedo Logï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿç§°è¿™è¿™æ“ä½œä¸ºåˆ·å±æ“ä½œï¼Œé‚£ä¹ˆåˆ·ç›˜æ—¶æœºå‡ ç§æƒ…å†µå‘¢ã€‚</p><h3 id="åˆ·ç›˜æ—¶æœº"><a href="#åˆ·ç›˜æ—¶æœº" class="headerlink" title="åˆ·ç›˜æ—¶æœº"></a>åˆ·ç›˜æ—¶æœº</h3><p>InnoDB åˆ·æ–°é‡åšæ—¥å¿—çš„æ—¶æœºæœ‰å‡ ç§æƒ…å†µï¼š</p><p>InnoDB å°† redo log åˆ·åˆ°ç£ç›˜ä¸Šæœ‰å‡ ç§æƒ…å†µï¼š</p><ol><li>äº‹åŠ¡æäº¤ï¼šå½“äº‹åŠ¡æäº¤æ—¶ï¼Œlog buffer é‡Œçš„ redo log ä¼šè¢«åˆ·æ–°åˆ°ç£ç›˜ï¼ˆå¯ä»¥é€šè¿‡<code>innodb_flush_log_at_trx_commit</code>å‚æ•°æ§åˆ¶ï¼Œåæ–‡ä¼šæåˆ°ï¼‰ã€‚</li><li>log buffer ç©ºé—´ä¸è¶³æ—¶ï¼šlog buffer ä¸­ç¼“å­˜çš„ redo log å·²ç»å æ»¡äº† log buffer æ€»å®¹é‡çš„å¤§çº¦ä¸€åŠå·¦å³ï¼Œå°±éœ€è¦æŠŠè¿™äº›æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚</li><li>äº‹åŠ¡æ—¥å¿—ç¼“å†²åŒºæ»¡ï¼šInnoDB ä½¿ç”¨ä¸€ä¸ªäº‹åŠ¡æ—¥å¿—ç¼“å†²åŒºï¼ˆtransaction log bufferï¼‰æ¥æš‚æ—¶å­˜å‚¨äº‹åŠ¡çš„é‡åšæ—¥å¿—æ¡ç›®ã€‚å½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œä¼šè§¦å‘æ—¥å¿—çš„åˆ·æ–°ï¼Œå°†æ—¥å¿—å†™å…¥ç£ç›˜ã€‚</li><li>Checkpointï¼ˆæ£€æŸ¥ç‚¹ï¼‰ï¼šInnoDB å®šæœŸä¼šæ‰§è¡Œæ£€æŸ¥ç‚¹æ“ä½œï¼Œå°†å†…å­˜ä¸­çš„è„æ•°æ®ï¼ˆå·²ä¿®æ”¹ä½†å°šæœªå†™å…¥ç£ç›˜çš„æ•°æ®ï¼‰åˆ·æ–°åˆ°ç£ç›˜ï¼Œå¹¶ä¸”ä¼šå°†ç›¸åº”çš„é‡åšæ—¥å¿—ä¸€åŒåˆ·æ–°ï¼Œä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li><li>åå°åˆ·æ–°çº¿ç¨‹ï¼šInnoDB å¯åŠ¨äº†ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œè´Ÿè´£å‘¨æœŸæ€§ï¼ˆæ¯éš” 1 ç§’ï¼‰åœ°å°†è„é¡µï¼ˆå·²ä¿®æ”¹ä½†å°šæœªå†™å…¥ç£ç›˜çš„æ•°æ®é¡µï¼‰åˆ·æ–°åˆ°ç£ç›˜ï¼Œå¹¶å°†ç›¸å…³çš„é‡åšæ—¥å¿—ä¸€åŒåˆ·æ–°ã€‚</li><li>æ­£å¸¸å…³é—­æœåŠ¡å™¨ï¼šMySQL å…³é—­çš„æ—¶å€™ï¼Œredo log éƒ½ä¼šåˆ·å…¥åˆ°ç£ç›˜é‡Œå»ã€‚</li></ol><p>æ€»ä¹‹ï¼ŒInnoDB åœ¨å¤šç§æƒ…å†µä¸‹ä¼šåˆ·æ–°é‡åšæ—¥å¿—ï¼Œä»¥ä¿è¯æ•°æ®çš„æŒä¹…æ€§å’Œä¸€è‡´æ€§ã€‚</p><p>Redo Logæ—¥å¿—ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯MySQLå´©æºƒåå¯ä»¥è¿›è¡Œæ•°æ®æ¢å¤ï¼Œä»è€Œå¯ä»¥ä¿è¯æ¢å¤åçš„æ•°æ®ä¸å´©æºƒä¹‹å‰çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><ul><li><strong>Redo Log ä¸æ˜¯åŸºäº SQL è¯­å¥çš„ï¼Œè€Œæ˜¯åŸºäºç‰©ç†é¡µçš„å˜æ›´è®°å½•ã€‚</strong></li><li><strong>Redo Log å¯èƒ½åœ¨äº‹åŠ¡æäº¤ä¹‹å‰å°±è¢«å†™å…¥ç£ç›˜ï¼Œä½†äº‹åŠ¡æäº¤åæ‰æ ‡è®°ä¸ºæŒä¹…åŒ–ã€‚</strong></li><li><strong>Redo Log ä¸»è¦ç”¨äºå´©æºƒæ¢å¤ï¼Œè€Œä¸æ˜¯ç”¨äºå›æ»šï¼ˆå›æ»šæ˜¯é€šè¿‡ Undo Log å®ç°çš„ï¼‰ã€‚</strong></li></ul><p><code>Redo Log</code> æ˜¯<strong>ç‰©ç†çº§åˆ«çš„æ—¥å¿—</strong>ï¼Œè®°å½•çš„æ˜¯â€œ<strong>æŸä¸ªæ•°æ®é¡µçš„æŸä¸ªä½ç½®ä¿®æ”¹äº†ä»€ä¹ˆ</strong>â€ï¼Œè€Œ<strong>ä¸æ˜¯ SQL è¯­å¥</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041530356.png" alt="img"></p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>é‚£ä¹ˆé€šè¿‡ä¸Šé¢çš„äº†è§£å­¦ä¹ ï¼Œä¸ºä»€ä¹ˆåœ¨MySQLè¿›è¡Œäº†ä¸€ä¸ªSQLæ“ä½œæ—¶ï¼Œæ‰¾åˆ°äº†å¯¹äºçš„æ•°æ®é¡µå¹¶çŸ¥é“äº†éœ€è¦å¯¹è¯¥æ•°æ®é¡µçš„å“ªäº›è¿›è¡Œä½•ç§æ“ä½œçš„è¯ï¼Œä¸ºä»€ä¹ˆ MySQL ä¸ç›´æ¥å†™æ•°æ®ï¼Œè€Œæ˜¯å…ˆå†™ Redo Logï¼Ÿ</p><p>å› ä¸º <strong>Redo Log æ˜¯é¡ºåºå†™å…¥ï¼Œç£ç›˜ IO æ›´é«˜æ•ˆ</strong>ï¼ˆç›¸æ¯”ä¹‹ä¸‹ï¼Œç›´æ¥å†™æ•°æ®æ˜¯éšæœº IOï¼Œæ€§èƒ½è¾ƒå·®ï¼‰ã€‚</p><p>äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œç›´æ¥å†™å…¥ <code>Redo Log</code>ï¼Œç„¶åå†é€šè¿‡åå°çº¿ç¨‹æ…¢æ…¢å°†æ•°æ®åˆ·å…¥æ•°æ®é¡µï¼Œæé«˜äº†ç³»ç»Ÿçš„ååé‡ã€‚</p><h2 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h2><p><strong>redo log å®ƒæ˜¯ç‰©ç†æ—¥å¿—</strong>ï¼Œè®°å½•å†…å®¹æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼Œå±äº InnoDB å­˜å‚¨å¼•æ“ã€‚</p><p><strong>è€Œ binlog æ˜¯é€»è¾‘æ—¥å¿—</strong>ï¼Œè®°å½•å†…å®¹æ˜¯è¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œç±»ä¼¼äºâ€œç»™ ID&#x3D;2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1â€ï¼Œå±äº<code>MySQL Server</code> å±‚ã€‚</p><p>ä¸ç®¡ç”¨ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œ<strong>åªè¦å‘ç”Ÿäº†è¡¨æ•°æ®æ›´æ–°ï¼Œéƒ½ä¼šäº§ç”Ÿ binlog æ—¥å¿—ã€‚</strong></p><p>binlogæ—¥å¿—ä¼šè®°å½•ä¸‹æ‰€æœ‰SQLç›¸å…³æ“ä½œï¼Œå…¶å±äºMySQLæœåŠ¡å±‚ï¼Œè€ŒRedo logå±äºMySQLçš„å­˜å‚¨å¼•æ“ï¼Œä¸”æ˜¯ç‰©ç†æ—¥å¿—ã€‚binlogæ—¥å¿—ä¸€èˆ¬ä¼šç”¨æ¥åšæ•°æ®åŒæ­¥ï¼Œå¯ä»¥è¯´ MySQL æ•°æ®åº“çš„<strong>æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»</strong>éƒ½ç¦»ä¸å¼€ binlogï¼Œéœ€è¦ä¾é  binlog æ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041544842.png" alt="img"></p><p>binlog ä¼šè®°å½•æ‰€æœ‰æ¶‰åŠæ›´æ–°æ•°æ®çš„é€»è¾‘æ“ä½œï¼Œå¹¶ä¸”æ˜¯<strong>é¡ºåºå†™</strong>ã€‚</p><blockquote><h3 id="1-ä»€ä¹ˆæ˜¯é¡ºåºå†™ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯é¡ºåºå†™ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯é¡ºåºå†™ï¼Ÿ"></a><strong>1. ä»€ä¹ˆæ˜¯é¡ºåºå†™ï¼Ÿ</strong></h3><p>åœ¨ MySQL ä¸­ï¼Œ**é¡ºåºå†™ï¼ˆSequential Writeï¼‰**æŒ‡çš„æ˜¯æ•°æ®æŒ‰ç…§**è¿ç»­çš„ç‰©ç†åœ°å€**å†™å…¥å­˜å‚¨è®¾å¤‡ï¼ˆé€šå¸¸æ˜¯ç£ç›˜æˆ– SSDï¼‰ã€‚é¡ºåºå†™æ•°æ®æ—¶ï¼Œç£å¤´ï¼ˆå¯¹äºæœºæ¢°ç¡¬ç›˜ï¼‰æˆ–è€… Flash æ§åˆ¶å™¨ï¼ˆå¯¹äº SSDï¼‰<strong>å¯ä»¥ç›´æ¥æŒ‰é¡ºåºå†™å…¥æ•°æ®å—ï¼Œè€Œä¸éœ€è¦é¢‘ç¹åœ°å¯»æ‰¾æ–°çš„å­˜å‚¨ä½ç½®</strong>ã€‚</p><p>åœ¨ <strong>binlogï¼ˆBinary Logï¼ŒäºŒè¿›åˆ¶æ—¥å¿—ï¼‰</strong> ä¸­ï¼Œ<strong>é¡ºåºå†™</strong>æ„å‘³ç€ï¼š</p><ul><li><strong>äº‹åŠ¡æ‰§è¡Œåï¼ŒMySQL ä¼šå°†å˜æ›´è®°å½•æŒ‰é¡ºåºè¿½åŠ åˆ° Binlog æ–‡ä»¶çš„æœ«å°¾</strong>ï¼Œè€Œä¸ä¼šé¢‘ç¹è·³è·ƒåˆ°ç£ç›˜çš„ä¸åŒä½ç½®å»å†™æ•°æ®ã€‚</li><li>Binlog <strong>ä¸ä¼šè¿›è¡Œéšæœºä¿®æ”¹ï¼Œè€Œæ˜¯ä¸€æ¬¡æ€§åœ°è¿½åŠ æ–°çš„æ—¥å¿—è®°å½•</strong>ï¼Œç›´åˆ°è¾¾åˆ°è®¾å®šçš„ binlog æ–‡ä»¶å¤§å°ï¼ˆç”± <code>max_binlog_size</code> æ§åˆ¶ï¼‰ï¼Œç„¶å MySQL ä¼šåˆ›å»ºæ–°çš„ binlog æ–‡ä»¶ç»§ç»­è®°å½•ã€‚</li></ul><hr><h3 id="2-é¡ºåºå†™çš„åé¢æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-é¡ºåºå†™çš„åé¢æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. é¡ºåºå†™çš„åé¢æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>2. é¡ºåºå†™çš„åé¢æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3><p>é¡ºåºå†™çš„åé¢æ˜¯ <strong>éšæœºå†™ï¼ˆRandom Writeï¼‰</strong>ã€‚<br><strong>éšæœºå†™</strong>æŒ‡çš„æ˜¯æ•°æ®<strong>å†™å…¥ç£ç›˜ä¸Šçš„ä¸åŒä½ç½®</strong>ï¼Œè€Œä¸æ˜¯æŒ‰ç…§é¡ºåºè¿½åŠ ã€‚ä¾‹å¦‚ï¼š</p><ul><li>å½“æˆ‘ä»¬ä¿®æ”¹æ•°æ®åº“çš„æŸä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®å­˜å‚¨çš„ä½ç½®ä¸è¿ç»­ï¼Œå°±ä¼šè§¦å‘ç£ç›˜çš„<strong>éšæœº IO</strong>ï¼Œéœ€è¦ç£å¤´<strong>è·³è½¬åˆ°ä¸åŒçš„ç‰©ç†ä½ç½®</strong>å†™å…¥æ•°æ®ã€‚</li></ul><p>åœ¨ MySQL é‡Œï¼Œ<strong>æ•°æ®é¡µçš„ä¿®æ”¹ï¼ˆå¦‚ InnoDB è¡¨çš„æ•°æ®å˜æ›´ï¼‰é€šå¸¸æ¶‰åŠéšæœºå†™</strong>ï¼š</p><ul><li>MySQL éœ€è¦åœ¨ç£ç›˜ä¸Šçš„<strong>ä¸åŒç‰©ç†ä½ç½®</strong>ä¿®æ”¹æ•°æ®ã€‚</li><li>å¦‚æœæ•°æ®é¡µæœªåŠ è½½åˆ°ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰ï¼Œéœ€è¦é¢å¤–çš„ç£ç›˜è¯»å–ï¼ˆå³â€œè¯»-ä¿®æ”¹-å†™â€æ¨¡å¼ï¼‰ã€‚</li><li>è¿™å°±å¯¼è‡´äº†<strong>ç£ç›˜çš„éšæœº IO è´Ÿæ‹…è¾ƒå¤§</strong>ã€‚</li></ul></blockquote><h3 id="è®°å½•æ ¼å¼"><a href="#è®°å½•æ ¼å¼" class="headerlink" title="è®°å½•æ ¼å¼"></a>è®°å½•æ ¼å¼</h3><p>binlog æ—¥å¿—æœ‰ä¸‰ç§æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡<code>binlog_format</code>å‚æ•°æŒ‡å®šã€‚</p><ul><li><strong>statement</strong></li><li><strong>row</strong></li><li><strong>mixed</strong></li></ul><p>æŒ‡å®š<code>statement</code>ï¼Œè®°å½•çš„å†…å®¹æ˜¯<code>SQL</code>è¯­å¥åŸæ–‡ï¼Œæ¯”å¦‚æ‰§è¡Œä¸€æ¡<code>update T set update_time=now() where id=1</code>ï¼Œè®°å½•çš„å†…å®¹å¦‚ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041557544.png" alt="img"></p><p>åŒæ­¥æ•°æ®æ—¶ï¼Œä¼šæ‰§è¡Œè®°å½•çš„<code>SQL</code>è¯­å¥ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œ<code>update_time=now()</code>è¿™é‡Œä¼šè·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œç›´æ¥æ‰§è¡Œä¼šå¯¼è‡´ä¸åŸåº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸º<code>row</code>ï¼Œè®°å½•çš„å†…å®¹ä¸å†æ˜¯ç®€å•çš„<code>SQL</code>è¯­å¥äº†ï¼Œè¿˜åŒ…å«æ“ä½œçš„å…·ä½“æ•°æ®ï¼Œè®°å½•å†…å®¹å¦‚ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041558013.png" alt="img"></p><p><code>row</code>æ ¼å¼è®°å½•çš„å†…å®¹çœ‹ä¸åˆ°è¯¦ç»†ä¿¡æ¯ï¼Œè¦é€šè¿‡<code>mysqlbinlog</code>å·¥å…·è§£æå‡ºæ¥ã€‚</p><p><code>update_time=now()</code>å˜æˆäº†å…·ä½“çš„æ—¶é—´<code>update_time=1627112756247</code>ï¼Œæ¡ä»¶åé¢çš„@1ã€@2ã€@3 éƒ½æ˜¯è¯¥è¡Œæ•°æ®ç¬¬ 1 ä¸ª~3 ä¸ªå­—æ®µçš„åŸå§‹å€¼ï¼ˆ<strong>å‡è®¾è¿™å¼ è¡¨åªæœ‰ 3 ä¸ªå­—æ®µ</strong>ï¼‰ã€‚</p><p>è¿™æ ·å°±èƒ½ä¿è¯åŒæ­¥æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯æŒ‡å®šä¸º<code>row</code>ï¼Œè¿™æ ·å¯ä»¥ä¸ºæ•°æ®åº“çš„æ¢å¤ä¸åŒæ­¥å¸¦æ¥æ›´å¥½çš„å¯é æ€§ã€‚</p><p>ä½†æ˜¯è¿™ç§æ ¼å¼ï¼Œéœ€è¦æ›´å¤§çš„å®¹é‡æ¥è®°å½•ï¼Œæ¯”è¾ƒå ç”¨ç©ºé—´ï¼Œæ¢å¤ä¸åŒæ­¥æ—¶ä¼šæ›´æ¶ˆè€— IO èµ„æºï¼Œå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚</p><p>æ‰€ä»¥å°±æœ‰äº†ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼ŒæŒ‡å®šä¸º<code>mixed</code>ï¼Œè®°å½•çš„å†…å®¹æ˜¯å‰ä¸¤è€…çš„æ··åˆã€‚</p><p>MySQL ä¼šåˆ¤æ–­è¿™æ¡<code>SQL</code>è¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœæ˜¯ï¼Œå°±ç”¨<code>row</code>æ ¼å¼ï¼Œå¦åˆ™å°±ç”¨<code>statement</code>æ ¼å¼ã€‚</p><h3 id="å†™å…¥æœºåˆ¶"><a href="#å†™å…¥æœºåˆ¶" class="headerlink" title="å†™å…¥æœºåˆ¶"></a>å†™å…¥æœºåˆ¶</h3><p>binlog çš„å†™å…¥æ—¶æœºä¹Ÿéå¸¸ç®€å•ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°<code>binlog cache</code>ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠ<code>binlog cache</code>å†™åˆ° binlog æ–‡ä»¶ä¸­ã€‚</p><p>å¯¹äºè¿™é‡Œbinlogçš„å†™å…¥æƒ…å†µä¸Redo logå†™å…¥æœºåˆ¶å·®ä¸å¤šï¼Œåœ¨è¿™é‡Œä¹Ÿå¼•å…¥äº†ä¸€ä¸ªbinlog cacheï¼Œç”¨æ¥ç¼“è§£å†…å­˜ä¸ç¡¬ç›˜ä¹‹é—´æ•°æ®è¯»å–é€Ÿåº¦ä¸åŒ¹é…çš„çŸ›ç›¾ã€‚</p><p>ä½†æ˜¯å› ä¸ºä¸€ä¸ªäº‹åŠ¡å…·æœ‰åŸå­æ€§ï¼Œå…¶åº”å½“æ˜¯ä¸å¯æ‹†åˆ†çš„ï¼Œæ‰€ä»¥æ— è®ºè¿™ä¸ªäº‹åŠ¡æœ‰å¤šå¤§ï¼Œå…¶åº”ä¸€æ¬¡æ€§å†™å…¥binlogä¸­ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå—å†…å­˜æ¥ä½œä¸ºbinlog cacheã€‚</p><blockquote><p>MySQL <strong>å³ä½¿æ˜¯æ‰§è¡Œä¸€æ¡ç®€å•çš„ SQL è¯­å¥</strong>ï¼Œåœ¨ <strong>InnoDB</strong> å­˜å‚¨å¼•æ“ä¸‹ï¼Œä¹Ÿä¼š<strong>ä»¥äº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œ</strong>ï¼Œä½†å…·ä½“æƒ…å†µå–å†³äº SQL è¯­å¥çš„ç±»å‹å’Œ <code>autocommit</code> è®¾ç½®ã€‚</p><ul><li><strong>åœ¨ MySQL 8.0 ä¸­ï¼Œé»˜è®¤å¯ç”¨äº† <code>autocommit=1</code>ï¼Œå³è‡ªåŠ¨æäº¤æ¨¡å¼</strong>ã€‚</li><li><strong>å¦‚æœ <code>autocommit=1</code>ï¼Œé‚£ä¹ˆæ¯ä¸€æ¡ SQL è¯­å¥éƒ½ä¼šè¢«è§†ä¸ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶åœ¨æ‰§è¡Œå®Œæˆåç«‹å³æäº¤</strong>ï¼Œå†™å…¥ binlogï¼ˆå¦‚æœå¼€å¯äº† binlogï¼‰ã€‚</li><li><strong>å¦‚æœ <code>autocommit=0</code>ï¼Œåˆ™ SQL è¯­å¥æ‰§è¡Œåä¸ä¼šç«‹å³æäº¤ï¼Œéœ€è¦æ‰‹åŠ¨ <code>COMMIT</code>ï¼Œå¦åˆ™äº‹åŠ¡å¯èƒ½ä¼šå›æ»šï¼ˆROLLBACKï¼‰ã€‚</strong></li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041603989.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041605520.png" alt="img"></p><h2 id="ä¸¤é˜¶æ®µæäº¤"><a href="#ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="ä¸¤é˜¶æ®µæäº¤"></a>ä¸¤é˜¶æ®µæäº¤</h2><p><strong>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰è®© InnoDB å­˜å‚¨å¼•æ“æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚</strong></p><p><strong>binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ä¿è¯äº† MySQL é›†ç¾¤æ¶æ„çš„æ•°æ®ä¸€è‡´æ€§ã€‚</strong></p><p>è™½ç„¶å®ƒä»¬éƒ½å±äºæŒä¹…åŒ–çš„ä¿è¯ï¼Œä½†æ˜¯ä¾§é‡ç‚¹ä¸åŒã€‚</p><p>åœ¨æ‰§è¡Œæ›´æ–°è¯­å¥è¿‡ç¨‹ï¼Œä¼šè®°å½• redo log ä¸ binlog ä¸¤å—æ—¥å¿—ï¼Œä»¥åŸºæœ¬çš„äº‹åŠ¡ä¸ºå•ä½ï¼Œredo log åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­å†™å…¥ï¼Œè€Œ binlog åªæœ‰åœ¨æäº¤äº‹åŠ¡æ—¶æ‰å†™å…¥ï¼Œæ‰€ä»¥ redo log ä¸ binlog çš„å†™å…¥æ—¶æœºä¸ä¸€æ ·ã€‚</p><blockquote><p>æˆ‘ä»¬ç»“åˆ <strong>ä¸€ä¸ªç®€å•çš„ä¾‹å­</strong> æ¥è¯´æ˜è¿™ä¸€è¿‡ç¨‹ã€‚</p><hr><h2 id="1-ç¤ºä¾‹ï¼šMySQL-äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹"><a href="#1-ç¤ºä¾‹ï¼šMySQL-äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="1. ç¤ºä¾‹ï¼šMySQL äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹"></a><strong>1. ç¤ºä¾‹ï¼šMySQL äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹</strong></h2><p>å‡è®¾ä½ åœ¨ MySQL é‡Œæ‰§è¡Œä»¥ä¸‹äº‹åŠ¡ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;  <span class="comment">-- å¼€å¯äº‹åŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- æäº¤äº‹åŠ¡</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªäº‹åŠ¡çš„ä½œç”¨æ˜¯ï¼š</p><ul><li><strong>ä» ID&#x3D;1 çš„è´¦æˆ·ä¸­æ‰£é™¤ 100 å…ƒ</strong></li><li><strong>å‘ ID&#x3D;2 çš„è´¦æˆ·ä¸­å¢åŠ  100 å…ƒ</strong></li><li><strong>æœ€åæäº¤äº‹åŠ¡ï¼Œç¡®ä¿è¿™ä¸¤æ­¥ä¿®æ”¹è¦ä¹ˆå…¨éƒ¨ç”Ÿæ•ˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸ç”Ÿæ•ˆ</strong></li></ul><p>åœ¨ <strong>äº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒMySQL éœ€è¦ä¿è¯æ•°æ®çš„å¯é æ€§å’Œæ¢å¤èƒ½åŠ›</strong>ï¼Œæ‰€ä»¥å®ƒä¼šå†™ä¸¤ç§æ—¥å¿—ï¼š</p><ul><li><strong>Redo Logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong>ï¼šç”¨äºå´©æºƒæ¢å¤ï¼Œä¿è¯æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå³ä½¿å®•æœºä¹Ÿèƒ½æ¢å¤æ•°æ®ã€‚</li><li><strong>Binlogï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰</strong>ï¼šç”¨äºä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤ï¼Œè®°å½•äº‹åŠ¡çš„é€»è¾‘æ“ä½œã€‚</li></ul><hr><h2 id="2-Redo-Log-å’Œ-Binlog-åœ¨äº‹åŠ¡ä¸­çš„å†™å…¥æ—¶æœº"><a href="#2-Redo-Log-å’Œ-Binlog-åœ¨äº‹åŠ¡ä¸­çš„å†™å…¥æ—¶æœº" class="headerlink" title="2. Redo Log å’Œ Binlog åœ¨äº‹åŠ¡ä¸­çš„å†™å…¥æ—¶æœº"></a><strong>2. Redo Log å’Œ Binlog åœ¨äº‹åŠ¡ä¸­çš„å†™å…¥æ—¶æœº</strong></h2><h3 id="ã€Step-1ã€‘å¼€å§‹äº‹åŠ¡"><a href="#ã€Step-1ã€‘å¼€å§‹äº‹åŠ¡" class="headerlink" title="ã€Step 1ã€‘å¼€å§‹äº‹åŠ¡"></a><strong>ã€Step 1ã€‘å¼€å§‹äº‹åŠ¡</strong></h3><ul><li><strong>MySQL è§£æ <code>BEGIN;</code>ï¼Œäº‹åŠ¡å¼€å§‹</strong></li><li><strong>æ­¤æ—¶ï¼ŒRedo Log å’Œ Binlog é‡Œéƒ½æ²¡æœ‰ä»»ä½•å†…å®¹</strong></li></ul><hr><h3 id="ã€Step-2ã€‘æ‰§è¡Œç¬¬ä¸€ä¸ª-UPDATE-è¯­å¥"><a href="#ã€Step-2ã€‘æ‰§è¡Œç¬¬ä¸€ä¸ª-UPDATE-è¯­å¥" class="headerlink" title="ã€Step 2ã€‘æ‰§è¡Œç¬¬ä¸€ä¸ª UPDATE è¯­å¥"></a><strong>ã€Step 2ã€‘æ‰§è¡Œç¬¬ä¸€ä¸ª <code>UPDATE</code> è¯­å¥</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li><strong>MySQL æ‰§è¡Œè¿™æ¡è¯­å¥åï¼Œä¿®æ”¹çš„æ˜¯ InnoDB çš„æ•°æ®é¡µ</strong>ï¼ˆå‡è®¾æ•°æ®é¡µåŸæœ¬åœ¨ Buffer Pool ä¸­ï¼‰ã€‚</li><li><strong>æ­¤æ—¶ï¼ŒMySQL éœ€è¦è®°å½•è¯¥ä¿®æ”¹ï¼Œä»¥ä¾¿å®•æœºæ—¶èƒ½å¤Ÿæ¢å¤ï¼Œå› æ­¤ä¼šå†™å…¥ Redo Log Bufferï¼ˆRedo Log å…ˆå†™å…¥å†…å­˜ï¼‰ã€‚</strong></li><li><strong>ä½†æ˜¯ Binlog å¹¶ä¸ä¼šç«‹å³å†™å…¥ï¼Œè€Œæ˜¯å…ˆæ”¾åˆ° Binlog Cache ä¸­ï¼Œå¹¶ä¸ä¼šç«‹å³è½ç›˜ã€‚</strong></li></ul><p>âœ… <strong>Redo Logï¼ˆç‰©ç†æ—¥å¿—ï¼‰</strong>ï¼š</p><ul><li>è®°å½• <strong>â€œè´¦æˆ· 1 ä½™é¢å‡å°‘ 100 å…ƒâ€</strong> çš„ç‰©ç†å˜æ›´ã€‚</li><li><strong>å¯ä»¥éšæ—¶å†™å…¥</strong>ï¼ˆå³ä½¿äº‹åŠ¡è¿˜æ²¡æäº¤ï¼‰ã€‚</li></ul><p>âŒ <strong>Binlogï¼ˆé€»è¾‘æ—¥å¿—ï¼‰</strong>ï¼š</p><ul><li><strong>ä¸ä¼šç«‹å³å†™å…¥ binlogï¼Œè€Œæ˜¯ç­‰åˆ°äº‹åŠ¡æäº¤æ—¶å†ä¸€æ¬¡æ€§å†™å…¥ã€‚</strong></li></ul><hr><h3 id="ã€Step-3ã€‘æ‰§è¡Œç¬¬äºŒä¸ª-UPDATE-è¯­å¥"><a href="#ã€Step-3ã€‘æ‰§è¡Œç¬¬äºŒä¸ª-UPDATE-è¯­å¥" class="headerlink" title="ã€Step 3ã€‘æ‰§è¡Œç¬¬äºŒä¸ª UPDATE è¯­å¥"></a><strong>ã€Step 3ã€‘æ‰§è¡Œç¬¬äºŒä¸ª <code>UPDATE</code> è¯­å¥</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><ul><li><strong>åŒæ ·ï¼ŒMySQL è®°å½•äº† ID&#x3D;2 è´¦æˆ·å¢åŠ  100 å…ƒçš„å˜æ›´</strong>ã€‚</li><li><strong>Redo Log Buffer å†æ¬¡å†™å…¥è¿™ä¸ªä¿®æ”¹ï¼ŒBinlog ä»ç„¶ä¸ä¼šå†™å…¥ã€‚</strong></li></ul><p>âœ… <strong>Redo Logï¼ˆç‰©ç†æ—¥å¿—ï¼‰</strong>ï¼š</p><ul><li>è®°å½• <strong>â€œè´¦æˆ· 2 ä½™é¢å¢åŠ  100 å…ƒâ€</strong>ã€‚</li><li><strong>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸æ–­å†™å…¥ Redo Log Buffer</strong>ã€‚</li></ul><p>âŒ <strong>Binlogï¼ˆé€»è¾‘æ—¥å¿—ï¼‰</strong>ï¼š</p><ul><li>ä¾ç„¶ <strong>ä¸ä¼šç«‹å³å†™å…¥</strong>ï¼Œä»ç„¶åœ¨ Binlog Cache é‡Œã€‚</li></ul><hr><h3 id="ã€Step-4ã€‘æäº¤äº‹åŠ¡ï¼ˆCOMMITï¼‰"><a href="#ã€Step-4ã€‘æäº¤äº‹åŠ¡ï¼ˆCOMMITï¼‰" class="headerlink" title="ã€Step 4ã€‘æäº¤äº‹åŠ¡ï¼ˆCOMMITï¼‰"></a><strong>ã€Step 4ã€‘æäº¤äº‹åŠ¡ï¼ˆCOMMITï¼‰</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>å½“äº‹åŠ¡æäº¤æ—¶ï¼ŒMySQL é‡‡ç”¨<strong>ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰</strong>ï¼Œä»¥ä¿è¯ Binlog å’Œ Redo Log çš„ä¸€è‡´æ€§ã€‚æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p><strong>å†™å…¥ Binlog</strong>ï¼š</p><ul><li><p>äº‹åŠ¡æäº¤æ—¶ï¼ŒMySQL <strong>ä¸€æ¬¡æ€§</strong> æŠŠ <strong>æ•´ä¸ªäº‹åŠ¡çš„ SQL è¯­å¥è®°å½•</strong>ï¼ˆé€»è¾‘å˜æ›´ï¼‰<strong>å†™å…¥ Binlog æ–‡ä»¶</strong>ã€‚</p></li><li><p>è¿™æ—¶å€™ Binlog è®°å½•çš„å†…å®¹ç±»ä¼¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE accounts SET balance = balance - 100 WHERE id = 1;</span><br><span class="line">UPDATE accounts SET balance = balance + 100 WHERE id = 2;</span><br></pre></td></tr></table></figure></li><li><p>Binlog <strong>å¿…é¡»ä¸€æ¬¡æ€§å†™å…¥æ•´ä¸ªäº‹åŠ¡ï¼Œå¦åˆ™æ— æ³•ç”¨äºä¸»ä»å¤åˆ¶å’Œ Point-In-Time æ¢å¤</strong>ã€‚</p></li></ul></li><li><p><strong>Redo Log è¿›å…¥ Prepare é˜¶æ®µ</strong>ï¼š</p><ul><li><strong>åœ¨å†™å…¥ Binlog ä¹‹åï¼ŒMySQL è¿›å…¥ Redo Log çš„ prepare é˜¶æ®µ</strong>ï¼Œç¡®ä¿ redo log è®°å½•çš„ç‰©ç†å˜æ›´ä¸ binlog å¯¹åº”ã€‚</li></ul></li><li><p><strong>Redo Log æ ‡è®° Commit å¹¶è½ç›˜</strong>ï¼š</p><ul><li>åœ¨ <strong>äº‹åŠ¡æäº¤æˆåŠŸåï¼ŒRedo Log è®°å½• <code>commit</code>ï¼Œæ­¤æ—¶æ•°æ®æ‰çœŸæ­£æŒä¹…åŒ–åˆ°ç£ç›˜</strong>ã€‚</li><li>Redo Log <strong>å…ˆå†™å…¥ç£ç›˜ï¼Œæ•°æ®é¡µå¯ä»¥ç¨åå†å†™å…¥</strong>ï¼Œè¿™å°±æ˜¯<strong>WALï¼ˆWrite Ahead Loggingï¼‰æœºåˆ¶</strong>ã€‚</li></ul></li></ol><hr><h2 id="3-ä¸ºä»€ä¹ˆ-Redo-Log-å¯ä»¥æå‰å†™å…¥ï¼Œè€Œ-Binlog-åªèƒ½åœ¨æäº¤æ—¶å†™ï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆ-Redo-Log-å¯ä»¥æå‰å†™å…¥ï¼Œè€Œ-Binlog-åªèƒ½åœ¨æäº¤æ—¶å†™ï¼Ÿ" class="headerlink" title="3. ä¸ºä»€ä¹ˆ Redo Log å¯ä»¥æå‰å†™å…¥ï¼Œè€Œ Binlog åªèƒ½åœ¨æäº¤æ—¶å†™ï¼Ÿ"></a><strong>3. ä¸ºä»€ä¹ˆ Redo Log å¯ä»¥æå‰å†™å…¥ï¼Œè€Œ Binlog åªèƒ½åœ¨æäº¤æ—¶å†™ï¼Ÿ</strong></h2><table><thead><tr><th><strong>æ—¥å¿—ç±»å‹</strong></th><th><strong>å†™å…¥æ—¶æœº</strong></th><th><strong>å†™å…¥å†…å®¹</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td><strong>Redo Logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong></td><td><strong>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸æ–­å†™å…¥</strong></td><td><strong>è®°å½•çš„æ˜¯ç‰©ç†æ•°æ®é¡µçš„å˜åŒ–</strong></td><td><strong>ä¿è¯å´©æºƒæ¢å¤ï¼Œå³ä½¿å®•æœºä¹Ÿèƒ½æ¢å¤æ•°æ®</strong></td></tr><tr><td><strong>Binlogï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰</strong></td><td><strong>äº‹åŠ¡æäº¤æ—¶ä¸€æ¬¡æ€§å†™å…¥</strong></td><td><strong>è®°å½•çš„æ˜¯ SQL è¯­å¥ï¼ˆé€»è¾‘å˜æ›´ï¼‰</strong></td><td><strong>ç”¨äºä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤ï¼Œå¿…é¡»ä¿è¯äº‹åŠ¡å®Œæ•´æ€§</strong></td></tr></tbody></table><ul><li><strong>Redo Log å¯ä»¥æå‰å†™å…¥ï¼Œå› ä¸ºå®ƒè®°å½•çš„æ˜¯â€œç‰©ç†å˜æ›´â€ï¼Œå³æ•°æ®é¡µçš„ä¿®æ”¹è®°å½•</strong>ã€‚å³ä½¿äº‹åŠ¡æœ€ç»ˆå›æ»šï¼ŒRedo Log ä¹Ÿå¯ä»¥ç”¨æ¥æ’¤é”€ä¿®æ”¹ï¼ˆUndo Log è´Ÿè´£äº‹åŠ¡å›æ»šï¼‰ã€‚</li><li><strong>Binlog å¿…é¡»ç­‰åˆ°äº‹åŠ¡æäº¤æ—¶ä¸€æ¬¡æ€§å†™å…¥ï¼ŒåŸå› æ˜¯ Binlog è®°å½•çš„æ˜¯äº‹åŠ¡çš„é€»è¾‘ SQL è¯­å¥</strong>ï¼Œå¦‚æœäº‹åŠ¡æœªæäº¤å°±å†™å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul><hr><h2 id="4-ç°å®åœºæ™¯ä¸‹çš„ä½œç”¨"><a href="#4-ç°å®åœºæ™¯ä¸‹çš„ä½œç”¨" class="headerlink" title="4. ç°å®åœºæ™¯ä¸‹çš„ä½œç”¨"></a><strong>4. ç°å®åœºæ™¯ä¸‹çš„ä½œç”¨</strong></h2><h3 id="âœ…-åœºæ™¯-1ï¼šMySQL-å´©æºƒæ¢å¤"><a href="#âœ…-åœºæ™¯-1ï¼šMySQL-å´©æºƒæ¢å¤" class="headerlink" title="âœ… åœºæ™¯ 1ï¼šMySQL å´©æºƒæ¢å¤"></a><strong>âœ… åœºæ™¯ 1ï¼šMySQL å´©æºƒæ¢å¤</strong></h3><p>å‡è®¾ MySQL åœ¨ <code>COMMIT</code> ä¹‹å‰å‘ç”Ÿå®•æœºï¼š</p><ul><li><strong>ç”±äº Redo Log åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å·²ç»å†™å…¥ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºæ¢å¤æœªæäº¤çš„äº‹åŠ¡ï¼Œä½¿æ•°æ®ä¿æŒä¸€è‡´æ€§</strong>ã€‚</li><li><strong>Binlog åªæœ‰åœ¨äº‹åŠ¡æäº¤åæ‰å†™å…¥ï¼Œå› æ­¤ Binlog ä¸ä¼šåŒ…å«æœªæäº¤çš„äº‹åŠ¡</strong>ã€‚</li></ul><h3 id="âœ…-åœºæ™¯-2ï¼šMySQL-ä¸»ä»å¤åˆ¶"><a href="#âœ…-åœºæ™¯-2ï¼šMySQL-ä¸»ä»å¤åˆ¶" class="headerlink" title="âœ… åœºæ™¯ 2ï¼šMySQL ä¸»ä»å¤åˆ¶"></a><strong>âœ… åœºæ™¯ 2ï¼šMySQL ä¸»ä»å¤åˆ¶</strong></h3><ul><li><strong>ä¸»åº“çš„ Binlog éœ€è¦å®Œæ•´è®°å½•äº‹åŠ¡ï¼Œä»¥ä¾¿ä»åº“å¯ä»¥è¿›è¡Œä¸€è‡´æ€§çš„é‡æ”¾</strong>ã€‚</li><li><strong>å¦‚æœ Binlog å…è®¸æ‹†å¼€å†™å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»åº“çš„æ•°æ®ä¸ä¸€è‡´ï¼ˆæ¯”å¦‚åªæ‰§è¡Œäº†ä¸€åŠçš„ SQL è¯­å¥ï¼‰</strong>ã€‚</li></ul></blockquote><ul><li><strong>Redo Log å¯ä»¥æå‰å†™å…¥ï¼Œå› ä¸ºå®ƒè®°å½•çš„æ˜¯â€œç‰©ç†å˜æ›´â€ï¼Œå³æ•°æ®é¡µçš„ä¿®æ”¹è®°å½•</strong>ã€‚å³ä½¿äº‹åŠ¡æœ€ç»ˆå›æ»šï¼ŒRedo Log ä¹Ÿå¯ä»¥ç”¨æ¥æ’¤é”€ä¿®æ”¹ï¼ˆUndo Log è´Ÿè´£äº‹åŠ¡å›æ»šï¼‰ã€‚</li><li><strong>Binlog å¿…é¡»ç­‰åˆ°äº‹åŠ¡æäº¤æ—¶ä¸€æ¬¡æ€§å†™å…¥ï¼ŒåŸå› æ˜¯ Binlog è®°å½•çš„æ˜¯äº‹åŠ¡çš„é€»è¾‘ SQL è¯­å¥</strong>ï¼Œå¦‚æœäº‹åŠ¡æœªæäº¤å°±å†™å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041613856.png" alt="img"></p><p>ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤</strong>åï¼Œå†™å…¥ binlog æ—¶å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸º MySQL æ ¹æ® redo log æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå‘ç° redo log è¿˜å¤„äº<code>prepare</code>é˜¶æ®µï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹åº” binlog æ—¥å¿—ï¼Œå°±ä¼šå›æ»šè¯¥äº‹åŠ¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041614450.png" alt="img"></p><p>å†çœ‹ä¸€ä¸ªåœºæ™¯ï¼Œredo log è®¾ç½®<code>commit</code>é˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¼šä¸ä¼šå›æ»šäº‹åŠ¡å‘¢ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503041615730.png" alt="img"></p><p>å¹¶ä¸ä¼šå›æ»šäº‹åŠ¡ï¼Œå®ƒä¼šæ‰§è¡Œä¸Šå›¾æ¡†ä½çš„é€»è¾‘ï¼Œè™½ç„¶ redo log æ˜¯å¤„äº<code>prepare</code>é˜¶æ®µï¼Œä½†æ˜¯èƒ½é€šè¿‡äº‹åŠ¡<code>id</code>æ‰¾åˆ°å¯¹åº”çš„ binlog æ—¥å¿—ï¼Œæ‰€ä»¥ MySQL è®¤ä¸ºæ˜¯å®Œæ•´çš„ï¼Œå°±ä¼šæäº¤äº‹åŠ¡æ¢å¤æ•°æ®ã€‚</p><h2 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h2><p>æ¯ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®çš„ä¿®æ”¹éƒ½ä¼šè¢«è®°å½•åˆ° undo log ï¼Œå½“æ‰§è¡Œäº‹åŠ¡è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯æˆ–è€…éœ€è¦æ‰§è¡Œå›æ»šæ“ä½œçš„è¯ï¼ŒMySQL å¯ä»¥åˆ©ç”¨ undo log å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>undo log å±äºé€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯ SQL è¯­å¥ï¼Œæ¯”å¦‚è¯´äº‹åŠ¡æ‰§è¡Œä¸€æ¡ DELETE è¯­å¥ï¼Œé‚£ undo log å°±ä¼šè®°å½•ä¸€æ¡ç›¸å¯¹åº”çš„ INSERT è¯­å¥ã€‚åŒæ—¶ï¼Œundo log çš„ä¿¡æ¯ä¹Ÿä¼šè¢«è®°å½•åˆ° redo log ä¸­ï¼Œå› ä¸º undo log ä¹Ÿè¦å®ç°æŒä¹…æ€§ä¿æŠ¤ã€‚å¹¶ä¸”ï¼Œundo-log æœ¬èº«æ˜¯ä¼šè¢«åˆ é™¤æ¸…ç†çš„ï¼Œä¾‹å¦‚ INSERT æ“ä½œï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹åå°±å¯ä»¥æ¸…é™¤æ‰äº†ï¼›UPDATE&#x2F;DELETE æ“ä½œåœ¨äº‹åŠ¡æäº¤ä¸ä¼šç«‹å³åˆ é™¤ï¼Œä¼šåŠ å…¥ history listï¼Œç”±åå°çº¿ç¨‹ purge è¿›è¡Œæ¸…ç†ã€‚</p><p>undo log æ˜¯é‡‡ç”¨ segmentï¼ˆæ®µï¼‰çš„æ–¹å¼æ¥è®°å½•çš„ï¼Œæ¯ä¸ª undo æ“ä½œåœ¨è®°å½•çš„æ—¶å€™å ç”¨ä¸€ä¸ª <strong>undo log segment</strong>ï¼ˆundo æ—¥å¿—æ®µï¼‰ï¼Œundo log segment åŒ…å«åœ¨ <strong>rollback segment</strong>ï¼ˆå›æ»šæ®µï¼‰ä¸­ã€‚äº‹åŠ¡å¼€å§‹æ—¶ï¼Œéœ€è¦ä¸ºå…¶åˆ†é…ä¸€ä¸ª rollback segmentã€‚æ¯ä¸ª rollback segment æœ‰ 1024 ä¸ª undo log segmentï¼Œè¿™æœ‰åŠ©äºç®¡ç†å¤šä¸ªå¹¶å‘äº‹åŠ¡çš„å›æ»šéœ€æ±‚ã€‚</p><blockquote><h3 id="MySQL-äº‹åŠ¡ä¸­-Undo-Logã€Redo-Log-å’Œ-Binlog-çš„ååŒå·¥ä½œ"><a href="#MySQL-äº‹åŠ¡ä¸­-Undo-Logã€Redo-Log-å’Œ-Binlog-çš„ååŒå·¥ä½œ" class="headerlink" title="MySQL äº‹åŠ¡ä¸­ Undo Logã€Redo Log å’Œ Binlog çš„ååŒå·¥ä½œ"></a><strong>MySQL äº‹åŠ¡ä¸­ Undo Logã€Redo Log å’Œ Binlog çš„ååŒå·¥ä½œ</strong></h3><p>æˆ‘ä»¬ç”¨ä¸€ä¸ª<strong>å…·ä½“çš„äº‹åŠ¡</strong>ï¼Œç»“åˆ <strong>Undo Log</strong>ã€<strong>Redo Log</strong> å’Œ <strong>Binlog</strong>ï¼Œè¯¦ç»†è®²è§£å®ƒä»¬åœ¨ MySQL ä¸­å¦‚ä½•ååŒå·¥ä½œã€‚</p><hr><h2 id="ğŸ”¹-1-äº‹åŠ¡ç¤ºä¾‹"><a href="#ğŸ”¹-1-äº‹åŠ¡ç¤ºä¾‹" class="headerlink" title="ğŸ”¹ 1. äº‹åŠ¡ç¤ºä¾‹"></a><strong>ğŸ”¹ 1. äº‹åŠ¡ç¤ºä¾‹</strong></h2><p>å‡è®¾æœ‰ä¸€ä¸ª <code>accounts</code> è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> accounts (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    balance <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„äº‹åŠ¡ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªäº‹åŠ¡çš„æ‰§è¡Œæµç¨‹æ¶‰åŠåˆ° <strong>ä¸‰ç§æ—¥å¿—</strong>ï¼Œåˆ†åˆ«æ‰¿æ‹…ä¸åŒçš„èŒè´£ã€‚</p><hr><h2 id="ğŸ”¹-2-Undo-Logã€Redo-Log-å’Œ-Binlog-åœ¨äº‹åŠ¡ä¸­çš„ä½œç”¨"><a href="#ğŸ”¹-2-Undo-Logã€Redo-Log-å’Œ-Binlog-åœ¨äº‹åŠ¡ä¸­çš„ä½œç”¨" class="headerlink" title="ğŸ”¹ 2. Undo Logã€Redo Log å’Œ Binlog åœ¨äº‹åŠ¡ä¸­çš„ä½œç”¨"></a><strong>ğŸ”¹ 2. Undo Logã€Redo Log å’Œ Binlog åœ¨äº‹åŠ¡ä¸­çš„ä½œç”¨</strong></h2><h3 id="ğŸš€-Step-1ï¼šäº‹åŠ¡å¼€å§‹ï¼ˆBEGINï¼‰"><a href="#ğŸš€-Step-1ï¼šäº‹åŠ¡å¼€å§‹ï¼ˆBEGINï¼‰" class="headerlink" title="ğŸš€ Step 1ï¼šäº‹åŠ¡å¼€å§‹ï¼ˆBEGINï¼‰"></a><strong>ğŸš€ Step 1ï¼šäº‹åŠ¡å¼€å§‹ï¼ˆBEGINï¼‰</strong></h3><ul><li>äº‹åŠ¡å¼€å§‹åï¼ŒMySQL <strong>ä¸ä¼š</strong> ç«‹å³å†™æ—¥å¿—ï¼Œä½† <strong>Undo Logã€Redo Log å’Œ Binlog çš„ç©ºé—´å·²ç»å‡†å¤‡å¥½</strong>ã€‚</li></ul><hr><h3 id="ğŸš€-Step-2ï¼šæ‰§è¡Œ-UPDATE-è¯­å¥"><a href="#ğŸš€-Step-2ï¼šæ‰§è¡Œ-UPDATE-è¯­å¥" class="headerlink" title="ğŸš€ Step 2ï¼šæ‰§è¡Œ UPDATE è¯­å¥"></a><strong>ğŸš€ Step 2ï¼šæ‰§è¡Œ <code>UPDATE</code> è¯­å¥</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª SQL è¯­å¥å¯¹ <code>id=1</code> çš„ <code>balance</code> è¿›è¡Œäº†ä¿®æ”¹ï¼Œæ¶‰åŠ <strong>æ•°æ®é¡µçš„å˜æ›´</strong>ï¼Œæ­¤æ—¶æ¶‰åŠ <strong>Undo Logã€Redo Log å’Œç¼“å†²æ± ï¼ˆBuffer Poolï¼‰</strong>ã€‚</p><h4 id="1-Undo-Log-è®°å½•æ•°æ®çš„æ—§å€¼"><a href="#1-Undo-Log-è®°å½•æ•°æ®çš„æ—§å€¼" class="headerlink" title="(1) Undo Log è®°å½•æ•°æ®çš„æ—§å€¼"></a><strong>(1) Undo Log è®°å½•æ•°æ®çš„æ—§å€¼</strong></h4><ul><li><pre><code>Undo Log<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> è®°å½• </span><br><span class="line"></span><br><span class="line">ä¿®æ”¹å‰çš„ `balance=1000`</span><br><span class="line"></span><br><span class="line">ï¼Œä»¥ä¾¿äº‹åŠ¡å›æ»šæ—¶èƒ½å¤Ÿæ¢å¤ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>UNDO_LOG: &#123; TABLE: accounts, ROW_ID: 1, OLD_VALUE: 1000, NEW_VALUE: 900 &#125;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  Undo Log</span><br></pre></td></tr></table></figure> ä¸»è¦ç”¨äºï¼š1. **äº‹åŠ¡å›æ»š**ï¼šå¦‚æœäº‹åŠ¡æœ€ç»ˆ `ROLLBACK`ï¼ŒMySQL è¯»å– `Undo Log` å¹¶æ¢å¤ `balance = 1000`ã€‚2. **MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰**ï¼šå¦‚æœæœ‰äº‹åŠ¡è¦è¯»å–æ—§ç‰ˆæœ¬æ•°æ®ï¼ŒMySQL å¯ä»¥åˆ©ç”¨ `Undo Log` æ„é€ **ä¸€è‡´æ€§å¿«ç…§**ã€‚</code></pre></li></ul><h4 id="2-Redo-Log-è®°å½•æ•°æ®å˜æ›´"><a href="#2-Redo-Log-è®°å½•æ•°æ®å˜æ›´" class="headerlink" title="(2) Redo Log è®°å½•æ•°æ®å˜æ›´"></a><strong>(2) Redo Log è®°å½•æ•°æ®å˜æ›´</strong></h4><ul><li><pre><code>Redo Log<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> è®°å½• </span><br><span class="line"></span><br><span class="line">æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹</span><br><span class="line"></span><br><span class="line">ï¼Œä¿è¯äº‹åŠ¡å´©æºƒåä»èƒ½æ¢å¤ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>REDO_LOG: &#123; TABLE: accounts, ROW_ID: 1, CHANGE: balance=900 &#125;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- `Redo Log` **å…ˆå†™å…¥ `Redo Buffer`ï¼Œç¨ååˆ·ç›˜åˆ° `Redo Log` æ–‡ä»¶**ã€‚</span><br><span class="line"></span><br><span class="line">#### **(3) æ•°æ®å†™å…¥ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰**</span><br><span class="line"></span><br><span class="line">- `UPDATE` è¯­å¥å¹¶ä¸ä¼š**ç«‹å³**å°† `balance=900` å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯ä¿®æ”¹ **Buffer Pool**ï¼ˆå†…å­˜ä¸­çš„æ•°æ®é¡µï¼‰ã€‚</span><br><span class="line">- ä¹‹å **ç”± InnoDB çš„ Checkpoint æœºåˆ¶å†³å®šä½•æ—¶æŠŠæ•°æ®åŒæ­¥åˆ°ç£ç›˜**ã€‚</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">### **ğŸš€ Step 3ï¼šäº‹åŠ¡æäº¤ï¼ˆCOMMITï¼‰**</span><br><span class="line"></span><br><span class="line">```sql</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure></code></pre></li></ul><p>å½“äº‹åŠ¡æäº¤æ—¶ï¼Œæ¶‰åŠ <strong>Redo Logã€Binlog ä»¥åŠ Undo Log</strong> çš„å¤„ç†ã€‚</p><h4 id="1-Binlog-è®°å½•å®Œæ•´çš„-SQL-æ“ä½œ"><a href="#1-Binlog-è®°å½•å®Œæ•´çš„-SQL-æ“ä½œ" class="headerlink" title="(1) Binlog è®°å½•å®Œæ•´çš„ SQL æ“ä½œ"></a><strong>(1) Binlog è®°å½•å®Œæ•´çš„ SQL æ“ä½œ</strong></h4><ul><li><p>Binlog æ˜¯é€»è¾‘æ—¥å¿—</p><p>ï¼Œè®°å½•çš„æ˜¯ </p><p>SQL è¯­å¥</p><p>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BINLOG: &#123; TRANSACTION: &quot;UPDATE accounts SET balance = balance - 100 WHERE id = 1;&quot; &#125;</span><br></pre></td></tr></table></figure></li><li><p>Binlog </p><p>ä»…åœ¨äº‹åŠ¡æäº¤æ—¶å†™å…¥ç£ç›˜</p><p>ï¼Œå®ƒçš„ä½œç”¨ï¼š</p><ol><li><strong>ç”¨äºä¸»ä»å¤åˆ¶</strong>ï¼Œä¿è¯ä¸»åº“ä¸ä»åº“æ•°æ®ä¸€è‡´ã€‚</li><li><strong>ç”¨äº Point-in-Time Recoveryï¼ˆæ—¶é—´ç‚¹æ¢å¤ï¼‰</strong>ï¼Œæ”¯æŒåŸºäº Binlog è¿›è¡Œæ•°æ®å›æº¯ã€‚</li></ol></li></ul><h4 id="2-Redo-Log-æ ‡è®°äº‹åŠ¡æäº¤"><a href="#2-Redo-Log-æ ‡è®°äº‹åŠ¡æäº¤" class="headerlink" title="(2) Redo Log æ ‡è®°äº‹åŠ¡æäº¤"></a><strong>(2) Redo Log æ ‡è®°äº‹åŠ¡æäº¤</strong></h4><ul><li><p>Redo Log é‡‡ç”¨ â€œWALï¼ˆWrite-Ahead Loggingï¼‰â€ æœºåˆ¶</p><p>ï¼Œå®ƒåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å°±å·²ç»å†™å…¥äº† </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Redo Log Buffer</span><br></pre></td></tr></table></figure><p>ï¼Œä½† </p><p>åªæœ‰åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œæ‰ä¼šå°†äº‹åŠ¡æ ‡è®°ä¸º â€œæäº¤â€ çŠ¶æ€</p><p>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REDO_LOG: &#123; TRANSACTION_ID: 1001, STATUS: COMMITTED &#125;</span><br></pre></td></tr></table></figure></li><li><p>è¿™æ ·ï¼Œå³ä½¿ MySQL <strong>å´©æºƒé‡å¯</strong>ï¼Œä¹Ÿèƒ½é€šè¿‡ Redo Log <strong>æ¢å¤å·²æäº¤äº‹åŠ¡çš„æ•°æ®</strong>ã€‚</p></li></ul><h4 id="3-Undo-Log-çš„å¤„ç†"><a href="#3-Undo-Log-çš„å¤„ç†" class="headerlink" title="(3) Undo Log çš„å¤„ç†"></a><strong>(3) Undo Log çš„å¤„ç†</strong></h4><ul><li><strong>Undo Log ä¸èƒ½ç«‹å³åˆ é™¤ï¼</strong></li><li><strong><code>Insert Undo Log</code> å¯ä»¥ç«‹å³åˆ é™¤</strong>ï¼ˆå¦‚æœäº‹åŠ¡æ’å…¥æ•°æ®ï¼Œå›æ»šåä¸å†éœ€è¦ï¼‰ã€‚</li><li><strong><code>Update Undo Log</code> éœ€è¦ä¿ç•™ä¸€æ®µæ—¶é—´</strong>ï¼Œç”¨äº <strong>MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</strong>ã€‚</li><li><strong>æœ€ç»ˆ</strong>ï¼Œå½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦è¿™äº› Undo Log åï¼ŒInnoDB çš„ <code>Purge</code> çº¿ç¨‹ä¼šæ¸…ç†å®ƒä»¬ã€‚</li></ul><hr><h2 id="ğŸ”¹-3-æ€»ç»“ï¼šä¸‰ç§æ—¥å¿—çš„ä½œç”¨"><a href="#ğŸ”¹-3-æ€»ç»“ï¼šä¸‰ç§æ—¥å¿—çš„ä½œç”¨" class="headerlink" title="ğŸ”¹ 3. æ€»ç»“ï¼šä¸‰ç§æ—¥å¿—çš„ä½œç”¨"></a><strong>ğŸ”¹ 3. æ€»ç»“ï¼šä¸‰ç§æ—¥å¿—çš„ä½œç”¨</strong></h2><table><thead><tr><th><strong>æ—¥å¿—ç±»å‹</strong></th><th><strong>ä½œç”¨</strong></th><th><strong>å†™å…¥æ—¶æœº</strong></th><th><strong>åˆ é™¤æ—¶æœº</strong></th></tr></thead><tbody><tr><td><strong>Undo Log</strong></td><td>è®°å½•æ•°æ®çš„<strong>æ—§å€¼</strong>ï¼Œæ”¯æŒäº‹åŠ¡å›æ»š &amp; MVCC</td><td>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å†™å…¥</td><td><code>Insert Undo Log</code> åœ¨ <code>COMMIT</code> æ—¶å¯åˆ é™¤ï¼Œ<code>Update Undo Log</code> éœ€è¦ç­‰å¾… <code>MVCC</code> å¤„ç†åæ¸…ç†</td></tr><tr><td><strong>Redo Log</strong></td><td>è®°å½•<strong>æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹</strong>ï¼Œä¿è¯å´©æºƒæ¢å¤</td><td>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å†™å…¥</td><td>äº‹åŠ¡æäº¤åï¼Œæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜åå¯è¦†ç›–</td></tr><tr><td><strong>Binlog</strong></td><td>è®°å½•<strong>SQL é€»è¾‘æ“ä½œ</strong>ï¼Œç”¨äºä¸»ä»å¤åˆ¶ &amp; æ•°æ®æ¢å¤</td><td>äº‹åŠ¡æäº¤æ—¶ä¸€æ¬¡æ€§å†™å…¥</td><td>éœ€è¦é•¿æœŸä¿ç•™ï¼Œä»¥æ”¯æŒæ•°æ®æ¢å¤</td></tr></tbody></table><hr><h2 id="ğŸ”¹-4-äº‹åŠ¡å›æ»šï¼ˆROLLBACKï¼‰"><a href="#ğŸ”¹-4-äº‹åŠ¡å›æ»šï¼ˆROLLBACKï¼‰" class="headerlink" title="ğŸ”¹ 4. äº‹åŠ¡å›æ»šï¼ˆROLLBACKï¼‰"></a><strong>ğŸ”¹ 4. äº‹åŠ¡å›æ»šï¼ˆROLLBACKï¼‰</strong></h2><p>å¦‚æœäº‹åŠ¡ <strong>æ‰§è¡Œ <code>ROLLBACK</code></strong>ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>è¯»å– <code>Undo Log</code></strong>ï¼Œå°† <code>balance = 900</code> è¿˜åŸä¸º <code>1000</code>ã€‚</li><li><strong>ä¸å†å†™å…¥ <code>Redo Log</code>ï¼ˆäº‹åŠ¡æœªæäº¤ï¼‰</strong>ã€‚</li><li><strong>Binlog ä¸ä¼šè®°å½•è¯¥äº‹åŠ¡ï¼ˆå› ä¸ºäº‹åŠ¡æœªæäº¤ï¼‰</strong>ã€‚</li></ol><hr><h2 id="ğŸ”¹-5-äº‹åŠ¡å´©æºƒæ¢å¤"><a href="#ğŸ”¹-5-äº‹åŠ¡å´©æºƒæ¢å¤" class="headerlink" title="ğŸ”¹ 5. äº‹åŠ¡å´©æºƒæ¢å¤"></a><strong>ğŸ”¹ 5. äº‹åŠ¡å´©æºƒæ¢å¤</strong></h2><p>å¦‚æœåœ¨äº‹åŠ¡ <code>COMMIT</code> ä¹‹å‰å‘ç”Ÿå´©æºƒï¼š</p><ul><li><strong>Redo Log è®°å½•äº†æ•°æ®é¡µä¿®æ”¹</strong>ï¼Œä½† <strong>æ²¡æœ‰æäº¤æ ‡è®°</strong>ï¼ŒMySQL åœ¨æ¢å¤æ—¶ä¼š <strong>ä¸¢å¼ƒè¿™ä¸ªæœªæäº¤çš„äº‹åŠ¡</strong>ã€‚</li><li><strong>Undo Log ä»ç„¶æœ‰æ•ˆ</strong>ï¼Œå›æ»šäº‹åŠ¡ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</li><li><strong>Binlog æ²¡æœ‰è®°å½•è¿™ä¸ªäº‹åŠ¡ï¼ˆå› ä¸ºå®ƒåœ¨äº‹åŠ¡æäº¤æ—¶æ‰å†™å…¥ï¼‰</strong>ã€‚</li></ul><p>å¦‚æœåœ¨äº‹åŠ¡ <code>COMMIT</code> ä¹‹åå‘ç”Ÿå´©æºƒï¼š</p><ul><li><strong>Redo Log è®°å½•äº†äº‹åŠ¡æäº¤æ ‡è®°</strong>ï¼ŒMySQL é€šè¿‡ <code>Redo Log</code> è¿›è¡Œæ•°æ®æ¢å¤ã€‚</li><li><strong>Binlog è®°å½•å®Œæ•´äº‹åŠ¡ï¼Œå¯ç”¨äºä¸»ä»å¤åˆ¶</strong>ã€‚</li></ul><hr><h2 id="ğŸ”¹-6-æ€»ç»“"><a href="#ğŸ”¹-6-æ€»ç»“" class="headerlink" title="ğŸ”¹ 6. æ€»ç»“"></a><strong>ğŸ”¹ 6. æ€»ç»“</strong></h2><ol><li><strong>Undo Log</strong><ul><li><strong>ä½œç”¨</strong>ï¼šæ”¯æŒ<strong>äº‹åŠ¡å›æ»š</strong>å’Œ<strong>MVCC</strong>ï¼Œè®°å½•<strong>æ•°æ®çš„æ—§å€¼</strong>ã€‚</li><li><strong>åˆ é™¤æ—¶æœº</strong>ï¼šInsert Undo åœ¨äº‹åŠ¡æäº¤æ—¶åˆ é™¤ï¼ŒUpdate Undo éœ€è¦ç­‰ MVCC ç»“æŸåæ¸…ç†ã€‚</li></ul></li><li><strong>Redo Log</strong><ul><li><strong>ä½œç”¨</strong>ï¼šä¿è¯æ•°æ® <strong>å´©æºƒæ¢å¤</strong>ï¼Œè®°å½• <strong>æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹</strong>ã€‚</li><li><strong>æäº¤åæ•°æ®æ‰çœŸæ­£æŒä¹…åŒ–</strong>ï¼Œå³ä½¿å´©æºƒä¹Ÿèƒ½æ¢å¤ã€‚</li></ul></li><li><strong>Binlog</strong><ul><li><strong>ä½œç”¨</strong>ï¼šä¸»ä»å¤åˆ¶ &amp; æ—¶é—´ç‚¹æ¢å¤ï¼Œè®°å½• <strong>SQL é€»è¾‘æ“ä½œ</strong>ã€‚</li><li><strong>æäº¤æ—¶æ‰å†™å…¥</strong>ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</li></ul></li></ol><p>ğŸ‘‰ <strong>æœ€ç»ˆï¼ŒMySQL ä¾é </strong> <code>Undo Log</code> <strong>ä¿è¯äº‹åŠ¡åŸå­æ€§ï¼ˆå›æ»šï¼‰</strong>ï¼Œ<code>Redo Log</code> <strong>ä¿è¯å´©æºƒæ¢å¤</strong>ï¼Œ<code>Binlog</code> <strong>æ”¯æŒå¤åˆ¶å’Œæ•°æ®æ¢å¤</strong>ï¼Œä¸‰è€…äº’ç›¸é…åˆï¼Œç¡®ä¿äº‹åŠ¡çš„å¯é æ€§å’Œä¸€è‡´æ€§ã€‚ğŸš€</p><hr><p>ä½ è¿˜æœ‰å“ªäº›ç–‘é—®å—ï¼ŸğŸ˜Š</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> æ—¥å¿— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>80-05 æ—¶åºé¢„æµ‹å·¥ä¸šåº”ç”¨åœºæ™¯</title>
      <link href="/2025/03/03/80-05%20%E6%97%B6%E5%BA%8F%E9%A2%84%E6%B5%8B%E5%B7%A5%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
      <url>/2025/03/03/80-05%20%E6%97%B6%E5%BA%8F%E9%A2%84%E6%B5%8B%E5%B7%A5%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="80-05-æ—¶åºé¢„æµ‹å·¥ä¸šåº”ç”¨åœºæ™¯"><a href="#80-05-æ—¶åºé¢„æµ‹å·¥ä¸šåº”ç”¨åœºæ™¯" class="headerlink" title="80-05 æ—¶åºé¢„æµ‹å·¥ä¸šåº”ç”¨åœºæ™¯"></a>80-05 æ—¶åºé¢„æµ‹å·¥ä¸šåº”ç”¨åœºæ™¯</h1><h2 id="GPTæ¨èæ—¶åºé¢„æµ‹å·¥ä¸šåº”ç”¨åœºæ™¯"><a href="#GPTæ¨èæ—¶åºé¢„æµ‹å·¥ä¸šåº”ç”¨åœºæ™¯" class="headerlink" title="GPTæ¨èæ—¶åºé¢„æµ‹å·¥ä¸šåº”ç”¨åœºæ™¯"></a>GPTæ¨èæ—¶åºé¢„æµ‹å·¥ä¸šåº”ç”¨åœºæ™¯</h2><h3 id="æ—¶é—´åºåˆ—é¢„æµ‹åœ¨å·¥ä¸šåœºæ™¯ä¸­çš„åº”ç”¨åˆ†æ"><a href="#æ—¶é—´åºåˆ—é¢„æµ‹åœ¨å·¥ä¸šåœºæ™¯ä¸­çš„åº”ç”¨åˆ†æ" class="headerlink" title="æ—¶é—´åºåˆ—é¢„æµ‹åœ¨å·¥ä¸šåœºæ™¯ä¸­çš„åº”ç”¨åˆ†æ"></a>æ—¶é—´åºåˆ—é¢„æµ‹åœ¨å·¥ä¸šåœºæ™¯ä¸­çš„åº”ç”¨åˆ†æ</h3><p>æ—¶é—´åºåˆ—é¢„æµ‹åœ¨å·¥ä¸šé¢†åŸŸæœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œå¯ä»¥å¸®åŠ©ä¼˜åŒ–ç”Ÿäº§ã€é™ä½æˆæœ¬ã€æå‡æ•ˆç‡å’Œå‡å°‘é£é™©ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…¸å‹çš„å·¥ä¸šåº”ç”¨åœºæ™¯ï¼š</p><hr><h3 id="1-è®¾å¤‡ç»´æŠ¤ä¸æ•…éšœé¢„æµ‹ï¼ˆPredictive-Maintenanceï¼‰"><a href="#1-è®¾å¤‡ç»´æŠ¤ä¸æ•…éšœé¢„æµ‹ï¼ˆPredictive-Maintenanceï¼‰" class="headerlink" title="1. è®¾å¤‡ç»´æŠ¤ä¸æ•…éšœé¢„æµ‹ï¼ˆPredictive Maintenanceï¼‰"></a>1. è®¾å¤‡ç»´æŠ¤ä¸æ•…éšœé¢„æµ‹ï¼ˆPredictive Maintenanceï¼‰</h3><p><strong>ğŸ“Œ åœºæ™¯ï¼š</strong></p><ul><li>å·¥å‚çš„<strong>ä¼ æ„Ÿå™¨æ•°æ®</strong>ï¼ˆå¦‚æ¸©åº¦ã€æŒ¯åŠ¨ã€å‹åŠ›ã€ç”µæµç­‰ï¼‰å¯ç”¨äºé¢„æµ‹è®¾å¤‡çš„å¥åº·çŠ¶å†µï¼Œé˜²æ­¢çªå‘æ•…éšœã€‚</li><li>ä¾‹å¦‚ï¼Œ<strong>é£åŠ›å‘ç”µæœº</strong>çš„ä¼ æ„Ÿå™¨å¯ä»¥æ£€æµ‹å¶ç‰‡çš„æŒ¯åŠ¨æ¨¡å¼ï¼Œé¢„æµ‹å¯èƒ½çš„æŸåæ—¶é—´ï¼Œä»è€Œæå‰å®‰æ’ç»´ä¿®ï¼Œé™ä½åœæœºæŸå¤±ã€‚</li></ul><p><strong>ğŸ“Š é¢„æµ‹ç›®æ ‡ï¼š</strong></p><ul><li>é¢„æµ‹è®¾å¤‡çš„å‰©ä½™å¯¿å‘½ï¼ˆRULï¼ŒRemaining Useful Lifeï¼‰ã€‚</li><li>é¢„æµ‹è®¾å¤‡çš„å¼‚å¸¸è¶‹åŠ¿ï¼Œæå‰è¿›è¡Œé¢„é˜²æ€§ç»´æŠ¤ã€‚</li></ul><p><strong>ğŸ”§ é€‚ç”¨æŠ€æœ¯ï¼š</strong></p><ul><li><strong>LSTM&#x2F;GRU</strong>ï¼ˆå¤„ç†æ—¶é—´åºåˆ—çš„çŠ¶æ€å˜åŒ–ï¼‰ã€‚</li><li><strong>TCNï¼ˆæ—¶é—´å·ç§¯ç½‘ç»œï¼‰</strong>ï¼ˆæ•æ‰é•¿æœŸä¾èµ–ï¼‰ã€‚</li><li><strong>Transformer</strong>ï¼ˆå»ºæ¨¡å¤æ‚çš„å¤šå˜é‡æ—¶é—´åºåˆ—ï¼‰ã€‚</li></ul><hr><h3 id="2-ç”Ÿäº§éœ€æ±‚é¢„æµ‹ï¼ˆDemand-Forecastingï¼‰"><a href="#2-ç”Ÿäº§éœ€æ±‚é¢„æµ‹ï¼ˆDemand-Forecastingï¼‰" class="headerlink" title="2. ç”Ÿäº§éœ€æ±‚é¢„æµ‹ï¼ˆDemand Forecastingï¼‰"></a>2. ç”Ÿäº§éœ€æ±‚é¢„æµ‹ï¼ˆDemand Forecastingï¼‰</h3><p><strong>ğŸ“Œ åœºæ™¯ï¼š</strong></p><ul><li><strong>åˆ¶é€ ä¼ä¸š</strong>å¯ä»¥åˆ©ç”¨å†å²è®¢å•æ•°æ®é¢„æµ‹æœªæ¥çš„ç”Ÿäº§éœ€æ±‚ï¼Œåˆç†å®‰æ’ç”Ÿäº§è®¡åˆ’ï¼Œé¿å…åŸææ–™çŸ­ç¼ºæˆ–åº“å­˜ç§¯å‹ã€‚</li><li>ä¾‹å¦‚ï¼Œ<strong>æ±½è½¦åˆ¶é€ å•†</strong>å¯ä»¥é¢„æµ‹æœªæ¥å‡ ä¸ªæœˆçš„å¸‚åœºéœ€æ±‚ï¼Œè°ƒæ•´ç”Ÿäº§èŠ‚å¥ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ã€‚</li></ul><p><strong>ğŸ“Š é¢„æµ‹ç›®æ ‡ï¼š</strong></p><ul><li>é¢„æµ‹æœªæ¥è®¢å•æ•°é‡ã€‚</li><li>é¢„æµ‹å¸‚åœºéœ€æ±‚æ³¢åŠ¨ï¼Œä¼˜åŒ–åº“å­˜ç®¡ç†ã€‚</li></ul><p><strong>ğŸ”§ é€‚ç”¨æŠ€æœ¯ï¼š</strong></p><ul><li><strong>DeepAR</strong>ï¼ˆé€‚ç”¨äºå¤šä¸ªç›¸å…³æ—¶é—´åºåˆ—çš„é¢„æµ‹ï¼‰ã€‚</li><li><strong>Transformer</strong>ï¼ˆç”¨äºå¤šå› ç´ å»ºæ¨¡ï¼Œå¦‚å¸‚åœºè¶‹åŠ¿ã€èŠ‚å‡æ—¥ç­‰ï¼‰ã€‚</li><li><strong>Prophet</strong>ï¼ˆé€‚ç”¨äºå‘¨æœŸæ€§æ˜æ˜¾çš„é¢„æµ‹ï¼Œå¦‚å­£èŠ‚æ€§éœ€æ±‚ï¼‰ã€‚</li></ul><hr><h3 id="3-èƒ½æºæ¶ˆè€—é¢„æµ‹ï¼ˆEnergy-Consumption-Forecastingï¼‰"><a href="#3-èƒ½æºæ¶ˆè€—é¢„æµ‹ï¼ˆEnergy-Consumption-Forecastingï¼‰" class="headerlink" title="3. èƒ½æºæ¶ˆè€—é¢„æµ‹ï¼ˆEnergy Consumption Forecastingï¼‰"></a>3. èƒ½æºæ¶ˆè€—é¢„æµ‹ï¼ˆEnergy Consumption Forecastingï¼‰</h3><p><strong>ğŸ“Œ åœºæ™¯ï¼š</strong></p><ul><li><strong>ç”µç½‘å…¬å¸</strong>éœ€è¦é¢„æµ‹æœªæ¥çš„ç”¨ç”µéœ€æ±‚ï¼Œä»¥ä¼˜åŒ–ç”µåŠ›è°ƒåº¦ï¼Œé˜²æ­¢ç”µåŠ›æµªè´¹æˆ–ä¾›ç”µä¸è¶³ã€‚</li><li><strong>å·¥ä¸šå›­åŒº</strong>å¯ä»¥é¢„æµ‹ä¸åŒæ—¶é—´æ®µçš„èƒ½æºæ¶ˆè€—ï¼Œä¼˜åŒ–èŠ‚èƒ½ç­–ç•¥ï¼Œé™ä½ç”Ÿäº§æˆæœ¬ã€‚</li><li>ä¾‹å¦‚ï¼Œ<strong>é’¢é“å‚</strong>çš„ç”µå¼§ç‚‰èƒ½è€—é«˜åº¦æ³¢åŠ¨ï¼Œç²¾å‡†é¢„æµ‹èƒ½è€—å¯ä»¥ä¼˜åŒ–ç”µè´¹æ”¯å‡ºã€‚</li></ul><p><strong>ğŸ“Š é¢„æµ‹ç›®æ ‡ï¼š</strong></p><ul><li>é¢„æµ‹æœªæ¥çš„ç”µåŠ›ã€ç‡ƒæ°”æˆ–æ°´èµ„æºæ¶ˆè€—ã€‚</li><li>é¢„æµ‹å³°å€¼è´Ÿè½½ï¼Œé¿å…è®¾å¤‡è¿‡è½½æˆ–èµ„æºçŸ­ç¼ºã€‚</li></ul><p><strong>ğŸ”§ é€‚ç”¨æŠ€æœ¯ï¼š</strong></p><ul><li><strong>LSTM&#x2F;GRU</strong>ï¼ˆé€‚ç”¨äºéçº¿æ€§æ—¶é—´åºåˆ—ï¼‰ã€‚</li><li><strong>Transformer</strong>ï¼ˆé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®é¢„æµ‹ï¼‰ã€‚</li><li><strong>XGBoost</strong>ï¼ˆé€‚ç”¨äºç»“æ„åŒ–ç‰¹å¾çš„é¢„æµ‹ï¼Œå¦‚æ¸©åº¦ã€æ¹¿åº¦ã€ç”Ÿäº§è®¡åˆ’ç­‰ï¼‰ã€‚</li></ul><hr><h3 id="4-è´¨é‡æ£€æµ‹ä¸å¼‚å¸¸æ£€æµ‹ï¼ˆQuality-Inspection-Anomaly-Detectionï¼‰"><a href="#4-è´¨é‡æ£€æµ‹ä¸å¼‚å¸¸æ£€æµ‹ï¼ˆQuality-Inspection-Anomaly-Detectionï¼‰" class="headerlink" title="4. è´¨é‡æ£€æµ‹ä¸å¼‚å¸¸æ£€æµ‹ï¼ˆQuality Inspection &amp; Anomaly Detectionï¼‰"></a>4. è´¨é‡æ£€æµ‹ä¸å¼‚å¸¸æ£€æµ‹ï¼ˆQuality Inspection &amp; Anomaly Detectionï¼‰</h3><p><strong>ğŸ“Œ åœºæ™¯ï¼š</strong></p><ul><li><strong>åŠå¯¼ä½“åˆ¶é€ </strong>ç­‰ç²¾å¯†è¡Œä¸šéœ€è¦é€šè¿‡ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆå¦‚æ¸©åº¦ã€æ¹¿åº¦ã€æŒ¯åŠ¨ï¼‰æ¥é¢„æµ‹äº§å“è´¨é‡ï¼Œå‡å°‘æ¬¡å“ç‡ã€‚</li><li>ä¾‹å¦‚ï¼Œ<strong>é’¢æç”Ÿäº§çº¿</strong>å¯ä»¥é€šè¿‡é«˜æ¸©ç‚‰çš„æ¸©åº¦æ›²çº¿é¢„æµ‹ææ–™çš„ç¡¬åº¦å’ŒéŸ§æ€§ï¼Œä¼˜åŒ–åŠ çƒ­å‚æ•°ã€‚</li></ul><p><strong>ğŸ“Š é¢„æµ‹ç›®æ ‡ï¼š</strong></p><ul><li>é¢„æµ‹äº§å“è´¨é‡è¶‹åŠ¿ï¼Œå‡å°‘åºŸå“ç‡ã€‚</li><li>é¢„æµ‹å¼‚å¸¸ç”Ÿäº§æƒ…å†µï¼ˆå¦‚è®¾å¤‡è¿‡çƒ­ã€ææ–™åå·®ï¼‰ã€‚</li></ul><p><strong>ğŸ”§ é€‚ç”¨æŠ€æœ¯ï¼š</strong></p><ul><li><strong>Autoencoder + LSTM</strong>ï¼ˆç”¨äºå¼‚å¸¸æ£€æµ‹ï¼‰ã€‚</li><li><strong>GANï¼ˆç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼‰</strong>ï¼ˆç”Ÿæˆæ­£å¸¸æ•°æ®ï¼Œè¯†åˆ«å¼‚å¸¸æƒ…å†µï¼‰ã€‚</li><li><strong>Isolation Forest</strong>ï¼ˆç”¨äºæ£€æµ‹å¼‚å¸¸æ—¶é—´åºåˆ—æ•°æ®ï¼‰ã€‚</li></ul><hr><h3 id="5-ç‰©æµä¸ä¾›åº”é“¾ä¼˜åŒ–ï¼ˆLogistics-Supply-Chainï¼‰"><a href="#5-ç‰©æµä¸ä¾›åº”é“¾ä¼˜åŒ–ï¼ˆLogistics-Supply-Chainï¼‰" class="headerlink" title="5. ç‰©æµä¸ä¾›åº”é“¾ä¼˜åŒ–ï¼ˆLogistics &amp; Supply Chainï¼‰"></a>5. ç‰©æµä¸ä¾›åº”é“¾ä¼˜åŒ–ï¼ˆLogistics &amp; Supply Chainï¼‰</h3><p><strong>ğŸ“Œ åœºæ™¯ï¼š</strong></p><ul><li><strong>ä»“å‚¨ç‰©æµå…¬å¸</strong>å¯ä»¥é¢„æµ‹æœªæ¥çš„è¿è¾“éœ€æ±‚ï¼Œä¼˜åŒ–è°ƒåº¦ï¼Œå‡å°‘ç©ºè½½ç‡ã€‚</li><li><strong>æ¸¯å£ç®¡ç†</strong>å¯ä»¥é¢„æµ‹æœªæ¥èˆ¹èˆ¶åˆ°æ¸¯æ—¶é—´ï¼Œæé«˜å¸è´§æ•ˆç‡ï¼Œå‡å°‘æ‹¥å µã€‚</li><li>ä¾‹å¦‚ï¼Œ<strong>å¿«é€’å…¬å¸</strong>å¯ä»¥é¢„æµ‹â€œåŒ11â€è´­ç‰©èŠ‚æœŸé—´çš„è®¢å•é‡ï¼Œæå‰å‡†å¤‡ä»“å‚¨ä¸é…é€èƒ½åŠ›ã€‚</li></ul><p><strong>ğŸ“Š é¢„æµ‹ç›®æ ‡ï¼š</strong></p><ul><li>é¢„æµ‹è´§è¿éœ€æ±‚ï¼Œä¼˜åŒ–è¿è¾“è®¡åˆ’ã€‚</li><li>é¢„æµ‹ä¾›åº”é“¾ç“¶é¢ˆï¼Œæé«˜ç‰©æµæ•ˆç‡ã€‚</li></ul><p><strong>ğŸ”§ é€‚ç”¨æŠ€æœ¯ï¼š</strong></p><ul><li><strong>Time Series Transformer</strong>ï¼ˆç”¨äºå¤æ‚ä¾›åº”é“¾é¢„æµ‹ï¼‰ã€‚</li><li><strong>DeepAR</strong>ï¼ˆé€‚ç”¨äºå¤šä¸ªå•†å“çš„éœ€æ±‚é¢„æµ‹ï¼‰ã€‚</li><li><strong>XGBoost</strong>ï¼ˆç»“åˆæ—¶é—´åºåˆ—ç‰¹å¾ä¸ç»“æ„åŒ–ç‰¹å¾ä¼˜åŒ–é¢„æµ‹ï¼‰ã€‚</li></ul><hr><h3 id="6-ç¯å¢ƒç›‘æµ‹ä¸æ±¡æŸ“é¢„æµ‹ï¼ˆEnvironmental-Monitoringï¼‰"><a href="#6-ç¯å¢ƒç›‘æµ‹ä¸æ±¡æŸ“é¢„æµ‹ï¼ˆEnvironmental-Monitoringï¼‰" class="headerlink" title="6. ç¯å¢ƒç›‘æµ‹ä¸æ±¡æŸ“é¢„æµ‹ï¼ˆEnvironmental Monitoringï¼‰"></a>6. ç¯å¢ƒç›‘æµ‹ä¸æ±¡æŸ“é¢„æµ‹ï¼ˆEnvironmental Monitoringï¼‰</h3><p><strong>ğŸ“Œ åœºæ™¯ï¼š</strong></p><ul><li><strong>å·¥å‚æ’æ”¾ç®¡ç†</strong>ï¼šé¢„æµ‹æœªæ¥æ±¡æŸ“ç‰©æ’æ”¾è¶‹åŠ¿ï¼Œç¡®ä¿è¾¾æ ‡æ’æ”¾ã€‚</li><li><strong>ç©ºæ°”è´¨é‡ç›‘æµ‹</strong>ï¼šé¢„æµ‹ç©ºæ°”æ±¡æŸ“æŒ‡æ•°ï¼ˆAQIï¼‰ï¼Œä¸ºæ”¿åºœæä¾›æ²»ç†å»ºè®®ã€‚</li><li><strong>æ°´è´¨ç›‘æµ‹</strong>ï¼šé¢„æµ‹å·¥ä¸šæ±¡æ°´çš„æ±¡æŸ“å˜åŒ–è¶‹åŠ¿ï¼Œé˜²æ­¢çªå‘æ±¡æŸ“äº‹æ•…ã€‚</li><li>ä¾‹å¦‚ï¼Œ<strong>ç«ç”µå‚</strong>å¯ä»¥é¢„æµ‹æœªæ¥COâ‚‚æ’æ”¾é‡ï¼Œä¼˜åŒ–ç¯ä¿æªæ–½ã€‚</li></ul><p><strong>ğŸ“Š é¢„æµ‹ç›®æ ‡ï¼š</strong></p><ul><li>é¢„æµ‹ç©ºæ°”æ±¡æŸ“æŒ‡æ•°ï¼ˆå¦‚PM2.5ã€SOâ‚‚ï¼‰ã€‚</li><li>é¢„æµ‹æ°´è´¨å˜åŒ–ï¼Œæå‰é‡‡å–æ²»ç†æªæ–½ã€‚</li></ul><p><strong>ğŸ”§ é€‚ç”¨æŠ€æœ¯ï¼š</strong></p><ul><li><strong>LSTM</strong>ï¼ˆæ•æ‰æ±¡æŸ“å˜åŒ–è¶‹åŠ¿ï¼‰ã€‚</li><li><strong>CNN-LSTM</strong>ï¼ˆç»“åˆç©ºé—´ä¿¡æ¯ä¸æ—¶é—´åºåˆ—ä¿¡æ¯ï¼‰ã€‚</li><li><strong>Bayesian Modelï¼ˆè´å¶æ–¯æ¨¡å‹ï¼‰</strong>ï¼ˆç”¨äºæ±¡æŸ“æµ“åº¦ä¸ç¡®å®šæ€§é¢„æµ‹ï¼‰ã€‚</li></ul><hr><h3 id="7-ä»·æ ¼é¢„æµ‹ï¼ˆPrice-Forecastingï¼‰"><a href="#7-ä»·æ ¼é¢„æµ‹ï¼ˆPrice-Forecastingï¼‰" class="headerlink" title="7. ä»·æ ¼é¢„æµ‹ï¼ˆPrice Forecastingï¼‰"></a>7. ä»·æ ¼é¢„æµ‹ï¼ˆPrice Forecastingï¼‰</h3><p><strong>ğŸ“Œ åœºæ™¯ï¼š</strong></p><ul><li><strong>åŸææ–™é‡‡è´­</strong>ï¼šå·¥å‚å¯ä»¥é¢„æµ‹<strong>é’¢æã€å¡‘æ–™ã€åŸæ²¹ç­‰åŸææ–™ä»·æ ¼</strong>ï¼Œé™ä½é‡‡è´­æˆæœ¬ã€‚</li><li><strong>ç”µåŠ›å¸‚åœº</strong>ï¼šç”µç½‘å…¬å¸å¯ä»¥é¢„æµ‹<strong>ç”µä»·</strong>ï¼Œä¼˜åŒ–å‘ç”µè°ƒåº¦ï¼Œé™ä½æˆæœ¬ã€‚</li><li>ä¾‹å¦‚ï¼Œ<strong>é’¢é“åˆ¶é€ å•†</strong>å¯ä»¥åˆ©ç”¨å†å²æ•°æ®é¢„æµ‹é“çŸ¿çŸ³ä»·æ ¼æ³¢åŠ¨ï¼Œæå‰è°ƒæ•´é‡‡è´­ç­–ç•¥ã€‚</li></ul><p><strong>ğŸ“Š é¢„æµ‹ç›®æ ‡ï¼š</strong></p><ul><li>é¢„æµ‹åŸææ–™ä»·æ ¼æ³¢åŠ¨ï¼Œä¼˜åŒ–é‡‡è´­è®¡åˆ’ã€‚</li><li>é¢„æµ‹ç”µåŠ›ä»·æ ¼ï¼Œä¼˜åŒ–ç”µåŠ›äº¤æ˜“ã€‚</li></ul><p><strong>ğŸ”§ é€‚ç”¨æŠ€æœ¯ï¼š</strong></p><ul><li><strong>ARIMA</strong>ï¼ˆé€‚ç”¨äºç¨³å®šçš„æ—¶é—´åºåˆ—ï¼‰ã€‚</li><li><strong>LSTM&#x2F;GRU</strong>ï¼ˆé€‚ç”¨äºéçº¿æ€§ä»·æ ¼æ³¢åŠ¨ï¼‰ã€‚</li><li><strong>Transformer</strong>ï¼ˆé€‚ç”¨äºå¤æ‚å¸‚åœºæ³¢åŠ¨å»ºæ¨¡ï¼‰ã€‚</li></ul><hr><h3 id="8-ç”Ÿäº§çº¿æ’ç¨‹ä¼˜åŒ–ï¼ˆProduction-Schedulingï¼‰"><a href="#8-ç”Ÿäº§çº¿æ’ç¨‹ä¼˜åŒ–ï¼ˆProduction-Schedulingï¼‰" class="headerlink" title="8. ç”Ÿäº§çº¿æ’ç¨‹ä¼˜åŒ–ï¼ˆProduction Schedulingï¼‰"></a>8. ç”Ÿäº§çº¿æ’ç¨‹ä¼˜åŒ–ï¼ˆProduction Schedulingï¼‰</h3><p><strong>ğŸ“Œ åœºæ™¯ï¼š</strong></p><ul><li><strong>åŠå¯¼ä½“åˆ¶é€ </strong>éœ€è¦é¢„æµ‹æœªæ¥ç”Ÿäº§è´Ÿè½½ï¼Œä¼˜åŒ–è®¾å¤‡æ’ç­ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ã€‚</li><li><strong>æ±½è½¦è£…é…çº¿</strong>å¯ä»¥é¢„æµ‹æœªæ¥çš„ç”Ÿäº§èŠ‚å¥ï¼Œä¼˜åŒ–å·¥äººæ’ç­ï¼Œæé«˜äº§èƒ½ã€‚</li><li>ä¾‹å¦‚ï¼Œ<strong>æ™ºèƒ½å·¥å‚</strong>å¯ä»¥é¢„æµ‹ç”Ÿäº§ç“¶é¢ˆï¼Œè°ƒæ•´ç”Ÿäº§è®¡åˆ’ï¼Œæé«˜è®¾å¤‡åˆ©ç”¨ç‡ã€‚</li></ul><p><strong>ğŸ“Š é¢„æµ‹ç›®æ ‡ï¼š</strong></p><ul><li>é¢„æµ‹ç”Ÿäº§è´Ÿè½½ï¼Œä¼˜åŒ–è®¾å¤‡è°ƒåº¦ã€‚</li><li>é¢„æµ‹ç”Ÿäº§å‘¨æœŸï¼Œæé«˜æ•ˆç‡ã€‚</li></ul><p><strong>ğŸ”§ é€‚ç”¨æŠ€æœ¯ï¼š</strong></p><ul><li><strong>Reinforcement Learningï¼ˆå¼ºåŒ–å­¦ä¹ ï¼‰+ LSTM</strong>ï¼ˆç”¨äºåŠ¨æ€è°ƒåº¦ï¼‰ã€‚</li><li><strong>Time Series Transformer</strong>ï¼ˆç”¨äºå¤æ‚ç”Ÿäº§è®¡åˆ’é¢„æµ‹ï¼‰ã€‚</li><li><strong>XGBoost</strong>ï¼ˆç”¨äºç»“åˆå†å²æ•°æ®ä¸å¤–éƒ¨å› ç´ ä¼˜åŒ–é¢„æµ‹ï¼‰ã€‚</li></ul><hr><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>æ—¶é—´åºåˆ—é¢„æµ‹åœ¨å·¥ä¸šé¢†åŸŸçš„åº”ç”¨æä¸ºå¹¿æ³›ï¼Œå¯ä»¥å¸®åŠ©ä¼ä¸šé™ä½æˆæœ¬ã€æé«˜ç”Ÿäº§æ•ˆç‡ã€ä¼˜åŒ–ä¾›åº”é“¾ç®¡ç†ç­‰ã€‚<strong>ä¸åŒåœºæ™¯ä¸‹éœ€è¦ä¸åŒçš„æ·±åº¦å­¦ä¹ æ–¹æ³•ï¼Œç»“åˆå…·ä½“éœ€æ±‚é€‰æ‹©æœ€ä¼˜çš„é¢„æµ‹ç­–ç•¥</strong>ã€‚</p><p>å¦‚æœä½ å¯¹æŸä¸ªå…·ä½“åœºæ™¯æ„Ÿå…´è¶£ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç»†åŒ–åˆ†ææˆ–æä¾›ä»£ç ç¤ºä¾‹ï¼ ğŸ˜Š</p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶åº </tag>
            
            <tag> è®ºæ–‡é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>80-04 æ—¶åºé¢„æµ‹åŸºç¡€æ¦‚å¿µ</title>
      <link href="/2025/03/03/80-04%20%E6%97%B6%E5%BA%8F%E9%A2%84%E6%B5%8B%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
      <url>/2025/03/03/80-04%20%E6%97%B6%E5%BA%8F%E9%A2%84%E6%B5%8B%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="80-04-æ—¶åºé¢„æµ‹åŸºç¡€æ¦‚å¿µ"><a href="#80-04-æ—¶åºé¢„æµ‹åŸºç¡€æ¦‚å¿µ" class="headerlink" title="80-04 æ—¶åºé¢„æµ‹åŸºç¡€æ¦‚å¿µ"></a>80-04 æ—¶åºé¢„æµ‹åŸºç¡€æ¦‚å¿µ</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h3 id="æ·±åº¦å­¦ä¹ åœ¨æ—¶é—´åºåˆ—é¢„æµ‹ä¸­çš„å¿«é€Ÿå…¥é—¨"><a href="#æ·±åº¦å­¦ä¹ åœ¨æ—¶é—´åºåˆ—é¢„æµ‹ä¸­çš„å¿«é€Ÿå…¥é—¨" class="headerlink" title="æ·±åº¦å­¦ä¹ åœ¨æ—¶é—´åºåˆ—é¢„æµ‹ä¸­çš„å¿«é€Ÿå…¥é—¨"></a>æ·±åº¦å­¦ä¹ åœ¨æ—¶é—´åºåˆ—é¢„æµ‹ä¸­çš„å¿«é€Ÿå…¥é—¨</h3><p>æ—¶é—´åºåˆ—é¢„æµ‹æ˜¯æŒ‡åˆ©ç”¨å†å²æ•°æ®æ¥é¢„æµ‹æœªæ¥çš„è¶‹åŠ¿ï¼Œåœ¨é‡‘èã€å¤©æ°”é¢„æŠ¥ã€åº“å­˜ç®¡ç†ç­‰é¢†åŸŸåº”ç”¨å¹¿æ³›ã€‚æ·±åº¦å­¦ä¹ å› å…¶å¼ºå¤§çš„ç‰¹å¾æå–èƒ½åŠ›ï¼Œåœ¨å¤æ‚çš„æ—¶é—´åºåˆ—æ•°æ®ä¸Šè¡¨ç°ä¼˜å¼‚ã€‚ä»¥ä¸‹æ˜¯å¿«é€Ÿå…¥é—¨æ‰€éœ€çš„å…³é”®çŸ¥è¯†ï¼š</p><hr><h3 id="1-å…³é”®æ¨¡å‹"><a href="#1-å…³é”®æ¨¡å‹" class="headerlink" title="1. å…³é”®æ¨¡å‹"></a>1. å…³é”®æ¨¡å‹</h3><ul><li><strong>RNNï¼ˆå¾ªç¯ç¥ç»ç½‘ç»œï¼‰</strong>ï¼šé€‚ç”¨äºçŸ­æœŸä¾èµ–çš„åºåˆ—ï¼Œä½†é•¿åºåˆ—ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li><li><strong>LSTMï¼ˆé•¿çŸ­æ—¶è®°å¿†ç½‘ç»œï¼‰</strong>ï¼šé€šè¿‡é—¨æ§æœºåˆ¶è§£å†³RNNçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œé€‚ç”¨äºé•¿æœŸä¾èµ–çš„åºåˆ—ã€‚</li><li><strong>GRUï¼ˆé—¨æ§å¾ªç¯å•å…ƒï¼‰</strong>ï¼šä¸LSTMç±»ä¼¼ï¼Œä½†ç»“æ„æ›´ç®€å•ï¼Œè®¡ç®—æ•ˆç‡æ›´é«˜ã€‚</li><li><strong>TCNï¼ˆæ—¶é—´å·ç§¯ç½‘ç»œï¼‰</strong>ï¼šç”¨ä¸€ç»´å·ç§¯æ›¿ä»£å¾ªç¯ç»“æ„ï¼Œæ”¯æŒé•¿åºåˆ—å»ºæ¨¡ï¼Œè®­ç»ƒæ›´å¿«ã€‚</li><li><strong>Transformerï¼ˆå¦‚Time Series Transformerï¼‰</strong>ï¼šåŸºäºè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå¯ä»¥æ•æ‰é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œé€‚ç”¨äºå¤æ‚çš„æ—¶é—´åºåˆ—ã€‚</li><li><strong>DeepAR</strong>ï¼šäºšé©¬é€Šæå‡ºçš„ä¸€ç§åŸºäºRNNçš„æ¦‚ç‡æ—¶é—´åºåˆ—é¢„æµ‹æ–¹æ³•ï¼Œé€‚ç”¨äºå¤šä¸ªç›¸å…³åºåˆ—çš„é¢„æµ‹ã€‚</li></ul><hr><h3 id="2-æ•°æ®å¤„ç†"><a href="#2-æ•°æ®å¤„ç†" class="headerlink" title="2. æ•°æ®å¤„ç†"></a>2. æ•°æ®å¤„ç†</h3><ul><li><strong>æ—¶é—´çª—æ»‘åŠ¨ï¼ˆSliding Windowï¼‰</strong>ï¼šå°†æ—¶é—´åºåˆ—è½¬æ¢æˆç›‘ç£å­¦ä¹ æ ¼å¼ï¼Œå³<code>(å†å²æ•°æ® -&gt; æœªæ¥æ•°æ®) </code>å¯¹ã€‚</li><li><strong>å½’ä¸€åŒ–ï¼ˆNormalizationï¼‰</strong>ï¼šä½¿ç”¨ <code>Min-Max Scaling</code> æˆ– <code>Z-score Standardization</code> å½’ä¸€åŒ–æ•°æ®ï¼Œä»¥æé«˜è®­ç»ƒç¨³å®šæ€§ã€‚</li><li><strong>æ—¶é—´ç‰¹å¾å·¥ç¨‹</strong>ï¼šæå–æ—¶é—´æˆ³çš„ç‰¹å¾ï¼Œå¦‚<strong>å°æ—¶ã€æ˜ŸæœŸã€æœˆä»½ã€èŠ‚å‡æ—¥ç­‰</strong>ï¼Œå¸®åŠ©æ¨¡å‹å­¦ä¹ å‘¨æœŸæ€§è§„å¾‹ã€‚</li><li><strong>å¹³ç¨³æ€§å¤„ç†</strong>ï¼šä½¿ç”¨<strong>å·®åˆ†ï¼ˆDifferencingï¼‰</strong>ã€**ç§»åŠ¨å¹³å‡ï¼ˆMoving Averageï¼‰**ç­‰æ–¹æ³•å‡å°‘è¶‹åŠ¿æ€§å½±å“ã€‚</li></ul><hr><h3 id="3-è®­ç»ƒæ—¶å¸¸ç”¨çš„è¯„ä»·æŒ‡æ ‡"><a href="#3-è®­ç»ƒæ—¶å¸¸ç”¨çš„è¯„ä»·æŒ‡æ ‡" class="headerlink" title="3. è®­ç»ƒæ—¶å¸¸ç”¨çš„è¯„ä»·æŒ‡æ ‡"></a>3. è®­ç»ƒæ—¶å¸¸ç”¨çš„è¯„ä»·æŒ‡æ ‡</h3><ol><li><p><strong>å‡æ–¹è¯¯å·®ï¼ˆMSE, Mean Squared Errorï¼‰</strong>ï¼š</p><p>MSE&#x3D;1nâˆ‘(ytrueâˆ’ypred)2MSE &#x3D; \frac{1}{n} \sum (y_{\text{true}} - y_{\text{pred}})^2</p><ul><li>æƒ©ç½šè¾ƒå¤§çš„é¢„æµ‹è¯¯å·®ï¼Œå¯¹æç«¯å€¼è¾ƒæ•æ„Ÿã€‚</li></ul></li><li><p><strong>å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSE, Root Mean Squared Errorï¼‰</strong>ï¼š</p><p>RMSE&#x3D;MSERMSE &#x3D; \sqrt{MSE}</p><ul><li>ä¸MSEç±»ä¼¼ï¼Œä½†å…·æœ‰ä¸æ•°æ®å•ä½ç›¸åŒçš„é‡çº²ï¼Œæ›´æ˜“è§£é‡Šã€‚</li></ul></li><li><p><strong>å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAE, Mean Absolute Errorï¼‰</strong>ï¼š</p><p>MAE&#x3D;1nâˆ‘âˆ£ytrueâˆ’ypredâˆ£MAE &#x3D; \frac{1}{n} \sum |y_{\text{true}} - y_{\text{pred}}|</p><ul><li>å¯¹ç¦»ç¾¤å€¼ä¸æ•æ„Ÿï¼Œä½†å¯èƒ½ä½ä¼°å¤§è¯¯å·®çš„å½±å“ã€‚</li></ul></li><li><p><strong>å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPE, Mean Absolute Percentage Errorï¼‰</strong>ï¼š</p><p>MAPE&#x3D;100%nâˆ‘âˆ£ytrueâˆ’ypredytrueâˆ£MAPE &#x3D; \frac{100%}{n} \sum \left| \frac{y_{\text{true}} - y_{\text{pred}}}{y_{\text{true}}} \right|</p><ul><li>é€‚ç”¨äºç›¸å¯¹è¯¯å·®è¡¡é‡ï¼Œæ•°å€¼è¶Šå°è¡¨ç¤ºé¢„æµ‹è¶Šç²¾å‡†ã€‚</li></ul></li><li><p><strong>RÂ²ï¼ˆå†³å®šç³»æ•°ï¼‰</strong>ï¼š</p><p>R2&#x3D;1âˆ’âˆ‘(ytrueâˆ’ypred)2âˆ‘(ytrueâˆ’yË‰)2R^2 &#x3D; 1 - \frac{\sum (y_{\text{true}} - y_{\text{pred}})^2}{\sum (y_{\text{true}} - \bar{y})^2}</p><ul><li>åæ˜ æ¨¡å‹å¯¹æ•°æ®çš„è§£é‡Šèƒ½åŠ›ï¼ŒèŒƒå›´åœ¨ <code>[0,1]</code>ï¼Œè¶Šæ¥è¿‘ <code>1</code> è¯´æ˜æ¨¡å‹æ‹Ÿåˆæ•ˆæœè¶Šå¥½ã€‚</li></ul></li><li><p><strong>SMAPEï¼ˆå¯¹ç§°å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼‰</strong>ï¼š</p><p>SMAPE&#x3D;100%nâˆ‘âˆ£ytrueâˆ’ypredâˆ£(âˆ£ytrueâˆ£+âˆ£ypredâˆ£)&#x2F;2SMAPE &#x3D; \frac{100%}{n} \sum \frac{|y_{\text{true}} - y_{\text{pred}}|}{(|y_{\text{true}}| + |y_{\text{pred}}|)&#x2F;2}</p><ul><li>è§£å†³MAPEåœ¨ <code>y_true â‰ˆ 0</code> æ—¶çš„å¼‚å¸¸é—®é¢˜ã€‚</li></ul></li></ol><hr><h3 id="4-å¿«é€Ÿè®­ç»ƒæ—¶é—´åºåˆ—æ¨¡å‹çš„æ¨èæµç¨‹"><a href="#4-å¿«é€Ÿè®­ç»ƒæ—¶é—´åºåˆ—æ¨¡å‹çš„æ¨èæµç¨‹" class="headerlink" title="4. å¿«é€Ÿè®­ç»ƒæ—¶é—´åºåˆ—æ¨¡å‹çš„æ¨èæµç¨‹"></a>4. å¿«é€Ÿè®­ç»ƒæ—¶é—´åºåˆ—æ¨¡å‹çš„æ¨èæµç¨‹</h3><ol><li>æ•°æ®é¢„å¤„ç†ï¼š<ul><li>å½’ä¸€åŒ–ã€å¹³ç¨³åŒ–ã€æ»‘åŠ¨çª—å£åˆ‡å‰²ã€‚</li></ul></li><li>é€‰æ‹©æ¨¡å‹æ¶æ„ï¼š<ul><li>çŸ­æœŸä¾èµ–é€‰ç”¨<strong>LSTM&#x2F;GRU</strong>ï¼Œé•¿åºåˆ—é€‰ç”¨<strong>Transformer&#x2F;TCN</strong>ã€‚</li></ul></li><li>è®­ç»ƒæ¨¡å‹ï¼š<ul><li>é€‰æ‹©åˆé€‚çš„<strong>æŸå¤±å‡½æ•°</strong>ï¼ˆå¦‚ <code>MSE</code>ï¼‰å¹¶è¿›è¡Œæ¢¯åº¦ä¸‹é™ä¼˜åŒ–ã€‚</li></ul></li><li>è¯„ä¼°æ¨¡å‹ï¼š<ul><li>ä½¿ç”¨ <code>MSE</code>ã€<code>RMSE</code>ã€<code>RÂ²</code> ç­‰æŒ‡æ ‡è¿›è¡Œæ¨¡å‹è¯„ä¼°ã€‚</li></ul></li><li>è¶…å‚æ•°è°ƒä¼˜ï¼š<ul><li>é€šè¿‡<strong>å­¦ä¹ ç‡è°ƒæ•´ã€çª—å£å¤§å°é€‰æ‹©ã€éšè—å±‚ç¥ç»å…ƒæ•°é‡ä¼˜åŒ–</strong>ç­‰æé«˜æ•ˆæœã€‚</li></ul></li><li>å®é™…éƒ¨ç½²ï¼š<ul><li>ç»“åˆ <code>PyTorch</code> æˆ– <code>TensorFlow</code> è¿›è¡Œæ¨ç†ï¼Œå¹¶æŒç»­ä¼˜åŒ–ã€‚</li></ul></li></ol><hr><h3 id="5-ä»£ç ç¤ºä¾‹ï¼ˆLSTM-é¢„æµ‹æ—¶é—´åºåˆ—ï¼‰"><a href="#5-ä»£ç ç¤ºä¾‹ï¼ˆLSTM-é¢„æµ‹æ—¶é—´åºåˆ—ï¼‰" class="headerlink" title="5. ä»£ç ç¤ºä¾‹ï¼ˆLSTM é¢„æµ‹æ—¶é—´åºåˆ—ï¼‰"></a>5. ä»£ç ç¤ºä¾‹ï¼ˆLSTM é¢„æµ‹æ—¶é—´åºåˆ—ï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæ¨¡æ‹Ÿæ—¶é—´åºåˆ—æ•°æ®</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_dataset</span>(<span class="params">data, time_step=<span class="number">10</span></span>):</span><br><span class="line">    X, Y = [], []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data) - time_step):</span><br><span class="line">        X.append(data[i:i + time_step])</span><br><span class="line">        Y.append(data[i + time_step])</span><br><span class="line">    <span class="keyword">return</span> np.array(X), np.array(Y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»º LSTM æ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LSTMModel</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_size, hidden_size, num_layers</span>):</span><br><span class="line">        <span class="built_in">super</span>(LSTMModel, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.lstm = nn.LSTM(input_size, hidden_size, num_layers, batch_first=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc = nn.Linear(hidden_size, <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        out, _ = <span class="variable language_">self</span>.lstm(x)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.fc(out[:, -<span class="number">1</span>, :])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹è®­ç»ƒæµç¨‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train_model</span>(<span class="params">model, X_train, Y_train, epochs=<span class="number">50</span>, lr=<span class="number">0.001</span></span>):</span><br><span class="line">    criterion = nn.MSELoss()</span><br><span class="line">    optimizer = torch.optim.Adam(model.parameters(), lr=lr)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        outputs = model(torch.FloatTensor(X_train))</span><br><span class="line">        loss = criterion(outputs, torch.FloatTensor(Y_train))</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> epoch % <span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Epoch [<span class="subst">&#123;epoch&#125;</span>/<span class="subst">&#123;epochs&#125;</span>], Loss: <span class="subst">&#123;loss.item():<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹æ•°æ®</span></span><br><span class="line">data = np.sin(np.linspace(<span class="number">0</span>, <span class="number">100</span>, <span class="number">500</span>))  <span class="comment"># ç”Ÿæˆæ­£å¼¦æ³¢æ•°æ®</span></span><br><span class="line">X, Y = create_dataset(data)</span><br><span class="line">X = np.expand_dims(X, axis=-<span class="number">1</span>)  <span class="comment"># LSTM éœ€è¦è¾“å…¥ (batch, time_step, feature)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">model = LSTMModel(input_size=<span class="number">1</span>, hidden_size=<span class="number">64</span>, num_layers=<span class="number">2</span>)</span><br><span class="line">train_model(model, X, Y)</span><br></pre></td></tr></table></figure><hr><h3 id="6-ç»“è®º"><a href="#6-ç»“è®º" class="headerlink" title="6. ç»“è®º"></a>6. ç»“è®º</h3><p>æ—¶é—´åºåˆ—é¢„æµ‹æ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”å®ç”¨çš„ä»»åŠ¡ï¼Œæ·±åº¦å­¦ä¹ æ–¹æ³•ï¼ˆLSTMã€GRUã€Transformerç­‰ï¼‰æä¾›äº†æ›´å¥½çš„å»ºæ¨¡èƒ½åŠ›ã€‚å¸¸ç”¨çš„è¯„ä¼°æŒ‡æ ‡åŒ…æ‹¬ <strong>MSEã€RMSEã€MAEã€MAPEã€RÂ²</strong> ç­‰ï¼Œä¸åŒåœºæ™¯ä¸‹é€‰æ‹©åˆé€‚çš„æŒ‡æ ‡æ‰èƒ½å¾—åˆ°å‡†ç¡®çš„è¯„ä¼°ã€‚é€šè¿‡æ•°æ®é¢„å¤„ç†ã€æ¨¡å‹ä¼˜åŒ–å’Œè¶…å‚æ•°è°ƒä¼˜ï¼Œå¯ä»¥ä¸æ–­æé«˜é¢„æµ‹ç²¾åº¦å¹¶åº”ç”¨åˆ°å®é™…ä¸šåŠ¡ä¸­ã€‚</p><hr><p>ä½ å¯ä»¥å…ˆå°è¯• LSTM è¿›è¡Œé¢„æµ‹ï¼Œå¦‚æœéœ€è¦æ›´é«˜çº§çš„ä¼˜åŒ–ï¼ˆå¦‚ Transformerï¼‰ï¼Œå¯ä»¥è¿›ä¸€æ­¥å­¦ä¹  <strong>è‡ªæ³¨æ„åŠ›æœºåˆ¶</strong> å’Œ <strong>å¤šå¤´æ³¨æ„åŠ›</strong> çš„å®ç°æ–¹å¼ã€‚æˆ‘å¯ä»¥å¸®åŠ©ä½ é€æ­¥æ·±å…¥ï¼ ğŸ˜Š</p><h2 id="å¸¸ç”¨æ•°æ®é›†"><a href="#å¸¸ç”¨æ•°æ®é›†" class="headerlink" title="å¸¸ç”¨æ•°æ®é›†"></a>å¸¸ç”¨æ•°æ®é›†</h2><p><a href="https://blog.csdn.net/qq_43747519/article/details/132246960?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522598e0ec76efe134cd66cd990279eec9b%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=598e0ec76efe134cd66cd990279eec9b&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-132246960-null-null.142%5Ev101%5Epc_search_result_base6&utm_term=%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%95%B0%E6%8D%AE%E9%9B%86&spm=1018.2226.3001.4187">æ—¶é—´åºåˆ—å¸¸ç”¨æ•°æ®é›†ï¼ˆelectrityï¼ŒETTï¼Œexchangeï¼ŒILLï¼Œtrafficï¼Œweatherï¼‰</a></p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶åº </tag>
            
            <tag> è®ºæ–‡é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-23 MySQLç´¢å¼•</title>
      <link href="/2025/03/03/75-23%20MySQL%E7%B4%A2%E5%BC%95/"/>
      <url>/2025/03/03/75-23%20MySQL%E7%B4%A2%E5%BC%95/</url>
      
        <content type="html"><![CDATA[<h1 id="75-23-MySQLç´¢å¼•"><a href="#75-23-MySQLç´¢å¼•" class="headerlink" title="75-23 MySQLç´¢å¼•"></a>75-23 MySQLç´¢å¼•</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>ç´¢å¼•æ˜¯ä¸€ç§ç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œæ£€ç´¢æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œå…¶æœ¬è´¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§æ’åºå¥½çš„æ•°æ®ç»“æ„ã€‚</strong></p><p>å…¶æœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯æä¾›äº†ä¸€ä¸ªæ•°æ®ç»“æ„è®©æ•°æ®åº“å¯ä»¥å¿«é€Ÿçš„æŸ¥è¯¢åˆ°ç›®æ ‡æ•°æ®ã€‚</p><p>MySQL8ä¹‹åé»˜è®¤çš„å­˜å‚¨å¼•æ“ä¸ºInnoDBï¼Œä½†æ˜¯æ— è®ºæ˜¯InnoDBè¿˜æ˜¯MyISAMï¼Œå…¶ç´¢å¼•æ‰€é€‰æ‹©çš„æ•°æ®ç»“æ„éƒ½æ˜¯B+æ ‘ã€‚æœ‰ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©B+æ ‘ä½œä¸ºå…¶å­˜å‚¨å¼•æ“çš„ç´¢å¼•ç»“æ„å‘¢ï¼Ÿ</p><h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><p>è®¤è¯†ä¸€ä¸ªæ–°çš„äº‹ç‰©ï¼Œå…ˆæ¥çœ‹çœ‹è¯¥äº‹ç‰©æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</p><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li>ç¬¬ä¸€ç‚¹ï¼Œä¸å¿…å¤šè¨€ï¼Œå¼•å…¥äº†ç´¢å¼•ä¹‹åï¼Œæ•°æ®åº“åœ¨æŸäº›æŸ¥è¯¢æ–¹é¢çš„æ•ˆç‡å¤§å¹…åº¦æå‡ï¼Œè¾ƒå°‘äº†IOæ¬¡æ•°ï¼ˆä¸ºä»€ä¹ˆï¼‰ï¼›</li><li>é€šè¿‡åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ã€‚</li></ol><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol><li>å¦‚æœæˆ‘ä»¬å°†æŸäº›å­—æ®µåŠ å…¥äº†ç´¢å¼•ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘å¯¹è¿™ä¸ªç´¢å¼•å­—æ®µè¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå­˜å‚¨å¼•æ“ä¹Ÿä¼šåŒæ­¥çš„å¯¹ç´¢å¼•è¿›è¡Œæ›´æ–°ï¼Œé‚£ä¹ˆå¿…ç„¶å°±ä¼šé€ æˆSQLæ‰§è¡Œæ•ˆç‡é™ä½ï¼›</li><li>MySQLåŒæ—¶éœ€è¦ä¿å­˜ç´¢å¼•æ’åºåçš„ç‰©ç†æ–‡ä»¶ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¼šè€—è´¹ä¸€äº›ç©ºé—´ï¼ˆé—®é¢˜ä¸å¤§ï¼‰ï¼›</li></ol><p><strong>ä½†æ˜¯æ€»ä½“æ¥è¯´ï¼Œå¦‚æœæ•°æ®åº“çš„æ•°æ®é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå¼•å…¥ç´¢å¼•å¥½å¤„æ˜¯ä¼˜äºåå¤„çš„ï¼Œç´¢å¼•æŸ¥è¯¢ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯æ¯”å…¨è¡¨æŸ¥è¯¢è¦å¿«çš„ã€‚</strong></p><h2 id="B-æ ‘-B-æ ‘"><a href="#B-æ ‘-B-æ ‘" class="headerlink" title="B æ ‘&amp; B+æ ‘"></a>B æ ‘&amp; B+æ ‘</h2><p>B æ ‘ä¹Ÿç§° B-æ ‘,å…¨ç§°ä¸º <strong>å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘</strong> ï¼ŒB+ æ ‘æ˜¯ B æ ‘çš„ä¸€ç§å˜ä½“ã€‚B æ ‘å’Œ B+æ ‘ä¸­çš„ B æ˜¯ <code>Balanced</code> ï¼ˆå¹³è¡¡ï¼‰çš„æ„æ€ã€‚</p><p>ç›®å‰å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»ŸåŠæ–‡ä»¶ç³»ç»Ÿéƒ½é‡‡ç”¨ B-Tree æˆ–å…¶å˜ç§ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ã€‚</p><p><strong>B æ ‘&amp; B+æ ‘ä¸¤è€…æœ‰ä½•å¼‚åŒå‘¢ï¼Ÿ</strong></p><ul><li>B æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ—¢å­˜æ”¾é”®(key) ä¹Ÿå­˜æ”¾æ•°æ®(data)ï¼Œè€Œ B+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹å­˜æ”¾ key å’Œ dataï¼Œå…¶ä»–å†…èŠ‚ç‚¹åªå­˜æ”¾ keyã€‚</li><li>B æ ‘çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„;B+æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰ä¸€æ¡å¼•ç”¨é“¾æŒ‡å‘ä¸å®ƒç›¸é‚»çš„å¶å­èŠ‚ç‚¹ã€‚</li><li>B æ ‘çš„æ£€ç´¢çš„è¿‡ç¨‹ç›¸å½“äºå¯¹èŒƒå›´å†…çš„æ¯ä¸ªèŠ‚ç‚¹çš„å…³é”®å­—åšäºŒåˆ†æŸ¥æ‰¾ï¼Œå¯èƒ½è¿˜æ²¡æœ‰åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œæ£€ç´¢å°±ç»“æŸäº†ã€‚è€Œ B+æ ‘çš„æ£€ç´¢æ•ˆç‡å°±å¾ˆç¨³å®šäº†ï¼Œä»»ä½•æŸ¥æ‰¾éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå¶å­èŠ‚ç‚¹çš„é¡ºåºæ£€ç´¢å¾ˆæ˜æ˜¾ã€‚</li><li>åœ¨ B æ ‘ä¸­è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œé¦–å…ˆæ‰¾åˆ°è¦æŸ¥æ‰¾çš„ä¸‹é™ï¼Œç„¶åå¯¹ B æ ‘è¿›è¡Œä¸­åºéå†ï¼Œç›´åˆ°æ‰¾åˆ°æŸ¥æ‰¾çš„ä¸Šé™ï¼›è€Œ B+æ ‘çš„èŒƒå›´æŸ¥è¯¢ï¼Œåªéœ€è¦å¯¹é“¾è¡¨è¿›è¡Œéå†å³å¯ã€‚</li></ul><p>ç»¼ä¸Šï¼ŒB+æ ‘ä¸ B æ ‘ç›¸æ¯”ï¼Œå…·å¤‡æ›´å°‘çš„ IO æ¬¡æ•°ã€æ›´ç¨³å®šçš„æŸ¥è¯¢æ•ˆç‡å’Œæ›´é€‚äºèŒƒå›´æŸ¥è¯¢è¿™äº›ä¼˜åŠ¿ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262024757.png" alt="image-20241014161223591"></p><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿè¿™éƒ½æ˜¯æœ‰åŸå› çš„ï¼ŒMySQLä½œä¸ºç¡¬ç›˜å­˜å‚¨æ•°æ®åº“ï¼Œé€‰ç”¨B+Treeä½œä¸ºå…¶æ•°æ®ç»“æ„éå¸¸é€‚åˆã€‚</p><p>ç³»ç»Ÿä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜æ—¶æ˜¯ä»¥**ç£ç›˜å—ï¼ˆblockï¼‰**ä¸ºåŸºæœ¬å•ä½çš„ï¼Œä½äºåŒä¸€ä¸ªç£ç›˜å—ä¸­çš„æ•°æ®ä¼šè¢«ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼Œè€Œä¸æ˜¯éœ€è¦ä»€ä¹ˆå–ä»€ä¹ˆã€‚</p><p>åœ¨ MySQL ä¸­ï¼ŒMyISAM å¼•æ“å’Œ InnoDB å¼•æ“éƒ½æ˜¯ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†æ˜¯ï¼Œä¸¤è€…çš„å®ç°æ–¹å¼ä¸å¤ªä¸€æ ·ã€‚</p><h2 id="MyISAM-å¼•æ“å’Œ-InnoDB-å¼•æ“B-Treeå®ç°"><a href="#MyISAM-å¼•æ“å’Œ-InnoDB-å¼•æ“B-Treeå®ç°" class="headerlink" title="MyISAM å¼•æ“å’Œ InnoDB å¼•æ“B+Treeå®ç°"></a>MyISAM å¼•æ“å’Œ InnoDB å¼•æ“B+Treeå®ç°</h2><h3 id="MyISAM-çš„ç´¢å¼•å­˜å‚¨æ–¹å¼ï¼ˆéèšç°‡ç´¢å¼•ï¼‰"><a href="#MyISAM-çš„ç´¢å¼•å­˜å‚¨æ–¹å¼ï¼ˆéèšç°‡ç´¢å¼•ï¼‰" class="headerlink" title="MyISAM çš„ç´¢å¼•å­˜å‚¨æ–¹å¼ï¼ˆéèšç°‡ç´¢å¼•ï¼‰"></a><strong>MyISAM çš„ç´¢å¼•å­˜å‚¨æ–¹å¼ï¼ˆéèšç°‡ç´¢å¼•ï¼‰</strong></h3><p>åœ¨ <strong>MyISAM</strong> é‡Œï¼Œæ•°æ®å’Œç´¢å¼•æ˜¯ <strong>åˆ†å¼€çš„</strong>ï¼Œç´¢å¼•å­˜çš„æ˜¯æ•°æ®æ‰€åœ¨çš„ä½ç½®ã€‚</p><ul><li><strong>ç´¢å¼•æ–‡ä»¶ï¼ˆB+Tree ç»“æ„ï¼‰</strong> å­˜çš„æ˜¯ä¸»é”® <code>id</code>ï¼Œå¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•°æ®çš„ç‰©ç†åœ°å€ï¼ˆç±»ä¼¼äºâ€œç›®å½•â€æŒ‡å‘â€œæ–‡ä»¶â€ï¼‰ã€‚</li><li><strong>æ•°æ®æ–‡ä»¶</strong> å­˜çš„æ˜¯å…·ä½“çš„è¡¨æ•°æ®ã€‚</li></ul><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ç”±äºç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•°æ®çš„<strong>åœ°å€</strong>ï¼Œæ‰€ä»¥éœ€è¦<strong>å¤šä¸€æ­¥</strong>å»ç£ç›˜å–æ•°æ®ã€‚</li><li><strong>ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„</strong>ã€‚</li></ul><h3 id="InnoDB-çš„ç´¢å¼•å­˜å‚¨æ–¹å¼ï¼ˆèšç°‡ç´¢å¼•ï¼‰"><a href="#InnoDB-çš„ç´¢å¼•å­˜å‚¨æ–¹å¼ï¼ˆèšç°‡ç´¢å¼•ï¼‰" class="headerlink" title="InnoDB çš„ç´¢å¼•å­˜å‚¨æ–¹å¼ï¼ˆèšç°‡ç´¢å¼•ï¼‰"></a>InnoDB çš„ç´¢å¼•å­˜å‚¨æ–¹å¼ï¼ˆèšç°‡ç´¢å¼•ï¼‰</h3><p>åœ¨ <strong>InnoDB</strong> é‡Œï¼Œ<strong>è¡¨çš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ B+Tree ç´¢å¼•</strong>ï¼Œæ•°æ®ç›´æ¥å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ°å€ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li><strong>ä¸»é”®ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ï¼‰å’Œæ•°æ®å­˜å‚¨åœ¨ä¸€èµ·</strong>ï¼ŒæŸ¥æ‰¾é€Ÿåº¦æ›´å¿«ã€‚</li><li><strong>è¡¨æ•°æ®æ˜¯æŒ‰ç…§ä¸»é”®é¡ºåºå­˜å‚¨çš„</strong>ï¼Œæ‰€ä»¥å¦‚æœä¸»é”®æ˜¯<strong>æ— åºçš„æˆ–è¿‡é•¿</strong>ï¼Œä¼šå¯¼è‡´é¢‘ç¹çš„ç´¢å¼•åˆ†è£‚ï¼Œå½±å“æ€§èƒ½ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031600764.png" alt="image-20250303160023720"></p><h3 id="ä¸ºä»€ä¹ˆ-InnoDB-ä¸å»ºè®®ä½¿ç”¨é•¿ä¸»é”®ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-InnoDB-ä¸å»ºè®®ä½¿ç”¨é•¿ä¸»é”®ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ InnoDB ä¸å»ºè®®ä½¿ç”¨é•¿ä¸»é”®ï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆ InnoDB ä¸å»ºè®®ä½¿ç”¨é•¿ä¸»é”®ï¼Ÿ</strong></h3><p>ç”±äº InnoDB <strong>æ‰€æœ‰çš„è¾…åŠ©ç´¢å¼•éƒ½å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼</strong>ï¼ˆè€Œä¸æ˜¯ç‰©ç†åœ°å€ï¼‰ï¼Œæ‰€ä»¥ï¼š</p><ul><li><strong>å¦‚æœä¸»é”®å­—æ®µå¾ˆé•¿ï¼ˆæ¯”å¦‚ <code>UUID</code>ï¼‰ï¼Œæ‰€æœ‰è¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹éƒ½ä¼šå˜å¤§ï¼Œå ç”¨æ›´å¤šçš„ç£ç›˜å’Œå†…å­˜ã€‚</strong></li><li><strong>å¦‚æœä¸»é”®æ˜¯æ— åºçš„ï¼ˆå¦‚ <code>UUID</code>ï¼‰ï¼Œæ’å…¥æ•°æ®æ—¶å¯èƒ½ä¼šå¯¼è‡´ B+Tree é¢‘ç¹åˆ†è£‚ï¼Œå½±å“æ’å…¥æ€§èƒ½ã€‚</strong></li><li><strong>å»ºè®®ä½¿ç”¨è‡ªå¢ <code>ID</code> ä½œä¸ºä¸»é”®ï¼Œä¿è¯ä¸»é”®æœ‰åºï¼Œæå‡ç´¢å¼•æ•ˆç‡ã€‚</strong></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><ol><li><strong>MyISAMï¼ˆéèšç°‡ç´¢å¼•ï¼‰</strong>ï¼šç´¢å¼•å­˜å‚¨çš„æ˜¯<strong>æ•°æ®åœ°å€</strong>ï¼Œéœ€è¦å¤šä¸€æ­¥ç£ç›˜è¯»å–ã€‚</li><li><strong>InnoDBï¼ˆèšç°‡ç´¢å¼•ï¼‰</strong>ï¼šç´¢å¼•å­˜å‚¨çš„æ˜¯<strong>å®Œæ•´æ•°æ®</strong>ï¼ŒæŸ¥è¯¢ä¸»é”®æ—¶æ›´å¿«ã€‚</li><li><strong>InnoDB çš„è¾…åŠ©ç´¢å¼•å­˜çš„æ˜¯ä¸»é”®å€¼</strong>ï¼Œå› æ­¤ä¸»é”®è®¾è®¡è¦å°½é‡ç®€çŸ­ä¸”é€’å¢ï¼Œä»¥å‡å°‘ç´¢å¼•å ç”¨ç©ºé—´ï¼Œæé«˜æ’å…¥æ€§èƒ½ã€‚</li></ol><h2 id="ç´¢å¼•ç±»å‹åˆ†ç±»"><a href="#ç´¢å¼•ç±»å‹åˆ†ç±»" class="headerlink" title="ç´¢å¼•ç±»å‹åˆ†ç±»"></a>ç´¢å¼•ç±»å‹åˆ†ç±»</h2><p>æŒ‰ç…§æ•°æ®ç»“æ„ç»´åº¦åˆ’åˆ†ï¼š</p><ul><li>BTree ç´¢å¼•ï¼šMySQL é‡Œé»˜è®¤å’Œæœ€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ã€‚åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨ valueï¼Œéå¶å­èŠ‚ç‚¹åªæœ‰æŒ‡é’ˆå’Œ keyã€‚å­˜å‚¨å¼•æ“ MyISAM å’Œ InnoDB å®ç° BTree ç´¢å¼•éƒ½æ˜¯ä½¿ç”¨ B+Treeï¼Œä½†äºŒè€…å®ç°æ–¹å¼ä¸ä¸€æ ·ï¼ˆå‰é¢å·²ç»ä»‹ç»äº†ï¼‰ã€‚</li><li>å“ˆå¸Œç´¢å¼•ï¼šç±»ä¼¼é”®å€¼å¯¹çš„å½¢å¼ï¼Œä¸€æ¬¡å³å¯å®šä½ã€‚</li><li>RTree ç´¢å¼•ï¼šä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œä»…æ”¯æŒ geometry æ•°æ®ç±»å‹ï¼Œä¼˜åŠ¿åœ¨äºèŒƒå›´æŸ¥æ‰¾ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ ElasticSearch ä»£æ›¿ã€‚</li><li>å…¨æ–‡ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè¿›è¡Œæœç´¢ã€‚ç›®å‰åªæœ‰ <code>CHAR</code>ã€<code>VARCHAR</code> ï¼Œ<code>TEXT</code> åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ ElasticSearch ä»£æ›¿ã€‚</li></ul><p>æŒ‰ç…§åº•å±‚å­˜å‚¨æ–¹å¼è§’åº¦åˆ’åˆ†ï¼š</p><ul><li><strong>èšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰</strong>ï¼šç´¢å¼•ç»“æ„å’Œæ•°æ®ä¸€èµ·å­˜æ”¾çš„ç´¢å¼•ï¼Œ<strong>InnoDB ä¸­çš„ä¸»é”®ç´¢å¼•å°±å±äºèšç°‡ç´¢å¼•</strong>ã€‚</li><li><strong>éèšç°‡ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰</strong>ï¼šç´¢å¼•ç»“æ„å’Œæ•°æ®åˆ†å¼€å­˜æ”¾çš„ç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•(è¾…åŠ©ç´¢å¼•)å°±å±äºéèšç°‡ç´¢å¼•ã€‚MySQL çš„ MyISAM å¼•æ“ï¼Œä¸ç®¡ä¸»é”®è¿˜æ˜¯éä¸»é”®ï¼Œä½¿ç”¨çš„éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚</li></ul><p>æŒ‰ç…§åº”ç”¨ç»´åº¦åˆ’åˆ†ï¼š</p><ul><li>ä¸»é”®ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆä¸å¯ä»¥æœ‰ NULLï¼‰+ è¡¨ä¸­åªæœ‰ä¸€ä¸ªã€‚</li><li>æ™®é€šç´¢å¼•ï¼šä»…åŠ é€ŸæŸ¥è¯¢ã€‚</li><li>å”¯ä¸€ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆå¯ä»¥æœ‰ NULLï¼‰ã€‚</li><li>è¦†ç›–ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ã€‚</li><li><strong>è”åˆç´¢å¼•</strong>ï¼šå¤šåˆ—å€¼ç»„æˆä¸€ä¸ªç´¢å¼•ï¼Œä¸“é—¨ç”¨äºç»„åˆæœç´¢ï¼Œå…¶æ•ˆç‡å¤§äºç´¢å¼•åˆå¹¶ã€‚</li><li>å…¨æ–‡ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè¿›è¡Œæœç´¢ã€‚ç›®å‰åªæœ‰ <code>CHAR</code>ã€<code>VARCHAR</code> ï¼Œ<code>TEXT</code> åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ ElasticSearch ä»£æ›¿ã€‚</li><li>å‰ç¼€ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å‰å‡ ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ï¼Œç›¸æ¯”æ™®é€šç´¢å¼•å»ºç«‹çš„æ•°æ®æ›´å°ï¼Œå› ä¸ºåªå–å‰å‡ ä¸ªå­—ç¬¦ã€‚</li></ul><h3 id="ä¸»é”®ç´¢å¼•"><a href="#ä¸»é”®ç´¢å¼•" class="headerlink" title="ä¸»é”®ç´¢å¼•"></a>ä¸»é”®ç´¢å¼•</h3><p>æ•°æ®è¡¨çš„ä¸»é”®åˆ—ä½¿ç”¨çš„å°±æ˜¯ä¸»é”®ç´¢å¼•ã€‚</p><p>ä¸€å¼ æ•°æ®è¡¨æœ‰åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œå¹¶ä¸”ä¸»é”®ä¸èƒ½ä¸º nullï¼Œä¸èƒ½é‡å¤ã€‚</p><p>åœ¨ MySQL çš„ InnoDB çš„è¡¨ä¸­ï¼Œå½“æ²¡æœ‰æ˜¾ç¤ºçš„æŒ‡å®šè¡¨çš„ä¸»é”®æ—¶ï¼Œ<strong>InnoDB ä¼šè‡ªåŠ¨å…ˆæ£€æŸ¥è¡¨ä¸­æ˜¯å¦æœ‰å”¯ä¸€ç´¢å¼•ä¸”ä¸å…è®¸å­˜åœ¨ null å€¼çš„å­—æ®µï¼Œå¦‚æœæœ‰ï¼Œåˆ™é€‰æ‹©è¯¥å­—æ®µä¸ºé»˜è®¤çš„ä¸»é”®ï¼Œå¦åˆ™ InnoDB å°†ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª 6Byte çš„è‡ªå¢ä¸»é”®</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031608072.png" alt="ä¸»é”®ç´¢å¼•"></p><h3 id="äºŒçº§ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•"></a>äºŒçº§ç´¢å¼•</h3><p>äºŒçº§ç´¢å¼•ï¼ˆSecondary Indexï¼‰çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æ˜¯<strong>ä¸»é”®çš„å€¼</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>é€šè¿‡äºŒçº§ç´¢å¼•å¯ä»¥å®šä½ä¸»é”®çš„ä½ç½®</strong>ï¼ŒäºŒçº§ç´¢å¼•åˆç§°ä¸º<strong>è¾…åŠ©ç´¢å¼•</strong>&#x2F;éä¸»é”®ç´¢å¼•ã€‚</p><p>å”¯ä¸€ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•ç­‰ç´¢å¼•éƒ½å±äºäºŒçº§ç´¢å¼•ã€‚</p><ol><li><strong>å”¯ä¸€ç´¢å¼•(Unique Key)</strong>:å”¯ä¸€ç´¢å¼•ä¹Ÿæ˜¯ä¸€ç§çº¦æŸã€‚å”¯ä¸€ç´¢å¼•çš„å±æ€§åˆ—ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ï¼Œä½†æ˜¯å…è®¸æ•°æ®ä¸º NULLï¼Œä¸€å¼ è¡¨å…è®¸åˆ›å»ºå¤šä¸ªå”¯ä¸€ç´¢å¼•ã€‚ å»ºç«‹å”¯ä¸€ç´¢å¼•çš„ç›®çš„å¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯ä¸ºäº†è¯¥å±æ€§åˆ—çš„æ•°æ®çš„å”¯ä¸€æ€§ï¼Œè€Œä¸æ˜¯ä¸ºäº†æŸ¥è¯¢æ•ˆç‡ã€‚</li><li><strong>æ™®é€šç´¢å¼•(Index)</strong>:æ™®é€šç´¢å¼•çš„å”¯ä¸€ä½œç”¨å°±æ˜¯ä¸ºäº†å¿«é€ŸæŸ¥è¯¢æ•°æ®ï¼Œä¸€å¼ è¡¨å…è®¸åˆ›å»ºå¤šä¸ªæ™®é€šç´¢å¼•ï¼Œå¹¶å…è®¸æ•°æ®é‡å¤å’Œ NULLã€‚</li><li><strong>å‰ç¼€ç´¢å¼•(Prefix)</strong>:å‰ç¼€ç´¢å¼•åªé€‚ç”¨äºå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ã€‚å‰ç¼€ç´¢å¼•æ˜¯å¯¹æ–‡æœ¬çš„å‰å‡ ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ï¼Œç›¸æ¯”æ™®é€šç´¢å¼•å»ºç«‹çš„æ•°æ®æ›´å°ï¼Œå› ä¸ºåªå–å‰å‡ ä¸ªå­—ç¬¦ã€‚</li><li><strong>å…¨æ–‡ç´¢å¼•(Full Text)</strong>:å…¨æ–‡ç´¢å¼•ä¸»è¦æ˜¯ä¸ºäº†æ£€ç´¢å¤§æ–‡æœ¬æ•°æ®ä¸­çš„å…³é”®å­—çš„ä¿¡æ¯ï¼Œæ˜¯ç›®å‰æœç´¢å¼•æ“æ•°æ®åº“ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ã€‚Mysql5.6 ä¹‹å‰åªæœ‰ MYISAM å¼•æ“æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œ5.6 ä¹‹å InnoDB ä¹Ÿæ”¯æŒäº†å…¨æ–‡ç´¢å¼•ã€‚</li></ol><h3 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h3><p>èšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰å³<strong>ç´¢å¼•ç»“æ„å’Œæ•°æ®ä¸€èµ·å­˜æ”¾çš„ç´¢å¼•</strong>ï¼Œå¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹ã€‚InnoDB ä¸­çš„ä¸»é”®ç´¢å¼•å°±å±äºèšç°‡ç´¢å¼•ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><strong>æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«</strong>ï¼šèšç°‡ç´¢å¼•çš„æŸ¥è¯¢é€Ÿåº¦éå¸¸çš„å¿«ï¼Œå› ä¸ºæ•´ä¸ª B+æ ‘æœ¬èº«å°±æ˜¯ä¸€é¢—å¤šå‰å¹³è¡¡æ ‘ï¼Œå¶å­èŠ‚ç‚¹ä¹Ÿéƒ½æ˜¯æœ‰åºçš„ï¼Œå®šä½åˆ°ç´¢å¼•çš„èŠ‚ç‚¹ï¼Œå°±ç›¸å½“äºå®šä½åˆ°äº†æ•°æ®ã€‚<strong>ç›¸æ¯”äºéèšç°‡ç´¢å¼•ï¼Œ èšç°‡ç´¢å¼•å°‘äº†ä¸€æ¬¡è¯»å–æ•°æ®çš„ IO æ“ä½œã€‚</strong></li><li><strong>å¯¹æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾ä¼˜åŒ–</strong>ï¼šèšç°‡ç´¢å¼•å¯¹äºä¸»é”®çš„æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li><strong>ä¾èµ–äºæœ‰åºçš„æ•°æ®</strong>ï¼šå› ä¸º B+æ ‘æ˜¯å¤šè·¯å¹³è¡¡æ ‘ï¼Œå¦‚æœç´¢å¼•çš„æ•°æ®ä¸æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨æ’å…¥æ—¶æ’åºï¼Œå¦‚æœæ•°æ®æ˜¯æ•´å‹è¿˜å¥½ï¼Œå¦åˆ™ç±»ä¼¼äºå­—ç¬¦ä¸²æˆ– UUID è¿™ç§åˆé•¿åˆéš¾æ¯”è¾ƒçš„æ•°æ®ï¼Œæ’å…¥æˆ–æŸ¥æ‰¾çš„é€Ÿåº¦è‚¯å®šæ¯”è¾ƒæ…¢ã€‚</li><li><strong>æ›´æ–°ä»£ä»·å¤§</strong>ï¼šå¦‚æœå¯¹ç´¢å¼•åˆ—çš„æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œé‚£ä¹ˆå¯¹åº”çš„ç´¢å¼•ä¹Ÿå°†ä¼šè¢«ä¿®æ”¹ï¼Œè€Œä¸”èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹è¿˜å­˜æ”¾ç€æ•°æ®ï¼Œä¿®æ”¹ä»£ä»·è‚¯å®šæ˜¯è¾ƒå¤§çš„ï¼Œ<strong>æ‰€ä»¥å¯¹äºä¸»é”®ç´¢å¼•æ¥è¯´ï¼Œä¸»é”®ä¸€èˆ¬éƒ½æ˜¯ä¸å¯è¢«ä¿®æ”¹çš„</strong>ã€‚</li></ul><h3 id="éèšç°‡ç´¢å¼•"><a href="#éèšç°‡ç´¢å¼•" class="headerlink" title="éèšç°‡ç´¢å¼•"></a>éèšç°‡ç´¢å¼•</h3><p>éèšç°‡ç´¢å¼•(Non-Clustered Index)å³ç´¢å¼•ç»“æ„å’Œæ•°æ®åˆ†å¼€å­˜æ”¾çš„ç´¢å¼•ï¼Œå¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹ã€‚äºŒçº§ç´¢å¼•(è¾…åŠ©ç´¢å¼•)å°±å±äºéèšç°‡ç´¢å¼•ã€‚MySQL çš„ MyISAM å¼•æ“ï¼Œä¸ç®¡ä¸»é”®è¿˜æ˜¯éä¸»é”®ï¼Œä½¿ç”¨çš„éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><p>æ›´æ–°ä»£ä»·æ¯”èšç°‡ç´¢å¼•è¦å° ã€‚éèšç°‡ç´¢å¼•çš„æ›´æ–°ä»£ä»·å°±æ²¡æœ‰èšç°‡ç´¢å¼•é‚£ä¹ˆå¤§äº†ï¼Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸å­˜æ”¾æ•°æ®çš„ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li><strong>ä¾èµ–äºæœ‰åºçš„æ•°æ®</strong>:è·Ÿèšç°‡ç´¢å¼•ä¸€æ ·ï¼Œéèšç°‡ç´¢å¼•ä¹Ÿä¾èµ–äºæœ‰åºçš„æ•°æ®</li><li><strong>å¯èƒ½ä¼šäºŒæ¬¡æŸ¥è¯¢(å›è¡¨)</strong>:è¿™åº”è¯¥æ˜¯éèšç°‡ç´¢å¼•æœ€å¤§çš„ç¼ºç‚¹äº†ã€‚ å½“æŸ¥åˆ°ç´¢å¼•å¯¹åº”çš„æŒ‡é’ˆæˆ–ä¸»é”®åï¼Œå¯èƒ½è¿˜éœ€è¦æ ¹æ®æŒ‡é’ˆæˆ–ä¸»é”®å†åˆ°æ•°æ®æ–‡ä»¶æˆ–è¡¨ä¸­æŸ¥è¯¢ã€‚</li></ul><h4 id="éèšç°‡ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—-è¦†ç›–ç´¢å¼•"><a href="#éèšç°‡ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—-è¦†ç›–ç´¢å¼•" class="headerlink" title="éèšç°‡ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—(è¦†ç›–ç´¢å¼•)?"></a>éèšç°‡ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—(è¦†ç›–ç´¢å¼•)?</h4><p><strong>éèšç°‡ç´¢å¼•ä¸ä¸€å®šå›è¡¨æŸ¥è¯¢ã€‚</strong></p><p>è¯•æƒ³ä¸€ç§æƒ…å†µï¼Œç”¨æˆ·å‡†å¤‡ä½¿ç”¨ SQL æŸ¥è¯¢ç”¨æˆ·åï¼Œè€Œç”¨æˆ·åå­—æ®µæ­£å¥½å»ºç«‹äº†ç´¢å¼•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT name FROM table WHERE name=&#x27;guang19&#x27;;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™ä¸ªç´¢å¼•çš„ key æœ¬èº«å°±æ˜¯ nameï¼ŒæŸ¥åˆ°å¯¹åº”çš„ name ç›´æ¥è¿”å›å°±è¡Œäº†ï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚</p><p>å³ä½¿æ˜¯ MYISAM ä¹Ÿæ˜¯è¿™æ ·ï¼Œè™½ç„¶ MYISAM çš„ä¸»é”®ç´¢å¼•ç¡®å®éœ€è¦å›è¡¨ï¼Œå› ä¸ºå®ƒçš„ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æŒ‡é’ˆã€‚ä½†æ˜¯ï¼<strong>å¦‚æœ SQL æŸ¥çš„å°±æ˜¯ä¸»é”®å‘¢?</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id FROM table WHERE id=1;</span><br></pre></td></tr></table></figure><p>ä¸»é”®ç´¢å¼•æœ¬èº«çš„ key å°±æ˜¯ä¸»é”®ï¼ŒæŸ¥åˆ°è¿”å›å°±è¡Œäº†ã€‚è¿™ç§æƒ…å†µå°±ç§°ä¹‹ä¸ºè¦†ç›–ç´¢å¼•äº†</p><h3 id="è¦†ç›–ç´¢å¼•-è”åˆç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•-è”åˆç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼• &amp; è”åˆç´¢å¼•"></a>è¦†ç›–ç´¢å¼• &amp; è”åˆç´¢å¼•</h3><h4 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h4><p>å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸º <strong>è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰</strong> ã€‚</p><blockquote><p>åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œéä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«çš„æ˜¯ä¸»é”®çš„å€¼ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä½¿ç”¨éä¸»é”®ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ•°æ®åº“ä¼šå…ˆæ‰¾åˆ°å¯¹åº”çš„ä¸»é”®å€¼ï¼Œç„¶åå†é€šè¿‡ä¸»é”®ç´¢å¼•æ¥å®šä½å’Œæ£€ç´¢å®Œæ•´çš„è¡Œæ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œå›è¡¨â€ã€‚</p></blockquote><p><strong>è¦†ç›–ç´¢å¼•å³éœ€è¦æŸ¥è¯¢çš„å­—æ®µæ­£å¥½æ˜¯ç´¢å¼•çš„å­—æ®µï¼Œé‚£ä¹ˆç›´æ¥æ ¹æ®è¯¥ç´¢å¼•ï¼Œå°±å¯ä»¥æŸ¥åˆ°æ•°æ®äº†ï¼Œè€Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚</strong></p><h5 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h5><p>æˆ‘ä»¬è¿™é‡Œç®€å•æ¼”ç¤ºä¸€ä¸‹è¦†ç›–ç´¢å¼•çš„æ•ˆæœã€‚</p><p>åˆ›å»ºä¸€ç™¾ä¸‡æ¡æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `cus_order` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) unsigned <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `score` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">100000</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031630200.png" alt="image-20250303163033081"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031632632.png" alt="image-20250303163241575"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031635832.png" alt="image-20250303163558775"></p><h4 id="è”åˆç´¢å¼•"><a href="#è”åˆç´¢å¼•" class="headerlink" title="è”åˆç´¢å¼•"></a>è”åˆç´¢å¼•</h4><p>ä½¿ç”¨è¡¨ä¸­çš„å¤šä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œå°±æ˜¯ <strong>è”åˆç´¢å¼•</strong>ï¼Œä¹Ÿå« <strong>ç»„åˆç´¢å¼•</strong> æˆ– <strong>å¤åˆç´¢å¼•</strong>ã€‚</p><p>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™æŒ‡çš„æ˜¯åœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼ŒMySQL ä¼šæ ¹æ®ç´¢å¼•ä¸­çš„å­—æ®µé¡ºåºï¼Œä»å·¦åˆ°å³ä¾æ¬¡åŒ¹é…æŸ¥è¯¢æ¡ä»¶ä¸­çš„å­—æ®µã€‚<strong>å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸ç´¢å¼•ä¸­çš„æœ€å·¦ä¾§å­—æ®µç›¸åŒ¹é…ï¼Œé‚£ä¹ˆ MySQL å°±ä¼šä½¿ç”¨ç´¢å¼•æ¥è¿‡æ»¤æ•°æ®ï¼Œè¿™æ ·å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</strong></p><p>æœ€å·¦åŒ¹é…åŸåˆ™ä¼šä¸€ç›´å‘å³åŒ¹é…ï¼Œç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ &gt;ã€&lt;ï¼‰ä¸ºæ­¢ã€‚å¯¹äº &gt;&#x3D;ã€&lt;&#x3D;ã€BETWEEN ä»¥åŠå‰ç¼€åŒ¹é… LIKE çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸ä¼šåœæ­¢åŒ¹é…ï¼ˆç›¸å…³é˜…è¯»ï¼š<a href="https://mp.weixin.qq.com/s/8qemhRg5MgXs1So5YCv0fQ">è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™å…¨ç½‘éƒ½åœ¨è¯´çš„ä¸€ä¸ªé”™è¯¯ç»“è®º</a>ï¼‰ã€‚</p><blockquote><p>ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå­˜åœ¨<strong>æœ€å·¦åŒ¹é…åŸåˆ™</strong>ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é…ã€‚</p><p>åœ¨ä½¿ç”¨è”åˆç´¢å¼•è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœä¸éµå¾ªã€Œæœ€å·¦åŒ¹é…åŸåˆ™ã€ï¼Œè”åˆç´¢å¼•ä¼šå¤±æ•ˆï¼Œè¿™æ ·å°±æ— æ³•åˆ©ç”¨åˆ°ç´¢å¼•å¿«é€ŸæŸ¥è¯¢çš„ç‰¹æ€§äº†ã€‚</p><p>æ¯”å¦‚ï¼Œå¦‚æœåˆ›å»ºäº†ä¸€ä¸ª (a, b, c) è”åˆç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ä»¥ä¸‹è¿™å‡ ç§ï¼Œå°±å¯ä»¥åˆ©ç”¨è”åˆç´¢å¼•ï¼š</p><ul><li>where a&#x3D;1ï¼›</li><li>where a&#x3D;1 and b&#x3D;2 and c&#x3D;3ï¼›</li><li>where a&#x3D;1 and b&#x3D;2ï¼›</li></ul><p>**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºæœ‰æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œæ‰€ä»¥ a å­—æ®µåœ¨ where å­å¥çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚**ä½†æ˜¯ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ä»¥ä¸‹è¿™å‡ ç§ï¼Œå› ä¸ºä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œæ‰€ä»¥å°±æ— æ³•åŒ¹é…ä¸Šè”åˆç´¢å¼•ï¼Œè”åˆç´¢å¼•å°±ä¼šå¤±æ•ˆ:</p><ul><li>where b&#x3D;2ï¼›</li><li>where c&#x3D;3ï¼›</li><li>where b&#x3D;2 and c&#x3D;3ï¼›</li></ul><p>ä¸Šé¢è¿™äº›æŸ¥è¯¢æ¡ä»¶ä¹‹æ‰€ä»¥ä¼šå¤±æ•ˆï¼Œæ˜¯å› ä¸º(a, b, c) è”åˆç´¢å¼•ï¼Œæ˜¯å…ˆæŒ‰ a æ’åºï¼Œåœ¨ a ç›¸åŒçš„æƒ…å†µå†æŒ‰ b æ’åºï¼Œåœ¨ b ç›¸åŒçš„æƒ…å†µå†æŒ‰ c æ’åºã€‚æ‰€ä»¥ï¼Œ<strong>b å’Œ c æ˜¯å…¨å±€æ— åºï¼Œå±€éƒ¨ç›¸å¯¹æœ‰åºçš„</strong>ï¼Œè¿™æ ·åœ¨æ²¡æœ‰éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™çš„æƒ…å†µä¸‹ï¼Œæ˜¯æ— æ³•åˆ©ç”¨åˆ°ç´¢å¼•çš„ã€‚</p></blockquote><h3 id="ç´¢å¼•ä¸‹æ¨"><a href="#ç´¢å¼•ä¸‹æ¨" class="headerlink" title="ç´¢å¼•ä¸‹æ¨"></a>ç´¢å¼•ä¸‹æ¨</h3><p><strong>ç´¢å¼•ä¸‹æ¨ï¼ˆIndex Condition Pushdownï¼Œç®€ç§° ICPï¼‰</strong> æ˜¯ <strong>MySQL 5.6</strong> ç‰ˆæœ¬ä¸­æä¾›çš„ä¸€é¡¹ç´¢å¼•ä¼˜åŒ–åŠŸèƒ½ï¼Œå®ƒå…è®¸å­˜å‚¨å¼•æ“åœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œéƒ¨åˆ† <code>WHERE</code>å­—å¥çš„åˆ¤æ–­æ¡ä»¶ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œä»è€Œå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031659468.png" alt="img"></p><p>MySQL å¯ä»¥ç®€å•åˆ†ä¸º Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚è¿™ä¸¤å±‚ã€‚Server å±‚å¤„ç†æŸ¥è¯¢è§£æã€åˆ†æã€ä¼˜åŒ–ã€ç¼“å­˜ä»¥åŠä¸å®¢æˆ·ç«¯çš„äº¤äº’ç­‰æ“ä½œï¼Œè€Œå­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ï¼ŒMySQL æ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šç§å­˜å‚¨å¼•æ“ã€‚</p><p>ç´¢å¼•ä¸‹æ¨çš„<strong>ä¸‹æ¨</strong>å…¶å®å°±æ˜¯æŒ‡å°†éƒ¨åˆ†ä¸Šå±‚ï¼ˆServer å±‚ï¼‰è´Ÿè´£çš„äº‹æƒ…ï¼Œäº¤ç»™äº†ä¸‹å±‚ï¼ˆå­˜å‚¨å¼•æ“å±‚ï¼‰å»å¤„ç†ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œç»“åˆç´¢å¼•ä¸‹æ¨åŸç†å†å¯¹ä¸Šé¢æåˆ°çš„ä¾‹å­è¿›è¡Œè§£é‡Šã€‚</p><p>æ²¡æœ‰ç´¢å¼•ä¸‹æ¨ä¹‹å‰ï¼š</p><ul><li>å­˜å‚¨å¼•æ“å±‚å…ˆæ ¹æ® <code>zipcode</code> ç´¢å¼•å­—æ®µæ‰¾åˆ°æ‰€æœ‰ <code>zipcode = &#39;431200&#39;</code> çš„ç”¨æˆ·çš„ä¸»é”® IDï¼Œç„¶åäºŒæ¬¡å›è¡¨æŸ¥è¯¢ï¼Œè·å–å®Œæ•´çš„ç”¨æˆ·æ•°æ®ï¼›</li><li>å­˜å‚¨å¼•æ“å±‚æŠŠæ‰€æœ‰ <code>zipcode = &#39;431200&#39;</code> çš„ç”¨æˆ·æ•°æ®å…¨éƒ¨äº¤ç»™ Server å±‚ï¼ŒServer å±‚æ ¹æ®<code>MONTH(birthdate) = 3</code>è¿™ä¸€æ¡ä»¶å†è¿›ä¸€æ­¥åšç­›é€‰ã€‚</li></ul><p>æœ‰äº†ç´¢å¼•ä¸‹æ¨ä¹‹åï¼š</p><ul><li>å­˜å‚¨å¼•æ“å±‚å…ˆæ ¹æ® <code>zipcode</code> ç´¢å¼•å­—æ®µæ‰¾åˆ°æ‰€æœ‰ <code>zipcode = &#39;431200&#39;</code> çš„ç”¨æˆ·ï¼Œç„¶åç›´æ¥åˆ¤æ–­ <code>MONTH(birthdate) = 3</code>ï¼Œç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„ä¸»é”® IDï¼›</li><li>äºŒæ¬¡å›è¡¨æŸ¥è¯¢ï¼Œæ ¹æ®ç¬¦åˆæ¡ä»¶çš„ä¸»é”® ID å»è·å–å®Œæ•´çš„ç”¨æˆ·æ•°æ®ï¼›</li><li>å­˜å‚¨å¼•æ“å±‚æŠŠç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·æ•°æ®å…¨éƒ¨äº¤ç»™ Server å±‚ã€‚</li></ul><p>å¯ä»¥çœ‹å‡ºï¼Œé™¤äº†å¯ä»¥å‡å°‘å›è¡¨æ¬¡æ•°ä¹‹å¤–ï¼Œç´¢å¼•ä¸‹æ¨è¿˜å¯ä»¥å‡å°‘å­˜å‚¨å¼•æ“å±‚å’Œ Server å±‚çš„æ•°æ®ä¼ è¾“é‡ã€‚</p><p>æœ€åï¼Œæ€»ç»“ä¸€ä¸‹ç´¢å¼•ä¸‹æ¨åº”ç”¨èŒƒå›´ï¼š</p><ol><li>é€‚ç”¨äº InnoDB å¼•æ“å’Œ MyISAM å¼•æ“çš„æŸ¥è¯¢ã€‚</li><li>é€‚ç”¨äºæ‰§è¡Œè®¡åˆ’æ˜¯ range, ref, eq_ref, ref_or_null çš„èŒƒå›´æŸ¥è¯¢ã€‚</li><li><strong>å¯¹äº InnoDB è¡¨ï¼Œä»…ç”¨äºéèšç°‡ç´¢å¼•ã€‚ç´¢å¼•ä¸‹æ¨çš„ç›®æ ‡æ˜¯å‡å°‘å…¨è¡Œè¯»å–æ¬¡æ•°ï¼Œä»è€Œå‡å°‘ I&#x2F;O æ“ä½œã€‚å¯¹äº InnoDB èšé›†ç´¢å¼•ï¼Œå®Œæ•´çš„è®°å½•å·²ç»è¯»å…¥ InnoDB ç¼“å†²åŒºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ç´¢å¼•ä¸‹æ¨ ä¸ä¼šå‡å°‘ I&#x2F;Oã€‚</strong></li><li>å­æŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸‹æ¨ï¼Œå› ä¸ºå­æŸ¥è¯¢é€šå¸¸ä¼šåˆ›å»ºä¸´æ—¶è¡¨æ¥å¤„ç†ç»“æœï¼Œè€Œè¿™äº›ä¸´æ—¶è¡¨æ˜¯æ²¡æœ‰ç´¢å¼•çš„ã€‚</li><li>å­˜å‚¨è¿‡ç¨‹ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸‹æ¨ï¼Œå› ä¸ºå­˜å‚¨å¼•æ“æ— æ³•è°ƒç”¨å­˜å‚¨å‡½æ•°ã€‚</li></ol><h3 id="çŸ¥é“å¦‚ä½•åˆ†æ-SQL-è¯­å¥æ˜¯å¦èµ°ç´¢å¼•æŸ¥è¯¢"><a href="#çŸ¥é“å¦‚ä½•åˆ†æ-SQL-è¯­å¥æ˜¯å¦èµ°ç´¢å¼•æŸ¥è¯¢" class="headerlink" title="çŸ¥é“å¦‚ä½•åˆ†æ SQL è¯­å¥æ˜¯å¦èµ°ç´¢å¼•æŸ¥è¯¢"></a>çŸ¥é“å¦‚ä½•åˆ†æ SQL è¯­å¥æ˜¯å¦èµ°ç´¢å¼•æŸ¥è¯¢</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>EXPLAIN</code> å‘½ä»¤æ¥åˆ†æ SQL çš„ <strong>æ‰§è¡Œè®¡åˆ’</strong> ï¼Œè¿™æ ·å°±çŸ¥é“è¯­å¥æ˜¯å¦å‘½ä¸­ç´¢å¼•äº†ã€‚æ‰§è¡Œè®¡åˆ’æ˜¯æŒ‡ä¸€æ¡ SQL è¯­å¥åœ¨ç»è¿‡ MySQL æŸ¥è¯¢ä¼˜åŒ–å™¨çš„ä¼˜åŒ–ä¼šåï¼Œå…·ä½“çš„æ‰§è¡Œæ–¹å¼ã€‚</p><p><code>EXPLAIN</code> å¹¶ä¸ä¼šçœŸçš„å»æ‰§è¡Œç›¸å…³çš„è¯­å¥ï¼Œè€Œæ˜¯é€šè¿‡ <strong>æŸ¥è¯¢ä¼˜åŒ–å™¨</strong> å¯¹è¯­å¥è¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºæœ€ä¼˜çš„æŸ¥è¯¢æ–¹æ¡ˆï¼Œå¹¶æ˜¾ç¤ºå¯¹åº”çš„ä¿¡æ¯ã€‚</p><p><code>EXPLAIN</code> çš„è¾“å‡ºæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> `score`,`name` <span class="keyword">FROM</span> `cus_order` <span class="keyword">ORDER</span> <span class="keyword">BY</span> `score` <span class="keyword">DESC</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>     <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span>   <span class="operator">|</span> filtered <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> cus_order <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">NULL</span>          <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">997572</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> filesort <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031707135.png" alt="image-20250303170713074"></p><h2 id="ç´¢å¼•å¤±æ•ˆåœºæ™¯"><a href="#ç´¢å¼•å¤±æ•ˆåœºæ™¯" class="headerlink" title="ç´¢å¼•å¤±æ•ˆåœºæ™¯"></a>ç´¢å¼•å¤±æ•ˆåœºæ™¯</h2><h3 id="ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™"><a href="#ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™" class="headerlink" title="ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™"></a>ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™</h3><p>ä¸åšè¿‡å¤šä»‹ç»ï¼Œç®€å•çš„è¯´æŸ¥è¯¢çš„å­—æ®µä¸­å¹¶ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™ã€‚ä¾‹å¦‚æˆ‘ä»¬å®šä¹‰çš„ç´¢å¼•å­—æ®µä¸ºï¼ˆa,b,cï¼‰ï¼Œç»“æœæˆ‘ä»¬çš„whereè¯­å¥ä¸­ä½¿ç”¨çš„æ¡ä»¶ä¸ºbï¼Œåˆ™è¯¥æŸ¥è¯¢æ—¶æ— æ³•èµ°ç´¢å¼•æŸ¥è¯¢çš„ã€‚</p><h3 id="ä½¿ç”¨Select"><a href="#ä½¿ç”¨Select" class="headerlink" title="ä½¿ç”¨Select *"></a>ä½¿ç”¨Select *</h3><p>å¦‚æœselectè¯­å¥ä¸­çš„æŸ¥è¯¢åˆ—ï¼Œéƒ½æ˜¯ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆè¿™äº›åˆ—è¢«ç§°ä¸ºè¦†ç›–ç´¢å¼•ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢çš„ç›¸å…³å­—æ®µéƒ½èƒ½èµ°ç´¢å¼•ï¼Œç´¢å¼•æŸ¥è¯¢æ•ˆç‡ç›¸å¯¹æ¥è¯´æ›´é«˜ä¸€äº›ã€‚</p><p>é‚£ä¹ˆå¦‚æœä½¿ç”¨Select * æ˜¯æ— æ³•èµ°è¦†ç›–æŸ¥è¯¢çš„ï¼Œä½†æ˜¯ä½¿ç”¨äº†Select * ä¸€å®šä¸ä¼šèµ°ç´¢å¼•æŸ¥è¯¢ç ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚</p><blockquote><p>è¿™é‡Œæ˜¯æˆ‘ä¹‹å‰çš„ä¸€ä¸ªæ€ç»´è¯¯åŒº select _ ä¸ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ ä¹‹å‰æµ‹è¯•å‘ç°å¤±æ•ˆæ˜¯å› ä¸º where åé¢çš„æŸ¥è¯¢èŒƒå›´è¿‡å¤§ å¯¼è‡´ç´¢å¼•å¤±æ•ˆ å¹¶ä¸æ˜¯ select _ å¼•èµ·çš„ ä½†æ˜¯ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ select *</p></blockquote><h3 id="ç´¢å¼•åˆ—ä¸Šæœ‰è®¡ç®—-ç´¢å¼•åˆ—ç”¨äº†å‡½æ•°"><a href="#ç´¢å¼•åˆ—ä¸Šæœ‰è®¡ç®—-ç´¢å¼•åˆ—ç”¨äº†å‡½æ•°" class="headerlink" title="ç´¢å¼•åˆ—ä¸Šæœ‰è®¡ç®— &amp; ç´¢å¼•åˆ—ç”¨äº†å‡½æ•°"></a>ç´¢å¼•åˆ—ä¸Šæœ‰è®¡ç®— &amp; ç´¢å¼•åˆ—ç”¨äº†å‡½æ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">+</span><span class="number">1</span><span class="operator">=</span><span class="number">2</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>  <span class="keyword">where</span> SUBSTR(height,<span class="number">1</span>,<span class="number">2</span>)<span class="operator">=</span><span class="number">17</span>;</span><br></pre></td></tr></table></figure><h3 id="å­—æ®µç±»å‹ä¸åŒ"><a href="#å­—æ®µç±»å‹ä¸åŒ" class="headerlink" title="å­—æ®µç±»å‹ä¸åŒ"></a>å­—æ®µç±»å‹ä¸åŒ</h3><blockquote><p>åœ¨sqlè¯­å¥ä¸­å› ä¸ºå­—æ®µç±»å‹ä¸åŒï¼Œè€Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆçš„é—®é¢˜ï¼Œå¾ˆå®¹æ˜“é‡åˆ°ï¼Œå¯èƒ½æ˜¯æˆ‘ä»¬æ—¥å¸¸å·¥ä½œä¸­æœ€å®¹æ˜“å¿½ç•¥çš„é—®é¢˜ã€‚</p><p>åˆ°åº•æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p><p>è¯·å¤§å®¶æ³¨æ„è§‚å¯Ÿä¸€ä¸‹t_userè¡¨ä¸­çš„codeå­—æ®µï¼Œå®ƒæ˜¯varcharå­—ç¬¦ç±»å‹çš„ã€‚</p><p>åœ¨sqlè¯­å¥ä¸­æŸ¥è¯¢æ•°æ®æ—¶ï¼ŒæŸ¥è¯¢æ¡ä»¶æˆ‘ä»¬å¯ä»¥å†™æˆè¿™æ ·ï¼š</p><p>explain </p><p>select * from user where code&#x3D;â€101â€;<br>æ‰§è¡Œç»“æœï¼š</p><p>ä»ä¸Šå›¾ä¸­çœ‹åˆ°ï¼Œè¯¥codeå­—æ®µèµ°äº†ç´¢å¼•ã€‚</p><p>æ¸©é¦¨æé†’ä¸€ä¸‹ï¼ŒæŸ¥è¯¢å­—ç¬¦å­—æ®µæ—¶ï¼Œç”¨åŒå¼•å·â€œå’Œå•å¼•å·â€™éƒ½å¯ä»¥ã€‚</p><p>ä½†å¦‚æœä½ åœ¨å†™sqlæ—¶ï¼Œä¸å°å¿ƒæŠŠå¼•å·å¼„æ‰äº†ï¼ŒæŠŠsqlè¯­å¥å˜æˆäº†ï¼š</p><p>explain </p><p>select * from user where code&#x3D;101;<br>æ‰§è¡Œç»“æœï¼š</p><p>ä½ ä¼šæƒŠå¥‡çš„å‘ç°ï¼Œè¯¥sqlè¯­å¥ç«Ÿç„¶å˜æˆäº†å…¨è¡¨æ‰«æã€‚å› ä¸ºå°‘å†™äº†å¼•å·ï¼Œè¿™ç§å°å°çš„å¤±è¯¯ï¼Œç«Ÿç„¶è®©codeå­—æ®µä¸Šçš„ç´¢å¼•å¤±æ•ˆäº†ã€‚</p><p>è¿™æ—¶ä½ å¿ƒé‡Œå¯èƒ½æœ‰ä¸€ä¸‡ä¸ªä¸ºä»€ä¹ˆï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªè‚¯å®šæ˜¯ï¼šä¸ºä»€ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆå‘¢ï¼Ÿ</p><p>ç­”ï¼šå› ä¸ºcodeå­—æ®µçš„ç±»å‹æ˜¯varcharï¼Œè€Œä¼ å‚çš„ç±»å‹æ˜¯intï¼Œä¸¤ç§ç±»å‹ä¸åŒã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼Œå¦‚æœintç±»å‹çš„heightå­—æ®µï¼Œåœ¨æŸ¥è¯¢æ—¶åŠ äº†å¼•å·æ¡ä»¶ï¼Œå´è¿˜å¯ä»¥èµ°ç´¢å¼•ï¼š</p><p>explain select * from user </p><p>where height&#x3D;â€™175â€™;<br>æ‰§è¡Œç»“æœï¼š</p><p>ä»å›¾ä¸­çœ‹å‡ºè¯¥sqlè¯­å¥ç¡®å®èµ°äº†ç´¢å¼•ã€‚intç±»å‹çš„å‚æ•°ï¼Œä¸ç®¡åœ¨æŸ¥è¯¢æ—¶åŠ æ²¡åŠ å¼•å·ï¼Œéƒ½èƒ½èµ°ç´¢å¼•ã€‚</p><p>è¿™æ˜¯å˜é­”æœ¯å—ï¼Ÿè¿™ä¸ç§‘å­¦å‘€ã€‚</p><p>ç­”ï¼šmysqlå‘ç°å¦‚æœæ˜¯intç±»å‹å­—æ®µä½œä¸ºæŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°†è¯¥å­—æ®µçš„ä¼ å‚è¿›è¡Œéšå¼è½¬æ¢ï¼ŒæŠŠå­—ç¬¦ä¸²è½¬æ¢æˆintç±»å‹ã€‚</p><p>mysqlä¼šæŠŠä¸Šé¢åˆ—å­ä¸­çš„å­—ç¬¦ä¸²175ï¼Œè½¬æ¢æˆæ•°å­—175ï¼Œæ‰€ä»¥ä»ç„¶èƒ½èµ°ç´¢å¼•ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œçœ‹ä¸€ä¸ªæ›´æœ‰è¶£çš„sqlè¯­å¥ï¼š</p><p>select 1 + â€˜1â€™;<br>å®ƒçš„æ‰§è¡Œç»“æœæ˜¯2ï¼Œè¿˜æ˜¯11å‘¢ï¼Ÿ</p><p>å¥½å§ï¼Œä¸å–å…³å­äº†ï¼Œç›´æ¥å…¬å¸ƒç­”æ¡ˆæ‰§è¡Œç»“æœæ˜¯2ã€‚</p><p>mysqlè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²1ï¼Œè½¬æ¢æˆäº†intç±»å‹çš„1ï¼Œç„¶åå˜æˆäº†ï¼š1+1&#x3D;2ã€‚</p><p>ä½†å¦‚æœä½ ç¡®å®æƒ³æ‹¼æ¥å­—ç¬¦ä¸²è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>ç­”ï¼šå¯ä»¥ä½¿ç”¨concatå…³é”®å­—ã€‚</p><p>å…·ä½“æ‹¼æ¥sqlå¦‚ä¸‹ï¼š</p><p>select concat(1,â€™1â€™);<br>æ¥ä¸‹æ¥ï¼Œå…³é”®é—®é¢˜æ¥äº†ï¼šä¸ºä»€ä¹ˆå­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œä¼ å…¥äº†intç±»å‹çš„å‚æ•°æ—¶ç´¢å¼•ä¼šå¤±æ•ˆå‘¢ï¼Ÿ</p><p>ç­”ï¼šæ ¹æ®mysqlå®˜ç½‘ä¸Šè§£é‡Šï¼Œå­—ç¬¦ä¸²â€™1â€™ã€â€™ 1 â€˜ã€â€™1aâ€™éƒ½èƒ½è½¬æ¢æˆintç±»å‹çš„1ï¼Œä¹Ÿå°±æ˜¯è¯´å¯èƒ½ä¼šå‡ºç°å¤šä¸ªå­—ç¬¦ä¸²ï¼Œå¯¹åº”ä¸€ä¸ªintç±»å‹å‚æ•°çš„æƒ…å†µã€‚é‚£ä¹ˆï¼Œmysqlæ€ä¹ˆçŸ¥é“è¯¥æŠŠintç±»å‹çš„1è½¬æ¢æˆå“ªç§å­—ç¬¦ä¸²ï¼Œç”¨å“ªä¸ªç´¢å¼•å¿«é€ŸæŸ¥å€¼?</p><p>æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å†çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://dev.mysql.com/doc/refman/8.0/en/type-conversion.html">https://dev.mysql.com/doc/refman/8.0/en/type-conversion.html</a></p></blockquote><h3 id="likeå·¦è¾¹åŒ…å«"><a href="#likeå·¦è¾¹åŒ…å«" class="headerlink" title="likeå·¦è¾¹åŒ…å«%"></a>likeå·¦è¾¹åŒ…å«%</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">where</span> code <span class="keyword">like</span> <span class="string">&#x27;%1%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¯¥sqlè¯­å¥çš„ç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆã€‚</p><p>ä¸‹é¢ç”¨ä¸€å¥è¯æ€»ç»“ä¸€ä¸‹è§„å¾‹ï¼šå½“likeè¯­å¥ä¸­çš„%ï¼Œå‡ºç°åœ¨æŸ¥è¯¢æ¡ä»¶çš„å·¦è¾¹æ—¶ï¼Œç´¢å¼•ä¼šå¤±æ•ˆã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§ç°è±¡å‘¢ï¼Ÿ</p><p>ç­”ï¼šå…¶å®å¾ˆå¥½ç†è§£ï¼Œç´¢å¼•å°±åƒå­—å…¸ä¸­çš„ç›®å½•ã€‚ä¸€èˆ¬ç›®å½•æ˜¯æŒ‰å­—æ¯æˆ–è€…æ‹¼éŸ³ä»å°åˆ°å¤§ï¼Œä»å·¦åˆ°å³æ’åºï¼Œæ˜¯æœ‰é¡ºåºçš„ã€‚</p><p>æˆ‘ä»¬åœ¨æŸ¥ç›®å½•æ—¶ï¼Œé€šå¸¸ä¼šå…ˆä»å·¦è¾¹ç¬¬ä¸€ä¸ªå­—æ¯è¿›è¡ŒåŒ¹å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œå†åŒ¹å¯¹å·¦è¾¹ç¬¬äºŒä¸ªå­—æ¯ï¼Œå¦‚æœå†ç›¸åŒåŒ¹å¯¹å…¶ä»–çš„å­—æ¯ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬èƒ½å¿«é€Ÿé”å®šä¸€ä¸ªå…·ä½“çš„ç›®å½•ï¼Œæˆ–è€…ç¼©å°ç›®å½•çš„èŒƒå›´ã€‚</p><p>ä½†å¦‚æœä½ ç¡¬è¦è·Ÿç›®å½•çš„è®¾è®¡åç€æ¥ï¼Œå…ˆä»å­—å…¸ç›®å½•å³è¾¹åŒ¹é…ç¬¬ä¸€ä¸ªå­—æ¯ï¼Œè¿™ç”»é¢ä½ å¯ä»¥è‡ªè¡Œè„‘è¡¥ä¸€ä¸‹ï¼Œä½ çœ¼ä¸­å¯èƒ½åªå‰©ä¸‹ç»æœ›äº†ï¼Œå“ˆå“ˆã€‚</p><h3 id="ä½¿ç”¨orå…³é”®å­—"><a href="#ä½¿ç”¨orå…³é”®å­—" class="headerlink" title="ä½¿ç”¨orå…³é”®å­—"></a>ä½¿ç”¨orå…³é”®å­—</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031726670.png" alt="image-20250303172639602"></p><h3 id="åˆ—å¯¹æ¯”"><a href="#åˆ—å¯¹æ¯”" class="headerlink" title="åˆ—å¯¹æ¯”"></a>åˆ—å¯¹æ¯”</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031727235.png" alt="image-20250303172705185"></p><h3 id="not-inå’Œnot-exists"><a href="#not-inå’Œnot-exists" class="headerlink" title="not inå’Œnot exists"></a>not inå’Œnot exists</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031728864.png" alt="image-20250303172843800"></p><h3 id="order-byçš„å‘"><a href="#order-byçš„å‘" class="headerlink" title="order byçš„å‘"></a>order byçš„å‘</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031730120.png" alt="image-20250303173031056"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503031730140.png" alt="image-20250303173046101"></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://javaguide.cn/database/mysql/mysql-index.html">MySQLç´¢å¼•è¯¦è§£</a></li><li><a href="https://blog.csdn.net/weixin_46224056/article/details/137597431">ç´¢å¼•å¤±æ•ˆçš„10ç§åœºæ™¯ï¼Œä½ çŸ¥é“å‡ ä¸ªå‘¢ï¼Ÿï¼ˆé¢è¯•å¿…åˆ·!ï¼‰</a></li><li><a href="https://mp.weixin.qq.com/s/mwME3qukHBFul57WQLkOYg">ç¾å›¢æš‘æœŸå®ä¹ ä¸€é¢ï¼šMySQl ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> ç´¢å¼• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-21 AQS</title>
      <link href="/2025/03/02/75-21%20AQS/"/>
      <url>/2025/03/02/75-21%20AQS/</url>
      
        <content type="html"><![CDATA[<h1 id="75-21-AQS"><a href="#75-21-AQS" class="headerlink" title="75-21 AQS"></a>75-21 AQS</h1><h2 id="AQSä»‹ç»"><a href="#AQSä»‹ç»" class="headerlink" title="AQSä»‹ç»"></a>AQSä»‹ç»</h2><p>AQS çš„å…¨ç§°ä¸º <code>AbstractQueuedSynchronizer</code> ï¼Œç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ã€‚è¿™ä¸ªç±»åœ¨ <code>java.util.concurrent.locks</code> åŒ…ä¸‹é¢ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022042101.png" alt="img"></p><p>ä½ å¯ä»¥æŠŠ AQS æƒ³è±¡æˆä¸€ä¸ª <strong>æ’é˜Ÿä¹°ç¥¨çš„åœºæ™¯</strong>ï¼š</p><ul><li>å”®ç¥¨çª—å£ï¼ˆä¸´ç•Œèµ„æºï¼‰ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªäººã€‚</li><li>ä¹°ç¥¨çš„äººï¼ˆçº¿ç¨‹ï¼‰æ¥äº†ä¹‹åï¼Œè¦ <strong>æ’é˜Ÿ</strong>ï¼ŒæŒ‰é¡ºåºç­‰ç€çª—å£å¤„ç†ã€‚</li><li>æœ‰çš„çª—å£ï¼ˆ<code>ReentrantLock</code>ï¼‰ä¸€æ¬¡åªæ¥å¾…ä¸€ä¸ªäººï¼Œè€Œæœ‰çš„çª—å£ï¼ˆ<code>Semaphore</code>ï¼‰å¯èƒ½åŒæ—¶å¤„ç†å¤šä¸ªã€‚</li><li>å”®ç¥¨å‘˜ï¼ˆAQSï¼‰ç®¡ç†ç€æ•´ä¸ªé˜Ÿä¼ï¼Œå†³å®šè°è¯¥è¿›ã€è°è¯¥ç­‰ã€‚</li></ul><p>æ¢å¥è¯è¯´ï¼ŒAQS <strong>ç®¡ç†ç€ä¸€ç»„çº¿ç¨‹çš„è®¿é—®æƒé™</strong>ï¼Œç¡®ä¿ <strong>èµ„æºè®¿é—®çš„æœ‰åºæ€§å’Œå®‰å…¨æ€§</strong>ã€‚</p><p>AQS ä¸ºæ„å»ºé”å’ŒåŒæ­¥å™¨æä¾›äº†ä¸€äº›é€šç”¨åŠŸèƒ½çš„å®ç°ã€‚å› æ­¤ï¼Œä½¿ç”¨ AQS èƒ½ç®€å•ä¸”é«˜æ•ˆåœ°æ„é€ å‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡çš„åŒæ­¥å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬æåˆ°çš„ <code>ReentrantLock</code>ï¼Œ<code>Semaphore</code>ï¼Œå…¶ä»–çš„è¯¸å¦‚ <code>ReentrantReadWriteLock</code>ï¼Œ<code>SynchronousQueue</code>ç­‰ç­‰çš†æ˜¯åŸºäº AQS çš„ã€‚</p><p><a href="https://so.csdn.net/so/search?q=AQS&spm=1001.2101.3001.7020">AQS</a>ï¼ˆ AbstractQueuedSynchronizer ï¼‰æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨ï¼ˆæ‰€è°“åŒæ­¥ï¼Œæ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€åä½œï¼‰çš„æ¡†æ¶ã€‚</p><hr><h2 id="é”åŸç†-ä¿¡å·é‡-vs-ç®¡ç¨‹"><a href="#é”åŸç†-ä¿¡å·é‡-vs-ç®¡ç¨‹" class="headerlink" title="é”åŸç† - ä¿¡å·é‡ vs ç®¡ç¨‹"></a>é”åŸç† - ä¿¡å·é‡ vs ç®¡ç¨‹</h2><p>åœ¨å¹¶å‘ç¼–ç¨‹é¢†åŸŸï¼Œæœ‰ä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼š<strong>äº’æ–¥</strong>ä¸<strong>åŒæ­¥</strong>ï¼Œäº’æ–¥å³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼ŒåŒæ­¥ï¼Œå³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ã€åä½œï¼Œä¸€èˆ¬è¿™ä¸¤å¤§é—®é¢˜å¯ä»¥é€šè¿‡<strong>ä¿¡å·é‡</strong>å’Œ<strong>ç®¡ç¨‹</strong>æ¥è§£å†³ã€‚</p><p>å¹¶å‘ç¼–ç¨‹é¢†åŸŸä¸»è¦å°±æ˜¯ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šäº’æ–¥å’ŒåŒæ­¥ï¼Œå¹¶å‘å°±æ˜¯æˆ‘ä»¬éœ€è¦ä¿è¯åœ¨å¤šä¸ªçº¿ç¨‹å·¥ä½œæ—¶ï¼Œå¯¹äºæŸäº›èµ„æºæˆ‘ä»¬å¸Œæœ›å…¶æŒ‰ç…§è§„åˆ™æ¥è·å–ï¼Œå¯¹äºæŸäº›æ“ä½œï¼Œæˆ‘ä»¬å¸Œæœ›å…¶æŒ‰ç…§è§„åˆ™æ¥è¿›è¡Œæ‰§è¡Œã€‚</p><h3 id="ä¿¡å·é‡"><a href="#ä¿¡å·é‡" class="headerlink" title="ä¿¡å·é‡"></a>ä¿¡å·é‡</h3><p>**ä¿¡å·é‡ï¼ˆSemaphoreï¼‰**æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç§è¿›ç¨‹é—´å¸¸è§çš„é€šä¿¡æ–¹å¼ï¼Œä¸»è¦ç”¨æ¥åè°ƒå¹¶å‘ç¨‹åºå¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥ä¿è¯å¯¹ä¿¡å·é‡æ“ä½œçš„åŸå­æ€§ã€‚å®ƒæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ã€‚</p><p>ä¿¡å·é‡ç”±ä¸€ä¸ªå…±äº«æ•´å‹å˜é‡ S å’Œä¸¤ä¸ªåŸå­æ“ä½œ PV ç»„æˆï¼ŒS åªèƒ½é€šè¿‡ P å’Œ V æ“ä½œæ¥æ”¹å˜</p><p>P æ“ä½œï¼šå³è¯·æ±‚èµ„æºï¼Œæ„å‘³ç€ S è¦å‡ 1ï¼Œå¦‚æœ S &lt;  0, åˆ™è¡¨ç¤ºæ²¡æœ‰èµ„æºäº†ï¼Œæ­¤æ—¶çº¿ç¨‹è¦è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ˆåŒæ­¥é˜Ÿåˆ—ï¼‰ç­‰å¾…</p><p>V æ“ä½œ:  å³é‡Šæ”¾èµ„æºï¼Œæ„å‘³ç€ S è¦åŠ  1ï¼Œ å¦‚æœ S å°äºç­‰äº 0ï¼Œè¯´æ˜ç­‰å¾…é˜Ÿåˆ—é‡Œæœ‰çº¿ç¨‹ï¼Œæ­¤æ—¶å°±éœ€è¦å”¤é†’çº¿ç¨‹ã€‚</p><p>ç¤ºæ„å›¾å¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022055175.png" alt="å›¾ç‰‡"></p><p>ä¿¡å·é‡æœºåˆ¶çš„å¼•å…¥è§£å†³äº†è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥é—®é¢˜ï¼Œ<strong>ä½†ä¿¡å·é‡çš„å¤§é‡åŒæ­¥æ“ä½œåˆ†æ•£åœ¨å„ä¸ªè¿›ç¨‹ä¸­ä¸ä¾¿äºç®¡ç†</strong>ï¼Œè¿˜æœ‰å¯èƒ½å¯¼è‡´ç³»ç»Ÿæ­»é”ã€‚å¦‚ï¼šç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ä¸­å°†Pã€Vé¢ å€’å¯èƒ½æ­»é”ï¼ˆè§æ–‡æœ«å‚è€ƒé“¾æ¥ï¼‰ï¼Œå¦å¤–æ¡ä»¶è¶Šå¤šï¼Œéœ€è¦çš„ä¿¡å·é‡å°±è¶Šå¤šï¼Œéœ€è¦æ›´åŠ è°¨æ…åœ°å¤„ç†ä¿¡å·é‡ä¹‹é—´çš„å¤„ç†é¡ºåºï¼Œå¦åˆ™å¾ˆå®¹æ˜“é€ æˆæ­»é”ç°è±¡ã€‚</p><p>åŸºäºä¿¡å·é‡ç»™ç¼–ç¨‹å¸¦æ¥çš„éšæ‚£ï¼Œäºæ˜¯æœ‰äº†æå‡ºäº†å¯¹å¼€å‘è€…æ›´åŠ å‹å¥½çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹-ç®¡ç¨‹ã€‚</p><h3 id="ç®¡ç¨‹"><a href="#ç®¡ç¨‹" class="headerlink" title="ç®¡ç¨‹"></a>ç®¡ç¨‹</h3><p>Dijkstra äº 1971 å¹´æå‡ºï¼šæŠŠæ‰€æœ‰è¿›ç¨‹å¯¹æŸä¸€ç§<strong>ä¸´ç•Œèµ„æº</strong>çš„åŒæ­¥æ“ä½œéƒ½é›†ä¸­èµ·æ¥ï¼Œæ„æˆä¸€ä¸ªæ‰€è°“çš„ç§˜ä¹¦è¿›ç¨‹ã€‚å‡¡è¦è®¿é—®è¯¥ä¸´ç•Œèµ„æºçš„è¿›ç¨‹ï¼Œéƒ½éœ€å…ˆæŠ¥å‘Šç§˜ä¹¦ï¼Œç”±ç§˜ä¹¦æ¥å®ç°è¯¸è¿›ç¨‹å¯¹åŒä¸€ä¸´ç•Œèµ„æºçš„<strong>äº’æ–¥</strong>ä½¿ç”¨ï¼Œè¿™ç§æœºåˆ¶å°±æ˜¯ç®¡ç¨‹ã€‚</p><p><strong>ç®¡ç¨‹ï¼ˆMonitorï¼‰æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶</strong>ï¼Œç”¨äºç®¡ç†å¤šä¸ªçº¿ç¨‹å¯¹ <strong>å…±äº«èµ„æºçš„è®¿é—®</strong>ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ <strong>ä¸€ä¸ªå°è£…äº†äº’æ–¥é”å’Œæ¡ä»¶å˜é‡çš„å¯¹è±¡</strong>ï¼Œæä¾›äº†ä¸€ç§å®‰å…¨çš„æ–¹å¼æ¥åè°ƒçº¿ç¨‹çš„æ‰§è¡Œã€‚</p><h4 id="äºŒã€å½¢è±¡ç±»æ¯”ï¼šç®¡ç¨‹å°±åƒâ€œæ´—æ‰‹é—´â€"><a href="#äºŒã€å½¢è±¡ç±»æ¯”ï¼šç®¡ç¨‹å°±åƒâ€œæ´—æ‰‹é—´â€" class="headerlink" title="äºŒã€å½¢è±¡ç±»æ¯”ï¼šç®¡ç¨‹å°±åƒâ€œæ´—æ‰‹é—´â€"></a><strong>äºŒã€å½¢è±¡ç±»æ¯”ï¼šç®¡ç¨‹å°±åƒâ€œæ´—æ‰‹é—´â€</strong></h4><h5 id="1-äº’æ–¥é”ï¼ˆMutexï¼‰ï¼šæ§åˆ¶è¿›å…¥"><a href="#1-äº’æ–¥é”ï¼ˆMutexï¼‰ï¼šæ§åˆ¶è¿›å…¥" class="headerlink" title="1. äº’æ–¥é”ï¼ˆMutexï¼‰ï¼šæ§åˆ¶è¿›å…¥"></a><strong>1. äº’æ–¥é”ï¼ˆMutexï¼‰ï¼šæ§åˆ¶è¿›å…¥</strong></h5><p>æƒ³è±¡æœ‰ä¸€ä¸ªå…¬å…± <strong>æ´—æ‰‹é—´ï¼ˆå…±äº«èµ„æºï¼‰</strong>ï¼Œä¸ºäº†é¿å…æ··ä¹±ï¼Œå®ƒ <strong>ä¸€æ¬¡åªèƒ½å…è®¸ä¸€ä¸ªäººï¼ˆçº¿ç¨‹ï¼‰è¿›å…¥</strong>ï¼Œå…¶ä»–äººå¿…é¡» <strong>æ’é˜Ÿç­‰å¾…</strong>ã€‚</p><ul><li><strong>é”ï¼ˆLockï¼‰</strong>ï¼šæ´—æ‰‹é—´çš„é—¨é”ï¼Œç¡®ä¿åŒä¸€æ—¶é—´ <strong>æœ€å¤šåªæœ‰ä¸€ä¸ªäºº</strong> åœ¨é‡Œé¢ã€‚</li><li><strong>è¿›å…¥æ´—æ‰‹é—´ï¼ˆä¸´ç•ŒåŒºä»£ç ï¼‰</strong>ï¼šä¸€ä¸ªäººä½¿ç”¨èµ„æºï¼Œåˆ«äººä¸èƒ½æŠ¢å ã€‚</li><li><strong>ç¦»å¼€æ´—æ‰‹é—´ï¼ˆé‡Šæ”¾é”ï¼‰</strong>ï¼šä½¿ç”¨å®Œæ¯•åï¼Œé‡Šæ”¾é”ï¼Œè®©ä¸‹ä¸€ä¸ªäººè¿›å…¥ã€‚</li></ul><h5 id="2-æ¡ä»¶å˜é‡ï¼ˆConditionï¼‰ï¼šç­‰å¾…åˆé€‚çš„æ¡ä»¶"><a href="#2-æ¡ä»¶å˜é‡ï¼ˆConditionï¼‰ï¼šç­‰å¾…åˆé€‚çš„æ¡ä»¶" class="headerlink" title="2. æ¡ä»¶å˜é‡ï¼ˆConditionï¼‰ï¼šç­‰å¾…åˆé€‚çš„æ¡ä»¶"></a><strong>2. æ¡ä»¶å˜é‡ï¼ˆConditionï¼‰ï¼šç­‰å¾…åˆé€‚çš„æ¡ä»¶</strong></h5><p>å‡è®¾ <strong>æ´—æ‰‹é—´é‡Œæœ‰ 3 ä¸ªè¹²ä½</strong>ï¼š</p><ul><li>å¦‚æœä½ è¿›æ¥å‘ç°æ‰€æœ‰è¹²ä½éƒ½è¢«å äº†ï¼ˆæ¡ä»¶ä¸æ»¡è¶³ï¼‰ï¼Œä½ åªèƒ½ <strong>æ’é˜Ÿç­‰å€™</strong>ã€‚</li><li><strong>å½“æœ‰è¹²ä½ç©ºå‡ºæ¥æ—¶ï¼ˆæŸäººç¦»å¼€ï¼‰ï¼Œç³»ç»Ÿä¼šé€šçŸ¥ä½ å¯ä»¥ä½¿ç”¨</strong>ã€‚</li></ul><p><strong>ğŸ”¹ è¿™å¯¹åº”äº†ç®¡ç¨‹çš„ä¸¤ç§æ“ä½œ</strong>ï¼š</p><ul><li><code>wait()</code>: çº¿ç¨‹ <strong>ç­‰å¾…æŸä¸ªæ¡ä»¶</strong>ï¼ˆæ¯”å¦‚è¹²ä½ç©ºå‡ºï¼‰ã€‚</li><li><code>notify()/notifyAll()</code>: <strong>é€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹</strong>ï¼ŒæŸä¸ªæ¡ä»¶æ»¡è¶³äº†ï¼ˆè¹²ä½ç©ºäº†ï¼‰ã€‚</li></ul><p><strong>åœ¨æ²¡æœ‰ç®¡ç¨‹ä¹‹å‰ï¼ˆmonitorï¼‰ï¼Œå¦‚æœè¿™ä¸ªå…±äº«èµ„æºå­˜åœ¨å¤šä¸ªçš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦å¤šä¸ªäº’æ–¥é”ï¼ˆä¹Ÿå°±æ˜¯å¤šä¸ªä¿¡å·é‡ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªéœ€è¦ä½¿ç”¨å…±äº«èµ„æºçš„è¯ï¼Œéƒ½éœ€è¦ä¸€ä¸€è¯¢é—®æ¯ä¸€ä¸ªä¿¡å·é‡ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼Œå¾ˆæ˜¯éº»çƒ¦ã€‚é‚£ä¹ˆç®¡ç¨‹ï¼ˆmonitorï¼‰å°±æ˜¯å°†è¿™äº›ä¿¡å·é‡å½’äºä¸€èµ·ï¼Œä»¥åä»»ä½•çº¿ç¨‹æƒ³ä½¿ç”¨å…±äº«èµ„æºçš„è¯ï¼Œç›´æ¥æ¥é—®taå°±å¯ä»¥äº†ã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022115432.png" alt="å›¾ç‰‡"></p><hr><h2 id="AQSåŸç†"><a href="#AQSåŸç†" class="headerlink" title="AQSåŸç†"></a>AQSåŸç†</h2><p>AQS å…¨ç§°æ˜¯ AbstractQueuedSynchronizerï¼Œæ˜¯ä¸€ä¸ªç”¨æ¥æ„å»º<strong>é”</strong>å’Œ<strong>åŒæ­¥å™¨</strong>çš„æ¡†æ¶ï¼Œå®ƒç»´æŠ¤äº†ä¸€ä¸ªå…±äº«èµ„æº state å’Œä¸€ä¸ª FIFO çš„ç­‰å¾…é˜Ÿåˆ—ï¼ˆå³ä¸Šæ–‡ä¸­ç®¡ç¨‹çš„å…¥å£ç­‰å¾…é˜Ÿåˆ—ï¼‰ï¼Œåº•å±‚åˆ©ç”¨äº† CAS æœºåˆ¶æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022116441.jpeg" alt="å›¾ç‰‡"></p><h3 id="AQSå››å¤§ç–‘é—®"><a href="#AQSå››å¤§ç–‘é—®" class="headerlink" title="AQSå››å¤§ç–‘é—®"></a>AQSå››å¤§ç–‘é—®</h3><h4 id="AQSçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#AQSçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="AQSçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>AQSçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>AQS è§£å†³äº†å¼€å‘è€…åœ¨å®ç°åŒæ­¥å™¨æ—¶çš„å¤æ‚æ€§é—®é¢˜ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šç”¨æ¡†æ¶ï¼Œç”¨äºå®ç°å„ç§åŒæ­¥å™¨ï¼Œä¾‹å¦‚ <strong>å¯é‡å…¥é”</strong>ï¼ˆ<code>ReentrantLock</code>ï¼‰ã€<strong>ä¿¡å·é‡</strong>ï¼ˆ<code>Semaphore</code>ï¼‰å’Œ <strong>å€’è®¡æ—¶å™¨</strong>ï¼ˆ<code>CountDownLatch</code>ï¼‰ã€‚é€šè¿‡å°è£…åº•å±‚çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼ŒAQS å°†å¤æ‚çš„çº¿ç¨‹ç®¡ç†é€»è¾‘éšè—èµ·æ¥ï¼Œä½¿å¼€å‘è€…åªéœ€ä¸“æ³¨äºå…·ä½“çš„åŒæ­¥é€»è¾‘ã€‚</p><h4 id="AQS-ä¸ºä»€ä¹ˆä½¿ç”¨-CLH-é”é˜Ÿåˆ—çš„å˜ä½“ï¼Ÿ"><a href="#AQS-ä¸ºä»€ä¹ˆä½¿ç”¨-CLH-é”é˜Ÿåˆ—çš„å˜ä½“ï¼Ÿ" class="headerlink" title="AQS ä¸ºä»€ä¹ˆä½¿ç”¨ CLH é”é˜Ÿåˆ—çš„å˜ä½“ï¼Ÿ"></a>AQS ä¸ºä»€ä¹ˆä½¿ç”¨ CLH é”é˜Ÿåˆ—çš„å˜ä½“ï¼Ÿ</h4><p>CLH é”æ˜¯ä¸€ç§åŸºäº <strong>è‡ªæ—‹é”</strong> çš„ä¼˜åŒ–å®ç°ã€‚</p><p>å…ˆè¯´ä¸€ä¸‹è‡ªæ—‹é”å­˜åœ¨çš„é—®é¢˜ï¼šè‡ªæ—‹é”é€šè¿‡çº¿ç¨‹ä¸æ–­å¯¹ä¸€ä¸ªåŸå­å˜é‡æ‰§è¡Œ <code>compareAndSet</code>ï¼ˆç®€ç§° <code>CAS</code>ï¼‰æ“ä½œæ¥å°è¯•è·å–é”ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šåŒæ—¶ç«äº‰åŒä¸€ä¸ªåŸå­å˜é‡ï¼Œå®¹æ˜“é€ æˆæŸä¸ªçº¿ç¨‹çš„ <code>CAS</code> æ“ä½œé•¿æ—¶é—´å¤±è´¥ï¼Œä»è€Œå¯¼è‡´ <strong>â€œé¥¥é¥¿â€é—®é¢˜</strong>ï¼ˆæŸäº›çº¿ç¨‹å¯èƒ½æ°¸è¿œæ— æ³•è·å–é”ï¼‰ã€‚</p><p>CLH é”é€šè¿‡å¼•å…¥ä¸€ä¸ªé˜Ÿåˆ—æ¥ç»„ç»‡å¹¶å‘ç«äº‰çš„çº¿ç¨‹ï¼Œå¯¹è‡ªæ—‹é”è¿›è¡Œäº†æ”¹è¿›ï¼š</p><ul><li>æ¯ä¸ªçº¿ç¨‹ä¼šä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶é€šè¿‡è‡ªæ—‹ç›‘æ§å‰ä¸€ä¸ªçº¿ç¨‹èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç›´æ¥ç«äº‰å…±äº«å˜é‡ã€‚</li><li>çº¿ç¨‹æŒ‰é¡ºåºæ’é˜Ÿï¼Œç¡®ä¿å…¬å¹³æ€§ï¼Œä»è€Œé¿å…äº† â€œé¥¥é¥¿â€ é—®é¢˜ã€‚</li></ul><p>AQSï¼ˆAbstractQueuedSynchronizerï¼‰åœ¨ CLH é”çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå½¢æˆäº†å…¶å†…éƒ¨çš„ <strong>CLH é˜Ÿåˆ—å˜ä½“</strong>ã€‚ä¸»è¦æ”¹è¿›ç‚¹æœ‰ä»¥ä¸‹ä¸¤æ–¹é¢ï¼š</p><ol><li>è‡ªæ—‹ + é˜»å¡ï¼š CLH é”ä½¿ç”¨çº¯è‡ªæ—‹æ–¹å¼ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œä½†å¤§é‡çš„è‡ªæ—‹æ“ä½œä¼šå ç”¨è¿‡å¤šçš„ CPU èµ„æºã€‚AQS å¼•å…¥äº†è‡ªæ—‹ + é˜»å¡çš„æ··åˆæœºåˆ¶ï¼š <ul><li>å¦‚æœçº¿ç¨‹è·å–é”å¤±è´¥ï¼Œä¼šå…ˆçŸ­æš‚è‡ªæ—‹å°è¯•è·å–é”ï¼›</li><li>å¦‚æœä»ç„¶å¤±è´¥ï¼Œåˆ™çº¿ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç­‰å¾…è¢«å”¤é†’ï¼Œä»è€Œå‡å°‘ CPU çš„æµªè´¹ã€‚</li></ul></li><li><strong>å•å‘é˜Ÿåˆ—æ”¹ä¸ºåŒå‘é˜Ÿåˆ—</strong>ï¼šCLH é”ä½¿ç”¨å•å‘é˜Ÿåˆ—ï¼ŒèŠ‚ç‚¹åªçŸ¥é“å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œè€Œå½“æŸä¸ªèŠ‚ç‚¹é‡Šæ”¾é”æ—¶ï¼Œéœ€è¦é€šè¿‡é˜Ÿåˆ—å”¤é†’åç»­èŠ‚ç‚¹ã€‚AQS å°†é˜Ÿåˆ—æ”¹ä¸º <strong>åŒå‘é˜Ÿåˆ—</strong>ï¼Œæ–°å¢äº† <code>next</code> æŒ‡é’ˆï¼Œä½¿å¾—èŠ‚ç‚¹ä¸ä»…çŸ¥é“å‰é©±èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å”¤é†’åç»§èŠ‚ç‚¹ï¼Œä»è€Œç®€åŒ–äº†é˜Ÿåˆ—æ“ä½œï¼Œæé«˜äº†å”¤é†’æ•ˆç‡ã€‚</li></ol><h4 id="AQS-çš„æ€§èƒ½æ¯”è¾ƒå¥½ï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#AQS-çš„æ€§èƒ½æ¯”è¾ƒå¥½ï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="AQS çš„æ€§èƒ½æ¯”è¾ƒå¥½ï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ"></a>AQS çš„æ€§èƒ½æ¯”è¾ƒå¥½ï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>å› ä¸º AQS é‡Œä½¿ç”¨äº† <code>CAS</code> + <code>çº¿ç¨‹é˜»å¡/å”¤é†’</code> ã€‚</p><p>åœ¨ AQS çš„å®ç°é‡Œï¼Œå¤§é‡ä½¿ç”¨äº† <code>CAS</code> æ“ä½œï¼Œ<code>CAS</code> åŸºäºå†…å­˜åœ°å€ç›´æ¥è¿›è¡Œæ•°æ®ä¿®æ”¹ï¼Œä¿è¯å¹¶å‘å®‰å…¨çš„åŒæ—¶ï¼Œæ€§èƒ½ä¹Ÿå¾ˆå¥½ã€‚</p><p>ä½†æ˜¯å¦‚æœä¸€ç›´é€šè¿‡ <code>CAS</code> æ“ä½œæ¥æ›´æ–°æ•°æ®ï¼Œä¼šæ¯”è¾ƒå ç”¨ CPUã€‚å› æ­¤ AQS åŒæ—¶ç»“åˆäº† <code>CAS</code> å’Œ <code>çº¿ç¨‹çš„é˜»å¡/å”¤é†’</code> æœºåˆ¶ï¼Œå½“ <code>CAS</code> æ²¡æœ‰æˆåŠŸè·å–èµ„æºæ—¶ï¼Œä¼šå¯¹çº¿ç¨‹è¿›è¡Œé˜»å¡ï¼Œé¿å…ä¸€ç›´ç©ºè½¬å ç”¨ CPU èµ„æºã€‚</p><h4 id="AQS-ä¸­ä¸ºä»€ä¹ˆ-Node-èŠ‚ç‚¹éœ€è¦ä¸åŒçš„çŠ¶æ€ï¼Ÿ"><a href="#AQS-ä¸­ä¸ºä»€ä¹ˆ-Node-èŠ‚ç‚¹éœ€è¦ä¸åŒçš„çŠ¶æ€ï¼Ÿ" class="headerlink" title="AQS ä¸­ä¸ºä»€ä¹ˆ Node èŠ‚ç‚¹éœ€è¦ä¸åŒçš„çŠ¶æ€ï¼Ÿ"></a>AQS ä¸­ä¸ºä»€ä¹ˆ Node èŠ‚ç‚¹éœ€è¦ä¸åŒçš„çŠ¶æ€ï¼Ÿ</h4><p>AQS ä¸­çš„ <code>waitStatus</code> çŠ¶æ€ç±»ä¼¼äº <strong>çŠ¶æ€æœº</strong> ï¼Œé€šè¿‡ä¸åŒçŠ¶æ€æ¥è¡¨æ˜ Node èŠ‚ç‚¹çš„ä¸åŒå«ä¹‰ï¼Œå¹¶ä¸”æ ¹æ®ä¸åŒæ“ä½œï¼Œæ¥æ§åˆ¶çŠ¶æ€ä¹‹é—´çš„æµè½¬ã€‚</p><p>åœ¨ AQS ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—ä¹‹åï¼Œåˆå§‹çŠ¶æ€ä¸º <code>0</code> ã€‚</p><p>å½“æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—ï¼Œæ­¤æ—¶æ–°èŠ‚ç‚¹çš„å‰ç»§èŠ‚ç‚¹çŠ¶æ€å°±ä¼šç”± <code>0</code> æ›´æ–°ä¸º <code>SIGNAL</code> ï¼Œè¡¨ç¤ºå‰ç»§èŠ‚ç‚¹é‡Šæ”¾é”ä¹‹åï¼Œéœ€è¦å¯¹æ–°èŠ‚ç‚¹è¿›è¡Œå”¤é†’æ“ä½œã€‚</p><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–é”é”æ—¶ï¼Œå› ä¸ºæŸç§åŸå› å¤±è´¥äº†ï¼Œè¯¥èŠ‚ç‚¹çš„çŠ¶æ€å°±ä¼šå˜ä¸º <code>CANCELLED</code> ï¼Œè¡¨æ˜å–æ¶ˆè·å–é”ï¼Œè¿™ç§çŠ¶æ€çš„èŠ‚ç‚¹æ˜¯å¼‚å¸¸çš„ï¼Œæ— æ³•è¢«å”¤é†’ï¼Œä¹Ÿæ— æ³•å”¤é†’åç»§èŠ‚ç‚¹</p><h3 id="AQSæ ¸å¿ƒæ€æƒ³"><a href="#AQSæ ¸å¿ƒæ€æƒ³" class="headerlink" title="AQSæ ¸å¿ƒæ€æƒ³"></a>AQSæ ¸å¿ƒæ€æƒ³</h3><p>AQS æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ AQS æ˜¯åŸºäº <strong>CLH é”</strong> ï¼ˆCraig, Landin, and Hagersten locksï¼‰ è¿›ä¸€æ­¥ä¼˜åŒ–å®ç°çš„ã€‚</p><p>AQS å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ª CLH å˜ä½“é˜Ÿåˆ—çš„ä¸€ä¸ªç»“ç‚¹ï¼ˆNodeï¼‰æ¥å®ç°é”çš„åˆ†é…ã€‚åœ¨ CLH å˜ä½“é˜Ÿåˆ—ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¿å­˜ç€çº¿ç¨‹çš„å¼•ç”¨ï¼ˆthreadï¼‰ã€ å½“å‰èŠ‚ç‚¹åœ¨é˜Ÿåˆ—ä¸­çš„çŠ¶æ€ï¼ˆwaitStatusï¼‰ã€å‰é©±èŠ‚ç‚¹ï¼ˆprevï¼‰ã€åç»§èŠ‚ç‚¹ï¼ˆnextï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022150053.png" alt="CLH å˜ä½“é˜Ÿåˆ—ç»“æ„"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022150548.png" alt="CLH å˜ä½“é˜Ÿåˆ—"></p><h3 id="Node-èŠ‚ç‚¹-waitStatus-çŠ¶æ€å«ä¹‰"><a href="#Node-èŠ‚ç‚¹-waitStatus-çŠ¶æ€å«ä¹‰" class="headerlink" title="Node èŠ‚ç‚¹ waitStatus çŠ¶æ€å«ä¹‰"></a>Node èŠ‚ç‚¹ waitStatus çŠ¶æ€å«ä¹‰</h3><table><thead><tr><th>Node èŠ‚ç‚¹çŠ¶æ€</th><th>å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>CANCELLED</code></td><td>1</td><td>è¡¨ç¤ºçº¿ç¨‹å·²ç»å–æ¶ˆè·å–é”ã€‚çº¿ç¨‹åœ¨ç­‰å¾…è·å–èµ„æºæ—¶è¢«ä¸­æ–­ã€ç­‰å¾…èµ„æºè¶…æ—¶ä¼šæ›´æ–°ä¸ºè¯¥çŠ¶æ€ã€‚</td></tr><tr><td><code>SIGNAL</code></td><td>-1</td><td>è¡¨ç¤ºåç»§èŠ‚ç‚¹éœ€è¦å½“å‰èŠ‚ç‚¹å”¤é†’ã€‚åœ¨å½“å‰çº¿ç¨‹èŠ‚ç‚¹é‡Šæ”¾é”ä¹‹åï¼Œéœ€è¦å¯¹åç»§èŠ‚ç‚¹è¿›è¡Œå”¤é†’ã€‚</td></tr><tr><td><code>CONDITION</code></td><td>-2</td><td>è¡¨ç¤ºèŠ‚ç‚¹åœ¨ç­‰å¾… Conditionã€‚å½“å…¶ä»–çº¿ç¨‹è°ƒç”¨äº† Condition çš„ <code>signal()</code> æ–¹æ³•åï¼ŒèŠ‚ç‚¹ä¼šä»ç­‰å¾…é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–èµ„æºã€‚</td></tr><tr><td><code>PROPAGATE</code></td><td>-3</td><td>ç”¨äºå…±äº«æ¨¡å¼ï¼Œåœ¨å…±äº«æ¨¡å¼ä¸‹ï¼Œå‰ç»§èŠ‚ç‚¹ä¸ä»…ä¼šå”¤é†’åç»§èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½ä¼šå”¤é†’åç»§èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚</td></tr><tr><td></td><td>0</td><td>åŠ å…¥é˜Ÿåˆ—çš„æ–°èŠ‚ç‚¹çš„åˆå§‹çŠ¶æ€ã€‚</td></tr></tbody></table><p>å¦‚æœ <code>waitStatus &gt; 0</code> ï¼Œè¡¨æ˜èŠ‚ç‚¹çš„çŠ¶æ€å·²ç»å–æ¶ˆç­‰å¾…è·å–èµ„æºã€‚</p><p>å¦‚æœ <code>waitStatus &lt; 0</code> ï¼Œè¡¨æ˜èŠ‚ç‚¹çš„å¤„äºæœ‰æ•ˆçš„ç­‰å¾…çŠ¶æ€ã€‚</p><p>å› æ­¤åœ¨ AQS çš„æºç ä¸­ï¼Œç»å¸¸ä½¿ç”¨ <code>&gt; 0</code> ã€ <code>&lt; 0</code> æ¥å¯¹ <code>waitStatus</code> è¿›è¡Œåˆ¤æ–­</p><h2 id="å›¾è§£-AQS-å·¥ä½œåŸç†"><a href="#å›¾è§£-AQS-å·¥ä½œåŸç†" class="headerlink" title="å›¾è§£ AQS å·¥ä½œåŸç†"></a>å›¾è§£ AQS å·¥ä½œåŸç†</h2><p>è‡³æ­¤ï¼ŒAQS ä¸­ä»¥ç‹¬å æ¨¡å¼è·å–èµ„æºã€é‡Šæ”¾èµ„æºçš„æºç å°±è®²å®Œäº†ã€‚ä¸ºäº†å¯¹ AQS çš„å·¥ä½œåŸç†ã€èŠ‚ç‚¹çŠ¶æ€å˜åŒ–æœ‰ä¸€ä¸ªæ›´åŠ æ¸…æ™°çš„è®¤è¯†ï¼Œæ¥ä¸‹æ¥ä¼šé€šè¿‡ç”»å›¾çš„æ–¹å¼æ¥äº†è§£æ•´ä¸ª AQS çš„å·¥ä½œåŸç†ã€‚</p><p>ç”±äº AQS æ˜¯åº•å±‚åŒæ­¥å·¥å…·ï¼Œè·å–å’Œé‡Šæ”¾èµ„æºçš„æ–¹æ³•å¹¶æ²¡æœ‰æä¾›å…·ä½“å®ç°ï¼Œå› æ­¤è¿™é‡ŒåŸºäº <code>ReentrantLock</code> æ¥ç”»å›¾è¿›è¡Œè®²è§£ã€‚</p><p>å‡è®¾æ€»å…±æœ‰ 3 ä¸ªçº¿ç¨‹å°è¯•è·å–é”ï¼Œçº¿ç¨‹åˆ†åˆ«ä¸º <code>T1</code> ã€ <code>T2</code> å’Œ <code>T3</code> ã€‚</p><p>æ­¤æ—¶ï¼Œå‡è®¾çº¿ç¨‹ <code>T1</code> å…ˆè·å–åˆ°é”ï¼Œçº¿ç¨‹ <code>T2</code> æ’é˜Ÿç­‰å¾…è·å–é”ã€‚åœ¨çº¿ç¨‹ <code>T2</code> è¿›å…¥é˜Ÿåˆ—ä¹‹å‰ï¼Œéœ€è¦å¯¹ AQS å†…éƒ¨é˜Ÿåˆ—è¿›è¡Œåˆå§‹åŒ–ã€‚<code>head</code> èŠ‚ç‚¹åœ¨åˆå§‹åŒ–åçŠ¶æ€ä¸º <code>0</code> ã€‚AQS å†…éƒ¨åˆå§‹åŒ–åçš„é˜Ÿåˆ—å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022159664.png" alt="img"></p><p>æ­¤æ—¶ï¼Œçº¿ç¨‹ <code>T2</code> å°è¯•è·å–é”ã€‚ç”±äºçº¿ç¨‹ <code>T1</code> æŒæœ‰é”ï¼Œå› æ­¤çº¿ç¨‹ <code>T2</code> ä¼šè¿›å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–é”ã€‚åŒæ—¶ä¼šå°†å‰ç»§èŠ‚ç‚¹ï¼ˆ <code>head</code> èŠ‚ç‚¹ï¼‰çš„çŠ¶æ€ç”± <code>0</code> æ›´æ–°ä¸º <code>SIGNAL</code> ï¼Œè¡¨ç¤ºéœ€è¦å¯¹ <code>head</code> èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹è¿›è¡Œå”¤é†’ã€‚æ­¤æ—¶ï¼ŒAQS å†…éƒ¨é˜Ÿåˆ—å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022200899.png" alt="img"></p><p>æ­¤æ—¶ï¼Œçº¿ç¨‹ <code>T3</code> å°è¯•è·å–é”ã€‚ç”±äºçº¿ç¨‹ <code>T1</code> æŒæœ‰é”ï¼Œå› æ­¤çº¿ç¨‹ <code>T3</code> ä¼šè¿›å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–é”ã€‚åŒæ—¶ä¼šå°†å‰ç»§èŠ‚ç‚¹ï¼ˆçº¿ç¨‹ <code>T2</code> èŠ‚ç‚¹ï¼‰çš„çŠ¶æ€ç”± <code>0</code> æ›´æ–°ä¸º <code>SIGNAL</code> ï¼Œè¡¨ç¤ºçº¿ç¨‹ <code>T2</code> èŠ‚ç‚¹éœ€è¦å¯¹åç»§èŠ‚ç‚¹è¿›è¡Œå”¤é†’ã€‚æ­¤æ—¶ï¼ŒAQS å†…éƒ¨é˜Ÿåˆ—å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022201209.png" alt="img"></p><p>æ­¤æ—¶ï¼Œå‡è®¾çº¿ç¨‹ <code>T1</code> é‡Šæ”¾é”ï¼Œä¼šå”¤é†’åç»§èŠ‚ç‚¹ <code>T2</code> ã€‚çº¿ç¨‹ <code>T2</code> è¢«å”¤é†’åè·å–åˆ°é”ï¼Œå¹¶ä¸”ä¼šä»ç­‰å¾…é˜Ÿåˆ—ä¸­é€€å‡ºã€‚</p><p>è¿™é‡Œçº¿ç¨‹ <code>T2</code> èŠ‚ç‚¹é€€å‡ºç­‰å¾…é˜Ÿåˆ—å¹¶ä¸æ˜¯ç›´æ¥ä»é˜Ÿåˆ—ç§»é™¤ï¼Œè€Œæ˜¯ä»¤çº¿ç¨‹ <code>T2</code> èŠ‚ç‚¹æˆä¸ºæ–°çš„ <code>head</code> èŠ‚ç‚¹ï¼Œä»¥æ­¤æ¥é€€å‡ºèµ„æºè·å–çš„ç­‰å¾…ã€‚æ­¤æ—¶ AQS å†…éƒ¨é˜Ÿåˆ—å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022201720.png" alt="img"></p><p>æ­¤æ—¶ï¼Œå‡è®¾çº¿ç¨‹ <code>T2</code> é‡Šæ”¾é”ï¼Œä¼šå”¤é†’åç»§èŠ‚ç‚¹ <code>T3</code> ã€‚çº¿ç¨‹ <code>T3</code> è·å–åˆ°é”ä¹‹åï¼ŒåŒæ ·ä¹Ÿé€€å‡ºç­‰å¾…é˜Ÿåˆ—ï¼Œå³å°†çº¿ç¨‹ <code>T3</code> èŠ‚ç‚¹å˜ä¸º <code>head</code> èŠ‚ç‚¹æ¥é€€å‡ºèµ„æºè·å–çš„ç­‰å¾…ã€‚æ­¤æ—¶ AQS å†…éƒ¨é˜Ÿåˆ—å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022202274.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> AQS </tag>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-22 é”</title>
      <link href="/2025/03/02/75-22%20%E9%94%81/"/>
      <url>/2025/03/02/75-22%20%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h1 id="75-22-é”"><a href="#75-22-é”" class="headerlink" title="75-22 é”"></a>75-22 é”</h1><h2 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h2><p>æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œè®¤ä¸ºå…±äº«èµ„æºæ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜(æ¯”å¦‚å…±äº«æ•°æ®è¢«ä¿®æ”¹)ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨è·å–èµ„æºæ“ä½œçš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æƒ³æ‹¿åˆ°è¿™ä¸ªèµ„æºå°±ä¼šé˜»å¡ç›´åˆ°é”è¢«ä¸Šä¸€ä¸ªæŒæœ‰è€…é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹</strong>ã€‚</p><p>åƒ Java ä¸­<code>synchronized</code>å’Œ<code>ReentrantLock</code>ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p><p>é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œæ¿€çƒˆçš„é”ç«äº‰ä¼šé€ æˆçº¿ç¨‹é˜»å¡ï¼Œå¤§é‡é˜»å¡çº¿ç¨‹ä¼šå¯¼è‡´ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¢åŠ ç³»ç»Ÿçš„æ€§èƒ½å¼€é”€ã€‚å¹¶ä¸”ï¼Œæ‚²è§‚é”è¿˜å¯èƒ½ä¼šå­˜åœ¨æ­»é”é—®é¢˜ï¼ˆçº¿ç¨‹è·å¾—é”çš„é¡ºåºä¸å½“æ—¶ï¼‰ï¼Œå½±å“ä»£ç çš„æ­£å¸¸è¿è¡Œã€‚</p><h2 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h2><p>ä¹è§‚é”æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œè®¤ä¸ºå…±äº«èµ„æºæ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œçº¿ç¨‹å¯ä»¥ä¸åœåœ°æ‰§è¡Œï¼Œæ— éœ€åŠ é”ä¹Ÿæ— éœ€ç­‰å¾…ï¼Œåªæ˜¯åœ¨æäº¤ä¿®æ”¹çš„æ—¶å€™å»éªŒè¯å¯¹åº”çš„èµ„æºï¼ˆä¹Ÿå°±æ˜¯æ•°æ®ï¼‰æ˜¯å¦è¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹äº†ï¼ˆå…·ä½“æ–¹æ³•å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æˆ– CAS ç®—æ³•ï¼‰ã€‚</p><p>é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œä¹è§‚é”ç›¸æ¯”æ‚²è§‚é”æ¥è¯´ï¼Œä¸å­˜åœ¨é”ç«äº‰é€ æˆçº¿ç¨‹é˜»å¡ï¼Œä¹Ÿä¸ä¼šæœ‰æ­»é”é—®é¢˜ï¼Œåœ¨æ€§èƒ½ä¸Šå¾€å¾€ä¼šæ›´èƒœä¸€ç­¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœå†²çªé¢‘ç¹å‘ç”Ÿï¼ˆå†™å æ¯”éå¸¸å¤šçš„æƒ…å†µï¼‰ï¼Œä¼šé¢‘ç¹å¤±è´¥å¹¶é‡è¯•ï¼Œè¿™æ ·åŒæ ·ä¼šéå¸¸å½±å“æ€§èƒ½ï¼Œå¯¼è‡´ CPU é£™å‡ã€‚</p><p>ç†è®ºä¸Šæ¥è¯´ï¼š</p><ul><li><strong>æ‚²è§‚é”</strong>é€šå¸¸å¤šç”¨äº<strong>å†™æ¯”è¾ƒå¤šçš„æƒ…å†µï¼ˆå¤šå†™åœºæ™¯ï¼Œç«äº‰æ¿€çƒˆï¼‰</strong>ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢‘ç¹å¤±è´¥å’Œé‡è¯•å½±å“æ€§èƒ½ï¼Œæ‚²è§‚é”çš„å¼€é”€æ˜¯å›ºå®šçš„ã€‚ä¸è¿‡ï¼Œå¦‚æœä¹è§‚é”è§£å†³äº†é¢‘ç¹å¤±è´¥å’Œé‡è¯•è¿™ä¸ªé—®é¢˜çš„è¯ï¼ˆæ¯”å¦‚<code>LongAdder</code>ï¼‰ï¼Œä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¹è§‚é”çš„ï¼Œè¦è§†å®é™…æƒ…å†µè€Œå®šã€‚</li><li><strong>ä¹è§‚é”</strong>é€šå¸¸å¤šç”¨äº<strong>å†™æ¯”è¾ƒå°‘çš„æƒ…å†µï¼ˆå¤šè¯»åœºæ™¯ï¼Œç«äº‰è¾ƒå°‘ï¼‰</strong>ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢‘ç¹åŠ é”å½±å“æ€§èƒ½ã€‚ä¸è¿‡ï¼Œä¹è§‚é”ä¸»è¦é’ˆå¯¹çš„å¯¹è±¡æ˜¯å•ä¸ªå…±äº«å˜é‡ï¼ˆå‚è€ƒ<code>java.util.concurrent.atomic</code>åŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»ï¼‰ã€‚</li></ul><h3 id="å¦‚ä½•å®ç°ä¹è§‚é”"><a href="#å¦‚ä½•å®ç°ä¹è§‚é”" class="headerlink" title="å¦‚ä½•å®ç°ä¹è§‚é”"></a>å¦‚ä½•å®ç°ä¹è§‚é”</h3><h4 id="ç‰ˆæœ¬å·æœºåˆ¶"><a href="#ç‰ˆæœ¬å·æœºåˆ¶" class="headerlink" title="ç‰ˆæœ¬å·æœºåˆ¶"></a>ç‰ˆæœ¬å·æœºåˆ¶</h4><p>ä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å· <code>version</code> å­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œ<code>version</code> å€¼ä¼šåŠ ä¸€ã€‚å½“çº¿ç¨‹ A è¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å– <code>version</code> å€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„ version å€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„ <code>version</code> å€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p><p><strong>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­</strong>ï¼šå‡è®¾æ•°æ®åº“ä¸­å¸æˆ·ä¿¡æ¯è¡¨ä¸­æœ‰ä¸€ä¸ª version å­—æ®µï¼Œå½“å‰å€¼ä¸º 1 ï¼›è€Œå½“å‰å¸æˆ·ä½™é¢å­—æ®µï¼ˆ <code>balance</code> ï¼‰ä¸º $100 ã€‚</p><ol><li>æ“ä½œå‘˜ A æ­¤æ—¶å°†å…¶è¯»å‡ºï¼ˆ <code>version</code>&#x3D;1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ $50ï¼ˆ $100-$50 ï¼‰ã€‚</li><li>åœ¨æ“ä½œå‘˜ A æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæ“ä½œå‘˜ B ä¹Ÿè¯»å…¥æ­¤ç”¨æˆ·ä¿¡æ¯ï¼ˆ <code>version</code>&#x3D;1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ $20 ï¼ˆ $100-$20 ï¼‰ã€‚</li><li>æ“ä½œå‘˜ A å®Œæˆäº†ä¿®æ”¹å·¥ä½œï¼Œå°†æ•°æ®ç‰ˆæœ¬å·ï¼ˆ <code>version</code>&#x3D;1 ï¼‰ï¼Œè¿åŒå¸æˆ·æ‰£é™¤åä½™é¢ï¼ˆ <code>balance</code>&#x3D;$50 ï¼‰ï¼Œæäº¤è‡³æ•°æ®åº“æ›´æ–°ï¼Œæ­¤æ—¶ç”±äºæäº¤æ•°æ®ç‰ˆæœ¬ç­‰äºæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ï¼Œæ•°æ®è¢«æ›´æ–°ï¼Œæ•°æ®åº“è®°å½• <code>version</code> æ›´æ–°ä¸º 2 ã€‚</li><li>æ“ä½œå‘˜ B å®Œæˆäº†æ“ä½œï¼Œä¹Ÿå°†ç‰ˆæœ¬å·ï¼ˆ <code>version</code>&#x3D;1 ï¼‰è¯•å›¾å‘æ•°æ®åº“æäº¤æ•°æ®ï¼ˆ <code>balance</code>&#x3D;$80 ï¼‰ï¼Œä½†æ­¤æ—¶æ¯”å¯¹æ•°æ®åº“è®°å½•ç‰ˆæœ¬æ—¶å‘ç°ï¼Œæ“ä½œå‘˜ B æäº¤çš„æ•°æ®ç‰ˆæœ¬å·ä¸º 1 ï¼Œæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ä¹Ÿä¸º 2 ï¼Œä¸æ»¡è¶³ â€œ æäº¤ç‰ˆæœ¬å¿…é¡»ç­‰äºå½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–° â€œ çš„ä¹è§‚é”ç­–ç•¥ï¼Œå› æ­¤ï¼Œæ“ä½œå‘˜ B çš„æäº¤è¢«é©³å›ã€‚</li></ol><p>è¿™æ ·å°±é¿å…äº†æ“ä½œå‘˜ B ç”¨åŸºäº <code>version</code>&#x3D;1 çš„æ—§æ•°æ®ä¿®æ”¹çš„ç»“æœè¦†ç›–æ“ä½œå‘˜ A çš„æ“ä½œç»“æœçš„å¯èƒ½ã€‚</p><h4 id="CAS-ç®—æ³•å®ç°ä¹è§‚é”"><a href="#CAS-ç®—æ³•å®ç°ä¹è§‚é”" class="headerlink" title="CAS ç®—æ³•å®ç°ä¹è§‚é”"></a>CAS ç®—æ³•å®ç°ä¹è§‚é”</h4><p>CAS çš„å…¨ç§°æ˜¯ <strong>Compare And Swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰</strong> ï¼Œç”¨äºå®ç°ä¹è§‚é”ï¼Œè¢«å¹¿æ³›åº”ç”¨äºå„å¤§æ¡†æ¶ä¸­ã€‚CAS çš„æ€æƒ³å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªé¢„æœŸå€¼å’Œè¦æ›´æ–°çš„å˜é‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¸¤å€¼ç›¸ç­‰æ‰ä¼šè¿›è¡Œæ›´æ–°ã€‚</p><p>CAS æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œåº•å±‚ä¾èµ–äºä¸€æ¡ CPU çš„åŸå­æŒ‡ä»¤ã€‚</p><blockquote><p><strong>åŸå­æ“ä½œ</strong> å³æœ€å°ä¸å¯æ‹†åˆ†çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸èƒ½è¢«æ‰“æ–­ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚</p></blockquote><p>CAS æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°ï¼š</p><ul><li><strong>V</strong>ï¼šè¦æ›´æ–°çš„å˜é‡å€¼(Var)</li><li><strong>E</strong>ï¼šé¢„æœŸå€¼(Expected)</li><li><strong>N</strong>ï¼šæ‹Ÿå†™å…¥çš„æ–°å€¼(New)</li></ul><p>å½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº E æ—¶ï¼ŒCAS é€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼ N æ¥æ›´æ–° V çš„å€¼ã€‚å¦‚æœä¸ç­‰ï¼Œè¯´æ˜å·²ç»æœ‰å…¶å®ƒçº¿ç¨‹æ›´æ–°äº† Vï¼Œåˆ™å½“å‰çº¿ç¨‹æ”¾å¼ƒæ›´æ–°ã€‚</p><p><strong>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­</strong>ï¼šçº¿ç¨‹ A è¦ä¿®æ”¹å˜é‡ i çš„å€¼ä¸º 6ï¼Œi åŸå€¼ä¸º 1ï¼ˆV &#x3D; 1ï¼ŒE&#x3D;1ï¼ŒN&#x3D;6ï¼Œå‡è®¾ä¸å­˜åœ¨ ABA é—®é¢˜ï¼‰ã€‚</p><ol><li>i ä¸ 1 è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œ åˆ™è¯´æ˜æ²¡è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œå¯ä»¥è¢«è®¾ç½®ä¸º 6 ã€‚</li><li>i ä¸ 1 è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¯´æ˜è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œå½“å‰çº¿ç¨‹æ”¾å¼ƒæ›´æ–°ï¼ŒCAS æ“ä½œå¤±è´¥ã€‚</li></ol><p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨ CAS æ“ä½œä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰ä¸€ä¸ªä¼šèƒœå‡ºï¼Œå¹¶æˆåŠŸæ›´æ–°ï¼Œå…¶ä½™å‡ä¼šå¤±è´¥ï¼Œä½†å¤±è´¥çš„çº¿ç¨‹å¹¶ä¸ä¼šè¢«æŒ‚èµ·ï¼Œä»…æ˜¯è¢«å‘ŠçŸ¥å¤±è´¥ï¼Œå¹¶ä¸”å…è®¸å†æ¬¡å°è¯•ï¼Œå½“ç„¶ä¹Ÿå…è®¸å¤±è´¥çš„çº¿ç¨‹æ”¾å¼ƒæ“ä½œã€‚</p><h2 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h2><p>åœ¨ Java ä¸­ï¼Œå®ç° CASï¼ˆCompare-And-Swap, æ¯”è¾ƒå¹¶äº¤æ¢ï¼‰æ“ä½œçš„ä¸€ä¸ªå…³é”®ç±»æ˜¯<code>Unsafe</code>ã€‚</p><p><code>Unsafe</code>ç±»ä½äº<code>sun.misc</code>åŒ…ä¸‹ï¼Œæ˜¯ä¸€ä¸ªæä¾›ä½çº§åˆ«ã€ä¸å®‰å…¨æ“ä½œçš„ç±»ã€‚ç”±äºå…¶å¼ºå¤§çš„åŠŸèƒ½å’Œæ½œåœ¨çš„å±é™©æ€§ï¼Œå®ƒé€šå¸¸ç”¨äº JVM å†…éƒ¨æˆ–ä¸€äº›éœ€è¦æé«˜æ€§èƒ½å’Œåº•å±‚è®¿é—®çš„åº“ä¸­ï¼Œè€Œä¸æ¨èæ™®é€šå¼€å‘è€…åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚å…³äº <code>Unsafe</code>ç±»çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼šğŸ“Œ<a href="https://javaguide.cn/java/basis/unsafe.html">Java é­”æ³•ç±» Unsafe è¯¦è§£</a>ã€‚</p><p><code>sun.misc</code>åŒ…ä¸‹çš„<code>Unsafe</code>ç±»æä¾›äº†<code>compareAndSwapObject</code>ã€<code>compareAndSwapInt</code>ã€<code>compareAndSwapLong</code>æ–¹æ³•æ¥å®ç°çš„å¯¹<code>Object</code>ã€<code>int</code>ã€<code>long</code>ç±»å‹çš„ CAS æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»¥åŸå­æ–¹å¼æ›´æ–°å¯¹è±¡å­—æ®µçš„å€¼ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> o        è¦æ“ä½œçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> offset   å¯¹è±¡å­—æ®µçš„å†…å­˜åç§»é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> expected æœŸæœ›çš„æ—§å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x        è¦è®¾ç½®çš„æ–°å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å¦‚æœå€¼è¢«æˆåŠŸæ›´æ–°ï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">compareAndSwapObject</span><span class="params">(Object o, <span class="type">long</span> offset, Object expected, Object x)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»¥åŸå­æ–¹å¼æ›´æ–° int ç±»å‹çš„å¯¹è±¡å­—æ®µçš„å€¼ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">compareAndSwapInt</span><span class="params">(Object o, <span class="type">long</span> offset, <span class="type">int</span> expected, <span class="type">int</span> x)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»¥åŸå­æ–¹å¼æ›´æ–° long ç±»å‹çš„å¯¹è±¡å­—æ®µçš„å€¼ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">compareAndSwapLong</span><span class="params">(Object o, <span class="type">long</span> offset, <span class="type">long</span> expected, <span class="type">long</span> x)</span>;</span><br></pre></td></tr></table></figure><p><code>Unsafe</code>ç±»ä¸­çš„ CAS æ–¹æ³•æ˜¯<code>native</code>æ–¹æ³•ã€‚<code>native</code>å…³é”®å­—è¡¨æ˜è¿™äº›æ–¹æ³•æ˜¯ç”¨æœ¬åœ°ä»£ç ï¼ˆé€šå¸¸æ˜¯ C æˆ– C++ï¼‰å®ç°çš„ï¼Œè€Œä¸æ˜¯ç”¨ Java å®ç°çš„ã€‚è¿™äº›æ–¹æ³•ç›´æ¥è°ƒç”¨åº•å±‚çš„ç¡¬ä»¶æŒ‡ä»¤æ¥å®ç°åŸå­æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒJava è¯­è¨€å¹¶æ²¡æœ‰ç›´æ¥ç”¨ Java å®ç° CASã€‚</p><p>æ›´å‡†ç¡®ç‚¹æ¥è¯´ï¼ŒJava ä¸­ CAS æ˜¯ C++ å†…è”æ±‡ç¼–çš„å½¢å¼å®ç°çš„ï¼Œé€šè¿‡ JNIï¼ˆJava Native Interfaceï¼‰ è°ƒç”¨ã€‚å› æ­¤ï¼ŒCAS çš„å…·ä½“å®ç°ä¸æ“ä½œç³»ç»Ÿä»¥åŠ CPU å¯†åˆ‡ç›¸å…³ã€‚</p><p>ç”±äº CAS æ“ä½œå¯èƒ½ä¼šå› ä¸ºå¹¶å‘å†²çªè€Œå¤±è´¥ï¼Œå› æ­¤é€šå¸¸ä¼šä¸<code>while</code>å¾ªç¯æ­é…ä½¿ç”¨ï¼Œåœ¨å¤±è´¥åä¸æ–­é‡è¯•ï¼Œç›´åˆ°æ“ä½œæˆåŠŸã€‚è¿™å°±æ˜¯ <strong>è‡ªæ—‹é”æœºåˆ¶</strong> ã€‚</p><h3 id="CAS-ç®—æ³•å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ"><a href="#CAS-ç®—æ³•å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ" class="headerlink" title="CAS ç®—æ³•å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ"></a>CAS ç®—æ³•å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ</h3><h4 id="ABA-é—®é¢˜"><a href="#ABA-é—®é¢˜" class="headerlink" title="ABA é—®é¢˜"></a>ABA é—®é¢˜</h4><p>å¦‚æœä¸€ä¸ªå˜é‡ V åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯ A å€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å› Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸º CAS æ“ä½œçš„ <strong>â€œABAâ€é—®é¢˜ã€‚</strong></p><p>ABA é—®é¢˜çš„è§£å†³æ€è·¯æ˜¯åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Š<strong>ç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³</strong>ã€‚JDK 1.5 ä»¥åçš„ <code>AtomicStampedReference</code> ç±»å°±æ˜¯ç”¨æ¥è§£å†³ ABA é—®é¢˜çš„ï¼Œå…¶ä¸­çš„ <code>compareAndSet()</code> æ–¹æ³•å°±æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚</p><h4 id="å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§"><a href="#å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§" class="headerlink" title="å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§"></a>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</h4><p>CAS ç»å¸¸ä¼šç”¨åˆ°è‡ªæ—‹æ“ä½œæ¥è¿›è¡Œé‡è¯•ï¼Œä¹Ÿå°±æ˜¯ä¸æˆåŠŸå°±ä¸€ç›´å¾ªç¯æ‰§è¡Œç›´åˆ°æˆåŠŸã€‚å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™ CPU å¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</p><p>å¦‚æœ JVM èƒ½å¤Ÿæ”¯æŒå¤„ç†å™¨æä¾›çš„<code>pause</code>æŒ‡ä»¤ï¼Œé‚£ä¹ˆè‡ªæ—‹æ“ä½œçš„æ•ˆç‡å°†æœ‰æ‰€æå‡ã€‚<code>pause</code>æŒ‡ä»¤æœ‰ä¸¤ä¸ªé‡è¦ä½œç”¨ï¼š</p><ol><li><strong>å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤</strong>ï¼š<code>pause</code>æŒ‡ä»¤å¯ä»¥å»¶è¿ŸæŒ‡ä»¤çš„æ‰§è¡Œï¼Œä»è€Œå‡å°‘ CPU çš„èµ„æºæ¶ˆè€—ã€‚å…·ä½“çš„å»¶è¿Ÿæ—¶é—´å–å†³äºå¤„ç†å™¨çš„å®ç°ç‰ˆæœ¬ï¼Œåœ¨æŸäº›å¤„ç†å™¨ä¸Šï¼Œå»¶è¿Ÿæ—¶é—´å¯èƒ½ä¸ºé›¶ã€‚</li><li><strong>é¿å…å†…å­˜é¡ºåºå†²çª</strong>ï¼šåœ¨é€€å‡ºå¾ªç¯æ—¶ï¼Œ<code>pause</code>æŒ‡ä»¤å¯ä»¥é¿å…ç”±äºå†…å­˜é¡ºåºå†²çªè€Œå¯¼è‡´çš„ CPU æµæ°´çº¿è¢«æ¸…ç©ºï¼Œä»è€Œæé«˜ CPU çš„æ‰§è¡Œæ•ˆç‡ã€‚</li></ol><h4 id="åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸ"><a href="#åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸ" class="headerlink" title="åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸ"></a>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸ</h4><p>CAS æ“ä½œä»…èƒ½å¯¹å•ä¸ªå…±äº«å˜é‡æœ‰æ•ˆã€‚å½“éœ€è¦æ“ä½œå¤šä¸ªå…±äº«å˜é‡æ—¶ï¼ŒCAS å°±æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ã€‚ä¸è¿‡ï¼Œä» JDK 1.5 å¼€å§‹ï¼ŒJava æä¾›äº†<code>AtomicReference</code>ç±»ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ã€‚é€šè¿‡å°†å¤šä¸ªå˜é‡å°è£…åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>AtomicReference</code>æ¥æ‰§è¡Œ CAS æ“ä½œã€‚</p><p>é™¤äº† <code>AtomicReference</code> è¿™ç§æ–¹å¼ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨åŠ é”æ¥ä¿è¯ã€‚</p><h2 id="æ— é”-VS-åå‘é”-VS-è½»é‡çº§é”-VS-é‡é‡çº§é”"><a href="#æ— é”-VS-åå‘é”-VS-è½»é‡çº§é”-VS-é‡é‡çº§é”" class="headerlink" title="æ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”"></a><strong>æ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”</strong></h2><p>è¿™å››ç§é”æ˜¯æŒ‡é”çš„çŠ¶æ€ï¼Œä¸“é—¨é’ˆå¯¹synchronizedçš„ã€‚åœ¨ä»‹ç»è¿™å››ç§é”çŠ¶æ€ä¹‹å‰è¿˜éœ€è¦ä»‹ç»ä¸€äº›é¢å¤–çš„çŸ¥è¯†ã€‚</p><p>é¦–å…ˆä¸ºä»€ä¹ˆSynchronizedèƒ½å®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ</p><p>åœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼šâ€œJavaå¯¹è±¡å¤´â€ã€â€œMonitorâ€ã€‚</p><h3 id="Javaå¯¹è±¡å¤´"><a href="#Javaå¯¹è±¡å¤´" class="headerlink" title="Javaå¯¹è±¡å¤´"></a>Javaå¯¹è±¡å¤´</h3><p>synchronizedæ˜¯æ‚²è§‚é”ï¼Œåœ¨æ“ä½œåŒæ­¥èµ„æºä¹‹å‰éœ€è¦ç»™åŒæ­¥èµ„æºå…ˆåŠ é”ï¼Œè¿™æŠŠé”å°±æ˜¯å­˜åœ¨Javaå¯¹è±¡å¤´é‡Œçš„ï¼Œè€ŒJavaå¯¹è±¡å¤´åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä»¥Hotspotè™šæ‹Ÿæœºä¸ºä¾‹ï¼ŒHotspotçš„å¯¹è±¡å¤´ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†æ•°æ®ï¼šMark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰ã€Klass Pointerï¼ˆç±»å‹æŒ‡é’ˆï¼‰ã€‚</p><p><strong>Mark Word</strong>ï¼šé»˜è®¤å­˜å‚¨å¯¹è±¡çš„HashCodeï¼Œåˆ†ä»£å¹´é¾„å’Œé”æ ‡å¿—ä½ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰æ— å…³çš„æ•°æ®ï¼Œæ‰€ä»¥Mark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ã€‚å®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡ŒæœŸé—´Mark Wordé‡Œå­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ–ã€‚</p><p><strong>Klass Point</strong>ï¼šå¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚</p><h3 id="Monitor"><a href="#Monitor" class="headerlink" title="Monitor"></a>Monitor</h3><p>Monitorå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŒæ­¥å·¥å…·æˆ–ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œé€šå¸¸è¢«æè¿°ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚æ¯ä¸€ä¸ªJavaå¯¹è±¡å°±æœ‰ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œç§°ä¸ºå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚</p><p>Monitoræ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨monitor recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ã€‚æ¯ä¸€ä¸ªè¢«é”ä½çš„å¯¹è±¡éƒ½ä¼šå’Œä¸€ä¸ªmonitorå…³è”ï¼ŒåŒæ—¶monitorä¸­æœ‰ä¸€ä¸ªOwnerå­—æ®µå­˜æ”¾æ‹¥æœ‰è¯¥é”çš„çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥é”è¢«è¿™ä¸ªçº¿ç¨‹å ç”¨ã€‚</p><p>ç°åœ¨è¯é¢˜å›åˆ°synchronizedï¼Œsynchronizedé€šè¿‡Monitoræ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼ŒMonitoræ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockï¼ˆäº’æ–¥é”ï¼‰æ¥å®ç°çš„çº¿ç¨‹åŒæ­¥ã€‚</p><p>å¦‚åŒæˆ‘ä»¬åœ¨è‡ªæ—‹é”ä¸­æåˆ°çš„â€œé˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿â€ã€‚è¿™ç§æ–¹å¼å°±æ˜¯synchronizedæœ€åˆå®ç°åŒæ­¥çš„æ–¹å¼ï¼Œè¿™å°±æ˜¯JDK 6ä¹‹å‰synchronizedæ•ˆç‡ä½çš„åŸå› ã€‚è¿™ç§ä¾èµ–äºæ“ä½œç³»ç»ŸMutex Lockæ‰€å®ç°çš„é”æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œé‡é‡çº§é”â€ï¼ŒJDK 6ä¸­ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ã€‚</p><p><strong>æ‰€ä»¥ç›®å‰é”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”çŠ¶æ€åªèƒ½å‡çº§ä¸èƒ½é™çº§ã€‚</strong></p><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯¹synchronizedçš„åŠ é”æœºåˆ¶ä»¥åŠç›¸å…³çŸ¥è¯†æœ‰äº†ä¸€ä¸ªäº†è§£ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬ç»™å‡ºå››ç§é”çŠ¶æ€å¯¹åº”çš„çš„Mark Wordå†…å®¹ï¼Œç„¶åå†åˆ†åˆ«è®²è§£å››ç§é”çŠ¶æ€çš„æ€è·¯ä»¥åŠç‰¹ç‚¹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022215775.webp" alt="å›¾ç‰‡"></p><h3 id="æ— é”"><a href="#æ— é”" class="headerlink" title="æ— é”"></a><strong>æ— é”</strong></h3><p>æ— é”æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚</p><p>æ— é”çš„ç‰¹ç‚¹å°±æ˜¯ä¿®æ”¹æ“ä½œåœ¨å¾ªç¯å†…è¿›è¡Œï¼Œçº¿ç¨‹ä¼šä¸æ–­çš„å°è¯•ä¿®æ”¹å…±äº«èµ„æºã€‚å¦‚æœæ²¡æœ‰å†²çªå°±ä¿®æ”¹æˆåŠŸå¹¶é€€å‡ºï¼Œå¦åˆ™å°±ä¼šç»§ç»­å¾ªç¯å°è¯•ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œå¿…å®šä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸï¼Œè€Œå…¶ä»–ä¿®æ”¹å¤±è´¥çš„çº¿ç¨‹ä¼šä¸æ–­é‡è¯•ç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„<strong>CASåŸç†åŠåº”ç”¨å³æ˜¯æ— é”çš„å®ç°</strong>ã€‚æ— é”æ— æ³•å…¨é¢ä»£æ›¿æœ‰é”ï¼Œä½†æ— é”åœ¨æŸäº›åœºåˆä¸‹çš„æ€§èƒ½æ˜¯éå¸¸é«˜çš„ã€‚</p><p><strong>åœºæ™¯</strong>ï¼š</p><ul><li>åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®èµ„æºï¼Œä¸éœ€è¦åŠ é”ã€‚</li></ul><h3 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h3><p><strong>æ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>å½“ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡è·å–é”åï¼ŒJVM è®©å®ƒâ€œåå‘â€è¿™ä¸ªçº¿ç¨‹</strong>ï¼Œä¸‹æ¬¡è¿™ä¸ªçº¿ç¨‹å†æ¥ï¼Œå°±ä¸ç”¨é‡æ–°åŠ é”ã€‚</li><li><strong>å¦‚æœæ²¡æœ‰å…¶å®ƒçº¿ç¨‹ç«äº‰ï¼Œé”ä¸ä¼šå‡çº§</strong>ï¼Œæé«˜æ€§èƒ½ã€‚</li></ul><p>ğŸ”¹ <strong>åœºæ™¯</strong>ï¼š</p><ul><li><strong>çº¿ç¨‹å‡ ä¹ä¸ä¼šç«äº‰</strong>ï¼Œæ¯”å¦‚ <strong>ä¸€ä¸ªçº¿ç¨‹ä¸æ–­è°ƒç”¨ä¸€ä¸ªåŒæ­¥æ–¹æ³•</strong>ã€‚</li></ul><p>å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨Mark Wordé‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDã€‚åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡CASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œ<strong>è€Œæ˜¯æ£€æµ‹Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”</strong>ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨<strong>æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„</strong>ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤å³å¯ã€‚</p><p>åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚æ’¤é”€åå‘é”åæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚</p><h3 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a><strong>è½»é‡çº§é”</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>å¦‚æœå¤šä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç ï¼Œä½†æ²¡æœ‰çœŸæ­£çš„é”ç«äº‰</strong>ï¼ŒJVM <strong>ä½¿ç”¨ CASï¼ˆæ— é”æ“ä½œï¼‰å°è¯•åŠ é”</strong>ï¼Œè€Œä¸æ˜¯è¿›å…¥é‡é‡çº§é”ã€‚</li></ul><p>ğŸ”¹ <strong>åœºæ™¯</strong>ï¼š</p><ul><li><strong>å¤šä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç </strong>ï¼Œä½†ä¸ä¼šå‘ç”Ÿ<strong>çœŸæ­£çš„ç«äº‰ï¼ˆçº¿ç¨‹æ‰§è¡Œæ—¶é—´é”™å¼€ï¼‰</strong>ã€‚</li></ul><p>æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p><p>åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œç„¶åæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚</p><p>æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚</p><p>å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚</p><p>å¦‚æœè½»é‡çº§é”çš„æ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ã€‚</p><p>è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p><h3 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="é‡é‡çº§é”"></a><strong>é‡é‡çº§é”</strong></h3><p>å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼Œæ­¤æ—¶Mark Wordä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œæ­¤æ—¶ç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><p>æ•´ä½“çš„é”çŠ¶æ€å‡çº§æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022255978.webp" alt="å›¾ç‰‡"></p><p>ç»¼ä¸Šï¼Œåå‘é”é€šè¿‡å¯¹æ¯”Mark Wordè§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…æ‰§è¡ŒCASæ“ä½œã€‚è€Œè½»é‡çº§é”æ˜¯é€šè¿‡ç”¨CASæ“ä½œå’Œè‡ªæ—‹æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’è€Œå½±å“æ€§èƒ½ã€‚é‡é‡çº§é”æ˜¯å°†é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚</p><h2 id="å…¬å¹³é”-VS-éå…¬å¹³é”"><a href="#å…¬å¹³é”-VS-éå…¬å¹³é”" class="headerlink" title="å…¬å¹³é” VS éå…¬å¹³é”"></a><strong>å…¬å¹³é” VS éå…¬å¹³é”</strong></h2><p>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”ã€‚å…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯ç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ã€‚ç¼ºç‚¹æ˜¯æ•´ä½“ååæ•ˆç‡ç›¸å¯¹éå…¬å¹³é”è¦ä½ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­é™¤ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼ŒCPUå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§ã€‚</p><p>éå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚ä½†å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”ï¼Œæ‰€ä»¥éå…¬å¹³é”æœ‰å¯èƒ½å‡ºç°åç”³è¯·é”çš„çº¿ç¨‹å…ˆè·å–é”çš„åœºæ™¯ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPUä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚ç¼ºç‚¹æ˜¯å¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”ã€‚</p><p>ç›´æ¥ç”¨è¯­è¨€æè¿°å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œè¿™é‡Œä½œè€…ç”¨ä»åˆ«å¤„çœ‹åˆ°çš„ä¸€ä¸ªä¾‹å­æ¥è®²è¿°ä¸€ä¸‹å…¬å¹³é”å’Œéå…¬å¹³é”ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022301942.webp" alt="å›¾ç‰‡"></p><h2 id="å¯é‡å…¥é”-VS-éå¯é‡å…¥é”"><a href="#å¯é‡å…¥é”-VS-éå¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é” VS éå¯é‡å…¥é”"></a><strong>å¯é‡å…¥é” VS éå¯é‡å…¥é”</strong></h2><p>å¯é‡å…¥é”åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ï¼ˆå‰æé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚Javaä¸­ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡å…¥é”ï¼Œå¯é‡å…¥é”çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚ä¸‹é¢ç”¨ç¤ºä¾‹ä»£ç æ¥è¿›è¡Œåˆ†æï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022303140.webp" alt="å›¾ç‰‡"></p><p>é¦–å…ˆReentrantLockå’ŒNonReentrantLockéƒ½ç»§æ‰¿çˆ¶ç±»AQSï¼Œå…¶çˆ¶ç±»AQSä¸­ç»´æŠ¤äº†ä¸€ä¸ªåŒæ­¥çŠ¶æ€statusæ¥è®¡æ•°é‡å…¥æ¬¡æ•°ï¼Œstatusåˆå§‹å€¼ä¸º0ã€‚</p><p>å½“çº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¯é‡å…¥é”å…ˆå°è¯•è·å–å¹¶æ›´æ–°statuså€¼ï¼Œå¦‚æœstatus &#x3D;&#x3D; 0è¡¨ç¤ºæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œåˆ™æŠŠstatusç½®ä¸º1ï¼Œå½“å‰çº¿ç¨‹å¼€å§‹æ‰§è¡Œã€‚å¦‚æœstatus !&#x3D; 0ï¼Œåˆ™åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯è·å–åˆ°è¿™ä¸ªé”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯çš„è¯æ‰§è¡Œstatus+1ï¼Œä¸”å½“å‰çº¿ç¨‹å¯ä»¥å†æ¬¡è·å–é”ã€‚è€Œéå¯é‡å…¥é”æ˜¯ç›´æ¥å»è·å–å¹¶å°è¯•æ›´æ–°å½“å‰statusçš„å€¼ï¼Œå¦‚æœstatus !&#x3D; 0çš„è¯ä¼šå¯¼è‡´å…¶è·å–é”å¤±è´¥ï¼Œå½“å‰çº¿ç¨‹é˜»å¡ã€‚</p><p>é‡Šæ”¾é”æ—¶ï¼Œå¯é‡å…¥é”åŒæ ·å…ˆè·å–å½“å‰statusçš„å€¼ï¼Œåœ¨å½“å‰çº¿ç¨‹æ˜¯æŒæœ‰é”çš„çº¿ç¨‹çš„å‰æä¸‹ã€‚å¦‚æœstatus-1 &#x3D;&#x3D; 0ï¼Œåˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹æ‰€æœ‰é‡å¤è·å–é”çš„æ“ä½œéƒ½å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åè¯¥çº¿ç¨‹æ‰ä¼šçœŸæ­£é‡Šæ”¾é”ã€‚è€Œéå¯é‡å…¥é”åˆ™æ˜¯åœ¨ç¡®å®šå½“å‰çº¿ç¨‹æ˜¯æŒæœ‰é”çš„çº¿ç¨‹ä¹‹åï¼Œç›´æ¥å°†statusç½®ä¸º0ï¼Œå°†é”é‡Šæ”¾ã€‚</p><h2 id="ç‹¬äº«é”-VS-å…±äº«é”"><a href="#ç‹¬äº«é”-VS-å…±äº«é”" class="headerlink" title="ç‹¬äº«é” VS å…±äº«é”"></a><strong>ç‹¬äº«é” VS å…±äº«é”</strong></h2><p><strong>å…±äº«é”ã€Sé”ã€‘</strong><br>åˆç§°è¯»é”ï¼Œè‹¥äº‹åŠ¡Tå¯¹æ•°æ®å¯¹è±¡AåŠ ä¸ŠSé”ï¼Œåˆ™äº‹åŠ¡Tå¯ä»¥è¯»Aä½†ä¸èƒ½ä¿®æ”¹Aï¼Œå…¶ä»–äº‹åŠ¡åªèƒ½å†å¯¹AåŠ Sé”ï¼Œè€Œä¸èƒ½åŠ Xé”ï¼Œç›´åˆ°Té‡Šæ”¾Aä¸Šçš„Sé”ã€‚è¿™ä¿è¯äº†å…¶ä»–äº‹åŠ¡å¯ä»¥è¯»Aï¼Œä½†åœ¨Té‡Šæ”¾Aä¸Šçš„Sé”ä¹‹å‰ä¸èƒ½å¯¹Aåšä»»ä½•ä¿®æ”¹ã€‚</p><p><strong>æ’ä»–é”ï¼ˆç‹¬äº«é”ï¼‰ã€Xé”ã€‘</strong><br>åˆç§°å†™é”ã€‚è‹¥äº‹åŠ¡Tå¯¹æ•°æ®å¯¹è±¡AåŠ ä¸ŠXé”ï¼Œäº‹åŠ¡Tå¯ä»¥è¯»Aä¹Ÿå¯ä»¥ä¿®æ”¹Aï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹AåŠ ä»»ä½•é”ï¼Œç›´åˆ°Té‡Šæ”¾Aä¸Šçš„é”ã€‚è¿™ä¿è¯äº†å…¶ä»–äº‹åŠ¡åœ¨Té‡Šæ”¾Aä¸Šçš„é”ä¹‹å‰ä¸èƒ½å†è¯»å–å’Œä¿®æ”¹Aã€‚</p><p>ç‹¬äº«é”å’Œå…±äº«é”åŒæ ·æ˜¯ä¸€ç§æ¦‚å¿µã€‚æˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹å…·ä½“çš„æ¦‚å¿µï¼Œç„¶åé€šè¿‡ReentrantLockå’ŒReentrantReadWriteLockçš„æºç æ¥ä»‹ç»ç‹¬äº«é”å’Œå…±äº«é”ã€‚</p><p>ç‹¬äº«é”ä¹Ÿå«æ’ä»–é”ï¼Œæ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šæ’å®ƒé”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹ä¸èƒ½å†å¯¹AåŠ ä»»ä½•ç±»å‹çš„é”ã€‚è·å¾—æ’å®ƒé”çš„çº¿ç¨‹å³èƒ½è¯»æ•°æ®åˆèƒ½ä¿®æ”¹æ•°æ®ã€‚JDKä¸­çš„synchronizedå’ŒJUCä¸­Lockçš„å®ç°ç±»å°±æ˜¯äº’æ–¥é”ã€‚</p><p>å…±äº«é”æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹åªèƒ½å¯¹Aå†åŠ å…±äº«é”ï¼Œä¸èƒ½åŠ æ’å®ƒé”ã€‚è·å¾—å…±äº«é”çš„çº¿ç¨‹åªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚</p><p>ç‹¬äº«é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®ç°ç‹¬äº«æˆ–è€…å…±äº«ã€‚</p><p>ä¸‹å›¾ä¸ºReentrantReadWriteLockçš„éƒ¨åˆ†æºç ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503022306517.webp" alt="å›¾ç‰‡"></p><p>æˆ‘ä»¬çœ‹åˆ°ReentrantReadWriteLockæœ‰ä¸¤æŠŠé”ï¼šReadLockå’ŒWriteLockï¼Œç”±è¯çŸ¥æ„ï¼Œä¸€ä¸ªè¯»é”ä¸€ä¸ªå†™é”ï¼Œåˆç§°â€œè¯»å†™é”â€ã€‚å†è¿›ä¸€æ­¥è§‚å¯Ÿå¯ä»¥å‘ç°ReadLockå’ŒWriteLockæ˜¯é å†…éƒ¨ç±»Syncå®ç°çš„é”ã€‚Syncæ˜¯AQSçš„ä¸€ä¸ªå­ç±»ï¼Œè¿™ç§ç»“æ„åœ¨CountDownLatchã€ReentrantLockã€Semaphoreé‡Œé¢ä¹Ÿéƒ½å­˜åœ¨ã€‚</p><p>åœ¨ReentrantReadWriteLocké‡Œé¢ï¼Œè¯»é”å’Œå†™é”çš„é”ä¸»ä½“éƒ½æ˜¯Syncï¼Œä½†è¯»é”å’Œå†™é”çš„åŠ é”æ–¹å¼ä¸ä¸€æ ·ã€‚è¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬äº«é”ã€‚è¯»é”çš„å…±äº«é”å¯ä¿è¯å¹¶å‘è¯»éå¸¸é«˜æ•ˆï¼Œè€Œè¯»å†™ã€å†™è¯»ã€å†™å†™çš„è¿‡ç¨‹äº’æ–¥ï¼Œå› ä¸ºè¯»é”å’Œå†™é”æ˜¯åˆ†ç¦»çš„ã€‚æ‰€ä»¥ReentrantReadWriteLockçš„å¹¶å‘æ€§ç›¸æ¯”ä¸€èˆ¬çš„äº’æ–¥é”æœ‰äº†å¾ˆå¤§æå‡ã€‚</p><h2 id="æ„å‘é”"><a href="#æ„å‘é”" class="headerlink" title="æ„å‘é”"></a>æ„å‘é”</h2><p>å‡è®¾äº‹åŠ¡ A é”ä½äº†è¡¨Té‡Œçš„ä¸€è¡Œè®°å½•ï¼Œè¿™æ—¶å€™ï¼Œä½ æ‰§è¡Œäº†ä¸€ä¸ª DDL è¯­å¥ï¼Œæƒ³ç»™è¿™å¼ è¡¨åŠ ä¸ªå­—æ®µï¼Œè¿™æ—¶å€™éœ€è¦é”è¡¨å§ï¼Ÿä½†æ˜¯ç”±äºè¡¨é‡Œæœ‰ä¸€è¡Œè®°å½•è¢«é”ä½äº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™é”è¡¨æ—¶ä¼š blockã€‚</p><p>é‚£ Mysql åœ¨é”è¡¨æ—¶ï¼Œæ€ä¹ˆåˆ¤æ–­è¡¨é‡Œæœ‰æ²¡æœ‰è®°å½•è¢«é”ä½å‘¢ï¼Ÿ</p><p>æœ€ç®€å•æš´åŠ›çš„ï¼Œéå†æ•´å¼ è¡¨ï¼Œéå†æ¯è¡Œè®°å½•ï¼Œé‡åˆ°ä¸€ä¸ªé”ï¼Œå°±è¯´æ˜è¡¨é‡ŒåŠ é”äº†ã€‚</p><p>è¿™æ ·åšå¯ä»¥ï¼Œä½†æ˜¯å¾ˆå‚»ï¼Œæ€§èƒ½å¾ˆå·®ï¼Œé«˜æ€§èƒ½çš„ MySQLï¼Œä¸å…è®¸è¿™æ ·çš„åšæ³•å­˜åœ¨ã€‚</p><p>MySQLä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>è¡Œé”æ˜¯è¡Œçº§åˆ«çš„ï¼Œç²’åº¦æ¯”è¾ƒå°ï¼Œå¥½ï¼Œé‚£æˆ‘è¦ä½ åœ¨æ‹¿è¡Œé”ä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‹¿ä¸€ä¸ªå‡çš„è¡¨é”ï¼Œè¡¨ç¤ºä½ æƒ³å»é”ä½è¡¨é‡Œçš„æŸä¸€è¡Œæˆ–è€…å¤šè¡Œè®°å½•ã€‚</p><p>è¿™æ ·ï¼ŒMysql åœ¨åˆ¤æ–­è¡¨é‡Œæœ‰æ²¡æœ‰è®°å½•è¢«é”å®šï¼Œå°±ä¸éœ€è¦éå†æ•´å¼ è¡¨äº†ï¼Œå®ƒåªéœ€è¦çœ‹çœ‹ï¼Œæœ‰æ²¡æœ‰äººæ‹¿äº†è¿™ä¸ªå‡çš„è¡¨é”ã€‚</p><p><strong>è¿™ä¸ªå‡çš„è¡¨é”ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ï¼Œæ„å‘é”ã€‚</strong></p><hr><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&mid=2651749434&idx=3&sn=5ffa63ad47fe166f2f1a9f604ed10091&chksm=bd12a5778a652c61509d9e718ab086ff27ad8768586ea9b38c3dcf9e017a8e49bcae3df9bcc8&scene=38#wechat_redirect">ã€åŸºæœ¬åŠŸã€‘ä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹</a></li><li><a href="https://tech.youzan.com/seven-questions-about-the-lock-of-mysql/">Mysqlé”ï¼šçµé­‚ä¸ƒæ‹·é—®</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Javaå¹¶å‘ </tag>
            
            <tag> é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>80-03 æ—¶åºé¢„æµ‹è®ºæ–‡é˜…è¯»ç¬”è®°</title>
      <link href="/2025/02/28/80-03%20%E6%97%B6%E5%BA%8F%E9%A2%84%E6%B5%8B%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
      <url>/2025/02/28/80-03%20%E6%97%B6%E5%BA%8F%E9%A2%84%E6%B5%8B%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="80-03-æ—¶åºé¢„æµ‹è®ºæ–‡é˜…è¯»ç¬”è®°"><a href="#80-03-æ—¶åºé¢„æµ‹è®ºæ–‡é˜…è¯»ç¬”è®°" class="headerlink" title="80-03 æ—¶åºé¢„æµ‹è®ºæ–‡é˜…è¯»ç¬”è®°"></a>80-03 æ—¶åºé¢„æµ‹è®ºæ–‡é˜…è¯»ç¬”è®°</h1><h2 id="Adaptive-Normalization-for-Non-stationary-Time-Series-Forecasting-A-Temporal-Slice-Perspective"><a href="#Adaptive-Normalization-for-Non-stationary-Time-Series-Forecasting-A-Temporal-Slice-Perspective" class="headerlink" title="Adaptive Normalization for Non-stationary Time Series Forecasting: A Temporal Slice Perspective"></a>Adaptive Normalization for Non-stationary Time Series Forecasting: A Temporal Slice Perspective</h2><h3 id="æ‘˜è¦æ€»ç»“"><a href="#æ‘˜è¦æ€»ç»“" class="headerlink" title="æ‘˜è¦æ€»ç»“"></a>æ‘˜è¦æ€»ç»“</h3><h4 id="1-æ—¶é—´åºåˆ—é¢„æµ‹çš„æŒ‘æˆ˜"><a href="#1-æ—¶é—´åºåˆ—é¢„æµ‹çš„æŒ‘æˆ˜" class="headerlink" title="1. æ—¶é—´åºåˆ—é¢„æµ‹çš„æŒ‘æˆ˜"></a>1. <strong>æ—¶é—´åºåˆ—é¢„æµ‹çš„æŒ‘æˆ˜</strong></h4><ul><li>æ·±åº¦å­¦ä¹ æ¨¡å‹å› å…¶æ•è·åºåˆ—ä¾èµ–æ€§çš„å¼ºå¤§èƒ½åŠ›åœ¨æ—¶é—´åºåˆ—é¢„æµ‹ä¸­å–å¾—è¿›å±•ã€‚</li><li>ç„¶è€Œï¼Œç°å®ä¸–ç•Œçš„æ•°æ®å¾€å¾€å­˜åœ¨éå¹³ç¨³æ€§ï¼Œå³æ•°æ®åˆ†å¸ƒéšæ—¶é—´å˜åŒ–ï¼Œè¿™ä½¿å¾—å‡†ç¡®é¢„æµ‹å˜å¾—å…·æœ‰æŒ‘æˆ˜æ€§ã€‚</li></ul><h4 id="2-ç°æœ‰æ–¹æ³•çš„ä¸è¶³"><a href="#2-ç°æœ‰æ–¹æ³•çš„ä¸è¶³" class="headerlink" title="2. ç°æœ‰æ–¹æ³•çš„ä¸è¶³"></a>2. <strong>ç°æœ‰æ–¹æ³•çš„ä¸è¶³</strong></h4><ul><li>ç›®å‰çš„è§£å†³æ–¹æ¡ˆé€šè¿‡<strong>æ ‡å‡†åŒ–æ¥å‡å°‘éå¹³ç¨³æ€§</strong>ï¼Œä½†è¿™äº›æ–¹æ³•é€šå¸¸å‡è®¾æ—¶é—´åºåˆ—ä¸­çš„æ‰€æœ‰æ—¶é—´ç‚¹å…·æœ‰ç›¸åŒçš„ç»Ÿè®¡å±æ€§ï¼Œå¹¶å¿½è§†è¾“å…¥åºåˆ—å’Œæ°´å¹³åºåˆ—ä¹‹é—´çš„åˆ†å¸ƒå·®å¼‚ã€‚</li><li>è¿™ç§æ–¹æ³•è¿‡äºç†æƒ³ï¼Œå¯èƒ½å¯¼è‡´æ¬¡ä¼˜çš„é¢„æµ‹ç»“æœã€‚</li></ul><h4 id="3-æå‡ºçš„SANæ–¹æ³•"><a href="#3-æå‡ºçš„SANæ–¹æ³•" class="headerlink" title="3. æå‡ºçš„SANæ–¹æ³•"></a>3. <strong>æå‡ºçš„SANæ–¹æ³•</strong></h4><ul><li><strong>åˆ‡ç‰‡çº§è‡ªé€‚åº”å½’ä¸€åŒ–ï¼ˆSANï¼‰</strong>ï¼šä¸€ç§æ–°çš„æ–¹æ³•ï¼Œ<strong>æ—¨åœ¨é€šè¿‡çµæ´»çš„å½’ä¸€åŒ–å’Œåå½’ä¸€åŒ–å¢å¼ºæ—¶é—´åºåˆ—é¢„æµ‹</strong>ã€‚</li><li>ä¸¤ä¸ªå…³é”®è®¾è®¡ï¼š<ol><li><strong>å±€éƒ¨æ—¶é—´ç‰‡å½’ä¸€åŒ–</strong>ï¼šSANé€šè¿‡ä»¥å­åºåˆ—ä¸ºå•ä½æ¶ˆé™¤éå¹³ç¨³æ€§ï¼Œè€Œéå…¨å±€å®ä¾‹ã€‚</li><li><strong>è½»å¾®ç½‘ç»œæ¨¡å—å»ºæ¨¡ç»Ÿè®¡ç‰¹æ€§</strong>ï¼šSANé€šè¿‡ç‹¬ç«‹å»ºæ¨¡åŸå§‹æ—¶é—´åºåˆ—ç»Ÿè®¡ç‰¹æ€§çš„æ¼”å˜è¶‹åŠ¿æ¥è¿›ä¸€æ­¥ä¼˜åŒ–é¢„æµ‹ã€‚</li></ol></li><li>SANæ˜¯ä¸€ç§é€šç”¨çš„æ¨¡å‹æ— å…³æ’ä»¶ï¼Œèƒ½æ›´æœ‰æ•ˆåœ°å‡è½»æ—¶é—´åºåˆ—æ•°æ®çš„éå¹³ç¨³æ€§å½±å“ã€‚</li></ul><h4 id="4-å®éªŒè¯æ˜"><a href="#4-å®éªŒè¯æ˜" class="headerlink" title="4. å®éªŒè¯æ˜"></a>4. <strong>å®éªŒè¯æ˜</strong></h4><ul><li>SANåœ¨å››ç§å¸¸ç”¨çš„é¢„æµ‹æ¨¡å‹ä¸Šè¿›è¡Œäº†å®ä¾‹åŒ–ï¼Œå¹¶åœ¨åŸºå‡†æ•°æ®é›†ä¸Šæµ‹è¯•ï¼ŒéªŒè¯äº†å…¶æœ‰æ•ˆæ€§ã€‚</li><li>å…¬å¼€äº†ç›¸å…³ä»£ç ï¼Œæä¾›äº†è¿›ä¸€æ­¥çš„å®éªŒæ”¯æŒã€‚<a href="https://github.com/icantnamemyself/SAN">https://github.com/icantnamemyself/SAN</a></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502282202409.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502282215973.png" alt="image-20250228221524632"></p><h3 id="ä¸å½’ä¸€åŒ–æ–¹æ³•çš„æ¯”è¾ƒ"><a href="#ä¸å½’ä¸€åŒ–æ–¹æ³•çš„æ¯”è¾ƒ" class="headerlink" title="ä¸å½’ä¸€åŒ–æ–¹æ³•çš„æ¯”è¾ƒ"></a>ä¸å½’ä¸€åŒ–æ–¹æ³•çš„æ¯”è¾ƒ</h3><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†SANä¸ä¸‰ç§æœ€å…ˆè¿›çš„éå¹³ç¨³æ—¶é—´åºåˆ—é¢„æµ‹å½’ä¸€åŒ–æ–¹æ³•è¿›è¡Œæ¯”è¾ƒ:RevIN[17]ã€éå¹³ç¨³å˜å‹å™¨(NST)[25]å’ŒDish-TS[10]ã€‚åœ¨ç¬¬4.2èŠ‚ä¸­ç›¸åŒçš„å®éªŒè®¾ç½®ä¸‹ï¼Œæˆ‘ä»¬æŠ¥å‘Šäº†Autoformerå’ŒFEDformeråœ¨æ¯ä¸ªæ•°æ®é›†çš„æ‰€æœ‰é¢„æµ‹é•¿åº¦ä¸Šçš„å¹³å‡MSEè¯„ä¼°ä»¥åŠè¡¨4ä¸­çš„ç›¸å¯¹æ”¹è¿›ã€‚ç”±äºNSTåªèƒ½é€‚ç”¨äºåŸºäºå˜å‹å™¨çš„æ¨¡å‹ï¼Œå…¶ä»–æ¨¡å‹æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œè€Œå…¶ä»–æ–¹æ³•åˆ™æ›´åŠ çµæ´»ï¼Œå¯ä»¥åº”ç”¨äºä»»æ„é¢„æµ‹æ¨¡å‹ã€‚</p><p>åœ¨ç°æœ‰çš„è§„èŒƒåŒ–æ–¹æ³•ä¸­ï¼ŒSANçš„æ€§èƒ½æ˜¯æœ€å¥½çš„ã€‚æ”¹è¿›æ•ˆæœæ˜¾è‘—ï¼Œå¹³å‡MSEé™ä½äº†10.71%ã€‚é™¤äº†Weatherä¹‹å¤–ï¼ŒSANçš„æ€§èƒ½å§‹ç»ˆä¼˜äºåŸºçº¿æ¨¡å‹ï¼Œå¹¶ä¸”åœ¨Exchangeå’ŒILIç­‰å…¸å‹éå¹³ç¨³æ•°æ®é›†(ç”±ADFæµ‹è¯•ç¡®å®š)ä¸­çš„æ”¹è¿›æ›´ä¸ºæ˜æ˜¾ã€‚æ¯”è¾ƒè¡¨æ˜ï¼Œä»æ—¶é—´åˆ‡ç‰‡çš„è§’åº¦æ¥çœ‹ï¼ŒSANå¯èƒ½æ¯”è€ƒè™‘æ•´ä¸ªå®ä¾‹æ›´æœ‰æ•ˆåœ°å»é™¤éå¹³ç¨³å› ç´ ã€‚æ­¤å¤–ï¼Œæ‰€æå‡ºçš„ä¸¤é˜¶æ®µè®­ç»ƒæ¨¡å¼è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒä½¿SANåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¼˜äºDish-TSï¼Œè€Œåè€…å¿½ç•¥äº†åŒå±‚ä¼˜åŒ–çš„æœ¬è´¨ã€‚ç„¶è€Œï¼ŒSANçš„è¿™ç§ç‰¹æ®Šèƒ½åŠ›å¯èƒ½ä¼šå¯¼è‡´è¿‡åº¦å¹³æ–¹åŒ–é—®é¢˜[25]ï¼Œä»è€Œå¯¼è‡´Weatheræ•°æ®é›†çš„æ€§èƒ½ä¸‹é™ã€‚</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬ç€é‡äºåˆ©ç”¨ä¸€ç§æ–°çš„åˆ‡ç‰‡è§†å›¾æ¥ç¼“è§£æ—¶é—´åºåˆ—æ•°æ®çš„éå¹³ç¨³æ€§ã€‚æˆ‘ä»¬æå‡ºäº†ç”¨äºæ—¶é—´åºåˆ—é¢„æµ‹çš„SANæ¡†æ¶ï¼Œè¿™æ˜¯ä¸€ç§æ¨¡å‹ä¸å¯çŸ¥çš„æ–¹æ³•ï¼Œ<strong>é€šè¿‡å»é™¤éå¹³ç¨³å› ç´ æ¥æ ‡å‡†åŒ–è¾“å…¥</strong>ï¼Œå¹¶é€šè¿‡åœ¨æ¯ç‰‡åŸºç¡€ä¸Šçš„åè§„èŒƒåŒ–å°†å…¶æ¢å¤åˆ°è¾“å‡ºã€‚æ­¤å¤–ï¼ŒSANè¿˜åˆ©ç”¨ä¸€ç§æ–°é¢–çš„ç»Ÿè®¡é¢„æµ‹æ¨¡å—ï¼Œå°†éå¹³ç¨³é¢„æµ‹åˆ†è§£ä¸ºä¸¤ä¸ªå­ä»»åŠ¡ï¼Œä»è€Œç®€åŒ–äº†é¢„æµ‹æ¨¡å‹çš„æ€§èƒ½ã€‚ä¸ºäº†è¯æ˜SANçš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„åŸºå‡†æ•°æ®é›†ä¸Šè¿›è¡Œäº†å®éªŒï¼Œå‘ç°SANæ˜¾è‘—æ”¹å–„äº†ä¸»æµé¢„æµ‹æ¨¡å‹ï¼Œå¹¶ä¸”ä¼˜äºæœ€å…ˆè¿›çš„å½’ä¸€åŒ–æ–¹æ³•ã€‚<strong>æˆ‘ä»¬å¸Œæœ›SANå¯ä»¥ä½œä¸ºæ—¶é—´åºåˆ—é¢„æµ‹çš„åŸºç¡€ç»„ä»¶</strong>ï¼Œå¹¶ä¿ƒè¿›ä»åˆ‡ç‰‡è§’åº¦å¯¹æ—¶é—´åºåˆ—å»ºæ¨¡çš„è¿›ä¸€æ­¥ç ”ç©¶ã€‚</p><hr><h2 id="FreTS-Frequency-domain-MLPs-are-More-Effective-Learners-in-Time-Series-Forecasting-è®ºæ–‡è¯¦è§£"><a href="#FreTS-Frequency-domain-MLPs-are-More-Effective-Learners-in-Time-Series-Forecasting-è®ºæ–‡è¯¦è§£" class="headerlink" title="FreTS: Frequency-domain MLPs are More Effective Learners in Time Series Forecasting è®ºæ–‡è¯¦è§£"></a>FreTS: Frequency-domain MLPs are More Effective Learners in Time Series Forecasting è®ºæ–‡è¯¦è§£</h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æ—¶é—´åºåˆ—é¢„æµ‹åœ¨ä¸åŒçš„è¡Œä¸šä¸­å‘æŒ¥äº†å…³é”®ä½œç”¨ï¼ŒåŒ…æ‹¬é‡‘èã€äº¤é€šã€èƒ½æºå’ŒåŒ»ç–—ä¿å¥é¢†åŸŸã€‚è™½ç„¶ç°æœ‰æ–‡çŒ®è®¾è®¡äº†è®¸å¤šåŸºäºRNNã€GNNæˆ–Transformersçš„å¤æ‚æ¶æ„ï¼Œä½†æå‡ºäº†å¦ä¸€ç§åŸºäºå¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰çš„æ–¹æ³•ï¼Œå…¶ç»“æ„ç®€å•ã€å¤æ‚åº¦ä½ã€æ€§èƒ½ä¼˜è¶Šã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°åŸºäºMLPçš„é¢„æµ‹æ–¹æ³•éƒ½å­˜åœ¨é€ç‚¹æ˜ å°„å’Œä¿¡æ¯ç“¶é¢ˆï¼Œè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé˜»ç¢äº†é¢„æµ‹æ€§èƒ½ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¢ç´¢äº†åœ¨é¢‘åŸŸä¸­åº”ç”¨MLPè¿›è¡Œæ—¶é—´åºåˆ—é¢„æµ‹çš„æ–°æ–¹å‘ã€‚æˆ‘ä»¬ç ”ç©¶äº†é¢‘åŸŸMLPçš„å­¦ä¹ æ¨¡å¼ï¼Œå‘ç°äº†å®ƒä»¬æœ‰åˆ©äºé¢„æµ‹çš„ä¸¤ä¸ªå›ºæœ‰ç‰¹å¾ï¼Œï¼ˆiï¼‰å…¨å±€è§†å›¾ï¼šé¢‘è°±ä½¿MLPæ‹¥æœ‰å®Œæ•´çš„ä¿¡å·è§†å›¾ï¼Œæ›´å®¹æ˜“å­¦ä¹ å…¨å±€ä¾èµ–å…³ç³»ï¼Œï¼ˆiiï¼‰èƒ½é‡å‹ç¼©ï¼šé¢‘åŸŸMLPä¸“æ³¨äºå…·æœ‰ç´§å‡‘ä¿¡å·èƒ½é‡çš„é¢‘ç‡åˆ†é‡çš„è¾ƒå°å…³é”®éƒ¨åˆ†ã€‚ç„¶åï¼Œæˆ‘ä»¬æå‡ºäº†FreTSï¼Œè¿™æ˜¯ä¸€ç§åŸºäºé¢‘åŸŸMLPæ„å»ºçš„ç®€å•è€Œæœ‰æ•ˆçš„æ—¶é—´åºåˆ—é¢„æµ‹æ¶æ„ã€‚FreTSä¸»è¦æ¶‰åŠä¸¤ä¸ªé˜¶æ®µï¼Œï¼ˆiï¼‰åŸŸè½¬æ¢ï¼Œå°†æ—¶åŸŸä¿¡å·è½¬æ¢ä¸ºé¢‘åŸŸå¤æ•°ï¼›ï¼ˆiiï¼‰é¢‘ç‡å­¦ä¹ ï¼Œå®ƒæ‰§è¡Œæˆ‘ä»¬é‡æ–°è®¾è®¡çš„MLPï¼Œç”¨äºå­¦ä¹ é¢‘ç‡åˆ†é‡çš„å®éƒ¨å’Œè™šéƒ¨ã€‚åœ¨ç³»åˆ—é—´å’Œç³»åˆ—å†…å°ºåº¦ä¸Šè¿è¡Œçš„ä¸Šè¿°é˜¶æ®µè¿›ä¸€æ­¥æœ‰åŠ©äºé€šé“å’Œæ—¶é—´ä¾èµ–æ€§å­¦ä¹ ã€‚å¯¹13ä¸ªçœŸå®ä¸–ç•ŒåŸºå‡†ï¼ˆåŒ…æ‹¬7ä¸ªçŸ­æœŸé¢„æµ‹åŸºå‡†å’Œ6ä¸ªé•¿æœŸé¢„æµ‹åŸºå‡†ï¼‰çš„å¹¿æ³›å®éªŒè¡¨æ˜ï¼Œæˆ‘ä»¬å§‹ç»ˆä¼˜äºæœ€å…ˆè¿›çš„æ–¹æ³•ã€‚ä»£ç å¯åœ¨æ­¤å­˜å‚¨åº“ä¸­è·å¾—ï¼š<a href="https://github.com/aikunyi/FreTS">https://github.com/aikunyi/FreTS</a>.</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503032203174.png" alt="image-20250303220320114"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503032203442.png" alt="image-20250303220340224"></p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶åº </tag>
            
            <tag> è®ºæ–‡é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>80-01 Adaptive Normalization for Non-stationary Time Series Forecasting</title>
      <link href="/2025/02/28/80-01%20Adaptive%20Normalization%20for%20Non-stationary%20Time%20Series%20Forecasting%20A%20Temporal%20Slice%20Perspective%20/"/>
      <url>/2025/02/28/80-01%20Adaptive%20Normalization%20for%20Non-stationary%20Time%20Series%20Forecasting%20A%20Temporal%20Slice%20Perspective%20/</url>
      
        <content type="html"><![CDATA[<h1 id="80-01-Adaptive-Normalization-for-Non-stationary-Time-Series-Forecasting-A-Temporal-Slice-Perspective"><a href="#80-01-Adaptive-Normalization-for-Non-stationary-Time-Series-Forecasting-A-Temporal-Slice-Perspective" class="headerlink" title="80-01 Adaptive Normalization for Non-stationary Time Series Forecasting: A Temporal Slice Perspective"></a>80-01 Adaptive Normalization for Non-stationary Time Series Forecasting: A Temporal Slice Perspective</h1><h2 id="æ‘˜è¦æ€»ç»“"><a href="#æ‘˜è¦æ€»ç»“" class="headerlink" title="æ‘˜è¦æ€»ç»“"></a>æ‘˜è¦æ€»ç»“</h2><h3 id="1-æ—¶é—´åºåˆ—é¢„æµ‹çš„æŒ‘æˆ˜"><a href="#1-æ—¶é—´åºåˆ—é¢„æµ‹çš„æŒ‘æˆ˜" class="headerlink" title="1. æ—¶é—´åºåˆ—é¢„æµ‹çš„æŒ‘æˆ˜"></a>1. <strong>æ—¶é—´åºåˆ—é¢„æµ‹çš„æŒ‘æˆ˜</strong></h3><ul><li>æ·±åº¦å­¦ä¹ æ¨¡å‹å› å…¶æ•è·åºåˆ—ä¾èµ–æ€§çš„å¼ºå¤§èƒ½åŠ›åœ¨æ—¶é—´åºåˆ—é¢„æµ‹ä¸­å–å¾—è¿›å±•ã€‚</li><li>ç„¶è€Œï¼Œç°å®ä¸–ç•Œçš„æ•°æ®å¾€å¾€å­˜åœ¨éå¹³ç¨³æ€§ï¼Œå³æ•°æ®åˆ†å¸ƒéšæ—¶é—´å˜åŒ–ï¼Œè¿™ä½¿å¾—å‡†ç¡®é¢„æµ‹å˜å¾—å…·æœ‰æŒ‘æˆ˜æ€§ã€‚</li></ul><h3 id="2-ç°æœ‰æ–¹æ³•çš„ä¸è¶³"><a href="#2-ç°æœ‰æ–¹æ³•çš„ä¸è¶³" class="headerlink" title="2. ç°æœ‰æ–¹æ³•çš„ä¸è¶³"></a>2. <strong>ç°æœ‰æ–¹æ³•çš„ä¸è¶³</strong></h3><ul><li>ç›®å‰çš„è§£å†³æ–¹æ¡ˆé€šè¿‡<strong>æ ‡å‡†åŒ–æ¥å‡å°‘éå¹³ç¨³æ€§</strong>ï¼Œä½†è¿™äº›æ–¹æ³•é€šå¸¸å‡è®¾æ—¶é—´åºåˆ—ä¸­çš„æ‰€æœ‰æ—¶é—´ç‚¹å…·æœ‰ç›¸åŒçš„ç»Ÿè®¡å±æ€§ï¼Œå¹¶å¿½è§†è¾“å…¥åºåˆ—å’Œæ°´å¹³åºåˆ—ä¹‹é—´çš„åˆ†å¸ƒå·®å¼‚ã€‚</li><li>è¿™ç§æ–¹æ³•è¿‡äºç†æƒ³ï¼Œå¯èƒ½å¯¼è‡´æ¬¡ä¼˜çš„é¢„æµ‹ç»“æœã€‚</li></ul><h3 id="3-æå‡ºçš„SANæ–¹æ³•"><a href="#3-æå‡ºçš„SANæ–¹æ³•" class="headerlink" title="3. æå‡ºçš„SANæ–¹æ³•"></a>3. <strong>æå‡ºçš„SANæ–¹æ³•</strong></h3><ul><li><strong>åˆ‡ç‰‡çº§è‡ªé€‚åº”å½’ä¸€åŒ–ï¼ˆSANï¼‰</strong>ï¼šä¸€ç§æ–°çš„æ–¹æ³•ï¼Œ<strong>æ—¨åœ¨é€šè¿‡çµæ´»çš„å½’ä¸€åŒ–å’Œåå½’ä¸€åŒ–å¢å¼ºæ—¶é—´åºåˆ—é¢„æµ‹</strong>ã€‚</li><li>ä¸¤ä¸ªå…³é”®è®¾è®¡ï¼š<ol><li><strong>å±€éƒ¨æ—¶é—´ç‰‡å½’ä¸€åŒ–</strong>ï¼šSANé€šè¿‡ä»¥å­åºåˆ—ä¸ºå•ä½æ¶ˆé™¤éå¹³ç¨³æ€§ï¼Œè€Œéå…¨å±€å®ä¾‹ã€‚</li><li><strong>è½»å¾®ç½‘ç»œæ¨¡å—å»ºæ¨¡ç»Ÿè®¡ç‰¹æ€§</strong>ï¼šSANé€šè¿‡ç‹¬ç«‹å»ºæ¨¡åŸå§‹æ—¶é—´åºåˆ—ç»Ÿè®¡ç‰¹æ€§çš„æ¼”å˜è¶‹åŠ¿æ¥è¿›ä¸€æ­¥ä¼˜åŒ–é¢„æµ‹ã€‚</li></ol></li><li>SANæ˜¯ä¸€ç§é€šç”¨çš„æ¨¡å‹æ— å…³æ’ä»¶ï¼Œèƒ½æ›´æœ‰æ•ˆåœ°å‡è½»æ—¶é—´åºåˆ—æ•°æ®çš„éå¹³ç¨³æ€§å½±å“ã€‚</li></ul><h3 id="4-å®éªŒè¯æ˜"><a href="#4-å®éªŒè¯æ˜" class="headerlink" title="4. å®éªŒè¯æ˜"></a>4. <strong>å®éªŒè¯æ˜</strong></h3><ul><li>SANåœ¨å››ç§å¸¸ç”¨çš„é¢„æµ‹æ¨¡å‹ä¸Šè¿›è¡Œäº†å®ä¾‹åŒ–ï¼Œå¹¶åœ¨åŸºå‡†æ•°æ®é›†ä¸Šæµ‹è¯•ï¼ŒéªŒè¯äº†å…¶æœ‰æ•ˆæ€§ã€‚</li><li>å…¬å¼€äº†ç›¸å…³ä»£ç ï¼Œæä¾›äº†è¿›ä¸€æ­¥çš„å®éªŒæ”¯æŒã€‚<a href="https://github.com/icantnamemyself/SAN">https://github.com/icantnamemyself/SAN</a></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502282202409.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502282215973.png" alt="image-20250228221524632"></p><h2 id="ä¸å½’ä¸€åŒ–æ–¹æ³•çš„æ¯”è¾ƒ"><a href="#ä¸å½’ä¸€åŒ–æ–¹æ³•çš„æ¯”è¾ƒ" class="headerlink" title="ä¸å½’ä¸€åŒ–æ–¹æ³•çš„æ¯”è¾ƒ"></a>ä¸å½’ä¸€åŒ–æ–¹æ³•çš„æ¯”è¾ƒ</h2><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†SANä¸ä¸‰ç§æœ€å…ˆè¿›çš„éå¹³ç¨³æ—¶é—´åºåˆ—é¢„æµ‹å½’ä¸€åŒ–æ–¹æ³•è¿›è¡Œæ¯”è¾ƒ:RevIN[17]ã€éå¹³ç¨³å˜å‹å™¨(NST)[25]å’ŒDish-TS[10]ã€‚åœ¨ç¬¬4.2èŠ‚ä¸­ç›¸åŒçš„å®éªŒè®¾ç½®ä¸‹ï¼Œæˆ‘ä»¬æŠ¥å‘Šäº†Autoformerå’ŒFEDformeråœ¨æ¯ä¸ªæ•°æ®é›†çš„æ‰€æœ‰é¢„æµ‹é•¿åº¦ä¸Šçš„å¹³å‡MSEè¯„ä¼°ä»¥åŠè¡¨4ä¸­çš„ç›¸å¯¹æ”¹è¿›ã€‚ç”±äºNSTåªèƒ½é€‚ç”¨äºåŸºäºå˜å‹å™¨çš„æ¨¡å‹ï¼Œå…¶ä»–æ¨¡å‹æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œè€Œå…¶ä»–æ–¹æ³•åˆ™æ›´åŠ çµæ´»ï¼Œå¯ä»¥åº”ç”¨äºä»»æ„é¢„æµ‹æ¨¡å‹ã€‚</p><p>åœ¨ç°æœ‰çš„è§„èŒƒåŒ–æ–¹æ³•ä¸­ï¼ŒSANçš„æ€§èƒ½æ˜¯æœ€å¥½çš„ã€‚æ”¹è¿›æ•ˆæœæ˜¾è‘—ï¼Œå¹³å‡MSEé™ä½äº†10.71%ã€‚é™¤äº†Weatherä¹‹å¤–ï¼ŒSANçš„æ€§èƒ½å§‹ç»ˆä¼˜äºåŸºçº¿æ¨¡å‹ï¼Œå¹¶ä¸”åœ¨Exchangeå’ŒILIç­‰å…¸å‹éå¹³ç¨³æ•°æ®é›†(ç”±ADFæµ‹è¯•ç¡®å®š)ä¸­çš„æ”¹è¿›æ›´ä¸ºæ˜æ˜¾ã€‚æ¯”è¾ƒè¡¨æ˜ï¼Œä»æ—¶é—´åˆ‡ç‰‡çš„è§’åº¦æ¥çœ‹ï¼ŒSANå¯èƒ½æ¯”è€ƒè™‘æ•´ä¸ªå®ä¾‹æ›´æœ‰æ•ˆåœ°å»é™¤éå¹³ç¨³å› ç´ ã€‚æ­¤å¤–ï¼Œæ‰€æå‡ºçš„ä¸¤é˜¶æ®µè®­ç»ƒæ¨¡å¼è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒä½¿SANåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¼˜äºDish-TSï¼Œè€Œåè€…å¿½ç•¥äº†åŒå±‚ä¼˜åŒ–çš„æœ¬è´¨ã€‚ç„¶è€Œï¼ŒSANçš„è¿™ç§ç‰¹æ®Šèƒ½åŠ›å¯èƒ½ä¼šå¯¼è‡´è¿‡åº¦å¹³æ–¹åŒ–é—®é¢˜[25]ï¼Œä»è€Œå¯¼è‡´Weatheræ•°æ®é›†çš„æ€§èƒ½ä¸‹é™ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬ç€é‡äºåˆ©ç”¨ä¸€ç§æ–°çš„åˆ‡ç‰‡è§†å›¾æ¥ç¼“è§£æ—¶é—´åºåˆ—æ•°æ®çš„éå¹³ç¨³æ€§ã€‚æˆ‘ä»¬æå‡ºäº†ç”¨äºæ—¶é—´åºåˆ—é¢„æµ‹çš„SANæ¡†æ¶ï¼Œè¿™æ˜¯ä¸€ç§æ¨¡å‹ä¸å¯çŸ¥çš„æ–¹æ³•ï¼Œ<strong>é€šè¿‡å»é™¤éå¹³ç¨³å› ç´ æ¥æ ‡å‡†åŒ–è¾“å…¥</strong>ï¼Œå¹¶é€šè¿‡åœ¨æ¯ç‰‡åŸºç¡€ä¸Šçš„åè§„èŒƒåŒ–å°†å…¶æ¢å¤åˆ°è¾“å‡ºã€‚æ­¤å¤–ï¼ŒSANè¿˜åˆ©ç”¨ä¸€ç§æ–°é¢–çš„ç»Ÿè®¡é¢„æµ‹æ¨¡å—ï¼Œå°†éå¹³ç¨³é¢„æµ‹åˆ†è§£ä¸ºä¸¤ä¸ªå­ä»»åŠ¡ï¼Œä»è€Œç®€åŒ–äº†é¢„æµ‹æ¨¡å‹çš„æ€§èƒ½ã€‚ä¸ºäº†è¯æ˜SANçš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„åŸºå‡†æ•°æ®é›†ä¸Šè¿›è¡Œäº†å®éªŒï¼Œå‘ç°SANæ˜¾è‘—æ”¹å–„äº†ä¸»æµé¢„æµ‹æ¨¡å‹ï¼Œå¹¶ä¸”ä¼˜äºæœ€å…ˆè¿›çš„å½’ä¸€åŒ–æ–¹æ³•ã€‚<strong>æˆ‘ä»¬å¸Œæœ›SANå¯ä»¥ä½œä¸ºæ—¶é—´åºåˆ—é¢„æµ‹çš„åŸºç¡€ç»„ä»¶</strong>ï¼Œå¹¶ä¿ƒè¿›ä»åˆ‡ç‰‡è§’åº¦å¯¹æ—¶é—´åºåˆ—å»ºæ¨¡çš„è¿›ä¸€æ­¥ç ”ç©¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶åº </tag>
            
            <tag> è®ºæ–‡é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>80-02 BasisFormer:Attention-based Time Series Forecasting with Learnable and Interpretable Basis</title>
      <link href="/2025/02/28/80-02%20%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ABasisFormer%20Attention-based%20Time%20Series%20Forecasting%20with%20Learnable%20and%20Interpretable%20Basis/"/>
      <url>/2025/02/28/80-02%20%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ABasisFormer%20Attention-based%20Time%20Series%20Forecasting%20with%20Learnable%20and%20Interpretable%20Basis/</url>
      
        <content type="html"><![CDATA[<h1 id="80-02-BasisFormer-Attention-based-Time-Series-Forecasting-with-Learnable-and-Interpretable-Basis"><a href="#80-02-BasisFormer-Attention-based-Time-Series-Forecasting-with-Learnable-and-Interpretable-Basis" class="headerlink" title="80-02 BasisFormer: Attention-based Time Series Forecasting with Learnable and Interpretable Basis"></a>80-02 BasisFormer: Attention-based Time Series Forecasting with Learnable and Interpretable Basis</h1><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a><strong>æ‘˜è¦</strong></h2><p>åŸºå‡½æ•°ï¼ˆBasesï¼‰å› å…¶èƒ½å¤Ÿä½œä¸ºç‰¹å¾æå–å™¨æˆ–æœªæ¥å‚è€ƒæ¨¡æ¿çš„ç‰¹æ€§ï¼Œå·²æˆä¸ºç°ä»£åŸºäºæ·±åº¦å­¦ä¹ çš„æ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä¸ºäº†é«˜æ•ˆè¿ä½œï¼ŒåŸºå‡½æ•°éœ€æ»¡è¶³ä¸¤å¤§æ¡ä»¶ï¼š</p><ol><li>éœ€é’ˆå¯¹ç‰¹å®šæ—¶é—´åºåˆ—æ•°æ®é›†å®šåˆ¶åŒ–ï¼›</li><li>éœ€ä¸é›†åˆå†…å„æ—¶é—´åºåˆ—ä¿æŒæ˜¾è‘—ç›¸å…³æ€§ã€‚ç„¶è€Œï¼Œç°æœ‰å‰æ²¿æ–¹æ³•éš¾ä»¥åŒæ—¶æ»¡è¶³è¿™ä¸¤é¡¹è¦æ±‚ã€‚</li></ol><p>ä¸ºè§£å†³è¿™ä¸€æŒ‘æˆ˜ï¼Œæœ¬æ–‡æå‡º<strong>BasisFormer</strong>â€”â€”ä¸€ç§<strong>ç«¯åˆ°ç«¯çš„æ—¶é—´åºåˆ—é¢„æµ‹æ¶æ„</strong>ï¼Œé€šè¿‡å¯å­¦ä¹ ä¸”å¯è§£é‡Šçš„åŸºå‡½æ•°å®ç°é«˜æ•ˆå»ºæ¨¡ã€‚è¯¥æ¶æ„åŒ…å«ä¸‰å¤§æ ¸å¿ƒæ¨¡å—ï¼š</p><ol><li><strong>åŸºå‡½æ•°ç”Ÿæˆ</strong>ï¼šé€šè¿‡è‡ªé€‚åº”è‡ªç›‘ç£å­¦ä¹ è·å–åŸºå‡½æ•°ï¼Œå°†æ—¶é—´åºåˆ—çš„å†å²æ®µä¸æœªæ¥æ®µè§†ä¸ºä¸¤ä¸ªç‹¬ç«‹è§†å›¾ï¼Œå¹¶é‡‡ç”¨å¯¹æ¯”å­¦ä¹ ç­–ç•¥ï¼›</li><li><strong>ç›¸ä¼¼æ€§ç³»æ•°è®¡ç®—</strong>ï¼šè®¾è®¡<strong>Coefæ¨¡å—</strong>ï¼Œåˆ©ç”¨åŒå‘äº¤å‰æ³¨æ„åŠ›æœºåˆ¶è®¡ç®—å†å²è§†å›¾ä¸­æ—¶é—´åºåˆ—ä¸åŸºå‡½æ•°ä¹‹é—´çš„ç›¸å…³æ€§ç³»æ•°ï¼›</li><li><strong>é¢„æµ‹æ•´åˆ</strong>ï¼šåŸºäºç›¸å…³æ€§ç³»æ•°ï¼Œåœ¨<strong>Forecastæ¨¡å—</strong>ä¸­é€‰æ‹©å¹¶æ•´åˆæœªæ¥è§†å›¾ä¸­çš„åŸºå‡½æ•°ï¼Œç”Ÿæˆç²¾å‡†é¢„æµ‹ç»“æœã€‚<br>åœ¨6ä¸ªåŸºå‡†æ•°æ®é›†ä¸Šçš„å®éªŒè¡¨æ˜ï¼ŒBasisFormeråœ¨å•å˜é‡ä¸å¤šå˜é‡é¢„æµ‹ä»»åŠ¡ä¸­åˆ†åˆ«ä»¥**11.04%<strong>å’Œ</strong>15.78%**çš„ä¼˜åŠ¿è¶…è¶Šç°æœ‰æœ€ä¼˜æ–¹æ³•ã€‚ä»£ç å·²å¼€æºï¼š<a href="https://github.com/nzl5116190/Basisformer">https://github.com/nzl5116190/Basisformer</a>.</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502282239097.png" alt="image-20250228223943058"></p><h2 id="ä¸»è¦è´¡çŒ®"><a href="#ä¸»è¦è´¡çŒ®" class="headerlink" title="ä¸»è¦è´¡çŒ®"></a>ä¸»è¦è´¡çŒ®</h2><p>æˆ‘ä»¬æå‡ºäº†ä¸€ç§åŸºç¡€å­¦ä¹ çš„è‡ªç›‘ç£æ–¹æ³•ï¼Œå°†æ—¶é—´åºåˆ—çš„å†å²éƒ¨åˆ†å’Œæœªæ¥éƒ¨åˆ†è§†ä¸ºä¸¤ä¸ªä¸åŒçš„è§†å›¾å¹¶é‡‡ç”¨å¯¹æ¯”å­¦ä¹ ï¼Œè¿™ç¡®ä¿äº†æ—¶é—´åºåˆ—åŸºç¡€çš„é€‰æ‹©åœ¨ä¸¤ä¸ªè§†å›¾ä¸­æ˜¯ä¸€è‡´çš„ã€‚</p><p> æˆ‘ä»¬è®¾è®¡äº†Coef å’ŒForecast æ¨¡å—ï¼Œæ ¹æ®è¡¡é‡æ—¶é—´åºåˆ—ä¸å†å²è§†å›¾ä¸­çš„åŸºç¡€ä¹‹é—´ç›¸ä¼¼æ€§çš„ç³»æ•°ï¼Œé€‰æ‹©å¹¶åˆå¹¶æœªæ¥è§†å›¾ä¸­çš„ç›¸å…³åŸºç¡€ã€‚</p><p>æˆ‘ä»¬å¯¹å…­ä¸ªæ•°æ®é›†è¿›è¡Œäº†å¹¿æ³›çš„å®éªŒï¼Œå‘ç°æˆ‘ä»¬çš„æ¨¡å‹åœ¨å•å˜é‡é¢„æµ‹ä»»åŠ¡ä¸Šæ¯”ä»¥å‰çš„ SOTA æ–¹æ³•é«˜å‡º 11.04%ï¼Œåœ¨å¤šå˜é‡é¢„æµ‹ä»»åŠ¡ä¸Šæ¯”ä»¥å‰çš„ SOTA æ–¹æ³•é«˜å‡º 15.78%ã€‚</p><h2 id="æ¨¡å‹ç»“æ„"><a href="#æ¨¡å‹ç»“æ„" class="headerlink" title="æ¨¡å‹ç»“æ„"></a>æ¨¡å‹ç»“æ„</h2><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç»´åº¦ä¸º C çš„æ—¶é—´åºåˆ—é›†åˆï¼Œè¿™æ„å‘³ç€ C ä¸ªç›¸å…³çš„æ—¶é—´åºåˆ—éœ€è¦åŒæ—¶é¢„æµ‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502282300756.png" alt="image-20250228230023291"></p><h2 id="æ¨¡å‹è®­ç»ƒ"><a href="#æ¨¡å‹è®­ç»ƒ" class="headerlink" title="æ¨¡å‹è®­ç»ƒ"></a>æ¨¡å‹è®­ç»ƒ</h2><p>æ•°æ®é›†ï¼šæœ¬ç ”ç©¶ä½¿ç”¨çš„å…­ä¸ªæ•°æ®é›†åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ol><li>ETTï¼Œç”±ç”µåŠ›å˜å‹å™¨çš„æ¸©åº¦æ•°æ®ç»„æˆï¼› </li><li>ç”¨ç”µé‡ï¼ŒåŒ…æ‹¬å¤šä¸ªå®¢æˆ·çš„ç”¨ç”µé‡æ•°æ®ï¼› </li><li>æ±‡ç‡ï¼ŒåŒ…å«ç‰¹å®šæ—¶é—´èŒƒå›´å†…çš„é‡‘èæ±‡ç‡ï¼› </li><li>äº¤é€šï¼ŒåŒ…æ‹¬ä¸é“è·¯äº¤é€šç›¸å…³çš„æ•°æ®ï¼› </li><li>å¤©æ°”ï¼Œæ¶‰åŠå„ç§å¤©æ°”æŒ‡æ ‡ï¼› </li><li>ç–¾ç—…ï¼ŒåŒ…æ‹¬è®°å½•çš„æµæ„Ÿæ ·ç–¾ç—…æ•°æ®ã€‚</li></ol><p>è¯·æ³¨æ„ï¼ŒETT è¿›ä¸€æ­¥åˆ†ä¸ºå››ä¸ªå­æ•°æ®é›†ï¼šETTh1ã€ETTh2ã€ETTm1 å’Œ ETTm2ï¼Œè¡¨ 1 ä¸­çš„ç»“æœä»…åŸºäº ETTm2 å­æ•°æ®é›†ã€‚ å…¶ä½™ä¸‰ä¸ªå­æ•°æ®é›†çš„ç»“æœå¯ä»¥åœ¨é™„å½•ä¸­æ‰¾åˆ°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502282305624.png" alt="image-20250228230533876"></p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶åº </tag>
            
            <tag> è®ºæ–‡é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-19 Linuxæ–‡ä»¶æƒé™</title>
      <link href="/2025/02/28/75-19%20Linux%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/"/>
      <url>/2025/02/28/75-19%20Linux%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/</url>
      
        <content type="html"><![CDATA[<h1 id="75-19-Linuxæ–‡ä»¶æƒé™"><a href="#75-19-Linuxæ–‡ä»¶æƒé™" class="headerlink" title="75-19 Linuxæ–‡ä»¶æƒé™"></a>75-19 Linuxæ–‡ä»¶æƒé™</h1><p>ä½¿ç”¨<code>ls -l</code>æˆ–è€…<code>ll</code>æŒ‡ä»¤å¯ä»¥ç›´æ¥æŸ¥çœ‹åˆ°å¦‚ä¸‹çš„æ ‡è®°ï¼Œè¿™äº›æ ‡è®°ä»£è¡¨çš„ç›¸å…³æ–‡ä»¶æˆ–<a href="https://so.csdn.net/so/search?q=%E6%96%87%E4%BB%B6%E5%A4%B9&spm=1001.2101.3001.7020">æ–‡ä»¶å¤¹</a>çš„æƒé™ç±»å‹åŠæ‰€å±ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281839949.png" alt="image-20240222100605216"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281840642.png" alt="image-20250228184058582"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281841449.png" alt="image-20250228184136368"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281842117.png" alt="image-20250228184251046"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281844606.png" alt="image-20250228184435557"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281843748.png" alt="image-20250228184310672"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»™æ–‡ä»¶file.txtçš„æ‰€æœ‰è€…ï¼ˆuï¼‰å¢åŠ è¯»å–ï¼ˆ+rï¼‰æƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> u+r file.txt</span><br><span class="line"><span class="comment"># ä»æ–‡ä»¶file.txtçš„æ‹¥æœ‰è€…åŒç»„ç”¨æˆ·ï¼ˆgï¼‰ä¸­ç§»é™¤å†™å…¥ï¼ˆ-wï¼‰æƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> g-w file.txt</span><br><span class="line"><span class="comment"># ç»™ç›®å½•directoryçš„å…¶ä»–ç”¨æˆ·ï¼ˆoï¼‰å¢åŠ æ‰§è¡Œï¼ˆ+xï¼‰æƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> o+x directory</span><br><span class="line"><span class="comment"># ç»™æ–‡ä»¶file.txtçš„æ‰€æœ‰ç”¨æˆ·ï¼ˆaï¼‰è®¾ç½®è¯»å–å’Œå†™å…¥æƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> a=rw file.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Linuxå‘½ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-20 JIT &amp; AOT</title>
      <link href="/2025/02/28/75-20%20JIT/"/>
      <url>/2025/02/28/75-20%20JIT/</url>
      
        <content type="html"><![CDATA[<h1 id="75-20-JIT-AOT"><a href="#75-20-JIT-AOT" class="headerlink" title="75-20 JIT &amp; AOT"></a>75-20 JIT &amp; AOT</h1><h2 id="JIT-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#JIT-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="JIT æ˜¯ä»€ä¹ˆï¼Ÿ"></a>JIT æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>JITï¼ˆJust-In-Timeï¼Œå³æ—¶ç¼–è¯‘å™¨ï¼‰æ˜¯ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­çš„ä¸€é¡¹å…³é”®ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒçš„ä½œç”¨æ˜¯<strong>åœ¨è¿è¡Œæ—¶å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç </strong>ï¼Œä»è€Œæé«˜ Java ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p><p>ä¼ ç»Ÿä¸Šï¼ŒJava ä»£ç çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>Java æºä»£ç ï¼ˆ.javaï¼‰</strong> â†’ é€šè¿‡ <strong>Java ç¼–è¯‘å™¨ï¼ˆjavacï¼‰</strong> ç¼–è¯‘æˆ <strong>å­—èŠ‚ç ï¼ˆ.classï¼‰</strong>ã€‚</li><li><strong>å­—èŠ‚ç </strong> ç”± <strong>JVM çš„è§£é‡Šå™¨ï¼ˆInterpreterï¼‰</strong> æŒ‰è¡Œè§£é‡Šæ‰§è¡Œï¼Œæ€§èƒ½è¾ƒä½ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503012330743.png" alt="image.png"></p><p>JIT ç¼–è¯‘å™¨çš„ä½œç”¨å°±æ˜¯ï¼š</p><ul><li><strong>åœ¨è¿è¡Œæ—¶æ£€æµ‹çƒ­ç‚¹ä»£ç </strong></li><li><strong>å°†è¿™äº›çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœºå™¨ç </strong></li><li><strong>è®©åç»­æ‰§è¡Œæ—¶ç›´æ¥è¿è¡Œæœºå™¨ç ï¼Œæå‡æ€§èƒ½</strong></li></ul><h2 id="JIT-è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#JIT-è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="JIT è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>JIT è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><p>JVM æ—©æœŸæ‰§è¡Œ Java ä»£ç æ—¶ï¼Œé‡‡ç”¨<strong>è§£é‡Šæ‰§è¡Œ</strong>æ–¹å¼ï¼š</p><ul><li>è§£é‡Šå™¨é€è¡Œç¿»è¯‘å­—èŠ‚ç ï¼Œè½¬æ¢ä¸º CPU å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</li><li>ç”±äºè§£é‡Šæ‰§è¡Œé€è¡Œè½¬æ¢ï¼Œ<strong>æ€§èƒ½è¾ƒä½</strong>ï¼Œå°¤å…¶æ˜¯çƒ­ç‚¹ä»£ç éœ€è¦è¢«é‡å¤è§£é‡Šæ‰§è¡Œã€‚</li></ul><p>JIT ç¼–è¯‘å™¨å¼•å…¥åï¼š</p><ul><li>å‘ç°æŸæ®µä»£ç è¢«**é«˜é¢‘æ‰§è¡Œï¼ˆçƒ­ç‚¹ä»£ç ï¼‰**æ—¶ï¼ŒJIT ä¼šå°†å…¶ç¼–è¯‘æˆæœºå™¨ç ã€‚</li><li>è¿™æ · JVM ä¸‹æ¬¡è¿è¡Œè¯¥ä»£ç æ—¶ï¼Œä¸éœ€è¦è§£é‡Šæ‰§è¡Œï¼Œè€Œæ˜¯<strong>ç›´æ¥æ‰§è¡Œæœºå™¨ç </strong>ï¼Œæå‡é€Ÿåº¦ã€‚</li></ul><h2 id="å“ªäº›ç¨‹åºä»£ç ä¼šè¢«ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿå¦‚ä½•ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿ"><a href="#å“ªäº›ç¨‹åºä»£ç ä¼šè¢«ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿå¦‚ä½•ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿ" class="headerlink" title="å“ªäº›ç¨‹åºä»£ç ä¼šè¢«ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿå¦‚ä½•ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿ"></a>å“ªäº›ç¨‹åºä»£ç ä¼šè¢«ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿå¦‚ä½•ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Ÿ</h2><p>ç¨‹åºä¸­çš„ä»£ç åªæœ‰æ˜¯çƒ­ç‚¹ä»£ç æ—¶ï¼Œæ‰ä¼šç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯çƒ­ç‚¹ä»£ç å‘¢ï¼Ÿ</p><p>è¿è¡Œè¿‡ç¨‹ä¸­ä¼šè¢«å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘çš„â€œçƒ­ç‚¹ä»£ç â€æœ‰ä¸¤ç±»ï¼š</p><p>1ã€è¢«å¤šæ¬¡è°ƒç”¨çš„æ–¹æ³•ã€‚</p><p>2ã€è¢«å¤šæ¬¡æ‰§è¡Œçš„å¾ªç¯ä½“ã€‚</p><p>ä¸¤ç§æƒ…å†µï¼Œç¼–è¯‘å™¨éƒ½æ˜¯ä»¥æ•´ä¸ªæ–¹æ³•ä½œä¸ºç¼–è¯‘å¯¹è±¡ã€‚ è¿™ç§ç¼–è¯‘æ–¹æ³•å› ä¸ºç¼–è¯‘å‘ç”Ÿåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¹‹ä¸­ï¼Œå› æ­¤å½¢è±¡çš„ç§°ä¹‹ä¸ºæ ˆä¸Šæ›¿æ¢ï¼ˆOn Stack Replacementï¼ŒOSRï¼‰ï¼Œå³æ–¹æ³•æ ˆå¸§è¿˜åœ¨æ ˆä¸Šï¼Œæ–¹æ³•å°±è¢«æ›¿æ¢äº†ã€‚</p><h2 id="JIT-çš„åˆ†ç±»"><a href="#JIT-çš„åˆ†ç±»" class="headerlink" title="JIT çš„åˆ†ç±»"></a>JIT çš„åˆ†ç±»</h2><p>JIT ä¸æ˜¯å•ä¸€çš„ç¼–è¯‘å™¨ï¼Œè€Œæ˜¯åŒ…æ‹¬å¤šä¸ªä¸åŒçº§åˆ«çš„ä¼˜åŒ–å™¨ï¼Œä¸»è¦æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><ol><li><strong>C1 ç¼–è¯‘å™¨ï¼ˆClient Compilerï¼Œè½»é‡ä¼˜åŒ–ï¼‰</strong><ul><li>é€‚ç”¨äº <strong>å®¢æˆ·ç«¯åº”ç”¨</strong>ï¼ˆå¦‚æ¡Œé¢åº”ç”¨ï¼‰ã€‚</li><li><strong>ç¼–è¯‘é€Ÿåº¦å¿«</strong>ï¼Œé€‚åˆçŸ­æ—¶é—´è¿è¡Œçš„ Java è¿›ç¨‹ã€‚</li><li>ä¸»è¦ä¼˜åŒ–ï¼š<strong>æ–¹æ³•å†…è”ã€æ­»ä»£ç æ¶ˆé™¤ã€å±€éƒ¨å˜é‡ä¼˜åŒ–ç­‰</strong>ã€‚</li></ul></li><li><strong>C2 ç¼–è¯‘å™¨ï¼ˆServer Compilerï¼Œæ·±åº¦ä¼˜åŒ–ï¼‰</strong><ul><li>é€‚ç”¨äº <strong>æœåŠ¡å™¨ç«¯åº”ç”¨</strong>ï¼ˆå¦‚ Web æœåŠ¡å™¨ï¼‰ã€‚</li><li><strong>ç¼–è¯‘æ—¶é—´è¾ƒé•¿ï¼Œä½†ä¼˜åŒ–æ•ˆæœæ›´å¥½</strong>ï¼Œé€‚åˆé•¿æœŸè¿è¡Œçš„ Java è¿›ç¨‹ã€‚</li><li>ä¸»è¦ä¼˜åŒ–ï¼š<strong>æŒ‡ä»¤é‡æ’ã€å¾ªç¯å±•å¼€ã€é€ƒé€¸åˆ†æç­‰</strong>ã€‚</li></ul></li></ol><p>JVM ä¼šæ ¹æ®åº”ç”¨ç±»å‹é€‰æ‹©åˆé€‚çš„ JIT ç¼–è¯‘å™¨ï¼ŒJava 8 é»˜è®¤ä½¿ç”¨ <strong>C1+C2 ç»„åˆï¼ˆåˆ†å±‚ç¼–è¯‘ï¼‰</strong>ã€‚</p><h2 id="AOTï¼ŒAhead-Of-Timeï¼ŒæŒ‡è¿è¡Œå‰ç¼–è¯‘ï¼Œé¢„å…ˆç¼–è¯‘ã€‚"><a href="#AOTï¼ŒAhead-Of-Timeï¼ŒæŒ‡è¿è¡Œå‰ç¼–è¯‘ï¼Œé¢„å…ˆç¼–è¯‘ã€‚" class="headerlink" title="AOTï¼ŒAhead Of Timeï¼ŒæŒ‡è¿è¡Œå‰ç¼–è¯‘ï¼Œé¢„å…ˆç¼–è¯‘ã€‚"></a>AOTï¼ŒAhead Of Timeï¼ŒæŒ‡è¿è¡Œå‰ç¼–è¯‘ï¼Œé¢„å…ˆç¼–è¯‘ã€‚</h2><p>AOT ç¼–è¯‘èƒ½ç›´æ¥å°†æºä»£ç è½¬åŒ–ä¸ºæœºå™¨ç ï¼Œå†…å­˜å ç”¨ä½ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ï¼Œå¯ä»¥æ— éœ€ runtime è¿è¡Œï¼Œç›´æ¥å°† runtime é™æ€é“¾æ¥è‡³æœ€ç»ˆçš„ç¨‹åºä¸­ï¼Œä½†æ˜¯æ— è¿è¡Œæ—¶æ€§èƒ½åŠ æˆï¼Œä¸èƒ½æ ¹æ®ç¨‹åºè¿è¡Œæƒ…å†µåšè¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼ŒAOT ç¼ºç‚¹å°±æ˜¯åœ¨ç¨‹åºè¿è¡Œå‰ç¼–è¯‘ä¼šä½¿ç¨‹åºå®‰è£…çš„æ—¶é—´å¢åŠ ã€‚</p><p>ï¼ˆ3ï¼‰AOTçš„ä¼˜ç‚¹</p><p>ç®€å•æ¥è®²ï¼ŒJava è™šæ‹ŸæœºåŠ è½½å·²ç»é¢„ç¼–è¯‘æˆäºŒè¿›åˆ¶åº“ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚ä¸å¿…ç­‰å¾…åŠæ—¶ç¼–è¯‘å™¨çš„é¢„çƒ­ï¼Œå‡å°‘ Java åº”ç”¨ç»™äººå¸¦æ¥â€œç¬¬ä¸€æ¬¡è¿è¡Œæ…¢â€ çš„ä¸è‰¯ä½“éªŒã€‚</p><p>åœ¨ç¨‹åºè¿è¡Œå‰ç¼–è¯‘ï¼Œå¯ä»¥é¿å…åœ¨è¿è¡Œæ—¶çš„ç¼–è¯‘æ€§èƒ½æ¶ˆè€—å’Œå†…å­˜æ¶ˆè€— å¯ä»¥åœ¨ç¨‹åºè¿è¡ŒåˆæœŸå°±è¾¾åˆ°æœ€é«˜æ€§èƒ½ï¼Œç¨‹åºå¯åŠ¨é€Ÿåº¦å¿« è¿è¡Œäº§ç‰©åªæœ‰æœºå™¨ç ï¼Œæ‰“åŒ…ä½“ç§¯å°.</p><p>AOT é€‚åˆåµŒå…¥å¼ç›¸å…³åº”ç”¨ä¸Šï¼Œå†…å­˜å ç”¨å°ï¼Œè¿è¡Œå¿«ã€‚</p><p>ä½†æ˜¯å…¨æ–¹é¢ä½¿ç”¨AOTçš„è¯å°±ä¼šå¯¼è‡´Javaä¸­çš„åŠ¨æ€ä»£ç†å¤±æ•ˆï¼Œæ‰€ä»¥ä¸€èˆ¬JDKæ˜¯ä½¿ç”¨åˆ†å±‚ç¼–è¯‘å’ŒAOTååŒä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
            <tag> JIT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-38 è£…é¥°å™¨æ¨¡å¼</title>
      <link href="/2025/02/28/75-38%20%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/02/28/75-38%20%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="75-38-è£…é¥°å™¨æ¨¡å¼"><a href="#75-38-è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="75-38 è£…é¥°å™¨æ¨¡å¼"></a>75-38 è£…é¥°å™¨æ¨¡å¼</h1><p>è£…é¥°å™¨æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œ<strong>å®ƒå…è®¸ä½ åœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„å‰æä¸‹</strong>ï¼ŒåŠ¨æ€åœ°ä¸ºå¯¹è±¡æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚å®ƒé€šè¿‡å°†å¯¹è±¡åµŒå…¥åˆ°å¦ä¸€ä¸ªè£…é¥°å™¨å¯¹è±¡ä¸­æ¥å®ç°åŠŸèƒ½æ‰©å±•ï¼Œä¸”æ¯ä¸ªè£…é¥°å™¨å¯¹è±¡éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ‰©å±•åŠŸèƒ½ã€‚ä¸ç»§æ‰¿æ–¹å¼ä¸åŒï¼Œè£…é¥°å™¨æ¨¡å¼å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ç»™å¯¹è±¡å¢åŠ åŠŸèƒ½ï¼Œè€Œæ— éœ€ä¿®æ”¹å¯¹è±¡æœ¬èº«çš„ä»£ç ã€‚</p><h2 id="è£…é¥°å™¨æ¨¡å¼çš„ç»“æ„"><a href="#è£…é¥°å™¨æ¨¡å¼çš„ç»“æ„" class="headerlink" title="è£…é¥°å™¨æ¨¡å¼çš„ç»“æ„"></a><strong>è£…é¥°å™¨æ¨¡å¼çš„ç»“æ„</strong></h2><ol><li><strong>Componentï¼ˆç»„ä»¶æ¥å£ï¼‰</strong>ï¼šå®šä¹‰ä¸€ä¸ªåŸºç¡€æ¥å£ï¼Œé€šå¸¸æ˜¯è¢«è£…é¥°çš„ç›®æ ‡ç±»æˆ–æ¥å£ã€‚</li><li><strong>ConcreteComponentï¼ˆå…·ä½“ç»„ä»¶ï¼‰</strong>ï¼šå®ç°äº† <code>Component</code> æ¥å£çš„å…·ä½“ç±»ï¼Œæ˜¯è£…é¥°å™¨æ¨¡å¼çš„åŸºç¡€å¯¹è±¡ã€‚</li><li><strong>Decoratorï¼ˆè£…é¥°å™¨ç±»ï¼‰</strong>ï¼šç»§æ‰¿è‡ª <code>Component</code>ï¼Œå¹¶æŒæœ‰ä¸€ä¸ª <code>Component</code> å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†çš„æ–¹å¼æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚</li><li><strong>ConcreteDecoratorï¼ˆå…·ä½“è£…é¥°å™¨ï¼‰</strong>ï¼šå®ç°äº†å…·ä½“çš„æ‰©å±•åŠŸèƒ½ã€‚</li></ol><h2 id="å…·ä½“ä¾‹å­ï¼šå’–å•¡åº—çš„è£…é¥°å™¨æ¨¡å¼"><a href="#å…·ä½“ä¾‹å­ï¼šå’–å•¡åº—çš„è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="å…·ä½“ä¾‹å­ï¼šå’–å•¡åº—çš„è£…é¥°å™¨æ¨¡å¼"></a>å…·ä½“ä¾‹å­ï¼šå’–å•¡åº—çš„è£…é¥°å™¨æ¨¡å¼</h2><p>å‡è®¾ä½ ç»è¥ä¸€å®¶å’–å•¡åº—ï¼Œæä¾›äº†åŸºæœ¬çš„å’–å•¡ï¼ˆä¾‹å¦‚ï¼šé»‘å’–å•¡ï¼‰ï¼Œä½†æ˜¯ä½ å¸Œæœ›å®¢æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å£å‘³éœ€æ±‚æ¥â€œè£…é¥°â€è‡ªå·±çš„å’–å•¡ï¼Œæ¯”å¦‚åŠ ç³–ã€åŠ å¥¶ã€åŠ å·§å…‹åŠ›ç­‰ã€‚ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ã€‚</p><h3 id="æ­¥éª¤1ï¼šå®šä¹‰ç»„ä»¶æ¥å£"><a href="#æ­¥éª¤1ï¼šå®šä¹‰ç»„ä»¶æ¥å£" class="headerlink" title="æ­¥éª¤1ï¼šå®šä¹‰ç»„ä»¶æ¥å£"></a><strong>æ­¥éª¤1ï¼šå®šä¹‰ç»„ä»¶æ¥å£</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Coffee æ¥å£ï¼šç»„ä»¶æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span>;  <span class="comment">// è®¡ç®—å’–å•¡çš„ä»·æ ¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤2ï¼šåˆ›å»ºå…·ä½“ç»„ä»¶ï¼ˆé»‘å’–å•¡ï¼‰"><a href="#æ­¥éª¤2ï¼šåˆ›å»ºå…·ä½“ç»„ä»¶ï¼ˆé»‘å’–å•¡ï¼‰" class="headerlink" title="æ­¥éª¤2ï¼šåˆ›å»ºå…·ä½“ç»„ä»¶ï¼ˆé»‘å’–å•¡ï¼‰"></a><strong>æ­¥éª¤2ï¼šåˆ›å»ºå…·ä½“ç»„ä»¶ï¼ˆé»‘å’–å•¡ï¼‰</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConcreteComponentï¼šé»‘å’–å•¡ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlackCoffee</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5.0</span>;  <span class="comment">// é»‘å’–å•¡çš„åŸºç¡€ä»·æ ¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤3ï¼šå®šä¹‰è£…é¥°å™¨ï¼ˆçˆ¶ç±»ï¼‰"><a href="#æ­¥éª¤3ï¼šå®šä¹‰è£…é¥°å™¨ï¼ˆçˆ¶ç±»ï¼‰" class="headerlink" title="æ­¥éª¤3ï¼šå®šä¹‰è£…é¥°å™¨ï¼ˆçˆ¶ç±»ï¼‰"></a><strong>æ­¥éª¤3ï¼šå®šä¹‰è£…é¥°å™¨ï¼ˆçˆ¶ç±»ï¼‰</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Decoratorï¼šè£…é¥°å™¨ç±»ï¼ŒæŒæœ‰ä¸€ä¸ª Coffee å¯¹è±¡ï¼Œå¹¶é‡å†™ cost æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CoffeeDecorator</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Coffee coffee;  <span class="comment">// æŒæœ‰ä¸€ä¸ª Coffee å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CoffeeDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.coffee = coffee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.cost();  <span class="comment">// é»˜è®¤ç›´æ¥è°ƒç”¨åŸºç¡€å’–å•¡çš„ä»·æ ¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤4ï¼šåˆ›å»ºå…·ä½“è£…é¥°å™¨ï¼ˆåŠ ç³–ã€åŠ å¥¶ç­‰ï¼‰"><a href="#æ­¥éª¤4ï¼šåˆ›å»ºå…·ä½“è£…é¥°å™¨ï¼ˆåŠ ç³–ã€åŠ å¥¶ç­‰ï¼‰" class="headerlink" title="æ­¥éª¤4ï¼šåˆ›å»ºå…·ä½“è£…é¥°å™¨ï¼ˆåŠ ç³–ã€åŠ å¥¶ç­‰ï¼‰"></a><strong>æ­¥éª¤4ï¼šåˆ›å»ºå…·ä½“è£…é¥°å™¨ï¼ˆåŠ ç³–ã€åŠ å¥¶ç­‰ï¼‰</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConcreteDecoratorï¼šåŠ ç³–çš„è£…é¥°å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SugarDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SugarDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.cost() + <span class="number">1.0</span>;  <span class="comment">// åŠ ç³–éœ€è¦é¢å¤–çš„è´¹ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ConcreteDecoratorï¼šåŠ å¥¶çš„è£…é¥°å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MilkDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MilkDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.cost() + <span class="number">1.5</span>;  <span class="comment">// åŠ å¥¶éœ€è¦é¢å¤–çš„è´¹ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤5ï¼šä½¿ç”¨è£…é¥°å™¨æ¥â€œè£…é¥°â€å’–å•¡"><a href="#æ­¥éª¤5ï¼šä½¿ç”¨è£…é¥°å™¨æ¥â€œè£…é¥°â€å’–å•¡" class="headerlink" title="æ­¥éª¤5ï¼šä½¿ç”¨è£…é¥°å™¨æ¥â€œè£…é¥°â€å’–å•¡"></a><strong>æ­¥éª¤5ï¼šä½¿ç”¨è£…é¥°å™¨æ¥â€œè£…é¥°â€å’–å•¡</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CoffeeShop</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Coffee</span> <span class="variable">coffee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlackCoffee</span>();  <span class="comment">// å…ˆè´­ä¹°ä¸€æ¯é»‘å’–å•¡</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Black Coffee cost: &quot;</span> + coffee.cost());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®¢æˆ·è¦æ±‚åŠ ç³–</span></span><br><span class="line">        coffee = <span class="keyword">new</span> <span class="title class_">SugarDecorator</span>(coffee);</span><br><span class="line">        System.out.println(<span class="string">&quot;Black Coffee with Sugar cost: &quot;</span> + coffee.cost());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®¢æˆ·åˆè¦æ±‚åŠ å¥¶</span></span><br><span class="line">        coffee = <span class="keyword">new</span> <span class="title class_">MilkDecorator</span>(coffee);</span><br><span class="line">        System.out.println(<span class="string">&quot;Black Coffee with Sugar and Milk cost: &quot;</span> + coffee.cost());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281858726.png" alt="image-20250228185837675"></p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> è£…é¥°å™¨æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>66 æ¶ˆæ¯é˜Ÿåˆ—</title>
      <link href="/2025/02/27/66%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
      <url>/2025/02/27/66%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h1 id="66-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#66-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="66 æ¶ˆæ¯é˜Ÿåˆ—"></a>66 æ¶ˆæ¯é˜Ÿåˆ—</h1><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/Dean_xiu/article/details/119942872">æ¶ˆæ¯é˜Ÿåˆ—MQå¿«é€Ÿå…¥é—¨ï¼ˆæ¦‚å¿µã€RPCã€MQå®è´¨æ€è·¯ã€é˜Ÿåˆ—ä»‹ç»ã€é˜Ÿåˆ—å¯¹æ¯”ã€åº”ç”¨åœºæ™¯ï¼‰</a></p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—å°±æ˜¯ä¸€ä¸ªä½¿ç”¨é˜Ÿåˆ—æ¥é€šä¿¡çš„ç»„ä»¶ï¼›</li><li>ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</li></ul><blockquote><p>åœ¨å®é™…çš„å•†ä¸šé¡¹ç›®ä¸­ï¼Œå®ƒè¿™ä¹ˆåšè‚¯å®šæ˜¯æœ‰é“ç†çš„ã€‚é‚£ä¹ˆæ²¡æœ‰å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å‰æœåŠ¡å­˜åœ¨å“ªäº›é—®é¢˜å‘¢ï¼Ÿå°±æ‹¿æ”¯ä»˜æœåŠ¡æ¥è¯´ï¼Œä½ æäº¤äº†ä¸€ä¸ªæ”¯ä»˜è®¢å•åï¼Œåå°éœ€è¦è¿›è¡Œæ‰£åº“å­˜ã€æ‰£æ¬¾ã€çŸ­ä¿¡é€šçŸ¥ç­‰ç­‰ï¼Œä½ éœ€è¦ç­‰å¾…åå°æŠŠæ‰€æœ‰è¯¥åšçš„åšå®Œäº†æ‰èƒ½çŸ¥é“è‡ªå·±æœ‰æ²¡æœ‰è´­ä¹°æˆåŠŸï¼Œç”¨æˆ·ç­‰ç­‰æ—¶é—´è¿‡é•¿ï¼Œåå°è¯·æ±‚é“¾å¤ªå¤šï¼Œå¾ˆå¤šä¸šåŠ¡ä¸éœ€è¦é©¬ä¸Šåšå®Œï¼Œæ¯”å¦‚çŸ­ä¿¡é€šçŸ¥ç­‰ç­‰ï¼Œè¿™äº›å“åº”é€Ÿåº¦å¯¹äºä¸šåŠ¡æ¥è¯´æ— å…³ç´§è¦ï¼Œæ‰€ä»¥å°±æå‡ºäº†å¼‚æ­¥å¤„ç†ã€‚</p><p>å¼‚æ­¥å¤„ç†å°±æ˜¯æŒ‡æˆ‘ç°åœ¨ä¸åšè¿™ä¸ªå·¥ä½œï¼Œæˆ‘æŠŠè¿™ä¸ªå·¥ä½œä¸¢ç»™ç®±å­é‡Œï¼Œæœ‰äººä¼šæ¥è¿™ä¸ªç®±å­é‡Œæ‰¾å±äºå®ƒçš„å·¥ä½œï¼Œæˆ‘ä¸¢å®Œæˆ‘çš„å·¥ä½œå°±åšå®Œäº†ï¼Œå°±å¯ä»¥ç»™ç”¨æˆ·å“åº”äº†ï¼Œè§£è€¦ï¼Œå¼‚æ­¥ï¼Œæé«˜æ€§èƒ½ã€‚</p></blockquote><p>åº”ç”¨åœ¨ï¼š<strong>æœåŠ¡è§£è€¦ã€æµé‡æ§åˆ¶</strong>ï¼Œæœ‰å¥½å¤„ä¹Ÿæœ‰åå¤„ï¼Œåå¤„å°±æ˜¯æœåŠ¡çš„ç¨³å®šæ€§é™ä½ï¼Œäººå¤šå°±ä¸å¥½æ§åˆ¶ï¼Œç³»ç»Ÿä¹Ÿä¸€æ ·ã€‚</p><p>æ¶ˆæ¯é˜Ÿåˆ—å…·æœ‰ä¸¤ç§æ¨¡å‹ï¼šé˜Ÿåˆ—æ¨¡å‹å’Œå‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹ã€‚è¿™ä¸¤ä¸ªæ¨¡å‹ç®€å•çš„æ¥è¯´å°±æ˜¯ï¼šé˜Ÿåˆ—æ¨¡å‹å³ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€å‘å¸ƒè®¢é˜…æ¨¡å‹å³ä¸€æ¡æ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚</p><p>å…¶è®¾è®¡æ¨¡å¼å°±æ˜¯ä¸€å‘ä¸€å­˜ä¸€æ¶ˆè´¹ï¼Œç”Ÿäº§è€…â€”â€”æ¶ˆè´¹è€…æ¨¡å‹ã€‚</p><h3 id="äº”ç§é˜Ÿåˆ—"><a href="#äº”ç§é˜Ÿåˆ—" class="headerlink" title="äº”ç§é˜Ÿåˆ—"></a><a href="https://www.cnblogs.com/youngdeng/p/14446456.html"><strong>äº”ç§é˜Ÿåˆ—</strong></a></h3><h4 id="ç®€å•é˜Ÿåˆ—"><a href="#ç®€å•é˜Ÿåˆ—" class="headerlink" title="ç®€å•é˜Ÿåˆ—"></a>ç®€å•é˜Ÿåˆ—</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262015061.png" alt="image-20241010103902441"></p><p>ä¸€è¨€ä»¥è”½ä¹‹ï¼šç®€å•é˜Ÿåˆ—â€”â€”ä¸€ä¸ªæ¶ˆæ¯å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…</p><h4 id="å·¥ä½œé˜Ÿåˆ—"><a href="#å·¥ä½œé˜Ÿåˆ—" class="headerlink" title="å·¥ä½œé˜Ÿåˆ—"></a>å·¥ä½œé˜Ÿåˆ—</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016701.png" alt="image-20241010103946974"></p><p><strong>ä¸€ä¸ªç”Ÿäº§è€…å¯¹åº”å¤šä¸ªæ¶ˆè´¹è€…ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è·å¾—æ¶ˆæ¯ï¼ï¼ï¼</strong></p><p><strong>ç«äº‰æ¶ˆè´¹è€…æ¨¡å¼ã€‚</strong></p><p>è¿™æ¡æ¶ˆæ¯å…·ä½“ä¼šè¢«å“ªä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹äº‹å…ˆå¹¶ä¸çŸ¥ã€‚</p><p>å¦‚ä½•åˆ†å‘æ¶ˆæ¯ä½¿ä¹‹æœ€å¤§é™åº¦çš„å‘æŒ¥æ¯ä¸€ä¸ªæ¶ˆè´¹è€…çš„æ•ˆç‡â€”â€”è´Ÿè½½å‡è¡¡ã€‚</p><h4 id="å‘å¸ƒ-è®¢é˜…æ¨¡å‹"><a href="#å‘å¸ƒ-è®¢é˜…æ¨¡å‹" class="headerlink" title="å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹"></a>å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016841.png" alt="image-20241010104244264"></p><p><strong>ä¸€ä¸ªæ¶ˆè´¹è€…å°†æ¶ˆæ¯é¦–å…ˆå‘é€åˆ°äº¤æ¢å™¨ï¼Œäº¤æ¢å™¨ç»‘å®šåˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œç„¶åè¢«ç›‘å¬è¯¥é˜Ÿåˆ—çš„æ¶ˆè´¹è€…æ‰€æ¥æ”¶å¹¶æ¶ˆè´¹ã€‚</strong></p><p>ps:Xè¡¨ç¤ºäº¤æ¢å™¨ï¼Œåœ¨RabbitMQä¸­ï¼Œäº¤æ¢å™¨ä¸»è¦æœ‰å››ç§ç±»å‹:directã€fanoutã€topicã€headersï¼Œè¿™é‡Œçš„äº¤æ¢å™¨æ˜¯ fanoutã€‚ä¸‹é¢æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»è¿™å‡ ç§äº¤æ¢å™¨ã€‚</p><h4 id="è·¯ç”±æ¨¡å¼"><a href="#è·¯ç”±æ¨¡å¼" class="headerlink" title="è·¯ç”±æ¨¡å¼"></a>è·¯ç”±æ¨¡å¼</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016157.png" alt="image-20241010104645021"></p><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°directäº¤æ¢å™¨ï¼Œåœ¨ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢å™¨çš„æ—¶å€™æœ‰ä¸€ä¸ªè·¯ç”±keyï¼Œç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ä¼šæŒ‡å®šä¸€ä¸ªè·¯ç”±keyï¼Œé‚£ä¹ˆæ¶ˆæ¯åªä¼šå‘é€åˆ°ç›¸åº”keyç›¸åŒçš„é˜Ÿåˆ—ï¼Œæ¥ç€ç›‘å¬è¯¥é˜Ÿåˆ—çš„æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€‚</p><p><strong>ä¹Ÿå°±æ˜¯è®©æ¶ˆè´¹è€…æœ‰é€‰æ‹©æ€§çš„æ¥æ”¶æ¶ˆæ¯ã€‚</strong></p><h4 id="ä¸»é¢˜æ¨¡å¼"><a href="#ä¸»é¢˜æ¨¡å¼" class="headerlink" title="ä¸»é¢˜æ¨¡å¼"></a>ä¸»é¢˜æ¨¡å¼</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016683.png" alt="image-20241010104842332"></p><p>ä¸Šé¢çš„è·¯ç”±æ¨¡å¼æ˜¯æ ¹æ®è·¯ç”±keyè¿›è¡Œå®Œæ•´çš„åŒ¹é…ï¼ˆå®Œå…¨ç›¸ç­‰æ‰å‘é€æ¶ˆæ¯ï¼‰ï¼Œè¿™é‡Œçš„é€šé…ç¬¦æ¨¡å¼é€šä¿—çš„æ¥è®²å°±æ˜¯æ¨¡ç³ŠåŒ¹é…ã€‚</p><p><strong>ç¬¦å·â€œ#â€è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯ï¼Œç¬¦å·â€œ*â€è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªè¯ã€‚</strong></p><h4 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h4><p>å‰é¢äº”ç§é˜Ÿåˆ—æ¨¡å¼ä»‹ç»å®Œäº†ï¼Œä½†æ˜¯å®é™…ä¸Šåªæœ‰ä¸‰ç§ï¼Œç¬¬ä¸€ç§ç®€å•é˜Ÿåˆ—ï¼Œç¬¬äºŒç§å·¥ä½œæ¨¡å¼ï¼Œå‰©ä¸‹çš„ä¸‰ç§éƒ½æ˜¯å’Œäº¤æ¢å™¨ç»‘å®šçš„åˆèµ·æ¥ç§°ä¸ºä¸€ç§ï¼Œè¿™å°èŠ‚æˆ‘ä»¬å°±æ¥è¯¦ç»†ä»‹ç»äº¤æ¢å™¨ã€‚</p><p>ã€€ã€€äº¤æ¢å™¨åˆ†ä¸ºå››ç§ï¼Œåˆ†åˆ«æ˜¯ï¼šdirectã€fanoutã€topicå’Œ headersã€‚</p><p>ã€€ã€€å‰é¢ä¸‰ç§åˆ†åˆ«å¯¹åº”è·¯ç”±æ¨¡å¼ã€å‘å¸ƒè®¢é˜…æ¨¡å¼å’Œé€šé…ç¬¦æ¨¡å¼ï¼Œheaders äº¤æ¢å™¨å…è®¸åŒ¹é… AMQP æ¶ˆæ¯çš„ header è€Œéè·¯ç”±é”®ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œheader äº¤æ¢å™¨å’Œ direct äº¤æ¢å™¨å®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯æ€§èƒ½å´å·®å¾ˆå¤šï¼Œå› æ­¤åŸºæœ¬ä¸Šä¸ä¼šç”¨åˆ°è¯¥äº¤æ¢å™¨ï¼Œè¿™é‡Œä¹Ÿä¸è¯¦ç»†ä»‹ç»ã€‚</p><p>ã€€ã€€<strong>â‘ ã€direct</strong></p><p>ã€€ã€€å¦‚æœè·¯ç”±é”®å®Œå…¨åŒ¹é…çš„è¯ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«æŠ•æ”¾åˆ°ç›¸åº”çš„é˜Ÿåˆ—ã€‚</p><p> ã€€<img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016021.png" alt="img"></p><p>ã€€ã€€<strong>â‘¡ã€fanout</strong></p><p>ã€€ã€€å½“å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°fanoutäº¤æ¢å™¨ä¸Šæ—¶ï¼Œå®ƒä¼šæŠŠæ¶ˆæ¯æŠ•æ”¾åˆ°æ‰€æœ‰é™„åŠ åœ¨æ­¤äº¤æ¢å™¨ä¸Šçš„é˜Ÿåˆ—ã€‚</p><p> ã€€<img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016623.png" alt="img"></p><p>ã€€ã€€<strong>â‘¢ã€topic</strong></p><p>ã€€ã€€è®¾ç½®æ¨¡ç³Šçš„ç»‘å®šæ–¹å¼ï¼Œâ€œ*â€æ“ä½œç¬¦å°†â€œ.â€è§†ä¸ºåˆ†éš”ç¬¦ï¼ŒåŒ¹é…å•ä¸ªå­—ç¬¦ï¼›â€œ#â€æ“ä½œç¬¦æ²¡æœ‰åˆ†å—çš„æ¦‚å¿µï¼Œå®ƒå°†ä»»æ„â€œ.â€å‡è§†ä¸ºå…³é”®å­—çš„åŒ¹é…éƒ¨åˆ†ï¼Œèƒ½å¤ŸåŒ¹é…å¤šä¸ªå­—ç¬¦ã€‚</p><h3 id="å¸¸ç”¨6ç§æ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»å’Œå¯¹æ¯”"><a href="#å¸¸ç”¨6ç§æ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»å’Œå¯¹æ¯”" class="headerlink" title="å¸¸ç”¨6ç§æ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»å’Œå¯¹æ¯”"></a>å¸¸ç”¨6ç§æ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»å’Œå¯¹æ¯”</h3><h4 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016935.png" alt="image-20241013145858213"></p><p>RabbitMQæ˜¯æµè¡Œçš„å¼€æºæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œ<strong>ç”¨erlangè¯­è¨€å¼€å‘</strong>ã€‚RabbitMQæ˜¯AMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰çš„æ ‡å‡†å®ç°ã€‚æ”¯æŒå¤šç§å®¢æˆ·ç«¯ï¼Œå¦‚ï¼šPythonã€Rubyã€.NETã€Javaã€JMSã€Cã€PHPã€ActionScriptã€XMPPã€STOMPç­‰ï¼Œæ”¯æŒAJAXï¼ŒæŒä¹…åŒ–ã€‚ç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ï¼Œåœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€é«˜å¯ç”¨æ€§ç­‰æ–¹é¢è¡¨ç°ä¸ä¿—ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016086.png" alt="image-20241013150152976"></p><h4 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h4><p>ActiveMQ æ˜¯Apacheå‡ºå“ï¼Œæœ€æµè¡Œçš„ï¼Œèƒ½åŠ›å¼ºåŠ²çš„å¼€æºæ¶ˆæ¯æ€»çº¿ã€‚å¯¹Springçš„æ”¯æŒï¼ŒActiveMQå¯ä»¥å¾ˆå®¹æ˜“å†…åµŒåˆ°ä½¿ç”¨Springçš„ç³»ç»Ÿé‡Œé¢å»ï¼Œè€Œä¸”ä¹Ÿæ”¯æŒSpring2.0çš„ç‰¹æ€§</p><h4 id="ZeroMQ"><a href="#ZeroMQ" class="headerlink" title="ZeroMQ"></a>ZeroMQ</h4><p>å·ç§°å²ä¸Šæœ€å¿«çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒå®é™…ç±»ä¼¼äºSocketçš„ä¸€ç³»åˆ—æ¥å£ï¼Œä»–è·ŸSocketçš„åŒºåˆ«æ˜¯ï¼šæ™®é€šçš„socketæ˜¯ç«¯åˆ°ç«¯çš„ï¼ˆ1:1çš„å…³ç³»ï¼‰ï¼Œè€ŒZMQå´æ˜¯å¯ä»¥Nï¼šM çš„å…³ç³»ï¼Œäººä»¬å¯¹BSDå¥—æ¥å­—çš„äº†è§£è¾ƒå¤šçš„æ˜¯ç‚¹å¯¹ç‚¹çš„è¿æ¥ï¼Œç‚¹å¯¹ç‚¹è¿æ¥éœ€è¦æ˜¾å¼åœ°å»ºç«‹è¿æ¥ã€é”€æ¯è¿æ¥ã€é€‰æ‹©åè®®ï¼ˆTCP&#x2F;UDPï¼‰å’Œå¤„ç†é”™è¯¯ç­‰ï¼Œè€ŒZMQå±è”½äº†è¿™äº›ç»†èŠ‚ï¼Œè®©ä½ çš„ç½‘ç»œç¼–ç¨‹æ›´ä¸ºç®€å•ã€‚ZMQç”¨äºnodeä¸nodeé—´çš„é€šä¿¡ï¼Œnodeå¯ä»¥æ˜¯ä¸»æœºæˆ–è€…æ˜¯è¿›ç¨‹ã€‚</p><h4 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h4><h5 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h5><ul><li>åˆ†å¸ƒå¼æ¶ˆæ¯å‘å¸ƒè®¢é˜…ç³»ç»Ÿï¼Œå…¶åˆ†åŒºç‰¹æ€§ã€å¯å¤åˆ¶å’Œå¯å®¹é”™éƒ½æ˜¯å…¶ä¸é”™çš„ç‰¹æ€§</li><li>å¿«é€ŸæŒä¹…åŒ–ï¼Œå¯åœ¨O(1)çš„ç³»ç»Ÿå¼€é”€ä¸‹è¿›è¡Œæ¶ˆæ¯æŒä¹…åŒ–</li><li>é«˜ååï¼Œåœ¨ä¸€å°æ™®é€šçš„æœåŠ¡å™¨ä¸Šå°±å¯ä»¥è¾¾åˆ°10W&#x2F;sçš„ååç‡</li><li>å®Œå…¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒBrokerã€Producerã€Consumeréƒ½åŸç”Ÿè‡ªåŠ¨æ”¯æŒåˆ†å¸ƒå¼ã€è‡ªåŠ¨å®ç°è´Ÿè½½å‡è¡¡</li><li>æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥å¤åˆ¶ä¸¤ç§</li><li>æ”¯æŒæ•°æ®æ‰¹é‡å‘é€å’Œæ‹‰å–</li><li>zero-copyï¼šå‡å°‘IOæ“ä½œæ­¥éª¤</li><li>æ•°æ®è¿ç§»ã€æ‰©å®¹å¯¹ç”¨æˆ·é€æ˜</li><li>æ— éœ€åœæœºå³å¯æ‰©å±•æœºå™¨</li><li>å…¶ä»–ç‰¹æ€§ï¼šä¸¥æ ¼çš„æ¶ˆæ¯é¡ºåºã€ä¸°å¯Œçš„æ¶ˆæ¯æ‹‰å–æœºåˆ¶ã€é«˜æ•ˆè®¢é˜…è€…æ°´å¹³æ‰©å±•ã€å®æ—¶çš„æ¶ˆæ¯è®¢é˜…ã€äº¿çº§çš„æ¶ˆæ¯å †ç§¯èƒ½åŠ›ã€å®šæœŸåˆ é™¤æœºåˆ¶</li></ul><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>å®¢æˆ·ç«¯è¯­è¨€ä¸°å¯Œ</li><li>æ€§èƒ½å“è¶Šã€å•æœºå†™å…¥TPSçº¦åœ¨ç™¾ä¸‡çº§&#x2F;ç§’ï¼Œæ¶ˆæ¯å¤§å°ä¸º10ä¸ªå­—èŠ‚</li><li>æä¾›å®Œå…¨åˆ†å¸ƒå¼æ¶æ„ï¼Œå¹¶æœ‰replicaæœºåˆ¶ï¼Œæ‹¥æœ‰è¾ƒé«˜çš„å¯ç”¨æ€§å’Œå¯é æ€§ï¼Œç†è®ºä¸Šæ”¯æŒæ¶ˆæ¯æ— é™å †ç§¯</li><li>æ”¯æŒæ‰¹é‡æ“ä½œ</li><li>æ¶ˆè´¹è€…é‡‡ç”¨Pullæ–¹å¼è·å–æ¶ˆæ¯ï¼Œæ¶ˆæ¯æœ‰åºï¼Œé€šè¿‡æ§åˆ¶èƒ½å¤Ÿä¿è¯æ‰€æœ‰æ¶ˆæ¯è¢«æ¶ˆè´¹ä¸”ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡</li><li>æœ‰ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹Kafka Webç®¡ç†ç•Œé¢kafka-Manager</li><li>åœ¨æ—¥å¿—é¢†åŸŸæ¯”è¾ƒæˆç†Ÿï¼Œè¢«å¤šå®¶å…¬å¸å’Œå¤šä¸ªå¼€æºé¡¹ç›®ä½¿ç”¨</li></ul><h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>Kafkaå•æœºè¶…è¿‡64ä¸ªé˜Ÿåˆ—&#x2F;åˆ†åŒºï¼ŒLoadä¼šå‘ç”Ÿæ˜æ˜¾çš„é£™é«˜ç°è±¡ï¼Œé˜Ÿåˆ—è¶Šå¤šï¼Œloadè¶Šé«˜ï¼Œå‘é€æ¶ˆæ¯å“åº”æ—¶é—´å˜é•¿</li><li>ä½¿ç”¨çŸ­è½®è¯¢æ–¹å¼ï¼Œå®æ—¶æ€§å–å†³äºè½®è¯¢é—´éš”æ—¶é—´</li><li>æ¶ˆè´¹å¤±è´¥ä¸æ”¯æŒé‡è¯•</li><li>æ”¯æŒæ¶ˆæ¯é¡ºåºï¼Œä½†æ˜¯ä¸€å°ä»£ç†å®•æœºåï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ä¹±åº</li></ul><h4 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h4><h5 id="ç‰¹å¾-1"><a href="#ç‰¹å¾-1" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h5><ul><li>å…·æœ‰é«˜æ€§èƒ½ã€é«˜å¯é ã€é«˜å®æ—¶ã€åˆ†å¸ƒå¼ç‰¹ç‚¹</li><li>Producerã€Consumerã€é˜Ÿåˆ—éƒ½å¯ä»¥åˆ†å¸ƒå¼</li><li>Producerå‘ä¸€äº›é˜Ÿåˆ—è½®æµå‘é€æ¶ˆæ¯ï¼Œé˜Ÿåˆ—é›†åˆç§°ä¸ºTopicï¼ŒConsumerå¦‚æœåšå¹¿æ’­æ¶ˆè´¹ï¼Œåˆ™ä¸€ä¸ªconsumerå®ä¾‹æ¶ˆè´¹è¿™ä¸ªTopicå¯¹åº”çš„æ‰€æœ‰é˜Ÿåˆ—ï¼Œå¦‚æœåšé›†ç¾¤æ¶ˆè´¹ï¼Œåˆ™å¤šä¸ªConsumerå®ä¾‹å¹³å‡æ¶ˆè´¹è¿™ä¸ªtopicå¯¹åº”çš„é˜Ÿåˆ—é›†åˆ</li><li>èƒ½å¤Ÿä¿è¯ä¸¥æ ¼çš„æ¶ˆæ¯é¡ºåº</li><li>æä¾›ä¸°å¯Œçš„æ¶ˆæ¯æ‹‰å–æ¨¡å¼</li><li>é«˜æ•ˆçš„è®¢é˜…è€…æ°´å¹³æ‰©å±•èƒ½åŠ›</li><li>å®æ—¶çš„æ¶ˆæ¯è®¢é˜…æœºåˆ¶</li><li>äº¿çº§æ¶ˆæ¯å †ç§¯èƒ½åŠ›</li><li>è¾ƒå°‘çš„ä¾èµ–</li><li>å¯ä»¥è¿è¡Œåœ¨Javaè¯­è¨€æ‰€æ”¯æŒçš„å¹³å°ä¹‹ä¸Š</li></ul><h5 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>å•æœºæ”¯æŒ1ä¸‡ä»¥ä¸ŠæŒä¹…åŒ–é˜Ÿåˆ—</li><li>æ‰€æœ‰æ¶ˆæ¯éƒ½æ˜¯æŒä¹…åŒ–çš„ï¼Œå…ˆå†™å…¥ç³»ç»ŸPageCacheï¼Œç„¶ååˆ·ç›˜ï¼Œå¯ä»¥ä¿è¯å†…å­˜å’Œç£ç›˜éƒ½æœ‰ä¸€ä»½æ•°æ®ï¼Œè®¿é—®æ—¶ï¼Œç›´æ¥ä»å†…å­˜å–</li><li>æ¨¡å‹ç®€å•ï¼Œæ¥å£æ˜“ç”¨</li><li>æ€§èƒ½ä¼˜è¶Šï¼Œå¯ä»¥å¤§é‡å †ç§¯æ¶ˆæ¯åœ¨brokerä¸­</li><li>æ”¯æŒå¤šç§æ¶ˆè´¹ï¼ŒåŒ…æ‹¬é›†ç¾¤æ¶ˆè´¹ï¼Œå¹¿æ’­æ¶ˆè´¹ç­‰</li><li>å„ä¸ªç¯èŠ‚åˆ†å¸ƒå¼æ‰©å±•è®¾è®¡</li><li>å¼€å‘éƒ½è¾ƒæ´»è·ƒï¼Œç‰ˆæœ¬æ›´æ–°å¿«</li></ul><h5 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>æ²¡æœ‰webç®¡ç†ç•Œé¢ï¼Œæä¾›äº†ä¸€ä¸ªCLIç®¡ç†å·¥å…·æ¥æŸ¥è¯¢ã€ç®¡ç†å’Œè¯Šæ–­å„ç§é—®é¢˜</li><li>æ²¡æœ‰åœ¨MQæ ¸å¿ƒå»å®ç°JMSç­‰æ¥å£</li></ul><h4 id="é€‰æ‹©"><a href="#é€‰æ‹©" class="headerlink" title="é€‰æ‹©"></a>é€‰æ‹©</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016781.png" alt="image-20241013150748148"></p><ul><li>ActiveMQï¼Œæœ€æ—©çš„æ—¶å€™å¤§å®¶éƒ½ç”¨ï¼Œä½†ç°åœ¨ç”¨çš„ä¸æ˜¯å¾ˆå¤šäº†ï¼Œæ²¡ç»è¿‡å¤§è§„æ¨¡ååé‡åœºæ™¯çš„éªŒè¯ï¼Œç¤¾åŒºä¸æ˜¯å¾ˆæ´»è·ƒï¼Œä¸»æµä¸Šä¸é€‰æ‹©è¿™ä¸ª</li><li>RabbitMQè¾ƒä¸ºæˆç†Ÿä¸€äº›ï¼Œåœ¨å¯ç”¨æ€§ã€ç¨³å®šæ€§ã€å¯é æ€§ä¸Šï¼ŒRabbitMQéƒ½è¦è¶…è¿‡kafkaï¼Œç»¼åˆæ€§èƒ½ä¸é”™ï¼Œä½†æ˜¯erlangè¯­è¨€é˜»æ­¢äº†å¤§é‡javaå·¥ç¨‹å¸ˆæ·±å…¥ç ”ç©¶ï¼Œä¸”ä¸æ”¯æŒäº‹åŠ¡ï¼Œæ¶ˆæ¯ååèƒ½åŠ›æœ‰é™</li><li>Kafkaçš„æ€§èƒ½æ˜¯æ¯”RabbitMQè¦æ›´å¼ºçš„ï¼ŒRabbitMQåœ¨æœ‰å¤§é‡çš„æ¶ˆæ¯å †ç§¯æ—¶ï¼Œæ€§èƒ½ä¼šä¸‹é™ï¼Œè€ŒKafkaä¸ä¼šï¼Œä½†æ˜¯Kafkaçš„è®¾è®¡åˆè¡·æ˜¯å¤„ç†æ—¥å¿—çš„ï¼Œå¯ä»¥çœ‹åšä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œé’ˆå¯¹æ€§éå¸¸å¼ºï¼Œæ²¡æœ‰å…·å¤‡ä¸€ä¸ªæˆç†ŸMQåº”è¯¥å…·å¤‡çš„ç‰¹æ€§ï¼Œå®ƒè¿˜æ˜¯ä¸ªå­©å­å•Š</li><li>RocketMQçš„æ€è·¯èµ·æºäºKafka,ä½†å®ƒå¯¹æ¶ˆæ¯çš„å¯é ä¼ è¾“åŠäº‹åŠ¡æ€§åšäº†ä¼˜åŒ–ï¼Œé€‚åˆä¸€äº›å¤§è§„æ¨¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿåº”ç”¨ï¼Œä½†æ˜¯ç”Ÿæ€ä¸å¤Ÿæˆç†Ÿï¼Œä¼šæœ‰é»„æ‰çš„é£é™©</li><li>ZeroMQåªæ˜¯ä¸€ä¸ªç½‘ç»œç¼–ç¨‹çš„Patternåº“ï¼Œå°†å¸¸è§çš„ç½‘ç»œè¯·æ±‚å½¢å¼ï¼ˆåˆ†ç»„ç®¡ç†ã€é“¾æ¥ç®¡ç†ã€å‘å¸ƒè®¢é˜…ç­‰ï¼‰è¿›è¡Œæ¨¡å¼åŒ–ã€ç»„ä»¶åŒ–ã€‚ç®€å•æ¥è¯´å°±æ˜¯åœ¨socketä¹‹ä¸Šã€MQä¹‹ä¸‹ã€‚ä½¿ç”¨ZeroMQçš„è¯ï¼Œéœ€è¦å¯¹è‡ªå·±çš„ä¸šåŠ¡ä»£ç è¿›è¡Œæ”¹é€ ï¼Œä¸åˆ©äºæœåŠ¡è§£è€¦</li></ul><h3 id="æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"><a href="#æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"></a>æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</h3><h4 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°é¡ºåºæ··ä¹±"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°é¡ºåºæ··ä¹±" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°é¡ºåºæ··ä¹±"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°é¡ºåºæ··ä¹±</h4><p>æ ¹æœ¬åŸå› æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ä¸­å­˜åœ¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦ä¸ä¸€å®šï¼Œå¯èƒ½å¯¼è‡´åæäº¤çš„æ¶ˆæ¯å´å…ˆè¢«æ¶ˆè´¹äº†ã€‚åœ¨ç”Ÿäº§ä¸­ç»å¸¸ä¼šæœ‰ä¸€äº›ç±»ä¼¼æŠ¥è¡¨ç³»ç»Ÿè¿™æ ·çš„ç³»ç»Ÿï¼Œéœ€è¦åš MySQL çš„ binlog åŒæ­¥ã€‚æ¯”å¦‚è®¢å•ç³»ç»Ÿè¦åŒæ­¥è®¢å•è¡¨çš„æ•°æ®åˆ°å¤§æ•°æ®éƒ¨é—¨çš„ MySQL åº“ä¸­ç”¨äºæŠ¥è¡¨ç»Ÿè®¡åˆ†æï¼Œé€šå¸¸çš„åšæ³•æ˜¯åŸºäº Canal è¿™æ ·çš„ä¸­é—´ä»¶å»ç›‘å¬è®¢å•æ•°æ®åº“çš„ binlogï¼Œç„¶åæŠŠè¿™äº› binlog å‘é€åˆ° MQ ä¸­ï¼Œå†ç”±æ¶ˆè´¹è€…ä» MQ ä¸­è·å– binlog è½åœ°åˆ°å¤§æ•°æ®éƒ¨é—¨çš„ MySQL ä¸­ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæœ‰å¯¹æŸä¸ªè®¢å•çš„å¢åˆ æ”¹æ“ä½œï¼Œæ¯”å¦‚æœ‰ä¸‰æ¡ binlog æ‰§è¡Œé¡ºåºæ˜¯å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ï¼›æ¶ˆè´¹è€…æ„£æ˜¯æ¢äº†é¡ºåºç»™æ‰§è¡Œæˆåˆ é™¤ã€ä¿®æ”¹ã€å¢åŠ ï¼Œè¿™æ ·èƒ½è¡Œå—ï¼Ÿè‚¯å®šæ˜¯ä¸è¡Œçš„</p><h4 id="RabbitMQæ¶ˆæ¯é¡ºåºé”™ä¹±"><a href="#RabbitMQæ¶ˆæ¯é¡ºåºé”™ä¹±" class="headerlink" title="RabbitMQæ¶ˆæ¯é¡ºåºé”™ä¹±"></a>RabbitMQæ¶ˆæ¯é¡ºåºé”™ä¹±</h4><p>å¯¹äº RabbitMQ æ¥è¯´ï¼Œ<strong>å¯¼è‡´ä¸Šé¢é¡ºåºé”™ä¹±çš„åŸå› é€šå¸¸æ˜¯æ¶ˆè´¹è€…æ˜¯é›†ç¾¤éƒ¨ç½²</strong>ï¼Œä¸åŒçš„æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°äº†åŒä¸€è®¢å•çš„ä¸åŒçš„æ¶ˆæ¯ï¼Œå¦‚æ¶ˆè´¹è€… A æ‰§è¡Œäº†å¢åŠ ï¼Œæ¶ˆè´¹è€… B æ‰§è¡Œäº†ä¿®æ”¹ï¼Œæ¶ˆè´¹è€… C æ‰§è¡Œäº†åˆ é™¤ï¼Œä½†æ˜¯æ¶ˆè´¹è€… C æ‰§è¡Œæ¯”æ¶ˆè´¹è€… B å¿«ï¼Œæ¶ˆè´¹è€… B åˆæ¯”æ¶ˆè´¹è€… A å¿«ï¼Œå°±ä¼šå¯¼è‡´æ¶ˆè´¹ binlog æ‰§è¡Œåˆ°æ•°æ®åº“çš„æ—¶å€™é¡ºåºé”™ä¹±ï¼Œæœ¬è¯¥é¡ºåºæ˜¯å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ï¼Œå˜æˆäº†åˆ é™¤ã€ä¿®æ”¹ã€å¢åŠ ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281322544.png" alt="img"></p><h4 id="Kafka-æ¶ˆæ¯é¡ºåºé”™ä¹±"><a href="#Kafka-æ¶ˆæ¯é¡ºåºé”™ä¹±" class="headerlink" title="Kafka æ¶ˆæ¯é¡ºåºé”™ä¹±"></a>Kafka æ¶ˆæ¯é¡ºåºé”™ä¹±</h4><p>å¯¹äº Kafka æ¥è¯´ï¼Œä¸€ä¸ª topic ä¸‹åŒä¸€ä¸ª partition ä¸­çš„æ¶ˆæ¯è‚¯å®šæ˜¯æœ‰åºçš„ï¼Œç”Ÿäº§è€…åœ¨å†™çš„æ—¶å€™å¯ä»¥æŒ‡å®šä¸€ä¸ª keyï¼Œé€šè¿‡æˆ‘ä»¬ä¼šç”¨è®¢å•å·ä½œä¸º keyï¼Œè¿™ä¸ª key å¯¹åº”çš„æ¶ˆæ¯éƒ½ä¼šå‘é€åˆ°åŒä¸€ä¸ª partition ä¸­ï¼Œæ‰€ä»¥æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯ä¹Ÿä¸€å®šæ˜¯æœ‰åºçš„ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆ Kafka è¿˜ä¼šå­˜åœ¨æ¶ˆæ¯é”™ä¹±çš„é—®é¢˜å‘¢ï¼Ÿé—®é¢˜å°±å‡ºåœ¨æ¶ˆè´¹è€…èº«ä¸Šã€‚é€šå¸¸æˆ‘ä»¬æ¶ˆè´¹åˆ°åŒä¸€ä¸ª key çš„å¤šæ¡æ¶ˆæ¯åï¼Œä¼šä½¿ç”¨å¤šçº¿ç¨‹æŠ€æœ¯å»å¹¶å‘å¤„ç†æ¥æé«˜æ¶ˆæ¯å¤„ç†é€Ÿåº¦ï¼Œå¦åˆ™ä¸€æ¡æ¶ˆæ¯çš„å¤„ç†éœ€è¦è€—æ—¶å‡ å msï¼Œ1 ç§’ä¹Ÿå°±åªèƒ½å¤„ç†å‡ åæ¡æ¶ˆæ¯ï¼Œååé‡å°±å¤ªä½äº†ã€‚è€Œå¤šçº¿ç¨‹å¹¶å‘å¤„ç†çš„è¯ï¼Œbinlog æ‰§è¡Œåˆ°æ•°æ®åº“çš„æ—¶å€™å°±ä¸ä¸€å®šè¿˜æ˜¯åŸæ¥çš„é¡ºåºäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281325804.png" alt="img"></p><h4 id="RocketMQ-æ¶ˆæ¯é¡ºåºé”™ä¹±"><a href="#RocketMQ-æ¶ˆæ¯é¡ºåºé”™ä¹±" class="headerlink" title="RocketMQ æ¶ˆæ¯é¡ºåºé”™ä¹±"></a>RocketMQ æ¶ˆæ¯é¡ºåºé”™ä¹±</h4><p>å¯¹äº RocketMQ æ¥è¯´ï¼Œæ¯ä¸ª Topic å¯ä»¥æŒ‡å®šå¤šä¸ª MessageQueueï¼Œå½“æˆ‘ä»¬å†™å…¥æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¼šæŠŠæ¶ˆæ¯å‡åŒ€åœ°åˆ†å‘åˆ°ä¸åŒçš„ MessageQueue ä¸­ï¼Œæ¯”å¦‚åŒä¸€ä¸ªè®¢å•å·çš„æ¶ˆæ¯ï¼Œå¢åŠ  binlog å†™å…¥åˆ° MessageQueue1 ä¸­ï¼Œä¿®æ”¹ binlog å†™å…¥åˆ° MessageQueue2 ä¸­ï¼Œåˆ é™¤ binlog å†™å…¥åˆ° MessageQueue3 ä¸­ã€‚</p><p>ä½†æ˜¯å½“æ¶ˆè´¹è€…æœ‰å¤šå°æœºå™¨çš„æ—¶å€™ï¼Œä¼šç»„æˆä¸€ä¸ª Consumer Groupï¼ŒConsumer Group ä¸­çš„æ¯å°æœºå™¨éƒ½ä¼šè´Ÿè´£æ¶ˆè´¹ä¸€éƒ¨åˆ† MessageQueue çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥å¯èƒ½æ¶ˆè´¹è€… A æ¶ˆè´¹äº† MessageQueue1 çš„æ¶ˆæ¯æ‰§è¡Œå¢åŠ æ“ä½œï¼Œæ¶ˆè´¹è€… B æ¶ˆè´¹äº† MessageQueue2 çš„æ¶ˆæ¯æ‰§è¡Œä¿®æ”¹æ“ä½œï¼Œæ¶ˆè´¹è€… C æ¶ˆè´¹äº† MessageQueue3 çš„æ¶ˆæ¯æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œä½†æ˜¯æ­¤æ—¶æ¶ˆè´¹ binlog æ‰§è¡Œåˆ°æ•°æ®åº“çš„æ—¶å€™å°±ä¸ä¸€å®šæ˜¯æ¶ˆè´¹è€… A å…ˆæ‰§è¡Œäº†ï¼Œæœ‰å¯èƒ½æ¶ˆè´¹è€… C å…ˆæ‰§è¡Œåˆ é™¤æ“ä½œï¼Œå› ä¸ºå‡ å°æ¶ˆè´¹è€…æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œæ˜¯ä¸èƒ½å¤Ÿä¿è¯ä»–ä»¬ä¹‹é—´çš„æ‰§è¡Œé¡ºåºçš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281326416.png" alt="img"></p><h4 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"><a href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"></a>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</h4><p>çŸ¥é“äº†ä¸ºä»€ä¹ˆä¼šå‡ºç°é¡ºåºé”™ä¹±ä¹‹åï¼Œå°±è¦æƒ³åŠæ³•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§äº†ã€‚ä»å‰é¢å¯ä»¥çŸ¥é“ï¼Œé¡ºåºé”™ä¹±è¦ä¹ˆæ˜¯<strong>ç”±äºå¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åˆ°äº†åŒä¸€ä¸ªè®¢å•å·çš„ä¸åŒæ¶ˆæ¯</strong>ï¼Œ<strong>è¦ä¹ˆæ˜¯ç”±äºåŒä¸€ä¸ªè®¢å•å·çš„æ¶ˆæ¯åˆ†å‘åˆ°äº† MQ ä¸­çš„ä¸åŒæœºå™¨ä¸­</strong>ã€‚ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯æ¶ˆæ¯é¡ºåºæ€§çš„æ–¹æ¡ˆä¹Ÿå„ä¸ç›¸åŒã€‚</p><h4 id="RabbitMQ-ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§"><a href="#RabbitMQ-ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§" class="headerlink" title="RabbitMQ ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§"></a>RabbitMQ ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§</h4><p>RabbitMQ çš„é—®é¢˜æ˜¯ç”±äºä¸åŒçš„æ¶ˆæ¯éƒ½å‘é€åˆ°äº†åŒä¸€ä¸ª queue ä¸­ï¼Œå¤šä¸ªæ¶ˆè´¹è€…éƒ½æ¶ˆè´¹åŒä¸€ä¸ª queue çš„æ¶ˆæ¯ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ RabbitMQ åˆ›å»ºå¤šä¸ª queueï¼Œæ¯ä¸ªæ¶ˆè´¹è€…å›ºå®šæ¶ˆè´¹ä¸€ä¸ª queue çš„æ¶ˆæ¯ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªè®¢å•å·çš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€ä¸ª queue ä¸­ï¼Œç”±äºåŒä¸€ä¸ª queue çš„æ¶ˆæ¯æ˜¯ä¸€å®šä¼šä¿è¯æœ‰åºçš„ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªè®¢å•å·çš„æ¶ˆæ¯å°±åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…é¡ºåºæ¶ˆè´¹ï¼Œä»è€Œä¿è¯äº†æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚</p><p>å¦‚ä¸‹å›¾æ˜¯ RabbitMQ ä¿è¯æ¶ˆæ¯é¡ºåºæ€§çš„æ–¹æ¡ˆï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281329874.png" alt="img"></p><p>ä¿è¯å•æ¶ˆè´¹è€…å•ç‹¬æ¶ˆè´¹ã€‚</p><h4 id="Kafka-ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§"><a href="#Kafka-ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§" class="headerlink" title="Kafka ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§"></a>Kafka ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§</h4><p>Kafka ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯è¿™ä¸€æ•´ä¸ªè¿‡ç¨‹å…¶å®éƒ½æ˜¯å¯ä»¥ä¿è¯æœ‰åºçš„ï¼Œå¯¼è‡´æœ€ç»ˆä¹±åºæ˜¯ç”±äºæ¶ˆè´¹è€…ç«¯éœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘å¤„ç†æ¶ˆæ¯æ¥æé«˜ååé‡ï¼Œæ¯”å¦‚æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°äº†æ¶ˆæ¯ä»¥åï¼Œå¼€å¯ 32 ä¸ªçº¿ç¨‹å¤„ç†æ¶ˆæ¯ï¼Œæ¯ä¸ªçº¿ç¨‹çº¿ç¨‹å¤„ç†æ¶ˆæ¯çš„å¿«æ…¢æ˜¯ä¸ä¸€è‡´çš„ï¼Œæ‰€ä»¥æ‰ä¼šå¯¼è‡´æœ€ç»ˆæ¶ˆæ¯æœ‰å¯èƒ½ä¸ä¸€è‡´ã€‚</p><p>æ‰€ä»¥å¯¹äº Kafka çš„æ¶ˆæ¯é¡ºåºæ€§ä¿è¯ï¼Œå…¶å®æˆ‘ä»¬åªéœ€è¦ä¿è¯åŒä¸€ä¸ªè®¢å•å·çš„æ¶ˆæ¯åªè¢«åŒä¸€ä¸ªçº¿ç¨‹å¤„ç†çš„å°±å¯ä»¥äº†ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥åœ¨çº¿ç¨‹å¤„ç†å‰å¢åŠ ä¸ªå†…å­˜é˜Ÿåˆ—ï¼Œæ¯ä¸ªçº¿ç¨‹åªè´Ÿè´£å¤„ç†å…¶ä¸­ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼ŒåŒä¸€ä¸ªè®¢å•å·çš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­å³å¯ã€‚</p><p>å¦‚ä¸‹å›¾æ˜¯ Kafka ä¿è¯æ¶ˆæ¯é¡ºåºæ€§çš„æ–¹æ¡ˆï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281331199.png" alt="img"></p><h4 id="RocketMQ-ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§"><a href="#RocketMQ-ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§" class="headerlink" title="RocketMQ ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§"></a>RocketMQ ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§</h4><p>RocketMQ çš„æ¶ˆæ¯ä¹±åºæ˜¯ç”±äºåŒä¸€ä¸ªè®¢å•å·çš„ binlog è¿›å…¥äº†ä¸åŒçš„ MessageQueueï¼Œè¿›è€Œå¯¼è‡´ä¸€ä¸ªè®¢å•çš„ binlog è¢«ä¸åŒæœºå™¨ä¸Šçš„ Consumer å¤„ç†ã€‚</p><p>è¦è§£å†³ RocketMQ çš„ä¹±åºé—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦æƒ³åŠæ³•è®©åŒä¸€ä¸ªè®¢å•çš„ binlog è¿›å…¥åˆ°åŒä¸€ä¸ª MessageQueue ä¸­å°±å¯ä»¥äº†ã€‚å› ä¸ºåŒä¸€ä¸ª MessageQueue å†…çš„æ¶ˆæ¯æ˜¯ä¸€å®šæœ‰åºçš„ï¼Œä¸€ä¸ª MessageQueue ä¸­çš„æ¶ˆæ¯åªèƒ½äº¤ç»™ä¸€ä¸ª Consumer æ¥è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥ Consumer æ¶ˆè´¹çš„æ—¶å€™å°±ä¸€å®šä¼šæ˜¯æœ‰åºçš„ã€‚</p><p>å¦‚ä¸‹å›¾æ˜¯ RocketMQ ä¿è¯æ¶ˆæ¯é¡ºåºæ€§çš„æ–¹æ¡ˆï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281333418.png" alt="img"></p><hr><h3 id="æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹æ—¶çš„å¹‚ç­‰æ€§"><a href="#æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹æ—¶çš„å¹‚ç­‰æ€§" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹æ—¶çš„å¹‚ç­‰æ€§"></a>æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹æ—¶çš„å¹‚ç­‰æ€§</h3><p>å¹‚ç­‰æ€§ï¼Œé€šä¿—ç‚¹è¯´ï¼Œå°±<strong>ä¸€ä¸ªæ•°æ®ï¼Œæˆ–è€…ä¸€ä¸ªè¯·æ±‚ï¼Œç»™ä½ é‡å¤æ¥å¤šæ¬¡ï¼Œä½ å¾—ç¡®ä¿å¯¹åº”çš„æ•°æ®æ˜¯ä¸ä¼šæ”¹å˜çš„</strong>ï¼Œä¸èƒ½å‡ºé”™ã€‚</p><p><strong>éœ€è¦è®©ç”Ÿäº§è€…å‘é€æ¯æ¡æ•°æ®çš„æ—¶å€™ï¼Œé‡Œé¢åŠ ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„idï¼Œç±»ä¼¼è®¢å•idä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶åä½ è¿™é‡Œæ¶ˆè´¹åˆ°äº†ä¹‹åï¼Œå…ˆæ ¹æ®è¿™ä¸ªidå»æ¯”å¦‚redisé‡ŒæŸ¥ä¸€ä¸‹ï¼Œä¹‹å‰æ¶ˆè´¹è¿‡å—ï¼Ÿå¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡ï¼Œä½ å°±å¤„ç†ï¼Œç„¶åè¿™ä¸ªidå†™redisã€‚å¦‚æœæ¶ˆè´¹è¿‡äº†ï¼Œé‚£ä½ å°±åˆ«å¤„ç†äº†ï¼Œä¿è¯åˆ«é‡å¤å¤„ç†ç›¸åŒçš„æ¶ˆæ¯å³å¯ã€‚</strong></p><p>æ–¹æ¡ˆå°±æ˜¯æ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ï¼Œæ¯”å¦‚UUIDä¹‹ç±»çš„ï¼Œåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹ä¹‹å‰å…ˆåˆ¤æ–­ä¸€ä¸‹è¯¥UUIDæ˜¯å¦æ¶ˆè´¹è¿‡ï¼Œæ¶ˆè´¹è¿‡ä¹‹åè¯¥æ¶ˆæ¯å°±æ— éœ€ç»§ç»­æ¶ˆè´¹äº†ã€‚</p><p><strong>å¦‚ä½•ä¿è¯MQçš„æ¶ˆè´¹æ˜¯å¹‚ç­‰æ€§çš„ï¼Œéœ€è¦ç»“åˆå…·ä½“çš„ä¸šåŠ¡æ¥çœ‹</strong></p><hr><h2 id="ç›®å‰å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”"><a href="#ç›®å‰å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”" class="headerlink" title="ç›®å‰å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”"></a>ç›®å‰å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503141822901.png" alt="image-20250314182247809"></p><h2 id="åŸºäºNettyå®ç°huiMQè‡ªå®šä¹‰æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åŸºäºNettyå®ç°huiMQè‡ªå®šä¹‰æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åŸºäºNettyå®ç°huiMQè‡ªå®šä¹‰æ¶ˆæ¯é˜Ÿåˆ—"></a>åŸºäºNettyå®ç°huiMQè‡ªå®šä¹‰æ¶ˆæ¯é˜Ÿåˆ—</h2><p>NettyæœåŠ¡ç«¯å°†ä¼šä½œä¸ºhuiMQï¼Œè¿™é‡Œå…ˆæ­ä¸€ä¸ªNettyæœåŠ¡ç«¯ä¸Nettyå®¢æˆ·ç«¯ï¼Œå…·ä½“çš„ä»£ç è¯·å‚è€ƒï¼š<a href="https://blog.csdn.net/fyh2944163240/article/details/142862284?spm=1001.2014.3001.5502">68 Netty</a></p><p>å…·ä½“é¡¹ç›®ä»£ç è¯·æŸ¥çœ‹ï¼š<a href="https://github.com/fangyaohui/screw-it-development/blob/main/screw-it-development-platform/screw-it-development-bus/screw-it-development-queue/screw-it-development-server/src/main/java/com/fang/screw/server/component/HuiMessageQueue.java">ç‚¹å‡»æŸ¥çœ‹</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016692.png" alt="image-20241013142639323"></p><h3 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><h4 id="å‘é€æ¶ˆæ¯é˜Ÿåˆ—"><a href="#å‘é€æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="å‘é€æ¶ˆæ¯é˜Ÿåˆ—"></a>å‘é€æ¶ˆæ¯é˜Ÿåˆ—</h4><p> æ‰€æœ‰éœ€è¦å‘é€çš„æ¶ˆæ¯éƒ½ä¼šè¢«ç»Ÿä¸€å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç„¶åç”±ä¸€ä¸ªçº¿ç¨‹æ¥å¯¹è¿™ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å‘é€åˆ°NettyæœåŠ¡ç«¯ä¸­ã€‚ä½†æ˜¯è¿™é‡Œä¼šå­˜åœ¨æ¶ˆæ¯ç”Ÿäº§è€…å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—æ—¶å¤±è´¥ï¼Œä»è€Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œåœ¨è¯¥çº¿ç¨‹å‘é€åï¼Œä¼šæŠŠè¿™æ¡æ¶ˆæ¯æš‚æ—¶å­˜æ”¾åœ¨ä¸€ä¸ªMapä¸­ï¼Œç­‰åˆ°æ¶ˆæ¯é˜Ÿåˆ—å‘é€ç¡®è®¤å“åº”åæ‰ä¼šæŠŠè¿™æ¡æ¶ˆæ¯æ¶ˆé™¤ï¼Œå¦‚æœè¶…è¿‡2ç§’è¿˜æœªå›å¤ï¼Œå°±ä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯é‡æ–°æ”¾å›å¾…å‘é€æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ŒåŒæ—¶æŠŠé‡ä¼ æ¬¡æ•°åŠ ä¸€ï¼Œå¦‚æœé‡ä¼ æ¬¡æ•°å¤§äº5æ¬¡ï¼Œå°±ä¼šå†™å…¥æ—¥å¿—ã€‚</p><p>æˆ‘ä»¬å¾…å‘é€æ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©BlockingQueueï¼Œè¯¥é˜Ÿåˆ—æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰ æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡‡ç”¨é˜»å¡é˜Ÿåˆ—ä¿è¯çº¿ç¨‹çš„å®‰å…¨ ä»¥ä¾¿å…å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å¯¼è‡´æ•°æ®ä¸¢å¤± åŒæ—¶é˜»å¡é˜Ÿåˆ—ä¹Ÿå¯ä»¥å½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™é˜»å¡çº¿ç¨‹è®©å…¶ä¹‹åå†é‡æ–°æ·»åŠ è¿è¡Œ</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BlockingQueue&lt;MessageBase.Message&gt; blockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;MessageBase.Message&gt;(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…ç¡®è®¤çš„æ¶ˆæ¯Map</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, MessageBase.Message&gt; waitAckMessageMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…ç¡®è®¤æ¶ˆæ¯è¶…æ—¶Map</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, LocalDateTime&gt; messageTimeOutMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¶…æ—¶</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">timeout</span> <span class="operator">=</span> <span class="number">2000L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å¤šè¶…æ—¶é‡ä¼ æ¬¡æ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">maxRetries</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> SocketChannel socketChannel;</span><br></pre></td></tr></table></figure><h4 id="å‘é€æ¶ˆæ¯çº¿ç¨‹"><a href="#å‘é€æ¶ˆæ¯çº¿ç¨‹" class="headerlink" title="å‘é€æ¶ˆæ¯çº¿ç¨‹"></a>å‘é€æ¶ˆæ¯çº¿ç¨‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æ„å»ºä¸€ä¸ªçº¿ç¨‹æ¥ä¸€ç›´å¯¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å‘é€åˆ°NettyæœåŠ¡ç«¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendMessageByThread</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                log.info(<span class="string">&quot;sendMessageByThread ready&quot;</span>);</span><br><span class="line">                MessageBase.<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> blockingQueue.take();</span><br><span class="line">                log.info(<span class="string">&quot;sendMessageByThread working&quot;</span>);</span><br><span class="line">                sendMessage(message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;sendMessageByThread is interrupt å‘é€æ¶ˆæ¯çº¿ç¨‹è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> çº¿ç¨‹è°ƒç”¨ è®©æ¶ˆæ¯å‘é€åˆ°NettyæœåŠ¡ç«¯çš„å…·ä½“å®ç°é€»è¾‘</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span>  &#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(MessageBase.Message message)</span>&#123;</span><br><span class="line">    <span class="comment">// è¶…è¿‡æœ€å¤§é‡ä¼ æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">if</span>(message.getRetryCount() &gt; maxRetries)&#123;</span><br><span class="line">        log.error(<span class="string">&quot;æ¶ˆæ¯ä¼ è¾“å¤±è´¥æ¬¡æ•°è¶…è¿‡5æ¬¡ï¼š&quot;</span> + message.toString());</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (socketChannel.isActive())&#123;</span><br><span class="line">            socketChannel.writeAndFlush(message);</span><br><span class="line">            waitAckMessageMap.put(message.getRequestId(),message);</span><br><span class="line">            messageTimeOutMap.put(message.getRequestId(),LocalDateTime.now().plusSeconds(timeout));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            log.info(<span class="string">&quot;Nettyè¿æ¥å¤±è´¥ï¼Œè¯·é‡è¯•&quot;</span>);</span><br><span class="line">            addMessageBlockingQueue(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¡®è®¤æ¶ˆæ¯å®šæ—¶ä»»åŠ¡"><a href="#ç¡®è®¤æ¶ˆæ¯å®šæ—¶ä»»åŠ¡" class="headerlink" title="ç¡®è®¤æ¶ˆæ¯å®šæ—¶ä»»åŠ¡"></a>ç¡®è®¤æ¶ˆæ¯å®šæ—¶ä»»åŠ¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span> å°†è¶…æ—¶çš„æ¶ˆæ¯é‡æ–°åŠ å…¥é˜Ÿåˆ—ä¸­é‡æ–°è¿›è¡Œå‘é€</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">messageRetryThread</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScheduledThreadPoolExecutor</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">        log.info(<span class="string">&quot;messageRetryThread working&quot;</span>);</span><br><span class="line">      <span class="keyword">for</span> (Map.Entry&lt;String, MessageBase.Message&gt; entry : waitAckMessageMap.entrySet())&#123;</span><br><span class="line">          MessageBase.<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">          <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">          <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> messageTimeOutMap.get(key);</span><br><span class="line">          <span class="keyword">if</span>(time.isBefore(LocalDateTime.now()))&#123;</span><br><span class="line">              MessageBase.<span class="type">Message</span> <span class="variable">newMessage</span> <span class="operator">=</span> MessageBase.Message.newBuilder()</span><br><span class="line">                      .setRequestId(message.getRequestId())</span><br><span class="line">                      .setCmd(message.getCmd())</span><br><span class="line">                      .setContent(message.getContent())</span><br><span class="line">                      .setRetryCount(message.getRetryCount()+<span class="number">1</span>)</span><br><span class="line">                      .setUrlPath(message.getUrlPath())</span><br><span class="line">                      .build();</span><br><span class="line">              addMessageBlockingQueue(newMessage);</span><br><span class="line">              messageTimeOutMap.remove(key);</span><br><span class="line">              waitAckMessageMap.remove(key);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®‰æ’ä»»åŠ¡åœ¨å»¶è¿Ÿ2ç§’åå¼€å§‹æ‰§è¡Œï¼Œä¹‹åæ¯éš”3ç§’æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">    scheduledExecutorService.scheduleAtFixedRate(task,<span class="number">2</span>,<span class="number">3</span>,TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¥æ”¶NettyæœåŠ¡ç«¯ACKæ¶ˆæ¯"><a href="#æ¥æ”¶NettyæœåŠ¡ç«¯ACKæ¶ˆæ¯" class="headerlink" title="æ¥æ”¶NettyæœåŠ¡ç«¯ACKæ¶ˆæ¯"></a>æ¥æ”¶NettyæœåŠ¡ç«¯ACKæ¶ˆæ¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyClientHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> MessageBase.Message) &#123;</span><br><span class="line">            MessageBase.<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> (MessageBase.Message) msg;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(message.getCmd() == MessageBase.Message.CommandType.ACK)&#123;</span><br><span class="line">                SendMessageThread.getAckAndRemoveMessage(message.getRequestId());</span><br><span class="line">                log.info(<span class="string">&quot;æ”¶åˆ°ACKï¼š&quot;</span> + message.getRequestId());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Received response from server:&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;ID: &quot;</span> + message.getRequestId());</span><br><span class="line">                System.out.println(<span class="string">&quot;Content: &quot;</span> + message.getContent());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Received an unknown message type: &quot;</span> + msg.getClass().getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å®¢æˆ·ç«¯è¿æ¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.error(<span class="string">&quot;å®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸&quot;</span>, cause);</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span> æ ¹æ®RequestIdæ¥æ¶ˆé™¤å¾…ç¡®è®¤ä¸­çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getAckAndRemoveMessage</span><span class="params">(String key)</span>&#123;</span><br><span class="line">    messageTimeOutMap.remove(key);</span><br><span class="line">    waitAckMessageMap.remove(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…¨éƒ¨ä»£ç "><a href="#å…¨éƒ¨ä»£ç " class="headerlink" title="å…¨éƒ¨ä»£ç "></a>å…¨éƒ¨ä»£ç </h4><p>æ›´è¯¦ç»†çš„ä»£ç è¯·æŸ¥çœ‹ï¼š<a href="https://github.com/fangyaohui/screw-it-development/blob/main/screw-it-development-platform/screw-it-development-bus/screw-it-development-queue/screw-it-development-client/src/main/java/com/fang/screw/client/component/NettyClient.java">ç‚¹å‡»æŸ¥çœ‹</a></p><h5 id="NettyClient"><a href="#NettyClient" class="headerlink" title="NettyClient"></a>NettyClient</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EventLoopGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">54021</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SocketChannel socketChannel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">SendMessageThread</span> <span class="variable">sendMessageThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendMessageThread</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> æ·»åŠ æ¶ˆæ¯åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ ä¸ºæ¶ˆæ¯ç”Ÿäº§è€…è°ƒç”¨</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addMessageBlockingQueue</span><span class="params">(MessageBase.Message message)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!socketChannel.isActive())&#123;</span><br><span class="line">            <span class="built_in">this</span>.start();</span><br><span class="line">        &#125;</span><br><span class="line">        sendMessageThread.addMessageBlockingQueue(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> è¯¥æ–¹æ³•æä¾›è·å–SocketChannel æš‚æ—¶æ— ç”¨</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> SocketChannel &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SocketChannel <span class="title function_">getSocketChannel</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (!socketChannel.isActive()) &#123;</span><br><span class="line">            <span class="keyword">return</span> socketChannel;</span><br><span class="line"><span class="comment">//            socketChannel = socketChannel1;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> socketChannel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> è¿æ¥æ–­å¼€é‡æ–°è¿æ¥</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> SocketChannel &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SocketChannel <span class="title function_">retryConnect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>();</span><br><span class="line">        bootstrap.group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .remoteAddress(host, port)</span><br><span class="line">                .option(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">                .option(ChannelOption.TCP_NODELAY, <span class="literal">true</span>)</span><br><span class="line">                .handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                        ch.pipeline()</span><br><span class="line">                                <span class="comment">// ç©ºé—²æ£€æµ‹</span></span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">60</span>, <span class="number">60</span>, <span class="number">60</span>)) <span class="comment">// 60ç§’å†™ç©ºé—²ï¼Œ30ç§’è¯»ç©ºé—²</span></span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">HeartbeatHandler</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32FrameDecoder</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufDecoder</span>(MessageBase.Message.getDefaultInstance()))</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32LengthFieldPrepender</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufEncoder</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">NettyClientHandler</span>())</span><br><span class="line">                        ; <span class="comment">// è‡ªå®šä¹‰å¤„ç†å™¨</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="type">ChannelFuture</span> <span class="variable">future</span> <span class="operator">=</span> bootstrap.connect();</span><br><span class="line">        <span class="keyword">if</span> (future.isSuccess())&#123;</span><br><span class="line">            <span class="keyword">return</span> (SocketChannel) future.channel();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> Nettyå®¢æˆ·ç«¯å¯åŠ¨å‡½æ•° è°ƒç”¨Startå¯ä»¥å¯åŠ¨å¯¹NettyæœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>();</span><br><span class="line">        bootstrap.group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .remoteAddress(host, port)</span><br><span class="line">                .option(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">                .option(ChannelOption.TCP_NODELAY, <span class="literal">true</span>)</span><br><span class="line">                .handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                        ch.pipeline()</span><br><span class="line">                                <span class="comment">// ç©ºé—²æ£€æµ‹</span></span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">60</span>, <span class="number">60</span>, <span class="number">60</span>)) <span class="comment">// 60ç§’å†™ç©ºé—²ï¼Œ30ç§’è¯»ç©ºé—²</span></span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">HeartbeatHandler</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32FrameDecoder</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufDecoder</span>(MessageBase.Message.getDefaultInstance()))</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32LengthFieldPrepender</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufEncoder</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">NettyClientHandler</span>())</span><br><span class="line">                        ; <span class="comment">// è‡ªå®šä¹‰å¤„ç†å™¨</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="type">ChannelFuture</span> <span class="variable">future</span> <span class="operator">=</span> bootstrap.connect();</span><br><span class="line">        <span class="comment">//å®¢æˆ·ç«¯æ–­çº¿é‡è¿é€»è¾‘</span></span><br><span class="line">        future.addListener((ChannelFutureListener) future1 -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (future1.isSuccess()) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;è¿æ¥NettyæœåŠ¡ç«¯æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;è¿æ¥å¤±è´¥ï¼Œè¿›è¡Œæ–­çº¿é‡è¿&quot;</span>);</span><br><span class="line">                future1.channel().eventLoop().schedule(<span class="built_in">this</span>::start, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        socketChannel = (SocketChannel) future.channel();</span><br><span class="line"></span><br><span class="line">        sendMessageThread.setSocketChannel(socketChannel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="SendMessageThread"><a href="#SendMessageThread" class="headerlink" title="SendMessageThread"></a>SendMessageThread</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.screw.client.Thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fang.screw.client.component.NettyClient;</span><br><span class="line"><span class="keyword">import</span> com.fang.screw.client.protocol.MessageBase;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> SendMessageThread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-11</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMessageThread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡‡ç”¨é˜»å¡é˜Ÿåˆ—ä¿è¯çº¿ç¨‹çš„å®‰å…¨ ä»¥ä¾¿å…å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å¯¼è‡´æ•°æ®ä¸¢å¤± åŒæ—¶é˜»å¡é˜Ÿåˆ—ä¹Ÿå¯ä»¥å½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™é˜»å¡çº¿ç¨‹è®©å…¶ä¹‹åå†é‡æ–°æ·»åŠ è¿è¡Œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BlockingQueue&lt;MessageBase.Message&gt; blockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;MessageBase.Message&gt;(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…ç¡®è®¤çš„æ¶ˆæ¯Map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, MessageBase.Message&gt; waitAckMessageMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…ç¡®è®¤æ¶ˆæ¯è¶…æ—¶Map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, LocalDateTime&gt; messageTimeOutMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¶…æ—¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">timeout</span> <span class="operator">=</span> <span class="number">2000L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€å¤šè¶…æ—¶é‡ä¼ æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">maxRetries</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SocketChannel socketChannel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SendMessageThread</span><span class="params">()</span>&#123;</span><br><span class="line">        sendMessageByThread();</span><br><span class="line">        messageRetryThread();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SendMessageThread</span><span class="params">(SocketChannel socketChannel1)</span>&#123;</span><br><span class="line">        socketChannel = socketChannel1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSocketChannel</span><span class="params">(SocketChannel socketChannel1)</span>&#123;</span><br><span class="line">        socketChannel = socketChannel1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addMessageBlockingQueue</span><span class="params">(MessageBase.Message message)</span>&#123;</span><br><span class="line">        blockingQueue.add(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> æ„å»ºä¸€ä¸ªçº¿ç¨‹æ¥ä¸€ç›´å¯¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å‘é€åˆ°NettyæœåŠ¡ç«¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendMessageByThread</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    log.info(<span class="string">&quot;sendMessageByThread ready&quot;</span>);</span><br><span class="line">                    MessageBase.<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> blockingQueue.take();</span><br><span class="line">                    log.info(<span class="string">&quot;sendMessageByThread working&quot;</span>);</span><br><span class="line">                    sendMessage(message);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;sendMessageByThread is interrupt å‘é€æ¶ˆæ¯çº¿ç¨‹è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> çº¿ç¨‹è°ƒç”¨ è®©æ¶ˆæ¯å‘é€åˆ°NettyæœåŠ¡ç«¯çš„å…·ä½“å®ç°é€»è¾‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span>  &#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(MessageBase.Message message)</span>&#123;</span><br><span class="line">        <span class="comment">// è¶…è¿‡æœ€å¤§é‡ä¼ æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">if</span>(message.getRetryCount() &gt; maxRetries)&#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ¶ˆæ¯ä¼ è¾“å¤±è´¥æ¬¡æ•°è¶…è¿‡5æ¬¡ï¼š&quot;</span> + message.toString());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (socketChannel.isActive())&#123;</span><br><span class="line">                socketChannel.writeAndFlush(message);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                log.info(<span class="string">&quot;Nettyè¿æ¥å¤±è´¥ï¼Œè¯·é‡è¯•&quot;</span>);</span><br><span class="line"><span class="comment">//                socketChannel = NettyClient.getSocketChannel();</span></span><br><span class="line">                addMessageBlockingQueue(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> å°†è¶…æ—¶çš„æ¶ˆæ¯é‡æ–°åŠ å…¥é˜Ÿåˆ—ä¸­é‡æ–°è¿›è¡Œå‘é€</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">messageRetryThread</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScheduledThreadPoolExecutor</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;messageRetryThread working&quot;</span>);</span><br><span class="line">          <span class="keyword">for</span> (Map.Entry&lt;String, MessageBase.Message&gt; entry : waitAckMessageMap.entrySet())&#123;</span><br><span class="line">              MessageBase.<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">              <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">              <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> messageTimeOutMap.get(key);</span><br><span class="line">              <span class="keyword">if</span>(time.isBefore(LocalDateTime.now()))&#123;</span><br><span class="line">                  MessageBase.<span class="type">Message</span> <span class="variable">newMessage</span> <span class="operator">=</span> MessageBase.Message.newBuilder()</span><br><span class="line">                          .setRequestId(message.getRequestId())</span><br><span class="line">                          .setCmd(message.getCmd())</span><br><span class="line">                          .setContent(message.getContent())</span><br><span class="line">                          .setRetryCount(message.getRetryCount()+<span class="number">1</span>)</span><br><span class="line">                          .setUrlPath(message.getUrlPath())</span><br><span class="line">                          .build();</span><br><span class="line">                  addMessageBlockingQueue(newMessage);</span><br><span class="line">                  messageTimeOutMap.remove(key);</span><br><span class="line">                  waitAckMessageMap.remove(key);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®‰æ’ä»»åŠ¡åœ¨å»¶è¿Ÿ2ç§’åå¼€å§‹æ‰§è¡Œï¼Œä¹‹åæ¯éš”3ç§’æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">        scheduledExecutorService.scheduleAtFixedRate(task,<span class="number">2</span>,<span class="number">3</span>,TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> æ ¹æ®RequestIdæ¥æ¶ˆé™¤å¾…ç¡®è®¤ä¸­çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getAckAndRemoveMessage</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        messageTimeOutMap.remove(key);</span><br><span class="line">        waitAckMessageMap.remove(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="huiMQ"><a href="#huiMQ" class="headerlink" title="huiMQ"></a>huiMQ</h3><h4 id="ä¿å­˜æ¶ˆæ¯"><a href="#ä¿å­˜æ¶ˆæ¯" class="headerlink" title="ä¿å­˜æ¶ˆæ¯"></a>ä¿å­˜æ¶ˆæ¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span> ä¿å­˜æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ å¹¶ä¸”ä¿å­˜åˆ°MySQLæ•°æ®åº“æŒä¹…åŒ– æ³¨æ„è¿™é‡Œæ˜¯ä¸€ä¸ªäº‹åŠ¡ è¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½åˆ«æˆåŠŸ</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> boolean &#125;</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">saveMessage</span><span class="params">(MessageBase.Message message)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">// ä¿å­˜åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­</span></span><br><span class="line">        <span class="keyword">if</span>(!messageQueueMap.containsKey(message.getChannel()))&#123;</span><br><span class="line">            BlockingQueue&lt;MessageBase.Message&gt; messageBlockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;MessageBase.Message&gt;(<span class="number">1024</span>);</span><br><span class="line">            messageQueueMap.put(message.getChannel(),messageBlockingQueue);</span><br><span class="line">        &#125;</span><br><span class="line">        messageQueueMap.get(message.getChannel()).add(message);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿å­˜åˆ°MySQLæ•°æ®åº“ä¸­</span></span><br><span class="line">        <span class="keyword">if</span>(!messageQueueMapper.exists(Wrappers.&lt;MessageQueuePO&gt;lambdaQuery()</span><br><span class="line">                .eq(MessageQueuePO::getRequestId,message.getRequestId())</span><br><span class="line">                .eq(MessageQueuePO::getDelFlag,<span class="number">0</span>)))&#123;</span><br><span class="line">            <span class="type">MessageQueuePO</span> <span class="variable">messageQueuePO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageQueuePO</span>();</span><br><span class="line">            messageQueuePO.setRequestId(message.getRequestId());</span><br><span class="line">            messageQueuePO.setCmd(message.getCmdValue());</span><br><span class="line">            messageQueuePO.setContent(message.getContent());</span><br><span class="line">            messageQueuePO.setUrlPath(message.getUrlPath());</span><br><span class="line">            messageQueueMapper.insert(messageQueuePO);</span><br><span class="line">            log.info(<span class="string">&quot;HuiMQä¿å­˜æ¶ˆæ¯ï¼š&quot;</span> + messageQueuePO.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        log.info(<span class="string">&quot;ä¿å­˜æ¶ˆæ¯è‡³æ¶ˆæ¯é˜Ÿåˆ—é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ”¶åˆ°æ¶ˆè´¹ç«¯å‘æ¥è¯·æ±‚æ¶ˆæ¯"><a href="#æ”¶åˆ°æ¶ˆè´¹ç«¯å‘æ¥è¯·æ±‚æ¶ˆæ¯" class="headerlink" title="æ”¶åˆ°æ¶ˆè´¹ç«¯å‘æ¥è¯·æ±‚æ¶ˆæ¯"></a>æ”¶åˆ°æ¶ˆè´¹ç«¯å‘æ¥è¯·æ±‚æ¶ˆæ¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆè´¹ç«¯è¯·æ±‚å‘é€æ¶ˆæ¯</span></span><br><span class="line">                <span class="comment">// æ£€æŸ¥æ˜¯å¦æœ‰è¶…æ—¶çš„æ¶ˆæ¯ å¦‚æœæœ‰åˆ™å°†å…¶é‡æ–°æ”¾ç½®äºå¾…é‡ä¼ çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­</span></span><br><span class="line">                HuiMessageQueue.checkTimeOutMessage();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(HuiMessageQueue.messageQueueMap.containsKey(message.getChannel()))&#123;</span><br><span class="line">                    BlockingQueue&lt;MessageBase.Message&gt; queue = HuiMessageQueue.messageQueueMap.get(message.getChannel());</span><br><span class="line">                    <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">                        MessageBase.<span class="type">Message</span> <span class="variable">sendMessage</span> <span class="operator">=</span> queue.take();</span><br><span class="line">                        log.info(<span class="string">&quot;HuiMQå‘æ¶ˆè´¹è€…å‘é€æ¶ˆæ¯ï¼š&quot;</span> + sendMessage.toString());</span><br><span class="line">                        ctx.writeAndFlush(sendMessage);</span><br><span class="line">                        <span class="comment">// å°†æ¶ˆè´¹åˆ—ä¸ºå¸¦ç¡®è®¤æ¶ˆæ¯</span></span><br><span class="line">                        HuiMessageQueue.waitAckMessageMap.put(sendMessage.getRequestId(),sendMessage);</span><br><span class="line">                        HuiMessageQueue.messageTimeOutMap.put(sendMessage.getRequestId(), LocalDateTime.now().plusSeconds(<span class="number">2L</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> æ£€æŸ¥æ˜¯å¦æœ‰è¶…æ—¶æ²¡æœ‰æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯çš„æ¶ˆæ¯ å°†å…¶é‡æ–°æ”¾ç½®åœ¨å¾…å‘é€æ¶ˆæ¯é˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/13</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">checkTimeOutMessage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String,LocalDateTime&gt; mapEntry : messageTimeOutMap.entrySet())&#123;</span><br><span class="line">            <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> mapEntry.getValue();</span><br><span class="line">            <span class="keyword">if</span>(time.isBefore(LocalDateTime.now()))&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> mapEntry.getKey();</span><br><span class="line">                MessageBase.<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> waitAckMessageMap.get(s);</span><br><span class="line">                waitAckMessageMap.remove(s);</span><br><span class="line">                messageTimeOutMap.remove(s);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ä¿å­˜åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­</span></span><br><span class="line">                <span class="keyword">if</span>(!messageQueueMap.containsKey(message.getChannel()))&#123;</span><br><span class="line">                    BlockingQueue&lt;MessageBase.Message&gt; messageBlockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;MessageBase.Message&gt;(<span class="number">1024</span>);</span><br><span class="line">                    messageQueueMap.put(message.getChannel(),messageBlockingQueue);</span><br><span class="line">                &#125;</span><br><span class="line">                messageQueueMap.get(message.getChannel()).add(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="æ”¶åˆ°æ¶ˆè´¹ç«¯ACKæ¶ˆæ¯"><a href="#æ”¶åˆ°æ¶ˆè´¹ç«¯ACKæ¶ˆæ¯" class="headerlink" title="æ”¶åˆ°æ¶ˆè´¹ç«¯ACKæ¶ˆæ¯"></a>æ”¶åˆ°æ¶ˆè´¹ç«¯ACKæ¶ˆæ¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">log.info(<span class="string">&quot;æ”¶åˆ°æ¶ˆè´¹ç«¯å‘æ¥çš„ACKæŠ¥æ–‡ï¼š&quot;</span> + message.getRequestId());</span><br><span class="line">HuiMessageQueue.setMessageAck(message.getRequestId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> requestId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/13</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setMessageAck</span><span class="params">(String requestId)</span>&#123;</span><br><span class="line">        messageTimeOutMap.remove(requestId);</span><br><span class="line">        waitAckMessageMap.remove(requestId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><h4 id="æ ‡è®°éœ€è¦ç›‘å¬æ¶ˆæ¯æ–¹æ³•"><a href="#æ ‡è®°éœ€è¦ç›‘å¬æ¶ˆæ¯æ–¹æ³•" class="headerlink" title="æ ‡è®°éœ€è¦ç›‘å¬æ¶ˆæ¯æ–¹æ³•"></a>æ ‡è®°éœ€è¦ç›‘å¬æ¶ˆæ¯æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> HuiListener</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> HuiMQç›‘å¬æ³¨è§£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Target(value = ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> HuiListener &#123;</span><br><span class="line">    String <span class="title function_">queueName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è·å–æ‰€æœ‰è¢«HuiListeneræ³¨è§£æ ‡è®°çš„æ–¹æ³•"><a href="#è·å–æ‰€æœ‰è¢«HuiListeneræ³¨è§£æ ‡è®°çš„æ–¹æ³•" class="headerlink" title="è·å–æ‰€æœ‰è¢«HuiListeneræ³¨è§£æ ‡è®°çš„æ–¹æ³•"></a>è·å–æ‰€æœ‰è¢«HuiListeneræ³¨è§£æ ‡è®°çš„æ–¹æ³•</h4><p>é€šè¿‡BeanPostProcessoræ¥è·å–æ‰€æœ‰è¢«æŒ‡å®šæ³¨è§£æ ‡è®°çš„æ–¹æ³•ï¼ŒBeanPostProcessorä¼šåœ¨æ¯ä¸ªBeanåˆå§‹åŒ–å‰åè°ƒç”¨ï¼Œåˆ†åˆ«ä¸ºpostProcessBeforeInitializationå’ŒpostProcessAfterInitializationã€‚</p><p>è¿™é‡Œä¼šå°†æ‰€æœ‰è¢«HuiListeneræ ‡è®°çš„æ–¹æ³•å’ŒBeanæ³¨å†Œåˆ°huiListenerRegistryä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ä¹‹åé€šè¿‡åå°„çš„æ–¹å¼æ¥ç›´æ¥è¿è¡ŒæŒ‡å®šæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> HuiListenerAnnotationBeanPostProcessor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuiListenerAnnotationBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, InitializingBean &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">HuiListenerRegistry</span> <span class="variable">huiListenerRegistry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HuiListenerRegistry</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">huiListenerFlag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> åœ¨ bean çš„åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ <span class="doctag">@PostConstruct</span> æ³¨è§£çš„æ–¹æ³•æˆ– init-method æŒ‡å®šçš„æ–¹æ³•ï¼‰ä¹‹å‰è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> Object &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessBeforeInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> åœ¨ bean çš„åˆå§‹åŒ–æ–¹æ³•ä¹‹åè°ƒç”¨ã€‚æŸ¥çœ‹å½“å‰çš„beanæ˜¯å¦å­˜åœ¨è¢«HuiListeneræ³¨è§£è¿‡çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> Object &#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">        Method[] methods = bean.getClass().getMethods();</span><br><span class="line">        <span class="keyword">for</span>(Method method : methods)&#123;</span><br><span class="line">            <span class="keyword">if</span>(method.isAnnotationPresent(HuiListener.class))&#123;</span><br><span class="line">                processHuiListener(method,bean);</span><br><span class="line">                huiListenerFlag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessAfterInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processHuiListener</span><span class="params">(Method method,Object bean)</span>&#123;</span><br><span class="line">        <span class="type">HuiListener</span> <span class="variable">huiListener</span> <span class="operator">=</span> method.getAnnotation(HuiListener.class);</span><br><span class="line">        <span class="type">HuiListenerEndpoint</span> <span class="variable">huiListenerEndpoint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HuiListenerEndpoint</span>();</span><br><span class="line">        huiListenerEndpoint.setBean(bean);</span><br><span class="line">        huiListenerEndpoint.setMethod(method);</span><br><span class="line">        huiListenerRegistry.registerListenerEndpoint(huiListener.queueName(),huiListenerEndpoint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> HuiListenerEndpoint</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuiListenerEndpoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Method method;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> HuiListenerRegistry</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuiListenerRegistry</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String,HuiListenerEndpoint&gt; huiListenerEndpointConcurrentHashMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> æ·»åŠ HuiListenerç›‘å¬çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> queueName</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> huiListenerEndpoint</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerListenerEndpoint</span><span class="params">(String queueName,HuiListenerEndpoint huiListenerEndpoint)</span>&#123;</span><br><span class="line">        huiListenerEndpointConcurrentHashMap.put(queueName,huiListenerEndpoint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> æ¶ˆè´¹è€…å¤„ç†æ”¶åˆ°æ¶ˆæ¯çš„ä¸»è¦é€»è¾‘</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> boolean &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">handleMessage</span><span class="params">(MessageBase.Message message)</span>&#123;</span><br><span class="line">        <span class="type">HuiListenerEndpoint</span> <span class="variable">huiListenerEndpoint</span> <span class="operator">=</span> huiListenerEndpointConcurrentHashMap.get(message.getChannel());</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(huiListenerEndpoint))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;æ¶ˆæ¯æ— å¯¹åº”Channelæ¶ˆè´¹ï¼š&quot;</span> + message.getChannel());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> huiListenerEndpoint.getMethod();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> huiListenerEndpoint.getBean();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Class&lt;?&gt;[] classes = method.getParameterTypes();</span><br><span class="line">            method.invoke(bean,JSON.parseObject(message.getContent(),classes[<span class="number">0</span>]));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;æ¶ˆæ¯æ¶ˆè´¹å¼‚å¸¸&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®šæœŸå‘é€è¯·æ±‚æ¶ˆæ¯"><a href="#å®šæœŸå‘é€è¯·æ±‚æ¶ˆæ¯" class="headerlink" title="å®šæœŸå‘é€è¯·æ±‚æ¶ˆæ¯"></a>å®šæœŸå‘é€è¯·æ±‚æ¶ˆæ¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> getMessageThread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetMessageThread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> NettyClient nettyClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    private static HuiListenerRegistry huiListenerRegistry = new HuiListenerRegistry();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GetMessageThread</span><span class="params">(NettyClient nettyClient)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.nettyClient = nettyClient;</span><br><span class="line">        regularGetMessage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> å®šæ—¶å‘é€æ˜¯å¦å­˜åœ¨æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">regularGetMessage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScheduledThreadPoolExecutor</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line"><span class="comment">//            log.info(&quot;regularGetMessage is running&quot;);</span></span><br><span class="line">            Set&lt;String&gt; channel = HuiListenerRegistry.huiListenerEndpointConcurrentHashMap.keySet();</span><br><span class="line">            <span class="keyword">for</span>(String s : channel)&#123;</span><br><span class="line">                MessageBase.<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> MessageBase.Message.newBuilder()</span><br><span class="line">                        .setCmd(MessageBase.Message.CommandType.SEND_MESSAGE)</span><br><span class="line">                        .setChannel(s).build();</span><br><span class="line">                nettyClient.sendMessage(message);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        scheduledExecutorService.scheduleAtFixedRate(task,<span class="number">2</span>,<span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹ç«¯å¯åŠ¨å®šæœŸè¯·æ±‚æ¶ˆæ¯"><a href="#æ¶ˆè´¹ç«¯å¯åŠ¨å®šæœŸè¯·æ±‚æ¶ˆæ¯" class="headerlink" title="æ¶ˆè´¹ç«¯å¯åŠ¨å®šæœŸè¯·æ±‚æ¶ˆæ¯"></a>æ¶ˆè´¹ç«¯å¯åŠ¨å®šæœŸè¯·æ±‚æ¶ˆæ¯</h4><p>å¦‚æœè¿™ä¸ªæœåŠ¡ä¸­æœ‰è¢«HuiListeneræ³¨è§£æ ‡è®°çš„æ–¹æ³•å°±ä¼šå¯ç”¨è¿™ä¸ªæ–¹æ³•ï¼ŒSmartInitializingSingletonä¼šåœ¨æ‰€æœ‰çš„Beanåˆå§‹åŒ–ä¹‹åè¿è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> MyBeanInjector</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanInjector</span> <span class="keyword">implements</span> <span class="title class_">SmartInitializingSingleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NettyClient nettyClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBeanInjector</span><span class="params">(NettyClient nettyClient)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.nettyClient = nettyClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterSingletonsInstantiated</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;GetMessageThread is ready&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (HuiListenerAnnotationBeanPostProcessor.huiListenerFlag)&#123;</span><br><span class="line">            <span class="type">GetMessageThread</span> <span class="variable">getMessageThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetMessageThread</span>(nettyClient);</span><br><span class="line">            log.info(<span class="string">&quot;GetMessageThread is running&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨HuiMQ"><a href="#ä½¿ç”¨HuiMQ" class="headerlink" title="ä½¿ç”¨HuiMQ"></a>ä½¿ç”¨HuiMQ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> ReceiveHuiMessage</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveHuiMessage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HuiListener(queueName = &quot;queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">noticeUserHaveComment</span><span class="params">(CommentVO commentVO)</span>&#123;</span><br><span class="line">      log.info(<span class="string">&quot;Chatæ¨¡å—æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> + commentVO.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h2><h3 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"><a href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" class="headerlink" title="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"></a>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</h3><p>å¯¹äºç”Ÿäº§è€…æ¥è¯´éœ€è¦åšåˆ°å¤±è´¥é‡ä¼ ï¼Œé‡‡ç”¨ç¡®è®¤æœºåˆ¶å¯ä»¥æœ‰æ•ˆé¿å…æ¶ˆæ¯ä¸¢å¤±ï¼›</p><p>å¯¹äºBrokeræ¥è¯´ï¼Œéœ€è¦æ§åˆ¶ç»™ç”Ÿäº§è€…ç¡®è®¤çš„æ—¶æœºï¼Œåœ¨Brokerä¿å­˜æ¶ˆæ¯åˆ°MySQLåå†è¿›è¡Œè¿”å›ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…æ¶ˆæ¯ä¸¢å¤±ï¼›</p><p>å¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œéœ€è¦åœ¨æ¶ˆæ¯çœŸæ­£æ¶ˆè´¹ä¹‹åå†ç»™Brokerè¿›è¡Œç¡®è®¤ï¼Œå¯ä»¥é¿å…æ¶ˆæ¯ä¸¢å¤±ï¼›</p><h3 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹"><a href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹" class="headerlink" title="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹"></a>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹</h3><p>å¯¹äºæ­£å¸¸çš„ä¸šåŠ¡æ¶ˆæ¯åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ˜¯ä¸å¯é¿å…ä¼šå­˜åœ¨é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½åœ¨ä¸šåŠ¡å±‚é¢è¿›è¡Œæ¶ˆé™¤è¯¥å½±å“ã€‚</p><p>è¿™ç§é—®é¢˜å°±æ˜¯å…¸å‹çš„å¹‚ç­‰æ€§é—®é¢˜ï¼Œå³å¯¹äºåŒæ ·çš„ä¸€ç§æ“ä½œæ‰€å¸¦æ¥çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚è¿™ç§<code>update t1 set money = 150 where id = 1 and money = 100;</code> æ‰§è¡Œå¤šå°‘é<code>money</code>éƒ½æ˜¯150ï¼Œè¿™å°±å«å¹‚ç­‰ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬çš„è§£å†³æ–¹æ³•æ˜¯æ·»åŠ ç‰ˆæœ¬å·versionï¼Œåœ¨æ‰§è¡ŒSQLæ—¶åˆ¤æ–­versionæ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´åˆ™ä¸æ‰§è¡Œã€‚æˆ–è€…è®°å½•å…³é”®çš„keyï¼Œåƒè®¢å•å·è¿™ç§ï¼Œæ‰§è¡Œè¿‡çš„å°±ä¸éœ€è¦å†æ‰§è¡Œã€‚</p><h3 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§"><a href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§" class="headerlink" title="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§"></a>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262016697.png" alt="image-20241013145317056"></p><h3 id="å¦‚ä½•å¤„ç†æ¶ˆæ¯å †ç§¯"><a href="#å¦‚ä½•å¤„ç†æ¶ˆæ¯å †ç§¯" class="headerlink" title="å¦‚ä½•å¤„ç†æ¶ˆæ¯å †ç§¯"></a>å¦‚ä½•å¤„ç†æ¶ˆæ¯å †ç§¯</h3><p>æ¶ˆæ¯é˜Ÿåˆ—æ ¹æœ¬åŸå› æ˜¯æ¶ˆè´¹è€…æ¶ˆè´¹è·Ÿä¸ä¸Šç”Ÿäº§è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜åŒ–ä¸‹æ¶ˆè´¹é€»è¾‘ï¼Œæ¯”å¦‚ä¹‹å‰æ˜¯ä¸€æ¡ä¸€æ¡æ¶ˆæ¯æ¶ˆè´¹å¤„ç†çš„ï¼Œè¿™æ¬¡æˆ‘ä»¬æ‰¹é‡å¤„ç†ï¼Œæ¯”å¦‚æ•°æ®åº“çš„æ’å…¥ï¼Œä¸€æ¡ä¸€æ¡æ’å’Œæ‰¹é‡æ’æ•ˆç‡æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>å‡å¦‚é€»è¾‘æˆ‘ä»¬å·²ç»éƒ½ä¼˜åŒ–äº†ï¼Œä½†è¿˜æ˜¯æ…¢ï¼Œé‚£å°±å¾—è€ƒè™‘æ°´å¹³æ‰©å®¹äº†ï¼Œå¢åŠ <code>Topic</code>çš„é˜Ÿåˆ—æ•°å’Œæ¶ˆè´¹è€…æ•°é‡ï¼Œ<strong>æ³¨æ„é˜Ÿåˆ—æ•°ä¸€å®šè¦å¢åŠ </strong>ï¼Œä¸ç„¶æ–°å¢åŠ çš„æ¶ˆè´¹è€…æ˜¯æ²¡ä¸œè¥¿æ¶ˆè´¹çš„ã€‚<strong>ä¸€ä¸ªTopicä¸­ï¼Œä¸€ä¸ªé˜Ÿåˆ—åªä¼šåˆ†é…ç»™ä¸€ä¸ªæ¶ˆè´¹è€…</strong>ã€‚</p><h2 id="RabbitMQ-1"><a href="#RabbitMQ-1" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><h3 id="é€‚é…RabbitMQ"><a href="#é€‚é…RabbitMQ" class="headerlink" title="é€‚é…RabbitMQ"></a>é€‚é…RabbitMQ</h3><h4 id="Mavené…ç½®"><a href="#Mavené…ç½®" class="headerlink" title="Mavené…ç½®"></a>Mavené…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--rabbitmq--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨SpringBooté¡¹ç›®ä¸­å¼•å…¥è¿™ä¸ªä¾èµ–ã€‚</p><h4 id="ymlé…ç½®"><a href="#ymlé…ç½®" class="headerlink" title="ymlé…ç½®"></a>ymlé…ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é¢è¯•é—®é¢˜"><a href="#å¸¸è§é¢è¯•é—®é¢˜" class="headerlink" title="å¸¸è§é¢è¯•é—®é¢˜"></a>å¸¸è§é¢è¯•é—®é¢˜</h2><p>ä»¥ä¸‹æ˜¯æ¶µç›–æ•´ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çŸ¥è¯†ç‚¹çš„é¢è¯•é¢˜ï¼Œéš¾åº¦å¾ªåºæ¸è¿›ï¼Œå…±æœ‰30ä¸ªé—®é¢˜ï¼š</p><h3 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h3><ol><li>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿå®ƒåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ</li><li>è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹ã€‚</li><li>æ¶ˆæ¯é˜Ÿåˆ—å’Œä¼ ç»Ÿçš„æ•°æ®åº“é˜Ÿåˆ—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>è¯·ç®€è¿°ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†ã€‚</li><li>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ</li><li>ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„ACKæœºåˆ¶ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ</li><li>ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦‚ä½•ä¿è¯é¡ºåºæ€§çš„ï¼Ÿ</li><li>ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿ</li></ol><p>ä¸‹é¢æ˜¯å¯¹è¿™äº›é—®é¢˜çš„è¯¦ç»†ä»‹ç»ï¼š</p><h4 id="1-ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿå®ƒåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿå®ƒåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿå®ƒåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿå®ƒåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ</h4><p><strong>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼ŒMessage Queueï¼‰</strong> æ˜¯ä¸€ç§<strong>é€šä¿¡æœºåˆ¶</strong>ï¼Œé€šå¸¸ç”¨äº<strong>å¼‚æ­¥æ¶ˆæ¯ä¼ é€’</strong>ã€‚åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶å¤„ç†ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>æš‚æ—¶å­˜å‚¨</strong>çš„ä¸­ä»‹ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ï¼Œä½¿å¾—æ¶ˆæ¯ä¼ é€’å¯ä»¥è§£è€¦å‘é€è€…å’Œæ¥æ”¶è€…ã€‚</p><p><strong>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä½œç”¨</strong>ï¼š</p><ul><li><strong>è§£è€¦</strong>ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸éœ€è¦ç›´æ¥é€šä¿¡ï¼Œå¯ä»¥å¼‚æ­¥åœ°è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œé™ä½ç³»ç»Ÿé—´çš„è€¦åˆåº¦ã€‚</li><li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šç³»ç»Ÿä¸­çš„å¤„ç†ä»»åŠ¡ä¸å¿…åŒæ­¥è¿›è¡Œï¼Œå¯ä»¥å°†å¤„ç†è¿‡ç¨‹å¼‚æ­¥åŒ–ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œååé‡ã€‚</li><li><strong>æµé‡å‰Šå³°</strong>ï¼šåœ¨æµé‡çªå¢çš„æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿç¼“å†²ç§¯å‹çš„è¯·æ±‚ï¼Œé˜²æ­¢ç³»ç»Ÿå‹åŠ›è¿‡å¤§å¯¼è‡´å´©æºƒæˆ–å“åº”å»¶è¿Ÿã€‚</li><li><strong>ç³»ç»Ÿç¨³å®šæ€§</strong>ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥å®ç°ç³»ç»Ÿç»„ä»¶çš„æ¾è€¦åˆï¼Œé¿å…ä¸€ä¸ªæ¨¡å—çš„æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</li><li><strong>å®¹é”™æ€§</strong>ï¼šå¦‚æœæŸä¸ªæ¶ˆè´¹è€…å¤„ç†å¤±è´¥ï¼Œæ¶ˆæ¯å¯ä»¥é‡æ–°æŠ•é€’ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLQï¼‰æ¥å¤„ç†æ— æ³•æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚</li></ul><h4 id="2-è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹"><a href="#2-è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹" class="headerlink" title="2. è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹"></a>2. è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹</h4><p><strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong>æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºæœ¬å·¥ä½œæ¨¡å¼ã€‚å®ƒåŒ…æ‹¬ä¸¤ä¸ªä¸»è¦çš„è§’è‰²ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚</p><ul><li><strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong>ï¼šç”Ÿäº§è€…è´Ÿè´£ç”Ÿæˆæ¶ˆæ¯å¹¶å°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ç”Ÿäº§è€…é€šå¸¸ä¸å…³å¿ƒæ¶ˆæ¯é˜Ÿåˆ—çš„å…·ä½“å®ç°ï¼Œåªéœ€è¦çŸ¥é“å¦‚ä½•å‘é€æ¶ˆæ¯ã€‚</li><li><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong>ï¼šæ¶ˆè´¹è€…ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†ã€‚æ¶ˆè´¹è€…æ˜¯è¢«åŠ¨çš„ï¼Œå®ƒåªåœ¨é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯æ—¶æ‰ä¼šè¿›è¡Œå¤„ç†ã€‚</li></ul><p>æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜åŠ¿ä¹‹ä¸€åœ¨äºå®ƒè§£è€¦äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚ç”Ÿäº§è€…ä¸éœ€è¦å…³å¿ƒæ¶ˆæ¯çš„æ¶ˆè´¹è¿‡ç¨‹ï¼Œæ¶ˆè´¹è€…ä¹Ÿä¸éœ€è¦çŸ¥é“æ¶ˆæ¯æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚</p><h4 id="3-æ¶ˆæ¯é˜Ÿåˆ—å’Œä¼ ç»Ÿçš„æ•°æ®åº“é˜Ÿåˆ—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#3-æ¶ˆæ¯é˜Ÿåˆ—å’Œä¼ ç»Ÿçš„æ•°æ®åº“é˜Ÿåˆ—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="3. æ¶ˆæ¯é˜Ÿåˆ—å’Œä¼ ç»Ÿçš„æ•°æ®åº“é˜Ÿåˆ—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>3. æ¶ˆæ¯é˜Ÿåˆ—å’Œä¼ ç»Ÿçš„æ•°æ®åº“é˜Ÿåˆ—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>æ¶ˆæ¯é˜Ÿåˆ—å’Œæ•°æ®åº“é˜Ÿåˆ—åœ¨å®ç°å’Œä½¿ç”¨ä¸Šæœ‰å‡ ä¸ªé‡è¦çš„åŒºåˆ«ï¼š</p><ol><li><strong>ç”¨é€”ä¸åŒ</strong>ï¼š<ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šä¸»è¦ç”¨äºå¼‚æ­¥æ¶ˆæ¯ä¼ é€’ï¼Œè§£è€¦ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡ï¼Œé€šå¸¸å…·æœ‰é«˜ååé‡å’Œä½å»¶è¿Ÿï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¼‚æ­¥å¤„ç†ã€‚</li><li><strong>æ•°æ®åº“é˜Ÿåˆ—</strong>ï¼šé€šå¸¸ç”¨äºæ•°æ®åº“å†…éƒ¨çš„ä»»åŠ¡æ’é˜Ÿï¼Œé€‚ç”¨äºå°è§„æ¨¡çš„å†…éƒ¨æ“ä½œï¼Œæ€§èƒ½å’Œæ‰©å±•æ€§è¾ƒå·®ã€‚</li></ul></li><li><strong>æ•°æ®å­˜å‚¨æ–¹å¼</strong>ï¼š<ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šé€šå¸¸å°†æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­ï¼Œæ”¯æŒé«˜ååé‡çš„æ¶ˆæ¯å¤„ç†ã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åœ¨è¢«æ¶ˆè´¹åä¼šè¢«åˆ é™¤ã€‚</li><li><strong>æ•°æ®åº“é˜Ÿåˆ—</strong>ï¼šé€šè¿‡æ•°æ®åº“è¡¨å®ç°é˜Ÿåˆ—ç»“æ„ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ä¸€èˆ¬ä½¿ç”¨æ•°æ®åº“çš„äº‹åŠ¡æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ul></li><li><strong>æ€§èƒ½ä¸ååé‡</strong>ï¼š<ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šè®¾è®¡ä¸Šæ³¨é‡æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œæ”¯æŒé«˜å¹¶å‘çš„æ¶ˆæ¯ä¼ é€’ã€‚</li><li><strong>æ•°æ®åº“é˜Ÿåˆ—</strong>ï¼šé€šå¸¸æ€§èƒ½è¾ƒä½ï¼Œå› ä¸ºæ•°æ®åº“æ˜¯ä¸ºå­˜å‚¨å’ŒæŸ¥è¯¢è®¾è®¡çš„ï¼Œå¹¶ä¸é€‚åˆé«˜ååé‡çš„æ¶ˆæ¯ä¼ é€’ã€‚</li></ul></li><li><strong>æ‰©å±•æ€§</strong>ï¼š<ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šå¤§å¤šæ•°æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰å…·å¤‡é«˜å¯æ‰©å±•æ€§ï¼Œå¯ä»¥æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œé€‚åº”ä¸æ–­å¢é•¿çš„è´Ÿè½½ã€‚</li><li><strong>æ•°æ®åº“é˜Ÿåˆ—</strong>ï¼šæ•°æ®åº“ç³»ç»Ÿé€šå¸¸å¹¶éä¸ºé«˜å¹¶å‘æ¶ˆæ¯ä¼ é€’è®¾è®¡ï¼Œæ‰©å±•æ€§å·®ï¼Œå®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</li></ul></li></ol><h4 id="4-è¯·ç®€è¿°ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†"><a href="#4-è¯·ç®€è¿°ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†" class="headerlink" title="4. è¯·ç®€è¿°ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†"></a>4. è¯·ç®€è¿°ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†</h4><p>æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</strong>ï¼šç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚æ¶ˆæ¯é˜Ÿåˆ—æ¥æ”¶åˆ°æ¶ˆæ¯åä¼šå°†å…¶å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ï¼ˆé€šå¸¸å­˜å‚¨åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­ï¼‰ã€‚</li><li><strong>æ¶ˆè´¹è€…è·å–æ¶ˆæ¯</strong>ï¼šæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶å¤„ç†ã€‚æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šæ ¹æ®é…ç½®çš„æ¶ˆè´¹æ–¹å¼ï¼ˆå¦‚è½®è¯¢ã€å¹¿æ’­ç­‰ï¼‰å°†æ¶ˆæ¯åˆ†é…ç»™æ¶ˆè´¹è€…ã€‚</li><li><strong>æ¶ˆæ¯ç¡®è®¤</strong>ï¼šæ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯åï¼Œéœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œç¡®è®¤ï¼ˆACKï¼‰ã€‚ç¡®è®¤è¡¨ç¤ºæ¶ˆè´¹è€…å·²ç»æˆåŠŸå¤„ç†äº†è¯¥æ¶ˆæ¯ï¼Œå¯ä»¥ä»é˜Ÿåˆ—ä¸­åˆ é™¤è¯¥æ¶ˆæ¯ã€‚</li><li><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—é€šå¸¸æ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ï¼Œå³å°†æ¶ˆæ¯å†™å…¥ç£ç›˜ï¼Œä»¥é˜²ç³»ç»Ÿæ•…éšœæ—¶ä¸¢å¤±æ¶ˆæ¯ã€‚</li><li><strong>æ­»ä¿¡é˜Ÿåˆ—</strong>ï¼šå¦‚æœæ¶ˆè´¹è€…ä¸èƒ½å¤„ç†æŸäº›æ¶ˆæ¯ï¼ˆä¾‹å¦‚æ¶ˆæ¯æ ¼å¼é”™è¯¯ï¼‰ï¼Œè¿™äº›æ¶ˆæ¯å¯ä»¥è¢«è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œåç»­å¯ä»¥è¿›è¡Œäººå·¥å¤„ç†æˆ–é‡è¯•ã€‚</li></ol><h4 id="5-ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ"><a href="#5-ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ" class="headerlink" title="5. ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ"></a>5. ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ</h4><p><strong>æ¶ˆæ¯é˜Ÿåˆ—çš„æŒä¹…åŒ–</strong>æ˜¯æŒ‡å°†æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜æˆ–å…¶ä»–æŒä¹…åŒ–ä»‹è´¨ä¸­ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¼šå› ä¸ºç³»ç»Ÿå´©æºƒè€Œä¸¢å¤±ã€‚æ¶ˆæ¯é˜Ÿåˆ—é€šå¸¸æ”¯æŒä¸¤ç§æŒä¹…åŒ–æ¨¡å¼ï¼š<strong>åŒæ­¥æŒä¹…åŒ–</strong>å’Œ<strong>å¼‚æ­¥æŒä¹…åŒ–</strong>ã€‚</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–</strong>ï¼š</p><ul><li><strong>æ•°æ®å®‰å…¨æ€§</strong>ï¼šåœ¨ç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼ˆå¦‚æœåŠ¡å™¨å´©æºƒã€ç”µåŠ›ä¸­æ–­ç­‰ï¼‰æ—¶ï¼ŒæŒä¹…åŒ–å¯ä»¥ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œèƒ½å¤Ÿåœ¨ç³»ç»Ÿæ¢å¤åç»§ç»­å¤„ç†ã€‚</li><li><strong>å¯é æ€§</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—çš„æŒä¹…åŒ–ä¿è¯äº†æ¶ˆæ¯çš„å¯é ä¼ é€’ï¼Œå³ä½¿ç³»ç»Ÿé‡å¯æˆ–å´©æºƒï¼Œæ¶ˆæ¯ä»ç„¶å¯ä»¥è¢«æ¶ˆè´¹ã€‚</li><li><strong>äº‹åŠ¡æ€§</strong>ï¼šæŒä¹…åŒ–çš„æ¶ˆæ¯å¯ä»¥ç¡®ä¿æ¶ˆæ¯çš„ä¼ é€’ç¬¦åˆåŸå­æ€§ï¼Œå³æ¶ˆæ¯ä¸ä¼šé‡å¤æ¶ˆè´¹æˆ–æ¼æ‰ã€‚</li></ul><h4 id="6-ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„ACKæœºåˆ¶ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ"><a href="#6-ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„ACKæœºåˆ¶ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ" class="headerlink" title="6. ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„ACKæœºåˆ¶ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ"></a>6. ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„ACKæœºåˆ¶ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ</h4><p><strong>ACKï¼ˆAcknowledgmentï¼Œç¡®è®¤æœºåˆ¶ï¼‰</strong> æ˜¯æ¶ˆè´¹è€…åœ¨æˆåŠŸæ¶ˆè´¹å®Œæ¶ˆæ¯åï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€çš„ç¡®è®¤ä¿¡å·ã€‚å®ƒç”¨äºå‘ŠçŸ¥æ¶ˆæ¯é˜Ÿåˆ—è¯¥æ¶ˆæ¯å·²æˆåŠŸå¤„ç†ï¼Œå¯ä»¥ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚</p><p><strong>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§</strong>ï¼š</p><ol><li><strong>æ¶ˆæ¯çš„ç¡®è®¤æœºåˆ¶</strong>ï¼šæ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ¶ˆæ¯åéœ€è¦å‘é€ACKç¡®è®¤ã€‚å¦‚æœæ²¡æœ‰æ”¶åˆ°ACKï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šè®¤ä¸ºè¯¥æ¶ˆæ¯æ²¡æœ‰æˆåŠŸæ¶ˆè´¹ï¼Œå¹¶ä¸”å¯ä»¥å°†å…¶é‡æ–°æŠ•é€’ã€‚</li><li><strong>æ¶ˆæ¯çš„é‡è¯•æœºåˆ¶</strong>ï¼šå¦‚æœæ¶ˆè´¹è€…å¤„ç†å¤±è´¥ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å°†æ¶ˆæ¯é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼Œæˆ–è€…å°†æ¶ˆæ¯è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—è¿›è¡Œå¤„ç†ã€‚</li><li><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼šå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œå¯ä»¥ç¡®ä¿åœ¨ç³»ç»Ÿé‡å¯æˆ–å´©æºƒåï¼Œæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”å¯ä»¥é‡æ–°æŠ•é€’ã€‚</li><li><strong>å¹‚ç­‰æ€§</strong>ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºç½‘ç»œå’Œç³»ç»Ÿçš„æ•…éšœï¼Œæ¶ˆæ¯å¯èƒ½ä¼šè¢«é‡å¤æ¶ˆè´¹ã€‚é€šè¿‡ä¿è¯æ¶ˆè´¹çš„å¹‚ç­‰æ€§ï¼Œç¡®ä¿å³ä½¿åŒä¸€æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹å¤šæ¬¡ï¼Œä¹Ÿä¸ä¼šå¯¹ä¸šåŠ¡é€»è¾‘äº§ç”Ÿä¸ä¸€è‡´çš„å½±å“ã€‚</li></ol><h4 id="7-ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦‚ä½•ä¿è¯é¡ºåºæ€§çš„ï¼Ÿ"><a href="#7-ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦‚ä½•ä¿è¯é¡ºåºæ€§çš„ï¼Ÿ" class="headerlink" title="7. ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦‚ä½•ä¿è¯é¡ºåºæ€§çš„ï¼Ÿ"></a>7. ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦‚ä½•ä¿è¯é¡ºåºæ€§çš„ï¼Ÿ</h4><p><strong>æ¶ˆæ¯çš„é¡ºåºæ€§</strong>æ˜¯æŒ‡æ¶ˆæ¯è¢«ç”Ÿäº§è€…å‘é€åˆ°é˜Ÿåˆ—ä¸­çš„é¡ºåºåº”è¯¥ä¿æŒä¸€è‡´ï¼Œæ¶ˆè´¹è€…æŒ‰é¡ºåºå¤„ç†è¿™äº›æ¶ˆæ¯ã€‚å³ï¼šæ¶ˆæ¯åœ¨ç”Ÿäº§è€…ç«¯çš„é¡ºåºåº”è¯¥ä¸æ¶ˆè´¹è€…ç«¯çš„é¡ºåºä¸€è‡´ã€‚</p><p><strong>å¦‚ä½•ä¿è¯é¡ºåºæ€§</strong>ï¼š</p><ul><li><strong>å•é˜Ÿåˆ—æ¶ˆè´¹</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—é€šå¸¸é€šè¿‡ä¿è¯æ¯ä¸ªé˜Ÿåˆ—åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ¥ä¿è¯é¡ºåºæ€§ã€‚æ¶ˆè´¹è€…æŒ‰é¡ºåºæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li><li><strong>åˆ†åŒºä¸åˆ†ç»„</strong>ï¼šåœ¨ä¸€äº›é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ˆå¦‚ Kafkaï¼‰ä¸­ï¼Œæ¶ˆæ¯å¯ä»¥æ ¹æ®åˆ†åŒºè¿›è¡Œå¤„ç†ï¼Œç¡®ä¿åŒä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯é¡ºåºæ€§ã€‚æ¶ˆè´¹è€…é€šè¿‡æ¶ˆè´¹è€…ç»„æ¥ä¿è¯é¡ºåºæ€§ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å¹¶è¡Œæ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ¶ˆæ¯ã€‚</li></ul><h4 id="8-ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿ"><a href="#8-ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿ" class="headerlink" title="8. ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿ"></a>8. ä»€ä¹ˆæ˜¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿ</h4><p><strong>æ¶ˆæ¯çš„å¹‚ç­‰æ€§</strong>æ˜¯æŒ‡æ¶ˆæ¯æ— è®ºè¢«æ¶ˆè´¹å¤šå°‘æ¬¡ï¼Œæ¶ˆè´¹è€…çš„ä¸šåŠ¡é€»è¾‘ç»“æœå§‹ç»ˆä¿æŒä¸€è‡´ï¼Œé¿å…äº†é‡å¤æ¶ˆè´¹å¯¼è‡´çš„å‰¯ä½œç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨æ”¯ä»˜ç³»ç»Ÿä¸­ï¼Œå³ä½¿æ¶ˆæ¯è¢«é‡å¤å¤„ç†ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´é‡å¤æ‰£æ¬¾ã€‚</p><p><strong>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§</strong>ï¼š</p><ol><li><strong>å”¯ä¸€æ ‡è¯†ç¬¦</strong>ï¼šç»™æ¯æ¡æ¶ˆæ¯åŠ ä¸Šå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆå¦‚ UUIDï¼‰ï¼Œæ¶ˆè´¹ç«¯å¯ä»¥æ ¹æ®æ ‡è¯†ç¬¦åˆ¤æ–­è¯¥æ¶ˆæ¯æ˜¯å¦å·²è¢«å¤„ç†è¿‡ï¼Œé¿å…é‡å¤æ¶ˆè´¹ã€‚</li><li><strong>å»é‡æœºåˆ¶</strong>ï¼šå¯ä»¥åœ¨æ•°æ®åº“å±‚é¢æˆ–ç¼“å­˜å±‚é¢åšå»é‡ï¼Œè®°å½•å·²å¤„ç†è¿‡çš„æ¶ˆæ¯ IDï¼Œå½“å‘ç°æ¶ˆæ¯å·²å¤„ç†è¿‡æ—¶ï¼Œè·³è¿‡è¯¥æ¶ˆæ¯ã€‚</li><li><strong>ä¸šåŠ¡è®¾è®¡</strong>ï¼šé€šè¿‡è®¾è®¡å¹‚ç­‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œâ€œæ’å…¥æˆ–æ›´æ–°â€çš„æ“ä½œï¼Œç¡®ä¿ç›¸åŒçš„æ•°æ®æ“ä½œä¸ä¼šå¯¹ç³»ç»Ÿäº§ç”Ÿå‰¯ä½œç”¨ã€‚</li></ol><p>é€šè¿‡è¿™äº›æ‰‹æ®µï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°å¹‚ç­‰æ¶ˆè´¹ï¼Œç¡®ä¿æ¶ˆæ¯å¤šæ¬¡æ¶ˆè´¹ä¸ä¼šå¼•èµ·ç³»ç»Ÿçš„ä¸ä¸€è‡´æ€§ã€‚</p><h3 id="å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ"><a href="#å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ" class="headerlink" title="å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ"></a>å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ</h3><ol><li>è¯·ç®€è¿°RabbitMQã€Kafkaã€ActiveMQçš„ä¸»è¦ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯ã€‚</li><li>åœ¨Kafkaä¸­ï¼Œä»€ä¹ˆæ˜¯åˆ†åŒºï¼ˆPartitionï¼‰ï¼Ÿå®ƒæ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„ï¼Ÿ</li><li>Kafkaä¸­å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</li><li>RabbitMQæ˜¯å¦‚ä½•å¤„ç†æ¶ˆæ¯çš„è·¯ç”±ä¸äº¤æ¢çš„ï¼Ÿä»€ä¹ˆæ˜¯äº¤æ¢å™¨ï¼ˆExchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆQueueï¼‰çš„å…³ç³»ï¼Ÿ</li><li>è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€æ­»ä¿¡é˜Ÿåˆ—â€ï¼ˆDLQï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ActiveMQä¸­çš„â€œæŒä¹…åŒ–â€æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸â€œéæŒä¹…åŒ–â€æ¶ˆæ¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€äº‹åŠ¡æœºåˆ¶â€æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</li></ol><h4 id="1-è¯·ç®€è¿°RabbitMQã€Kafkaã€ActiveMQçš„ä¸»è¦ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯"><a href="#1-è¯·ç®€è¿°RabbitMQã€Kafkaã€ActiveMQçš„ä¸»è¦ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯" class="headerlink" title="1. è¯·ç®€è¿°RabbitMQã€Kafkaã€ActiveMQçš„ä¸»è¦ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯"></a>1. è¯·ç®€è¿°RabbitMQã€Kafkaã€ActiveMQçš„ä¸»è¦ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯</h4><h5 id="RabbitMQ-2"><a href="#RabbitMQ-2" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h5><p><strong>ä¸»è¦ç‰¹ç‚¹</strong>ï¼š</p><ul><li>åŸºäºAMQPåè®®ï¼ˆAdvanced Message Queuing Protocolï¼‰ï¼Œéå¸¸é€‚åˆæ¶ˆæ¯çš„å¯é ä¼ é€’ã€‚</li><li>æ”¯æŒå¤šç§æ¶ˆæ¯äº¤æ¢æ¨¡å¼ï¼Œå¦‚<strong>å‘å¸ƒ&#x2F;è®¢é˜…ã€è¯·æ±‚&#x2F;å“åº”</strong>ã€‚</li><li>æä¾›æ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰ã€æ¶ˆæ¯æŒä¹…åŒ–ç­‰ç‰¹æ€§ï¼Œä¿è¯æ¶ˆæ¯çš„å¯é æ€§ã€‚</li><li>æ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œæ”¯æŒæ¶ˆæ¯çš„è´Ÿè½½å‡è¡¡ã€‚</li><li>å¯ä»¥é€šè¿‡**äº¤æ¢å™¨ï¼ˆExchangeï¼‰**æ¥è¿›è¡Œçµæ´»çš„æ¶ˆæ¯è·¯ç”±ã€‚</li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äº<strong>å¼‚æ­¥ä»»åŠ¡å¤„ç†</strong>ã€<strong>æ¶ˆæ¯è°ƒåº¦</strong>ã€<strong>å¾®æœåŠ¡æ¶æ„ä¸­æœåŠ¡é—´çš„æ¶ˆæ¯ä¼ é€’</strong>ã€‚</li><li>é€‚åˆå¯¹æ¶ˆæ¯çš„å¯é æ€§ã€é¡ºåºæ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯éœ€è¦çµæ´»çš„æ¶ˆæ¯è·¯ç”±ã€‚</li></ul><h5 id="Kafka-1"><a href="#Kafka-1" class="headerlink" title="Kafka"></a>Kafka</h5><p><strong>ä¸»è¦ç‰¹ç‚¹</strong>ï¼š</p><ul><li>åŸºäºåˆ†å¸ƒå¼æ¶æ„ï¼Œæ”¯æŒæµ·é‡æ•°æ®çš„é«˜ååé‡å¤„ç†ã€‚</li><li>æ¶ˆæ¯è¢«å†™å…¥åˆ°**åˆ†åŒºï¼ˆPartitionï¼‰<strong>ä¸­ï¼Œå¯ä»¥é€šè¿‡</strong>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰**æ¥é«˜æ•ˆåœ°å¹¶è¡Œæ¶ˆè´¹ã€‚</li><li>æ¶ˆæ¯æŒ‰æ—¶é—´é¡ºåºå†™å…¥ï¼Œæä¾›é«˜ååé‡å’Œä½å»¶è¿Ÿçš„æ¶ˆæ¯å¤„ç†èƒ½åŠ›ã€‚</li><li>å¼ºå¤§çš„æ¶ˆæ¯æŒä¹…åŒ–æœºåˆ¶ï¼Œæ”¯æŒ<strong>æ—¥å¿—å­˜å‚¨ï¼ˆLog-based Storageï¼‰</strong>ã€‚</li><li>æ¶ˆæ¯çš„é¡ºåºæ€§åªåœ¨<strong>åŒä¸€ä¸ªåˆ†åŒº</strong>å†…ä¿è¯ã€‚</li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºéœ€è¦é«˜ååé‡ã€é«˜å¯ç”¨æ€§çš„åœºæ™¯ï¼Œä¾‹å¦‚<strong>æ—¥å¿—å¤„ç†ã€äº‹ä»¶æµå¤„ç†ã€å®æ—¶æ•°æ®åˆ†æ</strong>ã€‚</li><li>é€‚åˆé«˜å¹¶å‘ã€å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®æµå¤„ç†ã€‚</li></ul><h5 id="ActiveMQ-1"><a href="#ActiveMQ-1" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h5><p><strong>ä¸»è¦ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ”¯æŒJMSï¼ˆJava Message Serviceï¼‰ï¼Œé€‚ç”¨äºJavaåº”ç”¨ä¸­è¿›è¡Œæ¶ˆæ¯ä¼ é€’ã€‚</li><li>æä¾›ç‚¹å¯¹ç‚¹å’Œå‘å¸ƒ&#x2F;è®¢é˜…ä¸¤ç§æ¨¡å¼ã€‚</li><li>æ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ã€äº‹åŠ¡å¤„ç†ã€æ¶ˆæ¯ç¡®è®¤ç­‰ã€‚</li><li>æ”¯æŒå¤šç§åè®®ï¼Œå¦‚<strong>OpenWireã€AMQPã€STOMP</strong>ç­‰ã€‚</li><li>æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²å’Œé«˜å¯ç”¨é…ç½®ã€‚</li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºJavaåº”ç”¨ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’å’Œé›†æˆï¼Œå°¤å…¶æ˜¯åŸºäºJMSçš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ã€‚</li><li>é€‚ç”¨äº<strong>ä¼ä¸šçº§åº”ç”¨ã€åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡é€šä¿¡ã€æ•°æ®åŒæ­¥ç­‰</strong>ã€‚</li></ul><h4 id="2-åœ¨Kafkaä¸­ï¼Œä»€ä¹ˆæ˜¯åˆ†åŒºï¼ˆPartitionï¼‰ï¼Ÿå®ƒæ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„ï¼Ÿ"><a href="#2-åœ¨Kafkaä¸­ï¼Œä»€ä¹ˆæ˜¯åˆ†åŒºï¼ˆPartitionï¼‰ï¼Ÿå®ƒæ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„ï¼Ÿ" class="headerlink" title="2. åœ¨Kafkaä¸­ï¼Œä»€ä¹ˆæ˜¯åˆ†åŒºï¼ˆPartitionï¼‰ï¼Ÿå®ƒæ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„ï¼Ÿ"></a>2. åœ¨Kafkaä¸­ï¼Œä»€ä¹ˆæ˜¯åˆ†åŒºï¼ˆPartitionï¼‰ï¼Ÿå®ƒæ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„ï¼Ÿ</h4><p>**åˆ†åŒºï¼ˆPartitionï¼‰*<em>æ˜¯Kafkaä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ã€‚æ¯ä¸ªä¸»é¢˜ï¼ˆTopicï¼‰å¯ä»¥åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºæ˜¯ä¸€ä¸ª*<em>æœ‰åºçš„æ¶ˆæ¯é˜Ÿåˆ—</em></em>ã€‚æ¶ˆæ¯å†™å…¥ä¸€ä¸ªåˆ†åŒºåï¼Œæ¶ˆè´¹è€…å¯ä»¥æ ¹æ®åˆ†åŒºè¯»å–æ¶ˆæ¯ã€‚</p><p><strong>å¦‚ä½•æé«˜æ€§èƒ½</strong>ï¼š</p><ul><li><strong>å¹¶è¡Œæ¶ˆè´¹</strong>ï¼šé€šè¿‡åˆ†åŒºï¼ŒKafkaèƒ½å¤Ÿå°†ä¸€ä¸ªä¸»é¢˜çš„æ¶ˆæ¯åˆ†å¸ƒåˆ°å¤šä¸ªåˆ†åŒºä¸Šï¼Œä½¿å¾—å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å¹¶è¡Œå¤„ç†ä¸åŒåˆ†åŒºçš„æ¶ˆæ¯ã€‚è¿™ç§å¹¶è¡Œæ¶ˆè´¹å¤§å¤§æé«˜äº†ç³»ç»Ÿçš„ååé‡ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šKafkaå…è®¸æ¶ˆè´¹è€…æ ¹æ®éœ€è¦åŠ¨æ€è°ƒæ•´åˆ†é…åˆ°çš„åˆ†åŒºï¼Œå¹³è¡¡æ¶ˆè´¹è´Ÿè½½ï¼Œé¿å…å•ä¸ªæ¶ˆè´¹è€…çš„å‹åŠ›è¿‡å¤§ã€‚</li><li><strong>æ•°æ®å±€éƒ¨æ€§</strong>ï¼šæ¯ä¸ªåˆ†åŒºå­˜å‚¨åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œå¤šä¸ªåˆ†åŒºåˆ†å¸ƒåœ¨é›†ç¾¤çš„ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œä½¿å¾—æ¶ˆæ¯å­˜å‚¨ä¸æ¶ˆè´¹çš„è´Ÿè½½å¾—åˆ°æœ‰æ•ˆåˆ†æ‹…ã€‚</li></ul><h4 id="3-Kafkaä¸­å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"><a href="#3-Kafkaä¸­å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ" class="headerlink" title="3. Kafkaä¸­å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"></a>3. Kafkaä¸­å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</h4><p>Kafkaä¿è¯æ¶ˆæ¯é¡ºåºæ€§çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li><strong>åŒä¸€åˆ†åŒºå†…é¡ºåºæ€§</strong>ï¼šKafkaç¡®ä¿åŒä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯ä¸¥æ ¼æŒ‰é¡ºåºæ¶ˆè´¹ã€‚æ¯ä¸ªåˆ†åŒºæ˜¯ä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—ï¼Œæ¶ˆæ¯ä¼šæŒ‰å†™å…¥é¡ºåºè¿›è¡Œæ’åˆ—ï¼Œæ¶ˆè´¹è€…æŒ‰é¡ºåºè¯»å–ã€‚</li><li><strong>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</strong>ï¼šåœ¨ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…ï¼ŒKafkaç¡®ä¿æ¯ä¸ªæ¶ˆè´¹è€…åªä¼šæ¶ˆè´¹æŸäº›åˆ†åŒºï¼Œé¿å…å¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œæ¶ˆè´¹åŒä¸€åˆ†åŒºï¼Œå¯¼è‡´é¡ºåºæ··ä¹±ã€‚</li></ul><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœéœ€è¦è·¨åˆ†åŒºçš„é¡ºåºä¿è¯ï¼ŒKafkaæœ¬èº«æ— æ³•åšåˆ°ï¼Œå› ä¸ºè·¨åˆ†åŒºçš„æ¶ˆæ¯ä¼šè¢«å¹¶è¡Œå¤„ç†ï¼Œä¸èƒ½ä¿è¯é¡ºåºã€‚</p><h4 id="4-RabbitMQæ˜¯å¦‚ä½•å¤„ç†æ¶ˆæ¯çš„è·¯ç”±ä¸äº¤æ¢çš„ï¼Ÿä»€ä¹ˆæ˜¯äº¤æ¢å™¨ï¼ˆExchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆQueueï¼‰çš„å…³ç³»ï¼Ÿ"><a href="#4-RabbitMQæ˜¯å¦‚ä½•å¤„ç†æ¶ˆæ¯çš„è·¯ç”±ä¸äº¤æ¢çš„ï¼Ÿä»€ä¹ˆæ˜¯äº¤æ¢å™¨ï¼ˆExchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆQueueï¼‰çš„å…³ç³»ï¼Ÿ" class="headerlink" title="4. RabbitMQæ˜¯å¦‚ä½•å¤„ç†æ¶ˆæ¯çš„è·¯ç”±ä¸äº¤æ¢çš„ï¼Ÿä»€ä¹ˆæ˜¯äº¤æ¢å™¨ï¼ˆExchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆQueueï¼‰çš„å…³ç³»ï¼Ÿ"></a>4. RabbitMQæ˜¯å¦‚ä½•å¤„ç†æ¶ˆæ¯çš„è·¯ç”±ä¸äº¤æ¢çš„ï¼Ÿä»€ä¹ˆæ˜¯äº¤æ¢å™¨ï¼ˆExchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆQueueï¼‰çš„å…³ç³»ï¼Ÿ</h4><p><strong>RabbitMQä¸­çš„è·¯ç”±æœºåˆ¶</strong>ï¼š</p><ul><li><p>Exchangeï¼šExchangeæ˜¯RabbitMQçš„è·¯ç”±å™¨ï¼Œè´Ÿè´£æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¹¶æ ¹æ®æ¶ˆæ¯çš„è·¯ç”±è§„åˆ™å°†å…¶åˆ†å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ä¸­ã€‚Exchangeçš„ç±»å‹æœ‰å¤šç§ï¼Œå¦‚</p><p>directã€fanoutã€topicã€headers</p><p>ç­‰ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„è·¯ç”±ç­–ç•¥ã€‚</p><ul><li><strong>direct Exchange</strong>ï¼šå°†æ¶ˆæ¯ç›´æ¥è·¯ç”±åˆ°ç»‘å®šçš„é˜Ÿåˆ—ã€‚</li><li><strong>fanout Exchange</strong>ï¼šå°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ã€‚</li><li><strong>topic Exchange</strong>ï¼šæ ¹æ®è·¯ç”±é”®çš„æ¨¡å¼å°†æ¶ˆæ¯è·¯ç”±åˆ°åŒ¹é…çš„é˜Ÿåˆ—ã€‚</li><li><strong>headers Exchange</strong>ï¼šæ ¹æ®æ¶ˆæ¯å¤´éƒ¨çš„ä¿¡æ¯è¿›è¡Œè·¯ç”±ã€‚</li></ul></li></ul><p><strong>é˜Ÿåˆ—ï¼ˆQueueï¼‰</strong>ï¼šé˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„å­˜å‚¨åŒºã€‚æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶å¤„ç†ã€‚</p><p><strong>å…³ç³»</strong>ï¼š</p><ul><li>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™Exchangeï¼ŒExchangeæ ¹æ®ç»‘å®šçš„è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯è½¬å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ã€‚Exchangeå’Œé˜Ÿåˆ—çš„å…³ç³»å†³å®šäº†æ¶ˆæ¯çš„è·¯ç”±è·¯å¾„ã€‚</li></ul><h4 id="5-è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€æ­»ä¿¡é˜Ÿåˆ—â€ï¼ˆDLQï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5-è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€æ­»ä¿¡é˜Ÿåˆ—â€ï¼ˆDLQï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5. è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€æ­»ä¿¡é˜Ÿåˆ—â€ï¼ˆDLQï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>5. è¯·è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€æ­»ä¿¡é˜Ÿåˆ—â€ï¼ˆDLQï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>**æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLQï¼ŒDead Letter Queueï¼‰*<em>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œç”¨äºå­˜å‚¨æ— æ³•æˆåŠŸæ¶ˆè´¹çš„æ¶ˆæ¯ã€‚è¿™äº›æ¶ˆæ¯å¯èƒ½å› ä¸º*<em>æ¶ˆè´¹è€…å¤„ç†å¤±è´¥</em></em>ã€<strong>æ¶ˆæ¯è¿‡æœŸ</strong>ã€<strong>é˜Ÿåˆ—æ»¡</strong>ç­‰åŸå› æœªèƒ½æˆåŠŸæ¶ˆè´¹ã€‚</p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li><strong>æ¶ˆæ¯éš”ç¦»</strong>ï¼šæ­»ä¿¡é˜Ÿåˆ—å¯ä»¥æœ‰æ•ˆéš”ç¦»æ— æ³•æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œé¿å…å®ƒä»¬å½±å“æ­£å¸¸çš„æ¶ˆæ¯æ¶ˆè´¹æµç¨‹ã€‚</li><li><strong>é—®é¢˜æ’æŸ¥</strong>ï¼šå°†æ— æ³•å¤„ç†çš„æ¶ˆæ¯æ”¾å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œä¾¿äºå¼€å‘äººå‘˜è¿›è¡Œè¯Šæ–­ã€æ’æŸ¥å’Œæ‰‹åŠ¨å¤„ç†ã€‚</li><li><strong>é‡è¯•æœºåˆ¶</strong>ï¼šæ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé‡è¯•ï¼Œæˆ–è€…é€šè¿‡äººå·¥å¹²é¢„å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</li></ul><h4 id="6-ActiveMQä¸­çš„â€œæŒä¹…åŒ–â€æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸â€œéæŒä¹…åŒ–â€æ¶ˆæ¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#6-ActiveMQä¸­çš„â€œæŒä¹…åŒ–â€æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸â€œéæŒä¹…åŒ–â€æ¶ˆæ¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="6. ActiveMQä¸­çš„â€œæŒä¹…åŒ–â€æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸â€œéæŒä¹…åŒ–â€æ¶ˆæ¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>6. ActiveMQä¸­çš„â€œæŒä¹…åŒ–â€æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸â€œéæŒä¹…åŒ–â€æ¶ˆæ¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>**æŒä¹…åŒ–ï¼ˆPersistentï¼‰**æœºåˆ¶ï¼šActiveMQå°†æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œä»¥ç¡®ä¿å³ä½¿æ¶ˆæ¯ä¸­é—´çš„Brokerå‘ç”Ÿå´©æºƒï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æŒä¹…åŒ–æ¶ˆæ¯çš„å­˜å‚¨è¿‡ç¨‹åŒ…æ‹¬å°†æ¶ˆæ¯å†™å…¥ç£ç›˜ã€ç¡®ä¿æ¶ˆæ¯çš„å®‰å…¨æ€§ç­‰ã€‚</p><p><strong>å¦‚ä½•å®ç°</strong>ï¼š</p><ul><li>åœ¨æ¶ˆæ¯å‘é€æ—¶ï¼Œç”Ÿäº§è€…å¯ä»¥è®¾ç½®æ¶ˆæ¯ä¸ºæŒä¹…åŒ–ç±»å‹ï¼ˆ<code>setPersistent(true)</code>ï¼‰ã€‚</li><li>æ¶ˆæ¯åœ¨Brokerä¸­å­˜å‚¨æ—¶ï¼Œä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Šçš„æ¶ˆæ¯å­˜å‚¨æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯æ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸­ã€‚</li></ul><p><strong>ä¸éæŒä¹…åŒ–æ¶ˆæ¯çš„åŒºåˆ«</strong>ï¼š</p><ul><li><strong>æŒä¹…åŒ–æ¶ˆæ¯</strong>ï¼šæ¶ˆæ¯ä¼šå­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œä¿è¯æ¶ˆæ¯åœ¨Brokeré‡å¯åä¾ç„¶å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡æŒä¹…åŒ–å­˜å‚¨æ¥ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚</li><li><strong>éæŒä¹…åŒ–æ¶ˆæ¯</strong>ï¼šæ¶ˆæ¯åªä¼šå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ŒBrokeré‡å¯åä¼šä¸¢å¤±è¿™äº›æ¶ˆæ¯ï¼Œé€‚ç”¨äºå¯¹æ¶ˆæ¯ä¸¢å¤±å®¹å¿åº¦è¾ƒé«˜çš„åœºæ™¯ã€‚</li></ul><h4 id="7-æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€äº‹åŠ¡æœºåˆ¶â€æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"><a href="#7-æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€äº‹åŠ¡æœºåˆ¶â€æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ" class="headerlink" title="7. æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€äº‹åŠ¡æœºåˆ¶â€æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"></a>7. æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€äº‹åŠ¡æœºåˆ¶â€æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h4><p><strong>äº‹åŠ¡æœºåˆ¶</strong>åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç”¨äºä¿è¯æ¶ˆæ¯çš„<strong>åŸå­æ€§ã€ä¸€è‡´æ€§</strong>ã€‚åœ¨äº‹åŠ¡æœºåˆ¶ä¸­ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°ç¡®è®¤æ¶ˆæ¯å·²ç»æˆåŠŸå­˜å‚¨ï¼Œäº‹åŠ¡æ‰ä¼šæäº¤ã€‚</p><p><strong>å¦‚ä½•å·¥ä½œ</strong>ï¼š</p><ul><li>ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶å¼€å¯ä¸€ä¸ª<strong>äº‹åŠ¡</strong>ï¼Œå¹¶å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯ã€‚</li><li>åªæœ‰å½“æ¶ˆæ¯é˜Ÿåˆ—ç¡®è®¤æ¶ˆæ¯å·²æŒä¹…åŒ–æ—¶ï¼Œäº‹åŠ¡æ‰ä¼šæäº¤ã€‚å¦åˆ™ï¼Œæ¶ˆæ¯ä¼šè¢«å›æ»šï¼Œä¿è¯æ¶ˆæ¯æœªæ¶ˆè´¹æ—¶ä¸ä¼šè¢«æ°¸ä¹…ä¿å­˜ã€‚</li><li>æ¶ˆè´¹è€…ä¹Ÿå¯ä»¥é€šè¿‡<strong>äº‹åŠ¡æ–¹å¼</strong>æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œç¡®ä¿æ¶ˆæ¯çš„å¤„ç†æ˜¯æˆåŠŸçš„ã€‚å¦‚æœå¤„ç†å¤±è´¥ï¼Œäº‹åŠ¡ä¼šå›æ»šï¼Œæ¶ˆæ¯é‡æ–°æ”¾å›é˜Ÿåˆ—ç­‰å¾…é‡è¯•ã€‚</li></ul><p>è¿™ç§æœºåˆ¶ç¡®ä¿äº†æ¶ˆæ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­çš„<strong>å¯é æ€§</strong>å’Œ<strong>ä¸€è‡´æ€§</strong>ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦é«˜å¯é æ€§çš„åœºæ™¯ï¼Œå¦‚é‡‘èäº¤æ˜“ã€åº“å­˜ç®¡ç†ç­‰ã€‚</p><hr><h3 id="é«˜çº§åº”ç”¨"><a href="#é«˜çº§åº”ç”¨" class="headerlink" title="é«˜çº§åº”ç”¨"></a>é«˜çº§åº”ç”¨</h3><ol><li>æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…å¦‚ä½•å®ç°æ¶ˆæ¯çš„æ‰¹é‡å¤„ç†ï¼Ÿ</li><li>åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¦‚ä½•å¤„ç†æ¶ˆè´¹è€…ç«¯çš„æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Ÿ</li><li>å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯ä¸¢å¤±â€é—®é¢˜ï¼Ÿ</li><li>æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œå»¶è¿Ÿæ¶ˆæ¯â€æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿæœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ</li><li>å¦‚ä½•åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™æœºåˆ¶ï¼Ÿæœ‰å“ªäº›å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Ÿ</li></ol><h4 id="1-æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…å¦‚ä½•å®ç°æ¶ˆæ¯çš„æ‰¹é‡å¤„ç†ï¼Ÿ"><a href="#1-æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…å¦‚ä½•å®ç°æ¶ˆæ¯çš„æ‰¹é‡å¤„ç†ï¼Ÿ" class="headerlink" title="1. æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…å¦‚ä½•å®ç°æ¶ˆæ¯çš„æ‰¹é‡å¤„ç†ï¼Ÿ"></a>1. æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…å¦‚ä½•å®ç°æ¶ˆæ¯çš„æ‰¹é‡å¤„ç†ï¼Ÿ</h4><p>æ¶ˆè´¹è€…å®ç°æ¶ˆæ¯çš„æ‰¹é‡å¤„ç†ï¼Œé€šå¸¸æ˜¯ä¸ºäº†æé«˜æ¶ˆæ¯æ¶ˆè´¹çš„æ•ˆç‡ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ï¼Œå‡å°‘ç³»ç»Ÿçš„å¼€é”€ã€‚æ‰¹é‡æ¶ˆè´¹åœ¨å¤§è§„æ¨¡ç³»ç»Ÿä¸­å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥æ˜¾è‘—æé«˜ååé‡ã€‚</p><p><strong>å®ç°æ–¹æ³•</strong>ï¼š</p><ul><li><strong>æ¶ˆè´¹è€…é…ç½®æ‰¹é‡æ¶ˆè´¹</strong>ï¼šå¤§å¤šæ•°æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œå¦‚RabbitMQå’ŒKafkaï¼Œéƒ½æ”¯æŒæ¶ˆè´¹è€…æ‰¹é‡æ‹‰å–æ¶ˆæ¯ã€‚æ¶ˆè´¹è€…å¯ä»¥é…ç½®æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­æ‹‰å–ä¸€å®šæ•°é‡çš„æ¶ˆæ¯ã€‚<ul><li><strong>RabbitMQ</strong>ï¼šå¯ä»¥é€šè¿‡<code>basicGet()</code>å’Œ<code>basicConsume()</code>æ¥å£ï¼Œç»“åˆ<code>prefetch</code>è®¾ç½®æ¥æ§åˆ¶æ¶ˆè´¹è€…çš„æ¶ˆæ¯æ‹‰å–æ•°é‡ã€‚</li><li><strong>Kafka</strong>ï¼šæ¶ˆè´¹è€…å¯ä»¥è®¾ç½®<code>max.poll.records</code>ï¼ŒæŒ‡å®šæ¯æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ•°ã€‚è¿™å°†å½±å“åˆ°æ¶ˆè´¹è€…æ¯æ¬¡æ‰¹é‡å¤„ç†çš„æ¶ˆæ¯æ•°é‡ã€‚</li></ul></li><li><strong>æ‰‹åŠ¨ç¡®è®¤æœºåˆ¶</strong>ï¼šæ¶ˆè´¹è€…åœ¨å¤„ç†å®Œä¸€æ‰¹æ¶ˆæ¯åï¼Œæ‰‹åŠ¨å‘é€æ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰ï¼Œç¡®ä¿æ¶ˆæ¯å·²ç»è¢«æˆåŠŸæ¶ˆè´¹ã€‚è¿™ä¸ªç¡®è®¤æœºåˆ¶ç¡®ä¿äº†æ‰¹é‡æ¶ˆè´¹ä¸­çš„æ¶ˆæ¯ä¸ä¼šå› ä¸ºæ¶ˆè´¹å¤±è´¥è€Œä¸¢å¤±ã€‚</li><li><strong>æ‰¹é‡æäº¤</strong>ï¼šæ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ‰¹é‡æ¶ˆæ¯åï¼Œå¯ä»¥å°†ç»“æœä¸€èµ·æäº¤ï¼Œè€Œä¸æ˜¯ä¸€æ¡ä¸€æ¡åœ°æäº¤ã€‚é€šè¿‡æ‰¹é‡æäº¤ï¼Œå‡å°‘äº†æäº¤æ“ä½œçš„æ¬¡æ•°ã€‚</li></ul><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>å‡å°‘äº†æ¯æ¡æ¶ˆæ¯å¤„ç†çš„å¼€é”€ï¼Œæå‡äº†ç³»ç»Ÿååé‡ã€‚</li><li>å¯ä»¥é€šè¿‡æ‰¹é‡ç¡®è®¤ï¼Œç¡®ä¿æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±ã€‚</li></ul><h4 id="2-åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¦‚ä½•å¤„ç†æ¶ˆè´¹è€…ç«¯çš„æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Ÿ"><a href="#2-åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¦‚ä½•å¤„ç†æ¶ˆè´¹è€…ç«¯çš„æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Ÿ" class="headerlink" title="2. åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¦‚ä½•å¤„ç†æ¶ˆè´¹è€…ç«¯çš„æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Ÿ"></a>2. åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¦‚ä½•å¤„ç†æ¶ˆè´¹è€…ç«¯çš„æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Ÿ</h4><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜æ˜¯ä¸å¯é¿å…çš„ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ—¶å‘ç”Ÿæ•…éšœæˆ–æ¶ˆè´¹è€…ç¡®è®¤ï¼ˆACKï¼‰æ¶ˆæ¯æ—¶çš„å»¶è¿Ÿã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿé‡‡ç”¨äº†ä¸åŒçš„æŠ€æœ¯æ‰‹æ®µã€‚</p><p><strong>å¸¸è§çš„å¤„ç†æ–¹æ³•</strong>ï¼š</p><ul><li>æ¶ˆæ¯å¹‚ç­‰æ€§ï¼š<ul><li>è®¾è®¡æ¶ˆè´¹è€…å¤„ç†é€»è¾‘æ—¶ï¼Œè¦ç¡®ä¿å³ä½¿åŒä¸€æ¡æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹ï¼Œä¹Ÿä¸ä¼šå½±å“ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæ¶ˆè´¹ç«¯å¯ä»¥è®¾è®¡æˆå¹‚ç­‰æ“ä½œï¼Œæ¯”å¦‚æ•°æ®åº“æ“ä½œæ—¶ä½¿ç”¨<strong>å”¯ä¸€æ ‡è¯†ç¬¦</strong>ï¼ˆå¦‚è®¢å•å·ã€ç”¨æˆ·IDç­‰ï¼‰æ¥é¿å…é‡å¤æ’å…¥ã€‚</li></ul></li><li>æ¶ˆæ¯å»é‡ï¼š<ul><li>æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥é€šè¿‡<strong>æ¶ˆæ¯ID</strong>æˆ–<strong>å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦</strong>æ¥å¯¹æ¶ˆæ¯è¿›è¡Œå»é‡å¤„ç†ã€‚æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æ—¶ï¼Œå¦‚æœå‘ç°å·²ç»å¤„ç†è¿‡è¯¥æ¶ˆæ¯ï¼Œåˆ™è·³è¿‡è¯¥æ¶ˆæ¯ã€‚</li></ul></li><li>äº‹åŠ¡æœºåˆ¶ï¼š<ul><li>äº‹åŠ¡æœºåˆ¶å¯ä»¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œåœ¨æ¶ˆè´¹è€…å‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±æˆ–è¢«é‡å¤æ¶ˆè´¹ã€‚æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<strong>äº‹åŠ¡ç®¡ç†</strong>ï¼Œç¡®ä¿æ“ä½œçš„ä¸€è‡´æ€§ã€‚</li></ul></li><li>æ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰ï¼š<ul><li>æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹å®Œæ¶ˆæ¯åï¼Œé€šè¿‡å‘é€ç¡®è®¤æ¶ˆæ¯ï¼ˆACKï¼‰æ¥å‘ŠçŸ¥æ¶ˆæ¯é˜Ÿåˆ—è¯¥æ¶ˆæ¯å·²è¢«æˆåŠŸæ¶ˆè´¹ã€‚å¦‚æœæ¶ˆè´¹å¤±è´¥ï¼Œæ¶ˆè´¹è€…å¯ä»¥é€‰æ‹©ä¸å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šé‡æ–°æŠ•é€’è¯¥æ¶ˆæ¯ã€‚</li></ul></li></ul><h4 id="3-å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯ä¸¢å¤±â€é—®é¢˜ï¼Ÿ"><a href="#3-å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯ä¸¢å¤±â€é—®é¢˜ï¼Ÿ" class="headerlink" title="3. å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯ä¸¢å¤±â€é—®é¢˜ï¼Ÿ"></a>3. å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯ä¸¢å¤±â€é—®é¢˜ï¼Ÿ</h4><p>æ¶ˆæ¯ä¸¢å¤±é—®é¢˜é€šå¸¸å‘ç”Ÿåœ¨æ¶ˆè´¹è€…æœªåŠæ—¶ç¡®è®¤æ¶ˆæ¯ï¼Œæˆ–è€…åœ¨æ¶ˆæ¯é˜Ÿåˆ—å­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”Ÿæ•…éšœã€‚ä¸ºäº†ç¡®ä¿æ¶ˆæ¯çš„å¯é æ€§ï¼Œå¸¸è§çš„è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ï¼š</p><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>æ¶ˆæ¯æŒä¹…åŒ–ï¼š<ul><li>æ¶ˆæ¯æŒä¹…åŒ–æ˜¯ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±çš„æ ¸å¿ƒæœºåˆ¶ã€‚é€šè¿‡å°†æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œå³ä½¿æ¶ˆæ¯é˜Ÿåˆ—å´©æºƒæˆ–è€…é‡å¯ï¼Œæ¶ˆæ¯ä¾ç„¶èƒ½å¤Ÿæ¢å¤ã€‚</li><li>ä¾‹å¦‚ï¼ŒRabbitMQæ”¯æŒ<strong>æŒä¹…åŒ–é˜Ÿåˆ—</strong>å’Œ<strong>æŒä¹…åŒ–æ¶ˆæ¯</strong>ï¼ŒKafkaåˆ™é€šè¿‡å°†æ¶ˆæ¯å†™å…¥ç£ç›˜æ—¥å¿—æ–‡ä»¶æ¥ä¿è¯æ¶ˆæ¯çš„æŒä¹…åŒ–ã€‚</li></ul></li><li>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼š<ul><li>æ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯åï¼Œé€šè¿‡ç¡®è®¤æœºåˆ¶ï¼ˆå¦‚ACKï¼‰å‘ŠçŸ¥æ¶ˆæ¯é˜Ÿåˆ—è¯¥æ¶ˆæ¯å·²è¢«æˆåŠŸå¤„ç†ã€‚åªæœ‰åœ¨æ”¶åˆ°ACKåï¼Œæ¶ˆæ¯æ‰ä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚å¦‚æœACKæœªæ”¶åˆ°ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šé‡æ–°æŠ•é€’è¯¥æ¶ˆæ¯ã€‚</li></ul></li><li>äº‹åŠ¡æœºåˆ¶ï¼š<ul><li>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—çš„äº‹åŠ¡æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­çš„å¯é æ€§ã€‚åœ¨æ¶ˆè´¹è€…å‡ºç°æ•…éšœæ—¶ï¼Œæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯ä¼šé‡æ–°æŠ•é€’æˆ–å›æ»šï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚</li></ul></li><li>æ¶ˆæ¯å‰¯æœ¬ï¼š<ul><li>æ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡ç»´æŠ¤æ¶ˆæ¯å‰¯æœ¬æ¥é¿å…å•ç‚¹æ•…éšœå¯¼è‡´çš„æ¶ˆæ¯ä¸¢å¤±ã€‚ä¾‹å¦‚ï¼ŒKafkaé€šè¿‡<strong>å‰¯æœ¬æœºåˆ¶</strong>ï¼ˆReplicationï¼‰ç¡®ä¿æ¯ä¸ªåˆ†åŒºæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œä»è€Œé¿å…å•ä¸€èŠ‚ç‚¹æ•…éšœæ—¶ä¸¢å¤±æ¶ˆæ¯ã€‚</li></ul></li></ul><h4 id="4-æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œå»¶è¿Ÿæ¶ˆæ¯â€æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿæœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#4-æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œå»¶è¿Ÿæ¶ˆæ¯â€æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿæœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="4. æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œå»¶è¿Ÿæ¶ˆæ¯â€æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿæœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ"></a>4. æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œå»¶è¿Ÿæ¶ˆæ¯â€æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿæœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ</h4><p><strong>å»¶è¿Ÿæ¶ˆæ¯</strong>æ˜¯æŒ‡æ¶ˆæ¯åœ¨å‘å¸ƒåˆ°é˜Ÿåˆ—åï¼Œç»è¿‡ä¸€å®šæ—¶é—´å»¶è¿Ÿæ‰ä¼šè¢«æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚å»¶è¿Ÿæ¶ˆæ¯å¹¿æ³›åº”ç”¨äºéœ€è¦åœ¨æŒ‡å®šæ—¶é—´åæ‰§è¡ŒæŸäº›æ“ä½œçš„åœºæ™¯ã€‚</p><p><strong>å®ç°æ–¹æ³•</strong>ï¼š</p><ul><li>TTLï¼ˆTime-to-Liveï¼‰ï¼š<ul><li>è®¸å¤šæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿæ”¯æŒTTLï¼ˆæ¶ˆæ¯ç”Ÿå­˜æ—¶é—´ï¼‰åŠŸèƒ½ï¼Œå³æŒ‡å®šæ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­çš„å­˜æ´»æ—¶é—´ï¼Œè¿‡æœŸåä¼šè¢«è‡ªåŠ¨ä¸¢å¼ƒã€‚é€šè¿‡è®¾ç½®TTLï¼Œå¯ä»¥å®ç°å»¶è¿Ÿæ¶ˆæ¯çš„æ•ˆæœã€‚RabbitMQã€Kafkaéƒ½æ”¯æŒæ¶ˆæ¯TTLã€‚</li></ul></li><li>å»¶è¿Ÿé˜Ÿåˆ—ï¼š<ul><li>RabbitMQæ”¯æŒä½¿ç”¨<strong>å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶</strong>ï¼Œå¯ä»¥æŒ‡å®šæ¶ˆæ¯åœ¨å‘é€åˆ°é˜Ÿåˆ—åå»¶è¿Ÿä¸€å®šçš„æ—¶é—´æ‰è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚</li></ul></li><li>å®šæ—¶ä»»åŠ¡ï¼š<ul><li>æ¶ˆè´¹è€…ç«¯å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰å»¶è¿Ÿæ¶ˆæ¯åˆ°æœŸï¼Œä»è€Œè§¦å‘ç›¸åº”çš„æ“ä½œã€‚Kafkaä¹Ÿå¯ä»¥é€šè¿‡å®šæ—¶å™¨å’Œä»»åŠ¡è°ƒåº¦æ¥å®ç°å»¶è¿Ÿæ¶ˆæ¯çš„æ¶ˆè´¹ã€‚</li></ul></li><li>Delayed Message Pluginï¼š<ul><li>ä¾‹å¦‚ï¼Œåœ¨RabbitMQä¸­å¯ä»¥ä½¿ç”¨<code>rabbitmq-delayed-message-exchange</code>æ’ä»¶ï¼Œè¯¥æ’ä»¶æä¾›äº†å»¶è¿Ÿæ¶ˆæ¯åŠŸèƒ½ã€‚æ¶ˆæ¯åœ¨å‘é€æ—¶æŒ‡å®šå»¶è¿Ÿæ—¶é—´ï¼Œåˆ°æœŸåæ‰ä¼šè¢«æ¶ˆè´¹ã€‚</li></ul></li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>å®šæ—¶ä»»åŠ¡</strong>ï¼šå¦‚å®šæ—¶å‘é€æé†’æ¶ˆæ¯ã€å®šæ—¶ä»»åŠ¡è°ƒåº¦ç­‰ã€‚</li><li><strong>å»¶è¿Ÿå¤„ç†</strong>ï¼šå¦‚å»¶è¿Ÿæ”¯ä»˜ç¡®è®¤ã€å»¶è¿Ÿè®¢å•å–æ¶ˆç­‰ã€‚</li><li><strong>æµé‡æ§åˆ¶</strong>ï¼šé€šè¿‡å»¶è¿Ÿæ¶ˆæ¯çš„æ–¹å¼æ§åˆ¶ç³»ç»Ÿçš„æµé‡ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½ã€‚</li></ul><h4 id="5-å¦‚ä½•åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™æœºåˆ¶ï¼Ÿæœ‰å“ªäº›å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Ÿ"><a href="#5-å¦‚ä½•åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™æœºåˆ¶ï¼Ÿæœ‰å“ªäº›å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="5. å¦‚ä½•åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™æœºåˆ¶ï¼Ÿæœ‰å“ªäº›å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Ÿ"></a>5. å¦‚ä½•åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™æœºåˆ¶ï¼Ÿæœ‰å“ªäº›å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Ÿ</h4><p>æ¶ˆæ¯é˜Ÿåˆ—çš„<strong>é«˜å¯ç”¨æ€§</strong>å’Œ<strong>å®¹é”™æ€§</strong>æ˜¯ä¿è¯ç³»ç»Ÿç¨³å®šæ€§å’Œå¯é æ€§çš„é‡è¦æªæ–½ã€‚ä¸ºäº†åº”å¯¹èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œåˆ†åŒºç­‰é—®é¢˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿé€šå¸¸é‡‡å–ä»¥ä¸‹æŠ€æœ¯æ‰‹æ®µï¼š</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—çš„é›†ç¾¤æ¨¡å¼ï¼š<ul><li>æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿé€šå¸¸é‡‡ç”¨é›†ç¾¤æ¶æ„æ¥æä¾›é«˜å¯ç”¨æ€§ã€‚é›†ç¾¤å¯ä»¥å°†æ¶ˆæ¯å­˜å‚¨å’Œå¤„ç†è´Ÿè½½åˆ†æ‘Šåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚ä¾‹å¦‚ï¼ŒKafkaçš„é›†ç¾¤æ¶æ„é€šè¿‡åˆ†åŒºå’Œå‰¯æœ¬æœºåˆ¶ä¿è¯äº†æ•°æ®çš„é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚</li></ul></li><li>æ¶ˆæ¯çš„å‰¯æœ¬æœºåˆ¶ï¼š<ul><li>Kafkaé€šè¿‡**åˆ†åŒºå‰¯æœ¬ï¼ˆReplicationï¼‰**ç¡®ä¿æ¯ä¸ªåˆ†åŒºæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå³ä½¿ä¸€ä¸ªèŠ‚ç‚¹æ•…éšœï¼Œå…¶ä»–å‰¯æœ¬ä»ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚</li><li>RabbitMQé€šè¿‡é…ç½®**é•œåƒé˜Ÿåˆ—ï¼ˆMirrored Queuesï¼‰**æ¥ç¡®ä¿æ¶ˆæ¯åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šå¤‡ä»½ï¼Œæé«˜ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›ã€‚</li></ul></li><li>é«˜å¯ç”¨çš„äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼š<ul><li>åœ¨RabbitMQä¸­ï¼Œé€šè¿‡é•œåƒäº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå¯ä»¥ç¡®ä¿å³ä½¿æŸäº›èŠ‚ç‚¹æ•…éšœï¼Œæ¶ˆæ¯ä»èƒ½è¢«è·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹å¤„ç†ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚</li></ul></li><li>è·¨æ•°æ®ä¸­å¿ƒçš„å¤åˆ¶ï¼š<ul><li>ä¸€äº›æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ˆå¦‚Kafkaï¼‰æ”¯æŒè·¨æ•°æ®ä¸­å¿ƒçš„æ¶ˆæ¯å¤åˆ¶ã€‚é€šè¿‡åœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒéƒ¨ç½²å‰¯æœ¬ï¼Œå¯ä»¥å®ç°æ•°æ®çš„è·¨åœ°åŸŸé«˜å¯ç”¨æ€§ã€‚</li></ul></li><li>è‡ªåŠ¨æ•…éšœåˆ‡æ¢ï¼š<ul><li>åœ¨æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿä¸­ï¼Œå½“æŸä¸ªèŠ‚ç‚¹æˆ–æŸä¸ªé˜Ÿåˆ—å‘ç”Ÿæ•…éšœæ—¶ï¼Œç³»ç»Ÿåº”è¯¥èƒ½è‡ªåŠ¨åˆ‡æ¢åˆ°å¯ç”¨èŠ‚ç‚¹æˆ–é˜Ÿåˆ—ï¼Œä¿è¯ç³»ç»Ÿçš„æŒç»­å¯ç”¨æ€§ã€‚</li></ul></li></ul><p><strong>æ€»ç»“</strong>ï¼š é«˜å¯ç”¨æ€§å’Œå®¹é”™æœºåˆ¶çš„æ ¸å¿ƒæ˜¯é€šè¿‡<strong>å†—ä½™</strong>ã€<strong>å‰¯æœ¬</strong>ã€<strong>è‡ªåŠ¨åˆ‡æ¢</strong>ç­‰æŠ€æœ¯æ‰‹æ®µï¼Œä¿è¯æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿå³ä½¿åœ¨éƒ¨åˆ†èŠ‚ç‚¹æˆ–ç½‘ç»œæ•…éšœçš„æƒ…å†µä¸‹ä»èƒ½ä¿æŒæ­£å¸¸è¿è¡Œã€‚</p><hr><h3 id="æ€§èƒ½ä¸ä¼˜åŒ–"><a href="#æ€§èƒ½ä¸ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¸ä¼˜åŒ–"></a>æ€§èƒ½ä¸ä¼˜åŒ–</h3><ol><li>æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ç§¯å‹å’Œæ¶ˆè´¹æ»åä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•ä¼˜åŒ–å¤„ç†ï¼Ÿ</li><li>æ¶ˆæ¯é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</li><li>åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ç¡®ä¿æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½ä¸å—åˆ°ç“¶é¢ˆå½±å“ï¼Ÿ</li><li>å¦‚ä½•è¿›è¡Œæ¶ˆæ¯é˜Ÿåˆ—çš„ç›‘æ§å’Œæ—¥å¿—ç®¡ç†ï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜ååé‡ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯å¯¹å®æ—¶æ¶ˆæ¯å¤„ç†çš„è¦æ±‚ï¼Ÿ</li></ol><h4 id="1-æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ç§¯å‹å’Œæ¶ˆè´¹æ»åä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•ä¼˜åŒ–å¤„ç†ï¼Ÿ"><a href="#1-æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ç§¯å‹å’Œæ¶ˆè´¹æ»åä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•ä¼˜åŒ–å¤„ç†ï¼Ÿ" class="headerlink" title="1. æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ç§¯å‹å’Œæ¶ˆè´¹æ»åä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•ä¼˜åŒ–å¤„ç†ï¼Ÿ"></a>1. æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ç§¯å‹å’Œæ¶ˆè´¹æ»åä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•ä¼˜åŒ–å¤„ç†ï¼Ÿ</h4><p><strong>æ¶ˆæ¯ç§¯å‹å’Œæ¶ˆè´¹æ»å</strong>æ˜¯æŒ‡æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦è·Ÿä¸ä¸Šç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå¯¼è‡´æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­å †ç§¯ï¼Œå»¶è¿Ÿå¢åŠ ã€‚</p><p><strong>é—®é¢˜</strong>ï¼š</p><ul><li><strong>ç³»ç»Ÿå»¶è¿Ÿå¢åŠ </strong>ï¼šæ¶ˆè´¹è€…æ— æ³•åŠæ—¶å¤„ç†æ¶ˆæ¯ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿå“åº”æ—¶é—´å˜é•¿ï¼Œç”šè‡³å½±å“åˆ°æœ€ç»ˆç”¨æˆ·ä½“éªŒã€‚</li><li><strong>å†…å­˜å’Œå­˜å‚¨å‹åŠ›</strong>ï¼šå¦‚æœæ¶ˆæ¯å †ç§¯è¿‡å¤šï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æˆ–ç£ç›˜å ç”¨è¿‡é«˜ï¼Œç”šè‡³å‡ºç°å­˜å‚¨ç©ºé—´ä¸è¶³çš„æƒ…å†µã€‚</li><li><strong>æ¶ˆæ¯ä¸¢å¤±é£é™©</strong>ï¼šæ¶ˆæ¯å †ç§¯è¿‡ä¹…ï¼Œå¯èƒ½å› ä¸ºé˜Ÿåˆ—çš„å®¹é‡é™åˆ¶è€Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼ˆå°¤å…¶æ˜¯åœ¨æ²¡æœ‰æŒä¹…åŒ–çš„æƒ…å†µä¸‹ï¼‰ã€‚</li><li><strong>èµ„æºæµªè´¹</strong>ï¼šé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ²¡æœ‰åŠæ—¶æ¶ˆè´¹ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿèµ„æºçš„æµªè´¹ï¼Œè¿›è€Œå½±å“å…¶ä»–ä»»åŠ¡çš„å¤„ç†ã€‚</li></ul><p><strong>ä¼˜åŒ–å¤„ç†</strong>ï¼š</p><ul><li><strong>å¢åŠ æ¶ˆè´¹è€…æ•°é‡</strong>ï¼šé€šè¿‡æ‰©å±•æ¶ˆè´¹è€…çš„æ•°é‡æ¥æå‡æ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿç‡ï¼Œå½¢æˆå¤šæ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†çš„æ¨¡å‹ã€‚</li><li><strong>æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡</strong>ï¼šå°†è´Ÿè½½å‡è¡¡ç­–ç•¥åº”ç”¨åˆ°å¤šä¸ªæ¶ˆè´¹è€…ä¹‹é—´ï¼Œé€šè¿‡åˆç†åˆ†é…ä»»åŠ¡ï¼Œé¿å…æŸä¸ªæ¶ˆè´¹è€…å¤„ç†è¿‡å¤šä»»åŠ¡ã€‚</li><li><strong>å¼‚æ­¥å¤„ç†å’Œæ‰¹é‡æ¶ˆè´¹</strong>ï¼šä¼˜åŒ–æ¶ˆè´¹è€…çš„å¤„ç†æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡å¼‚æ­¥æ¶ˆè´¹æˆ–æ‰¹é‡æ¶ˆè´¹æ¥æå‡ååé‡ï¼Œå‡å°‘å•ä¸ªæ¶ˆæ¯å¤„ç†çš„æ—¶é—´ã€‚</li><li><strong>æ¶ˆæ¯ä¼˜å…ˆçº§å’Œè°ƒåº¦</strong>ï¼šå¯¹æ¶ˆæ¯è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œä¼˜å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯ï¼Œé™ä½ä½ä¼˜å…ˆçº§æ¶ˆæ¯çš„å»¶è¿Ÿã€‚</li><li><strong>é˜Ÿåˆ—çš„åˆ†åŒºå’Œåˆ†å¸ƒå¼éƒ¨ç½²</strong>ï¼šå°†æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œåˆ†åŒºï¼Œåˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œé¿å…å•ä¸ªé˜Ÿåˆ—çš„è´Ÿè½½è¿‡é‡ã€‚Kafkaå’ŒRabbitMQéƒ½æ”¯æŒè¿™ç§åˆ†å¸ƒå¼æ¨¡å¼ã€‚</li></ul><h4 id="2-æ¶ˆæ¯é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#2-æ¶ˆæ¯é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="2. æ¶ˆæ¯é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>2. æ¶ˆæ¯é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h4><p><strong>è´Ÿè½½å‡è¡¡</strong>æ˜¯é€šè¿‡åˆç†åˆ†é…æ¶ˆæ¯ç»™æ¶ˆè´¹è€…æ¥ç¡®ä¿ç³»ç»Ÿå„ä¸ªæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›å¹³è¡¡ï¼Œä»¥é¿å…æŸäº›æ¶ˆè´¹è€…è¿‡è½½ã€‚</p><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><ul><li><strong>è½®è¯¢ï¼ˆRound Robinï¼‰</strong>ï¼šç”Ÿäº§è€…æŒ‰ç…§é¡ºåºå°†æ¶ˆæ¯ä¾æ¬¡å‘é€åˆ°å¤šä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ä»å„ä¸ªé˜Ÿåˆ—ä¸­æ‹‰å–æ¶ˆæ¯ã€‚é€‚ç”¨äºé˜Ÿåˆ—ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</strong>ï¼šåœ¨Kafkaä¸­ï¼Œé€šè¿‡æ¶ˆè´¹è€…ç»„çš„æ–¹å¼å®ç°è´Ÿè½½å‡è¡¡ã€‚ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€…å…±äº«æ¶ˆè´¹åŒä¸€ä¸ªä¸»é¢˜ï¼ˆTopicï¼‰ï¼ŒKafkaä¼šæ ¹æ®åˆ†åŒºå°†æ¶ˆæ¯å‡åŒ€åˆ†é…åˆ°æ¶ˆè´¹è€…ä¸­ï¼Œä»è€Œè¾¾åˆ°è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>æ¶ˆæ¯åˆ†åŒº</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ˆå¦‚Kafkaï¼‰å¯ä»¥å°†æ¶ˆæ¯åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„åˆ†åŒºï¼Œæ¶ˆè´¹è€…æ ¹æ®åˆ†åŒºæ¥å¤„ç†æ¶ˆæ¯ã€‚åˆ†åŒºå¯ä»¥å‡åŒ€åœ°åˆ†é…åˆ°æ¶ˆè´¹è€…ä¸Šï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>åŠ¨æ€æ¶ˆè´¹è€…è°ƒæ•´</strong>ï¼šåŠ¨æ€è°ƒæ•´æ¶ˆè´¹è€…çš„æ•°é‡ï¼ŒæŒ‰éœ€å¢åŠ æˆ–å‡å°‘æ¶ˆè´¹è€…æ¥åº”å¯¹è´Ÿè½½æ³¢åŠ¨ã€‚ä¾‹å¦‚ï¼Œåœ¨æ¶ˆæ¯é‡æ¿€å¢æ—¶ï¼Œå¯ä»¥åŠ¨æ€æ‰©å±•æ¶ˆè´¹è€…æ•°é‡æ¥ä¿æŒç³»ç»Ÿç¨³å®šæ€§ã€‚</li><li><strong>æ™ºèƒ½è·¯ç”±å’Œè°ƒåº¦</strong>ï¼šé€šè¿‡æ¶ˆæ¯è·¯ç”±ç­–ç•¥ï¼Œåˆç†åœ°åˆ†é…ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼ŒRabbitMQçš„Exchangeæœºåˆ¶å¯ä»¥æ ¹æ®æ¶ˆæ¯çš„ç‰¹å¾ï¼ˆå¦‚è·¯ç”±é”®ã€ç±»å‹ï¼‰æ™ºèƒ½åœ°å°†æ¶ˆæ¯åˆ†é…ç»™åˆé€‚çš„é˜Ÿåˆ—ã€‚</li></ul><h4 id="3-åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ç¡®ä¿æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½ä¸å—åˆ°ç“¶é¢ˆå½±å“ï¼Ÿ"><a href="#3-åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ç¡®ä¿æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½ä¸å—åˆ°ç“¶é¢ˆå½±å“ï¼Ÿ" class="headerlink" title="3. åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ç¡®ä¿æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½ä¸å—åˆ°ç“¶é¢ˆå½±å“ï¼Ÿ"></a>3. åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ç¡®ä¿æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½ä¸å—åˆ°ç“¶é¢ˆå½±å“ï¼Ÿ</h4><p>åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å¤šä¸ªå› ç´ çš„å½±å“ï¼Œå¦‚ç½‘ç»œå¸¦å®½ã€å­˜å‚¨IOã€æ¶ˆè´¹è€…å¤„ç†èƒ½åŠ›ç­‰ã€‚ä¸ºäº†ä¿è¯æ€§èƒ½ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹ä¼˜åŒ–æªæ–½ï¼š</p><p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p><ul><li><strong>æ°´å¹³æ‰©å±•</strong>ï¼šé€šè¿‡æ¨ªå‘æ‰©å±•æ¶ˆæ¯é˜Ÿåˆ—çš„èŠ‚ç‚¹ï¼ˆå¦‚å¢åŠ æ›´å¤šçš„Kafkaä»£ç†èŠ‚ç‚¹æˆ–RabbitMQèŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…è´Ÿè½½ï¼Œé¿å…å•ç‚¹ç“¶é¢ˆã€‚</li><li><strong>åˆ†åŒºç­–ç•¥</strong>ï¼šåœ¨Kafkaä¸­ï¼Œä½¿ç”¨åˆ†åŒºå°†æ¶ˆæ¯åˆ†æ•£åˆ°å¤šä¸ªä»£ç†èŠ‚ç‚¹ä¸Šï¼Œå¢åŠ å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚æ¯ä¸ªåˆ†åŒºå¯ä»¥å¹¶è¡Œæ¶ˆè´¹ï¼Œä»è€Œæå‡æ•´ä½“ååé‡ã€‚</li><li><strong>å¼‚æ­¥æ¶ˆè´¹</strong>ï¼šæ¶ˆè´¹è€…é‡‡ç”¨å¼‚æ­¥å¤„ç†çš„æ–¹å¼ï¼Œå°†æ¶ˆæ¯æ¶ˆè´¹ä¸ä¸šåŠ¡å¤„ç†è§£è€¦ï¼Œé¿å…é˜»å¡æ“ä½œã€‚é€šè¿‡äº‹ä»¶é©±åŠ¨æˆ–æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥æ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥æé«˜å¹¶å‘æ€§èƒ½ã€‚</li><li><strong>æ‰¹é‡æ¶ˆæ¯å¤„ç†</strong>ï¼šæ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¯ä»¥å‡å°‘æ¯æ¬¡æ¶ˆè´¹çš„å¼€é”€ã€‚æ¶ˆè´¹è€…å¯ä»¥åœ¨ä¸€æ¬¡æ‹‰å–ä¸­è·å–å¤šæ¡æ¶ˆæ¯ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼Œæå‡ååé‡ã€‚</li><li><strong>ç£ç›˜å’Œç½‘ç»œIOä¼˜åŒ–</strong>ï¼šä¼˜åŒ–ç£ç›˜å’Œç½‘ç»œå¸¦å®½ï¼Œç¡®ä¿æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°è¿›è¡Œæ•°æ®å­˜å–ã€‚ä¾‹å¦‚ï¼ŒKafkaæ”¯æŒå°†æ¶ˆæ¯å­˜å‚¨åœ¨é«˜æ•ˆçš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè€ŒRabbitMQåˆ™æ”¯æŒæŒä¹…åŒ–é˜Ÿåˆ—å’Œå¼‚æ­¥ç¡®è®¤æœºåˆ¶ï¼Œå‡å°‘IOç“¶é¢ˆã€‚</li><li><strong>æ¶ˆæ¯å‹ç¼©</strong>ï¼šé‡‡ç”¨æ¶ˆæ¯å‹ç¼©æŠ€æœ¯å‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶ˆæ¯é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå‹ç¼©å¯ä»¥æ˜¾è‘—æå‡ç½‘ç»œä¼ è¾“æ€§èƒ½ã€‚</li><li><strong>æ¶ˆæ¯æ‰¹é‡æäº¤</strong>ï¼šæ¶ˆè´¹è€…åœ¨æ‰¹é‡å¤„ç†æ¶ˆæ¯åï¼Œé€šè¿‡æ‰¹é‡ç¡®è®¤æœºåˆ¶æäº¤æ¶ˆæ¯ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ¯æ¡æ¶ˆæ¯çš„ç¡®è®¤å¼€é”€ã€‚</li></ul><h4 id="4-å¦‚ä½•è¿›è¡Œæ¶ˆæ¯é˜Ÿåˆ—çš„ç›‘æ§å’Œæ—¥å¿—ç®¡ç†ï¼Ÿ"><a href="#4-å¦‚ä½•è¿›è¡Œæ¶ˆæ¯é˜Ÿåˆ—çš„ç›‘æ§å’Œæ—¥å¿—ç®¡ç†ï¼Ÿ" class="headerlink" title="4. å¦‚ä½•è¿›è¡Œæ¶ˆæ¯é˜Ÿåˆ—çš„ç›‘æ§å’Œæ—¥å¿—ç®¡ç†ï¼Ÿ"></a>4. å¦‚ä½•è¿›è¡Œæ¶ˆæ¯é˜Ÿåˆ—çš„ç›‘æ§å’Œæ—¥å¿—ç®¡ç†ï¼Ÿ</h4><p><strong>æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§</strong>æ˜¯ç¡®ä¿ç³»ç»Ÿå¥åº·ã€åŠæ—¶å‘ç°å¹¶è§£å†³æ½œåœ¨é—®é¢˜çš„å…³é”®ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œç›‘æ§ï¼š</p><p><strong>ç›‘æ§æŒ‡æ ‡</strong>ï¼š</p><ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦</strong>ï¼šç›‘æ§é˜Ÿåˆ—ä¸­æœªæ¶ˆè´¹çš„æ¶ˆæ¯æ•°é‡ï¼Œé¿å…æ¶ˆæ¯ç§¯å‹å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚</li><li><strong>æ¶ˆæ¯æ¶ˆè´¹é€Ÿç‡</strong>ï¼šç›‘æ§æ¶ˆè´¹è€…çš„æ¶ˆæ¯å¤„ç†é€Ÿç‡ï¼Œç¡®ä¿æ¶ˆè´¹ç«¯èƒ½åŠæ—¶å¤„ç†æ¶ˆæ¯ï¼Œé¿å…æ»åã€‚</li><li><strong>æ¶ˆæ¯ç”Ÿäº§é€Ÿç‡</strong>ï¼šç›‘æ§ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿç‡ï¼Œé¿å…ç”Ÿäº§è€…è¿‡å¿«åœ°ç”Ÿäº§æ¶ˆæ¯ï¼Œå¯¼è‡´é˜Ÿåˆ—ç§¯å‹ã€‚</li><li><strong>æ¶ˆæ¯å¤„ç†å»¶è¿Ÿ</strong>ï¼šç›‘æ§æ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ï¼Œå°¤å…¶æ˜¯å¯¹äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œç¡®ä¿æ¶ˆæ¯åœ¨åˆç†æ—¶é—´å†…è¢«å¤„ç†ã€‚</li><li><strong>æ¶ˆè´¹è€…å¥åº·çŠ¶å†µ</strong>ï¼šç›‘æ§æ¶ˆè´¹è€…æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ˜¯å¦æœ‰æ¶ˆè´¹è€…å´©æºƒæˆ–åœæ­¢æ¶ˆè´¹çš„æƒ…å†µã€‚</li></ul><p><strong>æ—¥å¿—ç®¡ç†</strong>ï¼š</p><ul><li><strong>æ—¥å¿—è®°å½•</strong>ï¼šè®°å½•æ¶ˆæ¯é˜Ÿåˆ—çš„æ“ä½œæ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯æ¶ˆæ¯çš„å‘é€ã€æ¶ˆè´¹ã€ç¡®è®¤ç­‰æ“ä½œã€‚</li><li><strong>å¼‚å¸¸æ—¥å¿—</strong>ï¼šè®°å½•ç³»ç»Ÿå¼‚å¸¸æƒ…å†µï¼Œå¦‚æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ã€é˜Ÿåˆ—æ»¡ç­‰é—®é¢˜ã€‚é€šè¿‡å¼‚å¸¸æ—¥å¿—å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜ã€‚</li><li><strong>æ€§èƒ½æ—¥å¿—</strong>ï¼šè®°å½•æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½æ•°æ®ï¼Œå¦‚ååé‡ã€å»¶è¿Ÿç­‰ï¼Œä»¥ä¾¿è¿›è¡Œæ€§èƒ½åˆ†æå’Œä¼˜åŒ–ã€‚</li></ul><p><strong>å·¥å…·æ”¯æŒ</strong>ï¼š</p><ul><li><strong>Prometheus &amp; Grafana</strong>ï¼šå¯ä»¥é€šè¿‡Prometheusé‡‡é›†æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½æŒ‡æ ‡ï¼Œä½¿ç”¨Grafanaè¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚</li><li><strong>Elasticsearch &amp; Kibana</strong>ï¼šé€šè¿‡Elasticsearchè¿›è¡Œæ—¥å¿—å­˜å‚¨å’Œç´¢å¼•ï¼Œä½¿ç”¨Kibanaè¿›è¡Œæ—¥å¿—çš„æŸ¥è¯¢å’Œåˆ†æã€‚</li><li><strong>Kafka Manager</strong>ï¼šå¯¹äºKafkaæ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨Kafka Manageræ¥ç›‘æ§Kafkaé›†ç¾¤çš„çŠ¶æ€ã€åˆ†åŒºåˆ†é…ã€æ¶ˆè´¹æƒ…å†µç­‰ã€‚</li><li><strong>RabbitMQ Management Plugin</strong>ï¼šRabbitMQè‡ªå¸¦çš„ç®¡ç†æ’ä»¶æä¾›äº†é˜Ÿåˆ—ã€äº¤æ¢å™¨ã€æ¶ˆè´¹è€…ç­‰çš„è¯¦ç»†ç›‘æ§ä¿¡æ¯ã€‚</li></ul><h4 id="5-å¦‚ä½•è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜ååé‡ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯å¯¹å®æ—¶æ¶ˆæ¯å¤„ç†çš„è¦æ±‚ï¼Ÿ"><a href="#5-å¦‚ä½•è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜ååé‡ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯å¯¹å®æ—¶æ¶ˆæ¯å¤„ç†çš„è¦æ±‚ï¼Ÿ" class="headerlink" title="5. å¦‚ä½•è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜ååé‡ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯å¯¹å®æ—¶æ¶ˆæ¯å¤„ç†çš„è¦æ±‚ï¼Ÿ"></a>5. å¦‚ä½•è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜ååé‡ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯å¯¹å®æ—¶æ¶ˆæ¯å¤„ç†çš„è¦æ±‚ï¼Ÿ</h4><p>ä¸ºäº†è®¾è®¡ä¸€ä¸ªé«˜ååé‡çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯å¯¹äºå®æ—¶æ¶ˆæ¯å¤„ç†ï¼Œç³»ç»Ÿéœ€è¦å…·å¤‡ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ä¼˜åŒ–ï¼š</p><p><strong>è®¾è®¡æ€è·¯</strong>ï¼š</p><ul><li><strong>é«˜æ•ˆçš„æ¶ˆæ¯å­˜å‚¨å’Œæ£€ç´¢</strong>ï¼š<ul><li>ä½¿ç”¨æ—¥å¿—å­˜å‚¨ï¼ˆå¦‚Kafkaï¼‰æ¥ä¿è¯å¿«é€Ÿçš„æ¶ˆæ¯å†™å…¥å’Œæ£€ç´¢ã€‚Kafkaé€šè¿‡é¡ºåºå†™å…¥å’Œé›¶æ‹·è´æŠ€æœ¯ä¼˜åŒ–äº†å­˜å‚¨æ€§èƒ½ã€‚</li></ul></li><li><strong>åˆ†åŒºä¸å¹¶è¡Œæ¶ˆè´¹</strong>ï¼š<ul><li>å°†æ¶ˆæ¯åˆ†å¸ƒåˆ°å¤šä¸ªåˆ†åŒºä¸Šï¼Œå¹¶ä½¿ç”¨å¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œæ¶ˆè´¹ï¼Œä»¥æé«˜ç³»ç»Ÿçš„ååé‡ã€‚æ¶ˆè´¹è€…åœ¨å¤„ç†å¤šä¸ªåˆ†åŒºçš„æ¶ˆæ¯æ—¶ï¼Œèƒ½å¤Ÿå¹³è¡¡è´Ÿè½½å¹¶æå‡æ•´ä½“æ€§èƒ½ã€‚</li></ul></li><li><strong>å¼‚æ­¥å’Œæ‰¹é‡å¤„ç†</strong>ï¼š<ul><li>æ¶ˆè´¹è€…é‡‡ç”¨å¼‚æ­¥æ–¹å¼å¤„ç†æ¶ˆæ¯ï¼Œé¿å…é˜»å¡æ“ä½œã€‚åŒæ—¶ï¼Œæ‰¹é‡å¤„ç†èƒ½å¤Ÿå‡å°‘ç½‘ç»œå»¶è¿Ÿå’Œç£ç›˜IOï¼Œä»è€Œæé«˜æ¶ˆæ¯å¤„ç†çš„æ•ˆç‡ã€‚</li></ul></li><li><strong>æ¶ˆæ¯å‹ç¼©ä¸è§£å‹</strong>ï¼š<ul><li>ä½¿ç”¨æ¶ˆæ¯å‹ç¼©æŠ€æœ¯å‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—ï¼Œå°¤å…¶åœ¨æ¶ˆæ¯é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œå‹ç¼©å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚</li></ul></li><li><strong>æ¶ˆæ¯é¢„å¤„ç†ä¸è°ƒåº¦</strong>ï¼š<ul><li>åœ¨é«˜ååé‡çš„ç³»ç»Ÿä¸­ï¼Œéœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œä¼˜å…ˆçº§è°ƒåº¦ã€‚æ ¹æ®ä¸šåŠ¡éœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œæ’åºã€åˆ†ç»„ï¼Œå¹¶å†³å®šå…¶æ¶ˆè´¹ä¼˜å…ˆçº§ã€‚</li></ul></li><li><strong>ä½å»¶è¿Ÿå­˜å‚¨ä¸ç¼“å­˜</strong>ï¼š<ul><li>å¯¹äºå®æ—¶æ¶ˆæ¯å¤„ç†ï¼Œå¯ä»¥å°†çƒ­ç‚¹æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé¿å…é¢‘ç¹çš„ç£ç›˜è®¿é—®ï¼Œæé«˜æ¶ˆæ¯çš„å¤„ç†é€Ÿåº¦ã€‚</li></ul></li><li><strong>å®¹é”™å’Œé«˜å¯ç”¨æ€§è®¾è®¡</strong>ï¼š<ul><li>é€šè¿‡å¤åˆ¶å’Œåˆ†åŒºæœºåˆ¶ä¿éšœæ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨æ€§ã€‚Kafkaé€šè¿‡å‰¯æœ¬æœºåˆ¶ï¼Œä¿è¯å³ä½¿å‡ºç°èŠ‚ç‚¹æ•…éšœï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li></ul></li></ul><p><strong>å…³é”®æŠ€æœ¯</strong>ï¼š</p><ul><li><strong>é«˜æ•ˆçš„æ¶ˆæ¯è·¯ç”±</strong>ï¼šæ ¹æ®æ¶ˆæ¯å†…å®¹å’Œæ¶ˆè´¹è€…çš„éœ€æ±‚ï¼Œæ™ºèƒ½è·¯ç”±æ¶ˆæ¯ï¼Œé¿å…ä¸å¿…è¦çš„æ¶ˆæ¯ä¼ è¾“ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡å’ŒåŠ¨æ€æ‰©å±•</strong>ï¼šç¡®ä¿ç³»ç»Ÿåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ä¸ä¼šå‡ºç°ç“¶é¢ˆï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®è´Ÿè½½æƒ…å†µåŠ¨æ€æ‰©å±•æ¶ˆè´¹è€…çš„æ•°é‡ã€‚</li></ul><hr><h3 id="è¿›é˜¶é—®é¢˜"><a href="#è¿›é˜¶é—®é¢˜" class="headerlink" title="è¿›é˜¶é—®é¢˜"></a>è¿›é˜¶é—®é¢˜</h3><ol><li>æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¦‚ä½•é¿å…â€œæ¶ˆæ¯çš„ä¸¢å¤±â€ä¸â€œé‡å¤æ¶ˆè´¹â€é—®é¢˜ï¼Ÿ</li><li>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„â€œé¡ºåºæ¶ˆè´¹â€ä¸â€œå¹¶å‘æ¶ˆè´¹â€ï¼Ÿ</li><li>å¦‚ä½•é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°æµé‡å‰Šå³°å’Œå‰Šè°·ï¼Ÿ</li><li>æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆè´¹ç«¯ç¡®è®¤â€ä¸â€œè‡ªåŠ¨ç¡®è®¤â€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå®ƒä»¬å„è‡ªçš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>è¯·è§£é‡Šæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯äº‹åŠ¡â€å’Œâ€œæ¶ˆæ¯äº‹åŠ¡å›æ»šâ€ã€‚</li></ol><h4 id="1-æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¦‚ä½•é¿å…â€œæ¶ˆæ¯çš„ä¸¢å¤±â€ä¸â€œé‡å¤æ¶ˆè´¹â€é—®é¢˜ï¼Ÿ"><a href="#1-æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¦‚ä½•é¿å…â€œæ¶ˆæ¯çš„ä¸¢å¤±â€ä¸â€œé‡å¤æ¶ˆè´¹â€é—®é¢˜ï¼Ÿ" class="headerlink" title="1. æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¦‚ä½•é¿å…â€œæ¶ˆæ¯çš„ä¸¢å¤±â€ä¸â€œé‡å¤æ¶ˆè´¹â€é—®é¢˜ï¼Ÿ"></a>1. æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¦‚ä½•é¿å…â€œæ¶ˆæ¯çš„ä¸¢å¤±â€ä¸â€œé‡å¤æ¶ˆè´¹â€é—®é¢˜ï¼Ÿ</h4><p><strong>é¿å…æ¶ˆæ¯ä¸¢å¤±</strong>ï¼š æ¶ˆæ¯ä¸¢å¤±é€šå¸¸å‘ç”Ÿåœ¨æ¶ˆæ¯ä¼ è¾“è¿‡ç¨‹ä¸­å‡ºç°æ•…éšœï¼Œæˆ–è€…æ¶ˆè´¹è€…æ²¡æœ‰åŠæ—¶ç¡®è®¤æ¶ˆæ¯çš„æƒ…å†µä¸‹ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ï¼š</p><ul><li><strong>æŒä¹…åŒ–</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿä¸€èˆ¬æä¾›æŒä¹…åŒ–æœºåˆ¶ã€‚æ¶ˆæ¯ä¼šè¢«å­˜å‚¨åˆ°ç£ç›˜ä¸­ï¼Œå³ä½¿åœ¨ç³»ç»Ÿå´©æºƒåä¹Ÿèƒ½æ¢å¤ã€‚æ¯”å¦‚Kafkaå°±å°†æ¶ˆæ¯å­˜å‚¨åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼ŒRabbitMQä¹Ÿå¯ä»¥å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li><li><strong>ACKæœºåˆ¶ï¼ˆç¡®è®¤æœºåˆ¶ï¼‰</strong>ï¼šç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯åï¼Œæ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ¶ˆæ¯åå¿…é¡»è¿”å›ACKï¼ˆç¡®è®¤æ¶ˆæ¯ï¼‰ï¼Œè¡¨ç¤ºæ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹ã€‚å¦‚æœæ¶ˆè´¹è€…æ²¡æœ‰æ­£ç¡®æ¶ˆè´¹ï¼Œæ¶ˆæ¯ä¼šé‡æ–°è¢«å‘é€ã€‚</li><li><strong>æ¶ˆæ¯å‰¯æœ¬</strong>ï¼šå¾ˆå¤šæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ˆæ¯”å¦‚Kafkaï¼‰æ”¯æŒæ¶ˆæ¯å‰¯æœ¬æœºåˆ¶ã€‚å½“æ¶ˆæ¯è¢«ç”Ÿäº§è€…å‘å¸ƒåˆ°é˜Ÿåˆ—åï¼Œå®ƒä¼šæœ‰å¤šä¸ªå‰¯æœ¬å­˜å‚¨åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œé¿å…å•ç‚¹æ•…éšœå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ã€‚</li></ul><p><strong>é¿å…é‡å¤æ¶ˆè´¹</strong>ï¼š é‡å¤æ¶ˆè´¹çš„é—®é¢˜é€šå¸¸å‡ºç°åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”±äºç½‘ç»œæˆ–ç³»ç»Ÿæ•…éšœï¼Œæ¶ˆæ¯ä¼šè¢«æ¶ˆè´¹è€…é‡å¤æ¶ˆè´¹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥é¿å…ï¼š</p><ul><li><strong>æ¶ˆæ¯å»é‡</strong>ï¼šç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥ç»™æ¯æ¡æ¶ˆæ¯åŠ ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶å¯ä»¥æ ¹æ®æ¶ˆæ¯IDåˆ¤æ–­æ˜¯å¦å·²ç»å¤„ç†è¿‡è¯¥æ¶ˆæ¯ã€‚</li><li><strong>å¹‚ç­‰æ€§è®¾è®¡</strong>ï¼šç¡®ä¿æ¶ˆè´¹è€…å¯¹åŒä¸€æ¡æ¶ˆæ¯çš„å¤šæ¬¡å¤„ç†ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ”¯ä»˜ç³»ç»Ÿï¼Œæ¶ˆè´¹è€…æ”¶åˆ°æ”¯ä»˜è¯·æ±‚åï¼Œç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿç¡®ä¿å³ä½¿è¯·æ±‚é‡å¤ï¼Œä¹Ÿä¸ä¼šé‡å¤æ‰£æ¬¾ã€‚</li><li><strong>æ¶ˆæ¯äº‹åŠ¡æœºåˆ¶</strong>ï¼šé€šè¿‡äº‹åŠ¡æœºåˆ¶æ¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ã€‚æ¶ˆè´¹è€…å¯ä»¥åœ¨æ¶ˆè´¹å‰å’Œæ¶ˆè´¹åè¿›è¡Œäº‹åŠ¡å¤„ç†ï¼Œå¦‚æœå¤„ç†å¤±è´¥ï¼Œæ¶ˆæ¯ä¼šè¢«é‡æ–°å‘é€ï¼Œé¿å…é‡å¤æ¶ˆè´¹ã€‚</li></ul><h4 id="2-ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„â€œé¡ºåºæ¶ˆè´¹â€ä¸â€œå¹¶å‘æ¶ˆè´¹â€ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„â€œé¡ºåºæ¶ˆè´¹â€ä¸â€œå¹¶å‘æ¶ˆè´¹â€ï¼Ÿ" class="headerlink" title="2. ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„â€œé¡ºåºæ¶ˆè´¹â€ä¸â€œå¹¶å‘æ¶ˆè´¹â€ï¼Ÿ"></a>2. ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„â€œé¡ºåºæ¶ˆè´¹â€ä¸â€œå¹¶å‘æ¶ˆè´¹â€ï¼Ÿ</h4><p><strong>é¡ºåºæ¶ˆè´¹</strong>ï¼šæŒ‡çš„æ˜¯æ¶ˆè´¹è€…æŒ‰ç…§æ¶ˆæ¯ç”Ÿäº§çš„é¡ºåºè¿›è¡Œæ¶ˆè´¹ï¼Œæ¯æ¬¡åªèƒ½æ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„ä¸€æ¡æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„é¡ºåºæ˜¯ä¸¥æ ¼ä¿è¯çš„ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªç”¨æˆ·çš„è®¢å•å¤„ç†ï¼Œå¿…é¡»ä¿è¯è®¢å•çš„åˆ›å»ºã€æ”¯ä»˜ã€å‘è´§ç­‰æ­¥éª¤æŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œä¸èƒ½ä¹±åºã€‚</p><p><strong>å¹¶å‘æ¶ˆè´¹</strong>ï¼šæŒ‡çš„æ˜¯å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å¹¶è¡Œæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œæå‡æ¶ˆæ¯çš„å¤„ç†æ•ˆç‡ã€‚å¹¶å‘æ¶ˆè´¹é€šå¸¸é€‚ç”¨äºé‚£äº›ä¸éœ€è¦ä¸¥æ ¼ä¿è¯é¡ºåºçš„åœºæ™¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶å¤„ç†ä¸åŒçš„æ¶ˆæ¯ï¼Œæé«˜ååé‡ã€‚</p><p>ä¾‹å¦‚ï¼ŒKafkaçš„åˆ†åŒºæœºåˆ¶å°±èƒ½å®ç°å¹¶å‘æ¶ˆè´¹ã€‚æ¯ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œæ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®ã€‚</p><h4 id="3-å¦‚ä½•é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°æµé‡å‰Šå³°å’Œå‰Šè°·ï¼Ÿ"><a href="#3-å¦‚ä½•é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°æµé‡å‰Šå³°å’Œå‰Šè°·ï¼Ÿ" class="headerlink" title="3. å¦‚ä½•é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°æµé‡å‰Šå³°å’Œå‰Šè°·ï¼Ÿ"></a>3. å¦‚ä½•é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°æµé‡å‰Šå³°å’Œå‰Šè°·ï¼Ÿ</h4><p><strong>æµé‡å‰Šå³°å’Œå‰Šè°·</strong>çš„ç›®çš„æ˜¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†çªå‘çš„é«˜æµé‡å¹³æ»‘åŒ–ï¼Œé¿å…ç³»ç»Ÿåœ¨æµé‡é«˜å³°æ—¶å´©æºƒæˆ–å‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚</p><ul><li><strong>æµé‡å‰Šå³°</strong>ï¼šå½“ç³»ç»Ÿæµé‡çªå¢æ—¶ï¼Œå¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²è¯·æ±‚ï¼Œè®©è¯·æ±‚æŒ‰é¡ºåºè¢«æ¶ˆè´¹è€…é€æ­¥å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå½“ç”µå•†å¹³å°çš„ç§’æ€æ´»åŠ¨å¼€å§‹æ—¶ï¼Œå¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œç¼“è§£é«˜å¹¶å‘å‹åŠ›ã€‚æ¶ˆè´¹è€…å¯ä»¥æŒ‰ç…§ä¸€å®šé€Ÿç‡æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ï¼Œä»è€Œå¹³æ»‘æµé‡ã€‚</li><li><strong>æµé‡å‰Šè°·</strong>ï¼šå½“ç³»ç»Ÿæµé‡è¾ƒå°‘æ—¶ï¼Œå¯ä»¥å¢åŠ æ¶ˆè´¹è€…çš„å¹¶å‘æ•°é‡ï¼Œä»¥å¤„ç†ç§¯å‹çš„æ¶ˆæ¯ã€‚æ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒæŒ‰éœ€æ¶ˆè´¹ï¼Œå½“æµé‡ä½æ—¶ï¼Œæ¶ˆè´¹è€…å¯ä»¥å¢åŠ å¤„ç†é€Ÿåº¦ï¼ŒåŠæ—¶æ¶ˆåŒ–é˜Ÿåˆ—ä¸­çš„ç§¯å‹æ¶ˆæ¯ã€‚</li></ul><h4 id="4-æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆè´¹ç«¯ç¡®è®¤â€ä¸â€œè‡ªåŠ¨ç¡®è®¤â€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå®ƒä»¬å„è‡ªçš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#4-æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆè´¹ç«¯ç¡®è®¤â€ä¸â€œè‡ªåŠ¨ç¡®è®¤â€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå®ƒä»¬å„è‡ªçš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆè´¹ç«¯ç¡®è®¤â€ä¸â€œè‡ªåŠ¨ç¡®è®¤â€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå®ƒä»¬å„è‡ªçš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ"></a>4. æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆè´¹ç«¯ç¡®è®¤â€ä¸â€œè‡ªåŠ¨ç¡®è®¤â€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå®ƒä»¬å„è‡ªçš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p><strong>æ¶ˆè´¹ç«¯ç¡®è®¤ï¼ˆManual Ackï¼‰</strong>ï¼šæ¶ˆè´¹è€…æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯å·²ç»è¢«å¤„ç†ï¼Œåªæœ‰åœ¨æ¶ˆè´¹è€…æ˜¾å¼å‘é€ç¡®è®¤ä¿¡å·ï¼ˆACKï¼‰æ—¶ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«ä»é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºéœ€è¦ä¿è¯æ¶ˆæ¯è¢«æˆåŠŸå¤„ç†çš„åœºæ™¯ï¼Œä¾‹å¦‚é‡‘èäº¤æ˜“ç³»ç»Ÿã€è®¢å•å¤„ç†ç³»ç»Ÿç­‰ï¼Œç¡®ä¿åªæœ‰å¤„ç†æˆåŠŸçš„æ¶ˆæ¯æ‰ä¼šè¢«åˆ é™¤ã€‚</p><ul><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šä¾‹å¦‚æ”¯ä»˜ç³»ç»Ÿä¸­çš„æ¶ˆæ¯å¤„ç†ï¼Œç¡®ä¿åªæœ‰æ”¯ä»˜æˆåŠŸåæ‰åˆ é™¤æ¶ˆæ¯ã€‚</li></ul><p><strong>è‡ªåŠ¨ç¡®è®¤ï¼ˆAuto Ackï¼‰</strong>ï¼šæ¶ˆè´¹è€…åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œæ¶ˆæ¯è‡ªåŠ¨è¢«ç¡®è®¤ï¼Œæ— éœ€æ‰‹åŠ¨ç¡®è®¤ã€‚æ¶ˆè´¹è€…ä¸€æ—¦æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæ¶ˆæ¯å°±è¢«è®¤ä¸ºå·²æˆåŠŸå¤„ç†ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºå¯¹æ¶ˆæ¯ä¸¢å¤±ä¸æ•æ„Ÿã€å¯¹æ¶ˆè´¹é€Ÿåº¦è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚</p><ul><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šä¾‹å¦‚æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Œæ¶ˆæ¯ä¸€æ—¦å‘é€åˆ°æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…å°±ç›´æ¥æ¶ˆè´¹å¹¶ç¡®è®¤ï¼Œä¸éœ€è¦å†åšé¢å¤–çš„ä¸šåŠ¡ç¡®è®¤ã€‚</li></ul><h4 id="5-è¯·è§£é‡Šæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯äº‹åŠ¡â€å’Œâ€œæ¶ˆæ¯äº‹åŠ¡å›æ»šâ€ã€‚"><a href="#5-è¯·è§£é‡Šæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯äº‹åŠ¡â€å’Œâ€œæ¶ˆæ¯äº‹åŠ¡å›æ»šâ€ã€‚" class="headerlink" title="5. è¯·è§£é‡Šæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯äº‹åŠ¡â€å’Œâ€œæ¶ˆæ¯äº‹åŠ¡å›æ»šâ€ã€‚"></a>5. è¯·è§£é‡Šæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„â€œæ¶ˆæ¯äº‹åŠ¡â€å’Œâ€œæ¶ˆæ¯äº‹åŠ¡å›æ»šâ€ã€‚</h4><p><strong>æ¶ˆæ¯äº‹åŠ¡</strong>ï¼šæ¶ˆæ¯äº‹åŠ¡æ˜¯æŒ‡åœ¨æ¶ˆæ¯æ¶ˆè´¹å’Œç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œä¿è¯ä¸€ç³»åˆ—æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥çš„æœºåˆ¶ã€‚å¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç¡®ä¿æ¶ˆæ¯çš„å‘é€ã€æ•°æ®åº“æ“ä½œç­‰å¤šä¸ªæ­¥éª¤ä¿æŒä¸€è‡´æ€§ã€‚å¦‚æœæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œç³»ç»Ÿä¼šå›æ»šæ¶ˆæ¯æ“ä½œï¼Œé¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><ul><li>åœ¨Kafkaä¸­ï¼Œäº‹åŠ¡æœºåˆ¶å¯ä»¥ç¡®ä¿åœ¨æ¶ˆæ¯ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œå³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œå·²ç»å‘é€çš„æ¶ˆæ¯ä¹Ÿä¸ä¼šè¢«å†™å…¥åˆ°Kafkaçš„æ—¥å¿—ä¸­ï¼Œç¡®ä¿æ¶ˆæ¯çš„å¯é æ€§ã€‚</li><li>åœ¨ActiveMQä¸­ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨äº‹åŠ¡æ¥ä¿è¯æ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚äº‹åŠ¡å›æ»šå¯ä»¥é¿å…æœªå¤„ç†å®Œçš„æ¶ˆæ¯è¢«æ¶ˆè´¹æˆ–æ•°æ®ä¸¢å¤±ã€‚</li></ul><p><strong>æ¶ˆæ¯äº‹åŠ¡å›æ»š</strong>ï¼šå¦‚æœæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼ˆæ¯”å¦‚æ¶ˆæ¯æ¶ˆè´¹è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼‰ï¼Œå°±ä¼šè§¦å‘äº‹åŠ¡å›æ»šã€‚æ¶ˆæ¯å›æ»šæ„å‘³ç€å·²å‘é€çš„æ¶ˆæ¯ä¸ä¼šè¢«åˆ é™¤æˆ–å·²æ¶ˆè´¹çš„æ¶ˆæ¯ä¼šé‡æ–°è¿›å…¥é˜Ÿåˆ—ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯çš„å¯é æ€§å’Œä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨æ”¯ä»˜ç³»ç»Ÿä¸­ï¼Œå¦‚æœåœ¨å¤„ç†æ¶ˆæ¯æ—¶å‡ºç°é”™è¯¯ï¼Œäº‹åŠ¡å›æ»šæœºåˆ¶ä¼šç¡®ä¿æ”¯ä»˜ä¸ä¼šè¢«é‡å¤å¤„ç†æˆ–ä¸¢å¤±ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ¶ˆæ¯é˜Ÿåˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-18 STOMP</title>
      <link href="/2025/02/27/75-18%20STOMP/"/>
      <url>/2025/02/27/75-18%20STOMP/</url>
      
        <content type="html"><![CDATA[<h1 id="75-18-STOMP"><a href="#75-18-STOMP" class="headerlink" title="75-18 STOMP"></a>75-18 STOMP</h1><h2 id="STOMP-Simple-Text-Oriented-Messaging-Protocol-è¯¦è§£"><a href="#STOMP-Simple-Text-Oriented-Messaging-Protocol-è¯¦è§£" class="headerlink" title="STOMP (Simple Text Oriented Messaging Protocol) è¯¦è§£"></a><strong>STOMP (Simple Text Oriented Messaging Protocol) è¯¦è§£</strong></h2><p>STOMPï¼ˆSimple&#x2F;Streaming Text Oriented Messaging Protocolï¼‰æ˜¯ä¸€ç§ç®€å•çš„åŸºäºæ–‡æœ¬çš„æ¶ˆæ¯åè®®ï¼Œå¸¸ç”¨äº <strong>WebSocket å’Œæ¶ˆæ¯ä»£ç†ï¼ˆå¦‚ ActiveMQ, RabbitMQï¼‰ä¹‹é—´çš„é€šä¿¡</strong>ã€‚å®ƒæä¾›äº†ä¸€ç§ <strong>æ ‡å‡†åŒ–çš„æ¶ˆæ¯æ ¼å¼å’Œäº¤äº’æ–¹å¼</strong>ï¼Œä½¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ <strong>å‘å¸ƒ&#x2F;è®¢é˜…</strong>ï¼ˆPub&#x2F;Subï¼‰æ¨¡å¼è¿›è¡Œé€šä¿¡ã€‚</p><p>ä½ å¯ä»¥æŠŠ WebSocket æƒ³è±¡æˆä¸€æ¡<strong>ç”µè¯çº¿è·¯</strong>ï¼Œå®ƒå¯ä»¥è®©å‰åç«¯ä¿æŒè¿æ¥å¹¶å®æ—¶é€šä¿¡ã€‚ä½†å¦‚æœ<strong>æ‰€æœ‰æ¶ˆæ¯</strong>éƒ½ç›´æ¥åœ¨è¿™æ¡çº¿è·¯ä¸Šä¼ è¾“ï¼Œé‚£ç®¡ç†èµ·æ¥å°±ä¼šå˜å¾—<strong>éå¸¸æ··ä¹±</strong>ï¼š</p><ul><li>è°è¯¥æ”¶åˆ°å“ªäº›æ¶ˆæ¯ï¼Ÿ</li><li>æ¶ˆæ¯æ ¼å¼æ€ä¹ˆè§£æï¼Ÿ</li><li>æ€ä¹ˆç¡®ä¿æ¶ˆæ¯æ˜¯æ­£ç¡®çš„ï¼Ÿ</li><li>ç”¨æˆ·å¦‚ä½•èº«ä»½è®¤è¯ï¼Ÿ</li></ul><p>è€Œ <strong>STOMP å°±æ˜¯ä¸€ä¸ªâ€œç”µè¯åŠ©ç†â€</strong>ï¼Œå®ƒæä¾›äº†ä¸€å¥—<strong>è§„èŒƒåŒ–çš„é€šä¿¡æ–¹å¼</strong>ï¼Œè®©æ¶ˆæ¯å¯ä»¥è¢«<strong>é«˜æ•ˆåœ°ç®¡ç†</strong>ã€‚</p><hr><h2 id="STOMP-åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ"><a href="#STOMP-åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="STOMP åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ"></a><strong>STOMP åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</strong></h2><p>STOMP ä¸»è¦åšäº† 3 ä»¶äº‹æƒ…ï¼š</p><ol><li><strong>å®šä¹‰äº†ä¸€å¥—æ ‡å‡†æ¶ˆæ¯æ ¼å¼</strong><ul><li>WebSocket åªèƒ½å‘é€<strong>åŸå§‹æ•°æ®</strong>ï¼ŒSTOMP å®šä¹‰äº†<strong>ç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼</strong>ï¼ˆå°±åƒ HTTP å¤´éƒ¨ä¸€æ ·ï¼‰ã€‚</li><li>å®ƒçš„æ¶ˆæ¯æ ¼å¼åŒ…æ‹¬ï¼š<ul><li><strong>å‘½ä»¤ï¼ˆCommandï¼‰</strong>ï¼šæ¯”å¦‚ <code>SEND</code>ï¼ˆå‘é€æ¶ˆæ¯ï¼‰ã€<code>SUBSCRIBE</code>ï¼ˆè®¢é˜…é¢‘é“ï¼‰ã€‚</li><li><strong>å¤´éƒ¨ï¼ˆHeadersï¼‰</strong>ï¼šå­˜å‚¨å…ƒæ•°æ®ï¼Œæ¯”å¦‚ <code>destination:/topic/chat</code>ï¼ˆè¡¨ç¤ºå‘ç»™å“ªä¸ªé¢‘é“ï¼‰ã€‚</li><li><strong>æ¶ˆæ¯ä½“ï¼ˆBodyï¼‰</strong>ï¼šçœŸæ­£çš„æ¶ˆæ¯å†…å®¹ã€‚</li></ul></li><li>è¿™æ ·ï¼Œæ¯ä¸ªæ¶ˆæ¯çš„<strong>ç»“æ„éƒ½æ˜¯æ¸…æ™°çš„</strong>ï¼Œå‰åç«¯éƒ½èƒ½è½»æ¾è§£æï¼Œè€Œä¸éœ€è¦è‡ªå·±è®¾è®¡ä¸€å¥—åè®®ã€‚</li></ul></li><li><strong>æ”¯æŒâ€œå‘å¸ƒ&#x2F;è®¢é˜…â€æ¨¡å‹</strong><ul><li>ä¼ ç»Ÿ WebSocket åªèƒ½åœ¨<strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨</strong>ä¹‹é—´ä¸€å¯¹ä¸€ä¼ è¾“æ•°æ®ã€‚</li><li>ä½† STOMP <strong>å…è®¸å¤šä¸ªå®¢æˆ·ç«¯è®¢é˜…åŒä¸€ä¸ªâ€œé¢‘é“â€</strong>ï¼ˆå°±åƒèŠå¤©å®¤é‡Œçš„æ‰€æœ‰äººï¼‰ã€‚</li><li>æœåŠ¡å™¨åªéœ€è¦æŠŠæ¶ˆæ¯å‘é€åˆ°æŸä¸ªé¢‘é“ï¼Œæ‰€æœ‰è®¢é˜…è¿™ä¸ªé¢‘é“çš„ç”¨æˆ·<strong>éƒ½ä¼šè‡ªåŠ¨æ”¶åˆ°</strong>ã€‚</li><li>è¿™è§£å†³äº†<strong>å¤šäººé€šä¿¡çš„é—®é¢˜</strong>ï¼Œæ¯”å¦‚èŠå¤©å®¤ã€è‚¡ç¥¨æ¨é€ç­‰ã€‚</li></ul></li><li><strong>æä¾›èº«ä»½è®¤è¯å’Œæ‰©å±•æ€§</strong><ul><li>ç”±äº STOMP çš„æ¶ˆæ¯å¤´éƒ¨å¯ä»¥æºå¸¦<strong>é¢å¤–çš„ä¿¡æ¯</strong>ï¼Œæ¯”å¦‚ <code>Authorization</code> å¤´éƒ¨ï¼Œåç«¯å¯ä»¥ç”¨å®ƒè¿›è¡Œèº«ä»½éªŒè¯ã€‚</li><li>STOMP ä¹Ÿå¯ä»¥ä¸**æ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰**é…åˆï¼Œæ¯”å¦‚ RabbitMQã€Kafkaï¼Œè®©æ¶ˆæ¯æ›´ç¨³å®šå’Œå¯æ‰©å±•ã€‚</li></ul></li></ol><hr><h2 id="1-ä¸ºä»€ä¹ˆéœ€è¦-STOMPï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆéœ€è¦-STOMPï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆéœ€è¦ STOMPï¼Ÿ"></a><strong>1. ä¸ºä»€ä¹ˆéœ€è¦ STOMPï¼Ÿ</strong></h2><p><strong>WebSocket æœ¬èº«åªæ˜¯ä¸€ä¸ªå…¨åŒå·¥é€šä¿¡åè®®</strong>ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç›´æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚ä½†æ˜¯ï¼š</p><ul><li><strong>WebSocket æ²¡æœ‰å†…ç½®çš„æ¶ˆæ¯æ ¼å¼</strong> â†’ éœ€è¦è‡ªå·±è®¾è®¡æ•°æ®ç»“æ„ã€‚</li><li><strong>WebSocket æ²¡æœ‰æä¾›è®¢é˜…åŠŸèƒ½</strong> â†’ éœ€è¦æ‰‹åŠ¨ç®¡ç†è°è®¢é˜…äº†å“ªäº›æ¶ˆæ¯ã€‚</li><li><strong>WebSocket æ²¡æœ‰èº«ä»½è®¤è¯</strong> â†’ éœ€è¦è‡ªå·±å®ç° Token æˆ–å…¶ä»–å®‰å…¨æœºåˆ¶ã€‚</li></ul><p>STOMP è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œä½¿å¾— WebSocket æ›´åŠ æ˜“ç”¨å’ŒåŠŸèƒ½å¼ºå¤§ã€‚</p><hr><h2 id="2-STOMP-çš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#2-STOMP-çš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="2. STOMP çš„æ ¸å¿ƒæ¦‚å¿µ"></a><strong>2. STOMP çš„æ ¸å¿ƒæ¦‚å¿µ</strong></h2><p>STOMP æ˜¯ä¸€ç§åŸºäº <strong>å¸§ï¼ˆFrameï¼‰</strong> çš„åè®®ï¼Œæ¯ä¸ªè¯·æ±‚æˆ–å“åº”éƒ½æ˜¯ä¸€ä¸ª <strong>å¸§</strong>ï¼Œç±»ä¼¼äº HTTP æŠ¥æ–‡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">COMMAND</span><br><span class="line">header1:value1</span><br><span class="line">header2:value2</span><br><span class="line"></span><br><span class="line">message-body</span><br><span class="line">^@</span><br></pre></td></tr></table></figure><ul><li><code>COMMAND</code>ï¼šæ“ä½œç±»å‹ï¼Œå¦‚ <code>SEND</code>ã€<code>SUBSCRIBE</code>ã€<code>CONNECT</code> ç­‰ã€‚</li><li><code>header</code>ï¼šé”®å€¼å¯¹çš„æ¶ˆæ¯å¤´ï¼Œæä¾›é¢å¤–çš„æ¶ˆæ¯ä¿¡æ¯ã€‚</li><li><code>message-body</code>ï¼šå®é™…ä¼ è¾“çš„æ•°æ®å†…å®¹ï¼ˆå¯ä»¥æ˜¯ JSONã€XMLã€æ–‡æœ¬ç­‰ï¼‰ã€‚</li><li><code>^@</code>ï¼ˆ<code>\0</code>ï¼‰ï¼šSTOMP æ¶ˆæ¯çš„ç»“æŸæ ‡å¿—ã€‚</li></ul><h3 id="å¸¸è§çš„-STOMP-å‘½ä»¤"><a href="#å¸¸è§çš„-STOMP-å‘½ä»¤" class="headerlink" title="å¸¸è§çš„ STOMP å‘½ä»¤"></a><strong>å¸¸è§çš„ STOMP å‘½ä»¤</strong></h3><table><thead><tr><th><strong>å‘½ä»¤</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td><code>CONNECT</code></td><td>å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨</td></tr><tr><td><code>SUBSCRIBE</code></td><td>è®¢é˜…ä¸€ä¸ªç›®çš„åœ°ï¼ˆç±»ä¼¼ RabbitMQ ä¸»é¢˜ï¼‰</td></tr><tr><td><code>UNSUBSCRIBE</code></td><td>å–æ¶ˆè®¢é˜…</td></tr><tr><td><code>SEND</code></td><td>å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šç›®çš„åœ°</td></tr><tr><td><code>MESSAGE</code></td><td>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯</td></tr><tr><td><code>DISCONNECT</code></td><td>æ–­å¼€è¿æ¥</td></tr></tbody></table><hr><h2 id="3-STOMP-ä¸-WebSocket-çš„ç»“åˆ"><a href="#3-STOMP-ä¸-WebSocket-çš„ç»“åˆ" class="headerlink" title="3. STOMP ä¸ WebSocket çš„ç»“åˆ"></a><strong>3. STOMP ä¸ WebSocket çš„ç»“åˆ</strong></h2><p>åœ¨ Spring Boot ä¸­ï¼ŒWebSocket <strong>åŸç”Ÿæ”¯æŒ</strong> STOMPã€‚STOMP ä¸»è¦ç”¨äº <strong>WebSocket çš„æ¶ˆæ¯ç®¡ç†</strong>ï¼Œå¸¸è§çš„æ¶æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[WebSocket å®¢æˆ·ç«¯] ---&gt; [STOMP æ¶ˆæ¯ä»£ç†] ---&gt; [WebSocket æœåŠ¡å™¨]</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ¶ˆæ¯ä»£ç†ï¼ˆBrokerï¼‰</strong> å¯ä»¥æ˜¯å†…å­˜ä¸­çš„ç®€å•ä»£ç†ï¼ˆSpring æä¾›ï¼‰æˆ–è€… <strong>RabbitMQã€ActiveMQ</strong> ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p></blockquote><hr><h2 id="4-Spring-Boot-STOMP-å®æˆ˜"><a href="#4-Spring-Boot-STOMP-å®æˆ˜" class="headerlink" title="4. Spring Boot + STOMP å®æˆ˜"></a><strong>4. Spring Boot + STOMP å®æˆ˜</strong></h2><p>æˆ‘ä»¬é€šè¿‡ä»£ç ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½• <strong>ä½¿ç”¨ STOMP å®ç°ä¸€ä¸ªèŠå¤©ç³»ç»Ÿ</strong>ã€‚</p><h3 id="ï¼ˆ1ï¼‰Spring-Boot-WebSocket-STOMP-é…ç½®"><a href="#ï¼ˆ1ï¼‰Spring-Boot-WebSocket-STOMP-é…ç½®" class="headerlink" title="ï¼ˆ1ï¼‰Spring Boot WebSocket STOMP é…ç½®"></a><strong>ï¼ˆ1ï¼‰Spring Boot WebSocket STOMP é…ç½®</strong></h3><p>åœ¨ Spring Boot ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ <strong>åˆ›å»ºä¸€ä¸ª WebSocket æœåŠ¡å™¨</strong> å¹¶ <strong>å¼€å¯ STOMP æ”¯æŒ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title class_">WebSocketMessageBrokerConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// å®¢æˆ·ç«¯é€šè¿‡ ws://localhost:8080/ws è¿æ¥ WebSocket</span></span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/ws&quot;</span>).setAllowedOrigins(<span class="string">&quot;*&quot;</span>).withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// å¯ç”¨å†…å­˜æ¶ˆæ¯ä»£ç†ï¼Œå‰ç¼€ä¸º /topic ç”¨äºå¹¿æ’­æ¶ˆæ¯</span></span><br><span class="line">        registry.enableSimpleBroker(<span class="string">&quot;/topic&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åº”ç”¨å‰ç¼€ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯éœ€è¦åŠ  &quot;/app&quot;</span></span><br><span class="line">        registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ï¼ˆ2ï¼‰Spring-Boot-STOMP-æœåŠ¡å™¨ç«¯"><a href="#ï¼ˆ2ï¼‰Spring-Boot-STOMP-æœåŠ¡å™¨ç«¯" class="headerlink" title="ï¼ˆ2ï¼‰Spring Boot STOMP æœåŠ¡å™¨ç«¯"></a><strong>ï¼ˆ2ï¼‰Spring Boot STOMP æœåŠ¡å™¨ç«¯</strong></h3><p>åˆ›å»ºä¸€ä¸ª <strong>æ§åˆ¶å™¨</strong>ï¼Œç”¨äºå¤„ç† WebSocket æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.MessageMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.SendTo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬ &quot;/app/chat&quot; å‘é€æ¥çš„æ¶ˆæ¯ï¼Œå¹¶å¹¿æ’­ç»™ &quot;/topic/messages&quot;</span></span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;/topic/messages&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> + message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="5-STOMP-å®¢æˆ·ç«¯ï¼ˆå‰ç«¯ï¼‰"><a href="#5-STOMP-å®¢æˆ·ç«¯ï¼ˆå‰ç«¯ï¼‰" class="headerlink" title="5. STOMP å®¢æˆ·ç«¯ï¼ˆå‰ç«¯ï¼‰"></a><strong>5. STOMP å®¢æˆ·ç«¯ï¼ˆå‰ç«¯ï¼‰</strong></h2><p>å®¢æˆ·ç«¯ä½¿ç”¨ <strong>SockJS å’Œ STOMP.js</strong> è¿æ¥æœåŠ¡å™¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º SockJS è¿æ¥</span></span><br><span class="line"><span class="keyword">const</span> socket = <span class="keyword">new</span> <span class="title class_">SockJS</span>(<span class="string">&#x27;/ws&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> stompClient = <span class="title class_">Stomp</span>.<span class="title function_">over</span>(socket);</span><br><span class="line"></span><br><span class="line">stompClient.<span class="title function_">connect</span>(&#123;&#125;, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿æ¥æˆåŠŸ&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¢é˜…æœåŠ¡å™¨çš„æ¶ˆæ¯</span></span><br><span class="line">    stompClient.<span class="title function_">subscribe</span>(<span class="string">&#x27;/topic/messages&#x27;</span>, <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> + response.<span class="property">body</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    stompClient.<span class="title function_">send</span>(<span class="string">&quot;/app/chat&quot;</span>, &#123;&#125;, <span class="string">&quot;Hello, STOMP!&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h2 id="6-å¦‚ä½•å®ç°ç”¨æˆ·è®¤è¯ï¼Ÿ"><a href="#6-å¦‚ä½•å®ç°ç”¨æˆ·è®¤è¯ï¼Ÿ" class="headerlink" title="6. å¦‚ä½•å®ç°ç”¨æˆ·è®¤è¯ï¼Ÿ"></a><strong>6. å¦‚ä½•å®ç°ç”¨æˆ·è®¤è¯ï¼Ÿ</strong></h2><p>WebSocket <strong>æ²¡æœ‰å†…ç½®è®¤è¯æœºåˆ¶</strong>ï¼Œä½† STOMP <strong>æ”¯æŒæºå¸¦ Token</strong> è¿›è¡Œèº«ä»½è®¤è¯ã€‚</p><h3 id="ï¼ˆ1ï¼‰å‰ç«¯è¿æ¥æ—¶é™„å¸¦-Token"><a href="#ï¼ˆ1ï¼‰å‰ç«¯è¿æ¥æ—¶é™„å¸¦-Token" class="headerlink" title="ï¼ˆ1ï¼‰å‰ç«¯è¿æ¥æ—¶é™„å¸¦ Token"></a><strong>ï¼ˆ1ï¼‰å‰ç«¯è¿æ¥æ—¶é™„å¸¦ Token</strong></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stompClient.<span class="title function_">connect</span>(&#123; <span class="title class_">Authorization</span>: <span class="string">&quot;Bearer my-token&quot;</span> &#125;, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å·²è¿æ¥&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="ï¼ˆ2ï¼‰åç«¯æ‹¦æˆª-Token-å¹¶è®¤è¯"><a href="#ï¼ˆ2ï¼‰åç«¯æ‹¦æˆª-Token-å¹¶è®¤è¯" class="headerlink" title="ï¼ˆ2ï¼‰åç«¯æ‹¦æˆª Token å¹¶è®¤è¯"></a><strong>ï¼ˆ2ï¼‰åç«¯æ‹¦æˆª Token å¹¶è®¤è¯</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.stomp.StompHeaderAccessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.stomp.StompCommand;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.stomp.StompHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.stomp.StompSessionHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.messaging.AbstractSubProtocolEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.messaging.SessionConnectEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.messaging.SessionDisconnectEvent;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketAuthHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleWebSocketConnectListener</span><span class="params">(SessionConnectEvent event)</span> &#123;</span><br><span class="line">        <span class="type">StompHeaderAccessor</span> <span class="variable">accessor</span> <span class="operator">=</span> StompHeaderAccessor.wrap(event.getMessage());</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> accessor.getFirstNativeHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!validateToken(token)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;éæ³• Token&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">validateToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Bearer my-token&quot;</span>.equals(token);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="7-STOMP-çš„ä¼˜åŠ¿"><a href="#7-STOMP-çš„ä¼˜åŠ¿" class="headerlink" title="7. STOMP çš„ä¼˜åŠ¿"></a><strong>7. STOMP çš„ä¼˜åŠ¿</strong></h2><ul><li><strong>ç®€å•æ˜“ç”¨</strong>ï¼šåŸºäºæ–‡æœ¬æ ¼å¼ï¼Œç±»ä¼¼ HTTPï¼Œéå¸¸å®¹æ˜“è§£æã€‚</li><li><strong>æ”¯æŒæ¶ˆæ¯è®¢é˜…</strong>ï¼šå†…ç½® <strong>è®¢é˜…&#x2F;å¹¿æ’­</strong> æœºåˆ¶ï¼ˆWebSocket æœ¬èº«ä¸æ”¯æŒï¼‰ã€‚</li><li><strong>æ”¯æŒæ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šå¯ä»¥ <strong>ç»“åˆ RabbitMQã€ActiveMQ è¿›è¡Œåˆ†å¸ƒå¼é€šä¿¡</strong>ã€‚</li><li><strong>æ”¯æŒèº«ä»½è®¤è¯</strong>ï¼šå¯ä»¥ <strong>æºå¸¦ Token è¿›è¡Œè®¤è¯</strong>ã€‚</li></ul><hr><h2 id="8-æ€»ç»“"><a href="#8-æ€»ç»“" class="headerlink" title="8. æ€»ç»“"></a><strong>8. æ€»ç»“</strong></h2><table><thead><tr><th><strong>é—®é¢˜</strong></th><th><strong>WebSocket</strong></th><th><strong>STOMP</strong></th></tr></thead><tbody><tr><td><strong>æ•°æ®æ ¼å¼</strong></td><td>çº¯æ–‡æœ¬&#x2F;äºŒè¿›åˆ¶</td><td>ç»“æ„åŒ–çš„æ¶ˆæ¯å¸§</td></tr><tr><td><strong>è®¢é˜…æœºåˆ¶</strong></td><td>éœ€è¦æ‰‹åŠ¨ç®¡ç†</td><td>å†…ç½® <code>SUBSCRIBE</code> æœºåˆ¶</td></tr><tr><td><strong>èº«ä»½è®¤è¯</strong></td><td>éœ€è¦è‡ªå®šä¹‰</td><td>å¯ä»¥æºå¸¦ Token</td></tr><tr><td><strong>æ‰©å±•æ€§</strong></td><td>é€‚åˆç‚¹å¯¹ç‚¹é€šä¿¡</td><td>é€‚åˆå¹¿æ’­ã€ç¾¤èŠã€åˆ†å¸ƒå¼ç³»ç»Ÿ</td></tr></tbody></table><h3 id="å­¦ä¹ é‡ç‚¹"><a href="#å­¦ä¹ é‡ç‚¹" class="headerlink" title="å­¦ä¹ é‡ç‚¹"></a><strong>å­¦ä¹ é‡ç‚¹</strong></h3><ol><li><strong>STOMP æ˜¯ WebSocket çš„å¢å¼ºåè®®</strong>ï¼Œè§£å†³äº† WebSocket <strong>æ²¡æœ‰æ¶ˆæ¯æ ¼å¼ã€è®¢é˜…åŠŸèƒ½ã€è®¤è¯æœºåˆ¶</strong>çš„é—®é¢˜ã€‚</li><li><strong>Spring Boot åŸç”Ÿæ”¯æŒ STOMP</strong>ï¼Œå¯ä»¥ç»“åˆ WebSocket <strong>å®ç°å®æ—¶èŠå¤©ã€æ¶ˆæ¯æ¨é€</strong>ã€‚</li><li><strong>ç»“åˆ STOMP å¯ä»¥ä½¿ç”¨ RabbitMQã€ActiveMQ</strong>ï¼Œå®ç° <strong>æ›´å¼ºå¤§çš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿ</strong>ã€‚</li></ol><p>ğŸš€ <strong>ç†è§£äº† STOMPï¼Œä½ å°±å¯ä»¥å®ç°ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ WebSocket é€šä¿¡ç³»ç»Ÿï¼</strong></p>]]></content>
      
      
      <categories>
          
          <category> WebSocket </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WebSocket </tag>
            
            <tag> STOMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01 ä½¿ç”¨docker-composeå®‰è£…ElasticSearchå’Œkibana</title>
      <link href="/2025/02/26/01-%E4%BD%BF%E7%94%A8docker-compose%E5%AE%89%E8%A3%85ElasticSearch%E5%92%8Ckibana/"/>
      <url>/2025/02/26/01-%E4%BD%BF%E7%94%A8docker-compose%E5%AE%89%E8%A3%85ElasticSearch%E5%92%8Ckibana/</url>
      
        <content type="html"><![CDATA[<h1 id="01-ä½¿ç”¨docker-composeå®‰è£…ElasticSearchå’Œkibana"><a href="#01-ä½¿ç”¨docker-composeå®‰è£…ElasticSearchå’Œkibana" class="headerlink" title="01 ä½¿ç”¨docker-composeå®‰è£…ElasticSearchå’Œkibana"></a>01 ä½¿ç”¨docker-composeå®‰è£…ElasticSearchå’Œkibana</h1><h1 id="ESå®‰è£…"><a href="#ESå®‰è£…" class="headerlink" title="ESå®‰è£…"></a>ESå®‰è£…</h1><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªdocker-compose.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.7.0</span>  <span class="comment">#é•œåƒ</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">elk_elasticsearch</span>  <span class="comment">#å®šä¹‰å®¹å™¨åç§°</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span>  <span class="comment">#å¼€æœºå¯åŠ¨ï¼Œå¤±è´¥ä¹Ÿä¼šä¸€ç›´é‡å¯</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;cluster.name=elasticsearch&quot;</span> <span class="comment">#è®¾ç½®é›†ç¾¤åç§°ä¸ºelasticsearch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;discovery.type=single-node&quot;</span> <span class="comment">#ä»¥å•ä¸€èŠ‚ç‚¹æ¨¡å¼å¯åŠ¨</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx1024m&quot;</span> <span class="comment">#è®¾ç½®ä½¿ç”¨jvmå†…å­˜å¤§å°</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./plugins:/usr/share/elasticsearch/plugins</span> <span class="comment">#æ’ä»¶æ–‡ä»¶æŒ‚è½½</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/usr/share/elasticsearch/data</span> <span class="comment">#æ•°æ®æ–‡ä»¶æŒ‚è½½</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span> </span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥è¯¥å‘½ä»¤å¯åŠ¨ï¼š</p><p>-f ymlæ–‡ä»¶å­˜æ”¾çš„åœ°å€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker-compose</span> <span class="string">-f</span> <span class="string">D:config\elasticsearch\docker-compose.yml</span> <span class="string">up</span> <span class="string">-d</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261906061.png" alt="img"></p><p>ç½‘é¡µè¾“å…¥<a href="http://localhost:9200,å³å¯å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š">http://localhost:9200,å³å¯å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261906058.png" alt="img"></p><h1 id="å®‰è£…åˆ†è¯å™¨"><a href="#å®‰è£…åˆ†è¯å™¨" class="headerlink" title="å®‰è£…åˆ†è¯å™¨"></a>å®‰è£…åˆ†è¯å™¨</h1><p>è¿›å…¥å®¹å™¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">ps</span>  <span class="comment"># æŸ¥çœ‹å®¹å™¨ è·å–éœ€è¦å¯åŠ¨å®¹å™¨çš„id</span></span><br><span class="line"><span class="string">docker</span> <span class="string">exec</span> <span class="string">-it</span> <span class="string">æŸ¥è¯¢åˆ°çš„id</span> <span class="string">bash</span></span><br><span class="line"><span class="string">cd</span> <span class="string">bin</span> </span><br><span class="line"><span class="string">./elasticsearch-plugin</span> <span class="string">install</span> <span class="string">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip</span> </span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261906115.png" alt="img"></p><p>è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</p><h1 id="kibanaå®‰è£…"><a href="#kibanaå®‰è£…" class="headerlink" title="kibanaå®‰è£…"></a>kibanaå®‰è£…</h1><p>åŒç†æˆ‘ä»¬ä¹Ÿéœ€è¦ç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶åä¸ºï¼škibana.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.name:</span> <span class="string">kibana</span></span><br><span class="line"><span class="comment"># kibanaçš„ä¸»æœºåœ°å€ 0.0.0.0å¯è¡¨ç¤ºç›‘å¬æ‰€æœ‰IP</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># è¿™è¾¹è®¾ç½®è‡ªå·±esçš„åœ°å€ï¼Œ</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [ <span class="string">&quot;http://localhost:9200&quot;</span> ]</span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">&#x27;kibana&#x27;</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line"><span class="comment"># # æ˜¾ç¤ºç™»é™†é¡µé¢</span></span><br><span class="line"><span class="attr">xpack.monitoring.ui.container.elasticsearch.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># å¼€å¯ä¸­æ–‡æ¨¡å¼</span></span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶ä¹Ÿéœ€è¦ç¼–å†™ä¸€ä¸ªdocker-compose.ymlæ–‡ä»¶ï¼Œæ³¨æ„imageçš„ç‰ˆæœ¬éœ€è¦å’Œesç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">kibana:7.7.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">elk_kibana</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">D:/config/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5601</span><span class="string">:5601</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span>    <span class="comment">#ç¯å¢ƒå˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„åœ¨volumesä¸­D:/config/kibana/kibana.ymlè¡¨ç¤ºä½ çš„kibana.ymlæ–‡ä»¶å­˜æ”¾çš„åœ°å€</span></span><br><span class="line"><span class="comment"># ï¼šåé¢ä¿æŒä¸å˜</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261906454.png" alt="img"></p><p>ç„¶åè¾“å…¥<a href="http://localhost:5601/">http://localhost:5601</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261907666.png" alt="img"></p><p>è‡³æ­¤åœ¨æœ¬åœ°ä½¿ç”¨docker-composeé…ç½®elasticsearchå’Œkibanaå°±å®Œæˆäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02 Nexus</title>
      <link href="/2025/02/26/02%20Nexus/"/>
      <url>/2025/02/26/02%20Nexus/</url>
      
        <content type="html"><![CDATA[<h1 id="02-Nexus"><a href="#02-Nexus" class="headerlink" title="02 Nexus"></a>02 Nexus</h1><p>è¦ä»‹ç»Nexuså‰ï¼Œæˆ‘ä»¬å¾—å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯Mavenç§æœã€‚</p><h2 id="1-Mavenç§æœ"><a href="#1-Mavenç§æœ" class="headerlink" title="1 Mavenç§æœ"></a>1 Mavenç§æœ</h2><p>Mavenç§æœæ˜¯ä¸€ç§ç‰¹æ®Šçš„Mavenä»“åº“ï¼Œå®ƒæ˜¯æ¶è®¾åœ¨å±€åŸŸç½‘å†…çš„ä»“åº“æœåŠ¡ï¼Œç”¨æ¥ä»£ç†ä½äºå¤–éƒ¨çš„è¿œç¨‹ä»“åº“ï¼ˆä¸­å¤®ä»“åº“ã€å…¶ä»–è¿œç¨‹å…¬å…±ä»“åº“ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261917995.png" alt="img"></p><p>ä»ä¸Šé¢çš„å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“éœ€è¦æŸä¸ªç»„ä»¶æ—¶ã€‚ä¼šä¼˜å…ˆä»mavenç§æœä¸­è·å–ï¼Œå¦‚æœMavenç§æœä¸­ä¸å­˜åœ¨åˆ™ä¼šè¯·æ±‚å¤–éƒ¨çš„è¿œç¨‹ä»“åº“ã€‚</p><h2 id="2-Mavenç§æœ-Mavenç§æœæ­å»º"><a href="#2-Mavenç§æœ-Mavenç§æœæ­å»º" class="headerlink" title="2 Mavenç§æœ&amp;Mavenç§æœæ­å»º"></a>2 Mavenç§æœ&amp;Mavenç§æœæ­å»º</h2><p>æˆ‘ä»¬ä»mavenç”¨æˆ·è¯·æ±‚æŸä¸ªæ„ä»¶å…¥æ‰‹ï¼Œå¯ä»¥åˆæ­¥å¾—åˆ°å…¶å…·æœ‰çš„ä¼˜åŠ¿ã€‚</p><ol><li>å› ä¸ºæ˜¯ç§æœï¼Œç”¨æˆ·ä¼šä¼˜å…ˆè¯·æ±‚ç§æœç„¶åå»è¯·æ±‚è¿œç¨‹ä»“åº“ï¼Œæ‰€ä»¥è¿™ä¼š<strong>èŠ‚çœå¤–ç½‘å¸¦å®½</strong>ï¼›</li><li>å› ä¸ºä½äºå±€åŸŸç½‘ï¼Œç”¨æˆ·è¯·æ±‚<strong>ä¸‹è½½é€Ÿåº¦æ›´å¿«</strong>ï¼›</li><li>æœ‰äº›ç¬¬ä¸‰æ–¹æ„ä»¶æ— æ³•ä»è¿œç¨‹ä»“åº“ä¸­æ‹‰å»ï¼Œè¿™æ—¶å€™å¯ä»¥ä¸‹è½½åˆ°ç§æœç„¶åè¯·æ±‚ï¼Œ<strong>ä¾¿äºéƒ¨ç½²ç¬¬ä¸‰æ–¹æ„ä»¶</strong>ï¼›</li><li>å¯ä»¥æŠŠmavenç§æœçœ‹ä½œä¸€ä¸ªä¸­é—´å±‚ï¼Œè¿™æ ·å¾ˆæ˜æ˜¾çš„å¯ä»¥çœ‹å‡ºç§æœä¼š<strong>é™ä½ä¸­å¤®ä»“åº“å¾—è´Ÿè·å‹åŠ›</strong>ï¼›</li><li>å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ„ä»¶æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç§æœï¼Œå°±éœ€è¦å»è¿œç¨‹çš„ä¸­å¤®ä»“åº“è·å¾—ã€‚ä½†æ˜¯å¦‚æœä¸€æ—¦ç½‘ç»œä¸ç¨³å®šï¼Œæˆ–è€…ç›´æ¥ä¸­æ–­äº†ï¼Œè¿™ä¼šä¸¥é‡å½±å“é¡¹ç›®çš„ç¨³å®šæ€§å’Œæ§åˆ¶æ€§ã€‚æ‰€ä»¥mavenç§æœ<strong>æé«˜äº†é¡¹ç›®çš„ç¨³å®šæ€§å’Œå¢å¼ºäº†å¯¹é¡¹ç›®çš„æ§åˆ¶</strong>ã€‚</li></ol><p>èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å»ºç«‹mavenç§æœçš„è½¯ä»¶è¢«ç§°ä¸ºmavenä»“åº“ç®¡ç†å™¨ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><ol><li>Apache Archiva</li><li>JFrog Artifactory</li><li><strong>Sonatype Nexus</strong></li></ol><h2 id="3-Windowsç¯å¢ƒä¸‹Nexusä¸‹è½½"><a href="#3-Windowsç¯å¢ƒä¸‹Nexusä¸‹è½½" class="headerlink" title="3 Windowsç¯å¢ƒä¸‹Nexusä¸‹è½½"></a>3 Windowsç¯å¢ƒä¸‹Nexusä¸‹è½½</h2><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/weixin_43888891/article/details/130675829">Nexusä¸‹è½½ä¸å®‰è£…è¯¦è§£</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Nexus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Nexus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04 Prometheus+Grafanaç›‘æ§SpringBooté¡¹ç›®JVMä¿¡æ¯</title>
      <link href="/2025/02/26/04%20Prometheus+Grafana%E7%9B%91%E6%8E%A7SpringBoot%E9%A1%B9%E7%9B%AEJVM%E4%BF%A1%E6%81%AF/"/>
      <url>/2025/02/26/04%20Prometheus+Grafana%E7%9B%91%E6%8E%A7SpringBoot%E9%A1%B9%E7%9B%AEJVM%E4%BF%A1%E6%81%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="04-Prometheus-Grafanaç›‘æ§SpringBooté¡¹ç›®JVMä¿¡æ¯"><a href="#04-Prometheus-Grafanaç›‘æ§SpringBooté¡¹ç›®JVMä¿¡æ¯" class="headerlink" title="04 Prometheus+Grafanaç›‘æ§SpringBooté¡¹ç›®JVMä¿¡æ¯"></a>04 Prometheus+Grafanaç›‘æ§SpringBooté¡¹ç›®JVMä¿¡æ¯</h1><h1 id="1-ä½¿ç”¨docker-composeé…ç½®Prometheus-Grafana"><a href="#1-ä½¿ç”¨docker-composeé…ç½®Prometheus-Grafana" class="headerlink" title="1 ä½¿ç”¨docker-composeé…ç½®Prometheus&amp;Grafana"></a>1 ä½¿ç”¨docker-composeé…ç½®Prometheus&amp;Grafana</h1><ol><li>ç¡®ä¿æœ¬åœ°å®‰è£…äº†dockers&amp;docker-compose;</li><li>åœ¨æœ¬æœºåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè‡ªè¡Œå‘½åã€‚</li><li>åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºå¦‚ä¸‹ï¼š</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261919323.png" alt="img"></p><ol><li>prometheus.ymlæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my global config</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span>     <span class="string">15s</span> <span class="comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span> <span class="comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span></span><br><span class="line">  <span class="comment"># scrape_timeout is set to the global default (10s).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A scrape configuration containing exactly one endpoint to scrape:</span></span><br><span class="line"><span class="comment"># Here it&#x27;s Prometheus itself.</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;node-exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br></pre></td></tr></table></figure><ol><li>docker-compose.ymlæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">monitor:</span></span><br><span class="line">        <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">prometheus:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">prom/prometheus</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">prometheus</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">prometheus</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/data/prometheus/reload:/etc/prometheus/reload</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">monitor</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">grafana:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">grafana/grafana</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">grafana</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">grafana</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">monitor</span></span><br></pre></td></tr></table></figure><ol><li>æ‰“å¼€cmdï¼Œè·³è½¬åˆ°åˆšåˆšåˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸‹ï¼š</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261919453.png" alt="img"></p><p>å¦‚ä¸Šå³è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼›</p><ol><li>æœ¬åœ°æµè§ˆå™¨æ‰“å¼€<a href="http://localhost:9090/">http://localhost:9090</a></li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261919491.png" alt="img"></p><p>å¯åŠ¨æˆåŠŸ</p><ol><li>æœ¬åœ°æµè§ˆå™¨æ‰“å¼€<a href="http://localhost:3000/">http://localhost:3000</a></li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261919992.png" alt="img"></p><p>æ·»åŠ Data sourcesï¼›é…ç½®prometheus urlï¼›</p><p>å¦‚æœå‡ºç°ä¸‹é¢è¿™ä¸ªé—®é¢˜ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261919387.png" alt="img"></p><p>è¯·æŠŠprometheusçš„urlé…ç½®æˆä½ æœ¬åœ°IPï¼Œå¦‚ä½•æŸ¥çœ‹æœ¬åœ°ipè‡ªè¡Œç™¾åº¦ï¼›</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261919921.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261920576.png" alt="img"></p><ol><li>å¯¼å…¥æ¨¡æ¿</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261920872.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261920881.png" alt="img"></p><p>ç»“æœå¦‚ä¸Šï¼Œå¯¼å…¥æˆåŠŸï¼›</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>06 å±€åŸŸç½‘</title>
      <link href="/2025/02/26/06%20%E5%B1%80%E5%9F%9F%E7%BD%91/"/>
      <url>/2025/02/26/06%20%E5%B1%80%E5%9F%9F%E7%BD%91/</url>
      
        <content type="html"><![CDATA[<h1 id="06-å±€åŸŸç½‘"><a href="#06-å±€åŸŸç½‘" class="headerlink" title="06 å±€åŸŸç½‘"></a>06 å±€åŸŸç½‘</h1><p>èƒŒæ™¯æ˜¯ï¼šé‚£å¤©é™†å“¥é€šè¿‡è®¿é—®æˆ‘çš„ip:ç«¯å£å·å°±å¯ä»¥è®¿é—®æˆ‘æœ¬åœ°è¿è¡Œçš„ç½‘é¡µä¿¡æ¯ã€‚å› ä¸ºå­¦è¿‡è®¡ç®—æœºç½‘ç»œï¼Œæˆ‘æƒ³è¿™å¯èƒ½è·Ÿå±€åŸŸç½‘æœ‰å…³ï¼Œä½†æ˜¯æˆ‘å·²ç»è®°ä¸å¤ªæ¸…äº†ï¼Œæ‰€ä»¥æˆ‘æƒ³å€Ÿæ­¤å»äº†è§£ä¸€ä¸‹å…¬å¸å†…éƒ¨çš„å±€åŸŸç½‘æ˜¯å¦‚ä½•æ­å»ºçš„ï¼Œå…¶åŸç†æ˜¯ä»€ä¹ˆï¼Ÿç®€å•äº†è§£ä¸€ä¸‹ï¼Œä¸æ¶‰åŠå…·ä½“çš„æ­å»ºæ­¥éª¤ã€‚</p><h2 id="å¹¿åŸŸç½‘-å±€åŸŸç½‘"><a href="#å¹¿åŸŸç½‘-å±€åŸŸç½‘" class="headerlink" title="å¹¿åŸŸç½‘&amp;å±€åŸŸç½‘"></a>å¹¿åŸŸç½‘&amp;å±€åŸŸç½‘</h2><p>è¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç½‘ç»œï¼ŒéåŠå…¨ä¸–ç•Œçš„ç½‘ç»œã€‚ç›¸å¯¹äºå¹¿åŸŸç½‘ï¼Œå…¶èŒƒå›´æ›´å°ï¼Œå³åœ¨ä¸€å®šèŒƒå›´å†…çš„è®¡ç®—æœºäº’è”ç½‘ç»œï¼›</p><blockquote><p>å…¬ç½‘ã€å¤–ç½‘å³å¹¿åŸŸç½‘</p><p>ç§ç½‘ã€å†…ç½‘å³å±€åŸŸç½‘</p></blockquote><p>å¹¿åŸŸç½‘ä¸Šçš„æ¯ä¸€å°æœºå™¨éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªIPåœ°å€ï¼Œä½†æ˜¯å±€åŸŸç½‘ä¸Šçš„æ¯ä¸€å°ç”µè„‘éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå±€åŸŸç½‘IPåœ°å€ï¼Œä¸åŒçš„å±€åŸŸç½‘çš„IPåœ°å€å¯ä»¥é‡å¤ï¼Œä½†æ˜¯åŒä¸€ä¸ªå±€åŸŸç½‘çš„IPåœ°å€ä¸èƒ½é‡å¤ã€‚</p><p>å¹¿åŸŸç½‘ï¼ˆWANã€å…¬ç½‘ã€å¤–ç½‘ï¼‰ä¸å±€åŸŸç½‘ï¼ˆLANã€ç§ç½‘ã€å†…ç½‘ï¼‰ç”µè„‘äº¤æ¢æ•°æ®è¦é€šè¿‡è·¯ç”±å™¨æˆ–ç½‘å…³çš„NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰è¿›è¡Œã€‚ä¸€èˆ¬è¯´æ¥ï¼Œå±€åŸŸç½‘ï¼ˆLANã€ç§ç½‘ã€å†…ç½‘ï¼‰å†…ç”µè„‘å‘èµ·çš„å¯¹å¤–è¿æ¥è¯·æ±‚ï¼Œè·¯ç”±å™¨æˆ–ç½‘å…³éƒ½ä¸ä¼šåŠ ä»¥é˜»æ‹¦ï¼Œä½†æ¥è‡ªå¹¿åŸŸç½‘å¯¹å±€åŸŸç½‘å†…ç”µè„‘ç”µè„‘è¿æ¥çš„è¯·æ±‚ï¼Œè·¯ç”±å™¨æˆ–ç½‘å…³åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¼šè¿›è¡Œæ‹¦æˆªã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç½‘å…³æˆ–è·¯ç”±å™¨å¯¹å†…éƒ¨å‘å¤–å‘å‡ºçš„ä¿¡æ¯ä¸ä¼šè¿›è¡Œæ‹¦æˆªï¼Œä½†å¯¹æ¥è‡ªå¤–éƒ¨æƒ³è¿›å…¥å†…éƒ¨ç½‘ç»œçš„ä¿¡æ¯åˆ™ä¼šè¿›è¡Œè¯†åˆ«ã€ç­›é€‰ï¼Œè®¤ä¸ºæ˜¯å®‰å…¨çš„ã€æœ‰æ•ˆçš„ï¼Œæ‰ä¼šè½¬å‘ç»™å†…ç½‘ç”µè„‘ã€‚æ­£æ˜¯è¿™ç§æƒ…å†µçš„å­˜åœ¨ï¼Œæ‰å¯¼è‡´äº†å¾ˆå¤šå†…ç½‘ç”¨æˆ·æ²¡æœ‰â€œè¿œç¨‹â€ï¼Œé€Ÿåº¦ä¹Ÿä¸å°½å¦‚äººæ„ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><p>è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªåä¸ºABCç§‘æŠ€çš„å…¬å¸ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ªå…¬å¸å†…éƒ¨å±€åŸŸç½‘ã€‚</p><h3 id="1-è§„åˆ’ç½‘ç»œæ‹“æ‰‘ï¼š"><a href="#1-è§„åˆ’ç½‘ç»œæ‹“æ‰‘ï¼š" class="headerlink" title="1. è§„åˆ’ç½‘ç»œæ‹“æ‰‘ï¼š"></a>1. è§„åˆ’ç½‘ç»œæ‹“æ‰‘ï¼š</h3><p>ABCç§‘æŠ€æ˜¯ä¸€å®¶ä¸­å°å‹ç§‘æŠ€å…¬å¸ï¼Œæ‹¥æœ‰30åå‘˜å·¥ï¼Œåˆ†å¸ƒåœ¨ä¸¤ä¸ªåŠå…¬å®¤ã€‚ä»–ä»¬çš„ç½‘ç»œéœ€æ±‚åŒ…æ‹¬ï¼š</p><ul><li>åœ¨ä¸¤ä¸ªåŠå…¬å®¤ä¹‹é—´å…±äº«æ–‡ä»¶å’Œèµ„æºã€‚</li><li>æä¾›æ— çº¿ç½‘ç»œè¦†ç›–ï¼Œä»¥ä¾¿å‘˜å·¥èƒ½å¤Ÿåœ¨åŠå…¬å®¤å†…è‡ªç”±ç§»åŠ¨å¹¶è¿æ¥ç½‘ç»œã€‚</li><li>è¿æ¥åˆ°äº’è”ç½‘ï¼Œä»¥ä¾¿å‘˜å·¥èƒ½å¤Ÿè®¿é—®å¤–éƒ¨èµ„æºå’ŒæœåŠ¡ã€‚</li></ul><h3 id="2-è·å–ç½‘ç»œè®¾å¤‡ï¼š"><a href="#2-è·å–ç½‘ç»œè®¾å¤‡ï¼š" class="headerlink" title="2. è·å–ç½‘ç»œè®¾å¤‡ï¼š"></a>2. è·å–ç½‘ç»œè®¾å¤‡ï¼š</h3><p>ABCç§‘æŠ€å†³å®šè´­ä¹°ä»¥ä¸‹ç½‘ç»œè®¾å¤‡ï¼š</p><ul><li>2å°ä¼ä¸šçº§è·¯ç”±å™¨ï¼šç”¨äºè¿æ¥åˆ°äº’è”ç½‘å¹¶å®ç°ä¸¤ä¸ªåŠå…¬å®¤ä¹‹é—´çš„é€šä¿¡ã€‚</li><li>2ä¸ªäº¤æ¢æœºï¼šç”¨äºåœ¨æ¯ä¸ªåŠå…¬å®¤å†…è¿æ¥è®¡ç®—æœºã€æ‰“å°æœºç­‰æœ‰çº¿è®¾å¤‡ã€‚</li><li>4ä¸ªæ— çº¿æ¥å…¥ç‚¹ï¼ˆAPï¼‰ï¼šåœ¨æ¯ä¸ªåŠå…¬å®¤å†…æä¾›æ— çº¿ç½‘ç»œè¦†ç›–ã€‚</li></ul><h3 id="3-è¿æ¥ç½‘ç»œè®¾å¤‡ï¼š"><a href="#3-è¿æ¥ç½‘ç»œè®¾å¤‡ï¼š" class="headerlink" title="3. è¿æ¥ç½‘ç»œè®¾å¤‡ï¼š"></a>3. è¿æ¥ç½‘ç»œè®¾å¤‡ï¼š</h3><ul><li>åœ¨æ¯ä¸ªåŠå…¬å®¤å†…ï¼Œå®‰è£…ä¸€ä¸ªäº¤æ¢æœºï¼Œå¹¶å°†æ‰€æœ‰æœ‰çº¿è®¾å¤‡è¿æ¥åˆ°äº¤æ¢æœºä¸Šã€‚</li><li>åœ¨æ¯ä¸ªåŠå…¬å®¤å†…ï¼Œå®‰è£…ä¸¤ä¸ªæ— çº¿æ¥å…¥ç‚¹ï¼Œä»¥è¦†ç›–æ•´ä¸ªåŠå…¬å®¤ã€‚</li></ul><h3 id="4-é…ç½®ç½‘ç»œè®¾å¤‡ï¼š"><a href="#4-é…ç½®ç½‘ç»œè®¾å¤‡ï¼š" class="headerlink" title="4. é…ç½®ç½‘ç»œè®¾å¤‡ï¼š"></a>4. é…ç½®ç½‘ç»œè®¾å¤‡ï¼š</h3><ul><li>é…ç½®ä¸¤å°è·¯ç”±å™¨ï¼Œå°†å®ƒä»¬è¿æ¥åˆ°äº’è”ç½‘ï¼Œå¹¶è®¾ç½®é˜²ç«å¢™è§„åˆ™ä»¥ä¿æŠ¤å…¬å¸ç½‘ç»œå®‰å…¨ã€‚</li><li>åœ¨äº¤æ¢æœºä¸Šé…ç½® VLANï¼Œå°†ä¸åŒéƒ¨é—¨çš„è®¾å¤‡éš”ç¦»å¼€æ¥ï¼Œæé«˜ç½‘ç»œå®‰å…¨æ€§å’Œæ€§èƒ½ã€‚</li><li>é…ç½®æ— çº¿æ¥å…¥ç‚¹ï¼Œè®¾ç½®æ— çº¿ç½‘ç»œåç§°ï¼ˆSSIDï¼‰ã€å®‰å…¨å¯†é’¥ç­‰ï¼Œå¹¶é…ç½®è®¿å®¢ç½‘ç»œä»¥ä¾›è®¿å®¢ä½¿ç”¨ã€‚</li></ul><h3 id="5-åˆ†é…-IP-åœ°å€ï¼š"><a href="#5-åˆ†é…-IP-åœ°å€ï¼š" class="headerlink" title="5. åˆ†é… IP åœ°å€ï¼š"></a>5. åˆ†é… IP åœ°å€ï¼š</h3><ul><li>è®¾è®¡å¹¶åˆ†é…å±€åŸŸç½‘ä¸­çš„ IP åœ°å€èŒƒå›´ï¼Œä½¿ç”¨ DHCP æ¥è‡ªåŠ¨åˆ†é… IP åœ°å€ã€‚</li><li>ç¡®ä¿æ¯ä¸ªè®¾å¤‡éƒ½èƒ½å¤Ÿæ­£ç¡®è·å– IP åœ°å€ï¼Œå¹¶èƒ½å¤Ÿä¸å…¶ä»–è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</li></ul><h3 id="6-é…ç½®ç½‘ç»œæœåŠ¡ï¼š"><a href="#6-é…ç½®ç½‘ç»œæœåŠ¡ï¼š" class="headerlink" title="6. é…ç½®ç½‘ç»œæœåŠ¡ï¼š"></a>6. é…ç½®ç½‘ç»œæœåŠ¡ï¼š</h3><ul><li>éƒ¨ç½²æ–‡ä»¶å…±äº«æœåŠ¡å™¨ï¼Œä½¿å‘˜å·¥å¯ä»¥åœ¨åŠå…¬å®¤å†…å…±äº«æ–‡ä»¶å’Œèµ„æºã€‚</li><li>éƒ¨ç½²é‚®ä»¶æœåŠ¡å™¨ï¼Œä½¿å‘˜å·¥å¯ä»¥æ”¶å‘ç”µå­é‚®ä»¶ã€‚</li><li>éƒ¨ç½²WebæœåŠ¡å™¨ï¼Œç”¨äºå…¬å¸ç½‘ç«™å’Œå†…éƒ¨åº”ç”¨ç¨‹åºã€‚</li></ul><h3 id="7-æµ‹è¯•å’Œç»´æŠ¤ï¼š"><a href="#7-æµ‹è¯•å’Œç»´æŠ¤ï¼š" class="headerlink" title="7. æµ‹è¯•å’Œç»´æŠ¤ï¼š"></a>7. æµ‹è¯•å’Œç»´æŠ¤ï¼š</h3><ul><li>å¯¹æ–°å»ºçš„å±€åŸŸç½‘è¿›è¡Œæµ‹è¯•ï¼Œç¡®ä¿å„é¡¹åŠŸèƒ½æ­£å¸¸è¿è¡Œï¼Œå¹¶ä¸”ç½‘ç»œå®‰å…¨æ€§å¾—åˆ°æœ‰æ•ˆä¿æŠ¤ã€‚</li><li>å®šæœŸæ£€æŸ¥å’Œç»´æŠ¤å±€åŸŸç½‘è®¾å¤‡ï¼Œç¡®ä¿å…¶ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</li><li>éšç€å…¬å¸è§„æ¨¡å’Œéœ€æ±‚çš„å˜åŒ–ï¼ŒåŠæ—¶æ›´æ–°å’Œå‡çº§ç½‘ç»œè®¾å¤‡å’ŒæœåŠ¡ã€‚</li></ul><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼ŒABCç§‘æŠ€æˆåŠŸæ­å»ºäº†ä¸€ä¸ªå…¬å¸å†…éƒ¨å±€åŸŸç½‘ï¼Œæ»¡è¶³äº†å‘˜å·¥çš„æ—¥å¸¸å·¥ä½œéœ€æ±‚ï¼Œå¹¶ä¿éšœäº†ç½‘ç»œå®‰å…¨å’Œæ€§èƒ½ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>07 Docker</title>
      <link href="/2025/02/26/07%20Docker/"/>
      <url>/2025/02/26/07%20Docker/</url>
      
        <content type="html"><![CDATA[<h1 id="07-Docker"><a href="#07-Docker" class="headerlink" title="07 Docker"></a>07 Docker</h1><h2 id="ä»€ä¹ˆæ˜¯Docker"><a href="#ä»€ä¹ˆæ˜¯Docker" class="headerlink" title="ä»€ä¹ˆæ˜¯Docker"></a>ä»€ä¹ˆæ˜¯Docker</h2><p>å½“æˆ‘ä»¬è°ˆè®º Docker æ—¶ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå·¨å¤§çš„ã€ç°ä»£åŒ–çš„æµ·è¿é›†è£…ç®±ã€‚è¿™äº›é›†è£…ç®±å¯ä»¥è£…è½½å„ç§å„æ ·çš„è´§ç‰©ï¼Œä»å®¶å…·åˆ°ç”µå­è®¾å¤‡å†åˆ°é£Ÿå“ï¼Œéƒ½å¯ä»¥æ”¾è¿›å»ã€‚è€Œ Docker åˆ™æ˜¯ä¸€ç§ç±»ä¼¼äºè¿™æ ·çš„é›†è£…ç®±ï¼Œä½†æ˜¯å®ƒè£…è½½çš„ä¸æ˜¯å®ç‰©è´§ç‰©ï¼Œè€Œæ˜¯è½¯ä»¶åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰å¿…è¦çš„ç»„ä»¶ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›ä¸€æ­¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªç±»æ¯”ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ–°çš„è½¯ä»¶åº”ç”¨ç¨‹åºï¼Œå®ƒéœ€è¦ä¾èµ–äºç‰¹å®šçš„æ“ä½œç³»ç»Ÿã€ç¨‹åºåº“å’Œå…¶ä»–è½¯ä»¶ç»„ä»¶ã€‚åœ¨ä»¥å‰ï¼Œä¸ºäº†ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºåœ¨ä¸åŒçš„è®¡ç®—æœºç¯å¢ƒä¸­èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨å®‰è£…å’Œé…ç½®æ‰€æœ‰è¿™äº›ç»„ä»¶ï¼Œè¿™å°±åƒæ˜¯æŠŠå®¶å…·é€ä¸ªæ”¾è¿›è´§èˆ±é‡Œï¼Œéœ€è¦å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰äº† Dockerï¼Œæƒ…å†µå°±å®Œå…¨ä¸åŒäº†ã€‚ä½ å¯ä»¥æŠŠä½ çš„åº”ç”¨ç¨‹åºå’Œæ‰€æœ‰å®ƒéœ€è¦çš„ç»„ä»¶éƒ½æ”¾è¿›ä¸€ä¸ª Docker é›†è£…ç®±ä¸­ã€‚è¿™ä¸ªé›†è£…ç®±åŒ…æ‹¬äº†ä½ çš„åº”ç”¨ç¨‹åºã€æ“ä½œç³»ç»Ÿã€ç¨‹åºåº“ã€é…ç½®æ–‡ä»¶ç­‰ç­‰ï¼Œå°±åƒæ˜¯æŠŠæ‰€æœ‰çš„è´§ç‰©éƒ½è£…è¿›äº†ä¸€ä¸ªæ ‡å‡†åŒ–çš„é›†è£…ç®±é‡Œé¢ä¸€æ ·ã€‚</p><p>æ›´æ£’çš„æ˜¯ï¼ŒDocker é›†è£…ç®±æ˜¯æ ‡å‡†åŒ–çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„è®¡ç®—æœºä¸Šè¿è¡Œï¼Œå°±åƒæµ·è¿é›†è£…ç®±å¯ä»¥åœ¨ä»»ä½•æ”¯æŒæµ·ä¸Šè¿è¾“çš„æ¸¯å£ä¸­è¢«å¸è½½å’Œè¿è¾“ä¸€æ ·ã€‚è¿™è®©ä½ çš„åº”ç”¨ç¨‹åºåœ¨ä¸åŒçš„ç¯å¢ƒä¸­æ›´åŠ å¯ç§»æ¤å’Œå¯éƒ¨ç½²ã€‚</p><p>æ­¤å¤–ï¼ŒDocker è¿˜æä¾›äº†ä¸€ç§ç§°ä¸º Docker å®¹å™¨çš„æŠ€æœ¯ï¼Œè¿™äº›å®¹å™¨å®é™…ä¸Šå°±æ˜¯è¿è¡Œç€ Docker é›†è£…ç®±ä¸­åº”ç”¨ç¨‹åºçš„å®ä¾‹ã€‚è¿™å°±å¥½æ¯”æ˜¯åœ¨é›†è£…ç®±ä¸­æ”¾ç½®äº†è´§ç‰©åï¼Œéœ€è¦æœ‰äººæ¥å¤„ç†è´§ç‰©çš„åˆ†æ‹£ã€è£…å¸ç­‰å·¥ä½œä¸€æ ·ã€‚</p><p>Dockeræ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯æŠ‘åˆ¶çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„Linuxæœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚å®¹å™¨å®Œå…¨ä½¿ç”¨æ²™ç›’æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šå­˜åœ¨ä»»ä½•æ¥å£ã€‚å‡ ä¹æ²¡æœ‰æ€§èƒ½å¼€é”€ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨æœºå™¨å’Œæ•°æ®ä¸­å¿ƒè¿è¡Œã€‚æœ€é‡è¦çš„æ˜¯ï¼Œä»–ä»¬ä¸ä¾èµ–äºä»»ä½•è¯­è¨€ã€æ¡†æ¶æˆ–è€…åŒ…è£…ç³»ç»Ÿã€‚</p><h2 id="Dockerå‘½ä»¤"><a href="#Dockerå‘½ä»¤" class="headerlink" title="Dockerå‘½ä»¤"></a>Dockerå‘½ä»¤</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">version</span> <span class="comment"># æŸ¥çœ‹dockerç‰ˆæœ¬å·</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">info</span>  <span class="comment">#æŸ¥çœ‹dockeråŸºæœ¬ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">search</span> <span class="string">centos</span> <span class="comment">#ä»docker hubä¸­æœç´¢dockeråä¸ºcentosçš„é•œåƒ</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">pull</span> <span class="string">centos</span> <span class="comment"># é»˜è®¤æ˜¯æ‹‰å»docker hubä¸Šæœç´¢åˆ°çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆç¬¬ä¸€ä¸ªï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">images</span>  <span class="comment">#æŸ¥çœ‹å·²ä¸‹è½½é•œåƒã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">--help</span>     <span class="comment">#dockerå¸®åŠ©å‘½ä»¤æ‰‹å†Œ</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">run</span> [<span class="string">å¯é€‰å‚æ•°</span>] <span class="string">image</span> <span class="string">å‘½ä»¤</span> <span class="comment">#å¯åŠ¨å®¹å™¨ï¼ˆæ— é•œåƒä¼šå…ˆä¸‹è½½é•œåƒï¼‰</span></span><br><span class="line"><span class="comment">#å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="string">--name</span> <span class="string">=</span> <span class="string">&quot;Name&quot;</span>   <span class="string">å®¹å™¨åå­—</span></span><br><span class="line"><span class="string">-c</span>   <span class="string">åé¢è·Ÿå¾…å®Œæˆçš„å‘½ä»¤</span></span><br><span class="line"><span class="string">-d</span>   <span class="string">ä»¥åå°æ–¹å¼è¿è¡Œå¹¶ä¸”è¿”å›IDï¼Œå¯åŠ¨å®ˆæŠ¤è¿›ç¨‹å¼å®¹å™¨</span></span><br><span class="line"><span class="string">-i</span>   <span class="string">ä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸tåŒæ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="string">-t</span>   <span class="string">ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ã€‚ä¹Ÿå³å¯åŠ¨äº¤äº’å¼å®¹å™¨</span></span><br><span class="line"><span class="string">-p</span>   <span class="string">æŒ‡å®šå®¹å™¨ç«¯å£</span>    <span class="string">-p</span> <span class="string">å®¹å™¨ç«¯å£:ç‰©ç†æœºç«¯å£</span>  <span class="string">æ˜ å°„ç«¯å£</span></span><br><span class="line"><span class="string">-P</span>   <span class="string">éšæœºæŒ‡å®šç«¯å£</span></span><br><span class="line"><span class="string">-v</span>   <span class="string">ç»™å®¹å™¨æŒ‚è½½å­˜å‚¨å·</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">build</span>  <span class="comment">#åˆ›å»ºé•œåƒ        -fï¼šæŒ‡å®šdockerfileæ–‡ä»¶è·¯å¾„   -tï¼šé•œåƒåå­—ä»¥åŠæ ‡ç­¾</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">logs</span> <span class="string">å®¹å™¨å®ä¾‹çš„ID</span>          <span class="comment">#æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">rename</span> <span class="string">æ—§åå­—</span>  <span class="string">æ–°åå­—</span>      <span class="comment"># ç»™å®¹å™¨é‡æ–°å‘½å</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">top</span>    <span class="string">å®¹å™¨å®ä¾‹çš„ID</span>                  <span class="comment">#æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">ps</span> <span class="string">-a</span>                    <span class="comment">#åˆ—å‡ºæ‰€æœ‰å®¹å™¨ï¼ˆä¸åŠ -aå°±æ˜¯åœ¨è¿è¡Œçš„ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">rm</span>      <span class="string">å®¹å™¨å®ä¾‹çš„ID</span>                 <span class="comment">#åˆ é™¤å®¹å™¨ï¼ˆæ­£åœ¨è¿è¡Œå®¹å™¨ä¸èƒ½åˆ é™¤ï¼Œé™¤éåŠ -fé€‰é¡¹ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">kill</span>  <span class="string">å®¹å™¨å®ä¾‹çš„ID</span>        <span class="comment">#æ€æ‰å®¹å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">history</span>   <span class="string">å®¹å™¨å®ä¾‹çš„ID</span>    <span class="comment">#æŸ¥çœ‹dockeré•œåƒçš„å˜æ›´å†å²</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">start</span> <span class="string">å®¹å™¨å®ä¾‹çš„ID</span>        <span class="comment">#å¯åŠ¨å®¹å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">restart</span> <span class="string">å®¹å™¨å®ä¾‹çš„ID</span>       <span class="comment">#é‡å¯å®¹å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">stop</span> <span class="string">å®¹å™¨å®ä¾‹çš„ID</span>         <span class="comment">#åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">attach</span> <span class="string">/docker</span> <span class="string">exec</span>  <span class="string">å®¹å™¨å®ä¾‹çš„ID</span>   <span class="comment">#åŒä¸ºè¿›å…¥å®¹å™¨å‘½ä»¤ï¼Œä¸åŒçš„æ˜¯attachè¿æ¥ç»ˆæ­¢ä¼šè®©å®¹å™¨é€€å‡ºåå°è¿è¡Œï¼Œè€Œexecä¸ä¼šã€‚å¹¶ä¸”ï¼Œdocker attachæ˜¯è¿›å…¥æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šæƒ…åŠ¨æ–°çš„è¿›ç¨‹ï¼Œè€Œdocker execåˆ™ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯ä»¥åœ¨é‡Œé¢æ“ä½œã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">image</span> <span class="string">inspect</span>  <span class="string">å®¹å™¨åç§°ï¼šå®¹å™¨æ ‡ç­¾</span>       <span class="comment">#æŸ¥çœ‹å®¹å™¨å†…æºæ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">cp</span>  <span class="string">å®¹å™¨idï¼šå®¹å™¨å†…è·¯å¾„</span>   <span class="string">ç›®çš„ä¸»æœºè·¯å¾„</span>           <span class="comment">#ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºï¼ˆå¸¸ç”¨ï¼‰æˆ–è€…ä»ä¸»æœºæ‹·è´åˆ°å®¹å™¨ï¼ˆä¸€èˆ¬ç”¨æŒ‚è½½ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="string">exit</span>                           <span class="comment">#ç›´æ¥é€€å‡ºå®¹å™¨ </span></span><br><span class="line"></span><br><span class="line"><span class="string">crlt</span> <span class="string">+</span> <span class="string">P</span> <span class="string">+</span> <span class="string">Q</span>                   <span class="comment">#é€€å‡ºå®¹å™¨ä½†æ˜¯ä¸ç»ˆæ­¢è¿è¡Œ</span></span><br></pre></td></tr></table></figure><h2 id="é•œåƒåŸç†"><a href="#é•œåƒåŸç†" class="headerlink" title="é•œåƒåŸç†"></a>é•œåƒåŸç†</h2><p>ä¸Šé¢æˆ‘ä»¬æŠŠdockeræ¯”å–»æˆè®¸å¤šçš„é›†è£…ç®±ï¼Œé‚£ä¹ˆé•œåƒå°±æ˜¯æŸä¸€ä¸ªå…·ä½“çš„é›†è£…ç®±ï¼Œæ¯ä¸€ä¸ªé•œåƒé‡Œé¢éƒ½è£…äº†æˆ‘ä»¬éœ€è¦çš„åº”ç”¨ç¨‹åºã€è¿è¡Œçš„ç¯å¢ƒã€ä¾èµ–é¡¹ã€é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨è„šæœ¬çš„å‘½ä»¤ã€‚å¦‚æœæŸäººéœ€è¦ç”¨åˆ°æŸä¸ªä¸œè¥¿ï¼Œç›´æ¥æŠŠè¿™ä¸ªé›†è£…ç®±ç»™ä»–å°±å¥½äº†ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦å»é…ç½®ä»€ä¹ˆç¯å¢ƒä¹‹ç±»çš„ä¸œè¥¿ï¼Œå¾ˆæ–¹ä¾¿ã€‚</p><p>ä¸Šé¢æ˜¯ä¾¿äºç†è§£çš„è§£é‡Šï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯é•œåƒå‘¢ï¼Ÿé•œåƒæ˜¯ä¸€ç§è½»é‡çº§çš„ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ã€‚ç”¨æ¥æ‰“åŒ…è½¯ä»¶è¿è¡Œç¯å¢ƒå’ŒåŸºäºè¿è¡Œç¯å¢ƒçš„å¼€å‘è½¯ä»¶ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€è¦çš„å†…å®¹ï¼ŒåŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶ã€åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ã€‚</p><h3 id="Dockeré•œåƒåŠ è½½åŸç†"><a href="#Dockeré•œåƒåŠ è½½åŸç†" class="headerlink" title="Dockeré•œåƒåŠ è½½åŸç†"></a>Dockeré•œåƒåŠ è½½åŸç†</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261922603.png" alt="img"></p><p>æ‰€ä»¥å’Œè™šæ‹Ÿæœºç›¸æ¯”ï¼Œä¸ºä»€ä¹ˆdockerè¿è¡Œé€Ÿåº¦æ›´å¿«ä»¥åŠå ç”¨çš„å†…å­˜è¾ƒå°‘å‘¢ï¼Ÿä»ä¸Šé¢çš„å›¾ä¸­ä¹Ÿå¯ä»¥å‘ç°ï¼Œåœ¨dockeré•œåƒå¯ä»¥å…±äº«åº•å±‚çš„åŸºç¡€å±‚ã€‚è¿™æ„å‘³ç€å¦‚æœå¤šä¸ªå®¹å™¨éƒ½ä½¿ç”¨ç›¸åŒçš„åŸºç¡€é•œåƒï¼Œå®ƒä»¬å¯ä»¥å…±äº«è¿™äº›ä¸å˜çš„å±‚ï¼Œå‡å°‘äº†ç£ç›˜ç©ºé—´çš„å ç”¨ï¼Œå¹¶ä¸”åœ¨å®¹å™¨å¯åŠ¨æ—¶ä¹Ÿä¸éœ€è¦é‡æ–°åŠ è½½è¿™äº›å…±äº«çš„å±‚ï¼Œä»è€Œæé«˜äº†å¯åŠ¨é€Ÿåº¦ã€‚è¿™åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªåŸå› ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261922034.png" alt="img"></p><h2 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h2><p>å®¹å™¨æ˜¯ä¸€ç§è½»é‡çº§ã€ç‹¬ç«‹ã€å¯ç§»æ¤çš„è½¯ä»¶è¿è¡Œæ—¶ç¯å¢ƒï¼Œç”¨äºåœ¨å…¶ä¸­è¿è¡Œåº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚å®ƒä»¬é€šè¿‡å°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆä¾‹å¦‚åº“ã€ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ç­‰ï¼‰æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œåˆ›å»ºä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒï¼Œä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨ä¸åŒçš„è®¡ç®—æœºç¯å¢ƒä¸­ä»¥ä¸€è‡´çš„æ–¹å¼è¿è¡Œã€‚</p><p>ä¸æ˜ç™½ï¼Ÿé‚£æ¢ç§è¯´æ³•ã€‚</p><ul><li><strong>é•œåƒå°±åƒæ˜¯ä¸‰æ˜æ²»çš„é…æ–¹</strong>ï¼šå®ƒå‘Šè¯‰ä½ éœ€è¦ä»€ä¹ˆåŸæ–™ï¼Œä»¥åŠå¦‚ä½•å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚æ¯”å¦‚ï¼Œä¸‰æ˜æ²»çš„é…æ–¹å¯èƒ½åŒ…æ‹¬é¢åŒ…ã€ç«è…¿ã€ç”Ÿèœå’Œç•ªèŒ„ç­‰åŸæ–™ï¼Œä»¥åŠå¦‚ä½•å°†å®ƒä»¬å æ”¾åœ¨ä¸€èµ·ã€‚è¿™å°±æ˜¯é•œåƒï¼Œå®ƒå®šä¹‰äº†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–çš„é™æ€æ–‡ä»¶å’Œé…ç½®ä¿¡æ¯ï¼Œä½†æ²¡æœ‰å®é™…è¿è¡ŒçŠ¶æ€ã€‚</li><li><strong>å®¹å™¨å°±åƒæ˜¯åˆ¶ä½œå¥½çš„ä¸‰æ˜æ²»</strong>ï¼šä¸€æ—¦ä½ æ ¹æ®é…æ–¹å°†åŸæ–™ç»„åˆåœ¨ä¸€èµ·ï¼Œä½ å°±å¾—åˆ°äº†ä¸€ä»½çœŸæ­£çš„ä¸‰æ˜æ²»ã€‚è¿™ä¸ªä¸‰æ˜æ²»æ˜¯ä½ å¯ä»¥æ‹¿åœ¨æ‰‹é‡Œåƒçš„ï¼Œå°±åƒå®¹å™¨ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸€æ ·ã€‚å®¹å™¨åŒ…å«äº†é•œåƒä¸­å®šä¹‰çš„ä¸€åˆ‡ï¼ŒåŒæ—¶è¿˜æœ‰è¿è¡Œæ—¶çŠ¶æ€ï¼Œæ¯”å¦‚åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€ç½‘ç»œè¿æ¥ç­‰ã€‚</li></ul><p>è¿™æ ·æ˜¯ä¸æ˜¯å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œæ‰€ä»¥å®¹å™¨æ˜¯ä»€ä¹ˆï¼Ÿå®¹å™¨æ˜¯å…·ä½“çš„é›†è£…ç®±ï¼Œé•œåƒæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å†™å¥½é›†è£…ç®±è¦è£…ä»€ä¹ˆçš„æŒ‡å—ã€‚</p><h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><p>Dockerfileæ˜¯ä¸€ä¸ªåˆ›å»ºé•œåƒæ‰€æœ‰å‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€æ¡æ¡æŒ‡ä»¤å’Œè¯´æ˜, æ¯æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚,ï¼Œé€šè¿‡docker buildå‘½ä»¤ï¼Œæ ¹æ®Dockerfileçš„å†…å®¹æ„å»ºé•œåƒï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹, å°±æ˜¯æè¿°è¯¥å±‚å¦‚ä½•æ„å»ºã€‚æœ‰äº†Dockefile,ï¼Œå°±å¯ä»¥åˆ¶å®šè‡ªå·±çš„dockeré•œåƒè§„åˆ™,åªéœ€è¦åœ¨Dockerfileä¸Šæ·»åŠ æˆ–è€…ä¿®æ”¹æŒ‡ä»¤,ï¼Œå°±å¯ç”Ÿæˆdocker é•œåƒã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬æ¥æ•´ç†ä¸€ä¸‹dockerå®¹å™¨ã€dockerfileã€dockeré•œåƒçš„å…³ç³»ï¼š</p><ol><li>dockerfileæ˜¯é¢å‘å¼€å‘çš„ï¼Œå‘å¸ƒé¡¹ç›®åšé•œåƒçš„æ—¶å€™å°±è¦ç¼–å†™dockerfileæ–‡ä»¶ã€‚</li><li>dockerfileï¼šæ„å»ºæ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€åˆ‡çš„æ­¥éª¤ï¼Œæºä»£ç ã€‚</li><li>dockerImangesï¼šé€šè¿‡dockerfileæ„å»ºç”Ÿæˆçš„é•œåƒï¼Œæœ€ç»ˆå‘å¸ƒå’Œè¿è¡Œçš„äº§å“ã€‚</li><li>dockerå®¹å™¨ï¼šå®¹å™¨å°±æ˜¯é•œåƒè¿è¡Œèµ·æ¥æä¾›æœåŠ¡çš„ã€‚</li></ol><h2 id="Dockerç½‘ç»œ"><a href="#Dockerç½‘ç»œ" class="headerlink" title="Dockerç½‘ç»œ"></a>Dockerç½‘ç»œ</h2><p>æˆ‘ä»¬ä½¿ç”¨ifconfigå¯ä»¥çœ‹åˆ°ä¸‰ç»„ç½‘ç»œã€‚ é¦–å…ˆæ˜¯docker0ï¼Œè¿™æ˜¯æˆ‘ä»¬æœ¬èŠ‚çš„é‡ç‚¹ï¼Œdockerçš„ç½‘ç»œã€‚ä¹‹åæ˜¯eth0ï¼Œæœ¬æœºçš„å¤–ç½‘åœ°å€ã€‚loå£ï¼Œæœ¬åœ°ç¯å›åœ°å€ï¼Œå¯ä»¥ä»£è¡¨localhostã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261922714.png" alt="img"></p><p>ä¸ºä»€ä¹ˆDockeréœ€è¦åˆ†é…è™šæ‹Ÿçš„IPå‘¢ï¼Ÿ</p><ol><li><strong>éš”ç¦»æ€§å’Œç‹¬ç«‹æ€§</strong>ï¼šæ¯ä¸ªå®¹å™¨éƒ½è¢«è®¾è®¡ä¸ºä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œä¸å®¿ä¸»ä¸»æœºå’Œå…¶ä»–å®¹å™¨éš”ç¦»å¼€æ¥ã€‚ä½¿ç”¨è™šæ‹Ÿçš„ IP åœ°å€å¯ä»¥ç¡®ä¿æ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„ç½‘ç»œæ ‡è¯†ï¼Œä¸ä¼šä¸å®¿ä¸»ä¸»æœºæˆ–å…¶ä»–å®¹å™¨çš„ç½‘ç»œèµ„æºå‘ç”Ÿå†²çªã€‚</li><li><strong>ä¾¿äºæ‰©å±•å’Œè¿ç§»</strong>ï¼šä½¿ç”¨è™šæ‹Ÿçš„ IP åœ°å€å¯ä»¥ä½¿å®¹å™¨æ›´å®¹æ˜“åœ°è¿›è¡Œæ‰©å±•å’Œè¿ç§»ã€‚å½“å®¹å™¨éœ€è¦è¿ç§»åˆ°ä¸åŒçš„ä¸»æœºæˆ–è€…åŠ å…¥åˆ°ä¸åŒçš„ç½‘ç»œä¸­æ—¶ï¼Œåªéœ€è¦è°ƒæ•´ IP åœ°å€å³å¯ï¼Œè€Œä¸ä¼šå½±å“å®¹å™¨å†…éƒ¨çš„é…ç½®å’Œç¨‹åºé€»è¾‘ã€‚</li><li><strong>æ–¹ä¾¿çš„æœåŠ¡å‘ç°</strong>ï¼šä½¿ç”¨è™šæ‹Ÿ IP åœ°å€å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡ŒæœåŠ¡å‘ç°å’Œç®¡ç†ã€‚å®¹å™¨å¯ä»¥é€šè¿‡ DNS æˆ–è€…å…¶ä»–æœåŠ¡å‘ç°æœºåˆ¶æ¥è‡ªåŠ¨å‘ç°å½¼æ­¤ï¼Œè€Œä¸éœ€è¦ç¡¬ç¼–ç ç‰¹å®šçš„ IP åœ°å€å’Œç«¯å£å·ã€‚</li><li><strong>é¿å…ç«¯å£å†²çª</strong>ï¼šå¦‚æœæ¯ä¸ªå®¹å™¨éƒ½ä½¿ç”¨å®¿ä¸»ä¸»æœºçš„ IP åœ°å€åŠ ç«¯å£å·æ¥è¿›è¡Œé€šä¿¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç«¯å£å†²çªå’Œç®¡ç†ä¸Šçš„æ··ä¹±ã€‚è€Œä½¿ç”¨è™šæ‹Ÿ IP åœ°å€å¯ä»¥é¿å…è¿™ç§æƒ…å†µï¼Œæ¯ä¸ªå®¹å™¨éƒ½å¯ä»¥æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ç«¯å£ç©ºé—´ã€‚</li></ol><p>æ‰€ä»¥æœ€ä¸»è¦çš„ä¸åŸå› æ˜¯ä¸ºäº†ä¸åŒçš„å®¹å™¨ä¹‹é—´å¯ä»¥é€šä¿¡ä»¥åŠå®¹å™¨å¯ä»¥å’Œå®¿ä¸»æœºå™¨ä¿æŒéš”ç¦»æ€§ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ä¸ºdockerè®¾ç½®è™šæ‹Ÿçš„ipåœ°å€ï¼Œé‚£æ ·æˆ‘ä»¬ä¹‹å‰é…ç½®çš„dockerç«¯å£å·å’Œå®¿ä¸»çš„ç«¯å£å·ä¸€è‡´ï¼Œå´ä¸ä¼šå†²çªè¿™å°±è§£é‡Šçš„é€šäº†ï¼Œè¿™æ˜¯å› ä¸ºå®¿ä¸»çš„IPå’Œdockerå®¹å™¨çš„IPä¸æ˜¯åŒä¸€ä¸ªã€‚</p><h3 id="Dockerç½‘ç»œæ¨¡å¼"><a href="#Dockerç½‘ç»œæ¨¡å¼" class="headerlink" title="Dockerç½‘ç»œæ¨¡å¼"></a>Dockerç½‘ç»œæ¨¡å¼</h3><p>Dockeré»˜è®¤æä¾›äº†3ç§ç½‘ç»œæ¨¡å¼ï¼Œç”Ÿæˆå®¹å™¨æ—¶ä¸æŒ‡å®šç½‘ç»œæ¨¡å¼ä¸‹é»˜è®¤ä½¿ç”¨bridgeæ¡¥æ¥æ¨¡å¼ã€‚ ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å½“å‰Dockeræ‰€æœ‰çš„ç½‘ç»œæ¨¡å¼ã€‚</p><h4 id="hostæ¨¡å¼"><a href="#hostæ¨¡å¼" class="headerlink" title="hostæ¨¡å¼"></a>hostæ¨¡å¼</h4><p>å¦‚æœå®¹å™¨å¯ç”¨hostæ¨¡å¼ï¼Œé‚£ä¹ˆå®¹å™¨å°±ä¸ä¼šåˆ†é…ä¸€ä¸ªè™šæ‹Ÿçš„IPï¼Œè€Œæ˜¯å’Œå®¿ä¸»æœºå™¨ä½¿ç”¨åŒä¸€ä¸ªIPåœ°å€ã€‚å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£ã€‚ä½†æ˜¯ï¼Œå®¹å™¨çš„å…¶ä»–æ–¹é¢ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯å’Œå®¿ä¸»æœºéš”ç¦»çš„ã€‚åªæ˜¯IPä¸éš”ç¦»äº†ã€‚</p><p>ä½¿ç”¨hostæ¨¡å¼çš„å®¹å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„IPåœ°å€ä¸å¤–ç•Œé€šä¿¡ï¼Œå®¹å™¨å†…éƒ¨çš„æœåŠ¡ç«¯å£ä¹Ÿå¯ä»¥ä½¿ç”¨å®¿ä¸»æœºçš„ç«¯å£ï¼Œ<strong>hostæœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯ç½‘ç»œæ€§èƒ½æ¯”è¾ƒå¥½</strong>ï¼Œä½†æ˜¯docker hostä¸Šå·²ç»ä½¿ç”¨çš„ç«¯å£å°±ä¸èƒ½å†ç”¨äº†ï¼Œç½‘ç»œçš„éš”ç¦»æ€§ä¸å¥½ã€‚</p><h4 id="containeræ¨¡å¼"><a href="#containeræ¨¡å¼" class="headerlink" title="containeræ¨¡å¼"></a>containeræ¨¡å¼</h4><p>è¿™ä¸ªæ¨¡å¼æŒ‡å®šæ–°åˆ›å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ª Network Namespaceï¼Œè€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº« IPã€ç«¯å£èŒƒå›´ç­‰ã€‚åŒæ ·ï¼Œä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œæ–¹é¢ï¼Œå…¶ä»–çš„å¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯éš”ç¦»çš„ã€‚ä¸¤ä¸ªå®¹å™¨çš„è¿›ç¨‹å¯ä»¥é€šè¿‡ lo ç½‘å¡è®¾å¤‡é€šä¿¡ã€‚</p><h4 id="noneæ¨¡å¼"><a href="#noneæ¨¡å¼" class="headerlink" title="noneæ¨¡å¼"></a>noneæ¨¡å¼</h4><p>ä½¿ç”¨noneæ¨¡å¼ï¼ŒDockerå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„Network Namespaceï¼Œä½†æ˜¯ï¼Œå¹¶ä¸ä¸ºDockerå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªDockerå®¹å™¨æ²¡æœ‰ç½‘å¡ã€IPã€è·¯ç”±ç­‰ä¿¡æ¯ã€‚éœ€è¦æˆ‘ä»¬è‡ªå·±ä¸ºDockerå®¹å™¨æ·»åŠ ç½‘å¡ã€é…ç½®IPç­‰ã€‚è¿™ç§ç½‘ç»œæ¨¡å¼ä¸‹å®¹å™¨åªæœ‰loå›ç¯ç½‘ç»œï¼Œæ²¡æœ‰å…¶ä»–ç½‘å¡ã€‚noneæ¨¡å¼å¯ä»¥åœ¨å®¹å™¨åˆ›å»ºæ—¶é€šè¿‡â€“network&#x3D;noneæ¥æŒ‡å®šã€‚è¿™ç§ç±»å‹çš„ç½‘ç»œæ²¡æœ‰åŠæ³•è”ç½‘ï¼Œå°é—­çš„ç½‘ç»œèƒ½å¾ˆå¥½çš„ä¿è¯å®¹å™¨çš„å®‰å…¨æ€§ã€‚</p><h4 id="bridgeæ¨¡å¼"><a href="#bridgeæ¨¡å¼" class="headerlink" title="bridgeæ¨¡å¼"></a>bridgeæ¨¡å¼</h4><p>bridgeæ¨¡å¼æ˜¯dockerçš„é»˜è®¤ç½‘ç»œæ¨¡å¼ï¼Œä¸å†™â€“netå‚æ•°ï¼Œå°±æ˜¯bridgeæ¨¡å¼ã€‚ä½¿ç”¨docker run -pæ—¶ï¼Œdockerå®é™…æ˜¯åœ¨iptablesåšäº†DNATè§„åˆ™ï¼Œå®ç°ç«¯å£è½¬å‘åŠŸèƒ½ã€‚å¯ä»¥ä½¿ç”¨iptables -t nat -vnLæŸ¥çœ‹ã€‚bridgeæ¨¡å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261922658.png" alt="img"></p><p>å½“Dockerè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸ºdocker0çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œæ­¤ä¸»æœºä¸Šå¯åŠ¨çš„Dockerå®¹å™¨éƒ½ä¼šè¿æ¥åˆ°è¿™ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚è™šæ‹Ÿç½‘æ¡¥çš„å·¥ä½œæ–¹å¼å’Œç‰©ç†äº¤æ¢æœºç±»ä¼¼ï¼Œè¿™æ ·ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨å°±é€šè¿‡äº¤æ¢æœºè¿åœ¨äº†ä¸€ä¸ªäºŒå±‚ç½‘ç»œä¸­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261922913.png" alt="img"></p><h3 id="å®¹å™¨äº’è”"><a href="#å®¹å™¨äº’è”" class="headerlink" title="å®¹å™¨äº’è”"></a>å®¹å™¨äº’è”</h3><p>ä¹‹å‰æˆ‘ä»¬å­¦ä¹ äº†è§£äº†Dockerï¼Œé‚£ä¹ˆDockerå®¹å™¨å¯ä»¥ç±»æ¯”æˆç°å®ä¸–ç•Œçš„é›†è£…ç®±ã€‚æ—¢ç„¶æ˜¯é›†è£…ç®±ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾æƒ³åˆ°ä¸åŒå®¹å™¨ä¹‹é—´æ˜¯é«˜åº¦éš”ç¦»çš„ï¼Œé‚£ä¹ˆå¦‚æœä¸¤ä¸ªå®¹å™¨ä¹‹é—´éœ€è¦é€šä¿¡è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦å®¹å™¨äº’è”äº†ã€‚</p><p>å®¹å™¨äº’è”ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æŒ‡å®¹å™¨ä¹‹é—´çš„é€šä¿¡è”ç³»ã€‚ä½†æ˜¯å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ</p><p>å¦‚æœä½ æƒ³åˆ›å»ºä¸¤ä¸ªå®¹å™¨ï¼Œè®©å®ƒä»¬åœ¨åŒä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­äº’ç›¸é€šä¿¡ï¼Œä½ å¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰ç½‘ç»œ</span></span><br><span class="line">docker network create my-network</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è¿™ä¸ªç½‘ç»œä¸­å¯åŠ¨ä¸¤ä¸ªå®¹å™¨</span></span><br><span class="line">docker run -d --name container1 --network my-network alpine <span class="built_in">sleep</span> infinity</span><br><span class="line">docker run -d --name container2 --network my-network alpine <span class="built_in">sleep</span> infinity</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥ä¸€ä¸ªå®¹å™¨å¹¶å°è¯•pingå¦ä¸€ä¸ªå®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it container1 ping container2</span><br></pre></td></tr></table></figure><h2 id="åˆ¶ä½œé•œåƒå¹¶ä¸”å‘å¸ƒå¤–ç½‘"><a href="#åˆ¶ä½œé•œåƒå¹¶ä¸”å‘å¸ƒå¤–ç½‘" class="headerlink" title="åˆ¶ä½œé•œåƒå¹¶ä¸”å‘å¸ƒå¤–ç½‘"></a>åˆ¶ä½œé•œåƒå¹¶ä¸”å‘å¸ƒå¤–ç½‘</h2><p>æ³¨å†Œdocker hubè´¦å·ï¼š<a href="https://hub.docker.com/">https://hub.docker.com/</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261922281.png" alt="img"></p><p>æœåŠ¡å™¨ä¸Šä½¿ç”¨å‘½ä»¤è¡Œç™»å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker login -u [è´¦å·åå­—]   <span class="comment">#ç™»é™†å‘½ä»¤</span></span><br><span class="line">docker out                  <span class="comment">#é€€å‡ºå‘½ä»¤</span></span><br><span class="line">docker push è´¦å·/å®¹å™¨åå­—ï¼šç‰ˆæœ¬å·</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261922537.png" alt="img"></p><p>æ„å»ºé•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> dockerfile</span><br><span class="line"><span class="built_in">cd</span> dockerfile</span><br><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261922774.png" alt="img"></p><p>ç¼–å†™dockerfile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FORM centos</span><br><span class="line">MAINTAINER ydk&lt;123@qq.com&gt;</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line">RUN yum -y install vim-enhanced</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD <span class="built_in">echo</span> <span class="comment">#MYPATH</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;------------END-------------&quot;</span></span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure><p>æ„ä»¶dockerfile</p><p>Docker buildå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/m0_61503020/article/details/125456520?ops_request_misc=%7B%22request_id%22:%22171428436516800182123314%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171428436516800182123314&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-125456520-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=docker&spm=1018.2226.3001.4187">dockerå…¥é—¨ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a>ï¼›</li><li><a href="https://blog.csdn.net/CSDN1csdn1/article/details/123961079?ops_request_misc=&request_id=&biz_id=102&utm_term=docker%E7%BD%91%E7%BB%9C&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-123961079.142%5Ev100%5Epc_search_result_base1&spm=1018.2226.3001.4187">Dockerç½‘ç»œè¯¦è§£</a>ï¼›</li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>05 åŸºäºPrometheuså’ŒGrafanaå¯¹ CPUå†…å­˜ä»¥åŠåŠ æ²¹ç«™å¾®æœåŠ¡è¿›è¡ŒJVMç›‘æ§</title>
      <link href="/2025/02/26/05%20%E5%9F%BA%E4%BA%8EPrometheus%E5%92%8CGrafana%E5%AF%B9%20CPU%E5%86%85%E5%AD%98%E4%BB%A5%E5%8F%8A%E5%8A%A0%E6%B2%B9%E7%AB%99%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%BF%9B%E8%A1%8CJVM%E7%9B%91%E6%8E%A7/"/>
      <url>/2025/02/26/05%20%E5%9F%BA%E4%BA%8EPrometheus%E5%92%8CGrafana%E5%AF%B9%20CPU%E5%86%85%E5%AD%98%E4%BB%A5%E5%8F%8A%E5%8A%A0%E6%B2%B9%E7%AB%99%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%BF%9B%E8%A1%8CJVM%E7%9B%91%E6%8E%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="05-åŸºäºPrometheuså’ŒGrafanaå¯¹-CPUå†…å­˜ä»¥åŠåŠ æ²¹ç«™å¾®æœåŠ¡è¿›è¡ŒJVMç›‘æ§"><a href="#05-åŸºäºPrometheuså’ŒGrafanaå¯¹-CPUå†…å­˜ä»¥åŠåŠ æ²¹ç«™å¾®æœåŠ¡è¿›è¡ŒJVMç›‘æ§" class="headerlink" title="05 åŸºäºPrometheuså’ŒGrafanaå¯¹ CPUå†…å­˜ä»¥åŠåŠ æ²¹ç«™å¾®æœåŠ¡è¿›è¡ŒJVMç›‘æ§"></a>05 åŸºäºPrometheuså’ŒGrafanaå¯¹ CPUå†…å­˜ä»¥åŠåŠ æ²¹ç«™å¾®æœåŠ¡è¿›è¡ŒJVMç›‘æ§</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å…³äºè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘è¿›è¡Œäº†å¾ˆå¤šå¤©ï¼Œæ–­æ–­ç»­ç»­çš„ä¹Ÿç®—åŸºæœ¬å®Œæˆã€‚åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹å…³äºè¿™ä¸ªä»»åŠ¡é‡åˆ°çš„ä¸€äº›é—®é¢˜ä»¥ã€‚å…ˆçœ‹ä¸€ä¸‹æ•ˆæœå›¾ï¼š</p><ol><li>Windowsç¯å¢ƒä¸‹å¯¹CPUã€å†…å­˜ç­‰ä¿¡æ¯è¿›è¡Œç›‘æ§</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261920022.jpeg" alt="img"></p><ol><li>åŠ æ²¹ç«™å¾®æœåŠ¡JVMç›‘æ§</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261920696.jpeg" alt="img"></p><ol><li>Windowsæœ¬åœ°ç¯å¢ƒä¸‹å¯¹MySQLè¿›è¡Œç›‘æ§</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261920589.jpeg" alt="img"></p><ol><li>Windowsæœ¬åœ°ç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œç›‘æ§</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261921018.jpeg" alt="img"></p><p>grafanaå›¾è¡¨æ¨¡æ¿å·ï¼š</p><ol><li>JVMæ¨¡æ¿å·ï¼š4701</li><li>CPUç¡¬ä»¶æ¨¡æ¿å·ï¼š10467</li><li>MySQLæ¨¡æ¿å·ï¼š7362</li><li>Redisæ¨¡æ¿å·ï¼š763</li></ol><h2 id="Windowsç¯å¢ƒä¸‹å¯¹CPUç­‰ä¿¡æ¯è¿›è¡Œç›‘æ§"><a href="#Windowsç¯å¢ƒä¸‹å¯¹CPUç­‰ä¿¡æ¯è¿›è¡Œç›‘æ§" class="headerlink" title="Windowsç¯å¢ƒä¸‹å¯¹CPUç­‰ä¿¡æ¯è¿›è¡Œç›‘æ§"></a>Windowsç¯å¢ƒä¸‹å¯¹CPUç­‰ä¿¡æ¯è¿›è¡Œç›‘æ§</h2><p>åœ¨ä¹‹å‰è¿›è¡Œé…ç½®æ—¶ï¼Œæˆ‘å¹¶æ²¡æœ‰æ·»åŠ node-exporterè¿™ä¸ªï¼Œdocker-compose.ymlæ–‡ä»¶ä¸­æ—¶å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/prometheus:latest</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--storage.tsdb.retention.time=7d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--config.file=/etc/prometheus/prometheus.yml</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./grafana-provisioning/dashboards:/etc/grafana/provisioning/dashboards</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./grafana-provisioning/datasources:/etc/grafana/provisioning/datasources</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ²¡æœ‰è¿›ç¨‹å»æ”¶é›†æœ¬æœºçš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚CPUè¿è¡Œä¿¡æ¯ã€å†…å­˜ä½¿ç”¨ä¿¡æ¯ç­‰ç­‰ã€‚æŸ¥è¯¢ç›¸å…³èµ„æ–™åï¼Œäº†è§£åˆ°éœ€è¦æ˜ å…¥node-exporteræ¥æ”¶é›†æœ¬åœ°çš„ç¡¬ä»¶ä¿¡æ¯ã€‚</p><p>æ‰€ä»¥åœ¨docker-compose.ymlæ–‡ä»¶ä¸­å˜æˆå¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/prometheus:latest</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--storage.tsdb.retention.time=7d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--config.file=/etc/prometheus/prometheus.yml</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./grafana-provisioning/dashboards:/etc/grafana/provisioning/dashboards</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./grafana-provisioning/datasources:/etc/grafana/provisioning/datasources</span></span><br><span class="line">  <span class="attr">node_exporter:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/node-exporter:v1.6.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">node_exporter</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--path.rootfs=/host&#x27;</span></span><br><span class="line">    <span class="attr">pid:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9101</span><span class="string">:9100</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;./:/host:ro,rslave&#x27;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åŠ å…¥ä¹‹åé‡å¯ä¾æ—§æ— æ³•æ‰¾åˆ°æœ¬åœ°çš„ç¡¬ä»¶ä¿¡æ¯ï¼Œå¼•å…¥CPU ç­‰ç¡¬ä»¶ä¿¡æ¯çš„grafanaå›¾è¡¨åä¾ç„¶æ²¡æœ‰ä»»ä½•æ•°æ®æ˜¾ç¤ºã€‚åœ¨grafanaå›¾è¡¨ä¸­ï¼Œå®ƒä½¿ç”¨äº†PQLæŸ¥è¯¢ï¼Œå¯¹æ”¶é›†åˆ°çš„ç›¸å…³ä¿¡æ¯è¿›è¡ŒæŸ¥è¯¢ç­›æŸ¥ã€‚åœ¨å¯¹grafanaå›¾è¡¨çš„æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ†æåï¼Œå‘ç°å…¶å¾ˆå¤šæŒ‡æ ‡åœ¨Prometheusä¸­å¹¶ä¸å­˜åœ¨ï¼Œè¿™æ—¶å€™å¼€å§‹æ€€ç–‘æ˜¯å¦æ˜¯node-exporteré…ç½®é”™è¯¯ã€‚</p><p>åœ¨æŸ¥äº†ä¸€äº›èµ„æ–™åï¼Œå‘ç°node-exporteræ˜¯æ”¶é›†Linuxçš„ç¡¬ä»¶ä¿¡æ¯çš„ï¼Œä½†æ˜¯æˆ‘æ€€ç–‘å…¶æ˜¯å¦æ­£ç¡®ï¼Œæ‰€ä»¥æˆ‘ç”¨æµ‹è¯•æœåŠ¡å™¨è¿›è¡Œäº†æµ‹è¯•ä¹Ÿå¹¶æ²¡æœ‰ï¼›ï¼ˆç°åœ¨çŸ¥é“å¯èƒ½åœ¨Prometheus.ymlæ–‡ä»¶ä¸­æ²¡æœ‰é…ç½®node-exporterçš„ç«¯å£ä¿¡æ¯æ¥æ”¶é›†ï¼‰ã€‚</p><p>å°½ç®¡éªŒè¯å¤±è´¥ï¼Œä½†æ˜¯è¿˜æ˜¯å°±è¿™ä¸ªæ–¹å‘å»å¯»æ‰¾åŸå› ã€‚æœ€ååœ¨ä¸€ä¸ªå¸–å­ä¸Šæ‰¾åˆ°äº†ç›¸å…³ä¿¡æ¯ã€‚</p><ol><li><a href="https://blog.csdn.net/qq_34052481/article/details/134800332">Prometheusçš„exporterå®‰è£…</a>ï¼›</li><li><a href="https://blog.csdn.net/qq_41538097/article/details/125624222">Grafana+Prometheus+Windows_exporter+Mysql_exporter</a>ï¼›</li><li>[Windowsä¸‹æ­å»ºRediså¯è§†åŒ–ç›‘æ§ï¼ˆredis_exporter+prometheus+grafanaï¼‰](<a href="https://blog.csdn.net/u012069313/article/details/125008321?ops_request_misc=%7B%22request_id%22:%22171411660616800227423210%22,%22scm%22:%2220140713.130102334.pc_blog.%22%7D&request_id=171411660616800227423210&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-125008321-null-null.nonecase&utm_term=redis_exporter">https://blog.csdn.net/u012069313/article/details/125008321?ops_request_misc=%7B%22request%5Fid%22%3A%22171411660616800227423210%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&amp;request_id=171411660616800227423210&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-125008321-null-null.nonecase&amp;utm_term=redis_exporter</a> Grafana Prometheus windows&amp;spm&#x3D;1018.2226.3001.4450)ï¼›</li></ol><p>è¿™äº›å¸–å­ä¼šè§£å†³æ¥ä¸‹æ¥çš„é—®é¢˜ã€‚</p><p>æŒ‰ç…§å¸–å­çš„æ­¥éª¤å®‰è£…Windows-exporterè¿è¡Œï¼Œåœ¨prometheus.ymlæ–‡ä»¶ä¸­é…ç½®Windows-exporterçš„ç«¯å£ä¿¡æ¯å³å¯ï¼›</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261921367.png" alt="img"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my global config</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span>     <span class="string">15s</span> <span class="comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span> <span class="comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span></span><br><span class="line">  <span class="comment"># scrape_timeout is set to the global default (10s).</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># A scrape configuration containing exactly one endpoint to scrape:</span></span><br><span class="line"><span class="comment"># Here it&#x27;s Prometheus itself.</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;node-exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:9090&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;winnode-exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:9182&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;mysql_exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:9104&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;redis_exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:9121&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">space-intell-gas-register</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:8848&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;space-intell-gas-upms&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:54000&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;space-intell-gas-bff&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:52910&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;space-intell-gas-auth&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:53000&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;space-intell-gas-gateway&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:53999&#x27;</span>]</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯å…¨éƒ¨çš„ï¼Œè¿™é‡Œæ·»åŠ äº†è¿™ä¸€æ®µï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;winnode-exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:9182&#x27;</span>]</span><br></pre></td></tr></table></figure><p>ipåœ°å€è¦æ›´æ¢æˆè‡ªå·±çš„ï¼›</p><p>åœ¨grafanaä¸­å¼•å…¥å›¾è¡¨ç¼–å·ï¼š</p><h2 id="Windowsç¯å¢ƒä¸‹å¯¹åŠ æ²¹ç«™å¾®æœåŠ¡JVMè¿›è¡Œç›‘æ§"><a href="#Windowsç¯å¢ƒä¸‹å¯¹åŠ æ²¹ç«™å¾®æœåŠ¡JVMè¿›è¡Œç›‘æ§" class="headerlink" title="Windowsç¯å¢ƒä¸‹å¯¹åŠ æ²¹ç«™å¾®æœåŠ¡JVMè¿›è¡Œç›‘æ§"></a>Windowsç¯å¢ƒä¸‹å¯¹åŠ æ²¹ç«™å¾®æœåŠ¡JVMè¿›è¡Œç›‘æ§</h2><p>åŠ æ²¹ç«™äº”ä¸ªå¾®æœåŠ¡ä¹‹æˆåŠŸæŠ“å–äº†ä¸¤ä¸ªå¾®æœåŠ¡çš„JVMä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆï¼Ÿæš‚æ—¶æœªè§£å†³ã€‚</p><blockquote><p>ç›®å‰å·²ç»è§£å†³ï¼Œè¿™æ˜¯å› ä¸ºå…¶å®ƒä¸‰ä¸ªæœåŠ¡æ²¡æœ‰å¼•å…¥ç¾¡æ…•çš„è¿™ä¸ªä¾èµ–ï¼Œä»è€Œå¯¼è‡´æ²¡æœ‰è·å–äº”ä¸ªå¾®æœåŠ¡çš„JVMç›¸å…³ä¿¡æ¯ï¼›</p><p>ä½†æ˜¯å°±ç®—å¼•å…¥äº†ç›¸å…³ä¾èµ–ï¼ŒNacosæœåŠ¡è¿˜æ˜¯æ²¡æœ‰ï¼Œè¿™æ˜¯å› ä¸ºå…¶æ•°æ®å­˜æ”¾åœ°å€ä¸º&#x2F;nacos&#x2F;actuator&#x2F;prometheusä¸­ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹å³å¯ï¼›</p></blockquote><p>è¿™é‡Œåªè¦å¾®æœåŠ¡å¼•å…¥äº†ä¾èµ–ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;dependency&gt;</span></span><br><span class="line">    <span class="string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line">    <span class="string">&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></span><br><span class="line"><span class="string">&lt;/dependency&gt;</span></span><br><span class="line"><span class="string">&lt;dependency&gt;</span></span><br><span class="line">    <span class="string">&lt;groupId&gt;io.micrometer&lt;/groupId&gt;</span></span><br><span class="line">    <span class="string">&lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;</span></span><br><span class="line">    <span class="string">&lt;scope&gt;runtime&lt;/scope&gt;</span></span><br><span class="line"><span class="string">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨spring bootå¾®æœåŠ¡application.ymlæ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">      <span class="attr">application:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">$&#123;spring.profiles.active&#125;</span></span><br><span class="line">      <span class="attr">project:</span> <span class="string">infra</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">      <span class="attr">base-path:</span> <span class="string">/actuator</span></span><br><span class="line">  <span class="attr">health:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>å°±ä¼šè‡ªåŠ¨çš„å®Œæˆæ•°æ®é‡‡é›†ï¼›</p><p>å°†éœ€è¦ç›‘æ§çš„å¾®æœåŠ¡çš„ç«¯å£å·é…ç½®åˆ°prometheus.ymlæ–‡ä»¶ä¸­ï¼ŒPrometheuså°±ä¼šå®šæœŸçš„å»æŠ“å–è¿™äº›æ•°æ®ã€‚</p><p>å…¨éƒ¨çš„é…ç½®ä¿¡æ¯ä¸Šæ–‡ç»™å‡ºäº†ï¼Œè¯·è¯¦ç»†æŸ¥çœ‹ã€‚</p><p>åœ¨grafanaä¸­é…ç½®ç›¸å…³ä¿¡æ¯å³å¯ï¼Œå¼•å…¥æ¨¡æ¿å·æŸ¥çœ‹å³å¯ã€‚</p><h2 id="Windowsç¯å¢ƒä¸‹å¯¹MySQLè¿›è¡Œç›‘æ§"><a href="#Windowsç¯å¢ƒä¸‹å¯¹MySQLè¿›è¡Œç›‘æ§" class="headerlink" title="Windowsç¯å¢ƒä¸‹å¯¹MySQLè¿›è¡Œç›‘æ§"></a>Windowsç¯å¢ƒä¸‹å¯¹MySQLè¿›è¡Œç›‘æ§</h2><p>è¯¦ç»†æ­¥éª¤æŸ¥çœ‹ä¸Šæ–‡ä¸­çš„çš„åšå®¢æ–‡æ¡£è¿›è¡Œè§£å†³ã€‚</p><p>ç‰¹åˆ«æ³¨æ„è¿™é‡Œå¯èƒ½å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œè¯·æŒ‰ç…§è¿™ä¸ªæ–‡æ¡£è¿›è¡Œè§£å†³ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Host</span> <span class="string">â€˜host.docker.internalâ€˜</span> <span class="string">is</span> <span class="string">not</span> <span class="string">allowed</span> <span class="string">to</span> <span class="string">connect</span> <span class="string">to</span> <span class="string">this</span> <span class="string">...</span></span><br></pre></td></tr></table></figure><p>è§£å†³æ–‡æ¡£ï¼š<a href="https://blog.51cto.com/lanzao/5061987">MySQL æ•°æ®åº“ä¿®æ”¹è®¿é—®æƒé™ï¼Œä¸èƒ½ä½¿ç”¨ipè¿æ¥mysqlé—®é¢˜å¤„ç†ï¼šHost â€˜host.docker.internalâ€˜ is not allowed to connect to this â€¦</a></p><h2 id="Windowsç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œç›‘æ§é…ç½®"><a href="#Windowsç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œç›‘æ§é…ç½®" class="headerlink" title="Windowsç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œç›‘æ§é…ç½®"></a>Windowsç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œç›‘æ§é…ç½®</h2><p>åŒæ ·å…ˆå®‰è£…ä¸Šé¢çš„æ–‡æ¡£æ­¥éª¤è¿›è¡Œæ“ä½œå³å¯ï¼›</p><p>ç‰¹åˆ«æ³¨æ„è¿™é‡Œå¯èƒ½ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼šredis-exporteræ— æ³•è¿æ¥redisï¼›</p><ol><li>æ³¨æ„redis-exporterçš„ç‰ˆæœ¬å’Œredisç‰ˆæœ¬å¥‘åˆï¼Œå°½é‡ä½¿ç”¨å‘å¸ƒæ—¶é—´å·®ä¸å¤šçš„ç‰ˆæœ¬ï¼›</li><li>å¦‚æœredisæ²¡æœ‰è®¾ç½®å¯†ç ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">redis_exporter.exe</span> <span class="string">-redis.addr</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.29</span><span class="string">:6379</span> <span class="string">-web.listen-address</span> <span class="string">:9121</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ›´æ¢è‡ªå·±çš„ipåœ°å€ï¼›</p><p>ç„¶ååœ¨grafanaä¸­å¼•å…¥rediså›¾è¡¨å³å¯ï¼›</p><h2 id="Linuxç¯å¢ƒä¸‹é…ç½®æ–‡ä»¶"><a href="#Linuxç¯å¢ƒä¸‹é…ç½®æ–‡ä»¶" class="headerlink" title="Linuxç¯å¢ƒä¸‹é…ç½®æ–‡ä»¶"></a>Linuxç¯å¢ƒä¸‹é…ç½®æ–‡ä»¶</h2><h3 id="Prometheus-yml"><a href="#Prometheus-yml" class="headerlink" title="Prometheus.yml"></a>Prometheus.yml</h3><p>éœ€è¦æŠŠIPåœ°å€æ›´æ”¹æˆéœ€è¦ç›‘æ§ä¸»æœºIP</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my global config</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span>     <span class="string">15s</span> <span class="comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span> <span class="comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span></span><br><span class="line">  <span class="comment"># scrape_timeout is set to the global default (10s).</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># A scrape configuration containing exactly one endpoint to scrape:</span></span><br><span class="line"><span class="comment"># Here it&#x27;s Prometheus itself.</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;node-exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:9090&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;winnode-exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:9182&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;mysql_exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:9104&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;redis_exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:9121&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">space-intell-gas-register</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/nacos/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:8848&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;space-intell-gas-upms&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:54000&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;space-intell-gas-bff&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:52910&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;space-intell-gas-auth&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:53000&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;space-intell-gas-gateway&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.0.29:59999&#x27;</span>]</span><br><span class="line">  </span><br></pre></td></tr></table></figure><h3 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/prometheus:latest</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--storage.tsdb.retention.time=7d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--config.file=/etc/prometheus/prometheus.yml</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./grafana-provisioning/dashboards:/etc/grafana/provisioning/dashboards</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./grafana-provisioning/datasources:/etc/grafana/provisioning/datasources</span></span><br><span class="line">  <span class="attr">node_exporter:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/node-exporter:v1.6.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">node_exporter</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--path.rootfs=/host&#x27;</span></span><br><span class="line">    <span class="attr">pid:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9101</span><span class="string">:9100</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;./:/host:ro,rslave&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Linuxç¯å¢ƒä¸‹å¯¹CPUç­‰ä¿¡æ¯è¿›è¡Œç›‘æ§é…ç½®"><a href="#Linuxç¯å¢ƒä¸‹å¯¹CPUç­‰ä¿¡æ¯è¿›è¡Œç›‘æ§é…ç½®" class="headerlink" title="Linuxç¯å¢ƒä¸‹å¯¹CPUç­‰ä¿¡æ¯è¿›è¡Œç›‘æ§é…ç½®"></a>Linuxç¯å¢ƒä¸‹å¯¹CPUç­‰ä¿¡æ¯è¿›è¡Œç›‘æ§é…ç½®</h2><p>æ­¥éª¤å’Œä¸Šæ–‡ä¸­Windowsçš„ä¸€è‡´ï¼Œä½†æ˜¯è¦ç‰¹åˆ«æ³¨æ„å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>è¿™é‡Œé€‰å–çš„æ˜¯Linuxä¸‹çš„ï¼Œæ‰€ä»¥grafanaå›¾è¡¨ç‰ˆæœ¬å·ä¸º<strong>16098</strong>ï¼›</li><li>å¦‚æœæœåŠ¡èµ·æ¥åï¼Œè§‚å¯Ÿåˆ°Linux-node-exporterä¸ºdownï¼ŒæŸ¥çœ‹æ˜¯å¦å…³é—­äº†é˜²ç«å¢™ï¼› ä½¿ç”¨è¯¥å‘½ä»¤å…³é—­é˜²ç«å¢™ï¼šsudo ufw disable</li><li>å¦‚æœå…³é—­é˜²ç«å¢™è¿˜æ˜¯downï¼Œè¯·æ³¨æ„ç«¯å£å·æ˜¯å¦æ­£ç¡®ï¼Œè¿™é‡Œé…ç½®çš„ç«¯å£å·æ˜¯9101ç‰¹åˆ«æ³¨æ„ï¼›</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">node_exporter:</span><br><span class="line">    image: prom/node-exporter:v1.6.0</span><br><span class="line">    container_name: node_exporter</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">&#x27;--path.rootfs=/host&#x27;</span></span><br><span class="line">    pid: host</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    environment:</span><br><span class="line">      - TZ=Asia/Shanghai</span><br><span class="line">    ports:</span><br><span class="line">      - 9101:9100</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&#x27;./:/host:ro,rslave&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261921696.png" alt="img"></p><h2 id="Linuxç¯å¢ƒä¸‹å¯¹MYSQLè¿›è¡Œç›‘æ§"><a href="#Linuxç¯å¢ƒä¸‹å¯¹MYSQLè¿›è¡Œç›‘æ§" class="headerlink" title="Linuxç¯å¢ƒä¸‹å¯¹MYSQLè¿›è¡Œç›‘æ§"></a>Linuxç¯å¢ƒä¸‹å¯¹MYSQLè¿›è¡Œç›‘æ§</h2><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li>[Promethus+Grafanaæ–¹æ¡ˆ-å®ç°MYSQl+LINUX+Windowsç›‘æ§](<a href="https://blog.csdn.net/kai172142xiang/article/details/104493980?ops_request_misc=&request_id=&biz_id=102&utm_term=Grafana+Prometheus+Linux">https://blog.csdn.net/kai172142xiang/article/details/104493980?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=Grafana+Prometheus+Linux</a> + Mys&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2<del>all</del>sobaiduweb~default-2-104493980.142^v100^pc_search_result_base2&amp;spm&#x3D;1018.2226.3001.4187)ï¼›</li><li>[Linuxå®‰è£…prometheus+grafanaç›‘æ§mysqlæ•°æ®åº“](<a href="https://blog.csdn.net/krb___/article/details/132402047?ops_request_misc=&request_id=&biz_id=102&utm_term=Grafana+Prometheus+Linux">https://blog.csdn.net/krb___/article/details/132402047?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=Grafana+Prometheus+Linux</a> + Mys&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2<del>all</del>sobaiduweb~default-0-132402047.142^v100^pc_search_result_base2&amp;spm&#x3D;1018.2226.3001.4187)ï¼›</li><li><a href="https://prometheus.io/download/%EF%BC%9B">https://prometheus.io/download/ï¼›</a></li><li><a href="https://blog.csdn.net/Monarchess_1234/article/details/130360665">mysql_exporteråœ¨Linuxä¸Šçš„å®‰è£…ä¸é…ç½®.</a></li></ol><p>åœ¨æµ‹è¯•æœåŠ¡å™¨ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./mysqld_exporter-0.14.0.linux-amd64/mysqld_exporter</span> <span class="string">--web.listen-address=:9104</span> <span class="string">--config.my-cnf=./mysqld_exporter-0.14.0.linux-amd64/my.cnf</span> <span class="string">&amp;</span></span><br></pre></td></tr></table></figure><p>å³å¯ï¼›</p><p>è¿™ä¸ªä¸è¦åœ¨sudoä¸‹è¿è¡Œï¼›</p><h2 id="Linuxç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œç›‘æ§"><a href="#Linuxç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œç›‘æ§" class="headerlink" title="Linuxç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œç›‘æ§"></a>Linuxç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œç›‘æ§</h2><ol><li><a href="https://github.com/oliver006/redis_exporter">https://github.com/oliver006/redis_exporter</a></li><li>[grafana+prometheus+redis_exporterç›‘æ§redisæ•°æ®åº“æ€§èƒ½](<a href="https://blog.csdn.net/weixin_43442452/article/details/129858916?ops_request_misc=%7B%22request_id%22:%22171420402116800197016778%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=171420402116800197016778&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-129858916-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=Grafana+Prometheus+Linux">https://blog.csdn.net/weixin_43442452/article/details/129858916?ops_request_misc=%7B%22request%5Fid%22%3A%22171420402116800197016778%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=171420402116800197016778&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-129858916-null-null.142^v100^pc_search_result_base2&amp;utm_term=Grafana%2BPrometheus%2BLinux</a> %2B Redis&amp;spm&#x3D;1018.2226.3001.4187)ï¼›</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">åœ¨redisçš„ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="string">./redis_exporter</span> <span class="string">-redis.addr</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.125</span><span class="string">:6379</span> <span class="string">-web.listen-address</span> <span class="string">:9121</span></span><br></pre></td></tr></table></figure><p>å³å¯ï¼›</p><h2 id="Linuxç¯å¢ƒä¸‹å¯¹åŠ æ²¹ç«™äº”ä¸ªé¡¹ç›®è¿›è¡ŒJVMç›‘æ§"><a href="#Linuxç¯å¢ƒä¸‹å¯¹åŠ æ²¹ç«™äº”ä¸ªé¡¹ç›®è¿›è¡ŒJVMç›‘æ§" class="headerlink" title="Linuxç¯å¢ƒä¸‹å¯¹åŠ æ²¹ç«™äº”ä¸ªé¡¹ç›®è¿›è¡ŒJVMç›‘æ§"></a>Linuxç¯å¢ƒä¸‹å¯¹åŠ æ²¹ç«™äº”ä¸ªé¡¹ç›®è¿›è¡ŒJVMç›‘æ§</h2><p>æ— ï¼Œå‚è€ƒWindowsç¯å¢ƒä¸‹å¯¹JVMçš„ç›‘æ§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>09 Linuxç¯å¢ƒä¸‹æ­å»ºELKï¼ˆElasticsearch+Logstash+Kibanaï¼‰</title>
      <link href="/2025/02/26/09%20Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%90%AD%E5%BB%BAELK%EF%BC%88Elasticsearch+Logstash+Kibana%EF%BC%89/"/>
      <url>/2025/02/26/09%20Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%90%AD%E5%BB%BAELK%EF%BC%88Elasticsearch+Logstash+Kibana%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="09-Linuxç¯å¢ƒä¸‹æ­å»ºELKï¼ˆElasticsearch-Logstash-Kibanaï¼‰"><a href="#09-Linuxç¯å¢ƒä¸‹æ­å»ºELKï¼ˆElasticsearch-Logstash-Kibanaï¼‰" class="headerlink" title="09 Linuxç¯å¢ƒä¸‹æ­å»ºELKï¼ˆElasticsearch+Logstash+Kibanaï¼‰"></a>09 Linuxç¯å¢ƒä¸‹æ­å»ºELKï¼ˆElasticsearch+Logstash+Kibanaï¼‰</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨ç°ä»£çš„è½¯ä»¶å¼€å‘å’Œè¿ç»´é¢†åŸŸï¼Œç›‘æ§å’Œæ—¥å¿—ç®¡ç†æ˜¯è‡³å…³é‡è¦çš„ä»»åŠ¡ã€‚éšç€åº”ç”¨ç¨‹åºè§„æ¨¡çš„æ‰©å¤§å’Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ™®åŠï¼Œæœ‰æ•ˆåœ°è·Ÿè¸ªå’Œåˆ†ææ—¥å¿—æ•°æ®æˆä¸ºäº†æŒ‘æˆ˜ã€‚Elasticsearchã€Logstashå’ŒKibanaï¼ˆEFKï¼‰æ¡†æ¶æ˜¯ä¸€ç»„æµè¡Œçš„å·¥å…·ï¼Œå¯å¸®åŠ©æ‚¨å®ç°é«˜æ•ˆçš„æ—¥å¿—æ”¶é›†ã€å­˜å‚¨å’Œåˆ†æã€‚</p><h2 id="æŠ€æœ¯æ¶æ„"><a href="#æŠ€æœ¯æ¶æ„" class="headerlink" title="æŠ€æœ¯æ¶æ„"></a>æŠ€æœ¯æ¶æ„</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924889.png" alt="img"></p><p>å¦‚å›¾æ‰€ç¤ºï¼š</p><ol><li>åº”ç”¨ç¨‹åºå®æ—¶äº§ç”Ÿæ—¥å¿—æ–‡ä»¶ï¼›</li><li>Logstashè¯»å–æ—¥å¿—æ–‡ä»¶;</li><li>Logstashä¼šå°†æ”¶é›†åˆ°çš„æ—¥å¿—å‘é€åˆ°Elasticsearchã€‚Elasticsearchæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„æœç´¢å’Œåˆ†æå¼•æ“ï¼Œç”¨äºå­˜å‚¨å’Œç´¢å¼•æ—¥å¿—æ•°æ®ã€‚ä¸€æ—¦æ•°æ®åˆ°è¾¾Elasticsearchï¼Œå®ƒå°†è‡ªåŠ¨å»ºç«‹ç´¢å¼•ï¼Œä»¥ä¾¿ç¨åçš„æŸ¥è¯¢å’Œåˆ†æ;</li><li>ä½¿ç”¨KibanaæŸ¥çœ‹ã€æœç´¢ã€åˆ†ææ—¥å¿—ã€‚</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Logstashéƒ¨ç½²è‡³æœåŠ¡ä¸»æœºï¼Œå¯¹å„ä¸ªæœåŠ¡çš„æ—¥å¿—è¿›è¡Œé‡‡é›†ã€è¿‡æ»¤ã€æ¨é€ã€‚</span></span><br><span class="line"><span class="string">Elasticsearchå­˜å‚¨Logstashä¼ é€çš„ç»“æ„åŒ–æ•°æ®ï¼Œæä¾›ç»™Kibanaã€‚</span></span><br><span class="line"><span class="string">Kibanaæä¾›ç”¨æˆ·UIwebé¡µé¢è¿›è¡Œï¼Œæ•°æ®å±•ç¤ºå’Œåˆ†æå½¢æˆå›¾è¡¨ç­‰ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²å®‰è£…"><a href="#éƒ¨ç½²å®‰è£…" class="headerlink" title="éƒ¨ç½²å®‰è£…"></a>éƒ¨ç½²å®‰è£…</h2><p>docker-compose.ymlæ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š</p><p>æ³¨æ„æŠŠ192.168.0.125IPåœ°å€æ›´æ¢æˆè‡ªå·±æœ¬æœºçš„IPåœ°å€ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"><span class="comment">#æœåŠ¡é…ç½®</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="comment">#esæœåŠ¡</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.14.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ES_JAVA_OPTS:</span> <span class="string">-Xms1g</span> <span class="string">-Xmx1g</span></span><br><span class="line">      <span class="attr">node.name:</span> <span class="string">es-single</span></span><br><span class="line">      <span class="attr">cluster.name:</span> <span class="string">es-cluster</span></span><br><span class="line">      <span class="attr">discovery.type:</span> <span class="string">single-node</span></span><br><span class="line">      <span class="comment"># å¼€å¯esè·¨åŸŸ</span></span><br><span class="line">      <span class="attr">http.cors.enabled:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">      <span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">      <span class="attr">http.cors.allow-headers:</span> <span class="string">Authorization</span></span><br><span class="line">      <span class="comment"># å®‰å…¨æ§åˆ¶ï¼ˆæ ¹æ®ä¸ªäººéœ€è¦é€‰æ‹©æ‰“å¼€æˆ–å…³é—­ï¼‰</span></span><br><span class="line">      <span class="attr">xpack.security.enabled:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">      <span class="attr">xpack.security.transport.ssl.enabled:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">      <span class="attr">ELASTIC_PASSWORD:</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es/data:/usr/share/elasticsearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es/plugins:/usr/share/elasticsearch/plugins</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es/logs:/usr/share/elasticsearch/logs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9300:9300&quot;</span></span><br><span class="line">  <span class="comment">#kibana</span></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">kibana:7.14.0</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5601:5601&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ELASTICSEARCH_HOSTS:</span> <span class="string">&#x27;[&quot;http://192.168.0.125:9200&quot;]&#x27;</span></span><br><span class="line">      <span class="attr">ELASTICSEARCH_USERNAME:</span> <span class="string">&#x27;elastic&#x27;</span></span><br><span class="line">      <span class="attr">ELASTICSEARCH_PASSWORD:</span> <span class="string">&#x27;B6P0hW7x&#x27;</span></span><br></pre></td></tr></table></figure><p>åœ¨docker-compose.ymlæ–‡ä»¶å¤¹ä¸‹æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> docker-compose up -d </span><br></pre></td></tr></table></figure><p>å¯åŠ¨è¿™ä¸ªdocker-composeã€‚</p><p>åœ¨docker-compose.ymlæ–‡ä»¶ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªlogstashçš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹å®‰è£…logstashã€‚</p><p>å‚è€ƒæ•™ç¨‹ï¼š[Linuxä¸‹å®‰è£…Logstash](<a href="https://blog.csdn.net/Amber_1/article/details/124315986?ops_request_misc=%7B%22request_id%22:%22171444816816800215071428%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171444816816800215071428&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-2-124315986-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=Linux">https://blog.csdn.net/Amber_1/article/details/124315986?ops_request_misc=%7B%22request%5Fid%22%3A%22171444816816800215071428%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=171444816816800215071428&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-2-124315986-null-null.142^v100^pc_search_result_base1&amp;utm_term=Linux</a> ä¸‹è½½ Logstash&amp;spm&#x3D;1018.2226.3001.4187)</p><p>åœ¨æµ‹è¯•æœåŠ¡å™¨ä¸Šï¼Œæ³¨æ„æˆ‘å°†logstashä¸‹è½½åˆ°äº†&#x2F;home&#x2F;space&#x2F;Docker-compose&#x2F;ELK&#x2F;logstashä¸­ã€‚</p><p>å¯¹logstashè¿›è¡Œé…ç½®ï¼Œæˆ‘å°†é…ç½®æ–‡ä»¶æ”¾åœ¨äº†ç›®å½•&#x2F;home&#x2F;space&#x2F;Docker-compose&#x2F;ELK&#x2F;logstash&#x2F;logstash-7.3.1&#x2F;config&#x2F;logstash.confä¸­</p><p>logstash.confçš„å†…å®¹ä¸ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">input&#123;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Docker-compose/logs/debug.txt&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;systemlog&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/auth/logs/space-intell-gas-auth/debug.log&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;auth-debug&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/auth/logs/space-intell-gas-auth/error.log&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;auth-error&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/bff/logs/space-intell-gas-bff/debug.log&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;bff-debug&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/bff/logs/space-intell-gas-bff/error.log&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;bff-error&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/gateway/logs/space-intell-gas-gateway/debug.log&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;gateway-debug&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/gateway/logs/space-intell-gas-gateway/error.log&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;gateway-error&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/upms/logs/space-intell-gas-upms-biz/error.log&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;upms-error&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/upms/logs/space-intell-gas-upms-biz/debug.log&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;upms-debug&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/nacos/logs/config-client-request.log&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;registe-config&quot;</span></span><br><span class="line">        <span class="string">start_position</span> <span class="string">=&gt;</span> <span class="string">&quot;beginning&quot;</span></span><br><span class="line">        <span class="string">stat_interval</span> <span class="string">=&gt;</span> <span class="string">&quot;3 second&quot;</span></span><br><span class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">&quot;json&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/auth/logs/space-intell-gas-auth/*/*.log.gz&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;auth-debug&quot;</span></span><br><span class="line">        <span class="string">mode</span> <span class="string">=&gt;</span> <span class="string">&quot;read&quot;</span></span><br><span class="line">        <span class="string">file_completed_action</span> <span class="string">=&gt;</span> <span class="string">&quot;log&quot;</span></span><br><span class="line">        <span class="string">file_completed_log_path</span> <span class="string">=&gt;</span> <span class="string">&quot;/home/space/Docker-compose/ELK/logstash/read/space-intell-gas-auth-debug-read.log&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/bff/logs/space-intell-gas-bff/*/*.log.gz&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;bff-debug&quot;</span></span><br><span class="line">        <span class="string">mode</span> <span class="string">=&gt;</span> <span class="string">&quot;read&quot;</span></span><br><span class="line">        <span class="string">file_completed_action</span> <span class="string">=&gt;</span> <span class="string">&quot;log&quot;</span></span><br><span class="line">        <span class="string">file_completed_log_path</span> <span class="string">=&gt;</span> <span class="string">&quot;/home/space/Docker-compose/ELK/logstash/read/space-intell-gas-bff-debug-read.log&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/gateway/logs/space-intell-gas-gateway/*/*.log.gz&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;gateway-debug&quot;</span></span><br><span class="line">        <span class="string">mode</span> <span class="string">=&gt;</span> <span class="string">&quot;read&quot;</span></span><br><span class="line">        <span class="string">file_completed_action</span> <span class="string">=&gt;</span> <span class="string">&quot;log&quot;</span></span><br><span class="line">        <span class="string">file_completed_log_path</span> <span class="string">=&gt;</span> <span class="string">&quot;/home/space/Docker-compose/ELK/logstash/read/space-intell-gas-gateway-debug-read.log&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/upms/logs/space-intell-gas-upms-biz/*/*.log.gz&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;upms-debug&quot;</span></span><br><span class="line">        <span class="string">mode</span> <span class="string">=&gt;</span> <span class="string">&quot;read&quot;</span></span><br><span class="line">        <span class="string">file_completed_action</span> <span class="string">=&gt;</span> <span class="string">&quot;log&quot;</span></span><br><span class="line">        <span class="string">file_completed_log_path</span> <span class="string">=&gt;</span> <span class="string">&quot;/home/space/Docker-compose/ELK/logstash/read/space-intell-gas-upms-debug-read.log&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">output&#123;</span></span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;systemlog&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;test-gateway-debug&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;auth-debug&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;space-intell-gas-auth-debug&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;auth-error&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;space-intell-gas-auth-error&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;bff-debug&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;space-intell-gas-bff-debug&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;bff-error&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;space-intell-gas-bff-error&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;gateway-debug&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;space-intell-gas-gateway-debug&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;gateway-error&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;space-intell-gas-gateway-error&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;upms-debug&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;space-intell-gas-upms-debug&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;upms-error&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;space-intell-gas-upms-error&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;registe-config&quot;</span> &#123;</span><br><span class="line">      <span class="string">elasticsearch</span> &#123;</span><br><span class="line">      <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;192.168.0.125:9200&quot;</span>] </span><br><span class="line">      <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;space-intell-gas-registe-config&quot;</span></span><br><span class="line">      <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;B6P0hW7x&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>logstash.confé…ç½®æ–‡ä»¶å¯¹logstashè¿›è¡Œäº†é…ç½®ï¼Œå°†ç¨‹åºè¿è¡Œä¿å­˜çš„æ—¥å¿—æ–‡ä»¶é€šè¿‡æŒ‡å®špathå‘ŠçŸ¥logstashè¯»å–ï¼Œæ³¨æ„è¿™é…ç½®æ–‡ä»¶è¿˜å¯¹å‹ç¼©åŒ…å†…çš„é…ç½®æ–‡ä»¶è¿›è¡Œäº†è¯»å–ï¼Œè¯»å–é…ç½®åœ¨ä¸Šé¢é…ç½®ä¸­å­˜åœ¨ï¼Œè¿™é‡Œæˆªå–ä¸€æ®µï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">file&#123;</span></span><br><span class="line">            <span class="string">path=&gt;&quot;/home/space/Documents/deployment/backend/java/upms/logs/space-intell-gas-upms-biz/*/*.log.gz&quot;</span></span><br><span class="line">            <span class="string">type</span> <span class="string">=&gt;</span> <span class="string">&quot;upms-debug&quot;</span></span><br><span class="line">        <span class="string">mode</span> <span class="string">=&gt;</span> <span class="string">&quot;read&quot;</span></span><br><span class="line">        <span class="string">file_completed_action</span> <span class="string">=&gt;</span> <span class="string">&quot;log&quot;</span></span><br><span class="line">        <span class="string">file_completed_log_path</span> <span class="string">=&gt;</span> <span class="string">&quot;/home/space/Docker-compose/ELK/logstash/read/space-intell-gas-upms-debug-read.log&quot;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«æ³¨æ„ï¼šåœ¨å¯¹å‹ç¼©åŒ…è¿›è¡Œè¯»å–æ—¶ï¼Œéœ€è¦é…ç½®file_completed_actionæŒ‡å®šä¸ºlogï¼Œå³ä¸Šé¢æ‰€ç¤ºã€‚</p><ul><li>å¦‚æœåªé…ç½®file_completed_actionè€Œä¸é…ç½®file_completed_log_pathï¼Œä¼šè¿è¡Œå¤±è´¥æŠ¥é”™ã€‚</li><li>å¦‚æœfile_completed_actionå’Œfile_completed_log_pathéƒ½ä¸é…ç½®çš„è¯ï¼Œé‚£ä¹ˆpathæŒ‡å®šçš„æ—¥å¿—å‹ç¼©åŒ…ä¼šè¢«è¯»å–ååˆ é™¤ã€‚</li></ul><p>å¦‚æœè¦è¿è¡Œlogstashï¼Œè¯·åœ¨ç›®å½•&#x2F;home&#x2F;space&#x2F;Docker-compose&#x2F;ELK&#x2F;logstash&#x2F;logstash-7.3.1ä¸‹æ‰“å¼€å‘½ä»¤è¡Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">nohup</span> <span class="string">./bin/logstash</span> <span class="string">-f</span> <span class="string">config/logstash.conf</span> <span class="string">&amp;</span> <span class="comment"># è¯¥å‘½ä»¤æ˜¯æ— æ¡†æ¨¡å¼</span></span><br><span class="line"><span class="string">./bin/logstash</span> <span class="string">-f</span> <span class="string">config/logstash.conf</span> <span class="comment"># è¯¥å‘½ä»¤ä¼šæ˜¾ç¤ºè¿™ä¸ªlogstashçš„è¿è¡Œ</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹Logstashæ˜¯å¦å¯åŠ¨æˆåŠŸï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ps</span> <span class="string">-ef</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">logstash</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å‘½ä»¤æ€æ­»Logstashï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">kill</span> -9 logstashid</span><br></pre></td></tr></table></figure><p>è®¿é—®<a href="http://localhost:5601å³å¯ï¼Œç™»å½•KibanaæŸ¥çœ‹æ˜¯å¦æˆåŠŸï¼Œè¾“å…¥ä¹‹å‰é…ç½®ä¸­é…ç½®çš„è´¦å·å’Œå¯†ç ï¼›">http://localhost:5601å³å¯ï¼Œç™»å½•KibanaæŸ¥çœ‹æ˜¯å¦æˆåŠŸï¼Œè¾“å…¥ä¹‹å‰é…ç½®ä¸­é…ç½®çš„è´¦å·å’Œå¯†ç ï¼›</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924380.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924861.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924649.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924835.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924088.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924791.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924263.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924241.png" alt="img"></p><p>å³å¯æŸ¥çœ‹æ—¥å¿—å†…å®¹ï¼ŒKibanaå…·ä½“å¦‚ä½•ä½¿ç”¨è¯·å‚è€ƒåšå®¢ï¼š<a href="https://blog.csdn.net/UbuntuTouch/article/details/122805096?ops_request_misc=&request_id=&biz_id=102&utm_term=Kibana%E4%BD%BF%E7%94%A8&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-2-122805096.142%5Ev100%5Epc_search_result_base1&spm=1018.2226.3001.4187">Kibanaï¼šKibana å…¥é—¨ ï¼ˆä¸€ï¼‰</a>ï¼›</p><p>æ•ˆæœå›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261924908.png" alt="img"></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/qq_25416531/article/details/133961415">ï¼ˆå®æˆ˜ï¼‰docker-composeéƒ¨ç½²åˆ†å¸ƒå¼æ—¥å¿—æ–¹æ¡ˆEFK(Elasticsearch+Fluentd+Kibana)</a>ï¼›</li><li><a href="https://blog.csdn.net/UbuntuTouch/article/details/122805096?ops_request_misc=&request_id=&biz_id=102&utm_term=Kibana%E4%BD%BF%E7%94%A8&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-2-122805096.142%5Ev100%5Epc_search_result_base1&spm=1018.2226.3001.4187">Kibanaï¼šKibana å…¥é—¨ ï¼ˆä¸€ï¼‰</a>ï¼›</li><li>[logstash è¾“å…¥å‹ç¼©æ–‡ä»¶ gzipç±»å‹](<a href="https://blog.csdn.net/kirrin/article/details/90478315?ops_request_misc=&request_id=&biz_id=102&utm_term=logstash">https://blog.csdn.net/kirrin/article/details/90478315?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=logstash</a> è¯»å–å‹ç¼©æ—¥å¿—æ–‡ä»¶&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2<del>all</del>sobaiduweb~default-4-90478315.142^v100^pc_search_result_base1&amp;spm&#x3D;1018.2226.3001.4187)ï¼›</li><li><a href="https://blog.csdn.net/sunchaos/article/details/112475405?spm=1001.2101.3001.6650.5&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-5-112475405-blog-90478315.235%5Ev43%5Econtrol&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-5-112475405-blog-90478315.235%5Ev43%5Econtrol&utm_relevant_index=10">Logstash 7.9 ä»gzipæ–‡ä»¶è¯»å–jsonä¹±ç é—®é¢˜çš„è§£å†³</a>ï¼›</li><li>[Linuxä¸‹å®‰è£…Logstash](<a href="https://blog.csdn.net/Amber_1/article/details/124315986?ops_request_misc=%7B%22request_id%22:%22171444816816800215071428%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171444816816800215071428&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-2-124315986-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=Linux">https://blog.csdn.net/Amber_1/article/details/124315986?ops_request_misc=%7B%22request%5Fid%22%3A%22171444816816800215071428%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=171444816816800215071428&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-2-124315986-null-null.142^v100^pc_search_result_base1&amp;utm_term=Linux</a> ä¸‹è½½ Logstash&amp;spm&#x3D;1018.2226.3001.4187)ï¼›</li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Java </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>10 IDEA</title>
      <link href="/2025/02/26/10%20IDEA/"/>
      <url>/2025/02/26/10%20IDEA/</url>
      
        <content type="html"><![CDATA[<h1 id="10-IDEA"><a href="#10-IDEA" class="headerlink" title="10 IDEA"></a>10 IDEA</h1><ol><li>è‡ªåŠ¨ç”Ÿæˆè¯•å·ç³»ç»Ÿ</li></ol>]]></content>
      
      
      <categories>
          
          <category> å…¶å®ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…¶å®ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>15 Nacos</title>
      <link href="/2025/02/26/15%20Nacos/"/>
      <url>/2025/02/26/15%20Nacos/</url>
      
        <content type="html"><![CDATA[<h1 id="15-Nacos"><a href="#15-Nacos" class="headerlink" title="15 Nacos"></a>15 Nacos</h1><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://blog.csdn.net/apple_69693064/article/details/127168147?ops_request_misc=%7B%22request_id%22:%22171507830316800213063783%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171507830316800213063783&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-127168147-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=nacos%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86&spm=1018.2226.3001.4187">ã€Nacosã€‘ä¸€æ–‡åˆ°åº• é…ç½®ç®¡ç†è¯¦è§£</a></li><li></li></ol><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>Nacosæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„æœåŠ¡æ³¨å†Œä¸­å¿ƒä»¥åŠé…ç½®ä¸­å¿ƒï¼Œè‡´åŠ›äºç»™å¼€å‘è€…æä¾›ä¸€æ¬¾ä¾¿æ·ã€ç®€å•ä¸Šæ‰‹çš„å¼€æºæ¡†æ¶ã€‚</p><p>NacosåŒ…å«äº†SpringCloudçš„æ³¨å†Œä¸­å¿ƒEurekaã€æœåŠ¡é…ç½®Configã€æœåŠ¡æ€»çº¿Busã€‚</p><p>Nacosæä¾›å››å¤§åŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯æœåŠ¡å‘ç°å’ŒæœåŠ¡å¥åº·ç›‘æµ‹ã€åŠ¨æ€é…ç½®æœåŠ¡ã€åŠ¨æ€DNSæœåŠ¡ã€æœåŠ¡åŠå…¶å…ƒæ•°æ®ç®¡ç†ã€‚</p><h1 id="é…ç½®ç®¡ç†"><a href="#é…ç½®ç®¡ç†" class="headerlink" title="é…ç½®ç®¡ç†"></a>é…ç½®ç®¡ç†</h1><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261927834.png" alt="img"></p><p>æ³¨æ„ï¼šé¡¹ç›®çš„æ ¸å¿ƒé…ç½®ï¼Œéœ€è¦çƒ­æ›´æ–°çš„é…ç½®æ‰æœ‰æ”¾åˆ°nacosç®¡ç†çš„å¿…è¦ã€‚åŸºæœ¬ä¸ä¼šå˜æ›´çš„ä¸€äº›é…ç½®è¿˜æ˜¯ä¿å­˜åœ¨å¾®æœåŠ¡æœ¬åœ°æ¯”è¾ƒå¥½ã€‚</p><p>é…ç½®å­˜åœ¨ä¼˜å…ˆçº§ï¼›</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261927242.png" alt="img"></p><p>ä¿®æ”¹nacosä¸­çš„é…ç½®åï¼Œå¾®æœåŠ¡ä¸­<code>æ— éœ€é‡å¯å³</code>å¯è®©é…ç½®ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯<strong>é…ç½®çƒ­æ›´æ–°</strong>ã€‚</p><p>ä¸€èˆ¬åœ¨nacosä¸­é…ç½®çš„æ˜¯å¯èƒ½ä¼šå˜æ›´çš„ï¼Œè€Œåœ¨æœ¬åœ°çš„é…ç½®ä¸­ä¸€èˆ¬ä¹¦å†™ä¸ä¼šå˜æ›´çš„é…ç½®ã€‚</p><h1 id="ç¯å¢ƒéš”ç¦»"><a href="#ç¯å¢ƒéš”ç¦»" class="headerlink" title="ç¯å¢ƒéš”ç¦»"></a>ç¯å¢ƒéš”ç¦»</h1><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261927887.png" alt="img"></p><p>åˆ›å»ºå‘½åç©ºé—´</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261927854.png" alt="img"></p><p>åˆ›å»ºé…ç½®ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261927182.png" alt="img"></p><p>è¯»å–é…ç½®ä¿¡æ¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-service</span></span><br><span class="line"><span class="comment">#  profiles:</span></span><br><span class="line"><span class="comment">#    active: test # æŒ‡å®šç¯å¢ƒ</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos é…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span>  <span class="comment"># æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">f81a11fe-73f4-4dff-b70d-04009fa36710</span> <span class="comment"># æŒ‡å®šnamespaceçš„id</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span> <span class="comment"># æŒ‡å®šç»„å</span></span><br></pre></td></tr></table></figure><h1 id="Nacosé›†ç¾¤"><a href="#Nacosé›†ç¾¤" class="headerlink" title="Nacosé›†ç¾¤"></a>Nacosé›†ç¾¤</h1><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261927399.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Nacos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>08 Maven</title>
      <link href="/2025/02/26/08%20Maven/"/>
      <url>/2025/02/26/08%20Maven/</url>
      
        <content type="html"><![CDATA[<h1 id="08-Maven"><a href="#08-Maven" class="headerlink" title="08 Maven"></a>08 Maven</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/weixin_43477531/article/details/125164271?ops_request_misc=%7B%22request_id%22:%22171444811716800188590781%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171444811716800188590781&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-125164271-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=maven&spm=1018.2226.3001.4187">è¶…çº§è¯¦ç»†çš„ Maven æ•™ç¨‹ï¼ˆåŸºç¡€+é«˜çº§ï¼‰</a>ï¼›</li><li><a href="https://blog.csdn.net/weixin_43740223/article/details/114253461">Maven æœ€è¯¦ç»†çš„settings.xml é…ç½®æ–‡ä»¶è§£é‡Š</a>ï¼›</li><li></li></ol><h2 id="Mavenæ˜¯ä»€ä¹ˆ"><a href="#Mavenæ˜¯ä»€ä¹ˆ" class="headerlink" title="Mavenæ˜¯ä»€ä¹ˆ"></a>Mavenæ˜¯ä»€ä¹ˆ</h2><p>Maven æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šç»„ç»‡ç»´æŠ¤çš„ä¸€æ¬¾ä¸“é—¨ä¸º Java é¡¹ç›®æä¾›æ„å»ºå’Œä¾èµ–ç®¡ç†æ”¯æŒçš„å·¥å…·ã€‚</p><p>ä¸€ä¸ª Maven å·¥ç¨‹æœ‰çº¦å®šçš„ç›®å½•ç»“æ„ï¼Œçº¦å®šçš„ç›®å½•ç»“æ„å¯¹äº Maven å®ç°è‡ªåŠ¨åŒ–æ„å»ºè€Œè¨€æ˜¯å¿…ä¸å¯å°‘çš„ä¸€ç¯ï¼Œå°±æ‹¿è‡ªåŠ¨ç¼–è¯‘æ¥è¯´ï¼ŒMaven å¿…é¡» èƒ½æ‰¾åˆ° Java æºæ–‡ä»¶ï¼Œä¸‹ä¸€æ­¥æ‰èƒ½ç¼–è¯‘ï¼Œè€Œç¼–è¯‘ä¹‹åä¹Ÿå¿…é¡»æœ‰ä¸€ä¸ªå‡†ç¡®çš„ä½ç½®ä¿æŒç¼–è¯‘å¾—åˆ°çš„å­—èŠ‚ç æ–‡ä»¶ã€‚ </p><p>å¦‚æœåœ¨å¼€å‘ä¸­å¦‚æœéœ€è¦è®©ç¬¬ä¸‰æ–¹çš„å·¥å…·æˆ–è€…æ¡†æ¶çŸ¥é“æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„èµ„æºåœ¨å“ªï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå°±æ˜¯ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>é€šè¿‡é…ç½®çš„å½¢å¼æ˜ç¡®å‘Šè¯‰å®ƒ</li><li>åŸºäºç¬¬ä¸‰æ–¹å·¥å…·æˆ–æ¡†æ¶çš„çº¦å®š Maven å¯¹å·¥ç¨‹ç›®å½•ç»“æ„çš„è¦æ±‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261923997.png" alt="img"></p><h3 id="æ„å»ºç¯èŠ‚"><a href="#æ„å»ºç¯èŠ‚" class="headerlink" title="æ„å»ºç¯èŠ‚"></a>æ„å»ºç¯èŠ‚</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261923907.png" alt="img"></p><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><p>åœ¨Mavenä¸­ï¼Œä¾èµ–ï¼ˆDependenciesï¼‰æ˜¯æŒ‡é¡¹ç›®æ‰€ä¾èµ–çš„å¤–éƒ¨åº“ã€æ¨¡å—æˆ–è€…å…¶ä»–é¡¹ç›®ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ çš„é¡¹ç›®éœ€è¦å¼•ç”¨å…¶ä»–ä»£ç åº“æˆ–è€…æ¨¡å—æä¾›çš„åŠŸèƒ½æ—¶ï¼Œä½ å¯ä»¥å°†è¿™äº›å¤–éƒ¨èµ„æºå£°æ˜ä¸ºä½ é¡¹ç›®çš„ä¾èµ–ã€‚ä¾èµ–ç®¡ç†æ˜¯Mavençš„ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œå®ƒå¸®åŠ©ä½ è½»æ¾åœ°ç®¡ç†é¡¹ç›®æ‰€éœ€çš„å„ç§å¤–éƒ¨èµ„æºã€‚</p><p>Mavenä½¿ç”¨ä¸€ç§å«åšåæ ‡ï¼ˆCoordinatesï¼‰çš„æ–¹å¼æ¥å”¯ä¸€æ ‡è¯†æ¯ä¸ªä¾èµ–é¡¹ã€‚è¿™ä¸ªåæ ‡é€šå¸¸åŒ…æ‹¬ç»„ç»‡ï¼ˆGroupï¼‰ã€åç§°ï¼ˆArtifactï¼‰å’Œç‰ˆæœ¬ï¼ˆVersionï¼‰ä¸‰ä¸ªéƒ¨åˆ†ã€‚ç»„ç»‡æ ‡è¯†äº†åº“çš„æ‰€å±ç»„ç»‡æˆ–è€…é¡¹ç›®ï¼Œåç§°åˆ™æ ‡è¯†äº†å…·ä½“çš„åº“æˆ–è€…é¡¹ç›®åç§°ï¼Œç‰ˆæœ¬åˆ™æŒ‡æ˜äº†åº“æˆ–è€…é¡¹ç›®çš„å…·ä½“ç‰ˆæœ¬å·ã€‚</p><p>å°±å¥½æ¯”é£Ÿè°±ï¼Œä¸Šé¢è®°å½•ç€ä½ è¿™èœéœ€è¦çš„æ‰€æœ‰åŸææ–™ï¼Œææ–™æ˜¯ä»€ä¹ˆï¼Œæ¥è‡ªå“ªé‡Œçš„ï¼Œéœ€è¦ä»€ä¹ˆæ—¶æœŸçš„ï¼Œéƒ½ä¼šè®°å½•åœ¨ä¸Šé¢ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261923377.png" alt="img"></p><p>åœ¨æœ‰äº›æ—¶å€™Aä¾èµ–Bï¼ŒBä¾èµ–Cï¼Œè€Œä¸”Cå¯ä»¥ä¼ é€’åˆ°Açš„æ—¶å€™ï¼Œä½†æ˜¯Aä¸æƒ³è¦Cï¼Œè¿™æ—¶å€™å°±æƒ³æŠŠCæ’é™¤åœ¨å¤–é¢ã€‚</p><p>ä¸€èˆ¬ä½¿ç”¨excludesæ ‡ç­¾é…ç½®ä¾èµ–çš„æ’é™¤ï¼š</p><blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.javatv.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>auth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- ä½¿ç”¨excludesæ ‡ç­¾é…ç½®ä¾èµ–çš„æ’é™¤        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- åœ¨excludeæ ‡ç­¾ä¸­é…ç½®ä¸€ä¸ªå…·ä½“çš„æ’é™¤ --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- æŒ‡å®šè¦æ’é™¤çš„ä¾èµ–çš„åæ ‡ï¼ˆä¸éœ€è¦å†™versionï¼‰ --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="æœ¬åœ°ä»“åº“"><a href="#æœ¬åœ°ä»“åº“" class="headerlink" title="æœ¬åœ°ä»“åº“"></a>æœ¬åœ°ä»“åº“</h2><p>ä¸‹è½½å¥½Mavenåï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾æˆ‘ä»¬ä¸‹è½½åˆ°æœ¬åœ°çš„æ‰€æœ‰èœå•ã€‚ç„¶åæˆ‘ä»¬éœ€è¦åœ¨settingæ–‡ä»¶ä¸­æŒ‡å®šæœ¬åœ°ä»“åº“çš„ä½ç½®ï¼Œä»¥ä¾¿è®©Mavneå¯ä»¥æ‰¾åˆ°æœ¬åœ°ä»“åº“ã€‚è¿™æ ·Mavenå°±ä¼šå°†ä¸‹è½½å¥½çš„ä¾èµ–å­˜æ”¾åœ¨æœ¬åœ°ä»“åº“ä¸­åŒæ—¶éœ€è¦ä¾èµ–çš„æ—¶å€™ä¹Ÿä¼šä»æœ¬åœ°ä»“åº“ä¸­å¯»æ‰¾ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦é‡ç‚¹ä»‹ç»ä¸€ä¸‹åˆšåˆšæåˆ°çš„mavençš„settingæ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬æ‰¾åˆ°settingæ–‡ä»¶ï¼Œå¯ä»¥å‘ç°å…¶æ–‡ä»¶ç±»å‹æ˜¯xmlï¼Œå³ä¸ºé…ç½®æ–‡ä»¶ã€‚é‚£ä¹ˆè¯¥é…ç½®æ–‡ä»¶ä¼šä¸ºmavené…ç½®ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚æœ¬åœ°ä»“åº“çš„åœ°å€ã€‚</p><h2 id="Mavençš„ä½¿ç”¨"><a href="#Mavençš„ä½¿ç”¨" class="headerlink" title="Mavençš„ä½¿ç”¨"></a>Mavençš„ä½¿ç”¨</h2><p>ä¹‹å‰æˆ‘ä»¬ä»‹ç»äº†åˆ°äº†ï¼Œmavenä¼šæ ¹æ®èœå•ï¼ˆpomï¼‰æ–‡ä»¶å»èœå¸‚åœºï¼ˆä¸­å¤®ä»“åº“ï¼‰æ‰¾åˆ°éœ€è¦çš„ä¸œè¥¿ã€‚ä½†æ˜¯ä¸­å¤®ä»“åº“å¾ˆå¤šï¼Œä¸œè¥¿å¾ˆå¤šï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æ‰¾åˆ°æˆ‘ä»¬æœ€éœ€è¦çš„é‚£ä¸ªç‰©å“å‘¢ï¼Ÿ</p><p>è¿™é‡Œå°±å¼•å…¥äº†åæ ‡çš„æ¦‚å¿µï¼Œä¸–ç•Œæ˜¯ä¸‰ç»´çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ä¸‰ä¸ªåæ ‡ç‚¹æ¥ç¡®å®šä¸€ä¸ªå…·ä½“ä½ç½®ã€‚é‚£ä¹ˆå¯¹äºmavenæ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡åœ¨mavenä¸–ç•Œé‡Œä¸æ˜¯xyzè€Œæ˜¯groupIdã€artfactIdå’Œversionã€‚</p><ol><li>groupIdï¼šå…¬å¸æˆ–ç»„ç»‡çš„idï¼Œä¾‹å¦‚ï¼šcom.javatv.mavenï¼›</li><li>artfactIdï¼šä¸€ä¸ªé¡¹ç›®æˆ–è€…æ˜¯é¡¹ç›®ä¸­çš„ä¸€ä¸ªæ¨¡å—çš„ idï¼Œå³æ¨¡å—çš„åç§°ï¼Œå°†æ¥ä½œä¸º Maven å·¥ç¨‹çš„å·¥ç¨‹åï¼›</li><li><strong>version</strong>ï¼šç‰ˆæœ¬å·ã€‚</li></ol><h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><p>Mavenå·¥ç¨‹ç›´æ¥å­˜åœ¨ç»§æ‰¿çš„å…³ç³»ï¼Œæ¯”å¦‚Aå·¥ç¨‹ç»§æ‰¿Bå·¥ç¨‹ï¼Œé‚£ä¹ˆBå·¥ç¨‹å°±æ˜¯çˆ¶å·¥ç¨‹ï¼ŒAå·¥ç¨‹å°±æ˜¯å­å·¥ç¨‹ã€‚ä½†æ˜¯è¿™æ ·æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261923436.png" alt="img"></p><h3 id="dependencies-ä¸-dependencyManagement-çš„åŒºåˆ«"><a href="#dependencies-ä¸-dependencyManagement-çš„åŒºåˆ«" class="headerlink" title="dependencies ä¸ dependencyManagement çš„åŒºåˆ«"></a>dependencies ä¸ dependencyManagement çš„åŒºåˆ«</h3><ol><li>çˆ¶æ¨¡å— <dependencies></dependencies> ä¸­å®šä¹‰çš„æ‰€æœ‰ä¾èµ–ï¼Œåœ¨å­é¡¹ç›®ä¸­éƒ½ä¼šç›´æ¥ç»§æ‰¿ï¼›</li><li>åœ¨çˆ¶æ¨¡å— <dependencyManagement></dependencyManagement> ä¸­å®šä¹‰çš„æ‰€æœ‰ä¾èµ–ï¼Œå­é¡¹ç›®å¹¶ä¸ä¼šç»§æ‰¿ï¼Œæˆ‘ä»¬è¿˜è¦åœ¨å­é¡¹ç›®ä¸­å¼•å…¥æˆ‘ä»¬éœ€è¦çš„ä¾èµ–ï¼Œæ‰èƒ½è¿›è¡Œä½¿ç”¨ã€‚æ­¤æ—¶æˆ‘ä»¬åœ¨å­é¡¹ç›®ä¸­ä¸ç”¨è®¾ç½®ç‰ˆæœ¬ã€‚</li></ol><p>æ³¨æ„ï¼š</p><p>ï¼ˆ1ï¼‰å­æ¨¡å—ç»§æ‰¿çš„çˆ¶æ¨¡å—çš„ä¾èµ–&#x2F;å­æ¨¡å—å£°æ˜çš„ä¾èµ–ï¼Œå¦‚æœåœ¨å­æ¨¡å—ä¸­æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œåœ¨å­æ¨¡å—å•ç‹¬æ‰“åŒ…æ—¶ï¼Œå°±ä¸ä¼šè¢«æ‰“å…¥ jar ï¼›</p><p>ï¼ˆ2ï¼‰maven æ‰“åŒ…åŠ å…¥çš„ä¾èµ–ä»£ç æ˜¯è¢«è°ƒç”¨åˆ°çš„éƒ¨åˆ†ä»£ç ï¼Œæ²¡æœ‰è¢«è°ƒç”¨åˆ°çš„ä¾èµ–ä»£ç ä¸ä¼šè¢«åŠ å…¥æ‰“åŒ…åçš„ jar åŒ…ä¸­ã€‚</p><h3 id="çˆ¶POMè®¾ç½®"><a href="#çˆ¶POMè®¾ç½®" class="headerlink" title="çˆ¶POMè®¾ç½®"></a>çˆ¶POMè®¾ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- çˆ¶POM --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰çˆ¶POMçš„åŸºæœ¬ä¿¡æ¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parent-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span> <span class="comment">&lt;!-- ä½¿ç”¨pomæ‰“åŒ…ç±»å‹ --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰çˆ¶POMçš„ä¾èµ–ç®¡ç† --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¿™é‡Œå¯ä»¥å®šä¹‰é€šç”¨çš„ä¾èµ–ç‰ˆæœ¬ --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä¾‹å¦‚ï¼šSpring Bootç‰ˆæœ¬ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å…¶ä»–ä¾èµ–ç‰ˆæœ¬ç®¡ç† --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å­POMé…ç½®"><a href="#å­POMé…ç½®" class="headerlink" title="å­POMé…ç½®"></a>å­POMé…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å­POM --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥çˆ¶POM --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parent-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰å­POMçš„åŸºæœ¬ä¿¡æ¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>child-module<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- å­POMçš„å…·ä½“é…ç½®å’Œä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä¾‹å¦‚ï¼šSpring Boot Starter Web --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å…¶ä»–ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Maven-Setting-xmlæ–‡ä»¶é…ç½®"><a href="#Maven-Setting-xmlæ–‡ä»¶é…ç½®" class="headerlink" title="Maven Setting.xmlæ–‡ä»¶é…ç½®"></a>Maven Setting.xmlæ–‡ä»¶é…ç½®</h2>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>13 RPC</title>
      <link href="/2025/02/26/13%20RPC/"/>
      <url>/2025/02/26/13%20RPC/</url>
      
        <content type="html"><![CDATA[<h1 id="13-RPC"><a href="#13-RPC" class="headerlink" title="13 RPC"></a>13 RPC</h1><h2 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h2><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul><li><a href="https://www.cnblogs.com/junjiang3/p/9096895.html">Java å¼€å‘ gRPC æœåŠ¡å’Œå®¢æˆ·ç«¯</a></li><li><a href="https://zhuanlan.zhihu.com/p/363672930#GeneratedCaptionsTabForHeroSec">èŠèŠä»€ä¹ˆæ˜¯gRPC</a></li><li><a href="https://blog.csdn.net/qq_42046105/article/details/126396944?ops_request_misc=%7B%22request_id%22:%22171505794416800215041301%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171505794416800215041301&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-126396944-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=gRPC&spm=1018.2226.3001.4187">gRPCï¼šä¸€ä¸ªæ€§èƒ½å¼ºåˆ°çˆ†çš„RPCæ¡†æ¶</a></li><li><strong><a href="https://www.cnblogs.com/zhongyuanzhao000/p/13783165.html">gRPCä¹‹javaè¯­è¨€çš„ç®€å•Demo</a></strong></li><li><strong><a href="https://www.cnblogs.com/songgj/p/13463717.html">gRPCæ¡†æ¶è¯¦è§£ </a></strong></li><li><a href="https://blog.csdn.net/weixin_45404884/article/details/137697450">Dubboï¼ˆä»å…¥é—¨åˆ°æŒæ¡ï¼‰çœ‹å®Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></li><li></li></ul><p>è¦æƒ³äº†è§£ä»€ä¹ˆæ˜¯gRPCï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯RPCã€‚</p><h3 id="ä»€ä¹ˆæ˜¯RPC"><a href="#ä»€ä¹ˆæ˜¯RPC" class="headerlink" title="ä»€ä¹ˆæ˜¯RPC"></a>ä»€ä¹ˆæ˜¯RPC</h3><p>RPCï¼ˆRemote Procedure Call Protocolï¼‰<strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®</strong>ï¼Œç›®æ ‡å°±æ˜¯è®©è¿œç¨‹æœåŠ¡è°ƒç”¨æ›´åŠ ç®€å•ã€é€æ˜ã€‚</p><p>RPCå¯ä»¥ç†è§£æˆä¸ºäº†å®ç°ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261925013.png" alt="img"></p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦ç”¨RPC"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ç”¨RPC" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ç”¨RPC"></a>ä¸ºä»€ä¹ˆéœ€è¦ç”¨RPC</h3><p>å½“ä¸šåŠ¡è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œè¿™æ—¶å€™éœ€è¦å°†å…¬å…±çš„ä¸šåŠ¡é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„serviceæœåŠ¡ï¼Œæ‰€ä»¥è¿™æ—¶å€™éœ€è¦ä¸€ç§èƒ½å¤Ÿåœ¨ä¸åŒå¾®æœåŠ¡è¿›è¡Œé€šä¿¡æˆ–è€…è¯´ä¸åŒè¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡çš„æ–¹å¼ï¼Œè¿™å°±æ˜¯RPCã€‚</p><h3 id="RPCå’ŒHTTPåŒºåˆ«"><a href="#RPCå’ŒHTTPåŒºåˆ«" class="headerlink" title="RPCå’ŒHTTPåŒºåˆ«"></a><strong>RPCå’ŒHTTPåŒºåˆ«</strong></h3><p>ã€€ã€€ã€€ã€€RPC å’Œ HTTPéƒ½æ˜¯å¾®æœåŠ¡é—´é€šä¿¡è¾ƒä¸ºå¸¸ç”¨çš„æ–¹æ¡ˆä¹‹ä¸€ï¼Œå…¶å®RPC å’Œ HTTP å¹¶ä¸å®Œå…¨æ˜¯åŒä¸€ä¸ªå±‚æ¬¡çš„æ¦‚å¿µï¼Œå®ƒä»¬ä¹‹é—´è¿˜æ˜¯æœ‰æ‰€åŒºåˆ«çš„ã€‚</p><p>ã€€ã€€ã€€ã€€ 1. RPC æ˜¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå…¶è°ƒç”¨åè®®é€šå¸¸åŒ…æ‹¬<strong>åºåˆ—åŒ–åè®®</strong>å’Œ<strong>ä¼ è¾“åè®®</strong>ã€‚åºåˆ—åŒ–åè®®æœ‰åŸºäºçº¯æ–‡æœ¬çš„ XML å’Œ JSONã€äºŒè¿›åˆ¶ç¼–ç çš„Protobufå’ŒHessianã€‚ä¼ è¾“åè®®æ˜¯æŒ‡å…¶åº•å±‚ç½‘ç»œä¼ è¾“æ‰€ä½¿ç”¨çš„åè®®ï¼Œæ¯”å¦‚ TCPã€HTTPã€‚</p><p>ã€€ã€€ã€€ã€€ 2. å¯ä»¥çœ‹å‡ºHTTPæ˜¯RPCçš„ä¼ è¾“åè®®çš„ä¸€ä¸ªå¯é€‰æ–¹æ¡ˆï¼Œæ¯”å¦‚è¯´ gRPC çš„ç½‘ç»œä¼ è¾“åè®®å°±æ˜¯ HTTPã€‚HTTP æ—¢å¯ä»¥å’Œ RPC ä¸€æ ·ä½œä¸ºæœåŠ¡é—´é€šä¿¡çš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥ä½œä¸º RPC ä¸­é€šä¿¡å±‚çš„ä¼ è¾“åè®®ï¼ˆæ­¤æ—¶ä¸ä¹‹å¯¹æ¯”çš„æ˜¯ TCP åè®®ï¼‰ã€‚</p><h3 id="RPCå¸¸ç”¨æ¡†æ¶"><a href="#RPCå¸¸ç”¨æ¡†æ¶" class="headerlink" title="RPCå¸¸ç”¨æ¡†æ¶"></a>RPCå¸¸ç”¨æ¡†æ¶</h3><ol><li><strong>gRPCï¼š</strong> ç”±Googleå¼€å‘çš„é«˜æ€§èƒ½ã€è·¨è¯­è¨€çš„RPCæ¡†æ¶ï¼ŒåŸºäºHTTP&#x2F;2å’ŒProtocol Buffersï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬Cã€C++ã€Javaã€Goã€Pythonç­‰ã€‚</li><li><strong>Apache Thriftï¼š</strong> ç”±Facebookå¼€å‘çš„è·¨è¯­è¨€çš„RPCæ¡†æ¶ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬C++ã€Javaã€Pythonã€PHPç­‰ï¼Œæä¾›äº†ä¸°å¯Œçš„æ•°æ®ç±»å‹å’Œåºåˆ—åŒ–åè®®æ”¯æŒã€‚</li><li><strong>Apache Dubboï¼š</strong> ç”±é˜¿é‡Œå·´å·´å¼€å‘çš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼Œæ”¯æŒé«˜æ€§èƒ½çš„RPCè°ƒç”¨å’ŒæœåŠ¡æ²»ç†ï¼Œæä¾›äº†çµæ´»çš„é…ç½®å’Œæ‰©å±•æœºåˆ¶ï¼Œä¸»è¦ç”¨äºJavaåº”ç”¨ã€‚</li><li><strong>Thrift RPCï¼š</strong> æ˜¯Apache Thriftæ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œä¸“æ³¨äºæä¾›è·¨è¯­è¨€çš„RPCæ”¯æŒï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’Œå¤šç§ä¼ è¾“åè®®ã€‚</li><li><strong>RESTful APIï¼š</strong> è™½ç„¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„RPCæ¡†æ¶ï¼Œä½†RESTful APIä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„è¿œç¨‹è°ƒç”¨æ–¹å¼ï¼Œé€šè¿‡HTTPåè®®è¿›è¡Œé€šä¿¡ï¼Œä½¿ç”¨æ ‡å‡†çš„HTTPæ–¹æ³•ï¼ˆå¦‚GETã€POSTã€PUTã€DELETEï¼‰æ¥æ“ä½œèµ„æºã€‚</li><li><strong>Spring Cloudï¼š</strong> æ˜¯ä¸€ä¸ªåŸºäºSpring Bootçš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·ï¼Œæä¾›äº†ä¸°å¯Œçš„å¾®æœåŠ¡ç»„ä»¶å’Œé€šä¿¡æ¡†æ¶ï¼ŒåŒ…æ‹¬RPCè°ƒç”¨ã€æœåŠ¡æ³¨å†Œä¸å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚</li><li><strong>ZeroMQï¼š</strong> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„æ¶ˆæ¯ä¼ é€’åº“ï¼Œæ”¯æŒå¤šç§æ¶ˆæ¯ä¼ è¾“æ¨¡å¼ï¼ŒåŒ…æ‹¬è¯·æ±‚-åº”ç­”æ¨¡å¼ï¼Œå¯ä»¥ç”¨äºæ„å»ºç®€å•çš„RPCç³»ç»Ÿã€‚</li><li><strong>RPyCï¼ˆRemote Python Callï¼‰ï¼š</strong> æ˜¯ä¸€ä¸ªè½»é‡çº§çš„Python RPCæ¡†æ¶ï¼Œæ”¯æŒåœ¨Pythonä¸­å®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚</li></ol><p>åƒè¿™ç§è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œä¹‹å‰äº†è§£å­¦ä¹ è¿‡Feignï¼Œé‚£ä¹ˆFeignæ˜¯RPCæ¡†æ¶å—ï¼Ÿ</p><blockquote><p>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ HTTP å®¢æˆ·ç«¯æ¡†æ¶ï¼Œé€šå¸¸ä¸ Spring Cloud ç­‰å¾®æœåŠ¡æ¡†æ¶ä¸€èµ·ä½¿ç”¨ã€‚è™½ç„¶ Feign æœ¬èº«å¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ RPC æ¡†æ¶ï¼Œä½†å®ƒå¯ä»¥è¢«ç”¨äºå®ç°è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œå› æ­¤åœ¨æŸç§ç¨‹åº¦ä¸Šä¹Ÿå¯ä»¥è¢«è§†ä¸ºä¸€ç§ RPC çš„å®ç°æ–¹å¼ã€‚</p><p>Feign çš„ä¸»è¦ä½œç”¨æ˜¯ç®€åŒ–æœåŠ¡é—´çš„ HTTP è°ƒç”¨ï¼Œé€šè¿‡å®šä¹‰æ¥å£å’Œæ³¨è§£çš„æ–¹å¼ï¼Œè®©å¼€å‘è€…å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ HTTP è¯·æ±‚å’Œå¤„ç†ä»£ç ã€‚Feign è¿˜æ”¯æŒè´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°ç­‰åŠŸèƒ½ï¼Œä½¿å¾—æœåŠ¡è°ƒç”¨æ›´åŠ æ–¹ä¾¿å’Œçµæ´»ã€‚</p><p>è™½ç„¶ Feign åœ¨å®ç°ä¸Šæ›´å€¾å‘äºåŸºäº HTTP çš„æœåŠ¡è°ƒç”¨ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„ RPC è°ƒç”¨ï¼Œä½†åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå®ƒç»å¸¸è¢«ç”¨æ¥å®ç°æœåŠ¡é—´çš„è¿œç¨‹è°ƒç”¨ï¼Œå› æ­¤å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§è½»é‡çº§çš„ RPC æ¡†æ¶ã€‚</p></blockquote><h3 id="RPCçš„è°ƒç”¨æµç¨‹"><a href="#RPCçš„è°ƒç”¨æµç¨‹" class="headerlink" title="RPCçš„è°ƒç”¨æµç¨‹"></a>RPCçš„è°ƒç”¨æµç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261925268.png" alt="img"></p><ol><li>å®¢æˆ·ç«¯ä¹Ÿå°±æ˜¯æœåŠ¡æ¶ˆè´¹æ–¹ä»¥æœ¬åœ°æ–¹å¼è°ƒç”¨æœåŠ¡ï¼›</li><li>Client Stubï¼ˆæœåŠ¡ç«¯æœ¬åœ°çš„ï¼‰æ¥å—åˆ°è°ƒç”¨åè´Ÿè´£æŠŠæ–¹æ³•å’Œå‚æ•°ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼›</li><li>æ¥ä¸‹æ¥Client Stubéœ€è¦åœ¨å…¶æ‰¾åˆ°è¯¥æœåŠ¡çš„åœ°å€ï¼Œç„¶åå°†åˆšåˆšç»„è£…çš„æ¶ˆæ¯ä½“å‘é€ç»™è¿™ä¸ªæœåŠ¡ï¼›</li><li>åŒæ­¥çš„Server Stubæ”¶åˆ°åˆšåˆšå‘é€æ¥çš„è¿™ä¸ªæ¶ˆæ¯ï¼Œç„¶åè¿›è¡Œè§£ç ï¼›</li><li>Server Stubæ ¹æ®ç¼–ç ç»“æœå®‰æ’å…¶æœ¬åœ°çš„æœåŠ¡è°ƒç”¨ï¼›</li><li>æœ¬åœ°çš„Serverå¼€å§‹æ‰§è¡Œï¼Œå¾—åˆ°ç»“æœåå°†è¿™ä¸ªç»“æœè¿”å›ç»™Server Stubï¼›</li><li>åŒæ ·çš„è¿™æ—¶å€™çš„Server Stubä¹Ÿè·ŸClient Stubä¸€æ ·ï¼Œå°†è¿™ä¸ªç»“æœæ¶ˆæ¯ç»„è£…ç„¶åå‘é€ç»™åˆšåˆšå‘æ¥çš„æ¶ˆè´¹ç«¯ï¼›</li><li>Client Stubè¿›è¡Œè§£ç ï¼›</li><li>æœåŠ¡ç«¯å¾—åˆ°æœ€åçš„ç»“æœã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261925862.png" alt="img"></p><p>RPCå°±æ˜¯å°†è¿™äº›å†…éƒ¨çš„æ“ä½œè¿›è¡Œå°è£…ï¼Œè®©ç”¨æˆ·æ— éœ€å…³æ³¨è¿™äº›ç»†èŠ‚ã€‚</p><h2 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h2><p>å½“ç„¶ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥ä»‹ç»Feignçš„ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªæœåŠ¡å°†ä½¿ç”¨Feignå®¢æˆ·ç«¯æ¥è°ƒç”¨å¦ä¸€ä¸ªæœåŠ¡çš„RESTful APIã€‚</p><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>ç¡®ä¿ä½ çš„å¼€å‘ç¯å¢ƒä¸­å®‰è£…äº†ä»¥ä¸‹å·¥å…·ï¼š</p><ul><li>Java 8æˆ–æ›´é«˜ç‰ˆæœ¬</li><li>Maven</li><li>Spring Boot</li></ul><h3 id="æ­¥éª¤1ï¼šåˆ›å»ºæœåŠ¡æä¾›è€…"><a href="#æ­¥éª¤1ï¼šåˆ›å»ºæœåŠ¡æä¾›è€…" class="headerlink" title="æ­¥éª¤1ï¼šåˆ›å»ºæœåŠ¡æä¾›è€…"></a>æ­¥éª¤1ï¼šåˆ›å»ºæœåŠ¡æä¾›è€…</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡æä¾›è€…ï¼Œå®ƒå°†æä¾›ä¸€ä¸ªRESTful APIã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ªæ–°çš„Spring Booté¡¹ç›®ï¼Œä¾‹å¦‚å‘½åä¸º<code>service-provider</code>ã€‚</li><li>æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼Œå¦‚<code>Spring Boot Web</code>ã€‚</li><li>åˆ›å»ºä¸€ä¸ªç®€å•çš„RESTæ§åˆ¶å™¨ï¼Œä¾‹å¦‚ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// service-provider/src/main/java/com/example/ServiceProviderApplication.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceProviderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ServiceProviderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// service-provider/src/main/java/com/example/controller/HelloController.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello from Service Provider!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤2ï¼šåˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…"><a href="#æ­¥éª¤2ï¼šåˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="æ­¥éª¤2ï¼šåˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…"></a>æ­¥éª¤2ï¼šåˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæœåŠ¡æ¶ˆè´¹è€…ï¼Œå®ƒå°†ä½¿ç”¨Feignå®¢æˆ·ç«¯æ¥è°ƒç”¨æœåŠ¡æä¾›è€…çš„APIã€‚</p><ol><li>åˆ›å»ºå¦ä¸€ä¸ªSpring Booté¡¹ç›®ï¼Œä¾‹å¦‚å‘½åä¸º<code>service-consumer</code>ã€‚</li><li>æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼ŒåŒ…æ‹¬<code>Spring Boot Web</code>å’Œ<code>Spring Cloud OpenFeign</code>ã€‚</li></ol><p>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>å¯ç”¨Feignå®¢æˆ·ç«¯ï¼Œåœ¨ä¸»åº”ç”¨ç±»ä¸Šæ·»åŠ <code>@EnableFeignClients</code>æ³¨è§£ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// service-consumer/src/main/java/com/example/ServiceConsumerApplication.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceConsumerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ServiceConsumerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åˆ›å»ºä¸€ä¸ªFeignå®¢æˆ·ç«¯æ¥å£ï¼Œç”¨äºå®šä¹‰è¦è°ƒç”¨çš„æœåŠ¡æä¾›è€…çš„APIï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// service-consumer/src/main/java/com/example/client/HelloClient.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;service-provider&quot;, url = &quot;http://localhost:8080&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HelloClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    String <span class="title function_">sayHello</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åœ¨æœåŠ¡æ¶ˆè´¹è€…ä¸­ä½¿ç”¨Feignå®¢æˆ·ç«¯ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// service-consumer/src/main/java/com/example/controller/ConsumerController.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HelloClient helloClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consume&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">consumeHello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> helloClient.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œç¤ºä¾‹"><a href="#è¿è¡Œç¤ºä¾‹" class="headerlink" title="è¿è¡Œç¤ºä¾‹"></a>è¿è¡Œç¤ºä¾‹</h3><ol><li>å¯åŠ¨<code>service-provider</code>æœåŠ¡ã€‚</li><li>å¯åŠ¨<code>service-consumer</code>æœåŠ¡ã€‚</li><li>è®¿é—®<code>http://localhost:8081/consume</code>ï¼ˆå‡è®¾<code>service-consumer</code>è¿è¡Œåœ¨8081ç«¯å£ï¼‰ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ä»<code>service-provider</code>è¿”å›çš„é—®å€™ä¿¡æ¯ã€‚</li></ol><p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Feignå®¢æˆ·ç«¯æ¥ç®€åŒ–æœåŠ¡é—´çš„HTTPé€šä¿¡ã€‚Feigné€šè¿‡æ³¨è§£å®šä¹‰äº†æœåŠ¡æ¥å£ï¼Œä½¿å¾—æœåŠ¡æ¶ˆè´¹è€…å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚</p><h2 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>gRPC æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€é€šç”¨çš„å¼€æº RPC æ¡†æ¶ï¼Œå…¶ç”± Google 2015 å¹´ä¸»è¦é¢å‘ç§»åŠ¨åº”ç”¨å¼€å‘å¹¶åŸºäº HTTP&#x2F;2 åè®®æ ‡å‡†è€Œè®¾è®¡ï¼ŒåŸºäº ProtoBuf åºåˆ—åŒ–åè®®å¼€å‘ï¼Œä¸”æ”¯æŒä¼—å¤šå¼€å‘è¯­è¨€ã€‚</p><p>gRPCæ”¯æŒè·¨è¯­è¨€ä½¿ç”¨ã€åŸºäºIDLæ–‡ä»¶å®šä¹‰æœåŠ¡ã€é€šä¿¡åè®®åŸºäºæ ‡å‡†çš„HTTP&#x2F;2è®¾è®¡ã€åºåˆ—åŒ–æ”¯æŒPB</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261925561.png" alt="img"></p><p>GRPCæ˜¯<a href="https://so.csdn.net/so/search?q=RPC%E6%A1%86%E6%9E%B6&spm=1001.2101.3001.7020">RPCæ¡†æ¶</a>ä¸­çš„ä¸€ç§ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œå¼€æºå’Œé€šç”¨çš„RPCæ¡†æ¶ï¼ŒåŸºäºProtobufåºåˆ—åŒ–åè®®å¼€å‘ï¼Œä¸”æ”¯æŒä¼—å¤šå¼€å‘è¯­è¨€ã€‚</p><p>é¢å‘æœåŠ¡ç«¯å’Œåè®®ç«¯ï¼ŒåŸºäºhttp&#x2F;2è®¾è®¡ï¼Œå¸¦æ¥è¯¸å¦‚åŒå‘æµï¼Œæµæ§ï¼Œå¤´éƒ¨å‹ç¼©ï¼Œå•TCPè¿æ¥ä¸Šçš„å¤šè·¯å¤ç”¨è¯·æ±‚ç­‰ç‰¹æ€§ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾—å…¶åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè¡¨ç°çš„æ›´å¥½ï¼Œæ›´çœç”µå’ŒèŠ‚çœç©ºé—´ã€‚</p><p>åœ¨GRPCé‡Œå®¢æˆ·ç«¯å¯ä»¥å‘è°ƒç”¨æœ¬åœ°å¯¹è±¡ä¸€æ ·ç›´æ¥è°ƒç”¨å¦ä¸€å°ä¸åŒæœºå™¨ä¸ŠæœåŠ¡ç«¯åŒ»ç”¨çš„æ–¹æ³•ï¼Œä½¿å¾—æ‚¨èƒ½å¤Ÿæ›´å®¹æ˜“åœ°åˆ›å»ºåˆ†å¸ƒå¼åº”ç”¨å’ŒæœåŠ¡ã€‚</p><p>ä¸è®¸å¤šRPCç³»ç»Ÿç±»ä¼¼ï¼ŒGRPCä¹Ÿæ˜¯åŸºäºä»¥ä¸‹ç†å¿µï¼šå®šä¹‰ä¸€ä¸ªæœåŠ¡ï¼ŒæŒ‡å®šå…¶èƒ½å¤Ÿè¢«è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ã€‚åœ¨æœåŠ¡ç«¯å®ç°è¿™ä¸ªæ¥å£ã€‚å¹¶è¿è¡Œä¸€ä¸ªGRPCæœåŠ¡å™¨æ¥å¤„ç†å®¢æˆ·ç«¯è°ƒç”¨ã€‚åœ¨å®¢æˆ·ç«¯æ‹¥æœ‰ä¸€ä¸ªå­˜æ ¹èƒ½å¤Ÿå‘æœåŠ¡ç«¯ä¸€æ ·çš„æ–¹æ³•ã€‚</p><h3 id="GRPCç‰¹æ€§ä»¥åŠåº”ç”¨åœºæ™¯"><a href="#GRPCç‰¹æ€§ä»¥åŠåº”ç”¨åœºæ™¯" class="headerlink" title="GRPCç‰¹æ€§ä»¥åŠåº”ç”¨åœºæ™¯"></a>GRPCç‰¹æ€§ä»¥åŠåº”ç”¨åœºæ™¯</h3><p><strong>ï¼ˆ1ï¼‰ç‰¹æ€§ï¼š</strong></p><p>grpcå¯ä»¥è·¨è¯­è¨€ä½¿ç”¨ã€‚æ”¯æŒå¤šç§è¯­è¨€ æ”¯æŒC++ã€Javaã€Goã€Pythonã€Rubyã€C#ã€Node.jsã€Android Javaã€Objective-Cã€PHPç­‰ç¼–ç¨‹è¯­è¨€ã€‚</p><p>åŸºäº IDL ( æ¥å£å®šä¹‰è¯­è¨€)æ–‡ä»¶å®šä¹‰æœåŠ¡ï¼Œé€šè¿‡ proto3 å·¥å…·ç”ŸæˆæŒ‡å®šè¯­è¨€çš„æ•°æ®ç»“æ„ã€æœåŠ¡ç«¯æ¥å£ä»¥åŠå®¢æˆ·ç«¯ Stubã€‚</p><p>é€šä¿¡åè®®åŸºäºæ ‡å‡†çš„ HTTP&#x2F;2 è®¾è®¡ï¼Œæ”¯æŒåŒå‘æµã€æ¶ˆæ¯å¤´å‹ç¼©ã€å• TCP çš„å¤šè·¯å¤ç”¨ã€æœåŠ¡ç«¯æ¨é€ç­‰ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§ä½¿å¾— gRPC åœ¨ç§»åŠ¨ç«¯è®¾å¤‡ä¸Šæ›´åŠ çœç”µå’ŒèŠ‚çœç½‘ç»œæµé‡ã€‚</p><p>åºåˆ—åŒ–æ”¯æŒ PBï¼ˆProtocol Bufferï¼‰å’Œ JSONï¼ŒPB æ˜¯ä¸€ç§è¯­è¨€æ— å…³çš„é«˜æ€§èƒ½åºåˆ—åŒ–æ¡†æ¶ï¼ŒåŸºäº HTTP&#x2F;2 + PB, ä¿éšœäº† RPC è°ƒç”¨çš„é«˜æ€§èƒ½ã€‚</p><ul><li>å®‰è£…ç®€å•ï¼Œæ‰©å±•æ–¹ä¾¿ï¼ˆç”¨è¯¥æ¡†æ¶æ¯ç§’å¯è¾¾åˆ°ç™¾ä¸‡ä¸ªRPCï¼‰</li></ul><p><strong>ï¼ˆ2ï¼‰ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li><p>å¾®æœåŠ¡ï¼šgRPC è®¾è®¡ç”¨äºä½å»¶è¿Ÿå’Œé«˜ååé‡é€šä¿¡ã€‚ gRPC å¯¹äºæ•ˆç‡è‡³å…³é‡è¦çš„è½»é‡çº§å¾®æœåŠ¡éå¸¸æœ‰ç”¨ã€‚</p></li><li><p>ç‚¹å¯¹ç‚¹å®æ—¶é€šä¿¡ï¼šgRPC å¯¹åŒå‘æµå¼ä¼ è¾“æä¾›å‡ºè‰²çš„æ”¯æŒã€‚ gRPC æœåŠ¡å¯ä»¥å®æ—¶æ¨é€æ¶ˆæ¯è€Œæ— éœ€è½®è¯¢ã€‚</p></li><li><p>å¤šè¯­è¨€ç¯å¢ƒï¼šgRPC å·¥å…·æ”¯æŒæ‰€æœ‰å¸¸ç”¨çš„å¼€å‘è¯­è¨€ï¼Œå› æ­¤ï¼ŒgRPC æ˜¯å¤šè¯­è¨€ç¯å¢ƒçš„ç†æƒ³é€‰æ‹©ã€‚</p></li><li><p>ç½‘ç»œå—é™ç¯å¢ƒï¼šgRPC æ¶ˆæ¯ä½¿ç”¨ Protobufï¼ˆä¸€ç§è½»é‡çº§æ¶ˆæ¯æ ¼å¼ï¼‰è¿›è¡Œåºåˆ—åŒ–ã€‚ gRPC æ¶ˆæ¯å§‹ç»ˆå°äºç­‰æ•ˆçš„ JSON æ¶ˆæ¯ã€‚</p></li></ul><h3 id="Protocol-Buffers"><a href="#Protocol-Buffers" class="headerlink" title="Protocol Buffers"></a>Protocol Buffers</h3><p>Protocol Buffersï¼ˆprotobufï¼‰æ˜¯ä¸€ç§è½»é‡çº§ã€é«˜æ•ˆçš„æ•°æ®äº¤æ¢æ ¼å¼å’Œç¼–ç¨‹æ¥å£ï¼Œç”± Google å¼€å‘ã€‚å®ƒå¯ä»¥ç”¨äºç»“æ„åŒ–æ•°æ®çš„åºåˆ—åŒ–ï¼Œä½¿å¾—<strong>æ•°æ®åœ¨ç½‘ç»œä¸Šä¼ è¾“å’Œå­˜å‚¨æ—¶æ›´åŠ é«˜æ•ˆ</strong>ã€‚åŒæ—¶<strong>ProtoBuf æ˜¯ä¸€ç§æ›´åŠ çµæ´»ã€é«˜æ•ˆçš„æ•°æ®æ ¼å¼</strong>ï¼Œä¸ XMLã€JSON ç±»ä¼¼ï¼Œåœ¨ä¸€äº›é«˜æ€§èƒ½ä¸”å¯¹å“åº”é€Ÿåº¦æœ‰è¦æ±‚çš„æ•°æ®ä¼ è¾“åœºæ™¯éå¸¸é€‚ç”¨ã€‚</p><p>ProtoBuf åœ¨ gRPC çš„æ¡†æ¶ä¸­ä¸»è¦æœ‰ä¸‰ä¸ªä½œç”¨ï¼šå®šä¹‰æ•°æ®ç»“æ„ã€å®šä¹‰æœåŠ¡æ¥å£ï¼Œé€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹å¼æå‡ä¼ è¾“æ•ˆç‡ã€‚</p><blockquote><p>é‚£ä¸ºä»€ä¹ˆä¼šæé«˜ä¼ è¾“æ•ˆç‡å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä»–ä¼šå°†è¿™ä¸ªProtoBufå…ˆè¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åå†è¿›è¡Œä¼ è¾“ï¼Œå³ä¼ è¾“çš„æ˜¯äºŒè¿›åˆ¶æ•°æ®ã€‚</p></blockquote><p>å…¶ä¼ è¾“çš„æ€§èƒ½æ¯”JSONä¼šå¿«å¾ˆå¤šï¼Œå³ä¼ è¾“æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆgRPCæ¯”Feignè°ƒç”¨å¿«çš„åŸå› </p><h4 id="Javaä½œä¸ºæœåŠ¡ç«¯gRPC-demo"><a href="#Javaä½œä¸ºæœåŠ¡ç«¯gRPC-demo" class="headerlink" title="Javaä½œä¸ºæœåŠ¡ç«¯gRPC demo"></a>Javaä½œä¸ºæœåŠ¡ç«¯gRPC demo</h4><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ol><li>åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œåˆ›å»º<code>src/main/proto</code>ç›®å½•ï¼Œåœ¨å…¶ä¸­æ·»åŠ å®šä¹‰å¥½çš„è¿œç¨‹APIæ¥å£<code>hello.proto</code>æ–‡ä»¶ï¼›</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨è¯¥protoæ–‡ä»¶å¯ä»¥å®šä¹‰äº¤äº’çš„æœåŠ¡æ¥å£ï¼ŒåŸºäºè¯¥æ–‡ä»¶ç¼–è¯‘æˆçš„æºæ–‡ä»¶å¯ä»¥åˆ†åˆ«å¤åˆ¶åˆ° clientç«¯å’Œserverç«¯ï¼Œä¾¿äºä¸¤è€…ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>; <span class="comment">// å®šä¹‰è¯­æ³•ç±»å‹ï¼Œé€šå¸¸proto3å¥½äºproto2ï¼Œproto2å¥½äºproto1ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨proto2ï¼Œå¿…é¡»ä½äºç¬¬ä¸€è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> hello; <span class="comment">// å®šä¹‰ä½œç”¨åŸŸ</span></span><br><span class="line"><span class="type">option</span> <span class="variable">java_multiple_files</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">// è¡¨ç¤ºä¸‹é¢çš„messageä¸éœ€è¦ç¼–è¯‘æˆå¤šä¸ªjavaæ–‡ä»¶</span></span><br><span class="line"><span class="type">option</span> <span class="variable">java_outer_classname</span> <span class="operator">=</span> <span class="string">&quot;HelloMessage&quot;</span>; <span class="comment">// è¡¨ç¤ºä¸‹é¢çš„messageç¼–è¯‘æˆçš„javaç±»æ–‡ä»¶çš„åå­—</span></span><br><span class="line"><span class="type">option</span> <span class="variable">java_package</span> <span class="operator">=</span> <span class="string">&quot;grpc&quot;</span>; <span class="comment">//æŒ‡å®šè¯¥protoæ–‡ä»¶ç¼–è¯‘æˆçš„javaæºæ–‡ä»¶çš„åŒ…å</span></span><br><span class="line"></span><br><span class="line">service Hello &#123;  <span class="comment">// å®šä¹‰æœåŠ¡</span></span><br><span class="line">  rpc <span class="title function_">sayHello</span><span class="params">(HelloRequest)</span> returns(HelloResponse) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message HelloRequest &#123; <span class="comment">// å®šä¹‰è¯·æ±‚çš„æ¶ˆæ¯ä½“</span></span><br><span class="line">  <span class="type">string</span> <span class="variable">name</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message HelloResponse &#123; <span class="comment">// å®šä¹‰å›å¤çš„æ¶ˆæ¯ä½“</span></span><br><span class="line">  <span class="type">string</span> <span class="variable">message</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†åˆ›å»ºä¸€ä¸ªfang.protoæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">option</span> <span class="variable">java_multiple_files</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="type">option</span> <span class="variable">java_package</span> <span class="operator">=</span> <span class="string">&quot;io.grpc.examples.helloworld&quot;</span>;</span><br><span class="line"><span class="type">option</span> <span class="variable">java_outer_classname</span> <span class="operator">=</span> <span class="string">&quot;HelloWorldProto&quot;</span>;</span><br><span class="line"><span class="type">option</span> <span class="variable">objc_class_prefix</span> <span class="operator">=</span> <span class="string">&quot;HLW&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> helloworld;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The greeting service definition.</span></span><br><span class="line">service Greeter &#123;</span><br><span class="line">  <span class="comment">// Sends a greeting</span></span><br><span class="line">  rpc <span class="title function_">SayHello</span> <span class="params">(HelloRequest)</span> returns (HelloReply) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The request message containing the user&#x27;s name.</span></span><br><span class="line">message HelloRequest &#123;</span><br><span class="line">  <span class="type">string</span> <span class="variable">name</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The response message containing the greetings</span></span><br><span class="line">message HelloReply &#123;</span><br><span class="line">  <span class="type">string</span> <span class="variable">message</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>pom.xmlæ–‡ä»¶å†…å®¹å¦‚ä¸‹</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gRPC-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-netty-shaded<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.31.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-protobuf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.31.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-stub<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.31.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>annotations-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.53<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>kr.motd.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>os-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.xolstice.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>protobuf-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">protocArtifact</span>&gt;</span>com.google.protobuf:protoc:3.12.0:exe:$&#123;os.detected.classifier&#125;<span class="tag">&lt;/<span class="name">protocArtifact</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">pluginId</span>&gt;</span>grpc-java<span class="tag">&lt;/<span class="name">pluginId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">pluginArtifact</span>&gt;</span>io.grpc:protoc-gen-grpc-java:1.31.1:exe:$&#123;os.detected.classifier&#125;<span class="tag">&lt;/<span class="name">pluginArtifact</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile-custom<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>ç‚¹å‡»mavenä¸­çš„protobufæ’ä»¶ä¸­çš„compileå’Œcustom</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926472.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926087.png" alt="img"></p><ol><li>æœ€åçš„ç»“æœå¦‚ä¸‹</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926115.png" alt="img"></p><h4 id="Java-serverç«¯"><a href="#Java-serverç«¯" class="headerlink" title="Java serverç«¯"></a>Java serverç«¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> grpc.HelloGrpc;</span><br><span class="line"><span class="keyword">import</span> grpc.HelloMessage;</span><br><span class="line"><span class="keyword">import</span> io.grpc.Server;</span><br><span class="line"><span class="keyword">import</span> io.grpc.ServerBuilder;</span><br><span class="line"><span class="keyword">import</span> io.grpc.stub.StreamObserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªServerå¯¹è±¡ï¼Œç›‘å¬ç«¯å£æ¥è·å–rpcè¯·æ±‚ï¼Œä»¥è¿›è¡Œä¸‹é¢çš„å¤„ç†</span></span><br><span class="line">    <span class="keyword">private</span> Server server;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨mainæ–¹æ³•æ¥æµ‹è¯•serverç«¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ServerDemo</span> <span class="variable">serverDemo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerDemo</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯åŠ¨server</span></span><br><span class="line">        serverDemo.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//block ä¸€ç›´åˆ°é€€å‡ºç¨‹åº</span></span><br><span class="line">        serverDemo.blockUntilShutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨ä¸€ä¸ªServerå®ä¾‹ï¼Œç›‘å¬clientç«¯çš„è¯·æ±‚å¹¶å¤„ç†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//serverè¿è¡Œåœ¨çš„ç«¯å£å·</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">50051</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»™serveræ·»åŠ ç›‘å¬ç«¯å£å·ï¼Œæ·»åŠ  åŒ…å«ä¸šåŠ¡å¤„ç†é€»è¾‘çš„ç±»ï¼Œç„¶åå¯åŠ¨</span></span><br><span class="line">        server = ServerBuilder.forPort(port)</span><br><span class="line">                .addService(<span class="keyword">new</span> <span class="title class_">HelloImpl</span>())</span><br><span class="line">                .build()</span><br><span class="line">                .start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜»å¡serverç›´åˆ°å…³é—­ç¨‹åº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">blockUntilShutdown</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (server != <span class="literal">null</span>) &#123;</span><br><span class="line">            server.awaitTermination();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * protoæ–‡ä»¶è¢«ç¼–è¯‘åï¼Œåœ¨ç”Ÿæˆçš„HelloGrpcçš„æŠ½è±¡å†…éƒ¨ç±»HelloImplBaseä¸­åŒ…å«äº† protoä¸­å®šä¹‰çš„æœåŠ¡æ¥å£çš„ç®€å•å®ç°</span></span><br><span class="line"><span class="comment">     * è¯¥HelloImplç±»éœ€è¦é‡å†™è¿™äº›æ–¹æ³•ï¼Œæ·»åŠ éœ€è¦çš„å¤„ç†é€»è¾‘</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HelloImpl</span> <span class="keyword">extends</span> <span class="title class_">HelloGrpc</span>.HelloImplBase &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// protoæ–‡ä»¶ä¸­çš„sayHelloæœåŠ¡æ¥å£è¢«ç¼–è¯‘åï¼Œåœ¨ç”Ÿæˆçš„HelloGrpcçš„æŠ½è±¡å†…éƒ¨ç±»HelloImplBaseä¸­æœ‰ä¸€ä¸ªç®€å•çš„å®ç°</span></span><br><span class="line">        <span class="comment">// å› æ­¤ï¼Œåœ¨serverç«¯éœ€è¦é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œæ·»åŠ ä¸Šç›¸åº”çš„é€»è¾‘</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(HelloMessage.HelloRequest req, StreamObserver&lt;HelloMessage.HelloResponse&gt; responseObserver)</span> &#123;</span><br><span class="line"></span><br><span class="line">            HelloMessage.<span class="type">HelloResponse</span> <span class="variable">reply</span> <span class="operator">=</span> HelloMessage.HelloResponse.newBuilder().setMessage(<span class="string">&quot;(serverç«¯çš„sayHello()æ–¹æ³•å¤„ç†ç»“æœ) Hello,&quot;</span> + req.getName()).build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// è°ƒç”¨onNext()æ–¹æ³•æ¥é€šçŸ¥gRPCæ¡†æ¶æŠŠreply ä»serverç«¯ å‘é€å› clientç«¯</span></span><br><span class="line">            responseObserver.onNext(reply);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¡¨ç¤ºå®Œæˆè°ƒç”¨</span></span><br><span class="line">            responseObserver.onCompleted();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Java-Clientç«¯"><a href="#Java-Clientç«¯" class="headerlink" title="Java Clientç«¯"></a>Java Clientç«¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> grpc.HelloGrpc;</span><br><span class="line"><span class="keyword">import</span> grpc.HelloMessage;</span><br><span class="line"><span class="keyword">import</span> io.grpc.Channel;</span><br><span class="line"><span class="keyword">import</span> io.grpc.ManagedChannelBuilder;</span><br><span class="line"><span class="keyword">import</span> io.grpc.StatusRuntimeException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨mainæ–¹æ³•æ¥æµ‹è¯•clientç«¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ClientDemo</span> <span class="variable">clientDemo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientDemo</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åŸºäºgRPCè¿œç¨‹è°ƒç”¨å¯¹åº”çš„æ–¹æ³•</span></span><br><span class="line">            clientDemo.remoteCall(<span class="string">&quot;ã€fangyaohuiã€‘&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºgRPCæ¡†æ¶çš„ä½¿ç”¨æ­¥éª¤ï¼Œè¿›è¡Œè¿œç¨‹è°ƒç”¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remoteCall</span><span class="params">(String name)</span> &#123;</span><br><span class="line"></span><br><span class="line">        HelloMessage.<span class="type">HelloRequest</span> <span class="variable">request</span> <span class="operator">=</span> HelloMessage.HelloRequest.newBuilder().setName(name).build();</span><br><span class="line">        HelloMessage.HelloResponse response;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åŸºäºè®¿é—®åœ°å€ åˆ›å»ºé€šé“</span></span><br><span class="line">            <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span>  ManagedChannelBuilder.forAddress(<span class="string">&quot;localhost&quot;</span>, <span class="number">50051</span>).usePlaintext().build();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ©ç”¨é€šé“ åˆ›å»ºä¸€ä¸ªæ¡©ï¼ˆStubï¼‰å¯¹è±¡</span></span><br><span class="line">            HelloGrpc.<span class="type">HelloBlockingStub</span> <span class="variable">blockingStub</span> <span class="operator">=</span> HelloGrpc.newBlockingStub(channel);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//é€šè¿‡æ¡©å¯¹è±¡æ¥è°ƒç”¨è¿œç¨‹æ–¹æ³•</span></span><br><span class="line">            response = blockingStub.sayHello(request);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (StatusRuntimeException e) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;clientç«¯è¿œç¨‹è°ƒç”¨sayHello()çš„ç»“æœä¸ºï¼š\n\n&quot;</span> + response.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h4><p>å…ˆè¿è¡Œserverï¼Œå†è¿è¡Œclientï¼Œæœ€ååœ¨æ§åˆ¶å°ä¸Šæ‰“å°å¦‚ä¸‹ä¿¡æ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926855.png" alt="img"></p><h3 id="gRPCé¡¹ç›®åˆæ­¥ç†è§£"><a href="#gRPCé¡¹ç›®åˆæ­¥ç†è§£" class="headerlink" title="gRPCé¡¹ç›®åˆæ­¥ç†è§£"></a>gRPCé¡¹ç›®åˆæ­¥ç†è§£</h3><p>è¿™é‡Œä»¥ä¸€ä¸ªAgvStatus.protoæ¥è¿›è¡Œåˆæ­¥ç†è§£gRPCé¡¹ç›®ã€‚</p><h4 id="AgvStatus-proto"><a href="#AgvStatus-proto" class="headerlink" title="AgvStatus.proto"></a>AgvStatus.proto</h4><p>ä½¿ç”¨è¯¥protoæ–‡ä»¶å¯ä»¥å®šä¹‰äº¤äº’çš„æœåŠ¡æ¥å£ï¼ŒåŸºäºè¯¥æ–‡ä»¶ç¼–è¯‘æˆçš„æºæ–‡ä»¶å¯ä»¥åˆ†åˆ«å¤åˆ¶åˆ°clientç«¯å’Œserverç«¯ï¼Œä¾¿äºä¸¤è€…ä½¿ç”¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926873.png" alt="img"></p><p>protoæ–‡ä»¶å®šä¹‰æœåŠ¡çš„æ¥å£ï¼Œå®šä¹‰æœåŠ¡è¿”å›ç±»å‹ï¼Œç±»ä¼¼ä¸€ç§æ ‡å‡†ï¼Œè®¾è®¡å›¾çº¸ã€‚</p><ol><li>å®šä¹‰æœåŠ¡æ¥å£æ–¹æ³•ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">service AgvStatusUpdateService &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    ä¸ŠæŠ¥æ›´æ–°AGVçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  rpc <span class="title function_">updateAgvStatus</span><span class="params">(UpdateAgvStatusRequest)</span> returns (UpdateAgvStatusResponse) &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    è·å–å•ä¸ªAGVçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  rpc <span class="title function_">getAgvStatus</span><span class="params">(GetAgvStatusRequest)</span> returns (GetAgvStatusResponse) &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    æ‰¹é‡æŸ¥è¯¢AGVçŠ¶æ€ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  rpc <span class="title function_">batchQueryAgvStatusInfoList</span><span class="params">(BatchQueryAgvStatusInfoListRequest)</span> returns (BatchQueryAgvStatusInfoListResponse) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å®šä¹‰æ¶ˆæ¯æ ¼å¼</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">message AgvStatus &#123;</span><br><span class="line">  <span class="type">string</span> <span class="variable">agvCode</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">pointCode</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">agvState</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">power</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">sleeping</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">speed</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">mileage</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">liftupTime</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">onlineState</span> <span class="operator">=</span> <span class="number">11</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">exceptionCode</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line">  <span class="type">bool</span> <span class="variable">agvLock</span> <span class="operator">=</span> <span class="number">13</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message UpdateAgvStatusRequest &#123;</span><br><span class="line">    <span class="type">AgvStatus</span> <span class="variable">agvStatusInfo</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"><span class="type">option</span> <span class="variable">java_multiple_files</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="type">option</span> <span class="variable">java_package</span> <span class="operator">=</span> <span class="string">&quot;com.kc.evo.domain.rpc&quot;</span>;</span><br><span class="line"><span class="type">option</span> <span class="variable">java_outer_classname</span> <span class="operator">=</span> <span class="string">&quot;AgvStatusInfo&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;Common.proto&quot;</span>;</span><br><span class="line"></span><br><span class="line">message AgvStatus &#123;</span><br><span class="line">  <span class="type">string</span> <span class="variable">agvCode</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">pointCode</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">agvState</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">power</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">sleeping</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">speed</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">mileage</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">liftupTime</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">onlineState</span> <span class="operator">=</span> <span class="number">11</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">exceptionCode</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line">  <span class="type">bool</span> <span class="variable">agvLock</span> <span class="operator">=</span> <span class="number">13</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message UpdateAgvStatusRequest &#123;</span><br><span class="line">    <span class="type">AgvStatus</span> <span class="variable">agvStatusInfo</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message UpdateAgvStatusResponse &#123;</span><br><span class="line">  <span class="type">bool</span> <span class="variable">success</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">code</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  option (success) = true;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message GetAgvStatusRequest &#123;</span><br><span class="line">  <span class="type">string</span> <span class="variable">agvCode</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message GetAgvStatusResponse &#123;</span><br><span class="line">  <span class="type">bool</span> <span class="variable">success</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">code</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">  <span class="type">AgvStatus</span> <span class="variable">agvStatusInfo</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message BatchQueryAgvStatusInfoListRequest &#123;</span><br><span class="line">  repeated <span class="type">string</span> <span class="variable">agvCode</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message BatchQueryAgvStatusInfoListResponse &#123;</span><br><span class="line">  <span class="type">bool</span> <span class="variable">success</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  <span class="type">int32</span> <span class="variable">code</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">  <span class="type">string</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">  repeated <span class="type">AgvStatus</span> <span class="variable">agvStatusInfo</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service AgvStatusUpdateService &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    ä¸ŠæŠ¥æ›´æ–°AGVçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  rpc <span class="title function_">updateAgvStatus</span><span class="params">(UpdateAgvStatusRequest)</span> returns (UpdateAgvStatusResponse) &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    è·å–å•ä¸ªAGVçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  rpc <span class="title function_">getAgvStatus</span><span class="params">(GetAgvStatusRequest)</span> returns (GetAgvStatusResponse) &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    æ‰¹é‡æŸ¥è¯¢AGVçŠ¶æ€ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  rpc <span class="title function_">batchQueryAgvStatusInfoList</span><span class="params">(BatchQueryAgvStatusInfoListRequest)</span> returns (BatchQueryAgvStatusInfoListResponse) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä¹‹å‰çš„ä½¿ç”¨compileç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926097.png" alt="img"></p><p>protoå®šä¹‰çš„æœåŠ¡ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ª*Grpcæ–‡ä»¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926154.png" alt="img"></p><h4 id="AgvDataSyncManager-serverç«¯"><a href="#AgvDataSyncManager-serverç«¯" class="headerlink" title="AgvDataSyncManager serverç«¯"></a>AgvDataSyncManager serverç«¯</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926780.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–°AGVçŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> responseObserver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAgvStatus</span><span class="params">(AgvStatusInfo.UpdateAgvStatusRequest request,</span></span><br><span class="line"><span class="params">                            StreamObserver&lt;AgvStatusInfo.UpdateAgvStatusResponse&gt; responseObserver)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(request == <span class="literal">null</span> || request.getAgvStatusInfo() == <span class="literal">null</span></span><br><span class="line">            || StringUtils.isBlank(request.getAgvStatusInfo().getAgvState()))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;Receive AGV status data from RCS gRPC client:&#123;&#125;&quot;</span>, request);</span><br><span class="line">    AgvStatusInfo.UpdateAgvStatusResponse updateAgvStatusResponse;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//å­˜å…¥æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">        AgvCacheManager.saveAgvStatusInfo(request.getAgvStatusInfo());</span><br><span class="line"></span><br><span class="line">        updateAgvStatusResponse = AgvStatusInfo.UpdateAgvStatusResponse.newBuilder().setSuccess(<span class="literal">true</span>)</span><br><span class="line">                        .setCode(SystemErrorCodeEnum.SUCCESS.getCode())</span><br><span class="line">                        .setMsg(SystemErrorCodeEnum.SUCCESS.getMsg())</span><br><span class="line">                        .build();</span><br><span class="line">        responseObserver.onNext(updateAgvStatusResponse);</span><br><span class="line">        responseObserver.onCompleted();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        updateAgvStatusResponse = AgvStatusInfo.UpdateAgvStatusResponse.newBuilder().setSuccess(<span class="literal">true</span>)</span><br><span class="line">                .setCode(RpcBizErrorEnum.UPDATE_AGV_REALTIME_STATUS_FAILED.getCode())</span><br><span class="line">                .setMsg(RpcBizErrorEnum.UPDATE_AGV_REALTIME_STATUS_FAILED.getMsg())</span><br><span class="line">                .build();</span><br><span class="line">        responseObserver.onNext(updateAgvStatusResponse);</span><br><span class="line">        responseObserver.onError(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯ç»§æ‰¿ä¸Šé¢é…ç½®ç”Ÿæˆçš„AgvStatusUpdateServiceGrpc.AgvStatusUpdateServiceImplBaseã€‚åœ¨è¿™é‡Œéœ€è¦å¯¹ä¹‹å‰protoçš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„æ–¹æ³•è¿›è¡Œå®ç°ã€‚</p><p>ä¸Šé¢çš„é…ç½®æ–‡ä»¶å®šä¹‰äº†ä¸‰ç§æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œä¹Ÿéœ€è¦å®ç°ä¸‰ç§æ–¹æ³•ï¼Œè¿™é‡Œåªå¯¹ç¬¬ä¸€ç§æ–¹æ³•è¿›è¡Œäº†è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–°AGVçŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> responseObserver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAgvStatus</span><span class="params">(AgvStatusInfo.UpdateAgvStatusRequest request,</span></span><br><span class="line"><span class="params">                            StreamObserver&lt;AgvStatusInfo.UpdateAgvStatusResponse&gt; responseObserver)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(request == <span class="literal">null</span> || request.getAgvStatusInfo() == <span class="literal">null</span></span><br><span class="line">            || StringUtils.isBlank(request.getAgvStatusInfo().getAgvState()))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;Receive AGV status data from RCS gRPC client:&#123;&#125;&quot;</span>, request);</span><br><span class="line">    AgvStatusInfo.UpdateAgvStatusResponse updateAgvStatusResponse;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//å­˜å…¥æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">        AgvCacheManager.saveAgvStatusInfo(request.getAgvStatusInfo());</span><br><span class="line"></span><br><span class="line">        updateAgvStatusResponse = AgvStatusInfo.UpdateAgvStatusResponse.newBuilder().setSuccess(<span class="literal">true</span>)</span><br><span class="line">                        .setCode(SystemErrorCodeEnum.SUCCESS.getCode())</span><br><span class="line">                        .setMsg(SystemErrorCodeEnum.SUCCESS.getMsg())</span><br><span class="line">                        .build();</span><br><span class="line">        responseObserver.onNext(updateAgvStatusResponse);</span><br><span class="line">        responseObserver.onCompleted();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        updateAgvStatusResponse = AgvStatusInfo.UpdateAgvStatusResponse.newBuilder().setSuccess(<span class="literal">true</span>)</span><br><span class="line">                .setCode(RpcBizErrorEnum.UPDATE_AGV_REALTIME_STATUS_FAILED.getCode())</span><br><span class="line">                .setMsg(RpcBizErrorEnum.UPDATE_AGV_REALTIME_STATUS_FAILED.getMsg())</span><br><span class="line">                .build();</span><br><span class="line">        responseObserver.onNext(updateAgvStatusResponse);</span><br><span class="line">        responseObserver.onError(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><code>public void updateAgvStatus(AgvStatusInfo.UpdateAgvStatusRequest request,</code>: è¿™æ˜¯ä¸€ä¸ªå…¬å…±æ–¹æ³•çš„å£°æ˜ï¼Œæ–¹æ³•åä¸º <code>updateAgvStatus</code>ã€‚è¯¥æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»å‹ä¸º <code>AgvStatusInfo.UpdateAgvStatusRequest</code> çš„ <code>request</code>ï¼Œç”¨äºæ¥æ”¶æ›´æ–° AGV çŠ¶æ€çš„è¯·æ±‚ä¿¡æ¯ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç±»å‹ä¸º <code>StreamObserver&lt;AgvStatusInfo.UpdateAgvStatusResponse&gt;</code> çš„ <code>responseObserver</code>ï¼Œç”¨äºæ¥æ”¶æ›´æ–° AGV çŠ¶æ€çš„å“åº”ä¿¡æ¯ã€‚</li><li><code>StreamObserver&lt;AgvStatusInfo.UpdateAgvStatusResponse&gt;</code>ï¼šè¿™æ˜¯ä¸€ä¸ª gRPC ä¸­ç”¨äºå¤„ç†å¼‚æ­¥æµçš„æ¥å£ã€‚åœ¨è¿™é‡Œï¼Œ<code>responseObserver</code> å‚æ•°ç”¨äºæ¥æ”¶ä»æœåŠ¡å™¨è¿”å›çš„å¼‚æ­¥æµæ•°æ®ï¼Œè¯¥æ•°æ®çš„ç±»å‹æ˜¯ <code>AgvStatusInfo.UpdateAgvStatusResponse</code>ã€‚</li></ol><h4 id="Client-Stub"><a href="#Client-Stub" class="headerlink" title="Client Stub"></a>Client Stub</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926934.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926420.png" alt="image-20240628144221050"></p><p>ä¹‹å‰æˆ‘ä»¬ä»‹ç»äº†stubçš„ä½œç”¨ï¼Œè®©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926464.png" alt="image-20240628144307052"></p><p>é‚£ä¹ˆå®¢æˆ·ç«¯çš„stubéœ€è¦ç»‘å®šè¿™ä¸ªæ¶ˆæ¯éœ€è¦å‘é€çš„æœåŠ¡åœ°å€ä»¥åŠå¦‚ä½•æŠŠæ–¹æ³•å’Œå‚æ•°åŒ…è£…æˆç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ã€‚åœ¨è¿™é‡Œé€šè¿‡ä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926426.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">DataSyncBaseClient</span><span class="params">(RpcProperties rpcProperties)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.rpcProperties = rpcProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(rpcProperties == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(rpcProperties.getInterceptorEnabled())&#123;</span><br><span class="line">        <span class="built_in">this</span>.managedChannel = ManagedChannelBuilder.forTarget(rpcProperties.getServerAddr())</span><br><span class="line">                .usePlaintext().intercept(<span class="keyword">new</span> <span class="title class_">EvoDataSyncClientInterceptor</span>()).build();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.managedChannel = ManagedChannelBuilder.forTarget(rpcProperties.getServerAddr()).usePlaintext().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥é…ç½®æœåŠ¡ç«¯çš„åœ°å€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926899.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926306.png" alt="img"></p><h4 id="Clientå‘é€è¯·æ±‚"><a href="#Clientå‘é€è¯·æ±‚" class="headerlink" title="Clientå‘é€è¯·æ±‚"></a>Clientå‘é€è¯·æ±‚</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926132.png" alt="image-20240628144332666"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">AgvStatusSyncClient agvStatusSyncClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢AGVå®æ—¶çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> agvCode AGVç¼–ç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AgvStatusInfoDTO <span class="title function_">getAgvStatusInfo</span><span class="params">(String agvCode)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(agvCode))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AgvStatusInfo.<span class="type">GetAgvStatusRequest</span> <span class="variable">request</span> <span class="operator">=</span> AgvStatusInfo.GetAgvStatusRequest.newBuilder()</span><br><span class="line">            .setAgvCode(agvCode).build();</span><br><span class="line">    AgvStatusInfo.<span class="type">GetAgvStatusResponse</span> <span class="variable">response</span> <span class="operator">=</span> agvStatusSyncClient.getAgvStatusInfo(request);</span><br><span class="line">    <span class="keyword">if</span>(response == <span class="literal">null</span> || response.getAgvStatusInfo() == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> DozerBeanUtil.map(response.getAgvStatusInfo(), AgvStatusInfoDTO.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AgvStatusInfo.<span class="type">GetAgvStatusResponse</span> <span class="variable">response</span> <span class="operator">=</span> agvStatusSyncClient.getAgvStatusInfo(request);</span><br></pre></td></tr></table></figure><p>æ¥å¯¹serverç«¯æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼ŒåŒæ—¶å¾—åˆ°æœåŠ¡ç«¯ä¼ æ¥çš„responseã€‚</p><h3 id="Feignå’ŒgRPCçš„åŒºåˆ«"><a href="#Feignå’ŒgRPCçš„åŒºåˆ«" class="headerlink" title="Feignå’ŒgRPCçš„åŒºåˆ«"></a>Feignå’ŒgRPCçš„åŒºåˆ«</h3><p>Feignå°±åƒæ˜¯ä¸€ä¸ªç®€å•ç›´è§‚çš„ä¾¿ç­¾ç³»ç»Ÿï¼Œé€‚åˆå¿«é€Ÿäº¤æµå’Œé€‚åº”æ€§å¼ºï¼Œä½†å¯èƒ½åœ¨æ•ˆç‡å’Œç²¾ç¡®æ€§ä¸Šä¸å¦‚gRPCã€‚è€ŒgRPCåˆ™åƒæ˜¯é«˜æ•ˆçš„æ— çº¿ç”µé€šè®¯ç³»ç»Ÿï¼Œé€‚åˆéœ€è¦å¿«é€Ÿã€å‡†ç¡®å’Œè·¨éƒ¨é—¨åä½œçš„åœºæ™¯ã€‚é€‰æ‹©å“ªç§æ²Ÿé€šæ–¹å¼ï¼Œå–å†³äºé¤å…çš„å…·ä½“éœ€æ±‚å’Œç¯å¢ƒã€‚å¦‚æœä½ çš„é¤å…éœ€è¦å¿«é€Ÿå“åº”é¡¾å®¢éœ€æ±‚ï¼Œå¹¶ä¸”æ³¨é‡æ²Ÿé€šçš„æ•ˆç‡å’Œå‡†ç¡®æ€§ï¼ŒgRPCå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¦‚æœä½ çš„é¤å…æ›´æ³¨é‡ç®€å•æ˜“ç”¨å’Œå¿«é€Ÿä¸Šæ‰‹ï¼ŒFeignå¯èƒ½æ›´é€‚åˆä½ ã€‚</p><ul><li><strong>gRPC</strong>ï¼šé€‚åˆ<strong>é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿã€è·¨è¯­è¨€</strong>çš„æœåŠ¡è°ƒç”¨ï¼Œä½†å¯èƒ½éœ€è¦é¢å¤–çš„é…ç½®å’Œé›†æˆã€‚</li><li><strong>Feign</strong>ï¼šé€‚åˆJavaç”Ÿæ€ç³»ç»Ÿï¼Œç®€åŒ–äº†HTTPå®¢æˆ·ç«¯çš„å¼€å‘ï¼Œæ˜“äºé›†æˆæœåŠ¡å‘ç°å’Œå®¹é”™æœºåˆ¶ã€‚</li></ul><h2 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h2><h3 id="å‚è€ƒèµ„æ–™-1"><a href="#å‚è€ƒèµ„æ–™-1" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/kenkao/article/details/129611552?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171955633116800197019886%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171955633116800197019886&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-5-129611552-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=Dubbo%20Feign&spm=1018.2226.3001.4187">ã€ä¼˜è´¨æ¨èã€‘æ·±å…¥æ¢è®¨Dubboä¸Feignçš„åŒºåˆ«</a></li><li><a href="https://blog.csdn.net/weixin_42039228/article/details/123678364?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171955590416800211576717%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171955590416800211576717&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-123678364-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=dubbo&spm=1018.2226.3001.4187">Dubboè¯¦è§£ï¼Œç”¨å¿ƒçœ‹è¿™ä¸€ç¯‡æ–‡ç« å°±å¤Ÿäº†ã€é‡ç‚¹ã€‘</a></li><li><a href="https://cn.dubbo.apache.org/zh-cn/overview/home/">Dubbo æ–‡æ¡£</a></li><li><a href="https://nacos.io/zh-cn/docs/use-nacos-with-dubbo.html">Dubbo èåˆ Nacos æˆä¸ºæ³¨å†Œä¸­å¿ƒ</a></li><li></li></ol><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Dubboæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„åŸºäº <strong>Java çš„é«˜æ€§èƒ½</strong> <strong>RPC</strong>ï¼ˆä¸€ç§è¿œç¨‹è°ƒç”¨ï¼‰ åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œé€æ˜åŒ–çš„RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æ–¹æ¡ˆï¼Œä»¥åŠSOAæœåŠ¡æ²»ç†æ–¹æ¡ˆã€‚</p><p>æ¯å¤©ä¸º2åƒå¤šä¸ªæœåŠ¡æä¾›å¤§äº30äº¿æ¬¡è®¿é—®é‡æ”¯æŒï¼Œå¹¶è¢«å¹¿æ³›åº”ç”¨äºé˜¿é‡Œå·´å·´é›†å›¢çš„å„æˆå‘˜ç«™ç‚¹ä»¥åŠåˆ«çš„å…¬å¸çš„ä¸šåŠ¡ä¸­ã€‚</p><p>ç®€å•çš„è¯´ï¼Œ<strong>Dubboå°±æ˜¯ä¸ªæœåŠ¡æ¡†æ¶</strong>ï¼Œå¦‚æœæ²¡æœ‰åˆ†å¸ƒå¼çš„éœ€æ±‚ï¼Œå…¶å®æ˜¯ä¸éœ€è¦ç”¨çš„ï¼Œåªæœ‰åœ¨åˆ†å¸ƒå¼çš„æ—¶å€™ï¼Œæ‰æœ‰Dubboè¿™æ ·çš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶çš„éœ€æ±‚ã€‚</p><p>å¹¶ä¸”æœ¬è´¨ä¸Šæ˜¯ä¸ªè¿œç¨‹æœåŠ¡è°ƒç”¨çš„åˆ†å¸ƒå¼æ¡†æ¶ï¼ˆå‘Šåˆ«Web Serviceæ¨¡å¼ä¸­çš„WSdlï¼Œä»¥æœåŠ¡è€…ä¸æ¶ˆè´¹è€…çš„æ–¹å¼åœ¨Dubboä¸Šæ³¨å†Œï¼‰</p><ul><li>Dubboæ˜¯<strong>é˜¿é‡Œå·´å·´</strong>å…¬å¸å¼€æºçš„ä¸€ä¸ªé«˜æ€§èƒ½ã€<strong>è½»é‡çº§çš„ Java RPC æ¡†æ¶</strong>ã€‚</li><li>è‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œé€æ˜åŒ–çš„ RPC è¿œç¨‹æœåŠ¡è°ƒç”¨æ–¹æ¡ˆï¼Œä»¥åŠ SOA æœåŠ¡æ²»ç†æ–¹æ¡ˆã€‚</li><li>å®˜ç½‘ï¼š<a href="http://dubbo.apache.org/">http://dubbo.apache.org</a></li></ul><h3 id="Dubboæ¶æ„"><a href="#Dubboæ¶æ„" class="headerlink" title="Dubboæ¶æ„"></a>Dubboæ¶æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926040.png" alt="img"></p><p>ä¸Šå›¾ä¸­ï¼Œè“è‰²çš„è¡¨ç¤ºä¸ä¸šåŠ¡æœ‰äº¤äº’ï¼Œç»¿è‰²çš„è¡¨ç¤ºåªå¯¹Dubboå†…éƒ¨äº¤äº’ã€‚ä¸Šè¿°å›¾æ‰€æè¿°çš„è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æœåŠ¡æä¾›æ–¹å‘å¸ƒæœåŠ¡åˆ°æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼›</li><li>æœåŠ¡æ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè®¢é˜…æœåŠ¡ï¼›</li><li>æœåŠ¡æ¶ˆè´¹æ–¹è°ƒç”¨å·²ç»æ³¨å†Œçš„å¯ç”¨æœåŠ¡</li></ol><h3 id="Dubboå¿«é€Ÿå…¥é—¨"><a href="#Dubboå¿«é€Ÿå…¥é—¨" class="headerlink" title="Dubboå¿«é€Ÿå…¥é—¨"></a>Dubboå¿«é€Ÿå…¥é—¨</h3><ul><li>åˆ›å»ºæœåŠ¡æä¾›è€…Provideræ¨¡å—</li><li>åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…Consumeræ¨¡å—</li><li>åœ¨æœåŠ¡æä¾›è€…æ¨¡å—ç¼–å†™ UserServiceImpl æä¾›æœåŠ¡</li><li>åœ¨æœåŠ¡æ¶ˆè´¹è€…ä¸­çš„ UserController è¿œç¨‹è°ƒç”¨UserServiceImpl æä¾›çš„æœåŠ¡</li><li>åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªæœåŠ¡ï¼Œæµ‹è¯•ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261926409.png" alt="image-20240723164207399"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Java </tag>
            
            <tag> Linux </tag>
            
            <tag> RPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>16 XSSè·¨ç«™è„šæœ¬æ”»å‡»</title>
      <link href="/2025/02/26/16%20XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB/"/>
      <url>/2025/02/26/16%20XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="16-XSSè·¨ç«™è„šæœ¬æ”»å‡»"><a href="#16-XSSè·¨ç«™è„šæœ¬æ”»å‡»" class="headerlink" title="16 XSSè·¨ç«™è„šæœ¬æ”»å‡»"></a>16 XSSè·¨ç«™è„šæœ¬æ”»å‡»</h1><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/weixin_62707591/article/details/131269479?ops_request_misc=%7B%22request_id%22:%22171523971716800184171198%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171523971716800184171198&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-131269479-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=xss%E6%94%BB%E5%87%BB&spm=1018.2226.3001.4187">XSSè·¨ç«™è„šæœ¬æ”»å‡»åŠé˜²æŠ¤</a></li><li><a href="https://blog.csdn.net/weixin_43263566/article/details/128703356">è·¨ç«™è„šæœ¬æ”»å‡»æ¼æ´ï¼ˆXSSï¼‰ï¼šåŸºç¡€çŸ¥è¯†å’Œé˜²å¾¡ç­–ç•¥</a></li></ul><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>XSSä¹Ÿå«CSSï¼Œå› ä¸ºå’Œå‰ç«¯CSSæ ·å¼é‡åï¼Œæ•…ç§°å…¶ä¸ºXSSã€‚XSSä¸ºè·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ˜¯webåº”ç”¨æœ€å¸¸è§çš„ç¨‹åºå®‰å…¨æ¼æ´ä¹‹ä¸€ã€‚XSSé€šè¿‡çªƒå–ç”¨æˆ·çš„Cookieæ¥å˜ç›¸çš„ç›—å–ç”¨æˆ·çš„è´¦å·å’Œå¯†ç ã€‚ç„¶åé€šè¿‡è´¦å·å’Œå¯†ç å¯¹ç”¨æˆ·è´¦æˆ·è¿›è¡Œéæ³•æ“ä½œã€‚</p><h1 id="æœ¬è´¨"><a href="#æœ¬è´¨" class="headerlink" title="æœ¬è´¨"></a>æœ¬è´¨</h1><p>XSSæ”»å‡»çš„æœ¬è´¨æ˜¯åˆ©ç”¨äº†æµè§ˆå™¨å¯¹äºç”¨æˆ·è¾“å…¥æ•°æ®çš„ä¿¡ä»»ï¼Œé»‘å®¢é€šè¿‡åœ¨ç½‘é¡µç¨‹åºä¸­æ³¨å…¥éæ³•è„šæœ¬ï¼Œç”¨æˆ·é€šè¿‡ç‚¹å‡»æ‰§è¡Œè¿™äº›è„šæœ¬ï¼Œä»è€Œè¾¾åˆ°éæ³•çªƒå–ç”¨æˆ·cookieçš„ç›®çš„ã€‚</p><p>å¯ä»¥éå¸¸ç®€å•çš„ç†è§£ä¸ºï¼ŒXSSæ”»å‡»å³é€šè¿‡ä»¿é€ ä¸€ä¸ªATMæœºï¼Œéª—å–ç”¨æˆ·çš„é“¶è¡Œå¡å’Œå¯†ç ã€‚</p><h1 id="XSSæ”»å‡»è¿‡ç¨‹-åŸç†"><a href="#XSSæ”»å‡»è¿‡ç¨‹-åŸç†" class="headerlink" title="XSSæ”»å‡»è¿‡ç¨‹&#x2F;åŸç†"></a>XSSæ”»å‡»è¿‡ç¨‹&#x2F;åŸç†</h1><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261928520.png" alt="img"></p><h1 id="XSSæ”»å‡»ç±»å‹"><a href="#XSSæ”»å‡»ç±»å‹" class="headerlink" title="XSSæ”»å‡»ç±»å‹"></a>XSSæ”»å‡»ç±»å‹</h1><h2 id="å­˜å‚¨å‹XSS"><a href="#å­˜å‚¨å‹XSS" class="headerlink" title="å­˜å‚¨å‹XSS"></a>å­˜å‚¨å‹XSS</h2><p><strong>æŒä¹…æ€§</strong>ï¼šæ”»å‡»è€…é€šè¿‡<strong>å‘è¡¨å¸¦æœ‰æ¶æ„è·¨åŸŸè„šæœ¬çš„å¸–å­æˆ–æ–‡ç« </strong>ï¼Œä»è€ŒæŠŠæ¶æ„è„šæœ¬å­˜å‚¨åœ¨<strong>æœåŠ¡å™¨</strong>ä¸­ï¼Œæ¯ä¸ªè®¿é—®è¯¥å¸–å­æˆ–æ–‡ç« çš„äººéƒ½ä¼šè§¦å‘è¯¥æ¶æ„è„šæœ¬æ‰§è¡Œï¼Œè¿™ç§XSSéå¸¸å±é™©ï¼Œ<strong>å®¹æ˜“é€ æˆè •è™«</strong>ï¼Œ<strong>å¤§é‡ç›—çªƒcookie</strong>ã€‚</p><p>å¯ä»¥å‘ç°å­˜å‚¨å‹XSSæ”»å‡»ï¼Œæ˜¯é€šè¿‡å°†æ¶æ„è„šæœ¬å­˜å‚¨åˆ°ç›®æ ‡æœåŠ¡å™¨çš„æ•°æ®åº“ä¸­æ¥è¿›è¡Œæ”»å‡»ã€‚å½“ç”¨æˆ·è®¿é—®è¯¥æ–‡ç« æˆ–è€…å¸–å­ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°æ•°æ®å°±ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ¶æ„è„šæœ¬ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261928319.png" alt="img"></p><h2 id="åå°„å‹XSS"><a href="#åå°„å‹XSS" class="headerlink" title="åå°„å‹XSS"></a>åå°„å‹XSS</h2><p><strong>éæŒä¹…æ€§</strong>ï¼šæ”»å‡»è€…äº‹å…ˆåˆ¶ä½œå¥½æ”»å‡»é“¾æ¥ï¼Œå°†æ”»å‡»è„šæœ¬åµŒå…¥åˆ°æŸä¸ª <strong>URL é“¾æ¥</strong>ä¸­ï¼Œè¯±éª—ç”¨æˆ·è‡ªå·±å»ç‚¹å‡»é“¾æ¥ï¼Œä»è€Œè§¦å‘æ”»å‡»ä»£ç æ‰§è¡Œï¼Œå®Œæˆè¯¥æ¬¡æ”»å‡»ã€‚</p><p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><p>å‡è®¾æ”»å‡»è€…æ„é€ äº†å¦‚ä¸‹æ¶æ„URLï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/search?query=&lt;script&gt;alert(&#x27;XSSæ”»å‡»æˆåŠŸï¼&#x27;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªURLæ—¶ï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘é€æœç´¢è¯·æ±‚ï¼Œå¹¶å°†<code>query</code>å‚æ•°çš„å€¼è®¾ç½®ä¸º<code>&lt;script&gt;alert(&#39;XSSæ”»å‡»æˆåŠŸï¼&#39;);&lt;/script&gt;</code>ã€‚æœåŠ¡å™¨å°†æœç´¢ç»“æœä¸è¿™ä¸ªæ¶æ„è„šæœ¬æ‹¼æ¥åˆ°å“åº”é¡µé¢ä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚æµè§ˆå™¨åœ¨è§£æå“åº”é¡µé¢æ—¶ä¼šæ‰§è¡Œè¿™æ®µè„šæœ¬ï¼Œå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºâ€XSSæ”»å‡»æˆåŠŸï¼â€ã€‚è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„åå°„å‹XSSæ”»å‡»ç±»å‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261928258.png" alt="img"></p><h2 id="DOMå‹XSS"><a href="#DOMå‹XSS" class="headerlink" title="DOMå‹XSS"></a>DOMå‹XSS</h2><p><strong>DOMå‹XSSï¼šåŸºäºDOMæ–‡æ¡£å¯¹è±¡æ¨¡å‹çš„æ“ä½œï¼Œé€šè¿‡å‰ç«¯è„šæœ¬ä¿®æ”¹é¡µé¢çš„DOMèŠ‚ç‚¹å½¢æˆçš„xssï¼Œè¯¥æ“ä½œä¸ä¸æœåŠ¡å™¨ç«¯è¿›è¡Œäº¤äº’ï¼Œä¸”ä»£ç æ˜¯å¯è§çš„ï¼Œä»å‰ç«¯è·å–åˆ°DOMä¸­çš„æ•°æ®åœ¨æœ¬åœ°æ‰§è¡Œã€‚åªåœ¨å®¢æˆ·ç«¯è¿›è¡Œè§£æï¼Œä¸éœ€è¦æœåŠ¡å™¨çš„è§£æå“åº”ï¼Œæ˜¯å‰ç«¯JavaScriptè‡ªèº«å®‰å…¨æ¼æ´ã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261928867.png" alt="img"></p><h1 id="é¿å…XSSæ”»å‡»"><a href="#é¿å…XSSæ”»å‡»" class="headerlink" title="é¿å…XSSæ”»å‡»"></a>é¿å…XSSæ”»å‡»</h1><p>ä¸ºäº†é˜²æ­¢è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross-site scripting, XSSï¼‰å¯¹ç³»ç»Ÿå¸¦æ¥çš„å®‰å…¨å¨èƒï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é˜²å¾¡ç­–ç•¥ï¼š</p><ol><li>å¯¹ç”¨æˆ·è¾“å…¥åšå¥½è¿‡æ»¤å’Œè½¬ä¹‰å¤„ç†ï¼Œé¿å…è¢«ç›´æ¥æ‰§è¡Œä½œä¸ºè„šæœ¬ä»£ç ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨ä¸€äº›ç°æˆçš„åº“å’Œæ¡†æ¶æ¥å®ç°æ•°æ®è¿‡æ»¤å’Œè½¬ä¹‰ï¼Œä¾‹å¦‚OWASP ESAPIã€JQueryç­‰ã€‚</li><li>åœ¨è¯·æ±‚ä¸­åŒ…å«HTTPOnlyæ ‡è®°çš„cookieï¼Œé¿å…JavaScriptè„šæœ¬è·å–Cookieå€¼ã€‚</li><li>é…ç½®CSPï¼ˆContent-Security-Policyï¼‰å¤´éƒ¨ï¼Œé™åˆ¶é¡µé¢èµ„æºçš„åŠ è½½å’Œæ‰§è¡Œï¼Œå‡å°‘XSSæ”»å‡»çš„å¯èƒ½æ€§ã€‚</li><li>ä½¿ç”¨ä½ç‰¹æƒè´¦å·å’Œæƒé™åˆ†ç¦»ç­–ç•¥ï¼Œé¿å…æ•æ„Ÿæ“ä½œçš„æ¶æ„æ‰§è¡Œå’Œç¯¡æ”¹é¡µé¢å†…å®¹ã€‚</li><li>åŠæ—¶æ›´æ–°è¡¥ä¸å’Œå‡çº§è½¯ä»¶ç‰ˆæœ¬ï¼Œä»¥æ¶ˆé™¤å¯èƒ½å­˜åœ¨çš„å®‰å…¨æ¼æ´ã€‚</li><li>å¯¹äºå‘ç”ŸXSSæ”»å‡»çš„ç½‘ç«™ï¼ŒåŠæ—¶æ¸…é™¤å’Œæ¢å¤å—å½±å“çš„æ•°æ®ï¼ŒåŒæ—¶åŠ å¼ºç›‘æ§å’Œæ—¥å¿—å®¡è®¡ï¼Œå¿«é€Ÿå‘ç°å¼‚å¸¸æƒ…å†µå¹¶è¿›è¡Œå¤„ç†ã€‚</li></ol><h1 id="é¡¹ç›®åº”ç”¨"><a href="#é¡¹ç›®åº”ç”¨" class="headerlink" title="é¡¹ç›®åº”ç”¨"></a>é¡¹ç›®åº”ç”¨</h1><p>åœ¨æ™ºæ…§åŠ æ²¹ç«™é¡¹ç›®ä¸­ï¼Œè®¾å®šäº†ä¸€ä¸ªXssè¿‡æ»¤å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * XSS filter.</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> chao.lu</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XssFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONTENT_SECURITY_POLICY_HEADER</span> <span class="operator">=</span> <span class="string">&quot;Content-Security-Policy&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONTENT_SECURITY_POLICY</span> <span class="operator">=</span> <span class="string">&quot;script-src &#x27;self&#x27;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        </span><br><span class="line">        response.setHeader(CONTENT_SECURITY_POLICY_HEADER, CONTENT_SECURITY_POLICY);</span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†ä»£ç é€šè¿‡æ·»åŠ äº†CSPå¤´éƒ¨æ¥é¢„é˜²XSSæ”»å‡»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Java </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>18 Nginx</title>
      <link href="/2025/02/26/18%20Nginx/"/>
      <url>/2025/02/26/18%20Nginx/</url>
      
        <content type="html"><![CDATA[<h1 id="18-Nginx"><a href="#18-Nginx" class="headerlink" title="18 Nginx"></a>18 Nginx</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://blog.csdn.net/weixin_43412762/article/details/135441281?ops_request_misc=%7B%22request_id%22:%22171524931716800178532041%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171524931716800178532041&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-135441281-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=nignx&spm=1018.2226.3001.4187">ä¸€æ–‡å¿«é€Ÿææ‡‚Nginx â€”â€” Nginx è¯¦è§£</a></li><li><a href="https://blog.csdn.net/fanjufei123456/article/details/128685801?ops_request_misc=%7B%22request_id%22:%22171524931716800178532041%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171524931716800178532041&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-128685801-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=nignx&spm=1018.2226.3001.4187">ã€Nginxã€‘å…¥é—¨çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿå•¦ï¼Œnginx ç®€ä»‹ã€å®‰è£…ã€å·¥ä½œåŸç†ã€å·¥ä½œæ–¹å¼ã€è¯¦è§£é…ç½®æ–‡ä»¶</a></li><li><a href="https://blog.csdn.net/qq_42402854/article/details/132843413?ops_request_misc=%7B%22request_id%22:%22171524972116800178511332%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171524972116800178511332&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-132843413-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=nignx%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6&spm=1018.2226.3001.4187">Nginxé…ç½®æ–‡ä»¶è¯¦è§£</a></li><li></li></ul><h2 id="Nginxç®€ä»‹"><a href="#Nginxç®€ä»‹" class="headerlink" title="Nginxç®€ä»‹"></a>Nginxç®€ä»‹</h2><blockquote><p>Nginx åŒ Apache ä¸€æ ·éƒ½æ˜¯ä¸€ç§ Web æœåŠ¡å™¨ã€‚åŸºäº REST æ¶æ„é£æ ¼ï¼Œä»¥ç»Ÿä¸€èµ„æºæè¿°ç¬¦ï¼ˆUniform Resources Identifierï¼‰URI æˆ–è€… ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resources Locatorï¼‰URL ä½œä¸ºæ²Ÿé€šä¾æ®ï¼Œé€šè¿‡ HTTP åè®® æä¾›å„ç§ç½‘ç»œæœåŠ¡ã€‚</p><p>Nginxæ˜¯ä¸€æ¬¾ è½»é‡çº§ çš„ WebæœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±äºå®ƒçš„å†…å­˜å ç”¨å°‘ï¼Œå¯åŠ¨æå¿«ï¼Œé«˜å¹¶å‘èƒ½åŠ›å¼ºï¼Œåœ¨äº’è”ç½‘é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨ã€‚</p></blockquote><p><strong>Nginx</strong>æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€çµæ´»å’Œå¯æ‰©å±•çš„<a href="https://so.csdn.net/so/search?q=Web&spm=1001.2101.3001.7020">Web</a>æœåŠ¡å™¨å’Œä»£ç†æœåŠ¡å™¨ï¼Œé€‚ç”¨äºå„ç§åœºæ™¯ï¼ŒåŒ…æ‹¬é™æ€æ–‡ä»¶æœåŠ¡ã€åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡å’ŒåŠ¨æ€å†…å®¹å¤„ç†ç­‰ã€‚</p><h2 id="æ­£å‘ä»£ç†-åå‘ä»£ç†"><a href="#æ­£å‘ä»£ç†-åå‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†&amp;åå‘ä»£ç†"></a>æ­£å‘ä»£ç†&amp;åå‘ä»£ç†</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261930286.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261930877.png" alt="img"></p><p>é€šè¿‡å›¾å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºä»–ä»¬ä¸¤è€…çš„åŒºåˆ«ã€‚</p><p>æ­£å‘ä»£ç†å°±æ˜¯ä»£ç†çš„ç”¨æˆ·ï¼Œè€Œä¸”ç”¨æˆ·æ˜¯çŸ¥é“è®¿é—®ç›®æ ‡æ˜¯å“ªä¸ªçš„ã€‚</p><p>åå‘ä»£ç†ä»£ç†çš„æ˜¯æœåŠ¡ç«¯ï¼Œè¿™å°±æ˜¯åå‘çš„æ„æ€ã€‚åŒæ—¶ç”¨æˆ·çš„è¯·æ±‚ä¼šè¢«å“ªä¸ªå¤„ç†æ˜¯ä¸æ¸…æ¥šçš„ï¼Œè¿™éƒ¨åˆ†å¯¹äºå®¢æˆ·ç«¯æ¥è¯´æ˜¯é€æ˜çš„ã€‚</p><p>åœ¨æ™ºæ…§åŠ æ²¹ç«™é¡¹ç›®ä¸­ä½¿ç”¨äº†åå‘ä»£ç†ï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œåå‘ä»£ç†å‘¢ï¼Ÿ</p><blockquote><p><strong>éšè—çœŸå®æœåŠ¡å™¨</strong>ï¼šé€šè¿‡åå‘ä»£ç†ï¼Œå¯ä»¥éšè—çœŸå®çš„æœåŠ¡å™¨æ¶æ„å’Œæ‹“æ‰‘ç»“æ„ï¼Œä½¿å¾—å®¢æˆ·ç«¯æ— æ³•ç›´æ¥è®¿é—®åˆ°åç«¯æœåŠ¡å™¨ã€‚è¿™æé«˜äº†æœåŠ¡å™¨çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢äº†ç›´æ¥æš´éœ²æœåŠ¡å™¨çš„ IP åœ°å€å’Œå†…éƒ¨ç»“æ„ã€‚</p><p><strong>ç¼“å­˜é™æ€å†…å®¹</strong>ï¼šåå‘ä»£ç†å¯ä»¥ç¼“å­˜é™æ€å†…å®¹ï¼Œä¾‹å¦‚å›¾ç‰‡ã€CSSã€JavaScript ç­‰ï¼Œä»è€Œå‡è½»åç«¯æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œå¹¶æé«˜ç½‘ç«™çš„è®¿é—®é€Ÿåº¦å’Œæ€§èƒ½ã€‚</p></blockquote><h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><p><strong>è´Ÿè½½å‡è¡¡</strong>ï¼ˆLoad Balanceï¼‰å…¶æ„æ€å°±æ˜¯åˆ†æ‘Šåˆ°å¤šä¸ªæ“ä½œå•å…ƒä¸Šè¿›è¡Œæ‰§è¡Œï¼Œä¾‹å¦‚WebæœåŠ¡å™¨ã€FTPæœåŠ¡å™¨ã€ä¼ä¸šå…³é”®åº”ç”¨æœåŠ¡å™¨å’Œå…¶å®ƒå…³é”®ä»»åŠ¡æœåŠ¡å™¨ç­‰ï¼Œä»è€Œå…±åŒå®Œæˆå·¥ä½œä»»åŠ¡ã€‚</p><blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼šç°æœ‰çš„è¯·æ±‚ä½¿æœåŠ¡å™¨å‹åŠ›å¤ªå¤§æ— æ³•æ‰¿å—ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦æ­å»ºä¸€ä¸ªæœåŠ¡å™¨é›†ç¾¤ï¼Œå»åˆ†æ‹…åŸå…ˆä¸€ä¸ªæœåŠ¡å™¨æ‰€æ‰¿å—çš„å‹åŠ›ï¼Œé‚£ç°åœ¨æˆ‘ä»¬æœ‰ABCDç­‰ç­‰å¤šå°æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¯·æ±‚åˆ†ç»™è¿™äº›æœåŠ¡å™¨ï¼Œä½†æ˜¯æœåŠ¡å™¨å¯èƒ½å¤§å°ä¹Ÿæœ‰è‡ªå·±çš„ä¸åŒï¼Œæ‰€ä»¥æ€ä¹ˆåˆ†ï¼Ÿå¦‚ä½•åˆ†é…æ›´å¥½ï¼Ÿåˆæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p></blockquote><p>Nginxå…³äºè´Ÿè½½å‡è¡¡çš„æ–¹å¼æœ‰ä¸‰ç§å®ç°æ–¹å¼</p><ol><li>è½®è¯¢æ³•</li></ol><p>é¡¾åæ€ä¹‰ï¼ŒæŒ‰ç…§æ—¶é—´é¡ºåºï¼Œè½®åˆ°è°äº†å°±æŠŠè¿™ä¸ªè¯·æ±‚äº¤ç»™è°å»å¤„ç†</p><ol><li>åŠ æƒè½®è¯¢</li></ol><p>æ¯ä¸ªæœåŠ¡å™¨æ¥æ”¶ä¸åŒæ•°é‡çš„è¯·æ±‚ï¼Œå³åˆ†é…æƒé‡ã€‚ä½†æ˜¯è¿™æ ·ä¼šå‡ºç°è¯·æ±‚è®¿é—®å…¶ä»–æœåŠ¡å™¨æ—¶ï¼Œæ²¡æœ‰è¯¥ç”¨æˆ·ç™»å½•ä¿¡æ¯çš„é—®é¢˜ã€‚</p><ol><li>ip_hash</li></ol><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ <code>ip_hash</code> æŒ‡ä»¤è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœå®¢æˆ·å·²ç»è®¿é—®äº†æŸä¸ªæœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·å†æ¬¡è®¿é—®æ—¶ï¼Œä¼šå°†è¯¥è¯·æ±‚é€šè¿‡<strong>å“ˆå¸Œç®—æ³•</strong>ï¼Œè‡ªåŠ¨å®šä½åˆ°è¯¥æœåŠ¡å™¨ã€‚æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—® <code>ip</code> çš„ <code>hash</code> ç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢<strong>å›ºå®šè®¿é—®</strong>ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³ <code>session</code> çš„é—®é¢˜ã€‚</p><h2 id="åŠ¨é™åˆ†ç¦»"><a href="#åŠ¨é™åˆ†ç¦»" class="headerlink" title="åŠ¨é™åˆ†ç¦»"></a>åŠ¨é™åˆ†ç¦»</h2><p> åŠ¨é™åˆ†ç¦»ï¼Œåœ¨æˆ‘ä»¬çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæœ‰äº›è¯·æ±‚æ˜¯éœ€è¦åå°å¤„ç†çš„ï¼Œæœ‰äº›è¯·æ±‚æ˜¯ä¸éœ€è¦ç»è¿‡åå°å¤„ç†çš„ï¼ˆå¦‚ï¼šcssã€htmlã€jpgã€ js ç­‰æ–‡ä»¶ï¼‰ï¼Œè¿™äº›ä¸éœ€è¦ç»è¿‡åå°å¤„ç†çš„æ–‡ä»¶ç§°ä¸º é™æ€æ–‡ä»¶ã€‚è®©åŠ¨æ€ç½‘ç«™é‡Œçš„åŠ¨æ€ç½‘é¡µæ ¹æ®ä¸€å®šè§„åˆ™æŠŠä¸å˜çš„èµ„æºå’Œç»å¸¸å˜çš„èµ„æºåŒºåˆ†å¼€ï¼ŒåŠ¨æ€èµ„æºåšå¥½äº†æ‹†åˆ†ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ® é™æ€èµ„æº çš„ç‰¹ç‚¹å°†å…¶åšç¼“å­˜æ“ä½œï¼Œä»¥æé«˜èµ„æºçš„å“åº”é€Ÿåº¦ã€‚</p><blockquote><p>å½“ç”¨æˆ·è¯·æ±‚ç›®æ ‡æ˜¯é™æ€æ•°æ®æ—¶ï¼Œè¿™æ—¶å€™å°±ä¸éœ€è¦è®©åç«¯å¯¹è¿™ä¸ªè¯·æ±‚å¤„ç†äº†ï¼Œå› ä¸ºé™æ€æ•°æ®æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥è®©Nginxç›´æ¥å¤„ç†ï¼Œå‡ä½æœåŠ¡ç«¯çš„å‹åŠ›ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261930115.png" alt="img"></p><h2 id="Nginxé…ç½®æ–‡ä»¶"><a href="#Nginxé…ç½®æ–‡ä»¶" class="headerlink" title="Nginxé…ç½®æ–‡ä»¶"></a>Nginxé…ç½®æ–‡ä»¶</h2><p>Nginxé…ç½®æ–‡ä»¶ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 nginx]# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ conf</span><br><span class="line">â”‚   â”œâ”€â”€ fastcgi.conf</span><br><span class="line">â”‚   â”œâ”€â”€ fastcgi.conf.default</span><br><span class="line">â”‚   â”œâ”€â”€ fastcgi_params</span><br><span class="line">â”‚   â”œâ”€â”€ fastcgi_params.default</span><br><span class="line">â”‚   â”œâ”€â”€ koi-utf</span><br><span class="line">â”‚   â”œâ”€â”€ koi-win</span><br><span class="line">â”‚   â”œâ”€â”€ mime.types</span><br><span class="line">â”‚   â”œâ”€â”€ mime.types.default</span><br><span class="line">â”‚   â”œâ”€â”€ nginx.conf</span><br><span class="line">â”‚   â”œâ”€â”€ nginx.conf.default</span><br><span class="line">â”‚   â”œâ”€â”€ nginx.conf.old</span><br><span class="line">â”‚   â”œâ”€â”€ scgi_params</span><br><span class="line">â”‚   â”œâ”€â”€ scgi_params.default</span><br><span class="line">â”‚   â”œâ”€â”€ uwsgi_params</span><br><span class="line">â”‚   â”œâ”€â”€ uwsgi_params.default</span><br><span class="line">â”‚   â””â”€â”€ win-utf</span><br><span class="line">â”œâ”€â”€ html</span><br><span class="line">â”‚   â”œâ”€â”€ 50x.html</span><br><span class="line">â”‚   â””â”€â”€ index.html</span><br><span class="line">â””â”€â”€ sbin</span><br><span class="line">    â””â”€â”€ nginx</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261930155.png" alt="img"></p><h3 id="Nginxä¸»é…ç½®æ–‡ä»¶"><a href="#Nginxä¸»é…ç½®æ–‡ä»¶" class="headerlink" title="Nginxä¸»é…ç½®æ–‡ä»¶"></a>Nginxä¸»é…ç½®æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 nginx]# cat ./conf/nginx.conf</span><br><span class="line"></span><br><span class="line"># 1ã€mainå…¨å±€å—ï¼ˆå…¨å±€è®¾ç½®ï¼‰ï¼Œ ä½œç”¨åŸŸæ˜¯å…¨å±€</span><br><span class="line"></span><br><span class="line">#Nginxç”¨æˆ·åŠç»„ï¼šç”¨æˆ· ç»„ã€‚windowä¸‹ä¸æŒ‡å®š</span><br><span class="line">#user  nobody;</span><br><span class="line">#å·¥ä½œè¿›ç¨‹ï¼šæ•°ç›®ã€‚æ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œé€šå¸¸ç­‰äºCPUæ•°é‡æˆ–è€…2å€äºCPUã€‚</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#é”™è¯¯æ—¥å¿—ï¼šå­˜æ”¾è·¯å¾„ã€‚</span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pidï¼ˆè¿›ç¨‹æ ‡è¯†ç¬¦ï¼‰ï¼šå­˜æ”¾è·¯å¾„ã€‚</span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"># 2ã€eventså—ï¼ˆnginxå·¥ä½œæ¨¡å¼ï¼‰</span><br><span class="line">events &#123;</span><br><span class="line">    #æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°é‡ã€‚æ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œå’Œå‰é¢å·¥ä½œè¿›ç¨‹é…åˆèµ·æ¥ç”¨ï¼Œå°½é‡å¤§ï¼Œä½†æ˜¯åˆ«æŠŠcpuè·‘åˆ°100%å°±è¡Œã€‚</span><br><span class="line">    #æ¯ä¸ªè¿›ç¨‹å…è®¸çš„æœ€å¤šè¿æ¥æ•°ï¼Œç†è®ºä¸Šæ¯å°nginxæœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ä¸ºã€‚worker_processes*worker_connections</span><br><span class="line">    worker_connections  1024;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 3ã€httpå—ï¼ˆhttpè®¾ç½®ï¼‰</span><br><span class="line">http &#123;</span><br><span class="line">          #è®¾å®šæ”¯æŒçš„mimeç±»å‹,ç±»å‹æŸ¥çœ‹./conf/mime.typesæ–‡ä»¶å®šä¹‰</span><br><span class="line">    include       mime.types;</span><br><span class="line">    # é»˜è®¤çš„ç±»å‹</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # æ—¥å¿—çš„æ ¼å¼</span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">          # è®¿é—®æ—¥å¿—è®°å½•</span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    # å¼€å¯ å‘é€æ–‡ä»¶</span><br><span class="line">    sendfile        on;</span><br><span class="line">    # å¼€å¯ TCP æ¨é€</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">          #è¿æ¥è¶…æ—¶æ—¶é—´ã€‚</span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">          # å¼€å¯å‹ç¼©æ–‡ä»¶</span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">        ## ====severå—ï¼ˆä¸»æœºè®¾ç½®ï¼‰</span><br><span class="line">    server &#123;</span><br><span class="line">            # æä¾›æœåŠ¡çš„ç«¯å£ï¼Œé»˜è®¤80</span><br><span class="line">        listen       80;</span><br><span class="line">        # æä¾›æœåŠ¡çš„åŸŸåä¸»æœºå</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">                # è®¿é—®æ—¥å¿—è®°å½• ä»¥åŠä½ç½®</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">                # locationå—ï¼ˆURLåŒ¹é…ï¼‰ï¼šæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">            # å¯¹ &quot;/&quot; å¯ç”¨åå‘ä»£ç†,ç¬¬ä¸€ä¸ªlocationåŒºå—å¼€å§‹                           </span><br><span class="line">        location / &#123;</span><br><span class="line">            #æœåŠ¡å¯åŠ¨ç›®å½• é»˜è®¤åœ¨nginxå®‰è£…ç›®å½•ä¸‹htmlç›®å½•</span><br><span class="line">            root   html;</span><br><span class="line">            # é»˜è®¤çš„é¦–é¡µæ–‡ä»¶ï¼Œå¤šä¸ªç”¨ç©ºæ ¼åˆ†å¼€</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">                # é”™è¯¯é¡µé¢è·¯ç”±</span><br><span class="line">        # å‡ºç°å¯¹åº”çš„httpçŠ¶æ€ç æ—¶ï¼Œä½¿ç”¨50x.htmlå›åº”å®¢æˆ·</span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # å°†æœåŠ¡å™¨é”™è¯¯é¡µé‡å®šå‘åˆ°é™æ€é¡µ/50x.html</span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;        </span><br><span class="line">        # locationåŒºå—å¼€å§‹ï¼Œè®¿é—®50x.html</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">                # æŒ‡å®šå¯¹åº”çš„ç«™ç‚¹ç›®å½•ä¸ºhtml</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # å®ä¾‹ å…¥ å°†è®¿é—®å°¾ç¼€ä¸º \.php è·³è½¬åˆ° 127.0.0.1</span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">                # å°†PHPè„šæœ¬ä¼ é€’ç»™æ­£åœ¨ä¾¦å¬127.0.0.1:9000çš„FastCGIæœåŠ¡å™¨</span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">                # æ‹’ç»è®¿é—®.htaccessæ–‡ä»¶ï¼Œå¦‚æœApacheçš„æ–‡æ¡£æ ¹</span><br><span class="line">        # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">        # concurs with nginx&#x27;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¯¹æ¯”çœ‹æ™ºæ…§åŠ æ²¹ç«™é¡¹ç›®ä¸­çš„Nginxçš„ä¸»é…ç½®æ–‡ä»¶ã€‚è¿™é‡Œæˆªå–äº†ä¸€æ®µï¼Œå…³é”®çš„å†…å®¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       8090;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        root   html/dashboard;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        location / &#123;                                                </span><br><span class="line">                    try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">                        <span class="comment"># å…è®¸è·¨åŸŸçš„è¯·æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰å˜é‡$http_originï¼Œ*è¡¨ç¤ºæ‰€æœ‰</span></span><br><span class="line">                    add_header <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> *;</span><br><span class="line">                    <span class="comment"># å…è®¸æºå¸¦cookieè¯·æ±‚</span></span><br><span class="line">                    add_header <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">                    <span class="comment"># å…è®¸è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ï¼šGET,POST,OPTIONS,PUT</span></span><br><span class="line">                    add_header <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="string">&#x27;GET,POST,OPTIONS,PUT&#x27;</span>;</span><br><span class="line">                    <span class="comment"># å…è®¸è¯·æ±‚æ—¶æºå¸¦çš„å¤´éƒ¨ä¿¡æ¯ï¼Œ*è¡¨ç¤ºæ‰€æœ‰</span></span><br><span class="line">                    add_header <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> *;</span><br><span class="line">                    <span class="comment"># å…è®¸å‘é€æŒ‰æ®µè·å–èµ„æºçš„è¯·æ±‚</span></span><br><span class="line">                    add_header <span class="string">&#x27;Access-Control-Expose-Headers&#x27;</span> <span class="string">&#x27;Content-Length,Content-Range&#x27;</span>;</span><br><span class="line">                    <span class="comment"># ä¸€å®šè¦æœ‰ï¼ï¼ï¼å¦åˆ™Postè¯·æ±‚æ— æ³•è¿›è¡Œè·¨åŸŸï¼</span></span><br><span class="line">                    <span class="comment"># åœ¨å‘é€Postè·¨åŸŸè¯·æ±‚å‰ï¼Œä¼šä»¥Optionsæ–¹å¼å‘é€é¢„æ£€è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥å—æ—¶æ‰ä¼šæ­£å¼è¯·æ±‚</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$request_method</span> = <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">                        add_header <span class="string">&#x27;Access-Control-Max-Age&#x27;</span> 1728000;</span><br><span class="line">                        add_header <span class="string">&#x27;Content-Type&#x27;</span> <span class="string">&#x27;text/plain; charset=utf-8&#x27;</span>;</span><br><span class="line">                        add_header <span class="string">&#x27;Content-Length&#x27;</span> 0;</span><br><span class="line">                        <span class="comment"># å¯¹äºOptionsæ–¹å¼çš„è¯·æ±‚è¿”å›204ï¼Œè¡¨ç¤ºæ¥å—è·¨åŸŸè¯·æ±‚</span></span><br><span class="line">                        <span class="built_in">return</span> 204;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">                        location /gas &#123;</span><br><span class="line">                        rewrite /gas/(.+)$ /<span class="variable">$1</span> <span class="built_in">break</span>;</span><br><span class="line">                        proxy_pass http://192.168.0.29:59999;</span><br><span class="line">                        proxy_set_header Host <span class="variable">$proxy_host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">                &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>proxy_pass <a href="http://192.168.0.29:59999;è¿™é‡Œå°†åŠ¨æ€è¯·æ±‚äº¤ç»™ipä¸º192.168.0.25ç«¯å£å·59999çš„æœåŠ¡è¿›è¡Œå¤„ç†ã€‚">http://192.168.0.29:59999;è¿™é‡Œå°†åŠ¨æ€è¯·æ±‚äº¤ç»™ipä¸º192.168.0.25ç«¯å£å·59999çš„æœåŠ¡è¿›è¡Œå¤„ç†ã€‚</a></p><p>IPæ˜¯æˆ‘æœ¬æœºçš„ipåœ°å€ï¼Œå¦‚æœéœ€è¦åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šè¿è¡Œï¼Œéœ€è¦åœ¨è¿™é‡ŒæŠŠipåœ°å€æ”¹æˆä½ è‡ªå·±çš„ipåœ°å€ã€‚ç«¯å£å·æ˜¯æ™ºæ…§åŠ æ²¹ç«™ç½‘å…³å¾®æœåŠ¡çš„ç«¯å£å·ï¼Œæ‰€æœ‰çš„åŠ¨æ€è¯·æ±‚ä¸€å¾‹äº¤ç»™ç½‘å…³è¿›è¡Œå¤„ç†ã€‚</p></blockquote><p>å¦‚æœæŠŠç½‘ç«™çœ‹æˆä¸€ä¸ªå…¬å¸ï¼Œç°åœ¨ä½ æ‹›äº†ä¸€ä¸ªNginxçš„å‘˜å·¥ï¼Œå½“ä»–å…¥èŒçš„é‚£å¤©ï¼Œä»–ä¼šç»™ä½ å‡ å¼ çº¸æ¡ï¼ˆé…ç½®æ–‡ä»¶ï¼‰ã€‚è¯·ä½ åœ¨ä¸Šé¢å†™ä¸Šä»–çš„å·¥ä½œå†…å®¹ã€‚å³ä»–éœ€è¦ç›‘å¬å“ªäº›è¯·æ±‚ï¼ˆIPï¼šç«¯å£å·ï¼‰ï¼Œè¿™äº›ç«¯å£å·åˆ†é…ç»™å“ªäº›æœåŠ¡ï¼ˆIPï¼šç«¯å£å·ï¼‰ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡ŒæŒ‡å®šå³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>17 Spring Cloud Gateway</title>
      <link href="/2025/02/26/17%20Spring%20Cloud%20Gateway/"/>
      <url>/2025/02/26/17%20Spring%20Cloud%20Gateway/</url>
      
        <content type="html"><![CDATA[<h1 id="17-Spring-Cloud-Gateway"><a href="#17-Spring-Cloud-Gateway" class="headerlink" title="17 Spring Cloud Gateway"></a>17 Spring Cloud Gateway</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li>[Spring Cloud Gateway æœåŠ¡ç½‘å…³çš„éƒ¨ç½²ä¸ä½¿ç”¨è¯¦ç»†ä»‹ç»_gatewayç½‘å…³-CSDNåšå®¢](<a href="https://blog.csdn.net/a745233700/article/details/122917167?ops_request_misc=%7B%22request_id%22:%22171524649116800180640296%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171524649116800180640296&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-122917167-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=spring">https://blog.csdn.net/a745233700/article/details/122917167?ops_request_misc=%7B%22request%5Fid%22%3A%22171524649116800180640296%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=171524649116800180640296&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-122917167-null-null.142^v100^pc_search_result_base1&amp;utm_term=spring</a> gateway&amp;spm&#x3D;1018.2226.3001.4187)</li><li><a href="https://www.cnblogs.com/tellerfuliye/articles/14302596.html">https://www.cnblogs.com/tellerfuliye/articles/14302596.html</a></li></ol><h2 id="ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³"><a href="#ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³" class="headerlink" title="ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³"></a>ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³</h2><p>åœ¨æœåŠ¡ç½‘å…³å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡è¿˜æ˜¯åŸºäºä¼ ç»Ÿçš„å•ä½“æ¶æ„ï¼Œå³æˆ‘ä»¬çš„ä¸šåŠ¡éƒ½æ”¾åœ¨ä¸€ä¸ªå¾®æœåŠ¡ä¸­ã€‚éšç€è®¡ç®—æœºçš„å‘å±•ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œè¿™æ—¶å€™å¦‚æœæŠŠæ‰€æœ‰ä¸šåŠ¡éƒ½æ”¾åœ¨ä¸€ä¸ªå¾®æœåŠ¡ä¸­ï¼Œå¾ˆéš¾å»ç»´æŠ¤ï¼Œé‚£ä¹ˆå°±æå‡ºäº†å¾®æœåŠ¡æ¶æ„ï¼Œå³æŠŠä¸€ä¸ªç³»ç»Ÿåˆ’åˆ†æˆå¤šä¸ªå¾®æœåŠ¡ã€‚</p><p>ä½†æ˜¯æŠŠç³»ç»Ÿåˆ’åˆ†å¤šä¸ªå¾®æœåŠ¡åä¼šå‡ºç°ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„é—®é¢˜ã€‚å‰ç«¯è°ƒç”¨ä¸€ä¸ªåç«¯æ¥å£æ—¶å°±éœ€è¦çŸ¥é“è¿™ä¸ªæ¥å£åœ¨å“ªä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªå¾®æœåŠ¡çš„åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚å°±æ˜¯ä¸€ä¸ªäººå¸¦ç€æ¶ˆæ¯æ¥åˆ°äº†æˆ‘ä»¬çš„å°åŒºï¼Œä½†æ˜¯è¿™ä¸ªæ¶ˆæ¯è¯¥ç»™è°å‘¢ï¼Ÿè¿™ä¸ªäººå¾—å»è‡ªå·±å¯»æ‰¾åœ°å€ï¼Œè¿™ä¸ªå·¥ä½œé‡å¾ˆå¤§ã€‚</p><p>è¿™æ—¶å€™äººä»¬å°±æå‡ºäº†ç½‘å…³çš„æ¦‚å¿µï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ç½‘å…³å‘¢ï¼Ÿæˆ‘ä»¬ç®€å•çš„ç†è§£ï¼Œç½‘å…³å°±æ˜¯æˆ‘ä»¬å°åŒºé—¨å£çš„é—¨å«ã€‚å½“å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå³è¿™ä¸ªè¯·æ±‚äººå¸¦ç€æ¶ˆæ¯æ¥åˆ°äº†æˆ‘ä»¬å°åŒºï¼Œè¯¢é—®é—¨å«è¿™ä¸ªæ¶ˆæ¯è¯¥ç»™è°ï¼Œé—¨å«ä¸€çœ‹æ¶ˆæ¯å¤´ï¼Œå°±ç›´æ¥æŠŠåœ°å€å‘ŠçŸ¥äº†è¿™ä¸ªè¯·æ±‚äººã€‚è¿™æ ·æ˜¯ä¸æ˜¯ç®€å•äº†äº›ã€‚</p><p>é‚£ä¹ˆè¿™æ ·å‰ç«¯çš„æ‰€æœ‰è¯·æ±‚éƒ½å¯ä»¥ç›´æ¥ç»™è¿™ä¸ªç½‘å…³ï¼ˆé—¨å«ï¼‰ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯çš„å·¥ä½œã€‚</p><h2 id="æœåŠ¡ç½‘å…³çš„åŸºæœ¬åŠŸèƒ½"><a href="#æœåŠ¡ç½‘å…³çš„åŸºæœ¬åŠŸèƒ½" class="headerlink" title="æœåŠ¡ç½‘å…³çš„åŸºæœ¬åŠŸèƒ½"></a>æœåŠ¡ç½‘å…³çš„åŸºæœ¬åŠŸèƒ½</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261929869.png" alt="img"></p><h2 id="æµé‡ç½‘å…³-æœåŠ¡ç½‘å…³"><a href="#æµé‡ç½‘å…³-æœåŠ¡ç½‘å…³" class="headerlink" title="æµé‡ç½‘å…³&amp;æœåŠ¡ç½‘å…³"></a>æµé‡ç½‘å…³&amp;æœåŠ¡ç½‘å…³</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261929405.png" alt="img"></p><p>ä»è¿™ä¸ªå›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ä»€ä¹ˆå—ï¼Ÿå¾ˆæ˜æ˜¾æµé‡ç½‘å…³å…ˆäºæœåŠ¡ç½‘å…³ï¼Œé‚£ä¹ˆæµé‡ç½‘å…³çš„ä½œç”¨ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ¥çœ‹ä¸ªæ¯”å–»ï¼š</p><blockquote><p>æœåŠ¡ç½‘å…³å°±åƒæ˜¯é…’åº—å¤§å ‚çš„é—¨ç«¥ï¼Œè´Ÿè´£å¼•å¯¼å®¢äººåˆ°æ­£ç¡®çš„æœåŠ¡åŒºåŸŸï¼›è€Œæµé‡ç½‘å…³åˆ™æ˜¯å¤§å ‚å¤–çš„æ£€æŸ¥ç«™ï¼Œè´Ÿè´£è¿‡æ»¤å’Œå¤„ç†ä¸åŒæ¥æºçš„æµé‡ï¼Œç¡®ä¿åªæœ‰åˆæ³•çš„æµé‡èƒ½å¤Ÿè¿›å…¥åˆ°æœåŠ¡ç½‘å…³ä¹‹åçš„æœåŠ¡åŒºåŸŸã€‚</p></blockquote><p>å³æµé‡ç½‘å…³éœ€è¦è¿‡æ»¤æ‰æ‰€æœ‰éæ³•çš„æµé‡ï¼Œç¡®ä¿åªæœ‰æ­£ç¡®çš„è¯·æ±‚æ¶ˆæ¯è¿›å…¥æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚</p><h2 id="æœåŠ¡ç½‘å…³ç±»å‹å¯¹æ¯”"><a href="#æœåŠ¡ç½‘å…³ç±»å‹å¯¹æ¯”" class="headerlink" title="æœåŠ¡ç½‘å…³ç±»å‹å¯¹æ¯”"></a>æœåŠ¡ç½‘å…³ç±»å‹å¯¹æ¯”</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261929445.png" alt="img"></p><h2 id="Spring-Cloud-Gatewayç½‘å…³æ­å»º"><a href="#Spring-Cloud-Gatewayç½‘å…³æ­å»º" class="headerlink" title="Spring Cloud Gatewayç½‘å…³æ­å»º"></a>Spring Cloud Gatewayç½‘å…³æ­å»º</h2><p>æˆ‘ä»¬ä»¥æ™ºæ…§åŠ æ²¹ç«™é¡¹ç›®ä¸­çš„ç½‘å…³å¾®æœåŠ¡ä¸ºä¾‹ï¼Œæ¥ä»‹ç»ä¸€ä¸‹Gatewayç½‘å…³æ­å»ºçš„è¿‡ç¨‹ã€‚</p><h3 id="æ·»åŠ Gatewayç½‘å…³ä¾èµ–"><a href="#æ·»åŠ Gatewayç½‘å…³ä¾èµ–" class="headerlink" title="æ·»åŠ Gatewayç½‘å…³ä¾èµ–"></a>æ·»åŠ Gatewayç½‘å…³ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è®°å¾—çŸ¥åç‰ˆæœ¬å·ã€‚</p><blockquote><p>å¯èƒ½éœ€è¦åœ¨è¿™ä¸ªä¾èµ–é‡Œæ’é™¤spring-boot-starter-webä¾èµ–ï¼Œä¸ç„¶å¯èƒ½å‡ºç°å¯åŠ¨é”™è¯¯</p><!-- å¼•å…¥gatewayç½‘å…³ --><dependency><p>â€‹        <groupId>org.springframework.cloud</groupId></p><p>â€‹        <artifactId>spring-cloud-starter-gateway</artifactId></p><p>â€‹        <exclusions></p><p>â€‹        <exclusion></p><p>â€‹                        <groupId>org.springframework.boot</groupId></p><p>â€‹                <artifactId>spring-boot-starter-web</artifactId></p><p>â€‹        </exclusion></p><p>â€‹    </exclusions></p></dependency></blockquote><h3 id="Spring-Cloud-Gatewayé…ç½®é¡¹"><a href="#Spring-Cloud-Gatewayé…ç½®é¡¹" class="headerlink" title="Spring Cloud Gatewayé…ç½®é¡¹"></a>Spring Cloud Gatewayé…ç½®é¡¹</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      # è·¯ç”±æ•°ç»„ï¼šæŒ‡å½“è¯·æ±‚æ»¡è¶³ä»€ä¹ˆæ ·çš„æ–­è¨€æ—¶ï¼Œè½¬å‘åˆ°å“ªä¸ªæœåŠ¡ä¸Š</span><br><span class="line">      routes:</span><br><span class="line">        # è·¯ç”±æ ‡è¯†ï¼Œè¦æ±‚å”¯ä¸€ï¼Œåç§°ä»»æ„</span><br><span class="line">        - id: gateway-provider_1</span><br><span class="line">                  # è¯·æ±‚æœ€ç»ˆè¢«è½¬å‘åˆ°çš„ç›®æ ‡åœ°å€</span><br><span class="line">          uri: http://localhost:9024</span><br><span class="line">          # è®¾ç½®æ–­è¨€</span><br><span class="line">          predicates:</span><br><span class="line">            # Path Route Predicate Factory æ–­è¨€ï¼Œæ»¡è¶³ /gateway/provider/** è·¯å¾„çš„è¯·æ±‚éƒ½ä¼šè¢«è·¯ç”±åˆ° http://localhost:9024 è¿™ä¸ªuriä¸­</span><br><span class="line">            - Path=/gateway/provider/**</span><br><span class="line">            # Weight Route Predicate Factory æ–­è¨€ï¼ŒåŒä¸€åˆ†ç»„æŒ‰ç…§æƒé‡è¿›è¡Œåˆ†é…æµé‡ï¼Œè¿™é‡Œåˆ†é…äº†80%</span><br><span class="line">            # ç¬¬ä¸€ä¸ªgroup1æ˜¯åˆ†ç»„åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æƒé‡</span><br><span class="line">            - Weight=group1, 8</span><br><span class="line">          # é…ç½®è¿‡æ»¤å™¨ï¼ˆå±€éƒ¨ï¼‰</span><br><span class="line">          filters:</span><br><span class="line">            # StripPrefixï¼šå»é™¤åŸå§‹è¯·æ±‚è·¯å¾„ä¸­çš„å‰1çº§è·¯å¾„ï¼Œå³/gateway</span><br><span class="line">            - StripPrefix=1            </span><br><span class="line">            </span><br><span class="line">        - id: gateway-provider_2</span><br><span class="line">          uri: http://localhost:9025</span><br><span class="line">          # è®¾ç½®æ–­è¨€</span><br><span class="line">          predicates:</span><br><span class="line">            - Path=/gateway/provider/**</span><br><span class="line">            # Weight Route Predicate Factoryï¼ŒåŒä¸€åˆ†ç»„æŒ‰ç…§æƒé‡è¿›è¡Œåˆ†é…æµé‡ï¼Œè¿™é‡Œåˆ†é…äº†20%</span><br><span class="line">            - Weight=group1, 2</span><br><span class="line">                  # é…ç½®è¿‡æ»¤å™¨ï¼ˆå±€éƒ¨ï¼‰</span><br><span class="line">          filters:</span><br><span class="line">            # StripPrefixï¼šå»é™¤åŸå§‹è¯·æ±‚è·¯å¾„ä¸­çš„å‰1çº§è·¯å¾„ï¼Œå³/gateway</span><br><span class="line">            - StripPrefix=1            </span><br></pre></td></tr></table></figure><h2 id="Spring-Security-Spring-Gateway"><a href="#Spring-Security-Spring-Gateway" class="headerlink" title="Spring Security&amp;Spring Gateway"></a>Spring Security&amp;Spring Gateway</h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åˆ†å¸ƒå¼å¼€å‘æ—¶ï¼Œå¾®æœåŠ¡ä¼šæœ‰å¾ˆå¤šï¼Œä½†æ˜¯ç½‘å…³æ˜¯è¯·æ±‚çš„ç¬¬ä¸€å…¥å£ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šæŠŠå®¢æˆ·ç«¯è¯·æ±‚çš„æƒé™éªŒè¯ç»Ÿä¸€æ”¾åœ¨ç½‘å…³è¿›è¡Œè®¤è¯ä¸é‰´æƒã€‚SpringCloud Gateway ä½œä¸º Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ Zuulï¼Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼Œ<strong>SpringCloud Gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„</strong>ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Nettyã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261929908.webp" alt="img"></p><p>åœ¨SpringGatewayä¸­å·²ç»ä¾èµ–äº†Web Fluxï¼Œæ‰€ä»¥æ‰ä¼šæœ‰gatewayä¸­ä¸èƒ½ä¾èµ–Webï¼Œå¦åˆ™ä¼šæœ‰ä¸¤ä¸ªWebä»è€Œé€ æˆå†²çªã€‚</p><p>å¦‚æœéœ€è¦åœ¨gatewayä¸­å¼•å…¥Securityï¼Œé‚£ä¹ˆSecurityå°±éœ€è¦ä½¿ç”¨Web Fluxæ¥å®ç°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261929890.png" alt="image-20240718103823906"></p><p>é¦–å…ˆéœ€è¦é…ç½®@EnableWebFluxSecurityæ³¨è§£ï¼Œå¼€å¯Spring WebFlux Securityçš„æ”¯æŒ</p><h3 id="Securityé…ç½®"><a href="#Securityé…ç½®" class="headerlink" title="Securityé…ç½®"></a>Securityé…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.demo.comfangdemogateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fang.demo.comfangdemogateway.filter.ScFilter;</span><br><span class="line"><span class="keyword">import</span> com.fang.demo.comfangdemogateway.handler.ScAccessDeniedHandler;</span><br><span class="line"><span class="keyword">import</span> com.fang.demo.comfangdemogateway.handler.ScAuthenticationEntryPoint;</span><br><span class="line"><span class="keyword">import</span> com.fang.demo.comfangdemogateway.manager.ScAuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> com.fang.demo.comfangdemogateway.manager.ScAuthorizationManager;</span><br><span class="line"><span class="keyword">import</span> com.fang.demo.comfangdemogateway.repository.ScSecurityContextRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.reactive.EnableWebFluxSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.web.server.SecurityWebFiltersOrder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.web.server.ServerHttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.server.SecurityWebFilterChain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fangyaohui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 0.0.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> WebSecurityConfig SpringSecurityæ ¸å¿ƒé…ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/7/17 22:29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebFluxSecurity</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> &#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    @Resource</span></span><br><span class="line"><span class="comment">//    PasswordEncoder passwordEncoder;</span></span><br><span class="line"></span><br><span class="line">    ScSecurityContextRepository scSecurityContextRepository;</span><br><span class="line"></span><br><span class="line">    ScAuthenticationManager scAuthenticationManager;</span><br><span class="line"></span><br><span class="line">    ScAuthorizationManager scAuthorizationManager;</span><br><span class="line"></span><br><span class="line">    ScAccessDeniedHandler scAccessDeniedHandler;</span><br><span class="line"></span><br><span class="line">    ScAuthenticationEntryPoint scAuthenticationEntryPoint;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¿é—®æƒé™æˆæƒ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> http</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityWebFilterChain <span class="title function_">springSecurityFilterChain</span><span class="params">(ServerHttpSecurity http)</span> &#123;</span><br><span class="line">        http.csrf().disable()</span><br><span class="line">                .securityContextRepository(scSecurityContextRepository) <span class="comment">//å­˜å‚¨è®¤è¯ä¿¡æ¯</span></span><br><span class="line">                .authenticationManager(scAuthenticationManager) <span class="comment">//è®¤è¯ç®¡ç†</span></span><br><span class="line">                .authorizeExchange(exchange -&gt; exchange <span class="comment">// è¯·æ±‚æ‹¦æˆªå¤„ç†</span></span><br><span class="line">                        .pathMatchers(<span class="string">&quot;/favicon.ico&quot;</span>, <span class="string">&quot;/userw/**&quot;</span>).permitAll()</span><br><span class="line">                        .pathMatchers(HttpMethod.OPTIONS).permitAll()</span><br><span class="line">                        .anyExchange().access(scAuthorizationManager) <span class="comment">//æƒé™</span></span><br><span class="line">                )</span><br><span class="line">                .addFilterAfter(<span class="keyword">new</span> <span class="title class_">ScFilter</span>(), SecurityWebFiltersOrder.AUTHORIZATION) <span class="comment">//æ‹¦æˆªå¤„ç†</span></span><br><span class="line">                .exceptionHandling().accessDeniedHandler(scAccessDeniedHandler) <span class="comment">//æƒé™è®¤è¯å¤±è´¥</span></span><br><span class="line">                .and()</span><br><span class="line">                .exceptionHandling().authenticationEntryPoint(scAuthenticationEntryPoint); <span class="comment">//è®¤è¯å¤±è´¥</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé…ç½®æ˜¯ä¸ºäº†å‘ŠçŸ¥è¿™ä¸ªæœåŠ¡éœ€è¦æ”¯æŒSecurityï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261929619.png" alt="image-20240718112834137"></p><h3 id="è®¤è¯å¤„ç†é€»è¾‘"><a href="#è®¤è¯å¤„ç†é€»è¾‘" class="headerlink" title="è®¤è¯å¤„ç†é€»è¾‘"></a>è®¤è¯å¤„ç†é€»è¾‘</h3><p>åœ¨AuthenticationManagerä¸­è´Ÿè´£ä»è¯·æ±‚å¤´ä¸­è¯»å–Tokenï¼Œå¹¶éªŒè¯å½“å‰Tokenæ˜¯å¦æ­£ç¡®å’Œæ˜¯å¦åœ¨æœ‰æ•ˆæœŸä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.demo.comfangdemogateway.manager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.ReactiveAuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> po.UserInfoPO;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fangyaohui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 0.0.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> ScAuthenticationManager ä»AuthenticationTokenä¸­è¯»å–Tokenå¹¶åšç”¨æˆ·æ•°æ®åˆ†æ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/7/17 22:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScAuthenticationManager</span> <span class="keyword">implements</span> <span class="title class_">ReactiveAuthenticationManager</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Authentication&gt; <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">tokenString</span> <span class="operator">=</span> (String) authentication.getPrincipal();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¡éªŒTokenæ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="type">UserInfoPO</span> <span class="variable">user</span> <span class="operator">=</span> parseToken(tokenString);</span><br><span class="line">        log.info(<span class="string">&quot;ScAuthenticationManager scUser = &#123;&#125;&quot;</span>, user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Mono.just(authentication).map(auth -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(user, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¡éªŒtoken</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tokenString</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoPO <span class="title function_">parseToken</span><span class="params">(String tokenString)</span> &#123;</span><br><span class="line">        <span class="comment">//è¯»å–token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> getJwtToken(tokenString);</span><br><span class="line">        log.info(<span class="string">&quot;ScAuthenticationManager jwtToken = &#123;&#125;&quot;</span>, jwtToken);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿè®¤è¯æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(jwtToken) &amp;&amp; jwtToken.startsWith(<span class="string">&quot;a&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">UserInfoPO</span> <span class="variable">userInfoPO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInfoPO</span>();</span><br><span class="line">            userInfoPO.setId(<span class="number">2L</span>);</span><br><span class="line">            userInfoPO.setUserName(<span class="string">&quot;fangyaohui&quot;</span>);</span><br><span class="line">            userInfoPO.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">            userInfoPO.setRoleId(<span class="number">1L</span>);</span><br><span class="line">            <span class="keyword">return</span> userInfoPO;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–Jwt Token</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authorization</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getJwtToken</span><span class="params">(String authorization)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(authorization)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">valid</span> <span class="operator">=</span> authorization.startsWith(<span class="string">&quot;Bearer &quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!valid) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> authorization.replace(<span class="string">&quot;Bearer &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‰´æƒå¤„ç†é€»è¾‘"><a href="#é‰´æƒå¤„ç†é€»è¾‘" class="headerlink" title="é‰´æƒå¤„ç†é€»è¾‘"></a>é‰´æƒå¤„ç†é€»è¾‘</h3><p> ScAuthorizationManager æƒé™éªŒè¯ æ˜¯å¦é€šè¿‡ï¼Œåœ¨ä¸‹é¢çš„ä»£ç ä¸­æ²¡æœ‰å®ç°å…·ä½“çš„é‰´æƒé€»è¾‘ï¼Œåœ¨åç»­çš„å¼€å‘ä¸­å¯ä»¥æ ¹æ®å…·ä½“çš„æƒ…å†µæ¥è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.demo.comfangdemogateway.manager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authorization.AuthorizationDecision;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authorization.ReactiveAuthorizationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.server.authorization.AuthorizationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> po.UserInfoPO;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fangyaohui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 0.0.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> ScAuthorizationManager æƒé™éªŒè¯ æ˜¯å¦é€šè¿‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/7/17 22:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScAuthorizationManager</span> <span class="keyword">implements</span> <span class="title class_">ReactiveAuthorizationManager</span>&lt;AuthorizationContext&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;AuthorizationDecision&gt; <span class="title function_">check</span><span class="params">(Mono&lt;Authentication&gt; authentication, AuthorizationContext object)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> authentication.map(auth -&gt; &#123;</span><br><span class="line">            <span class="type">UserInfoPO</span> <span class="variable">userInfoPO</span> <span class="operator">=</span> (UserInfoPO) auth.getPrincipal();</span><br><span class="line">            log.info(<span class="string">&quot;ScAuthorizationManager scUser = &#123;&#125;&quot;</span>, userInfoPO);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Objects.isNull(userInfoPO)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthorizationDecision</span>(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthorizationDecision</span>(<span class="literal">true</span>);</span><br><span class="line">        &#125;).defaultIfEmpty(<span class="keyword">new</span> <span class="title class_">AuthorizationDecision</span>(<span class="literal">false</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ScSecurityContextRepository"><a href="#ScSecurityContextRepository" class="headerlink" title="ScSecurityContextRepository"></a>ScSecurityContextRepository</h3><p>è¯»å–è¯·æ±‚å¤´ä¸­çš„Tokenæ”¾å…¥AuthenticationTokenä¸­ï¼Œæ–¹ä¾¿åç»­çš„è®¤è¯å’Œé‰´æƒæœåŠ¡ç›´æ¥è·å–åˆ°Tokenã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.demo.comfangdemogateway.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fang.demo.comfangdemogateway.manager.ScAuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.server.context.ServerSecurityContextRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fangyaohui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 0.0.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> ScSecurityContextRepository æŠŠheaderæ‹¿åˆ°çš„tokenæ”¾å…¥AuthenticationToken</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/7/17 22:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScSecurityContextRepository</span> <span class="keyword">implements</span> <span class="title class_">ServerSecurityContextRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ScAuthenticationManager scAuthenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">save</span><span class="params">(ServerWebExchange exchange, SecurityContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.empty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;SecurityContext&gt; <span class="title function_">load</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> request.getHeaders().getFirst(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;ScSecurityContextRepository authorization = &#123;&#125;&quot;</span>, authorization);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> scAuthenticationManager</span><br><span class="line">                .authenticate(<span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(authorization, <span class="literal">null</span>))</span><br><span class="line">                .map(SecurityContextImpl::<span class="keyword">new</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è®¤è¯å¤±è´¥-é‰´æƒå¤±è´¥"><a href="#è®¤è¯å¤±è´¥-é‰´æƒå¤±è´¥" class="headerlink" title="è®¤è¯å¤±è´¥&amp;é‰´æƒå¤±è´¥"></a>è®¤è¯å¤±è´¥&amp;é‰´æƒå¤±è´¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.demo.comfangdemogateway.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.buffer.DataBuffer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.AccessDeniedException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.server.authorization.ServerAccessDeniedHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fangyaohui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 0.0.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> ScAccessDeniedHandler æƒé™è®¤è¯å¤±è´¥æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/7/17 22:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScAccessDeniedHandler</span> <span class="keyword">implements</span> <span class="title class_">ServerAccessDeniedHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(ServerWebExchange exchange, AccessDeniedException denied)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        response.setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">        response.getHeaders().add(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json; charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;000000&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;æœªæˆæƒç¦æ­¢è®¿é—®&quot;</span>);</span><br><span class="line"></span><br><span class="line">        log.error(<span class="string">&quot;access forbidden path=&#123;&#125;&quot;</span>, exchange.getRequest().getPath());</span><br><span class="line"></span><br><span class="line">        <span class="type">DataBuffer</span> <span class="variable">dataBuffer</span> <span class="operator">=</span> response.bufferFactory().wrap(JSON.toJSONBytes(map));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response.writeWith(Mono.just(dataBuffer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.demo.comfangdemogateway.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilterChain;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fangyaohui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 0.0.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> ScFilter è¯·æ±‚é€šè¿‡åçš„é¢å¤–æ“ä½œå¤„ç†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2024/7/17 22:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;UserFilter doing.... path=&#123;&#125;&quot;</span>, exchange.getRequest().getPath());</span><br><span class="line"></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="keyword">if</span>(!Objects.isNull(authentication))&#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">principal</span> <span class="operator">=</span> authentication.getPrincipal();</span><br><span class="line">            log.info(<span class="string">&quot;UserFilter doing principal=&#123;&#125;&quot;</span>, principal);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p>æ‰§è¡Œçš„å…ˆåé¡ºåºï¼š</p><ol><li>ScSecurityContextRepository ä»è¯·æ±‚å¤´ä¸­è¯»å–Tokenæ”¾å…¥AuthenticationTokenä¸­ï¼›</li><li>ScAuthenticationManager è¯»å–TokenéªŒè¯å½“å‰Tokenæ˜¯å¦æœ‰æ•ˆæ­£ç¡®ï¼›</li><li>ScAuthorizationManager éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®è¯¥èµ„æºï¼›</li><li>å¦‚æœç¬¬2å’Œç¬¬3æ²¡æœ‰æƒé™è®¿é—®ï¼Œåˆ™ä¼šæ‰§è¡Œå¯¹åº”çš„å¤±è´¥å¤„ç†é€»è¾‘ï¼›</li><li>ScFilter Security è¿‡æ»¤å™¨ï¼›</li><li>gatewayè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ï¼›</li><li>è½¬å‘è¯·æ±‚ã€‚</li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åœ¨SpringGatewayå¼•å…¥SpringSecurityçš„æ•´ä¸ªæµç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰SecurityæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰ä¸€ä¸ªSecurityé…ç½®ç±»ï¼Œæ¥ç€å®šä¹‰ä»è¯·æ±‚å¤´ä¸­è¯»å–Tokenå¹¶æ”¾å…¥AuthenticationTokenä¸­çš„æœåŠ¡ï¼Œç„¶åå®šä¹‰è®¤è¯å’Œæˆæƒå¤„ç†é€»è¾‘ï¼Œæ¥ç€å®šä¹‰è®¤è¯å’Œæˆæƒå¤±è´¥å¤„ç†é€»è¾‘ï¼Œæœ€åå®šä¹‰æ‹¦æˆªå™¨ï¼Œæ•´ä¸ªæµç¨‹å°±å¾ˆæ¸…æ™°äº†ã€‚</p><h2 id="Spring-Cloud-Gatewayé‡åˆ°çš„é—®é¢˜"><a href="#Spring-Cloud-Gatewayé‡åˆ°çš„é—®é¢˜" class="headerlink" title="Spring Cloud Gatewayé‡åˆ°çš„é—®é¢˜"></a>Spring Cloud Gatewayé‡åˆ°çš„é—®é¢˜</h2><h3 id="reactor-netty-http-client-PrematureCloseException-Connection-prematurely-closed-BEFORE-responseè§£å†³æ–¹æ¡ˆ"><a href="#reactor-netty-http-client-PrematureCloseException-Connection-prematurely-closed-BEFORE-responseè§£å†³æ–¹æ¡ˆ" class="headerlink" title="reactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE responseè§£å†³æ–¹æ¡ˆ"></a>reactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE responseè§£å†³æ–¹æ¡ˆ</h3><p>åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261929572.png" alt="image-20240927231313622"></p><p>åœ¨è¯·æ±‚ç½‘å…³è·å–å›¾ç‰‡çš„æ—¶å€™ï¼Œæœ‰æ—¶å¯ä»¥æˆåŠŸï¼Œæœ‰æ—¶å¤±è´¥ï¼Œçœ‹å›¾ä¸­æœ€ä¸‹é¢åŒæ ·çš„ä¸€ä¸ªè¯·æ±‚å´åˆè¯·æ±‚æˆåŠŸäº†ã€‚</p><p>åˆ°ç½‘å…³å»æŸ¥çœ‹åŸå› ï¼Œç½‘å…³æŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">reactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE response</span><br><span class="line"></span><br><span class="line">2024-09-27 23:01:49.100 ERROR 19536 --- [ctor-http-nio-4] a.w.r.e.AbstractErrorWebExceptionHandler : [bd934039-327]  500 Server Error for HTTP GET &quot;/api/blog/resource/getImage/61e8acd8-d6d4-40d0-b77d-c841cb57e861_1727081923177.png&quot;</span><br><span class="line"></span><br><span class="line">reactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE response</span><br><span class="line">Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: </span><br><span class="line">Error has been observed at the following site(s):</span><br><span class="line">*__checkpoint â‡¢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ com.fang.screw.gateway.filter.ScFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ org.springframework.security.web.server.authorization.AuthorizationWebFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ org.springframework.security.web.server.authorization.ExceptionTranslationWebFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ org.springframework.security.web.server.authentication.logout.LogoutWebFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ org.springframework.security.web.server.savedrequest.ServerRequestCacheWebFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ org.springframework.security.web.server.context.SecurityContextServerWebExchangeWebFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ org.springframework.security.web.server.context.ReactorContextWebFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ org.springframework.security.web.server.header.HttpHeaderWriterWebFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ com.fang.screw.gateway.filter.DecryptFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ org.springframework.security.config.web.server.ServerHttpSecurity$ServerWebExchangeReactorContextWebFilter [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ org.springframework.security.web.server.WebFilterChainProxy [DefaultWebFilterChain]</span><br><span class="line">*__checkpoint â‡¢ HTTP GET &quot;/api/blog/resource/getImage/61e8acd8-d6d4-40d0-b77d-c841cb57e861_1727081923177.png&quot; [ExceptionHandlingWebHandler]</span><br><span class="line">Original Stack Trace:</span><br></pre></td></tr></table></figure><p>å¼€å§‹ä»¥ä¸ºæ˜¯å‰ç«¯è®¾ç½®çš„è¿‡æœŸæ—¶é—´å¤ªçŸ­äº†ï¼Œå°±é‡æ–°è®¾ç½®ï¼Œæ— æœï¼Œæ•…å¼€å§‹æŸ¥è¯¢ç›¸å…³èµ„æ–™æ¥æ‰¾åˆ°è¯¥åŸå› ã€‚</p><p>æœç´¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE response</span><br></pre></td></tr></table></figure><p>ä¸€ç¯‡åšå®¢ï¼š<a href="https://blog.csdn.net/rickiyeat/article/details/107900585">reactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE responseè§£å†³æ–¹æ¡ˆ</a></p><p>é—®é¢˜ä¸åœ¨äºSpringCloudGatewayï¼Œè€Œæ˜¯åœ¨äºReactor-Nettyï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261929527.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261929204.png" alt="image-20240927232117438"></p><p>è¿™é‡Œä½¿ç”¨ä¸€ä¸ªSpring Bootå†…ç½®Tomcatä½œä¸ºæœåŠ¡æä¾›æ–¹ï¼Œç”¨æˆ·é€šè¿‡SCGè®¿é—®ï¼ŒSCGä»£ç†è¯·æ±‚ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSCGå†…éƒ¨åˆ›å»ºçš„è¿æ¥æ˜¯ä¸ä¼šè¢«å›æ”¶çš„ï¼Œä¸€ç›´å­˜åœ¨äºå†…å­˜ä¸­ï¼Œè€ŒSpring Bootå†…ç½®çš„Tomcatä¸ä¸€æ ·ï¼Œé»˜è®¤åœ¨20sä¹‹åæ²¡æœ‰æ•°æ®äº¤äº’ï¼Œä¾¿ä¼šå›æ”¶æ‰è¿™ä¸ªè¿æ¥ï¼Œåœ¨å›æ”¶çš„æ—¶å€™æ°å·§ç¢°åˆ°åˆæ¥äº†è¯·æ±‚ï¼Œåˆšå¥½åˆåœ¨SCGæ‹¿åˆ°è¿™ä¸ªè¿æ¥æ¥å°è¯•è¯·æ±‚Tomcatï¼Œå°±ä¼šå‡ºç°è¿™ä¸ªå¼‚å¸¸ã€‚</p><p>æ‰€ä»¥ï¼Œä¸è¦æŒ‡æœ›åœ¨Reactor-Nettyæˆ–æ˜¯SCGä¸­è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™éœ€è¦ç½‘å…³å’Œåç«¯æœåŠ¡é…åˆè§£å†³ï¼Œæœ€å¤§é™åº¦ä¸å‡ºç°è¿™ä¸ªå¼‚å¸¸ã€‚</p><p>è§£å†³æ–¹æ¡ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬1æ­¥ã€åŠ å…¥JVMå‚æ•°ï¼š</span><br><span class="line">-Dreactor.netty.pool.leasingStrategy=lifo</span><br><span class="line"></span><br><span class="line">ç¬¬2æ­¥ã€SCGæ–°å¢é…ç½®ï¼š</span><br><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      httpclient:</span><br><span class="line">        pool:</span><br><span class="line">          max-idle-time: 1</span><br><span class="line">          max-life-time: 1000</span><br><span class="line">          max-connections: 10</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>21-1 è€å¹´å¥åº·å›¾è°±</title>
      <link href="/2025/02/26/21-1%20%E8%80%81%E5%B9%B4%E5%81%A5%E5%BA%B7%E5%9B%BE%E8%B0%B1/"/>
      <url>/2025/02/26/21-1%20%E8%80%81%E5%B9%B4%E5%81%A5%E5%BA%B7%E5%9B%BE%E8%B0%B1/</url>
      
        <content type="html"><![CDATA[<h1 id="21-1-è€å¹´å¥åº·å›¾è°±"><a href="#21-1-è€å¹´å¥åº·å›¾è°±" class="headerlink" title="21-1 è€å¹´å¥åº·å›¾è°±"></a>21-1 è€å¹´å¥åº·å›¾è°±</h1><p>è€å¹´å¥åº·æ•°æ®æŒ‡æ ‡ï¼š</p><ul><li><a href="https://opendata.pku.edu.cn/dataverse/CHADS">https://opendata.pku.edu.cn/dataverse/CHADS</a></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261935670.png" alt="image-20240628094306969"></p><ul><li><p><a href="http://health.ruc.edu.cn/zwwz/sjzy_x/dcsj/5168445c40b941cf9b7eeed850e86c76.htm">ä¸­å›½è€å¹´å¥åº·è°ƒæŸ¥ï¼ˆChinese Longitudinal Healthy Longevity Survey, CLHLSï¼‰</a></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261935626.png" alt="image-20240628101604274"></p></li><li><p><a href="https://cloud.tencent.com/developer/article/2326023">å¤æ—¦å¤§å­¦å›¢é˜Ÿå‘å¸ƒä¸­æ–‡åŒ»ç–—å¥åº·ä¸ªäººåŠ©æ‰‹ï¼ŒåŒæ—¶å¼€æº47ä¸‡é«˜è´¨é‡æ•°æ®é›†</a></p><ul><li>Github åœ°å€ï¼š<a href="https://github.com/FudanDISC/DISC-MedLLM">https://github.com/FudanDISC/DISC-MedLLM</a><br><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261935316.png" alt="image-20240628102024025"></li></ul></li><li><p><a href="https://www.idea.edu.cn/news/1652.html">BIOSé‡ç£…æ›´æ–°ï¼åƒä¸‡çº§åŒ»å­¦çŸ¥è¯†å›¾è°±æ­£å¼å‘å¸ƒ</a></p><ul><li>BIOS 2022V2ç‰ˆæ•°æ®é›†ä¸‹è½½åœ°å€ï¼š<a href="https://bios.www.idea.edu.cn/Download">https://bios.www.idea.edu.cn/Download</a></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261935324.png" alt="image-20240628102212226"></p><ul><li><a href="https://kns-cnki-net-s.sslvpn.ecust.edu.cn:8118/kcms2/article/abstract?v=RkYMyaebi8VFtxJ5bUbY3hhdDyI1X_yLEML3olMG3QZhhE79wkSnhuTmJ-PQ3QLZrqsB76S40ujsOaMgXybd4oLMAMqPJJNTWN0-s28995MS4jsSSLldmU6b08uJLRaYVfUfUGAHwOCA7NWi_T80QQ==&uniplatform=NZKPT&language=CHS">è€å¹´äººåŒ»ç–—ä½“æ£€æ•°æ®çš„åˆ†æåŠè¯„ä»·</a></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261935601.png" alt="image-20240628175022622"></p><ul><li><a href="https://kns-cnki-net-s.sslvpn.ecust.edu.cn:8118/kcms2/article/abstract?v=RkYMyaebi8XDW41FBzDTBxzBfXsIWcko-6F_XxbbQ_WopjfgJswS5rRF2cbTZ2CIqzFnJpei9BHgy-tR_DS3keNzhYN2uyhXL-N12RkA6bDKwRuxvBPPuE8VS8G6xxSaruREBS85UJ4KcEFGTNdmBw==&uniplatform=NZKPT&language=CHS">ä¸­å›½è€å¹´äººå¥åº·çŠ¶å†µåŠå½±å“å› ç´ åˆ†æâ€”â€”åŸºäºç¬¬8è½®CLHLSæ•°æ®</a></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261935452.png" alt="image-20240628175555716"></p><p><a href="https://gitee.com/jason921121/Chinese_medical_NLP#https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fzhangsheng93%2FcMedQA2">åŒ»ç–—NLPé¢†åŸŸï¼ˆä¸»è¦å…³æ³¨ä¸­æ–‡ï¼‰ è¯„æµ‹æ•°æ®é›† ä¸ è®ºæ–‡ç­‰ç›¸å…³èµ„æºã€‚</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261936575.png" alt="image-20240702102316697"></p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20 BUGè®°å½•</title>
      <link href="/2025/02/26/20%20BUG%E8%AE%B0%E5%BD%95/"/>
      <url>/2025/02/26/20%20BUG%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="20-BUGè®°å½•"><a href="#20-BUGè®°å½•" class="headerlink" title="20 BUGè®°å½•"></a>20 BUGè®°å½•</h1><h2 id="1ã€SpringBootã€Spring-Cloud-Alibabaå’ŒSpring-Cloudç‰ˆæœ¬å¯¹åº”"><a href="#1ã€SpringBootã€Spring-Cloud-Alibabaå’ŒSpring-Cloudç‰ˆæœ¬å¯¹åº”" class="headerlink" title="1ã€SpringBootã€Spring Cloud Alibabaå’ŒSpring Cloudç‰ˆæœ¬å¯¹åº”"></a>1ã€SpringBootã€Spring Cloud Alibabaå’ŒSpring Cloudç‰ˆæœ¬å¯¹åº”</h2><p>è¿™ä¸‰ä¸ªç‰ˆæœ¬å…·æœ‰å¯¹åº”å…³ç³»ï¼Œæ³¨æ„ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹æ€§ã€‚è¯¦ç»†å¯¹åº”å…³ç³»è¯·æŸ¥çœ‹ï¼š<a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E">ç‰ˆæœ¬è¯´æ˜</a></p><h2 id="2ã€NacosæœåŠ¡æœªæ³¨å†Œ"><a href="#2ã€NacosæœåŠ¡æœªæ³¨å†Œ" class="headerlink" title="2ã€NacosæœåŠ¡æœªæ³¨å†Œ"></a>2ã€NacosæœåŠ¡æœªæ³¨å†Œ</h2><p>åœ¨SpringBootä¸­å¼•å…¥Nacosä¾èµ–åï¼Œéœ€è¦åŒæ ·å¼•å…¥ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸ç„¶ä¼šå‡ºç°nacosæœåŠ¡æœªæ³¨å†Œçš„æƒ…å†µã€‚</p><h2 id="3ã€æœºåœºåç«¯Nacosæ— æ³•æ­£å¸¸å¯åŠ¨"><a href="#3ã€æœºåœºåç«¯Nacosæ— æ³•æ­£å¸¸å¯åŠ¨" class="headerlink" title="3ã€æœºåœºåç«¯Nacosæ— æ³•æ­£å¸¸å¯åŠ¨"></a>3ã€æœºåœºåç«¯Nacosæ— æ³•æ­£å¸¸å¯åŠ¨</h2><p>é—®é¢˜æè¿°ï¼š</p><p>found character â€˜@â€™ that cannot start any token. (Do not use @ for indentation)</p><p> in â€˜readerâ€™, line 49, column 18:</p><p>â€‹          namespace: @profiles.active@</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261934224.png" alt="img"></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>æ›´æ”¹è¿™éƒ¨åˆ†ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261934127.png" alt="img"></p><p>æŠŠè¿™éƒ¨åˆ†æ›´æ”¹ä¸ºå¦‚ä¸‹å›¾ï¼Œé‡æ–°åˆ·æ–°Mavenï¼Œè¿˜æ˜¯ä¸è¡Œå°±é‡å¯IDEAã€‚</p><p>ç›´æ¥æŠŠä¸Šå›¾æ ‡è®°çš„åˆ é™¤ï¼Œé‡å¯å¯åŠ¨ä¹Ÿå¯ä»¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261934742.png" alt="img"></p><p>æ¥æºï¼š<a href="https://www.cnblogs.com/lxl57610/p/16599947.html">found character â€˜@â€˜ that cannot start any token. è§£å†³æ–¹æ¡ˆ - ææ…•ç™½520 - åšå®¢å›­</a></p><h2 id="4ã€SpringBooté¡¹ç›®ç«¯å£å·å¼‚å¸¸"><a href="#4ã€SpringBooté¡¹ç›®ç«¯å£å·å¼‚å¸¸" class="headerlink" title="4ã€SpringBooté¡¹ç›®ç«¯å£å·å¼‚å¸¸"></a>4ã€SpringBooté¡¹ç›®ç«¯å£å·å¼‚å¸¸</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261934383.png" alt="img"></p><p>åœ¨è¿™ä¸ªæœåŠ¡ä¸­ï¼Œæˆ‘åœ¨ymlæ–‡ä»¶ä¸­è®¾ç½®äº†ç«¯å£å·ï¼Œä½†æ˜¯æœåŠ¡å¯åŠ¨æ—¶ç«¯å£å·æœªç”Ÿæ•ˆï¼Œä¾æ—§è¿˜æ˜¯8080ï¼Œä¸»è¦åŸå› å…¥ä¸Šå›¾ç‰‡æ‰€ç¤ºã€‚</p><p>è§£é‡Šå¦‚ä¸‹ï¼š</p><blockquote><p>åœ¨ Maven çš„ <code>pom.xml</code> æ–‡ä»¶ä¸­ï¼Œ<code>&lt;packaging&gt;</code> å…ƒç´ æŒ‡å®šäº†é¡¹ç›®çš„æ‰“åŒ…æ–¹å¼ã€‚ä¸åŒçš„ <code>&lt;packaging&gt;</code> å€¼å®šä¹‰äº†ä¸åŒçš„é¡¹ç›®ç±»å‹å’Œæ„å»ºç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠæœ€ç»ˆç”Ÿæˆçš„åˆ¶å“ï¼ˆartifactï¼‰çš„ç±»å‹ã€‚å¸¸è§çš„ <code>&lt;packaging&gt;</code> ç±»å‹åŒ…æ‹¬ <code>jar</code>ã€<code>war</code>ã€<code>ear</code> ç­‰ï¼Œåˆ†åˆ«å¯¹åº” Java åº”ç”¨ç¨‹åºã€Web åº”ç”¨ç¨‹åºå’Œä¼ä¸šåº”ç”¨ç¨‹åºç­‰ã€‚</p><ul><li><strong><code>&lt;packaging&gt;pom&lt;/packaging&gt;</code></strong>ï¼šå½“ <code>&lt;packaging&gt;</code> è®¾ç½®ä¸º <code>pom</code> æ—¶ï¼Œè¿™é€šå¸¸æ„å‘³ç€è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªå¤šæ¨¡å—é¡¹ç›®çš„çˆ¶é¡¹ç›®ï¼ˆä¹Ÿç§°ä¸ºèšåˆé¡¹ç›®ï¼‰ã€‚è¿™ç§ç±»å‹çš„é¡¹ç›®æœ¬èº«ä¸ç”Ÿæˆå¯åˆ†å‘çš„åˆ¶å“ï¼Œè€Œæ˜¯ç”¨äºç»„ç»‡å’Œç®¡ç†å­æ¨¡å—çš„æ„å»ºå’Œä¾èµ–ã€‚<code>pom</code> æ‰“åŒ…ç±»å‹çš„é¡¹ç›®é€šå¸¸ä¸åŒ…å«å®é™…çš„ä»£ç å®ç°ï¼Œè€Œæ˜¯ç”¨æ¥å®šä¹‰æ„å»ºé€»è¾‘å’Œä¾èµ–ç®¡ç†ã€‚</li></ul></blockquote><p>é‚£ä¹ˆè¿™æ ·å°±ä¼šå¯¼è‡´é…ç½®æ–‡ä»¶æœªç”Ÿæ•ˆã€‚</p><h2 id="5ã€SpringBootä½¿ç”¨-ComponentScançš„Controllerå¤±æ•ˆåŸå› åˆ†æ"><a href="#5ã€SpringBootä½¿ç”¨-ComponentScançš„Controllerå¤±æ•ˆåŸå› åˆ†æ" class="headerlink" title="5ã€SpringBootä½¿ç”¨@ComponentScançš„Controllerå¤±æ•ˆåŸå› åˆ†æ"></a>5ã€SpringBootä½¿ç”¨@ComponentScançš„Controllerå¤±æ•ˆåŸå› åˆ†æ</h2><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://fyzn12.github.io/post/spring-boot/componentscan%E6%B3%A8%E8%A7%A3%E5%AF%BC%E8%87%B4controller%E5%A4%B1%E6%95%88/">https://fyzn12.github.io/post/spring-boot/componentscan%E6%B3%A8%E8%A7%A3%E5%AF%BC%E8%87%B4controller%E5%A4%B1%E6%95%88/</a></p><h2 id="6ã€è§£å†³Gitè¿æ¥å¤±è´¥ï¼šFailed-to-connect-to-github-com-port-443-after-21090-ms-Couldnâ€˜t-connect-to-server-â€"><a href="#6ã€è§£å†³Gitè¿æ¥å¤±è´¥ï¼šFailed-to-connect-to-github-com-port-443-after-21090-ms-Couldnâ€˜t-connect-to-server-â€" class="headerlink" title="6ã€è§£å†³Gitè¿æ¥å¤±è´¥ï¼šFailed to connect to github.com port 443 after 21090 ms: Couldnâ€˜t connect to server â€"></a>6ã€è§£å†³Gitè¿æ¥å¤±è´¥ï¼šFailed to connect to github.com port 443 after 21090 ms: Couldnâ€˜t connect to server â€</h2><p><a href="https://cloud.tencent.com/developer/article/2405656">https://cloud.tencent.com/developer/article/2405656</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy 127.0.0.1:&lt;ä½ çš„ç«¯å£å·&gt;</span><br><span class="line">git config --global https.proxy 127.0.0.1:&lt;ä½ çš„ç«¯å£å·&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>21-2 è¡Œäººé‡è¯†åˆ«</title>
      <link href="/2025/02/26/21-2%20%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB/"/>
      <url>/2025/02/26/21-2%20%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="21-2-è¡Œäººé‡è¯†åˆ«"><a href="#21-2-è¡Œäººé‡è¯†åˆ«" class="headerlink" title="21-2 è¡Œäººé‡è¯†åˆ«"></a>21-2 è¡Œäººé‡è¯†åˆ«</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><h3 id="2022-IVC-è¡Œäººå†è¯†åˆ«ç»¼è¿°"><a href="#2022-IVC-è¡Œäººå†è¯†åˆ«ç»¼è¿°" class="headerlink" title="2022 IVC è¡Œäººå†è¯†åˆ«ç»¼è¿°"></a>2022 IVC è¡Œäººå†è¯†åˆ«ç»¼è¿°</h3><p>åŸæ–‡åœ°å€ï¼š<a href="https://www.cnblogs.com/wangchangshuo/p/16148992.html">https://www.cnblogs.com/wangchangshuo/p/16148992.html</a></p><h3 id="SpikingResformerï¼šResNet-Transformer-ç»“åˆåˆ›æ–°"><a href="#SpikingResformerï¼šResNet-Transformer-ç»“åˆåˆ›æ–°" class="headerlink" title="SpikingResformerï¼šResNet + Transformer ç»“åˆåˆ›æ–°"></a>SpikingResformerï¼šResNet + Transformer ç»“åˆåˆ›æ–°</h3><p>åŸæ–‡åœ°å€ï¼š<a href="https://developer.volcengine.com/articles/7382255559967244298">https://developer.volcengine.com/articles/7382255559967244298</a></p><p>ä»£ç åœ°å€ï¼š<a href="https://github.com/xyshi2000/SpikingResformer">https://github.com/xyshi2000/SpikingResformer</a></p><h4 id="æ¨¡å‹ä»‹ç»"><a href="#æ¨¡å‹ä»‹ç»" class="headerlink" title="æ¨¡å‹ä»‹ç»"></a>æ¨¡å‹ä»‹ç»</h4><p><strong>ResNetå› å…¶æ·±å±‚ç»“æ„å’Œæ®‹å·®è¿æ¥ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°ä»å›¾åƒä¸­æå–å‡ºä¸°å¯Œçš„å±€éƒ¨ç‰¹å¾ã€‚åŒæ—¶ï¼ŒTransformerçš„è‡ªæ³¨æ„åŠ›æœºåˆ¶èƒ½å¤Ÿæ•æ‰å›¾åƒä¸­çš„é•¿</strong> <strong>è·ç¦»ä¾èµ–å…³ç³»ï¼Œä¸ºæ¨¡å‹æä¾›å…¨å±€ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</strong></p><p>é«˜æ€§èƒ½ä½å‚æ•°çš„SpikingResformeré‡‡ç”¨äº†ResNet + Transformerç»“åˆçš„ç­–ç•¥ã€‚</p><p>è¿™ç§ç­–ç•¥ç»“åˆäº†ä¸¤è€…åˆ†åˆ«åœ¨å¤„ç†ç©ºé—´ã€åºåˆ—æ•°æ®ä¸Šçš„ä¼˜åŠ¿ï¼Œå¼ºåŒ–äº†æ¨¡å‹ç‰¹å¾æå–å’Œå…¨å±€ç†è§£æ–¹é¢çš„èƒ½åŠ›,è®©æ¨¡å‹åœ¨ä¿æŒå¼ºå¤§çš„å±€éƒ¨åˆ†æèƒ½åŠ›çš„åŒæ—¶,ä¹Ÿèƒ½å¤Ÿåˆ©ç”¨å…¨å±€ä¿¡æ¯æ¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚</p><p>SpikingResformerï¼šResNet + Vision Transformer</p><h4 id="æ¨¡å‹æ€è·¯"><a href="#æ¨¡å‹æ€è·¯" class="headerlink" title="æ¨¡å‹æ€è·¯"></a>æ¨¡å‹æ€è·¯</h4><p>è„‰å†²è‡ªæ³¨æ„åŠ›æœºåˆ¶ çš„å±€é™ï¼š</p><p><strong>å°½ç®¡ç°æœ‰æ–¹æ³•æå‡ºäº†ä¸SNNå…¼å®¹çš„è„‰å†²è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œä½†å®ƒä»¬ç¼ºä¹åˆç†çš„ç¼©æ”¾æ–¹æ³•ï¼Œä¸”è¿™äº›æ–¹æ³•æ‰€æå‡ºçš„æ•´ä½“æ¶æ„åœ¨æœ‰æ•ˆæå–å±€éƒ¨ç‰¹å¾æ–¹é¢å­˜åœ¨ç“¶é¢ˆã€‚</strong></p><ul><li><strong>åŸå› ä¸€ï¼šç¼ºä¹åˆç†çš„ç¼©æ”¾æ–¹æ³•ã€‚</strong></li><li><strong>åŸå› äºŒï¼šæœªèƒ½æœ‰æ•ˆæå–å±€éƒ¨ç‰¹å¾ã€‚</strong></li></ul><p>åŒè„‰å†²è‡ªæ³¨æ„åŠ›ï¼ˆDSSAï¼‰ï¼š</p><p>æ€»ä¹‹ï¼ŒåŒè„‰å†²è‡ªæ³¨æ„åŠ›é€šè¿‡å¼•å…¥è„‰å†²ä¿¡å·çš„æ¦‚å¿µï¼Œä¼˜åŒ–äº†ä¼ ç»Ÿè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—è¿‡ç¨‹ï¼Œä½¿å…¶åœ¨å¤„ç†æ—¶é—´åºåˆ—æ•°æ®æ—¶æ›´åŠ é«˜æ•ˆå’Œå‡†ç¡®ã€‚</p><p>ä¸ºäº†åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œæå‡ºäº†ä¸€ç§åä¸ºåŒè„‰å†²è‡ªæ³¨æ„åŠ›ï¼ˆDSSAï¼‰çš„æ–°å‹è„‰å†²è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå¹¶é™„å¸¦ä¸€ç§åˆç†çš„ç¼©æ”¾æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261937011.png" alt="image-20240904142155444"></p><h4 id="ä¸ªäººçœ‹æ³•"><a href="#ä¸ªäººçœ‹æ³•" class="headerlink" title="ä¸ªäººçœ‹æ³•"></a>ä¸ªäººçœ‹æ³•</h4><p>è¯¥æ¨¡å‹é€šè¿‡èåˆäº†ResNetå’ŒTransformerå¾—åˆ°äº†ä¸€ä¸ªæ–°çš„æ¨¡å‹ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å¯ä»¥å°†è¿™ä¸ªå¾—åˆ°çš„æ¨¡å‹ç”¨äºåœ¨è¡Œäººé‡è¯†åˆ«ä¸Šï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ•ˆæœå‘¢ï¼Ÿ</p><p>å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œå†™å‡ºæ¥çš„è®ºæ–‡æ˜¯å¦å¯ä»¥å‘è¡¨å‘¢ï¼Ÿæ˜¯å¦å¯ä»¥åœ¨åŸæ¥çš„æ¨¡å‹åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹å‘¢ï¼Ÿ</p><p>å®éªŒæ˜¯å¦å¯ä»¥è·‘å‡ºæ¥å‘¢ï¼Ÿæ¥ä¸‹æ¥çš„é‡ç‚¹å®éªŒå°±æ˜¯æŠŠè¿™ä¸ªæ¨¡å‹è·‘åœ¨è¡Œäººé‡è¯†åˆ«çš„æ•°æ®é›†ä¸Šã€‚</p><h2 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h2><h3 id="Swin-Transformer"><a href="#Swin-Transformer" class="headerlink" title="Swin Transformer"></a>Swin Transformer</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/weixin_45508265/article/details/134773753">https://blog.csdn.net/weixin_45508265/article/details/134773753</a></p><h4 id="æ¡ˆä¾‹1â€”â€”ä½¿ç”¨Swin-Transformer-è®­ç»ƒCIFAR-10"><a href="#æ¡ˆä¾‹1â€”â€”ä½¿ç”¨Swin-Transformer-è®­ç»ƒCIFAR-10" class="headerlink" title="æ¡ˆä¾‹1â€”â€”ä½¿ç”¨Swin Transformer è®­ç»ƒCIFAR 10"></a>æ¡ˆä¾‹1â€”â€”ä½¿ç”¨Swin Transformer è®­ç»ƒCIFAR 10</h4><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li><a href="https://blog.csdn.net/weixin_45508265/article/details/134773753">https://blog.csdn.net/weixin_45508265/article/details/134773753</a></li><li><a href="https://blog.csdn.net/blockshowtouse/article/details/128706276?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Ctr-1-128706276-blog-134773753.235%5Ev43%5Epc_blog_bottom_relevance_base8&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Ctr-1-128706276-blog-134773753.235%5Ev43%5Epc_blog_bottom_relevance_base8&utm_relevant_index=2">ä½¿ç”¨Swin-Transformerè¿›è¡ŒCIFAR10æ•°æ®é›†çš„è®­ç»ƒ</a></li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261937072.png" alt="image-20240905152507351"></p><h2 id="Reid"><a href="#Reid" class="headerlink" title="Reid"></a>Reid</h2><p><a href="https://github.com/layumi/Person_reID_baseline_pytorch?tab=readme-ov-file">https://github.com/layumi/Person_reID_baseline_pytorch?tab=readme-ov-file</a></p><h3 id="æ¢è£…Reid"><a href="#æ¢è£…Reid" class="headerlink" title="æ¢è£…Reid"></a>æ¢è£…Reid</h3><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li><a href="https://blog.csdn.net/z240626191s/article/details/139841361?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~YuanLiJiHua~Position-2-139841361-blog-106785977.235%5Ev43%5Epc_blog_bottom_relevance_base8&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~YuanLiJiHua~Position-2-139841361-blog-106785977.235%5Ev43%5Epc_blog_bottom_relevance_base8&utm_relevant_index=5">Reidç³»åˆ—è®ºæ–‡å­¦ä¹ â€”â€”æ¢è£…Reid</a></li><li>è®ºæ–‡é“¾æ¥ï¼š<a href="https://opus.lib.uts.edu.au/bitstream/10453/137156/4/Binder1.pdf">https://opus.lib.uts.edu.au/bitstream/10453/137156/4/Binder1.pdf</a></li><li>Codeé“¾æ¥ï¼š<a href="https://github.com/Huang-3/Celeb-reID">https://github.com/Huang-3/Celeb-reID</a></li></ol><p>å¤§å¤šæ•°Reidçš„ç ”ç©¶éƒ½èšé›†åœ¨äººå‘˜å‡ ä¹ä¸ä¼šæ›´æ¢è¡£æœçš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯è¯´é’ˆå¯¹äººå‘˜æ¥è¯´ï¼Œæ•°æ®åˆ†å¸ƒç›¸ä¼¼åº¦æ˜¯æ¯”è¾ƒå¤§çš„ã€‚ä½†åœ¨ä¸€äº›åœºæ™¯ä¸­äººå‘˜æ˜¯æœ‰å¯èƒ½æ¢è¡£æœçš„ï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚åœ¨è¿½å¯»ä¸€ä¸ªå«Œç–‘äººï¼Œè¯¥å«Œç–‘äººåœ¨Aåœºæ™¯ç©¿çš„çº¢è‰²è¡£æœï¼Œå½“ä»–è¿›å…¥Båœºæ™¯åæ¢äº†ä¸€ä»¶é»‘è¡£æœï¼Œé‚£ä¹ˆç”¨ä¼ ç»Ÿçš„æ–¹æ³•å¯èƒ½å°±ä¸å¤ªè¡Œäº†ã€‚</p><p>å› æ­¤è¿™ç¯‡æ–‡ç« ä¸»è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•é’ˆå¯¹è¿™ç§æ¢è£…åœºæ™¯ä¸‹ä¹Ÿèƒ½å®ç°è¡Œäººé‡è¯†åˆ«ã€‚</p><p>æ–‡ç« å°†ä¼ ç»Ÿçš„ç ”ç©¶ä»»åŠ¡(åŒä¸€ä¸ªäººä¸åŒè§’åº¦ä½†ä¸ä¼šæ›´æ¢è¡£æœ)ç§°ä¸ºshort-term ReIDã€‚å°†è‡ªå·±çš„ç ”ç©¶ç§°ä¸ºlong-term ReIDã€‚</p><p>æ–‡ç« çš„è´¡çŒ®æœ‰ä¸¤ç‚¹ï¼š</p><pre><code>    1.åˆ¶ä½œäº†â€œæ¢è£…â€æ•°æ®é›†(Celeb-reid)ç”¨äºè¡Œäººé‡è¯†åˆ«ï¼›    2.æå‡ºäº†vector-neuron(VN)capsulesæ¥ä»£æ›¿ä¼ ç»Ÿçš„ä¼ ç»Ÿçš„æ ‡é‡ç¥ç»å…ƒï¼ˆSN);</code></pre><p>æ³¨ï¼šæ–‡ç« æŒ‡å‡ºï¼ŒVNä¸SNç›¸æ¯”åªæ˜¯å¤šä¸€ä¸ªç»´åº¦ç”¨æ¥æå–åŒä¸€ä¸ªäººä¸åŒè¡£æœçš„ç‰¹å¾æå–ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¡Œäººé‡è¯†åˆ« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>25 Webå®¹å™¨</title>
      <link href="/2025/02/26/25%20Web%E5%AE%B9%E5%99%A8/"/>
      <url>/2025/02/26/25%20Web%E5%AE%B9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="25-Webå®¹å™¨"><a href="#25-Webå®¹å™¨" class="headerlink" title="25 Webå®¹å™¨"></a>25 Webå®¹å™¨</h1><h2 id="WebæŠ€æœ¯å‘å±•å²"><a href="#WebæŠ€æœ¯å‘å±•å²" class="headerlink" title="WebæŠ€æœ¯å‘å±•å²"></a>WebæŠ€æœ¯å‘å±•å²</h2><p>åœ¨WebæŠ€æœ¯å‘å±•çš„æ—©æœŸé˜¶æ®µï¼Œæˆ‘ä»¬å®¢æˆ·ç«¯çš„webåº”ç”¨åªèƒ½æµè§ˆä¸€äº›é™æ€çš„é¡µé¢ã€‚ä¾‹å¦‚é™æ€çš„HTMLï¼Œè¿™é‡Œä½¿ç”¨çš„HTTPæœåŠ¡å™¨æœ‰ï¼ˆApacheã€Nginxï¼‰ç­‰é™æ€æœåŠ¡å™¨ã€‚è¿™æ—¶å€™çš„Webé¡µé¢ä¸èƒ½å’Œç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œä¹Ÿä¸èƒ½åŠ¨æ€è·å–æ•°æ®ã€‚</p><p>éšç€WebæŠ€æœ¯çš„å‘å±•ï¼Œæˆ‘ä»¬éœ€è¦å®¢æˆ·ç«¯èƒ½å’ŒæœåŠ¡ç«¯è¿›è¡Œäº¤äº’çš„æŠ€æœ¯ã€‚</p><p>è¿™æ—¶å€™Sunå…¬å¸æ¨å‡ºäº†ServletæŠ€æœ¯ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ServletæŠ€æœ¯å‘¢ï¼Ÿ</p><h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><p>Servletç®€å•çš„è¯´å°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„Javaç¨‹åºï¼Œä½†æ˜¯è¿™äº›Servletå¹¶æ²¡æœ‰mainæ–¹æ³•ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½è‡ªå·±ç›´æ¥è¿è¡Œã€‚å¦‚æœä¸èƒ½ç‹¬ç«‹è¿è¡Œï¼Œé‚£ä¹ˆå¦‚ä½•è®©Servletå’Œå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’å‘¢ï¼Ÿæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸œè¥¿æ¥ç»Ÿä¸€è°ƒåŠ¨è¿™äº›Servletï¼Œè¿™å°±æ˜¯Servletå®¹å™¨ã€‚å½“å®¢æˆ·ç«¯éœ€è¦å“ªä¸ªServletæ¥è¿›è¡Œäº¤äº’æ“ä½œæ—¶ï¼ŒServletå®¹å™¨å°±ä¼šè°ƒç”¨è¿è¡Œè¿™ä¸ªServletæ¥è·å–éœ€è¦äº¤äº’çš„æ•°æ®ã€‚</p><p>é‚£ä¹ˆå¸¸è§çš„ä¸€äº›Servletå®¹å™¨æœ‰å“ªäº›å‘¢ï¼Ÿ</p><ol><li>Tomcatå®¹å™¨</li><li>Jettyå®¹å™¨</li><li>ç­‰ç­‰</li></ol><p>è€ŒTomcatå’ŒJettyå°±æ˜¯ä¸€ä¸ªServletå®¹å™¨ã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå®ƒä»¬ä¹Ÿå…·æœ‰HTTPæœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œå› æ­¤Tomcatæˆ–è€…Jettyå°±æ˜¯ä¸€ä¸ªâ€œ<strong>HTTPæœåŠ¡å™¨ + Servletå®¹å™¨</strong>â€ï¼Œæˆ‘ä»¬ä¹Ÿå«å®ƒä»¬<strong>Webå®¹å™¨</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261938735.png" alt="img"></p><h2 id="Webå®¹å™¨ä½œç”¨"><a href="#Webå®¹å™¨ä½œç”¨" class="headerlink" title="Webå®¹å™¨ä½œç”¨"></a>Webå®¹å™¨ä½œç”¨</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261938248.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261938359.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261938694.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261938184.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261938566.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261938892.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261938437.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Servlet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>09 Linuxç¯å¢ƒä¸‹æ­å»ºELKï¼ˆElasticsearch+Logstash+Kibanaï¼‰</title>
      <link href="/2025/02/26/30%20%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83/"/>
      <url>/2025/02/26/30%20%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h1 id="30-åˆ†å¸ƒå¼ç¯å¢ƒ"><a href="#30-åˆ†å¸ƒå¼ç¯å¢ƒ" class="headerlink" title="30 åˆ†å¸ƒå¼ç¯å¢ƒ"></a>30 åˆ†å¸ƒå¼ç¯å¢ƒ</h1><h2 id="åˆ†å¸ƒå¼Session"><a href="#åˆ†å¸ƒå¼Session" class="headerlink" title="åˆ†å¸ƒå¼Session"></a>åˆ†å¸ƒå¼Session</h2><p>ç”¨æˆ·ç™»å½•ä¹‹åï¼Œè´Ÿè½½å‡è¡¡ä¼šå°†è¿™ä¸ªè¯·æ±‚æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ†å‘åˆ°å„ä¸ªä¸»æœºä¸­ï¼Œè¿™æ—¶å€™å°±ä¼šå­˜åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¸€ä¸ªç»å…¸é—®é¢˜â€”â€”ä¿¡æ¯ä¸å¯¹ç­‰ã€‚å› ä¸ºç”¨æˆ·Aç™»å½•çš„ä¸»æœºå¯èƒ½æ˜¯ä¸»æœºAï¼Œå…¶ç™»å½•ä¿¡æ¯å°±ä¼šä¿å­˜åœ¨ä¸»æœºAä¸­ï¼Œä½†æ˜¯ä¹‹åçš„è¯·æ±‚å¦‚æœåˆ†å‘åˆ°äº†ä¸»æœºBä¸­ï¼Œé‚£ä¹ˆä¸»æœºBå°±æ²¡æœ‰ç”¨æˆ·Açš„ç™»å½•ä¿¡æ¯ï¼Œå°±éœ€è¦é‡æ–°ç™»å½•ï¼Œå¾ˆæ˜¯éº»çƒ¦ã€‚é‚£ä¹ˆè¿™é‡Œçš„åˆ†å¸ƒå¼Sessionè¯•ç€è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261941570.png" alt="img"></p><h3 id="æ–¹æ¡ˆä¸€-Sessionå¤åˆ¶"><a href="#æ–¹æ¡ˆä¸€-Sessionå¤åˆ¶" class="headerlink" title="æ–¹æ¡ˆä¸€ Sessionå¤åˆ¶"></a>æ–¹æ¡ˆä¸€ Sessionå¤åˆ¶</h3><p> æ–¹æ¡ˆä¸€é¡¾åæ€ä¹‰å°±æ˜¯é€šè¿‡å¤åˆ¶Sessionåˆ°å„ä¸ªä¸åŒä¸»æœºä¸‹çš„Tomcatä¸­ï¼Œå¾ˆæ˜¾ç„¶è¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜å°±æ˜¯å†…å­˜é—®é¢˜ã€‚æˆ‘ä»¬å¤§èƒ†çš„å‡è®¾æˆ‘ä»¬æœ‰100å°ä¸»æœºï¼Œæœ‰100ä¸ªTomcatï¼Œæ¯ä¸€ä¸ªTomcatéƒ½å­˜æœ‰è¿‘1Gçš„ä¿¡æ¯ã€‚æŒ‰ç…§è¿™ç§æ–¹æ¡ˆæ¥è¯´ï¼Œæ¯ä¸ªTomcatéƒ½éœ€è¦å­˜å‚¨å…¶ä»–99ä¸ªTomcatçš„ä¿¡æ¯ï¼Œè¿™æ ·æ¯ä¸ªä¸»æœºéœ€è¦è¶…è¿‡100Gçš„å†…å­˜ã€‚</p><p>è€Œä¸”ä¸åŒçš„Tomcatä¹‹é—´ä¼ è¾“Sessionå¤åˆ¶éƒ½æ˜¯é€šè¿‡ç½‘ç»œè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè¿™æ ·ä¼šå ç”¨å¤§é‡çš„å¸¦å®½ï¼Œè¿˜å­˜åœ¨å»¶è¿Ÿï¼Œååˆ†å½±å“æˆ‘ä»¬çš„ä¸šåŠ¡å¤„ç†é€Ÿåº¦ã€‚</p><p>å¾ˆæ˜¾ç„¶è¿™ç§æ–¹æ¡ˆå¾ˆä¸ç†æƒ³ï¼Œæˆæœ¬å¤ªé«˜ã€‚</p><h3 id="æ–¹æ¡ˆäºŒ-å®¢æˆ·ç«¯ä¿å­˜Session"><a href="#æ–¹æ¡ˆäºŒ-å®¢æˆ·ç«¯ä¿å­˜Session" class="headerlink" title="æ–¹æ¡ˆäºŒ å®¢æˆ·ç«¯ä¿å­˜Session"></a>æ–¹æ¡ˆäºŒ å®¢æˆ·ç«¯ä¿å­˜Session</h3><p>è¯¥æ–¹æ¡ˆé€šè¿‡å°†Sessionä¿å­˜è‡³å®¢æˆ·ç«¯ï¼Œè¿™æ ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦å¯¹åº”çš„Sessionä¿¡æ¯æ¥è¿›è¡Œè®¿é—®ã€‚</p><p>æˆ‘ä»¬ç”¨ç™»å½•æ¥è¿›è¡Œä»‹ç»ã€‚ç”¨æˆ·Aåœ¨ä¸»æœºAä¸­ç™»å½•ï¼Œè·å¾—äº†Tokenä¿¡æ¯ï¼Œå¹¶è¿”å›ã€‚ç”¨æˆ·Aæ­¤æ—¶å¯¹ä¸»æœºBè¿›è¡Œè¯·æ±‚ï¼Œæºå¸¦Tokenè¿‡å»ï¼Œä½†æ˜¯ä¸»æœºBä¸­æ— è¯¥Tokenè®°å½•çš„ä¿¡æ¯ã€‚</p><p>é‚£ä¹ˆæ­¤æ—¶ä¸»æœºAå¯ä»¥ç›´æ¥è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œä¹‹åè¯·æ±‚æºå¸¦è¯¥ç”¨æˆ·ä¿¡æ¯ç›´æ¥è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯è¿™æ ·å°±ä¼šä¿å­˜ç”¨æˆ·ä¿¡æ¯éå¸¸ä¸å®‰å…¨ã€‚</p><h3 id="æ–¹æ¡ˆä¸‰-Hashä¸€è‡´"><a href="#æ–¹æ¡ˆä¸‰-Hashä¸€è‡´" class="headerlink" title="æ–¹æ¡ˆä¸‰ Hashä¸€è‡´"></a>æ–¹æ¡ˆä¸‰ Hashä¸€è‡´</h3><p>è¯¥æ–¹æ¡ˆé€šè¿‡å¯¹ç”¨æˆ·çš„IPåœ°å€è¿›è¡Œhashè¿ç®—ï¼Œæ ¹æ®ç»“æœæ¥åˆ†é…å…¶æ¥å—çš„æœåŠ¡å™¨ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œç”¨æˆ·Açš„è¯·æ±‚è¿‡æ¥åï¼Œå¯¹è¯¥IPåœ°å€å¯¹2å–ä½™ï¼Œä½™æ•°1å°±æ˜¯AæœåŠ¡å™¨ï¼Œåä¹‹ä¸ºBæœåŠ¡å™¨ã€‚è¿™æ ·é€šè¿‡å›ºå®šç”¨æˆ·è¯·æ±‚æœåŠ¡å™¨æ¥è¾¾åˆ°ä¿¡æ¯å¯¹ç­‰ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„æœåŠ¡éœ€è¦æ°´å¹³æ‰©å±•ï¼Œæ¯”å¦‚æ·»åŠ ä¸¤å°æœåŠ¡å™¨ï¼Œç°åœ¨æˆ‘ä»¬å°±æœ‰äº†å››å°æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡æ–°ä¸ºç”¨æˆ·IPè¿›è¡Œè¿ç®—å¾—åˆ°å…¶æœåŠ¡å™¨çš„åœ°å€ï¼Œä½†æ˜¯è¿™æ ·ä¹‹å‰æŸäº›ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯å¯èƒ½ä¸¢å¤±ã€‚</p><p>ä»¥ä¸Šç¼ºç‚¹é—®é¢˜ä¸å¤§ï¼Œè€Œä¸”åæ¥å‘¢ï¼Œæˆ‘ä»¬ip å“ˆå¸Œçš„è¿™ç§ä¹Ÿç”¨çš„æ¯”è¾ƒå¤šï¼Œå› ä¸ºåŸºäºsessionæœ¬æ¥å°±æ˜¯å…·æœ‰æœ‰æ•ˆæœŸçš„ï¼Œå°±ç®—è¿™æ¬¡å› ä¸ºæ°´å¹³æ‰©å±•åŸå› æˆ–è€…æœåŠ¡å™¨é—ªæ–­åŸå› æ²¡æœ‰äº†ï¼Œé‚£å°±ç›¸å½“äºæµè§ˆå™¨å…³æ‰äº†å‘—ï¼Œé‚£æˆ‘ä»¬è®©ç”¨æˆ·é‡æ–°å†åšä¸€æ¬¡ç™»å½•å³å¯</p><h3 id="æ–¹æ¡ˆå››-ç»Ÿä¸€å­˜å‚¨"><a href="#æ–¹æ¡ˆå››-ç»Ÿä¸€å­˜å‚¨" class="headerlink" title="æ–¹æ¡ˆå›› ç»Ÿä¸€å­˜å‚¨"></a>æ–¹æ¡ˆå›› ç»Ÿä¸€å­˜å‚¨</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261941545.png" alt="img"></p><p>æ‰€æœ‰æœåŠ¡å™¨ç”Ÿæˆçš„Tokenå’Œç”¨æˆ·ä¿¡æ¯éƒ½ä¿å­˜åˆ°ç»Ÿä¸€çš„Redisä¸­ï¼Œå®Œç¾è§£å†³è¯¥é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>28 ElasticSearch</title>
      <link href="/2025/02/26/28%20ElasticSearch/"/>
      <url>/2025/02/26/28%20ElasticSearch/</url>
      
        <content type="html"><![CDATA[<h1 id="28-ElasticSearch"><a href="#28-ElasticSearch" class="headerlink" title="28 ElasticSearch"></a>28 ElasticSearch</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/u011863024/article/details/115721328?ops_request_misc=%7B%22request_id%22:%22171680192916800188595883%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171680192916800188595883&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-115721328-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=ES&spm=1018.2226.3001.4187">Elasticsearchå­¦ä¹ ç¬”è®°</a>ï¼›</li><li>[ESåˆ›å»ºç´¢å¼•](<a href="https://blog.csdn.net/qq_43720551/article/details/131160035?ops_request_misc=%7B%22request_id%22:%22171686695816800225539998%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171686695816800225539998&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-131160035-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=ES">https://blog.csdn.net/qq_43720551/article/details/131160035?ops_request_misc=%7B%22request%5Fid%22%3A%22171686695816800225539998%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=171686695816800225539998&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-131160035-null-null.142^v100^pc_search_result_base1&amp;utm_term=ES</a> ç´¢å¼•åˆ›å»º&amp;spm&#x3D;1018.2226.3001.4187)ï¼›</li><li>[Javaé›†æˆelasticsearchï¼›](<a href="https://blog.csdn.net/weixin_45410882/article/details/127030381?ops_request_misc=%7B%22request_id%22:%22171694858216800197071724%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171694858216800197071724&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-127030381-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=ES">https://blog.csdn.net/weixin_45410882/article/details/127030381?ops_request_misc=%7B%22request%5Fid%22%3A%22171694858216800197071724%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=171694858216800197071724&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-127030381-null-null.142^v100^pc_search_result_base1&amp;utm_term=ES</a> Java&amp;spm&#x3D;1018.2226.3001.4187)</li><li></li></ol><h2 id="Elasticsearchæ¦‚è¿°"><a href="#Elasticsearchæ¦‚è¿°" class="headerlink" title="Elasticsearchæ¦‚è¿°"></a>Elasticsearchæ¦‚è¿°</h2><p>Elasticsearchï¼ˆç®€ç§°ESï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œå±äºLuceneåº“çš„ä¸€ä¸ªæ‰©å±•ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTful webæ¥å£ã€‚ESæ˜¯ç”¨Javaç¼–å†™çš„ï¼Œå¹¶ä¸”ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºä»£ç å‘å¸ƒï¼Œæ˜¯å½“å‰æœ€æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ä¹‹ä¸€ã€‚</p><p>ESçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼šåˆ†å¸ƒå¼çš„å®æ—¶æ–‡æ¡£å­˜å‚¨ï¼Œæ¯ä¸ªå­—æ®µéƒ½è¢«ç´¢å¼•å¹¶å¯è¢«æœç´¢ï¼›æ”¯æŒå…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æœç´¢ã€åœ°ç†ä½ç½®æœç´¢å’Œå¤æ‚çš„æ•°æ®èšåˆï¼›å¯ä»¥æ‰©å±•åˆ°æ•°ç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§åˆ«çš„æ•°æ®ï¼›é€šè¿‡HTTPä½¿ç”¨JSONè¿›è¡Œé€šä¿¡ç­‰ã€‚ESé€šå¸¸ç”¨äºæ„å»ºå®æ—¶çš„æœç´¢ã€æ—¥å¿—åˆ†æã€ç›‘æ§ç³»ç»Ÿç­‰ã€‚</p><p>The Elastic Stack, åŒ…æ‹¬ Elasticsearchã€ Kibanaã€ Beats å’Œ Logstashï¼ˆä¹Ÿç§°ä¸º ELK Stackï¼‰ã€‚èƒ½å¤Ÿå®‰å…¨å¯é åœ°è·å–ä»»ä½•æ¥æºã€ä»»ä½•æ ¼å¼çš„æ•°æ®ï¼Œç„¶åå®æ—¶åœ°å¯¹æ•°æ®è¿›è¡Œæœç´¢ã€åˆ†æå’Œå¯è§†åŒ–ã€‚</p><p>å®ƒå¯ä»¥è¿‘ä¹å®æ—¶çš„å­˜å‚¨ã€æ£€ç´¢æ•°æ®ï¼›æœ¬èº«æ‰©å±•æ€§å¾ˆå¥½ï¼Œå¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç† PB çº§åˆ«çš„æ•°æ®ã€‚</p><p>ä¸€èˆ¬ä¼ ç»Ÿæ•°æ®åº“ï¼Œå…¨æ–‡æ£€ç´¢éƒ½å®ç°çš„å¾ˆé¸¡è‚‹ï¼Œå› ä¸ºä¸€èˆ¬ä¹Ÿæ²¡äººç”¨æ•°æ®åº“å­˜æ–‡æœ¬å­—æ®µã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯è®¡ç®—æœºç´¢å¼•ç¨‹åºé€šè¿‡æ‰«ææ–‡ç« ä¸­çš„æ¯ä¸€ä¸ªè¯ï¼Œå¯¹æ¯ä¸€ä¸ªè¯å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼ŒæŒ‡æ˜è¯¥è¯åœ¨æ–‡ç« ä¸­å‡ºç°çš„æ¬¡æ•°å’Œä½ç½®ã€‚ESå¯¹äºå…¨æ–‡æ£€ç´¢å…·æœ‰æ¯”è¾ƒå¥½çš„æ•ˆæœã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261941598.png" alt="img"></p><h2 id="Linuxç¯å¢ƒä¸‹ESå®‰è£…"><a href="#Linuxç¯å¢ƒä¸‹ESå®‰è£…" class="headerlink" title="Linuxç¯å¢ƒä¸‹ESå®‰è£…"></a>Linuxç¯å¢ƒä¸‹ESå®‰è£…</h2><h3 id="å‚è€ƒèµ„æ–™-1"><a href="#å‚è€ƒèµ„æ–™-1" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/smilehappiness/article/details/118466378">Linuxç¯å¢ƒä¸‹å®‰è£…Elasticsearchï¼Œå²ä¸Šæœ€è¯¦ç»†çš„æ•™ç¨‹æ¥å•¦~</a></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ–°ç”¨æˆ·fang</span></span><br><span class="line"><span class="comment"># å¯†ç ï¼šfang</span></span><br><span class="line"></span><br><span class="line">su - fang</span><br><span class="line"><span class="built_in">cd</span> /home/fang/software/elasticsearch-7.8.0/bin/</span><br><span class="line">./elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ã€ç„¶åä½¿ç”¨å‘½ä»¤ç»‘å®šbashå³å¯ã€‚</span></span><br><span class="line">usermod -s /bin/bash name</span><br></pre></td></tr></table></figure><h2 id="ElasticSearchä»‹ç»"><a href="#ElasticSearchä»‹ç»" class="headerlink" title="ElasticSearchä»‹ç»"></a>ElasticSearchä»‹ç»</h2><h3 id="å€’æ’ç´¢å¼•"><a href="#å€’æ’ç´¢å¼•" class="headerlink" title="å€’æ’ç´¢å¼•"></a>å€’æ’ç´¢å¼•</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261941569.png" alt="img"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¼ ç»Ÿçš„æ­£æ’ç´¢å¼•æ˜¯é€šè¿‡IDæ¥æŸ¥æ‰¾å¯¹åº”çš„å†…å®¹ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦æŸ¥è¯¢å…³é”®è¯nameå‡ºç°åœ¨å“ªäº›IDä¸­ï¼Œå°±éœ€è¦æˆ‘ä»¬éå†æ•´ä¸ªåº“ï¼Œå¯¹æ¯”æ¯ä¸ªIDä¸­çš„Contentä¸­æ˜¯å¦å­˜åœ¨é‚£ä¹ˆã€‚è¿™æ ·å¯¼è‡´æŸ¥è¯¢æ•ˆæœéå¸¸çš„å·®ã€‚</p><p>æ‰€ä»¥å°±æå‡ºäº†ä¸€ç§å€’æ’ç´¢å¼•ï¼Œé€šè¿‡å°†å†…å®¹ä¸IDè¿›è¡Œç»‘å®šï¼Œä¸€ä¸ªå…³é”®è¯å‡ºç°åœ¨å“ªäº›IDä¸­ï¼Œéƒ½ä¼šä¸€ä¸€åˆ—å‡ºã€‚è¿™æ ·å¦‚æœæˆ‘ä»¬æŸ¥è¯¢nameå…³é”®è¯çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è·å¾—å…¶nameå…³è”çš„æ‰€æœ‰IDåˆ—è¡¨ã€‚æŸ¥è¯¢æ•ˆæœæ˜¾è‘—ä¸Šå‡ã€‚</p><h3 id="ç´¢å¼•åˆ›å»º"><a href="#ç´¢å¼•åˆ›å»º" class="headerlink" title="ç´¢å¼•åˆ›å»º"></a>ç´¢å¼•åˆ›å»º</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261941263.png" alt="img"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;flowCode&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;flowNodeIdList&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;flowDeviceIdList&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;flowVideoIdList&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;visitorId&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">public class FlowEventPO <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">    private Long flowCode;</span><br><span class="line"></span><br><span class="line">    private List&lt;Long&gt; flowNodeIdList;</span><br><span class="line"></span><br><span class="line">    private List&lt;Long&gt; flowDeviceIdList;</span><br><span class="line"></span><br><span class="line">    private List&lt;Long&gt; flowVideoIdList;</span><br><span class="line"></span><br><span class="line">    private LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    private Long visitorId;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç´¢å¼•"><a href="#æŸ¥çœ‹ç´¢å¼•" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•"></a>æŸ¥çœ‹ç´¢å¼•</h3><p>åœ¨postmanä¸­ï¼Œå‘ESå‘é€è¯·æ±‚ï¼š<a href="http://127.0.0.1:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0">http://127.0.0.1:9200/ç´¢å¼•åç§°</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;flow_events&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;aliases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;flowCode&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;flowDeviceIdList&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;flowNodeIdList&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;flowVideoIdList&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;visitorId&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;creation_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1716805408945&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1AMQGj_GQZG7V3IDf8VODg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7080099&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;provided_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;flow_events&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤ç´¢å¼•"><a href="#åˆ é™¤ç´¢å¼•" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h3><p>åœ¨ Postman ä¸­ï¼Œå‘ ES æœåŠ¡å™¨å‘ DELETE è¯·æ±‚ ï¼š <a href="http://127.0.0.1:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0">http://127.0.0.1:9200/ç´¢å¼•åç§°</a></p><h3 id="åˆ›å»ºæ–‡æ¡£"><a href="#åˆ›å»ºæ–‡æ¡£" class="headerlink" title="åˆ›å»ºæ–‡æ¡£"></a>åˆ›å»ºæ–‡æ¡£</h3><p>å‡è®¾å·²ç»åˆ›å»ºå¥½äº†ç´¢å¼•ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ç´¢å¼•ä¸­æ·»åŠ æ•°æ®ï¼ˆæ–‡æ¡£ï¼Œå¯¹åº”MySQLä¸­çš„ä¸€è¡Œæ•°æ®ï¼Œå…ƒç»„ï¼‰ã€‚</p><p>åœ¨ Postman ä¸­ï¼Œå‘ ES æœåŠ¡å™¨å‘ POST è¯·æ±‚ ï¼š <a href="http://127.0.0.1:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0/_doc%EF%BC%8C%E8%AF%B7%E6%B1%82%E4%BD%93JSON%E5%86%85%E5%AE%B9%E7%B1%BB%E4%BC%BC%E4%B8%BA%E5%A6%82%E4%B8%8B%E8%BF%99%E7%A7%8D%EF%BC%8C%E4%BD%86%E6%98%AF%E5%85%B6%E5%B1%9E%E6%80%A7%E7%B1%BB%E5%9E%8B%E5%90%8D%E7%A7%B0%E9%83%BD%E9%9C%80%E8%A6%81%E8%B7%9F%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95%E6%97%B6%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E3%80%82">http://127.0.0.1:9200/ç´¢å¼•åç§°/_docï¼Œè¯·æ±‚ä½“JSONå†…å®¹ç±»ä¼¼ä¸ºå¦‚ä¸‹è¿™ç§ï¼Œä½†æ˜¯å…¶å±æ€§ç±»å‹åç§°éƒ½éœ€è¦è·Ÿå»ºç«‹ç´¢å¼•æ—¶ä¿æŒä¸€è‡´ã€‚</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;å°ç±³æ‰‹æœº&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="string">&quot;å°ç±³&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="number">3999.00</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæ­¤å¤„å‘é€è¯·æ±‚çš„æ–¹å¼å¿…é¡»ä¸º POSTï¼Œä¸èƒ½æ˜¯ PUTï¼Œå¦åˆ™ä¼šå‘ç”Ÿé”™è¯¯ ã€‚</p><p>ä¸Šé¢çš„æ•°æ®åˆ›å»ºåï¼Œç”±äºæ²¡æœ‰æŒ‡å®šæ•°æ®å”¯ä¸€æ€§æ ‡è¯†ï¼ˆIDï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ ES æœåŠ¡å™¨ä¼šéšæœºç”Ÿæˆä¸€ä¸ªã€‚</p><p>å¦‚æœæƒ³è¦è‡ªå®šä¹‰å”¯ä¸€æ€§æ ‡è¯†ï¼Œéœ€è¦åœ¨åˆ›å»ºæ—¶æŒ‡å®šï¼š <a href="http://127.0.0.1:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0/_doc/1%EF%BC%8C%E8%AF%B7%E6%B1%82%E4%BD%93JSON%E5%86%85%E5%AE%B9%E4%B8%BA%E5%92%8C%E4%B8%8A%E9%9D%A2%E4%BE%9D%E6%97%A7%E4%B8%80%E6%A0%B7%E5%8D%B3%E5%8F%AF%E3%80%82">http://127.0.0.1:9200/ç´¢å¼•åç§°/_doc/1ï¼Œè¯·æ±‚ä½“JSONå†…å®¹ä¸ºå’Œä¸Šé¢ä¾æ—§ä¸€æ ·å³å¯ã€‚</a></p><h3 id="æŸ¥è¯¢-ä¸»é”®æŸ¥è¯¢-å…¨æŸ¥è¯¢"><a href="#æŸ¥è¯¢-ä¸»é”®æŸ¥è¯¢-å…¨æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢-ä¸»é”®æŸ¥è¯¢ &amp; å…¨æŸ¥è¯¢"></a>æŸ¥è¯¢-ä¸»é”®æŸ¥è¯¢ &amp; å…¨æŸ¥è¯¢</h3><p>æ ¹æ®ä¸»é”®æŸ¥è¯¢ï¼Œåœ¨ Postman ä¸­ï¼Œå‘ ES æœåŠ¡å™¨å‘ GET è¯·æ±‚ ï¼š <a href="http://127.0.0.1:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0/_doc/1">http://127.0.0.1:9200/ç´¢å¼•åç§°/_doc/1</a></p><p>æŸ¥çœ‹ç´¢å¼•ä¸‹æ‰€æœ‰æ•°æ®ï¼Œå‘ ES æœåŠ¡å™¨å‘ GET è¯·æ±‚ ï¼š <a href="http://127.0.0.1:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0/_search%E3%80%82">http://127.0.0.1:9200/ç´¢å¼•åç§°/_searchã€‚</a></p><h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h3><h4 id="å…¨ä¿®æ”¹"><a href="#å…¨ä¿®æ”¹" class="headerlink" title="å…¨ä¿®æ”¹"></a>å…¨ä¿®æ”¹</h4><p>å’Œæ–°å¢æ–‡æ¡£ä¸€æ ·ï¼Œè¾“å…¥ç›¸åŒçš„ URL åœ°å€è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚ä½“å˜åŒ–ï¼Œä¼šå°†åŸæœ‰çš„æ•°æ®å†…å®¹è¦†ç›–ã€‚</p><p>åœ¨ Postman ä¸­ï¼Œå‘ ES æœåŠ¡å™¨å‘ POST è¯·æ±‚ ï¼š <a href="http://127.0.0.1:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0/_doc/1">http://127.0.0.1:9200/ç´¢å¼•åç§°/_doc/1</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;åä¸ºæ‰‹æœº&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="string">&quot;åä¸º&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://www.gulixueyuan.com/hw.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="number">1999.00</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="å±€éƒ¨ä¿®æ”¹"><a href="#å±€éƒ¨ä¿®æ”¹" class="headerlink" title="å±€éƒ¨ä¿®æ”¹"></a>å±€éƒ¨ä¿®æ”¹</h4><p>ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¹Ÿå¯ä»¥åªä¿®æ”¹æŸä¸€ç»™æ¡æ•°æ®çš„å±€éƒ¨ä¿¡æ¯</p><p>åœ¨ Postman ä¸­ï¼Œå‘ ES æœåŠ¡å™¨å‘ POST è¯·æ±‚ ï¼š <a href="http://127.0.0.1:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0/_update/1%E3%80%82">http://127.0.0.1:9200/ç´¢å¼•åç§°/_update/1ã€‚</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;å°ç±³æ‰‹æœº&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="string">&quot;å°ç±³&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶æŸ¥è¯¢-åˆ†é¡µæŸ¥è¯¢-æŸ¥è¯¢æ’åº"><a href="#æ¡ä»¶æŸ¥è¯¢-åˆ†é¡µæŸ¥è¯¢-æŸ¥è¯¢æ’åº" class="headerlink" title="æ¡ä»¶æŸ¥è¯¢ &amp; åˆ†é¡µæŸ¥è¯¢ &amp; æŸ¥è¯¢æ’åº"></a>æ¡ä»¶æŸ¥è¯¢ &amp; åˆ†é¡µæŸ¥è¯¢ &amp; æŸ¥è¯¢æ’åº</h3><h2 id="SpringBooté›†æˆElasticSearch"><a href="#SpringBooté›†æˆElasticSearch" class="headerlink" title="SpringBooté›†æˆElasticSearch"></a>SpringBooté›†æˆElasticSearch</h2><h3 id="å‚è€ƒèµ„æ–™-2"><a href="#å‚è€ƒèµ„æ–™-2" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/m0_64210833/article/details/135274603">ã€Javaã€‘SpringBootå¿«é€Ÿæ•´åˆElasticSearch</a></li><li><a href="https://blog.csdn.net/qq_42397932/article/details/139603575">12-Springbooté›†æˆElasticsearch</a></li></ol><h3 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="application-ymlé…ç½®"><a href="#application-ymlé…ç½®" class="headerlink" title="application.ymlé…ç½®"></a>application.ymlé…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">uris:</span> <span class="string">http://localhost:9200</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºå®ä½“ç±»"><a href="#åˆ›å»ºå®ä½“ç±»" class="headerlink" title="åˆ›å»ºå®ä½“ç±»"></a>åˆ›å»ºå®ä½“ç±»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>09 Linuxç¯å¢ƒä¸‹æ­å»ºELKï¼ˆElasticsearch+Logstash+Kibanaï¼‰</title>
      <link href="/2025/02/26/31%20SDK%20&amp;%20API/"/>
      <url>/2025/02/26/31%20SDK%20&amp;%20API/</url>
      
        <content type="html"><![CDATA[<h1 id="31-SDK-API"><a href="#31-SDK-API" class="headerlink" title="31 SDK &amp; API"></a>31 SDK &amp; API</h1><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>API çš„å…¨ç§°ä¸º Application Programming Interfaceï¼Œç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ã€‚å®é™…ä¸Šï¼ŒAPI æ˜¯ä¸€äº›é¢„å…ˆå®šä¹‰çš„å‡½æ•°ï¼Œç›®çš„æ˜¯æä¾›åº”ç”¨ç¨‹åºä¸å¼€å‘äººå‘˜åŸºäºæŸä¸ªè½¯ä»¶æˆ–ç¡¬ä»¶ï¼Œå¾—ä»¥è®¿é—®ä¸€ç»„è¿›ç¨‹çš„èƒ½åŠ›ã€‚ä¸éœ€è¦ç›´æ¥å»è®¿é—®æºç ï¼Œæˆ–å»æ·±åˆ»ç†è§£å†…éƒ¨å·¥ä½œæœºåˆ¶çš„ç»†èŠ‚ã€‚</p><p>çŸ¥é“è¯¥æ¥å£çš„è¯·æ±‚åœ°å€å°±å¯ä»¥ä¹‹é—´è®¿é—®ã€‚</p><h2 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h2><p>SDKçš„å…¨ç§°ä¸º Software Development Kitï¼Œç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯è½¯ä»¶å¼€å‘å·¥å…·åŒ…ã€‚è¿™æ˜¯ä¸€ä¸ªè¦†ç›–é¢ç›¸å½“å¹¿æ³›çš„åè¯ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼šè¾…åŠ©å¼€å‘æŸä¸€ç±»è½¯ä»¶çš„ç›¸å…³æ–‡æ¡£ã€æ¼”ç¤ºä¸¾ä¾‹å’Œä¸€äº›å·¥å…·çš„é›†åˆï¼Œè¿™äº›éƒ½å¯ä»¥ç§°ä¸º SDKã€‚</p><p>SDK è¢«å¼€å‘å‡ºæ¥çš„æ„ä¹‰æ˜¯ä¸ºäº†å‡å°‘å¼€å‘è€…çš„å·¥ä½œé‡ã€‚ä¾‹å¦‚ï¼šæŸå…¬å¸å¼€å‘å‡ºæŸç§è½¯ä»¶çš„æŸä¸€åŠŸèƒ½ï¼Œå°†å…¶å°è£…æˆ SDKï¼ˆä¾‹å¦‚æ•°æ®åˆ†æ SDKï¼Œå°±æ˜¯èƒ½å¤Ÿå®ç°æ•°æ®åˆ†æåŠŸèƒ½çš„SDKï¼‰ï¼Œå‡ºå”®ç»™å…¶ä»–éœ€è¦çš„å…¬å¸ä½¿ç”¨ã€‚è¿™æ ·å°±å¯ä»¥å¤§å¤§å‡å°‘å¼€å‘åº”ç”¨ç¨‹åºçš„å·¥ä½œé‡ã€‚</p><p>æœ¬è´¨ä¸Šæ˜¯å…·æœ‰å¾ˆå¼ºå…³è”æ€§çš„ä¸¤ä¸ªå­˜åœ¨ã€‚æˆ‘ä»¬å¯ä»¥å°† SDK è§£é‡Šä¸ºå°è£…å¥½åŠŸèƒ½çš„ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œè€Œè¿™ä¸ªè½¯ä»¶åŒ…å‡ ä¹æ˜¯å°é—­çš„çŠ¶æ€ï¼Œåªæœ‰ä¸€ä¸ªæ¥å£å¯ä»¥è¿›è¡Œè®¿é—®ï¼Œé‚£è¿™ä¸ªæ¥å£å°±æ˜¯æˆ‘ä»¬æ‰€äº†è§£çš„ APIã€‚</p><h2 id="å¼•å…¥è‡ªå®šä¹‰çš„SDK"><a href="#å¼•å…¥è‡ªå®šä¹‰çš„SDK" class="headerlink" title="å¼•å…¥è‡ªå®šä¹‰çš„SDK"></a>å¼•å…¥è‡ªå®šä¹‰çš„SDK</h2><p><strong>SDK****åŒ…</strong></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261942998.png" alt="img"></p><p><strong>å¼•ç”¨å¤„</strong></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261942661.png" alt="img"></p><p>å¼•ç”¨å¤„pomæ–‡ä»¶ï¼šå¼•å…¥SDKçš„åŒ…</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261942612.png" alt="img"></p><p><strong>SDKæ‰“åŒ…</strong></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261942192.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>27 RBAC &amp; SSO</title>
      <link href="/2025/02/26/27%20RBAC%20&amp;%20SSO/"/>
      <url>/2025/02/26/27%20RBAC%20&amp;%20SSO/</url>
      
        <content type="html"><![CDATA[<h1 id="27-RBAC-SSO"><a href="#27-RBAC-SSO" class="headerlink" title="27 RBAC &amp; SSO"></a>27 RBAC &amp; SSO</h1><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://blog.csdn.net/m0_62006803/article/details/133962328">RBACâ€”â€”åŸºäºè§’è‰²æƒé™çš„æ¨¡å‹</a>ï¼›</li><li><a href="https://blog.csdn.net/weixin_58403235/article/details/129928096?ops_request_misc=%7B%22request_id%22:%22171636862116800222818286%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171636862116800222818286&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-129928096-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=sso&spm=1018.2226.3001.4187">å•ç‚¹ç™»å½•(SSO)è¯¦è§£</a>ï¼›</li><li><a href="https://blog.csdn.net/qq_38334677/article/details/128637268?ops_request_misc=%7B%22request_id%22:%22171705384616800184145334%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171705384616800184145334&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-128637268-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=Token%E6%96%B9%E6%A1%88&spm=1018.2226.3001.4187">æ·±å…¥æµ…å‡ºCookieã€Sessionã€Tokenï¼šèƒŒåçš„æŠ€æœ¯åŸç†</a></li></ol><h1 id="RBACï¼Ÿ"><a href="#RBACï¼Ÿ" class="headerlink" title="RBACï¼Ÿ"></a>RBACï¼Ÿ</h1><p>Role-Based Access Controlï¼Œä¸­æ–‡æ„æ€æ˜¯ï¼šåŸºäºè§’è‰²ï¼ˆRoleï¼‰çš„è®¿é—®æ§åˆ¶ã€‚è¿™æ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨äºè®¡ç®—æœºç³»ç»Ÿå’Œç½‘ç»œå®‰å…¨é¢†åŸŸçš„è®¿é—®æ§åˆ¶æ¨¡å‹ã€‚</p><p>ç®€å•çš„ç†è§£å°±æ˜¯ï¼šé€šè¿‡å°†<strong>æƒé™</strong>åˆ†é…ç»™â¡<strong>è§’è‰²</strong>ï¼Œå†å°†<strong>è§’è‰²</strong>åˆ†é…ç»™â¡<strong>ç”¨æˆ·</strong>ï¼Œæ¥å®ç°å¯¹ç³»ç»Ÿèµ„æºçš„è®¿é—®æ§åˆ¶ã€‚</p><p>ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œ<strong>ç”¨æˆ·ä¸è§’è‰²ä¹‹é—´ï¼Œè§’è‰²ä¸æƒé™ä¹‹é—´ï¼Œä¸€èˆ¬è€…æ˜¯å¤šå¯¹å¤šçš„å…³ç³»</strong>ã€‚</p><blockquote><ol><li>è§’è‰²ï¼ˆRoleï¼‰ï¼šè§’è‰²æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­å…·æœ‰ä¸€ç»„ç›¸å…³æƒé™çš„æŠ½è±¡æ¦‚å¿µï¼Œä»£è¡¨äº†ç”¨æˆ·åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­çš„èº«ä»½æˆ–èŒèƒ½ï¼Œä¾‹å¦‚ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·ç­‰ã€‚</li><li>æƒé™ï¼ˆPermissionï¼‰ï¼šæƒé™æ˜¯æŒ‡å¯¹ç³»ç»Ÿèµ„æºè¿›è¡Œæ“ä½œçš„è®¸å¯ï¼Œå¦‚è¯»å–ã€å†™å…¥ã€ä¿®æ”¹ç­‰ã€‚æƒé™å¯ä»¥è¢«åˆ†é…ç»™è§’è‰²ã€‚</li><li>ç”¨æˆ·ï¼ˆUserï¼‰ï¼šç”¨æˆ·æ˜¯æŒ‡ç³»ç»Ÿçš„å®é™…ä½¿ç”¨è€…ï¼Œæ¯ä¸ªç”¨æˆ·å¯ä»¥è¢«åˆ†é…ä¸€ä¸ªæˆ–å¤šä¸ªè§’è‰²ã€‚</li><li>åˆ†é…ï¼ˆAssignmentï¼‰ï¼šåˆ†é…æ˜¯æŒ‡å°†è§’è‰²ä¸ç”¨æˆ·å…³è”èµ·æ¥ï¼Œä»¥èµ‹äºˆç”¨æˆ·ç›¸åº”çš„æƒé™ã€‚</li></ol></blockquote><h1 id="Whyï¼Ÿ"><a href="#Whyï¼Ÿ" class="headerlink" title="Whyï¼Ÿ"></a>Whyï¼Ÿ</h1><p>å¾ˆç®€å•ï¼šæ–¹ä¾¿å¼€å‘ã€‚</p><p>å› ä¸ºå½“ç”¨æˆ·çš„æ•°é‡éå¸¸å¤§æ—¶ï¼Œè¦ç»™ç³»ç»Ÿæ¯ä¸ªç”¨æˆ·é€ä¸€æˆæƒï¼Œæ˜¯ä»¶éå¸¸çƒ¦ççš„äº‹æƒ…ã€‚è¿™æ—¶ï¼Œå°±éœ€è¦ç»™ç”¨æˆ·åˆ†ç»„ï¼Œæ¯ä¸ªç”¨æˆ·ç»„å†…æœ‰å¤šä¸ªç”¨æˆ·ã€‚é™¤äº†å¯ç»™ç”¨æˆ·æˆæƒå¤–ï¼Œè¿˜å¯ä»¥ç»™ç”¨æˆ·ç»„æˆæƒã€‚è¿™æ ·ä¸€æ¥ï¼Œç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰æƒé™ï¼Œå°±æ˜¯ç”¨æˆ·ä¸ªäººæ‹¥æœ‰çš„æƒé™ä¸è¯¥ç”¨æˆ·æ‰€åœ¨ç”¨æˆ·ç»„æ‹¥æœ‰çš„æƒé™ä¹‹å’Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261939246.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261939670.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261939460.png" alt="img"></p><h1 id="SSOï¼Ÿ"><a href="#SSOï¼Ÿ" class="headerlink" title="SSOï¼Ÿ"></a>SSOï¼Ÿ</h1><p>å•ç‚¹ç™»å½•ï¼ˆSingle Sign Onï¼‰ï¼Œç®€ç§°ä¸º SSOï¼Œæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„ä¼ä¸šä¸šåŠ¡æ•´åˆçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚SSOçš„å®šä¹‰æ˜¯åœ¨å¤šä¸ªåº”ç”¨ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿï¼ˆä¾‹å¦‚æ·˜å®ã€å¤©çŒ«ä¹‹é—´çš„å…³ç³»ï¼‰ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¤šä¸ªç³»ç»Ÿï¼Œç»Ÿä¸€ç™»é™†ã€‚</p><h1 id="å•ç‚¹ç™»å½•å®ç°æ–¹å¼"><a href="#å•ç‚¹ç™»å½•å®ç°æ–¹å¼" class="headerlink" title="å•ç‚¹ç™»å½•å®ç°æ–¹å¼"></a>å•ç‚¹ç™»å½•å®ç°æ–¹å¼</h1><p>ä¸€èˆ¬æœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼š</p><ol><li>Cookie</li><li>Session</li><li>Token</li></ol><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œåç«¯ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œå°†è¿™ä¸ªéšæœºå­—ç¬¦ä¸²å­˜æ”¾åœ¨Cookieä¸­è¿”å›ç»™å‰ç«¯é¡µé¢ï¼Œå‰ç«¯é¡µé¢æ¯æ¬¡è®¿é—®æ—¶ï¼Œéœ€è¦æºå¸¦è¿™ä¸ªCookieç»™åç«¯ã€‚åŒæ—¶åç«¯å°†è¿™ä¸ªéšæœºå­—ç¬¦ä¸²ä½œä¸ºKeyï¼Œç”¨æˆ·IDä½œä¸ºValueå­˜æ”¾åœ¨Redisä¸­ï¼Œç„¶ååç«¯æ¯æ¬¡æ ¹æ®å‰ç«¯ä¼ æ¥çš„Cookieæ¥è·å–è¿™ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œç„¶åä»Redisä¸­è·å–å½“å‰ç”¨æˆ·IDã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261939342.png" alt="img"></p><p>ç¼ºç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰Cookieä¸å®‰å…¨ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¼ªé€ Cookieä¼ªé€ æˆç‰¹å®šç”¨æˆ·èº«ä»½ï¼Œå¯ä»¥ç”¨åŠ å¯†è§„é¿ï¼ˆå‰ææ˜¯åŠ å¯†ç®—æ³•ä¸è¢«æ³„éœ²ï¼‰ï¼›ç”±äº Cookie æ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œå› æ­¤å­˜åœ¨è¢«ç”¨æˆ·æˆ–ç¬¬ä¸‰æ–¹ç¯¡æ”¹çš„é£é™©ã€‚è™½ç„¶å¯ä»¥é€šè¿‡åŠ å¯†å’Œç­¾åç­‰æ‰‹æ®µæé«˜å®‰å…¨æ€§ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„é£é™©ï¼›</p><p>ï¼ˆ2ï¼‰ä¸èƒ½è·¨åŸŸå®ç°å…ç™»ï¼šCookieä¸€èˆ¬æ˜¯ä»¥åŸŸåä¸ºåˆ†å‰²çš„ã€‚å¦‚ï¼šbaidu.com æ— æ³•è¯»åˆ° cnblogs.com å†™çš„ cookieã€‚åŸŸåæ˜¯å¯ä»¥è®¿é—®ä¸Šçº§åŸŸåçš„Cookieçš„ã€‚ å³a.baidu.comæ˜¯å¯ä»¥è®¿é—®baidu.comä¸‹çš„Cookieçš„ã€‚ï¼ˆä¸€çº§åŸŸåç›¸åŒï¼Œåªæ˜¯äºŒçº§æˆ–æ›´é«˜çº§åŸŸåä¸åŒçš„ç«™ç‚¹ï¼Œå¦‚ï¼ša.baidu.comã€b.baidu.comå¯ä»¥é€šè¿‡è®¾ç½® domain å‚æ•°å…±äº« cookie è¯»å†™ã€‚ï¼‰</p><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>Sessionæ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„ï¼Œæ‰€ä»¥å¦‚æœæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°æœåŠ¡å™¨ä¸å…±äº«Sessionçš„é—®é¢˜ã€‚å¦‚æœæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œsessionå±äºæœ‰çŠ¶æ€ï¼Œå®ç°åˆ†å¸ƒå¼sessionæœ‰å››ç§æ–¹æ¡ˆï¼ˆsessionå¤åˆ¶ã€å®¢æˆ·ç«¯å­˜å‚¨ã€HASHä¸€è‡´æ€§ã€ç»Ÿä¸€å­˜å‚¨ï¼‰ã€‚è¯¦æƒ…è¯·çœ‹ï¼š<a href="https://blog.csdn.net/hxxzbgkf/article/details/122727176">åˆ†å¸ƒå¼sessionè§£å†³æ–¹æ¡ˆ_åŠæ ¼å’–å•¡çš„åšå®¢-CSDNåšå®¢</a>ã€‚</p><p>ç¼ºç‚¹ï¼š</p><p> ï¼ˆ1ï¼‰æœåŠ¡å™¨å‹åŠ›å¢å¤§ï¼šé€šå¸¸sessionæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œæ¯ä¸ªç”¨æˆ·é€šè¿‡è®¤è¯ä¹‹åéƒ½ä¼šå°†sessionæ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨çš„å†…å­˜ä¸­ï¼Œè€Œå½“ç”¨æˆ·é‡å¢å¤§æ—¶ï¼ŒæœåŠ¡å™¨çš„å‹åŠ›å¢å¤§ã€‚ï¼ˆå¯ä»¥å°†æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼‰</p><p>ï¼ˆ2ï¼‰æ‰©å±•æ€§ä¸å¼ºï¼šå¦‚æœå°†æ¥æ­å»ºäº†å¤šä¸ªæœåŠ¡å™¨ï¼Œè™½ç„¶æ¯ä¸ªæœåŠ¡å™¨éƒ½æ‰§è¡Œçš„æ˜¯åŒæ ·çš„ä¸šåŠ¡é€»è¾‘ï¼Œä½†æ˜¯sessionæ•°æ®æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼ˆä¸æ˜¯å…±äº«çš„ï¼‰ï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®çš„æ˜¯æœåŠ¡å™¨1ï¼Œå½“ç”¨æˆ·å†æ¬¡è¯·æ±‚æ—¶å¯èƒ½è®¿é—®çš„æ˜¯å¦å¤–ä¸€å°æœåŠ¡å™¨2ï¼ŒæœåŠ¡å™¨2è·å–ä¸åˆ°sessionä¿¡æ¯ï¼Œå°±åˆ¤å®šç”¨æˆ·æ²¡æœ‰ç™»é™†è¿‡ã€‚ï¼ˆå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼sessionå°†sessionåœ¨å„ä¸ªé›†ç¾¤ä¸­ä¿æŒä¸€è‡´ï¼‰</p><p>ï¼ˆ3ï¼‰CSRFè·¨ç«™ä¼ªé€ è¯·æ±‚æ”»å‡»ï¼šsessionæ˜¯åŸºäºcookieè¿›è¡Œç”¨æˆ·è¯†åˆ«çš„, cookieå¦‚æœè¢«æˆªè·ï¼Œç”¨æˆ·å°±ä¼šå¾ˆå®¹æ˜“å—åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ çš„æ”»å‡»ã€‚</p><blockquote><p>CSRFï¼ˆCross-Site Request Forgeryï¼Œè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰æ”»å‡»æ˜¯ä¸€ç§é’ˆå¯¹Webåº”ç”¨ç¨‹åºçš„æ”»å‡»æ–¹å¼ï¼Œå®ƒåˆ©ç”¨ç”¨æˆ·åœ¨å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šçš„æœ‰æ•ˆä¼šè¯ï¼ˆSessionï¼‰æ¥å‘é€æ¶æ„è¯·æ±‚ã€‚</p></blockquote><h2 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h2><p>Token æ˜¯ä»¤ç‰Œçš„æ„æ€ï¼Œç”±æœåŠ¡ç«¯ç”Ÿæˆå¹¶å‘æ”¾ç»™å®¢æˆ·ç«¯ï¼Œæ˜¯ä¸€ç§å…·æœ‰æ—¶æ•ˆæ€§çš„éªŒè¯èº«ä»½çš„æ‰‹æ®µã€‚</p><p>Token é¿å…äº† Session æœºåˆ¶å¸¦æ¥çš„æµ·é‡ä¿¡æ¯å­˜å‚¨é—®é¢˜ï¼Œä¹Ÿé¿å…äº† Cookie æœºåˆ¶çš„ä¸€äº›å®‰å…¨æ€§é—®é¢˜ï¼Œåœ¨ç°ä»£ç§»åŠ¨äº’è”ç½‘åœºæ™¯ã€è·¨åŸŸè®¿é—®ç­‰åœºæ™¯æœ‰å¹¿æ³›çš„ç”¨é€”ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261939701.png" alt="img"></p><h1 id="æœºåœºé¡¹ç›®åå°ç®¡ç†ç³»ç»Ÿç™»å½•æµç¨‹"><a href="#æœºåœºé¡¹ç›®åå°ç®¡ç†ç³»ç»Ÿç™»å½•æµç¨‹" class="headerlink" title="æœºåœºé¡¹ç›®åå°ç®¡ç†ç³»ç»Ÿç™»å½•æµç¨‹"></a>æœºåœºé¡¹ç›®åå°ç®¡ç†ç³»ç»Ÿç™»å½•æµç¨‹</h1><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261939282.jpeg" alt="img"></p><p>é€šè¿‡è®¾ç½®ä¸€ä¸ªä¸­å¤®ç™»å½•æ³¨å†Œä¸­å¿ƒï¼Œè¯¥ä¸­å¿ƒè´Ÿè´£ç”ŸæˆTokenå¹¶ä¿å­˜åˆ°cookieä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚è¯¥æµè§ˆå™¨å¾—åˆ°è¿™ä¸ªcookieåè·³è½¬åˆ°å­åº”ç”¨ï¼ŒåŒæ­¥æ£€æµ‹æœ¬åœ°ã€æœ¬åº”ç”¨æœåŠ¡ç«¯æ˜¯å¦æœ‰è¯¥Tokenä¿æŒçš„ç™»å½•ä¿¡æ¯ï¼Œå¦‚æœéƒ½æ²¡æœ‰åˆ™ä¼šè®¿é—®ç™»å½•æ³¨å†ŒæœåŠ¡ä¸­å¿ƒï¼Œè¯¥æœåŠ¡ä¸­å¿ƒä¼šè§£æè¿™ä¸ªTokenå¹¶åŒæ—¶åˆ¤æ–­è¯¥Tokenæ˜¯å¦æœ‰æ•ˆï¼Œæœ‰æ•ˆåè¿”å›ç”¨æˆ·çš„ç™»å½•å…·ä½“ä¿¡æ¯ï¼Œå‰ç«¯é¡µé¢å°†ä¼šä¿å­˜ä¸€ä»½åˆ°æœ¬åœ°ï¼Œä¹‹åæ¯æ¬¡è¯·æ±‚ä¹Ÿä¼šå°†è¯¥ä¿¡æ¯ä¿å­˜åˆ°æœ¬åœ°åç«¯æœåŠ¡å™¨ä¸­ã€‚</p><h1 id="å•ç‚¹ç™»å½•Demoåˆ†æ"><a href="#å•ç‚¹ç™»å½•Demoåˆ†æ" class="headerlink" title="å•ç‚¹ç™»å½•Demoåˆ†æ"></a>å•ç‚¹ç™»å½•Demoåˆ†æ</h1><p>**&#x2F;**<strong>board-gov-sso-service&#x2F;config&#x2F;PublicDataCache.javaæ–‡ä»¶</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–æ•°æ®ç¼“å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="comment">// @Component æ³¨è§£è¡¨æ˜è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªSpringçš„ç»„ä»¶ï¼Œå°†ç”±Springå®¹å™¨è¿›è¡Œç®¡ç†å’Œå®ä¾‹åŒ–ã€‚</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–æ‰€æœ‰çš„å‚æ•°</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PublicDataCache</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;Long, SysApplicationDTO&gt; APP_MAP_CACHE = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Long, SysApplicationDTO&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿œç¨‹è°ƒç”¨æ¥å£ è·å–æ‰€æœ‰çš„Appåˆ—è¡¨ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RemoteAppService appService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PostConstructæ³¨è§£ä¸ºè¯¥ç±»å®ä¾‹åŒ–åé©¬ä¸Šæ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line">   <span class="meta">@PostConstruct</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="comment">//ç³»ç»Ÿå¯åŠ¨ä¸­ã€‚ã€‚ã€‚åŠ è½½codeMap</span></span><br><span class="line">      R&lt;List&lt;SysApplicationDTO&gt;&gt; appListR = appService.getAppList();</span><br><span class="line">      <span class="keyword">if</span>(appListR == <span class="literal">null</span> || appListR.getData() == <span class="literal">null</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      List&lt;SysApplicationDTO&gt; appList = appListR.getData();</span><br><span class="line">      <span class="keyword">for</span> (SysApplicationDTO app : appList) &#123;</span><br><span class="line">         APP_MAP_CACHE.put(app.getAppId(), app);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PreDestroyæ³¨è§£ä¸ºåœ¨ç±»è¢«é”€æ¯å‰æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">   <span class="meta">@PreDestroy</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="comment">//ç³»ç»Ÿè¿è¡Œç»“æŸ</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯¥æ³¨è§£æ ¹æ®cronçš„é…ç½®æ¥å®šæ—¶æ‰§è¡ŒæŸé¡¹æ–¹æ³•---å®šæ—¶ä»»åŠ¡ å¹´ æœˆ æ—¥ æ—¶ åˆ† ç§’ </span></span><br><span class="line">   <span class="meta">@Scheduled(cron = &quot;0 0 0/2 * * ?&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testOne</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">//æ¯2å°æ—¶æ‰§è¡Œä¸€æ¬¡ç¼“å­˜</span></span><br><span class="line">      <span class="comment">//todo åé¢ç”¨xxl jobå®ç°</span></span><br><span class="line">      init();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>SsoLoginController.javaæ–‡ä»¶</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="meta">@Tag(description = &quot;loginManagement&quot;, name = &quot;ç™»å½•ç®¡ç†&quot;)</span></span><br><span class="line"><span class="meta">@Inner(value = false)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SsoLoginController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginService loginService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RemoteAppService appService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SsoProperties ssoProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;ç™»å½•è·³è½¬æ¥å£&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Model model,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(name = &quot;appSign&quot;, required = false)</span> String appSign,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(name = &quot;redirectUrl&quot;, required = false)</span> String redirectUrl)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(appSign))&#123;</span><br><span class="line">            appSign = appSign.replaceAll(SsoServiceConstants.SIGN_SPACE, SsoServiceConstants.SIGN_ADD);</span><br><span class="line">        &#125;</span><br><span class="line">        model.addAttribute(SsoServiceConstants.URL_PARAM_APPSIGN, appSign);</span><br><span class="line">        model.addAttribute(SsoServiceConstants.REDIRECT_URL_STRING, redirectUrl);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­cookieä¸­æ˜¯å¦å­˜åœ¨æ•°æ®</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span>(cookies == <span class="literal">null</span> || cookies.length &lt; <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//response.sendRedirect(&quot;http://localhost:8082/login&quot;);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/login2&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Cookie c : cookies) &#123;</span><br><span class="line">            <span class="keyword">if</span> (c.getName().contains(SsoServiceConstants.SSO_USE_SPACE)) &#123;</span><br><span class="line">                token = c.getValue();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­redisæ˜¯å¦å­˜åœ¨æ•°æ®</span></span><br><span class="line">        <span class="type">UserLogInInfoDTO</span> <span class="variable">userInfo</span> <span class="operator">=</span> loginService.checkToken(token);</span><br><span class="line">        <span class="keyword">if</span>(userInfo == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//response.sendRedirect(&quot;http://localhost:8082/login&quot;);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/login2&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        userInfo.setToken(token);</span><br><span class="line">        model.addAttribute(SsoServiceConstants.USER_INFO_STRING, userInfo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ ¡éªŒappåˆæ³•æ€§</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">appId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">appSecret</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(appSign))&#123;</span><br><span class="line">            <span class="keyword">if</span>(appSign.indexOf(SsoServiceConstants.SIGN_COLON_STRING) == <span class="number">0</span>)&#123;</span><br><span class="line">                appSign = appSign.substring(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(appSign.indexOf(SsoServiceConstants.SIGN_COLON_STRING) == appSign.length()-<span class="number">1</span>)&#123;</span><br><span class="line">                appSign = appSign.substring(<span class="number">0</span>, appSign.length()-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">md5</span> <span class="operator">=</span> MD5Util.getMD5(ssoProperties.getMd5Key());</span><br><span class="line">            <span class="type">String</span> <span class="variable">publicPass</span> <span class="operator">=</span> AESUtil.decrypt(appSign, md5);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isBlank(publicPass) || !publicPass.contains(SsoServiceConstants.SIGN_COLON_STRING))&#123;</span><br><span class="line">                log.info(<span class="string">&quot;appSignæ ¡éªŒä¸é€šè¿‡&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login error: appSignæ ¡éªŒä¸é€šè¿‡&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String[] split = publicPass.split(SsoServiceConstants.SIGN_COLON_STRING);</span><br><span class="line">            appId = Long.valueOf(split[<span class="number">0</span>]);</span><br><span class="line">            appSecret = split[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        model.addAttribute(SsoServiceConstants.APP_ID_STRING, appId);</span><br><span class="line">        model.addAttribute(SsoServiceConstants.APP_SECRET_STRING, appSecret);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(appId == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// è·³è½¬æ€»æ§é¡µé¢å¸¦ä¸Šå‚æ•° token æˆ–è€…userInfo(å¯èƒ½æ˜¯ä»å¤§å±ç›´æ¥è¯·æ±‚è¿‡æ¥çš„)</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">AppLoginInfoDTO</span> <span class="variable">curAppInfo</span> <span class="operator">=</span> loginService.getAppInfo(userInfo, appId, appSecret);</span><br><span class="line">        <span class="keyword">if</span>(curAppInfo != <span class="literal">null</span> &amp;&amp; curAppInfo.getExpFlag())&#123;</span><br><span class="line">            log.info(<span class="string">&quot;å½“å‰è¯·æ±‚åº”ç”¨å­˜åœ¨å¼‚å¸¸ æ¸…ç†ç™»å½•ä¿¡æ¯è¿”å›ç™»å½•é¡µé¢&quot;</span>);</span><br><span class="line">            <span class="comment">//response.sendRedirect(&quot;http://localhost:8082/login&quot;);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/login2&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(curAppInfo == <span class="literal">null</span> || StringUtils.isBlank(curAppInfo.getCallbackUrl()))&#123;</span><br><span class="line">            <span class="comment">//è·³è½¬æ€»æ§é¡µé¢ å¸¦ä¸Šå‚æ•° token æˆ–è€…userInfo   å› ä¸ºæ²¡æœ‰è¯¥åº”ç”¨æƒé™/æˆ–ç€è¯¥åº”ç”¨æ²¡æœ‰é…ç½®å›è°ƒåœ°å€</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡æœ‰ä¼ é‡å®šå‘urlå°±é»˜è®¤å–åº”ç”¨é…ç½®çš„é¦–é¡µurl</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(redirectUrl))&#123;</span><br><span class="line">            userInfo.setRedirectUrl(redirectUrl);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            userInfo.setRedirectUrl(curAppInfo.getIndexUrl());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//çº¦å®šçš„32ä½å¯†é’¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">encrypt</span> <span class="operator">=</span> AESUtil.encrypt(JSONObject.toJSONString(userInfo), ssoProperties.getCallbackPass());</span><br><span class="line">            <span class="type">String</span> <span class="variable">sign</span> <span class="operator">=</span> MD5Util.getMD5(<span class="string">&quot;sso&quot;</span> + curAppInfo.getAppKey()</span><br><span class="line">                    + <span class="string">&quot;salt2&quot;</span> + DateUtil.thisHour(<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">finalUrl</span> <span class="operator">=</span> curAppInfo.getCallbackUrl() + <span class="string">&quot;?data=&quot;</span> + encrypt + <span class="string">&quot;&amp;sign=&quot;</span> + sign;</span><br><span class="line">            response.sendRedirect(finalUrl);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;é‡å®šå‘åº”ç”¨å›è°ƒåœ°å€å¤±è´¥!&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/saveToken&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;ä¿å­˜tokenæ¥å£&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveToken</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Model model,</span></span><br><span class="line"><span class="params">                            <span class="meta">@RequestBody</span> SaveTokenReqVO saveTokenReqVO)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(saveTokenReqVO) || StringUtils.isBlank(saveTokenReqVO.getToken()))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;tokenä¸èƒ½ä¸ºç©º, è¯·é‡æ–°ç™»å½•!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;login2&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> saveTokenReqVO.getToken();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> Long.valueOf(saveTokenReqVO.getUserId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> saveTokenReqVO.getRedirectUrl();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡usernameæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        R&lt;QuerySysUserAppRespDTO&gt; userAppTableR = appService.getUserAppList(userId);</span><br><span class="line">        <span class="type">QuerySysUserAppRespDTO</span> <span class="variable">data</span> <span class="operator">=</span> userAppTableR.getData();</span><br><span class="line">        <span class="type">UserLogInInfoDTO</span> <span class="variable">userInfo</span> <span class="operator">=</span> loginService.toUserInfo(data);</span><br><span class="line">        userInfo.setToken(token);</span><br><span class="line">        userInfo.setRedirectUrl(redirectUrl);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”¨æˆ·ç™»å½•æ—¶ æœªä¼ å…¥appä¿¡æ¯ ç›´æ¥è·³è½¬ä¸»æ§é¡µ</span></span><br><span class="line">        <span class="keyword">if</span>(saveTokenReqVO.getAppId() == <span class="literal">null</span> &amp;&amp; StringUtils.isBlank(saveTokenReqVO.getAppSign()))&#123;</span><br><span class="line">            model.addAttribute(SsoServiceConstants.USER_INFO_STRING, userInfo);</span><br><span class="line">            loginService.saveUserLoginInfo(response, userInfo);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ ¡éªŒåº”ç”¨åˆæ³•æ€§</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">appId</span> <span class="operator">=</span> saveTokenReqVO.getAppId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">appSecret</span> <span class="operator">=</span> saveTokenReqVO.getAppSecret();</span><br><span class="line">        <span class="type">String</span> <span class="variable">appSign</span> <span class="operator">=</span> saveTokenReqVO.getAppSign();</span><br><span class="line">        <span class="keyword">if</span>(appId == <span class="literal">null</span> || StringUtils.isBlank(appSecret))&#123;</span><br><span class="line">            appSign = appSign.replaceAll(SsoServiceConstants.SIGN_SPACE, SsoServiceConstants.SIGN_ADD);</span><br><span class="line">            <span class="keyword">if</span>(appSign.indexOf(SsoServiceConstants.SIGN_COLON_STRING) == <span class="number">0</span>)&#123;</span><br><span class="line">                appSign = appSign.substring(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(appSign.indexOf(SsoServiceConstants.SIGN_COLON_STRING) == appSign.length()-<span class="number">1</span>)&#123;</span><br><span class="line">                appSign = appSign.substring(<span class="number">0</span>, appSign.length()-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">md5</span> <span class="operator">=</span> MD5Util.getMD5(ssoProperties.getMd5Key());</span><br><span class="line">            <span class="type">String</span> <span class="variable">publicPass</span> <span class="operator">=</span> AESUtil.decrypt(appSign, md5);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isBlank(publicPass) || !publicPass.contains(SsoServiceConstants.SIGN_COLON_STRING))&#123;</span><br><span class="line">                log.info(<span class="string">&quot;appSign æ ¡éªŒä¸é€šè¿‡&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String[] split = publicPass.split(SsoServiceConstants.SIGN_COLON_STRING);</span><br><span class="line">            appId = Long.valueOf(split[<span class="number">0</span>]);</span><br><span class="line">            appSecret = split[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ ¡éªŒåº”ç”¨å¯†é’¥æ­£ç¡®æ€§</span></span><br><span class="line">        <span class="type">AppLoginInfoDTO</span> <span class="variable">curAppInfo</span> <span class="operator">=</span> loginService.getAppInfo(userInfo, appId, appSecret);</span><br><span class="line">        <span class="keyword">if</span>(curAppInfo != <span class="literal">null</span> &amp;&amp; curAppInfo.getExpFlag())&#123;</span><br><span class="line">            log.info(<span class="string">&quot;å½“å‰è¯·æ±‚åº”ç”¨å­˜åœ¨å¼‚å¸¸ æ¸…ç†ç™»å½•ä¿¡æ¯è¿”å›ç™»å½•é¡µé¢&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/login2&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(curAppInfo == <span class="literal">null</span>)&#123;</span><br><span class="line">            model.addAttribute(SsoServiceConstants.USER_INFO_STRING, userInfo);</span><br><span class="line">            loginService.saveUserLoginInfo(response, userInfo);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(redirectUrl))&#123;</span><br><span class="line">            userInfo.setRedirectUrl(redirectUrl);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            userInfo.setRedirectUrl(curAppInfo.getIndexUrl());</span><br><span class="line">        &#125;</span><br><span class="line">        loginService.saveUserLoginInfo(response, userInfo);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">finalUrl</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//çº¦å®šçš„32ä½å¯†é’¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">encrypt</span> <span class="operator">=</span> AESUtil.encrypt(JSONObject.toJSONString(userInfo), ssoProperties.getCallbackPass());</span><br><span class="line">            <span class="type">String</span> <span class="variable">sign</span> <span class="operator">=</span> MD5Util.getMD5(ssoProperties.getSsoKey() + curAppInfo.getAppKey() + ssoProperties.getAppSalt() + DateUtil.thisHour(<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">            finalUrl = curAppInfo.getCallbackUrl() + SsoServiceConstants.SIGN_QUESTION_MARK + SsoServiceConstants.DATA_STRING + SsoServiceConstants.SIGN_EQUAL_TO + encrypt</span><br><span class="line">                    + SsoServiceConstants.SIGN_AND + SsoServiceConstants.SIGN_STRING + SsoServiceConstants.SIGN_EQUAL_TO + sign;</span><br><span class="line">            response.sendRedirect(finalUrl);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;é‡å®šå‘åº”ç”¨å›è°ƒåœ°å€å¤±è´¥ï¼š&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> finalUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/check&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;æ ¡éªŒæ˜¯å¦å·²ç™»å½•æ¥å£&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;UserLogInInfoDTO&gt; <span class="title function_">checkIsLogin</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­cookieä¸­æ˜¯å¦å­˜åœ¨æ•°æ®</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span>(cookies == <span class="literal">null</span> || cookies.length &lt; <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.failed(<span class="string">&quot;cookieä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Cookie c : cookies) &#123;</span><br><span class="line">            <span class="keyword">if</span> (c.getName().contains(SsoServiceConstants.SSO_USE_SPACE)) &#123;</span><br><span class="line">                token = c.getValue();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­redisæ˜¯å¦å­˜åœ¨æ•°æ®</span></span><br><span class="line">        <span class="type">UserLogInInfoDTO</span> <span class="variable">userInfo</span> <span class="operator">=</span> loginService.checkToken(token);</span><br><span class="line">        <span class="keyword">if</span>(userInfo == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.failed(<span class="string">&quot;ç¼“å­˜æ•°æ®ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        userInfo.setToken(token);</span><br><span class="line">        <span class="keyword">return</span> R.ok(userInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/saveTokenInfo&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;ä¿å­˜tokenæ¥å£&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;UserLogInInfoDTO&gt; <span class="title function_">saveTokenInfo</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                            <span class="meta">@RequestBody</span> SaveTokenReqVO saveTokenReqVO)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åç»­è·³è½¬å‡äº¤ç”±Vueå‰ç«¯å®Œæˆ ä¸”å‡ä¸ºå†…éƒ¨é¡µé¢è·³è½¬ æ•…ä¸å†éœ€è¦åšå®‰å…¨æ€§æ ¡éªŒ</span></span><br><span class="line">        <span class="comment">//æ­¤æ¥å£ä»…ä½œä¸ºtokenæ•°æ®çš„å­˜å‚¨ä»¥åŠ åç»­è·³è½¬åœ°å€çš„æŒ‡å‘</span></span><br><span class="line">        <span class="keyword">if</span>(ObjectUtils.isEmpty(saveTokenReqVO) || StringUtils.isBlank(saveTokenReqVO.getToken()))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;tokenä¸èƒ½ä¸ºç©º, è¯·é‡æ–°ç™»å½•!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> R.failed(<span class="string">&quot;tokenä¸èƒ½ä¸ºç©º, è¯·é‡æ–°ç™»å½•!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> saveTokenReqVO.getToken();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> Long.valueOf(saveTokenReqVO.getUserId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> saveTokenReqVO.getRedirectUrl();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ·åŠå…¶æ‰€æ‹¥æœ‰æƒé™çš„åº”ç”¨åˆ—è¡¨ä¿¡æ¯</span></span><br><span class="line">        R&lt;QuerySysUserAppRespDTO&gt; userAppListRespInfo = appService.getUserAppList(userId);</span><br><span class="line">        <span class="type">QuerySysUserAppRespDTO</span> <span class="variable">querySysUserAppRespDTO</span> <span class="operator">=</span> userAppListRespInfo.getData();</span><br><span class="line">        <span class="type">UserLogInInfoDTO</span> <span class="variable">userInfo</span> <span class="operator">=</span> loginService.toUserInfo(querySysUserAppRespDTO);</span><br><span class="line">        userInfo.setToken(token);</span><br><span class="line">        userInfo.setRedirectUrl(redirectUrl);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”¨æˆ·ç™»å½•æ—¶ æœªä¼ å…¥appä¿¡æ¯ ç›´æ¥è·³è½¬ä¸»æ§é¡µ</span></span><br><span class="line">        <span class="keyword">if</span>(saveTokenReqVO.getAppId() == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//userInfo.setRedirectUrl(&quot;/Index.vue&quot;);</span></span><br><span class="line">            loginService.saveUserLoginInfo(response, userInfo);</span><br><span class="line">            <span class="keyword">return</span> R.ok(userInfo);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ ¡éªŒåº”ç”¨åˆæ³•æ€§</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">appId</span> <span class="operator">=</span> saveTokenReqVO.getAppId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">appSecret</span> <span class="operator">=</span> saveTokenReqVO.getAppSecret();</span><br><span class="line">        <span class="type">String</span> <span class="variable">appSign</span> <span class="operator">=</span> saveTokenReqVO.getAppSign();</span><br><span class="line">        <span class="keyword">if</span>(appId == <span class="literal">null</span> || StringUtils.isBlank(appSecret))&#123;</span><br><span class="line">            appSign = appSign.replaceAll(SsoServiceConstants.SIGN_SPACE, SsoServiceConstants.SIGN_ADD);</span><br><span class="line">            <span class="keyword">if</span>(appSign.indexOf(SsoServiceConstants.SIGN_COLON_STRING) == <span class="number">0</span>)&#123;</span><br><span class="line">                appSign = appSign.substring(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(appSign.indexOf(SsoServiceConstants.SIGN_COLON_STRING) == appSign.length()-<span class="number">1</span>)&#123;</span><br><span class="line">                appSign = appSign.substring(<span class="number">0</span>, appSign.length()-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">saltKey</span> <span class="operator">=</span> MD5Util.getMD5(ssoProperties.getMd5Key());</span><br><span class="line">            <span class="type">String</span> <span class="variable">publicPass</span> <span class="operator">=</span> AESUtil.decrypt(appSign, saltKey);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isBlank(publicPass) || !publicPass.contains(SsoServiceConstants.SIGN_COLON_STRING))&#123;</span><br><span class="line">                log.info(<span class="string">&quot;appSign æ ¡éªŒä¸é€šè¿‡&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> R.failed(<span class="string">&quot;appSign æ ¡éªŒä¸é€šè¿‡&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            String[] split = publicPass.split(SsoServiceConstants.SIGN_COLON_STRING);</span><br><span class="line">            appId = Long.valueOf(split[<span class="number">0</span>]);</span><br><span class="line">            appSecret = split[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ ¡éªŒåº”ç”¨å¯†é’¥æ­£ç¡®æ€§</span></span><br><span class="line">        <span class="type">AppLoginInfoDTO</span> <span class="variable">curAppInfo</span> <span class="operator">=</span> loginService.getAppInfo(userInfo, appId, appSecret);</span><br><span class="line">        <span class="keyword">if</span>(curAppInfo != <span class="literal">null</span> &amp;&amp; curAppInfo.getExpFlag())&#123;</span><br><span class="line">            log.info(<span class="string">&quot;å½“å‰è¯·æ±‚åº”ç”¨å­˜åœ¨å¼‚å¸¸ æ¸…ç†ç™»å½•ä¿¡æ¯è¿”å›ç™»å½•é¡µé¢&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> R.failed(<span class="string">&quot;å½“å‰è¯·æ±‚åº”ç”¨å­˜åœ¨å¼‚å¸¸ æ¸…ç†ç™»å½•ä¿¡æ¯è¿”å›ç™»å½•é¡µé¢&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(curAppInfo == <span class="literal">null</span>)&#123;</span><br><span class="line">            loginService.saveUserLoginInfo(response, userInfo);</span><br><span class="line">            <span class="keyword">return</span> R.ok(userInfo);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(redirectUrl))&#123;</span><br><span class="line">            userInfo.setRedirectUrl(redirectUrl);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            userInfo.setRedirectUrl(curAppInfo.getIndexUrl());</span><br><span class="line">        &#125;</span><br><span class="line">        loginService.saveUserLoginInfo(response, userInfo);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">finalUrl</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//çº¦å®šçš„32ä½å¯†é’¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">encrypt</span> <span class="operator">=</span> AESUtil.encrypt(JSONObject.toJSONString(userInfo), ssoProperties.getCallbackPass());</span><br><span class="line">            <span class="type">String</span> <span class="variable">sign</span> <span class="operator">=</span> MD5Util.getMD5(ssoProperties.getSsoKey() + curAppInfo.getAppKey() + ssoProperties.getAppSalt() + DateUtil.thisHour(<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å®šä¹‰Callbackåœ°å€</span></span><br><span class="line">            finalUrl = curAppInfo.getCallbackUrl() + SsoServiceConstants.SIGN_QUESTION_MARK</span><br><span class="line">                    + SsoServiceConstants.DATA_STRING + SsoServiceConstants.SIGN_EQUAL_TO + encrypt</span><br><span class="line">                    + SsoServiceConstants.SIGN_AND + SsoServiceConstants.SIGN_STRING + SsoServiceConstants.SIGN_EQUAL_TO + sign;</span><br><span class="line">            response.sendRedirect(finalUrl);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;é‡å®šå‘åº”ç”¨å›è°ƒåœ°å€å¤±è´¥ï¼š&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(userInfo.getRedirectUrl()))&#123;</span><br><span class="line">            userInfo.setRedirectUrl(<span class="string">&quot;/Index.vue&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.ok(userInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getAppSign&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;è·å–appSign&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">getAppSign</span><span class="params">(<span class="meta">@RequestParam(value = &quot;appId&quot;)</span> Long appId,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@RequestParam(value = &quot;secret&quot;)</span> String secret)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">appSign</span> <span class="operator">=</span> loginService.getAppSign(appId, secret);</span><br><span class="line">        <span class="keyword">return</span> R.ok(appSign);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/checkAppSign&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;æ ¡éªŒappSign&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Boolean&gt; <span class="title function_">checkAppSign</span><span class="params">(<span class="meta">@RequestParam(value = &quot;appId&quot;)</span> Long appId,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@RequestParam(value = &quot;appSign&quot;)</span> String appSign)</span>&#123;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">result</span> <span class="operator">=</span> loginService.checkAppSign(appId, appSign);</span><br><span class="line">        <span class="keyword">return</span> R.ok(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SSO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>33 Javaè®¾è®¡æ¨¡å¼</title>
      <link href="/2025/02/26/33%20Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/02/26/33%20Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="33-Javaè®¾è®¡æ¨¡å¼"><a href="#33-Javaè®¾è®¡æ¨¡å¼" class="headerlink" title="33 Javaè®¾è®¡æ¨¡å¼"></a>33 Javaè®¾è®¡æ¨¡å¼</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/zhangerqing/article/details/8194653">Javaä¹‹ç¾[ä»èœé¸Ÿåˆ°é«˜æ‰‹æ¼”å˜]ä¹‹è®¾è®¡æ¨¡å¼</a></li><li></li></ol><h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><p>æ€»ä½“æ¥è¯´è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><p>åˆ›å»ºå‹æ¨¡å¼ï¼Œå…±äº”ç§ï¼š<strong>å·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚</strong></p><p>ç»“æ„å‹æ¨¡å¼ï¼Œå…±ä¸ƒç§ï¼š<strong>é€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼</strong>ã€‚</p><p>è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…±åä¸€ç§ï¼š<strong>ç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼</strong>ã€‚</p><p>å…¶å®è¿˜æœ‰ä¸¤ç±»ï¼šå¹¶å‘å‹æ¨¡å¼å’Œçº¿ç¨‹æ± æ¨¡å¼ã€‚ç”¨ä¸€ä¸ªå›¾ç‰‡æ¥æ•´ä½“æè¿°ä¸€ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261946024.jpeg" alt="img"></p><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><h3 id="æ™®é€šå·¥å‚æ¨¡å¼"><a href="#æ™®é€šå·¥å‚æ¨¡å¼" class="headerlink" title="æ™®é€šå·¥å‚æ¨¡å¼"></a>æ™®é€šå·¥å‚æ¨¡å¼</h3><p>å»ºç«‹ä¸€ä¸ªå·¥å‚ç±»ï¼Œè¯¥ç±»ä¼šå¯¹å®ç°äº†æŸä¸€æ¥å£çš„ç±»è¿›è¡Œå®ä¾‹åŒ–ã€‚ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªå·¥å…·ç±»æ—¶ï¼Œä¼ å…¥éœ€è¦åˆ›å»ºç±»çš„ç±»å‹ï¼Œç„¶åå·¥å‚ç±»åˆ›å»ºè¿›è¡Œè¿”å›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261946614.png" alt="img"></p><p>ä»¥è¿™ä¸ªä¸ºä¾‹ï¼Œæ¥å£Senderçš„ä¸¤ä¸ªå®ç°ç±»Mail and Smså®ç°äº†æ¥å£å®šä¹‰çš„æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ¥å£çš„å·¥å‚ç±»ä¸­ä¼šè¿™æ ·å†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendFactory</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produce</span><span class="params">(String type)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;mail&quot;</span>.equals(type)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MailSender</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;sms&quot;</span>.equals(type)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsSender</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;è¯·è¾“å…¥æ­£ç¡®çš„ç±»å‹!&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¥å‚ç±»ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryTest</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">SendFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendFactory</span>();</span><br><span class="line"><span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> factory.produce(<span class="string">&quot;sms&quot;</span>);</span><br><span class="line">sender.Send();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æˆ‘ä»¬è®¤çœŸæ€è€ƒä¸€ä¸‹è¿™ä¸ªå·¥å‚ï¼Œå¦‚æœä¼ å…¥çš„æ•°æ®å‚æ•°å‡ºç°é—®é¢˜ï¼Œåˆ™è¿™ä¸ªå·¥å‚å°±ä¸èƒ½æˆåŠŸåˆ›å»ºå‡ºæ­£å¸¸çš„å®ç°ç±»ã€‚</strong></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<strong>å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼</strong>å‡ºç°äº†ã€‚</p><h3 id="å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼"></a>å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>ä¸ºäº†è§£å†³æ™®é€šå·¥å‚å‡ºç°çš„é—®é¢˜ï¼Œå¤šä¸ªå·¥å‚å®ç°ç±»çš„è§£å†³æ–¹æ³•ä¸ºï¼š<strong>ä¸ºåŸæ¥çš„æ™®é€šå·¥å‚å®ç°ç±»æ·»åŠ æ¥å£å®ç°ç±»çš„å®ä¾‹åŒ–æ–¹æ³•</strong>ï¼Œä½¿ç”¨è€…åªéœ€è¦è°ƒç”¨è¯¥å·¥å‚æä¾›çš„æŸä¸ªç±»çš„å®ä¾‹åŒ–æ–¹æ³•è¿›è¡Œåˆ›å»ºå³å¯ï¼Œè¿™æ ·å°±ä¸å¯èƒ½å‡ºç°ä¼ å…¥å‚æ•°å‡ºé”™ç­‰é—®é¢˜ã€‚</p><p>SendFactoryç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendFactory</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produceMail</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MailSender</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produceSms</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsSender</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¥å‚ä½¿ç”¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryTest</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">SendFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendFactory</span>();</span><br><span class="line"><span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> factory.produceMail();</span><br><span class="line">sender.Send();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼"></a>é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>å›é¡¾ä¸€ä¸‹ä¸Šæ–‡çš„å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå¦‚æœä½¿ç”¨è€…éœ€è¦ä½¿ç”¨è¿™ä¸ªå·¥å‚æ—¶ï¼Œå°±éœ€è¦åˆ›å»ºä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨çš„åœ°æ–¹è¿‡å¤šï¼Œå°±ä¼šå­˜åœ¨å¤§é‡é‡å¤çš„å·¥å‚å¯¹è±¡ï¼Œæ¶ˆè€—äº†å†…å­˜ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªå·¥å‚æ–¹æ³•å®šä¹‰æˆé™æ€å·¥å‚æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261946444.jpg" alt="img_v3_02c8_ad246c57-4ec6-4d0a-9d25-05cabe9293cg"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendFactory</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Sender <span class="title function_">produceMail</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MailSender</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Sender <span class="title function_">produceSms</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsSender</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryTest</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> SendFactory.produceMail();</span><br><span class="line">sender.Send();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ä½“æ¥è¯´ï¼Œå·¥å‚æ¨¡å¼é€‚åˆï¼šå‡¡æ˜¯å‡ºç°äº†<strong>å¤§é‡çš„äº§å“éœ€è¦åˆ›å»º</strong>ï¼Œå¹¶ä¸”å…·æœ‰å…±åŒçš„æ¥å£æ—¶ï¼Œå¯ä»¥é€šè¿‡å·¥å‚æ–¹æ³•æ¨¡å¼è¿›è¡Œåˆ›å»ºã€‚åœ¨ä»¥ä¸Šçš„ä¸‰ç§æ¨¡å¼ä¸­ï¼Œç¬¬ä¸€ç§å¦‚æœä¼ å…¥çš„å­—ç¬¦ä¸²æœ‰è¯¯ï¼Œä¸èƒ½æ­£ç¡®åˆ›å»ºå¯¹è±¡ï¼Œç¬¬ä¸‰ç§ç›¸å¯¹äºç¬¬äºŒç§ï¼Œä¸éœ€è¦å®ä¾‹åŒ–å·¥å‚ç±»ï¼Œæ‰€ä»¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<strong>æˆ‘ä»¬ä¼šé€‰ç”¨ç¬¬ä¸‰ç§â€”â€”é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚</strong></p><h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>åœ¨ä¸Šæ–‡ä¸­çš„é™æ€å·¥å‚æ¨¡å¼ä¸­ï¼Œå¦‚æœåˆè¦æ–°å¢ä¸€ä¸ªç±»æ¥å®ç°è¿™ä¸ªå‘é€è¡Œä¸ºæ—¶ï¼Œå°±éœ€è¦åœ¨åŸæ¥çš„ä»£ç ä¸Šï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯å·¥å‚ç±»ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•åˆ›å»ºè¿™ä¸ªæ–°çš„è¡Œä¸ºç±»ã€‚ä½†æ˜¯è¿™ä¸ªåœ¨åŸæ¥çš„ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹çš„æ“ä½œæˆ‘ä»¬åº”å½“å°½é‡é¿å…ï¼Œè¿™æ˜¯å› ä¸ºä¿®æ”¹æ—¶å¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œä»è€Œé€ æˆä¸å¿…è¦çš„éº»çƒ¦ã€‚</p><p>æ‰€ä»¥æŠ½è±¡å·¥å‚æ¨¡å¼å°±æ˜¯ä¸ºäº†åœ¨éœ€è¦æ–°å¢æ—¶ä¸éœ€è¦åœ¨åŸæœ‰çš„ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œè€Œæ˜¯ç›´æ¥æ–°å¢ä¸€äº›ä¸œè¥¿æ¥è¾¾åˆ°æ•ˆæœã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261946474.jpg" alt="img_v3_02c8_ad246c57-4ec6-4d0a-9d25-05cabe9293cg"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Send</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailSender</span> <span class="keyword">implements</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Send</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;this is mailsender!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsSender</span> <span class="keyword">implements</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Send</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;this is sms sender!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Provider</span> &#123;</span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produce</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMailFactory</span> <span class="keyword">implements</span> <span class="title class_">Provider</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produce</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MailSender</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendSmsFactory</span> <span class="keyword">implements</span> <span class="title class_">Provider</span>&#123;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produce</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsSender</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">Provider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendMailFactory</span>();</span><br><span class="line"><span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> provider.produce();</span><br><span class="line">sender.Send();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ªæ¨¡å¼çš„å¥½å¤„å°±æ˜¯ï¼Œå¦‚æœä½ ç°åœ¨æƒ³å¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼šå‘åŠæ—¶ä¿¡æ¯ï¼Œåˆ™åªéœ€åšä¸€ä¸ªå®ç°ç±»ï¼Œå®ç°Senderæ¥å£ï¼ŒåŒæ—¶åšä¸€ä¸ªå·¥å‚ç±»ï¼Œå®ç°Provideræ¥å£ï¼Œå°±OKäº†ï¼Œ<strong>æ— éœ€å»æ”¹åŠ¨ç°æˆçš„ä»£ç ã€‚è¿™æ ·åšï¼Œæ‹“å±•æ€§è¾ƒå¥½ï¼</strong></p><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹å¯¹è±¡ï¼ˆSingletonï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚åœ¨Javaåº”ç”¨ä¸­ï¼Œå•ä¾‹å¯¹è±¡èƒ½ä¿è¯åœ¨ä¸€ä¸ªJVMä¸­ï¼Œ<strong>è¯¥å¯¹è±¡åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨</strong>ã€‚è¿™æ ·çš„æ¨¡å¼æœ‰å‡ ä¸ªå¥½å¤„ï¼š</p><p>1ã€æŸäº›ç±»åˆ›å»ºæ¯”è¾ƒé¢‘ç¹ï¼Œå¯¹äºä¸€äº›å¤§å‹çš„å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ç¬”å¾ˆå¤§çš„ç³»ç»Ÿå¼€é”€ã€‚</p><p>2ã€çœå»äº†newæ“ä½œç¬¦ï¼Œ<strong>é™ä½äº†ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é¢‘ç‡ï¼Œå‡è½»GCå‹åŠ›</strong>ã€‚</p><p>3ã€æœ‰äº›ç±»å¦‚äº¤æ˜“æ‰€çš„æ ¸å¿ƒäº¤æ˜“å¼•æ“ï¼Œæ§åˆ¶ç€äº¤æ˜“æµç¨‹ï¼Œå¦‚æœè¯¥ç±»å¯ä»¥åˆ›å»ºå¤šä¸ªçš„è¯ï¼Œç³»ç»Ÿå®Œå…¨ä¹±äº†ã€‚ï¼ˆæ¯”å¦‚ä¸€ä¸ªå†›é˜Ÿå‡ºç°äº†å¤šä¸ªå¸ä»¤å‘˜åŒæ—¶æŒ‡æŒ¥ï¼Œè‚¯å®šä¼šä¹±æˆä¸€å›¢ï¼‰ï¼Œæ‰€ä»¥åªæœ‰ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œæ‰èƒ½ä¿è¯æ ¸å¿ƒäº¤æ˜“æœåŠ¡å™¨ç‹¬ç«‹æ§åˆ¶æ•´ä¸ªæµç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* æŒæœ‰ç§æœ‰é™æ€å®ä¾‹ï¼Œé˜²æ­¢è¢«å¼•ç”¨ï¼Œæ­¤å¤„èµ‹å€¼ä¸ºnullï¼Œç›®çš„æ˜¯å®ç°å»¶è¿ŸåŠ è½½ */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢è¢«å®ä¾‹åŒ– */</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* é™æ€å·¥ç¨‹æ–¹æ³•ï¼Œåˆ›å»ºå®ä¾‹ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* å¦‚æœè¯¥å¯¹è±¡è¢«ç”¨äºåºåˆ—åŒ–ï¼Œå¯ä»¥ä¿è¯å¯¹è±¡åœ¨åºåˆ—åŒ–å‰åä¿æŒä¸€è‡´ */</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™ä¸ªå•ä¾‹ç±»è™½ç„¶å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†éœ€æ±‚ï¼Œä½†æ˜¯å¦‚æœèº«å¤„äºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå°±ä¼šå‡ºç°åˆ›å»ºå¤šä¸ªå®ä¾‹çš„æƒ…å†µï¼Œè¿™å°±ä¸¥é‡è¿èƒŒäº†å•ä¾‹æ¨¡å¼çš„åˆè¡·ã€‚</p><blockquote><p><strong>ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰</strong>ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ <code>getInstance()</code> æ–¹æ³•å¹¶ä¸” <code>instance</code> å˜é‡å½“å‰ä¸º <code>null</code> æ—¶ï¼Œä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥ <code>if (instance == null)</code> ä»£ç å—ã€‚</p><p><strong>å¤šä¸ªå®ä¾‹åˆ›å»º</strong>ï¼šç”±äºå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿›å…¥ <code>if</code> å—ï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Singleton</code> å®ä¾‹ã€‚è¿™ä¼šå¯¼è‡´åˆ›å»ºå¤šä¸ª <code>Singleton</code> å®ä¾‹ï¼Œä»è€Œç ´åå•ä¾‹æ¨¡å¼çš„è®¾è®¡æ„å›¾ã€‚</p></blockquote><h3 id="æ–¹æ³•åŠ é”"><a href="#æ–¹æ³•åŠ é”" class="headerlink" title="æ–¹æ³•åŠ é”"></a>æ–¹æ³•åŠ é”</h3><p>é‚£ä¹ˆå°±å¯ä»¥ç»™ç±»çš„æ–¹æ³•æ·»åŠ Synchronizedå…³é”®å­—ï¼Œç»™è¿™ä¸ªæ–¹æ³•åŠ ä¸Šé”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>synchronizedåŠ åœ¨æ–¹æ³•ä¸Šï¼Œåˆ™æ˜¯ç»™è¿™ä¸ªå¯¹è±¡ä¸Šé”ï¼Œè¿™é‡Œæ˜¯é™æ€æ–¹æ³•ï¼Œé‚£å°±æ˜¯ç»™è¿™ä¸ªç±»ä¸Šé”ã€‚å®é™…æƒ…å†µæ˜¯ï¼Œåªæœ‰åœ¨åˆå§‹åˆ›å»ºè¯¥å•ä¾‹ç±»çš„æ—¶å€™éœ€è¦ä¸Šé”ï¼Œå…¶ä»–æ—¶å€™ä¸éœ€è¦ä¸Šé”ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰å¯ä»¥æ”¹è¿›çš„ç©ºé—´ã€‚</p><h3 id="åŒé‡æ£€æŸ¥é”å®š"><a href="#åŒé‡æ£€æŸ¥é”å®š" class="headerlink" title="åŒé‡æ£€æŸ¥é”å®š"></a>åŒé‡æ£€æŸ¥é”å®š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p>a&gt;Aã€Bçº¿ç¨‹åŒæ—¶è¿›å…¥äº†ç¬¬ä¸€ä¸ªifåˆ¤æ–­</p></li><li><p>b&gt;Aé¦–å…ˆè¿›å…¥synchronizedå—ï¼Œç”±äºinstanceä¸ºnullï¼Œæ‰€ä»¥å®ƒæ‰§è¡Œinstance &#x3D; new Singleton();</p></li><li><p>c&gt;ç”±äºJVMå†…éƒ¨çš„ä¼˜åŒ–æœºåˆ¶ï¼ŒJVMå…ˆç”»å‡ºäº†ä¸€äº›åˆ†é…ç»™Singletonå®ä¾‹çš„ç©ºç™½å†…å­˜ï¼Œå¹¶èµ‹å€¼ç»™instanceæˆå‘˜ï¼ˆæ³¨æ„æ­¤æ—¶JVMæ²¡æœ‰å¼€å§‹åˆå§‹åŒ–è¿™ä¸ªå®ä¾‹ï¼‰ï¼Œç„¶åAç¦»å¼€äº†synchronizedå—ã€‚</p></li><li><p>d&gt;Bè¿›å…¥synchronizedå—ï¼Œç”±äºinstanceæ­¤æ—¶ä¸æ˜¯nullï¼Œå› æ­¤å®ƒé©¬ä¸Šç¦»å¼€äº†synchronizedå—å¹¶å°†ç»“æœè¿”å›ç»™è°ƒç”¨è¯¥æ–¹æ³•çš„ç¨‹åºã€‚</p></li><li><p>e&gt;æ­¤æ—¶Bçº¿ç¨‹æ‰“ç®—ä½¿ç”¨Singletonå®ä¾‹ï¼Œå´å‘ç°å®ƒæ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œäºæ˜¯é”™è¯¯å‘ç”Ÿäº†ã€‚</p></li></ol><p>æ‰€ä»¥ç¨‹åºè¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿé”™è¯¯ï¼Œå…¶å®ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹æ˜¯å¾ˆå¤æ‚çš„ï¼Œä»è¿™ç‚¹æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œå°¤å…¶æ˜¯åœ¨å†™å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„ç¨‹åºæ›´æœ‰éš¾åº¦ï¼Œæœ‰æŒ‘æˆ˜æ€§ã€‚æˆ‘ä»¬å¯¹è¯¥ç¨‹åºåšè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p><h3 id="é™æ€å†…éƒ¨ç±»"><a href="#é™æ€å†…éƒ¨ç±»" class="headerlink" title="é™æ€å†…éƒ¨ç±»"></a>é™æ€å†…éƒ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œ<strong>é™æ€ç±»ä¸èƒ½å®ç°æ¥å£ã€‚ï¼ˆä»ç±»çš„è§’åº¦è¯´æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯é‚£æ ·å°±ç ´åäº†é™æ€äº†ã€‚å› ä¸ºæ¥å£ä¸­ä¸å…è®¸æœ‰staticä¿®é¥°çš„æ–¹æ³•ï¼Œæ‰€ä»¥å³ä½¿å®ç°äº†ä¹Ÿæ˜¯éé™æ€çš„ï¼‰</strong></p><p>å…¶æ¬¡ï¼Œå•ä¾‹å¯ä»¥è¢«å»¶è¿Ÿåˆå§‹åŒ–ï¼Œé™æ€ç±»ä¸€èˆ¬åœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ˜¯åˆå§‹åŒ–ã€‚ä¹‹æ‰€ä»¥å»¶è¿ŸåŠ è½½ï¼Œæ˜¯å› ä¸ºæœ‰äº›ç±»æ¯”è¾ƒåºå¤§ï¼Œæ‰€ä»¥å»¶è¿ŸåŠ è½½æœ‰åŠ©äºæå‡æ€§èƒ½ã€‚</p><p>å†æ¬¡ï¼Œå•ä¾‹ç±»å¯ä»¥è¢«ç»§æ‰¿ï¼Œä»–çš„æ–¹æ³•å¯ä»¥è¢«è¦†å†™ã€‚ä½†æ˜¯é™æ€ç±»å†…éƒ¨æ–¹æ³•éƒ½æ˜¯staticï¼Œæ— æ³•è¢«è¦†å†™ã€‚</p><p>æœ€åä¸€ç‚¹ï¼Œå•ä¾‹ç±»æ¯”è¾ƒçµæ´»ï¼Œæ¯•ç«Ÿä»å®ç°ä¸Šåªæ˜¯ä¸€ä¸ªæ™®é€šçš„Javaç±»ï¼Œåªè¦æ»¡è¶³å•ä¾‹çš„åŸºæœ¬éœ€æ±‚ï¼Œä½ å¯ä»¥åœ¨é‡Œé¢éšå¿ƒæ‰€æ¬²çš„å®ç°ä¸€äº›å…¶å®ƒåŠŸèƒ½ï¼Œä½†æ˜¯é™æ€ç±»ä¸è¡Œã€‚ä»ä¸Šé¢è¿™äº›æ¦‚æ‹¬ä¸­ï¼ŒåŸºæœ¬å¯ä»¥çœ‹å‡ºäºŒè€…çš„åŒºåˆ«ï¼Œä½†æ˜¯ï¼Œä»å¦ä¸€æ–¹é¢è®²ï¼Œæˆ‘ä»¬ä¸Šé¢æœ€åå®ç°çš„é‚£ä¸ªå•ä¾‹æ¨¡å¼ï¼Œå†…éƒ¨å°±æ˜¯ç”¨ä¸€ä¸ªé™æ€ç±»æ¥å®ç°çš„ï¼Œæ‰€ä»¥ï¼ŒäºŒè€…æœ‰å¾ˆå¤§çš„å…³è”ï¼Œåªæ˜¯æˆ‘ä»¬è€ƒè™‘é—®é¢˜çš„å±‚é¢ä¸åŒç½¢äº†ã€‚ä¸¤ç§æ€æƒ³çš„ç»“åˆï¼Œæ‰èƒ½é€ å°±å‡ºå®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œå°±åƒHashMapé‡‡ç”¨æ•°ç»„+é“¾è¡¨æ¥å®ç°ä¸€æ ·ï¼Œå…¶å®ç”Ÿæ´»ä¸­å¾ˆå¤šäº‹æƒ…éƒ½æ˜¯è¿™æ ·ï¼Œå•ç”¨ä¸åŒçš„æ–¹æ³•æ¥å¤„ç†é—®é¢˜ï¼Œæ€»æ˜¯æœ‰ä¼˜ç‚¹ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œæœ€å®Œç¾çš„æ–¹æ³•æ˜¯ï¼Œç»“åˆå„ä¸ªæ–¹æ³•çš„ä¼˜ç‚¹ï¼Œæ‰èƒ½æœ€å¥½çš„è§£å†³é—®é¢˜ï¼</p><h4 id="ä¸ºä»€ä¹ˆè¿™ç ´åäº†é™æ€ç‰¹æ€§"><a href="#ä¸ºä»€ä¹ˆè¿™ç ´åäº†é™æ€ç‰¹æ€§" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™ç ´åäº†é™æ€ç‰¹æ€§"></a>ä¸ºä»€ä¹ˆè¿™ç ´åäº†é™æ€ç‰¹æ€§</h4><p>åœ¨Javaä¸­ï¼Œâ€é™æ€ç±»â€ä¸€èˆ¬æ˜¯æŒ‡é™æ€å†…éƒ¨ç±»ï¼ˆStatic Nested Classï¼‰ï¼Œè€Œä¸æ˜¯é¡¶çº§ç±»ï¼Œå› ä¸ºJavaä¸æ”¯æŒé¡¶çº§ç±»ä½¿ç”¨<code>static</code>ä¿®é¥°ã€‚é™æ€å†…éƒ¨ç±»æ˜¯å¯ä»¥å®ç°æ¥å£çš„ï¼Œä½†å®ƒå®ç°æ¥å£ä¸­çš„æ–¹æ³•å°†æ˜¯å®ä¾‹æ–¹æ³•è€Œä¸æ˜¯é™æ€æ–¹æ³•ã€‚</p><p>è¿™ä¸ªè§‚ç‚¹çš„æ ¸å¿ƒæ˜¯ï¼šæ¥å£ä¸­çš„æ–¹æ³•ä¸èƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œæ‰€æœ‰æ¥å£ä¸­çš„æ–¹æ³•éƒ½æ˜¯å®ä¾‹æ–¹æ³•ã€‚å› æ­¤ï¼Œå³ä½¿é™æ€å†…éƒ¨ç±»å®ç°äº†æ¥å£ï¼Œå®ƒå®ç°çš„æ–¹æ³•ä¹Ÿæ˜¯éé™æ€çš„ï¼Œè¿™å°±ç ´åäº†é™æ€ç±»çš„çº¯ç²¹é™æ€ç‰¹æ€§ã€‚</p><p>å¦‚æœå¸Œæœ›æ‰€æœ‰æ–¹æ³•éƒ½èƒ½é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼ˆå³é™æ€æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆå®ç°æ¥å£ä¼šç ´åè¿™ä¸€ç‚¹ï¼Œå› ä¸ºæ¥å£çš„æ–¹æ³•ä¸èƒ½æ˜¯é™æ€çš„ã€‚é™æ€å†…éƒ¨ç±»åœ¨å®ç°æ¥å£æ—¶ï¼Œå¿…é¡»å®ç°æ¥å£çš„å®ä¾‹æ–¹æ³•ï¼Œè¿™æ„å‘³ç€éœ€è¦åˆ›å»ºç±»çš„å®ä¾‹æ¥è°ƒç”¨è¿™äº›æ–¹æ³•</p><h2 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h2><p>å·¥å‚ç±»æ¨¡å¼æä¾›çš„æ˜¯åˆ›å»ºå•ä¸ªç±»çš„æ¨¡å¼ï¼Œè€Œå»ºé€ è€…æ¨¡å¼åˆ™æ˜¯å°†å„ç§äº§å“é›†ä¸­èµ·æ¥è¿›è¡Œç®¡ç†ï¼Œç”¨æ¥åˆ›å»ºå¤åˆå¯¹è±¡ï¼Œæ‰€è°“å¤åˆå¯¹è±¡å°±æ˜¯æŒ‡æŸä¸ªç±»å…·æœ‰ä¸åŒçš„å±æ€§ï¼Œå…¶å®å»ºé€ è€…æ¨¡å¼å°±æ˜¯å‰é¢æŠ½è±¡å·¥å‚æ¨¡å¼å’Œæœ€åçš„Testç»“åˆèµ·æ¥å¾—åˆ°çš„ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ï¼š</p><p>è¿˜å’Œå‰é¢ä¸€æ ·ï¼Œä¸€ä¸ªSenderæ¥å£ï¼Œä¸¤ä¸ªå®ç°ç±»MailSenderå’ŒSmsSenderã€‚æœ€åï¼Œå»ºé€ è€…ç±»å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;Sender&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Sender&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produceMailSender</span><span class="params">(<span class="type">int</span> count)</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;count; i++)&#123;</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="title class_">MailSender</span>());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produceSmsSender</span><span class="params">(<span class="type">int</span> count)</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;count; i++)&#123;</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="title class_">SmsSender</span>());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Builder</span>();</span><br><span class="line">builder.produceMailSender(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™ç‚¹çœ‹å‡ºï¼Œå»ºé€ è€…æ¨¡å¼å°†å¾ˆå¤šåŠŸèƒ½é›†æˆåˆ°ä¸€ä¸ªç±»é‡Œï¼Œè¿™ä¸ªç±»å¯ä»¥åˆ›é€ å‡ºæ¯”è¾ƒå¤æ‚çš„ä¸œè¥¿ã€‚æ‰€ä»¥ä¸å·¥ç¨‹æ¨¡å¼çš„åŒºåˆ«å°±æ˜¯ï¼šå·¥å‚æ¨¡å¼å…³æ³¨çš„æ˜¯åˆ›å»ºå•ä¸ªäº§å“ï¼Œè€Œå»ºé€ è€…æ¨¡å¼åˆ™å…³æ³¨åˆ›å»ºç¬¦åˆå¯¹è±¡ï¼Œå¤šä¸ªéƒ¨åˆ†ã€‚å› æ­¤ï¼Œæ˜¯é€‰æ‹©å·¥å‚æ¨¡å¼è¿˜æ˜¯å»ºé€ è€…æ¨¡å¼ï¼Œä¾å®é™…æƒ…å†µè€Œå®šã€‚</p><h2 id="åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰"><a href="#åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰" class="headerlink" title="åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰"></a>åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰</h2><p>åŸå‹æ¨¡å¼è™½ç„¶æ˜¯åˆ›å»ºå‹çš„æ¨¡å¼ï¼Œä½†æ˜¯ä¸å·¥ç¨‹æ¨¡å¼æ²¡æœ‰å…³ç³»ï¼Œä»åå­—å³å¯çœ‹å‡ºï¼Œè¯¥æ¨¡å¼çš„æ€æƒ³å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œå¯¹å…¶è¿›è¡Œå¤åˆ¶ã€å…‹éš†ï¼Œäº§ç”Ÿä¸€ä¸ªå’ŒåŸå¯¹è±¡ç±»ä¼¼çš„æ–°å¯¹è±¡ã€‚æœ¬å°ç»“ä¼šé€šè¿‡å¯¹è±¡çš„å¤åˆ¶ï¼Œè¿›è¡Œè®²è§£ã€‚åœ¨Javaä¸­ï¼Œå¤åˆ¶å¯¹è±¡æ˜¯é€šè¿‡clone()å®ç°çš„ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªåŸå‹ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Prototype</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line"><span class="type">Prototype</span> <span class="variable">proto</span> <span class="operator">=</span> (Prototype) <span class="built_in">super</span>.clone();</span><br><span class="line"><span class="keyword">return</span> proto;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•ï¼Œä¸€ä¸ªåŸå‹ç±»ï¼Œåªéœ€è¦å®ç°Cloneableæ¥å£ï¼Œè¦†å†™cloneæ–¹æ³•ï¼Œæ­¤å¤„cloneæ–¹æ³•å¯ä»¥æ”¹æˆä»»æ„çš„åç§°ï¼Œå› ä¸ºCloneableæ¥å£æ˜¯ä¸ªç©ºæ¥å£ï¼Œä½ å¯ä»¥ä»»æ„å®šä¹‰å®ç°ç±»çš„æ–¹æ³•åï¼Œå¦‚cloneAæˆ–è€…cloneBï¼Œå› ä¸ºæ­¤å¤„çš„é‡ç‚¹æ˜¯super.clone()è¿™å¥è¯ï¼Œsuper.clone()è°ƒç”¨çš„æ˜¯Objectçš„clone()æ–¹æ³•ï¼Œè€Œåœ¨Objectç±»ä¸­ï¼Œclone()æ˜¯nativeçš„ï¼Œå…·ä½“æ€ä¹ˆå®ç°ï¼Œæˆ‘ä¼šåœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå…³äºè§£è¯»Javaä¸­æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ï¼Œæ­¤å¤„ä¸å†æ·±ç©¶ã€‚åœ¨è¿™å„¿ï¼Œæˆ‘å°†ç»“åˆå¯¹è±¡çš„æµ…å¤åˆ¶å’Œæ·±å¤åˆ¶æ¥è¯´ä¸€ä¸‹ï¼Œé¦–å…ˆéœ€è¦äº†è§£å¯¹è±¡æ·±ã€æµ…å¤åˆ¶çš„æ¦‚å¿µï¼š</p><p>æµ…å¤åˆ¶ï¼šå°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œè€Œå¼•ç”¨ç±»å‹ï¼ŒæŒ‡å‘çš„è¿˜æ˜¯åŸå¯¹è±¡æ‰€æŒ‡å‘çš„ã€‚</p><p>æ·±å¤åˆ¶ï¼šå°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åï¼Œä¸è®ºæ˜¯åŸºæœ¬æ•°æ®ç±»å‹è¿˜æœ‰å¼•ç”¨ç±»å‹ï¼Œéƒ½æ˜¯é‡æ–°åˆ›å»ºçš„ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ·±å¤åˆ¶è¿›è¡Œäº†å®Œå…¨å½»åº•çš„å¤åˆ¶ï¼Œè€Œæµ…å¤åˆ¶ä¸å½»åº•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>34-02 TongSearchå®‰è£…æ•™ç¨‹</title>
      <link href="/2025/02/26/34-02%20TongSearch%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"/>
      <url>/2025/02/26/34-02%20TongSearch%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="34-02-TongSearchå®‰è£…æ•™ç¨‹"><a href="#34-02-TongSearchå®‰è£…æ•™ç¨‹" class="headerlink" title="34-02 TongSearchå®‰è£…æ•™ç¨‹"></a>34-02 TongSearchå®‰è£…æ•™ç¨‹</h1><h2 id="Ubuntuç¯å¢ƒä¸‹TongSearchå®‰è£…"><a href="#Ubuntuç¯å¢ƒä¸‹TongSearchå®‰è£…" class="headerlink" title="Ubuntuç¯å¢ƒä¸‹TongSearchå®‰è£…"></a>Ubuntuç¯å¢ƒä¸‹TongSearchå®‰è£…</h2><p>ä¸‹è½½å®‰è£…åŒ…åˆ°ä»»æ„ç›®å½•</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261949715.png" alt="image-20240716100748373"></p><p>è§£å‹è‡³å½“å‰ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip TongSearch.zip</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261949155.png" alt="image-20240716100924229"></p><p>å¼€æ”¾ç«¯å£9200å’Œ9300</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 9200/tcp</span><br><span class="line">sudo ufw allow 9300/tcp</span><br></pre></td></tr></table></figure><p>JDKé…ç½®ï¼Œç¡®ä¿æœ¬åœ°é…ç½®äº†JDKå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/java/jdk-11.0.19</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib:$CLASSPATH</span><br><span class="line">export JAVA_PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;JRE_HOME&#125;/bin</span><br><span class="line">export PATH=$PATH:$&#123;JAVA_PATH&#125;</span><br></pre></td></tr></table></figure><p>ç³»ç»Ÿé…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure><p>ç³»ç»Ÿè¿è¡Œ</p><p>è¿›å…¥TongSearchå®‰è£…çš„ç›®å½•</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261949098.png" alt="image-20240716104246574"></p><h3 id="TongSearchå¯åŠ¨"><a href="#TongSearchå¯åŠ¨" class="headerlink" title="TongSearchå¯åŠ¨"></a>TongSearchå¯åŠ¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w vm.max_map_count=262144</span><br><span class="line"></span><br><span class="line">./bin/tongsearch -d -p pid</span><br></pre></td></tr></table></figure><p>å…³é—­ç¨‹åº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill pid</span><br></pre></td></tr></table></figure><h2 id="SpringBootæ•´åˆTongSearch"><a href="#SpringBootæ•´åˆTongSearch" class="headerlink" title="SpringBootæ•´åˆTongSearch"></a>SpringBootæ•´åˆTongSearch</h2><p>ä¸SpringBootæ•´åˆelasticSearchä¸€è‡´ã€‚</p><p>æ·»åŠ elasticSearchä¾èµ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--   ElasticSearchä¾èµ–     --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ymlé…ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261949546.png" alt="image-20240716114845583"></p><p>å®šä¹‰å®ä½“ç±»</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261949608.png" alt="image-20240716174450151"></p><p>åˆ›å»ºç´¢å¼•user</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261949441.png" alt="image-20240716174539000"></p><p>æ§åˆ¶å±‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261949772.png" alt="image-20240716174606561"></p><p>mapper</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261949577.png" alt="image-20240716174629442"></p><p>Service</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261949197.png" alt="image-20240716174651105"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TongSearch </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>32 JVM</title>
      <link href="/2025/02/26/32%20JVM/"/>
      <url>/2025/02/26/32%20JVM/</url>
      
        <content type="html"><![CDATA[<h1 id="32-JVM"><a href="#32-JVM" class="headerlink" title="32 JVM"></a>32 JVM</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/weixin_43122090/article/details/105093777?ops_request_misc=%7B%22request_id%22:%22171774851216800185892837%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171774851216800185892837&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-105093777-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=JVM&spm=1018.2226.3001.4187">ä¸€ç¯‡æ–‡ç« æŒæ¡æ•´ä¸ªJVMï¼ŒJVMè¶…è¯¦ç»†è§£æï¼ï¼ï¼</a></li></ol><h2 id="JVMåŸºç¡€"><a href="#JVMåŸºç¡€" class="headerlink" title="JVMåŸºç¡€"></a>JVMåŸºç¡€</h2><h3 id="JDK-VS-JRE-VS-JVM"><a href="#JDK-VS-JRE-VS-JVM" class="headerlink" title="JDK VS JRE VS JVM"></a>JDK VS JRE VS JVM</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943455.png" alt="img"></p><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>JVMï¼ˆJavaè™šæ‹Ÿæœºï¼‰ï¼Œæˆ–ç§°ä¸ºJDKï¼ˆJavaå¼€å‘å·¥å…·åŒ…ï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œå®é™…ä¸Šæ˜¯æ“ä½œç³»ç»Ÿä¸Šçš„ä¸€ä¸ªè½¯ä»¶ï¼Œå……å½“ç€æ“ä½œç³»ç»Ÿå’ŒJavaç¨‹åºä¹‹é—´çš„æ¡¥æ¢ã€‚JVMæ˜¯JDKçš„é‡è¦ç»„æˆéƒ¨åˆ†â€”â€”å…¶æ ¸å¿ƒæ¨¡å—ã€‚Javaä¹‹æ‰€ä»¥èƒ½å¤Ÿå…·å¤‡è·¨å¹³å°è¿è¡Œçš„èƒ½åŠ›ï¼Œä¸»è¦å¾—ç›ŠäºJVMã€‚JVMä¸ºæ¯ä¸€ç§æ“ä½œç³»ç»Ÿéƒ½è¿›è¡Œäº†ç‰¹å®šçš„é€‚é…ï¼Œè´Ÿè´£å°†Javaå­—èŠ‚ç è½¬æ¢ä¸ºè¯¥æ“ä½œç³»ç»Ÿæ‰€ç‰¹å®šçš„äºŒè¿›åˆ¶ä»£ç ï¼Œä»è€Œå®ç°è·¨å¹³å°è¿è¡Œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸»è¦æ¢è®¨ä¸€ä¸‹JVMæ‰€å®ç°çš„åŠŸèƒ½ã€‚ä»ä¸Šè¿°å†…å®¹å¯ä»¥çœ‹å‡ºï¼ŒJVMçš„ä¸»è¦èŒè´£æ˜¯å¤„ç†å­—èŠ‚ç ï¼Œå°†å­—èŠ‚ç è½¬æ¢ä¸ºç›¸åº”çš„æœºå™¨ç å¹¶æ‰§è¡Œã€‚æ­¤å¤–ï¼Œå®ƒè¿˜è´Ÿè´£è¿è¡ŒJavaç¨‹åºï¼Œè€Œç¨‹åºè¿è¡Œç¦»ä¸å¼€ç‰¹å®šçš„è¿è¡Œæœºåˆ¶ã€‚ç¨‹åºè¿è¡Œæ—¶ä¹Ÿéœ€è¦æ•°æ®æ”¯æŒï¼Œå› æ­¤éœ€è¦å¯¹è¿™äº›æ•°æ®è¿›è¡Œå­˜å‚¨å’Œç®¡ç†ã€‚åŸºäºè¿™äº›éœ€æ±‚ï¼ŒJVMçš„åŠŸèƒ½å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé‡è¦æ¨¡å—ï¼šç±»åŠ è½½å™¨ã€æ‰§è¡Œå¼•æ“å’Œè¿è¡Œæ—¶æ•°æ®åŒºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943404.png" alt="image-20240923114242866"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943719.png" alt="image-20240923114402591"></p><p>æ•´ä¸ªJVMå°±æ˜¯ä¸€ä¸ªå¨æˆ¿ï¼Œå­—èŠ‚ç å°±æ˜¯é£Ÿæï¼ŒJVMéœ€è¦æŠŠå­—èŠ‚ç åŠ å·¥è¿è¡Œæˆæ‰€éœ€è¦çš„æ ·å­ã€‚è°æ¥å¤„ç†é£Ÿæå‘¢â€”â€”ç±»åŠ è½½å™¨ï¼Œå®ƒè´Ÿè´£å¤„ç†å­—èŠ‚ç æ–‡ä»¶ï¼Œå¹¶æŠŠè¯¥å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆå­˜æ”¾åœ¨å¨æˆ¿å†…ï¼Œå‡†å¤‡åšèœï¼‰ã€‚</p><p>æ¥ä¸‹æ¥å¨å¸ˆä¸Šåœºâ€”â€”æ‰§è¡Œå¼•æ“ï¼Œè´Ÿè´£è¿è¡Œè¯¥å­—èŠ‚ç ï¼Œä½†æ˜¯å› ä¸ºæ¯ä¸ªå¨æˆ¿å·¥å…·ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ‰§è¡Œå¼•æ“ä¼šæŠŠå­—èŠ‚ç ç¿»è¯‘æˆå¯¹åº”çš„æœºå™¨ç æ–‡ä»¶ä»è€ŒæˆåŠŸè¿è¡Œã€‚</p><h2 id="JVMè¿è¡Œæ•°æ®åŒº"><a href="#JVMè¿è¡Œæ•°æ®åŒº" class="headerlink" title="JVMè¿è¡Œæ•°æ®åŒº"></a>JVMè¿è¡Œæ•°æ®åŒº</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>JVMä¼šåˆ’å®šè¿™ä¸ªå¨æˆ¿çš„å¤§å°ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šå­˜æ”¾åœ¨è¿™ä¸ªå¨æˆ¿å†…ï¼Œä¹Ÿä¼šæœ‰ä¿æ´é˜¿å§¨ï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶ï¼‰æ¥æ¸…ç†ä¸éœ€è¦ç”¨çš„é£Ÿæï¼ˆè¿‡æœŸæ— ç”¨æ•°æ®ï¼‰ï¼Œå¦‚æœè¿™ä¸ªå¨æˆ¿ä¿å­˜ä¸äº†é£Ÿæäº†ï¼Œå¨å¸ˆéƒ½æ— æ³•æ“ä½œè¿è¡Œäº†ï¼Œå°±ä¼šæŠ¥ï¼ˆOutOfMemoryError å¼‚å¸¸ï¼‰å¾ˆæ˜¾ç„¶å†…å­˜æ³„æ¼å•¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943697.png" alt="image-20240923203754763"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943596.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503052301817.png" alt="image-20250305230101760"></p><h3 id="2-1-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰"><a href="#2-1-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰" class="headerlink" title="2.1 æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰"></a>2.1 æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</h3><p>æ–¹æ³•åŒºæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«Javaè™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®</strong>ã€‚</p><p>å®ƒæœ‰ä¸ªåˆ«ä¸ºå«Non-Heapï¼ˆéå †ï¼‰ã€‚å½“æ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼ŒæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><h3 id="2-2-Javaå †ï¼ˆJava-Heapï¼‰"><a href="#2-2-Javaå †ï¼ˆJava-Heapï¼‰" class="headerlink" title="2.2 Javaå †ï¼ˆJava Heapï¼‰"></a>2.2 Javaå †ï¼ˆJava Heapï¼‰</h3><p>javaå †æ˜¯javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼Œæ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚<strong>æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ã€‚</strong></p><p>åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­çš„æè¿°æ˜¯ï¼šæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…ã€‚</p><p>javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºâ€œGCå †â€ã€‚</p><p>ä»å†…å­˜å›æ”¶è§’åº¦æ¥çœ‹javaå †å¯åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ã€‚</p><p>ä»å†…å­˜åˆ†é…çš„è§’åº¦çœ‹ï¼Œçº¿ç¨‹å…±äº«çš„Javaå †ä¸­å¯èƒ½åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒºã€‚</p><p>æ— è®ºæ€ä¹ˆåˆ’åˆ†ï¼Œéƒ½ä¸å­˜æ”¾å†…å®¹æ— å…³ï¼Œæ— è®ºå“ªä¸ªåŒºåŸŸï¼Œå­˜å‚¨çš„éƒ½æ˜¯å¯¹è±¡å®ä¾‹ï¼Œè¿›ä¸€æ­¥çš„åˆ’åˆ†éƒ½æ˜¯ä¸ºäº†æ›´å¥½çš„å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«çš„åˆ†é…å†…å­˜ã€‚</p><p>æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼Œjavaå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ã€‚å½“å‰ä¸»æµçš„è™šæ‹Ÿæœºéƒ½æ˜¯å¯æ‰©å±•çš„ï¼ˆé€šè¿‡ -Xmx å’Œ -Xms æ§åˆ¶ï¼‰ã€‚å¦‚æœå †ä¸­æ²¡æœ‰å†…å­˜å¯ä»¥å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><h3 id="2-3-ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram-Counter-Registerï¼‰"><a href="#2-3-ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram-Counter-Registerï¼‰" class="headerlink" title="2.3 ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰"></a>2.3 ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</h3><p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯ï¼š<strong>ä¿å­˜å½“å‰çº¿ç¨‹æ‰€æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€(è¡Œå·)</strong></p><p>ç”±äºJavaè™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„ï¼Œä¸€ä¸ªå¤„ç†å™¨éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ã€‚å› æ­¤ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„ä¸ªçº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ã€‚ç§°ä¹‹ä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚ç¨‹åºè®¡æ•°å™¨å†…å­˜åŒºåŸŸæ˜¯è™šæ‹Ÿæœºä¸­å”¯ä¸€æ²¡æœ‰è§„å®šOutOfMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚</p><h3 id="2-4-Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava-Virtual-Machine-Stacksï¼‰"><a href="#2-4-Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava-Virtual-Machine-Stacksï¼‰" class="headerlink" title="2.4 Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰"></a>2.4 Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰</h3><p>javaè™šæ‹Ÿæœºæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒã€‚</p><p>è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</p><p>è§£é‡Šï¼šæ¯è™šæ‹Ÿæœºæ ˆä¸­æ˜¯æœ‰å•ä½çš„ï¼Œå•ä½å°±æ˜¯æ ˆå¸§ï¼Œä¸€ä¸ªæ–¹æ³•ä¸€ä¸ªæ ˆå¸§ã€‚ä¸€ä¸ªæ ˆå¸§ä¸­ä»–åˆè¦å­˜å‚¨ï¼Œå±€éƒ¨å˜é‡ï¼Œæ“ä½œæ•°æ ˆï¼ŒåŠ¨æ€é“¾æ¥ï¼Œå‡ºå£ç­‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943063.png" alt="img"></p><h3 id="2-5-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰"><a href="#2-5-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰" class="headerlink" title="2.5 æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰"></a>2.5 æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</h3><p>æœ¬åœ°æ–¹æ³•æ ˆå¾ˆå¥½ç†è§£ï¼Œä»–å¾ˆæ ˆå¾ˆåƒï¼Œåªä¸è¿‡æ–¹æ³•ä¸Šå¸¦äº† native å…³é”®å­—çš„æ ˆå­—</p><p>å®ƒæ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰çš„æœåŠ¡</p><p>nativeå…³é”®å­—çš„æ–¹æ³•æ˜¯çœ‹ä¸åˆ°çš„ï¼Œå¿…é¡»è¦å»oracleå®˜ç½‘å»ä¸‹è½½æ‰å¯ä»¥çœ‹çš„åˆ°ï¼Œè€Œä¸”nativeå…³é”®å­—ä¿®é¥°çš„å¤§éƒ¨åˆ†æºç éƒ½æ˜¯Cå’ŒC++çš„ä»£ç ã€‚</p><p>åŒç†å¯å¾—ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­å°±æ˜¯Cå’ŒC++çš„ä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943516.png" alt="img"></p><h2 id="ç±»çš„åŠ è½½è¿‡ç¨‹è¯¦è§£"><a href="#ç±»çš„åŠ è½½è¿‡ç¨‹è¯¦è§£" class="headerlink" title="ç±»çš„åŠ è½½è¿‡ç¨‹è¯¦è§£"></a>ç±»çš„åŠ è½½è¿‡ç¨‹è¯¦è§£</h2><h3 id="å‚è€ƒèµ„æ–™-1"><a href="#å‚è€ƒèµ„æ–™-1" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/weixin_42638946/article/details/113698017?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171946924916800182126457%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171946924916800182126457&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-113698017-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=Java%E7%B1%BB%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F&spm=1018.2226.3001.4187">ç¬¬20ç«  ç±»çš„åŠ è½½è¿‡ç¨‹è¯¦è§£</a></li><li></li></ol><h3 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>ä»ä¸Šé¢çš„æ¦‚è¿°ä¸­æˆ‘ä»¬äº†è§£åˆ°ï¼Œå¯¹äºJVMè™šæ‹Ÿæœºæ¥è¯´ï¼Œå­—èŠ‚ç æ–‡ä»¶å°±æ˜¯è¿™ä¸ªå¨æˆ¿æ‰€éœ€è¦åŠ å·¥çš„å„ç§é£Ÿæä»¥åŠåŠ å·¥è¯´æ˜ä¹¦ï¼ŒJVMéœ€è¦æŒ‰ç…§è¦æ±‚å®Œæˆè¯´æ˜ä¹¦ä¸Šçš„å†…å®¹åå¾—åˆ°å¯¹åº”çš„èœå“ã€‚</p><p>é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ¥æ”¶é£Ÿæçš„è¿™ä½è´Ÿè´£äººï¼ˆç±»åŠ è½½å™¨ï¼‰æ˜¯å¦‚ä½•æŠŠè¿™äº›é£Ÿææ¥æ”¶åˆ°å¨æˆ¿å†…çš„ã€‚</p><p>ä¸‹é¢æ˜¯è¯¥è´Ÿè´£äººçš„å·¥ä½œæµç¨‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943059.png" alt="image-20240923190314725"></p><p>ç±»åŠ è½½å™¨å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šç±»è¢«ç±»åŠ è½½å™¨æ¥æ”¶åï¼Œåˆ°æˆä¸ºæ— æ•ˆæ•°æ®è¢«æ¸…ç†ä¸€å…±ä¼šç»å†ç±»åŠ è½½å™¨çš„ä¸ƒä¸ªé˜¶æ®µï¼Œä¹Ÿæ˜¯ç±»çš„ä¸ƒä¸ªé˜¶æ®µï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œå¸è½½ã€‚å…¶ä¸­éªŒè¯ã€å‡†å¤‡å’Œè§£æè¢«ç§°ä¸ºè¿æ¥ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è·Ÿéšé£Ÿæï¼ˆç±»ï¼‰å’Œç±»åŠ è½½å™¨çš„è§†è§’æ¥çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><p>ä½ å¯ä»¥æŠŠè‡ªå·±æƒ³è±¡æˆä¸€ä¸ªåŒ…è£¹ï¼ˆç±»ï¼‰ï¼Œå…¶ä¸­åŒ…å«äº†å„ç§é£Ÿæï¼ˆæ•°æ®ï¼‰å’Œé£Ÿææ“ä½œè¯´æ˜ï¼ˆæ–¹æ³•ï¼‰ã€‚æŸä¸€å¤©ï¼Œä½ è¢«ä¸€ä¸ªé™Œç”Ÿäººï¼ˆåº”ç”¨ï¼‰ä¸¢ç»™äº†é¢å‰è¿™ä¸ªå®ˆé—¨äººï¼ˆç±»åŠ è½½å™¨ï¼‰ã€‚è¿™ä¸ªå®ˆé—¨äººè´Ÿè´£ç®¡ç†è¿›å…¥è¿™ä¸ªç¥å¥‡å¨æˆ¿ï¼ˆJVMï¼‰çš„æ‰€æœ‰åŒ…è£¹ã€‚</p><p>å®ƒæ‰“å¼€äº†ä½ ï¼Œå‘ç°ä½ å†…éƒ¨çš„æ•°æ®å½¢å¼äº”èŠ±å…«é—¨ï¼Œæœ‰äº›æ˜¯ <code>.class</code> æ–‡ä»¶ï¼Œæœ‰äº›æ˜¯ <code>.jar</code> åŒ…ï¼Œç”šè‡³å¯èƒ½æ˜¯é€šè¿‡ç½‘ç»œè·å–çš„æ•°æ®ã€‚ç„¶è€Œï¼Œè¿™äº›æ•°æ®ä¸èƒ½ä»¥åŸå§‹çš„å½¢å¼ç›´æ¥è¿›å…¥å¨æˆ¿ã€‚äºæ˜¯ï¼Œå®ƒä¼šå°†è¿™äº›æ•°æ®è½¬æ¢ä¸ºç»Ÿä¸€çš„æ ¼å¼ï¼ˆå³äºŒè¿›åˆ¶å­—èŠ‚æµï¼‰ï¼Œä»¥ç¡®ä¿å®ƒä»¬ç¬¦åˆå¨æˆ¿çš„æ ‡å‡†ã€‚</p><p>æ¥ç€ï¼Œç±»åŠ è½½å™¨å…è®¸ä½ è¿›å…¥å¨æˆ¿ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å°±æ­¤ç¦»å¼€ï¼Œè¿˜ä¼šä¸€ç›´è·Ÿç€ä½ ï¼Œå› ä¸ºä½ åœ¨è¿›å…¥å¨æˆ¿åéœ€è¦è¿›ä¸€æ­¥çš„å¤„ç†å’ŒéªŒè¯ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œä½ å‘ç°ä¸€ä¸ªä¸ä½ å‡ ä¹ä¸€æ¨¡ä¸€æ ·çš„å½±å­ï¼ˆ<code>java.lang.Class</code> å¯¹è±¡ï¼‰ä¼´éšç€ä½ å‡ºç°ã€‚è¿™ä¸ªå½±å­æ˜¯ä¸ºäº†åç»­çš„åå°„æ“ä½œå‡†å¤‡çš„ï¼Œå®ƒä¼šåœ¨å¨æˆ¿çš„å·¥ä½œè¿‡ç¨‹ä¸­èµ·åˆ°é‡è¦ä½œç”¨ã€‚</p><p>ç»è¿‡å±‚å±‚æ£€æŸ¥ï¼Œä½ ç»ˆäºè¢«å…è®¸è¿›å…¥å¨æˆ¿ï¼Œå®é™…ä¸Šå°±æ˜¯è¿›å…¥äº†æ“ä½œç³»ç»Ÿåˆ†é…ç»™ JVM çš„å†…å­˜åŒºåŸŸï¼Œç­‰å¾…ç€è¿›ä¸€æ­¥çš„å¤„ç†å’Œæ‰§è¡Œã€‚</p><h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><p>æ¥ä¸‹æ¥ï¼Œä½ è¢«åˆ†é…åˆ°äº†å¨æˆ¿ä¸­çš„ä¸€ä¸ªæˆ¿é—´ã€‚ä½ ç¨ä½œç­‰å¾…ï¼Œç±»åŠ è½½å™¨ï¼ˆJVM çš„å®ˆé—¨äººï¼‰æ¨é—¨è€Œå…¥ï¼Œå¼€å§‹å¯¹ä½ è¿›è¡Œè¯¦ç»†æ£€æŸ¥ã€‚å®ƒä»”ç»†å®¡è§†ä½ çš„æ¯ä¸€ä¸ªåŒ…è£¹ï¼Œæ ¸æŸ¥å…¶ä¸­è¢«åŠ å·¥è¿‡çš„å­—èŠ‚ç æ–‡ä»¶æ˜¯å¦ç¬¦åˆå¨æˆ¿çš„è§„å®šï¼Œç¡®ä¿æ²¡æœ‰æ··ä¹±æ— åºçš„â€œé£Ÿæâ€ï¼ˆæ•°æ®ï¼‰è¿›å…¥ä¸‹ä¸€æ­¥æ“ä½œã€‚</p><p>æ¥ç€ï¼Œç±»åŠ è½½å™¨ä¼šæ£€æŸ¥ä½ çš„æ“ä½œè¯´æ˜ä¹¦ï¼ˆæ–¹æ³•ï¼‰ã€‚é¦–å…ˆï¼Œå®ƒä¼šæ ¸å¯¹è®¿é—®æ§åˆ¶å…³é”®å­—ï¼Œç¡®ä¿ä½ åªèƒ½è®¿é—®ä½ æœ‰æƒè®¿é—®çš„å­—æ®µå’Œæ–¹æ³•ã€‚ç„¶åï¼Œå®ƒä¼šä»”ç»†æ£€æŸ¥ä½ æ˜¯å¦æŒ‰è§„å®šæ“ä½œï¼Œç¡®ä¿æ–¹æ³•è°ƒç”¨æ—¶å‚æ•°çš„ä¸ªæ•°å’Œç±»å‹æ­£ç¡®æ— è¯¯ã€‚</p><p>ç±»åŠ è½½å™¨è¿˜ä¼šè¿›ä¸€æ­¥æ£€æŸ¥ä½ åœ¨è¯´æ˜ä¹¦ä¸­ä½¿ç”¨çš„â€œé£Ÿæâ€ï¼ˆå˜é‡ï¼‰æ˜¯å¦å­˜åœ¨ï¼Œå³æ˜¯å¦å·²ç»æ­£ç¡®åˆå§‹åŒ–ã€‚æ­¤å¤–ï¼Œå®ƒä¼šç¡®ä¿ä½ ä½¿ç”¨çš„æ¯ä¸€é¡¹é£Ÿæéƒ½æ˜¯æ­£ç¡®çš„ç±»å‹ï¼Œä¿è¯å˜é‡è¢«èµ‹äºˆäº†åˆé€‚çš„å€¼ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œç±»åŠ è½½å™¨ä¼šå¯¹ä½ çš„æ•°æ®å’Œæ–¹æ³•è¿›è¡Œå…¨é¢çš„éªŒè¯ï¼Œç¡®ä¿ä¸€åˆ‡éƒ½ç¬¦åˆè§„èŒƒï¼Œæ‰èƒ½å…è®¸ä½ è¿›å…¥å¨æˆ¿çš„ä¸‹ä¸€é˜¶æ®µã€‚</p><h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><p>ä½ åˆšåˆšé€èµ°äº†ç±»åŠ è½½å™¨ï¼Œæ¥ä¸‹æ¥çš„æ—¥å­é‡Œï¼Œæˆ¿é—´é‡Œä¸€ç‰‡å¯‚é™ï¼Œæ—¶é—´ä¼¼ä¹åœæ»äº†ä¸€èˆ¬ï¼Œä¸åˆ†æ˜¼å¤œåœ°æµé€ç€ã€‚ç­‰å¾…ä»¿ä½›æ— æ­¢å¢ƒã€‚æŸä¸€å¤©ï¼Œä½ å®åœ¨å¿ä¸ä½å›°æ„ï¼Œå€’å¤´ä¾¿ç¡ã€‚çªç„¶ï¼Œé—¨è¢«ä¸€è„šè¸¹å¼€ï¼Œéœ‡å¾—å¢™å£å—¡å—¡ä½œå“ï¼Œç±»åŠ è½½å™¨å¸¦ç€ä¸€ç¾¤å°å¼Ÿï¼ˆç±»åŠ è½½å™¨çš„å†…éƒ¨æœºåˆ¶ï¼‰æ°”åŠ¿æ±¹æ±¹åœ°æŒ¤è¿›äº†ä½ çš„æˆ¿é—´ã€‚</p><p>ä»–ä»¬äºŒè¯ä¸è¯´å°±å¼€å§‹ç¿»æ‰¾ä½ çš„åŒ…è£¹ï¼Œåƒæ˜¯åœ¨æ€¥åˆ‡åœ°å¯»æ‰¾ä»€ä¹ˆé‡è¦çš„é£Ÿæï¼ˆè¿™é‡Œä»£è¡¨ç±»ä¸­çš„é™æ€å˜é‡ï¼‰ã€‚ä½ è¿˜æ²¡æ¥å¾—åŠååº”ï¼Œå±‹é‡Œå·²ç»çƒ­é—¹éå‡¡ï¼Œå„ç§ç¿»æ‰¾å£°æ­¤èµ·å½¼ä¼ã€‚çªç„¶ï¼Œä¸€ä¸ªå°å¼Ÿå¤§å–Šï¼šâ€œæ‰¾åˆ°äº†ï¼â€ä½ å“äº†ä¸€è·³ï¼Œççœ¼ä¸€çœ‹ï¼Œä»–æ‰‹é‡Œæ­£æ‹¿ç€ä¸€ä¸ªæ ‡è®°äº† <code>static</code> çš„ç±»å˜é‡ã€‚éšåï¼Œé™†é™†ç»­ç»­å…¶ä»–å°å¼Ÿä¹Ÿçº·çº·æ‰¾åˆ°äº†ç±»ä¼¼çš„æ ‡è®°ã€‚</p><p>ç±»åŠ è½½å™¨è°¨æ…åœ°ç™»è®°ä¸‹è¿™äº›å˜é‡ï¼Œæ¥ç€ä»–æ‰“å¼€äº†æˆ¿é—´ä¸€è§’çš„å†°ç®±ï¼ˆJVM çš„æ–¹æ³•åŒºæˆ–å†…å­˜åŒºåŸŸï¼‰ï¼Œä½ çœ‹åˆ°ä»–ä»¬æŠŠè¿™äº›é™æ€å˜é‡ä¸€ä¸€æ”¾äº†è¿›å»ï¼Œå¹¶ä¸ºå®ƒä»¬åˆ†é…äº†åœ°å€ï¼ˆæ­¤è¿‡ç¨‹å¯¹åº” JVM ä¸­çš„é™æ€å˜é‡å†…å­˜åˆ†é…ï¼‰ã€‚ä¸è¿‡ï¼Œè¿™äº›å˜é‡è¿˜éƒ½æ˜¯æœªç»å¤„ç†çš„åŸææ–™ï¼Œæ²¡æœ‰ç»è¿‡ä»»ä½•çš„åŠ å·¥å’Œåˆå§‹åŒ–ï¼ˆæ­¤æ—¶ <code>static</code> å˜é‡åªæ˜¯åˆ†é…äº†ç©ºé—´ï¼Œæœªåˆå§‹åŒ–ï¼‰ã€‚</p><p>ä½ æœ›ç€å†°ç®±ï¼Œçªç„¶æ³¨æ„åˆ°ï¼Œé‡Œé¢ç«Ÿç„¶å·²ç»æœ‰äº†ä¸€äº›é£Ÿæï¼Œè€Œä¸”è¿™äº›é£Ÿæå·²ç»æ ¹æ®è¯´æ˜ä¹¦ï¼ˆç¨‹åºä¸­çš„å­—èŠ‚ç ï¼‰è¢«æå‰åŠ å·¥å¥½äº†ã€‚ä½ éå¸¸å¥½å¥‡ï¼šè¿™äº›é£Ÿææ˜¯ä½•æ—¶è¢«å¤„ç†çš„ï¼Ÿ</p><p>ä¸€è¾¹å¿™ç¢Œçš„å°å¼Ÿæ­£å¥½ç»è¿‡ï¼Œä½ èµ¶ç´§å‡‘ä¸Šå»æ‰“å¬æƒ…å†µã€‚ä»–çœ‹äº†çœ‹ä½ ï¼Œè½»å£°è§£é‡Šé“ï¼šâ€œé‚£äº›å·²ç»åŠ å·¥å¥½çš„é£Ÿæï¼Œæ˜¯è¢« <code>static final</code> ä¿®é¥°çš„å¸¸é‡ã€‚åœ¨ç±»åŠ è½½æ—¶ï¼Œå®ƒä»¬å°±å·²ç»å®Œæˆäº†åŠ å·¥ï¼ˆæ­¤è¿‡ç¨‹æ˜¯ <code>static final</code> å˜é‡çš„åˆå§‹åŒ–ï¼Œåœ¨ç±»åŠ è½½çš„å‡†å¤‡é˜¶æ®µå®Œæˆï¼‰ï¼Œæ‰€ä»¥ä½ ç°åœ¨çœ‹åˆ°çš„æ˜¯å®ƒä»¬çš„æœ€ç»ˆçŠ¶æ€ã€‚è€Œé‚£äº›åªæ˜¯ <code>static</code> çš„å˜é‡ï¼Œåˆšæ‰åªæ˜¯åˆ†é…äº†ç©ºé—´ï¼Œè¿˜éœ€è¦åœ¨åç»­è¢«åˆå§‹åŒ–ã€‚â€</p><p>ä½ ä¼¼æ‡‚éæ‡‚åœ°ç‚¹äº†ç‚¹å¤´ï¼Œè™½ç„¶ä¸å®Œå…¨ç†è§£ï¼Œä½†ä½ çŸ¥é“è¿™äº›é£Ÿæç¡®å®å¾ˆé‡è¦ã€‚ç±»åŠ è½½å™¨å’Œä»–çš„å°å¼Ÿä»¬å¿™æ´»äº†ä¸€é˜µå­åï¼Œå¸¦ç€ä¸€ä¸åŒ†å¿™ç¦»å¼€äº†æˆ¿é—´ï¼Œæ˜¾ç„¶ä»–ä»¬è¦å»å¤„ç†ä¸‹ä¸€ä¸ªåŒ…è£¹äº†ï¼ˆè¿™ä»£è¡¨ç±»åŠ è½½å™¨å®Œæˆäº†ä¸€ä¸ªç±»çš„åŠ è½½ï¼Œæ¥ä¸‹æ¥å¤„ç†å…¶ä»–ç±»çš„åŠ è½½ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943407.png" alt="image-20240923194750824"></p><table><thead><tr><th align="center">ç±»å‹</th><th>é»˜è®¤åˆå§‹å€¼</th></tr></thead><tbody><tr><td align="center">byte</td><td>(byte)0</td></tr><tr><td align="center">short</td><td>(short)0</td></tr><tr><td align="center">int</td><td>0</td></tr><tr><td align="center">long</td><td>0L</td></tr><tr><td align="center">float</td><td>0.0f</td></tr><tr><td align="center">double</td><td>0.0</td></tr><tr><td align="center">char</td><td>\u0000</td></tr><tr><td align="center">boolean</td><td>false</td></tr><tr><td align="center">reference</td><td>null</td></tr></tbody></table><p>æ³¨æ„ï¼š</p><ol><li>è¿™é‡Œä¸åŒ…å«åŸºæœ¬æ•°æ®ç±»å‹çš„å­—æ®µç”¨static finalä¿®é¥°çš„æƒ…å†µï¼Œå› ä¸ºfinalåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šåˆ†é…äº†ï¼Œå‡†å¤‡é˜¶æ®µä¼šæ˜¾å¼èµ‹å€¼ã€‚</li><li>æ³¨æ„è¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œç±»å˜é‡ä¼šåˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­ã€‚</li><li>åœ¨è¿™ä¸ªé˜¶æ®µå¹¶ä¸ä¼šåƒåˆå§‹åŒ–é˜¶æ®µä¸­é‚£æ ·ä¼šæœ‰åˆå§‹åŒ–æˆ–è€…ä»£ç æ‰§è¡Œã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿‡ç¨‹äºŒï¼šé“¾æ¥é˜¶æ®µï¼ˆä»¥ä¸‹éƒ½æ˜¯é’ˆå¯¹staticä¿®é¥°çš„å˜é‡ï¼‰</span></span><br><span class="line"><span class="comment"> * åŸºæœ¬æ•°æ®ç±»å‹ï¼šé final ä¿®é¥°çš„å˜é‡ï¼Œåœ¨å‡†å¤‡ç¯èŠ‚è¿›è¡Œé»˜è®¤åˆå§‹åŒ–èµ‹å€¼ã€‚</span></span><br><span class="line"><span class="comment"> *             finalä¿®é¥°ä»¥åï¼Œåœ¨å‡†å¤‡ç¯èŠ‚ç›´æ¥è¿›è¡Œæ˜¾ç¤ºèµ‹å€¼ã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * æ‹“å±•ï¼šå¦‚æœä½¿ç”¨å­—é¢é‡çš„æ–¹å¼å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¸¸é‡çš„è¯ï¼Œä¹Ÿæ˜¯åœ¨å‡†å¤‡ç¯èŠ‚ç›´æ¥è¿›è¡Œæ˜¾ç¤ºèµ‹å€¼ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkingTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> id;  <span class="comment">// é»˜è®¤åˆå§‹åŒ–èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">// æ˜¾ç¤ºèµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">constStr</span> <span class="operator">=</span> <span class="string">&quot;CONST&quot;</span>;  <span class="comment">// æ˜¾ç¤ºèµ‹å€¼</span></span><br><span class="line"><span class="comment">//    public static final String constStr1 = new String(&quot;CONST&quot;);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h4><p>åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ä¼šå°†é‚£äº›static finalä¿®é¥°çš„å¸¸é‡åŠ è½½åˆ°å¸¸é‡æ± ä¸­ï¼Œä½†æ˜¯åœ¨ç±»ä¸­è¡¨ç¤ºçš„è¿˜æ˜¯å…¶ç›´æ¥çš„ç¬¦å·ï¼Œæ²¡æœ‰å¯¹åº”åˆ°è¯¥å¸¸é‡å¯¹åº”çš„åœ°å€ï¼Œæ‰€ä»¥è¿™æ­¥éœ€è¦å°†ç±»ä¸­çš„é‚£äº›å¸¸é‡æŠŠç¬¦å·åº”ç”¨ä¸€å¾‹æ”¹æˆç›´æ¥å¼•ç”¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943225.png" alt="image-20240923201009650"></p><p>è™šæ‹Ÿæœºå¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºå­—èŠ‚å¼•ç”¨è¿‡ç¨‹ã€‚</p><p>ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€äº›å­—é¢é‡çš„å¼•ç”¨ï¼Œå’Œè™šæ‹Ÿæœºçš„å†…éƒ¨æ•°æ®ç»“æ„å’Œå†…å­˜å¸ƒå±€æ— å…³ã€‚æ¯”è¾ƒå®¹æ˜“ç†è§£çš„å°±æ˜¯åœ¨Classç±»æ–‡ä»¶ä¸­ï¼Œé€šè¿‡å¸¸é‡æ± è¿›è¡Œå¤§é‡çš„ç¬¦å·å¼•ç”¨ã€‚ä½†æ˜¯åœ¨ç¨‹åºå®é™…è¿è¡Œæ—¶ï¼Œåªæœ‰ç¬¦å·å¼•ç”¨æ—¶ä¸å¤Ÿçš„ã€‚æ¯”å¦‚å½“å¦‚ä¸‹println()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œç³»ç»Ÿéœ€è¦æ˜ç¡®çŸ¥é“è¯¥æ–¹æ³•çš„ä½ç½®ã€‚</p><blockquote><p>ä»å‡†å¤‡é˜¶æ®µå¯ä»¥çœ‹å‡ºï¼Œç±»çš„é™æ€å˜é‡åœ¨ç±»åŠ è½½ã€éªŒè¯ç¬¦åˆJVMè§„èŒƒåå°±ä¼šå¼€å§‹åˆ†é…å†…å­˜å¹¶è®¾å®šå˜é‡åˆå§‹å€¼ï¼Œè¿™äº›å€¼éƒ½ä¼šä¿å­˜åœ¨æ–¹æ³•åŒºä¸­ã€‚</p></blockquote><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>åˆå§‹åŒ–å°±æ˜¯è¦ä¸ºé‚£äº›åœ¨ä¹‹å‰æ²¡æœ‰è¢«åˆå§‹åŒ–çš„staticç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œåˆå§‹åŒ–å‘¢ï¼š</p><p><strong>æ€»ç»“å°±æ˜¯</strong>ï¼šåˆå§‹åŒ–æ˜¯ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ã€‚ä½¿ç”¨static + finalä¿®é¥°ï¼Œä¸”æ˜¾ç¤ºèµ‹å€¼ä¸­ä¸æ¶‰åŠåˆ°æ–¹æ³•æˆ–æ„é€ å™¨è°ƒç”¨çš„åŸºæœ¬æ•°æ®ç±»å‹æˆ–Stringç±»å‹çš„æ˜¾å¼èµ‹å€¼ï¼Œæ˜¯åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚è¿›è¡Œã€‚å¯¹äºç±»å˜é‡æ¥è¯´ï¼Œå¦‚æœåŠ äº† finalï¼Œæ‰æœ‰å¯èƒ½åœ¨é“¾æ¥çš„å‡†å¤‡é˜¶æ®µ è¢«æ˜¾å¼èµ‹å€¼ï¼›ä½†æ˜¯å¦‚æœæ²¡åŠ finalï¼Œä¸€å®šä¸å¯èƒ½åœ¨é“¾æ¥çš„å‡†å¤‡é˜¶æ®µ è¢«æ˜¾å¼èµ‹å€¼ï¼Œè€Œæ˜¯åœ¨é“¾æ¥çš„å‡†å¤‡é˜¶æ®µ é»˜è®¤èµ‹å€¼ï¼Œç„¶ååœ¨åˆå§‹åŒ–é˜¶æ®µæ˜¾å¼èµ‹å€¼ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><p>åœ¨åŠ è½½ä¸€ä¸ªç±»ä¹‹å‰ï¼Œè™šæ‹Ÿæœºæ€»ä¼šè¯•å›¾åŠ è½½è¯¥ç±»çš„çˆ¶ç±»ï¼Œå› æ­¤çˆ¶ç±»çš„<clinit> æ€»æ˜¯åœ¨å­ç±» <clinit> ä¹‹å‰è¢«è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçˆ¶ç±»çš„staticå—ä¼˜å…ˆçº§é«˜äºå­ç±»ã€‚</p><p><strong>å£è¯€ï¼šç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InitializationTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> number;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        number = <span class="number">2</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;father static&#123;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubInitialization</span> <span class="keyword">extends</span> <span class="title class_">InitializationTest</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        number = <span class="number">4</span>;  <span class="comment">// numberå±æ€§å¿…é¡»æå‰å·²ç»åŠ è½½ï¼šä¸€å®šä¼šå…ˆåŠ è½½çˆ¶ç±»ã€‚</span></span><br><span class="line">        System.out.println(<span class="string">&quot;son static&#123;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h3><p><strong>ä½œç”¨</strong>ï¼šè´Ÿè´£å°†.classæ–‡ä»¶ï¼ˆå­˜å‚¨çš„ç‰©ç†æ–‡ä»¶ï¼‰åŠ è½½åœ¨åˆ°å†…å­˜ä¸­ã€‚é€šè¿‡åŠ è½½<a href="https://so.csdn.net/so/search?q=%E5%AD%97%E8%8A%82%E7%A0%81&spm=1001.2101.3001.7020">å­—èŠ‚ç </a>æ•°æ®æ”¾å…¥å†…å­˜è½¬æ¢æˆbyte[]ï¼Œæ¥ä¸‹æ¥è°ƒç”¨è™šæ‹Ÿæœºåº•å±‚æ–¹æ³•å°†byte[]è½¬æ¢æˆæ–¹æ³•åŒºå’Œå †ä¸­çš„æ•°æ®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943658.png" alt="image-20240923202615805"></p><p>ç®€å•æ¥è¯´å°±æ˜¯åŠ è½½ç±»çš„å­—èŠ‚ç æ–‡ä»¶åˆ°å†…å­˜ä¸­ï¼Œå¹¶è½¬æ¢æˆå­—èŠ‚æµã€‚</p><p>ç±»åŠ è½½å™¨åˆ†ä¸ºä¸‹é¢ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261943573.png" alt="image-20240923202728419"></p><h3 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261944161.png" alt="image-20240923203004469"></p><p>å› ä¸ºç±»åŠ è½½å™¨å­˜åœ¨å¤šä¸ªï¼Œæ‰€ä»¥ä¸€ä¸ªç±»éœ€è¦åŠ è½½çš„æ—¶å€™ï¼Œå¦‚ä½•é€‰æ‹©å“ªä¸ªç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½å‘¢ï¼Ÿè¿™é‡Œçš„ç­–ç•¥å°±æ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå°±æ˜¯å­ç±»ä¸å…ˆè‡ªå·±åŠ è½½ï¼Œè¯·å­ç±»çš„çˆ¶ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œç„¶åä¸€ç›´é€’å½’çŸ¥é“æœ€ä¸Šå±‚ï¼Œå¦‚æœçˆ¶ç±»æ— æ³•åŠ è½½è¯¥ç±»ï¼Œåˆ™ç”±å­ç±»è‡ªè¡ŒåŠ è½½ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨è¿™ç§ç­–ç•¥å‘¢ï¼Ÿå¦‚æœç›´æ¥è®©å­ç±»è‡ªå·±åŠ è½½ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå¦‚æœç›´æ¥ä»å­ç±»è¿›è¡ŒåŠ è½½ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°åŒä¸€ä¸ªç±»å°±å¯èƒ½ä¼šå‡ºç°ä½¿ç”¨çš„ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™æ ·å°±å¯¼è‡´åŒä¸€ä¸ªç±»å´ä¸æƒ³ç­‰ã€‚ä½†æ˜¯åŒäº²å§”æ´¾æœºåˆ¶å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæ— è®ºä½ ä½¿ç”¨å“ªä¸ªç±»åŠ è½½å™¨ï¼Œå…¶æœ€åéƒ½ä¼šä¼˜å…ˆå‘ä¸Šå±‚çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œå¯ä»¥æœ‰æ•ˆçš„é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="JVMçš„åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#JVMçš„åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="JVMçš„åƒåœ¾å›æ”¶æœºåˆ¶"></a>JVMçš„åƒåœ¾å›æ”¶æœºåˆ¶</h2><h3 id="å‚è€ƒèµ„æ–™-2"><a href="#å‚è€ƒèµ„æ–™-2" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/qq_35246620/article/details/80522720?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171947954116800184145363%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171947954116800184145363&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-80522720-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6&spm=1018.2226.3001.4187">æ·±å…¥ç†è§£ JVM åƒåœ¾å›æ”¶æœºåˆ¶åŠå…¶å®ç°åŸç†</a></li><li><a href="https://mp.weixin.qq.com/s/ISIOd8bD0b3ZzpHGqXCe2g">ã€ä¸åšæ ‡é¢˜å…šã€‘Javaè™šæ‹Ÿæœºä½•è°“åƒåœ¾åŠåƒåœ¾å›æ”¶ç®—æ³•</a></li><li></li></ol><h3 id="åƒåœ¾"><a href="#åƒåœ¾" class="headerlink" title="åƒåœ¾"></a>åƒåœ¾</h3><h4 id="ä»€ä¹ˆæ˜¯åƒåœ¾"><a href="#ä»€ä¹ˆæ˜¯åƒåœ¾" class="headerlink" title="ä»€ä¹ˆæ˜¯åƒåœ¾"></a>ä»€ä¹ˆæ˜¯åƒåœ¾</h4><p>åœ¨ JVM è¿›è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œé¦–å…ˆå°±æ˜¯åˆ¤æ–­å“ªäº›å¯¹è±¡æ˜¯åƒåœ¾ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦åˆ¤æ–­å“ªäº›å¯¹è±¡æ˜¯å¯ä»¥è¢«é”€æ¯çš„ï¼Œå…¶å æœ‰çš„ç©ºé—´æ˜¯å¯ä»¥è¢«å›æ”¶çš„ã€‚æ ¹æ® JVM çš„æ¶æ„åˆ’åˆ†ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œ åœ¨ Java ä¸–ç•Œä¸­ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨å †ä¸­å­˜æ”¾ï¼Œæ‰€ä»¥åƒåœ¾å›æ”¶ä¹Ÿä¸»è¦æ˜¯é’ˆå¯¹å †æ¥è¿›è¡Œçš„ã€‚</p><p>åœ¨ JVM çš„çœ¼ä¸­ï¼Œåƒåœ¾å°±æ˜¯æŒ‡é‚£äº›åœ¨å †ä¸­å­˜åœ¨çš„ï¼Œå·²ç»â€œæ­»äº¡â€çš„å¯¹è±¡ã€‚è€Œå¯¹äºâ€œæ­»äº¡â€çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„å°†å…¶ç†è§£ä¸ºâ€œ<strong>ä¸å¯èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡</strong>â€ã€‚é‚£æ€æ ·æ‰èƒ½ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å­˜æ´»è¿˜æ˜¯æ­»äº¡å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°äº†åƒåœ¾åˆ¤æ–­ç®—æ³•ï¼Œå…¶ä¸»è¦åŒ…æ‹¬å¼•ç”¨è®¡æ•°æ³•å’Œå¯è¾¾æ€§åˆ†ææ³•ã€‚</p><h4 id="åƒåœ¾åˆ¤æ–­ç®—æ³•"><a href="#åƒåœ¾åˆ¤æ–­ç®—æ³•" class="headerlink" title="åƒåœ¾åˆ¤æ–­ç®—æ³•"></a>åƒåœ¾åˆ¤æ–­ç®—æ³•</h4><h5 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h5><p>åœ¨è¿™ç§ç®—æ³•ä¸­ï¼Œå‡è®¾å †ä¸­æ¯ä¸ªå¯¹è±¡ï¼ˆä¸æ˜¯å¼•ç”¨ï¼‰éƒ½æœ‰ä¸€ä¸ª<strong>å¼•ç”¨è®¡æ•°å™¨</strong>ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºå¹¶ä¸”åˆå§‹åŒ–èµ‹å€¼åï¼Œè¯¥å¯¹è±¡çš„è®¡æ•°å™¨çš„å€¼å°±è®¾ç½®ä¸º 1ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨çš„å€¼å°±åŠ  1ï¼Œä¾‹å¦‚å°†å¯¹è±¡ b èµ‹å€¼ç»™å¯¹è±¡ aï¼Œé‚£ä¹ˆ b è¢«å¼•ç”¨ï¼Œåˆ™å°† b å¼•ç”¨å¯¹è±¡çš„è®¡æ•°å™¨ç´¯åŠ  1ã€‚</p><p>åä¹‹ï¼Œå½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œä¾‹å¦‚ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªå¼•ç”¨è¶…è¿‡äº†ç”Ÿå‘½å‘¨æœŸï¼ˆå‡ºä½œç”¨åŸŸåï¼‰æˆ–è€…è¢«è®¾ç½®ä¸ºä¸€ä¸ªæ–°å€¼æ—¶ï¼Œåˆ™ä¹‹å‰è¢«å¼•ç”¨çš„å¯¹è±¡çš„è®¡æ•°å™¨çš„å€¼å°±å‡ 1ã€‚è€Œé‚£äº›å¼•ç”¨è®¡æ•°ä¸º 0 çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸ºåƒåœ¾ï¼Œå¯ä»¥è¢«æ”¶é›†ã€‚</p><p>ç‰¹åˆ«åœ°ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«å½“åšåƒåœ¾æ”¶é›†æ—¶ï¼Œå®ƒå¼•ç”¨çš„ä»»ä½•å¯¹è±¡çš„è®¡æ•°å™¨çš„å€¼éƒ½å‡ 1ã€‚</p><ol><li>ä¼˜ç‚¹ï¼šå¼•ç”¨è®¡æ•°æ³•å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå¯¹ç¨‹åºä¸è¢«é•¿æ—¶é—´æ‰“æ–­çš„å®æ—¶ç¯å¢ƒæ¯”è¾ƒæœ‰åˆ©ã€‚</li><li>ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–çš„ç©ºé—´æ¥å­˜å‚¨è®¡æ•°å™¨ï¼Œéš¾ä»¥æ£€æµ‹å‡ºå¯¹è±¡ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ã€‚</li></ol><h5 id="å¯è¾¾æ€§åˆ†ææ³•"><a href="#å¯è¾¾æ€§åˆ†ææ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†ææ³•"></a>å¯è¾¾æ€§åˆ†ææ³•</h5><p>å¯è¾¾æ€§åˆ†ææ³•ä¹Ÿè¢«ç§°ä¹‹ä¸ºæ ¹æœç´¢æ³•ï¼Œå¯è¾¾æ€§æ˜¯æŒ‡ï¼Œ<strong>å¦‚æœä¸€ä¸ªå¯¹è±¡ä¼šè¢«è‡³å°‘ä¸€ä¸ªåœ¨ç¨‹åºä¸­çš„å˜é‡é€šè¿‡ç›´æ¥æˆ–é—´æ¥çš„æ–¹å¼è¢«å…¶ä»–å¯è¾¾çš„å¯¹è±¡å¼•ç”¨ï¼Œåˆ™ç§°è¯¥å¯¹è±¡å°±æ˜¯å¯è¾¾çš„</strong>ã€‚æ›´å‡†ç¡®çš„è¯´ï¼Œä¸€ä¸ªå¯¹è±¡åªæœ‰æ»¡è¶³ä¸‹è¿°ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œå°±ä¼šè¢«åˆ¤æ–­ä¸ºå¯è¾¾çš„ï¼š</p><ul><li>å¯¹è±¡æ˜¯å±äºæ ¹é›†ä¸­çš„å¯¹è±¡</li><li>å¯¹è±¡è¢«ä¸€ä¸ªå¯è¾¾çš„å¯¹è±¡å¼•ç”¨</li></ul><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¼•å‡ºäº†ä¸€ä¸ªä¸“æœ‰åè¯ï¼Œå³æ ¹é›†ï¼Œå…¶æ˜¯æŒ‡æ­£åœ¨æ‰§è¡Œçš„ Java ç¨‹åºå¯ä»¥è®¿é—®çš„å¼•ç”¨å˜é‡ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯å¯¹è±¡ï¼‰çš„é›†åˆï¼Œç¨‹åºå¯ä»¥ä½¿ç”¨å¼•ç”¨å˜é‡è®¿é—®å¯¹è±¡çš„å±æ€§å’Œè°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ã€‚<strong>åœ¨ JVM ä¸­ï¼Œä¼šå°†ä»¥ä¸‹å¯¹è±¡æ ‡è®°ä¸ºæ ¹é›†ä¸­çš„å¯¹è±¡</strong>ï¼Œå…·ä½“åŒ…æ‹¬ï¼š</p><ol><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNIï¼ˆNative æ–¹æ³•ï¼‰çš„å¼•ç”¨å¯¹è±¡</li><li>æ´»è·ƒçº¿ç¨‹ï¼ˆå·²å¯åŠ¨ä¸”æœªåœæ­¢çš„ Java çº¿ç¨‹ï¼‰</li></ol><p>æ ¹é›†ä¸­çš„å¯¹è±¡ç§°ä¹‹ä¸º<code>GC Roots</code>ï¼Œä¹Ÿå°±æ˜¯æ ¹å¯¹è±¡ã€‚å¯è¾¾æ€§åˆ†ææ³•çš„åŸºæœ¬æ€è·¯æ˜¯ï¼šå°†ä¸€ç³»åˆ—çš„æ ¹å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡åˆ°æ ¹å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¸æ˜¯å¯è¾¾çš„ï¼Œä¹Ÿç§°ä¹‹ä¸ºä¸å¯è¾¾å¯¹è±¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261944033.png" alt="img"></p><p>å¼€å§‹è¿›è¡Œæ ‡è®°å‰ï¼Œéœ€è¦å…ˆæš‚åœåº”ç”¨çº¿ç¨‹ï¼Œå¦åˆ™å¦‚æœå¯¹è±¡å›¾ä¸€ç›´åœ¨å˜åŒ–çš„è¯æ˜¯æ— æ³•çœŸæ­£å»éå†å®ƒçš„ã€‚æš‚åœåº”ç”¨çº¿ç¨‹ä»¥ä¾¿ <strong>JVM å¯ä»¥å°½æƒ…åœ°æ”¶æ‹¾å®¶åŠ¡çš„è¿™ç§æƒ…å†µåˆè¢«ç§°ä¹‹ä¸ºå®‰å…¨ç‚¹ï¼ˆSafe Pointï¼‰</strong>ï¼Œè¿™ä¼šè§¦å‘ä¸€æ¬¡ Stop The Worldï¼ˆSTWï¼‰æš‚åœã€‚è§¦å‘å®‰å…¨ç‚¹çš„åŸå› æœ‰è®¸å¤šï¼Œä½†æœ€å¸¸è§çš„åº”è¯¥å°±æ˜¯åƒåœ¾å›æ”¶äº†ã€‚</p><p>å®‰å…¨ç‚¹çš„é€‰å®šåŸºæœ¬ä¸Šæ˜¯ä»¥ç¨‹åºâ€œ<strong>æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾</strong>â€ä¸ºæ ‡å‡†è¿›è¡Œé€‰å®šçš„ã€‚â€œé•¿æ—¶é—´æ‰§è¡Œâ€çš„æœ€æ˜æ˜¾ç‰¹å¾å°±æ˜¯æŒ‡ä»¤åºåˆ—å¤ç”¨ï¼Œä¾‹å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼Œæ‰€ä»¥å…·æœ‰è¿™äº›åŠŸèƒ½çš„æŒ‡ä»¤æ‰ä¼šäº§ç”Ÿå®‰å…¨ç‚¹ã€‚å¯¹äºå®‰å…¨ç‚¹ï¼Œå¦ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„é—®é¢˜å°±æ˜¯å¦‚ä½•åœ¨ GC å‘ç”Ÿæ—¶è®©æ‰€æœ‰çº¿ç¨‹ï¼ˆè¿™é‡Œä¸åŒ…æ‹¬æ‰§è¡Œ JNI è°ƒç”¨çš„çº¿ç¨‹ï¼‰éƒ½â€œè·‘â€åˆ°æœ€è¿‘çš„å®‰å…¨ç‚¹ä¸Šå†åœé¡¿ä¸‹æ¥ã€‚ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>æŠ¢å…ˆå¼ä¸­æ–­ï¼ˆPreemptive Suspensionï¼‰ï¼šæŠ¢å…ˆå¼ä¸­æ–­ä¸éœ€è¦çº¿ç¨‹çš„æ‰§è¡Œä»£ç ä¸»åŠ¨å»é…åˆï¼Œåœ¨ GC å‘ç”Ÿæ—¶ï¼Œé¦–å…ˆæŠŠæ‰€æœ‰çº¿ç¨‹å…¨éƒ¨ä¸­æ–­ï¼Œå¦‚æœå‘ç°æœ‰çº¿ç¨‹ä¸­æ–­çš„åœ°æ–¹ä¸åœ¨å®‰å…¨ç‚¹ä¸Šï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©å®ƒâ€œè·‘â€åˆ°å®‰å…¨ç‚¹ä¸Šã€‚ç°åœ¨å‡ ä¹æ²¡æœ‰è™šæ‹Ÿæœºé‡‡ç”¨è¿™ç§æ–¹å¼æ¥æš‚åœçº¿ç¨‹ä»è€Œå“åº” GC äº‹ä»¶ã€‚</li><li><strong>ä¸»åŠ¨å¼ä¸­æ–­</strong>ï¼ˆVoluntary Suspensionï¼‰ï¼šä¸»åŠ¨å¼ä¸­æ–­çš„æ€æƒ³æ˜¯å½“ GC éœ€è¦ä¸­æ–­çº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¯¹çº¿ç¨‹æ“ä½œï¼Œä»…ä»…ç®€å•åœ°è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œå„ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ä¸»åŠ¨å»è½®è¯¢è¿™ä¸ªæ ‡å¿—ï¼Œå‘ç°ä¸­æ–­æ ‡å¿—ä¸ºçœŸæ—¶å°±è‡ªå·±ä¸­æ–­æŒ‚èµ·ã€‚<strong>è½®è¯¢æ ‡å¿—åœ°åœ°æ–¹å’Œå®‰å…¨ç‚¹æ˜¯é‡åˆçš„ï¼Œå¦å¤–å†åŠ ä¸Šåˆ›å»ºå¯¹è±¡éœ€è¦åˆ†é…å†…å­˜çš„åœ°æ–¹</strong>ã€‚</li></ol><p>**æš‚åœæ—¶é—´çš„é•¿çŸ­å¹¶ä¸å–å†³äºå †å†…å¯¹è±¡çš„å¤šå°‘ä¹Ÿä¸æ˜¯å †çš„å¤§å°ï¼Œè€Œæ˜¯å­˜æ´»å¯¹è±¡çš„å¤šå°‘ã€‚**å› æ­¤ï¼Œè°ƒé«˜å †çš„å¤§å°å¹¶ä¸ä¼šå½±å“åˆ°æ ‡è®°é˜¶æ®µçš„æ—¶é—´é•¿çŸ­ã€‚</p><p>åœ¨æ ¹æœç´¢ç®—æ³•ä¸­ï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š</p><ol><li><strong>å¦‚æœå¯¹è±¡åœ¨è¿›è¡Œæ ¹æœç´¢åå‘ç°æ²¡æœ‰ä¸æ ¹å¯¹è±¡ç›¸è¿æ¥çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰</strong>ã€‚ç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize()æ–¹æ³•ï¼ˆå¯çœ‹ä½œææ„å‡½æ•°ï¼Œç±»ä¼¼äº OC ä¸­çš„deallocï¼ŒSwift ä¸­çš„deinitï¼‰ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•ï¼Œæˆ–finalize()æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºæ²¡æœ‰å¿…è¦æ‰§è¡Œã€‚</li><li>**å¦‚æœè¯¥å¯¹è±¡è¢«åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¼šè¢«æ”¾ç½®åœ¨ä¸€ä¸ªåä¸ºF-Queueçš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶åœ¨ç¨åç”±ä¸€æ¡ç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹å»æ‰§è¡Œfinalize()æ–¹æ³•ã€‚**finalize()æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡å‘½è¿çš„æœ€åä¸€æ¬¡æœºä¼šï¼ˆå› ä¸ºä¸€ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•æœ€å¤šåªä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ï¼‰ï¼Œç¨å GC å°†å¯¹F-Queueä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°ï¼Œå¦‚æœè¦åœ¨finalize()æ–¹æ³•ä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·±ï¼Œåªè¦åœ¨finalize()æ–¹æ³•ä¸­è®©è¯¥å¯¹è±¡é‡æ–°å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”å³å¯ã€‚è€Œå¦‚æœå¯¹è±¡è¿™æ—¶è¿˜æ²¡æœ‰å…³è”åˆ°ä»»ä½•é“¾ä¸Šçš„å¼•ç”¨ï¼Œé‚£å®ƒå°±ä¼šè¢«å›æ”¶æ‰ã€‚</li></ol><p>GC åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾çœ‹çš„æ˜¯å¼ºå¼•ç”¨ã€‚</p><p>å½“æ ‡è®°é˜¶æ®µå®Œæˆåï¼ŒGC å¼€å§‹è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼Œåˆ é™¤ä¸å¯è¾¾å¯¹è±¡ã€‚å½“ç„¶ï¼Œå¯è¾¾æ€§åˆ†ææ³•æœ‰ä¼˜ç‚¹ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œ</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä»¥è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œä¸éœ€è¦å ç”¨é¢å¤–çš„ç©ºé—´</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½ä¼šæ›´æ–°å·²ç»è®¿é—®è¿‡çš„å¯¹è±¡çš„å¼•ç”¨</li></ul><p>åœ¨ä¸Šé¢çš„ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡æåˆ°äº†â€œå¼•ç”¨â€è¿™ä¸ªæ¦‚å¿µï¼Œåœ¨æ­¤æˆ‘ä»¬ä¸å¦¨å¤šäº†è§£ä¸€äº›å¼•ç”¨çš„çŸ¥è¯†ï¼Œåœ¨ Java ä¸­æœ‰å››ç§å¼•ç”¨ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼š</p><ol><li>å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ï¼šå¦‚Object obj &#x3D; new Object()ï¼Œè¿™ç±»å¼•ç”¨æ˜¯ Java ç¨‹åºä¸­æœ€æ™®éçš„ã€‚åªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ï¼šå®ƒç”¨æ¥æè¿°ä¸€äº›å¯èƒ½è¿˜æœ‰ç”¨ï¼Œä½†å¹¶éå¿…é¡»çš„å¯¹è±¡ã€‚åœ¨ç³»ç»Ÿå†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œè¿™ç±»å¼•ç”¨å…³è”çš„å¯¹è±¡å°†è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚JDK1.2 ä¹‹åæä¾›äº†SoftReferenceç±»æ¥å®ç°è½¯å¼•ç”¨ã€‚</li><li>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰ï¼šå®ƒä¹Ÿæ˜¯ç”¨æ¥æè¿°éå¿…é¡»å¯¹è±¡çš„ï¼Œä½†å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±äº›ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰ã€‚å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚åœ¨ JDK1.2 ä¹‹åï¼Œæä¾›äº†WeakReferenceç±»æ¥å®ç°å¼±å¼•ç”¨ã€‚</li><li>è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰ï¼šä¹Ÿç§°ä¸ºå¹»å¼•ç”¨ï¼Œæœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„æ˜¯å¸Œæœ›èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚JDK1.2 ä¹‹åæä¾›äº†PhantomReferenceç±»æ¥å®ç°è™šå¼•ç”¨ã€‚</li></ol><h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><p>ä¸»æœºçš„å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœä¸èƒ½åŠæ—¶çš„æ¸…ç†æ‰å†…å­˜ä¸­æ— ç”¨çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå†…å­˜å¾ˆå¿«å°±ä¼šçˆ†æ»¡ï¼Œå¯¼è‡´æœåŠ¡å‡ºç°ä¸¥é‡çš„é—®é¢˜ã€‚å¯¹äºå…¶ä»–çš„è¯­è¨€æ¥è¯´ï¼Œä¾‹å¦‚Cã€C++ç­‰éƒ½éœ€è¦ç¨‹åºå‘˜è‡ªå·±è¿›è¡Œåƒåœ¾å›æ”¶ã€‚Javaä½¿ç”¨JVMæ¥æ›¿ç¨‹åºå‘˜æ¥ç®¡ç†ä¸»æœºçš„å†…å­˜ç©ºé—´ï¼Œé‚£ä¹ˆæ—¢ç„¶JVMå·²ç»æ›¿æˆ‘ä»¬ç®¡ç†å†…å­˜ç©ºé—´äº†ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦å»å­¦ä¹ JVMæ˜¯å¦‚ä½•å›æ”¶åƒåœ¾çš„å‘¢ï¼Ÿ</p><blockquote><p>åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨å®é™…çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°JVMæŠ¥å†…å­˜ä¸å¤Ÿçš„é”™è¯¯ï¼Œå½“æˆ‘ä»¬äº†è§£äº†JVMæ˜¯å¦‚ä½•è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¯¹äºæˆ‘ä»¬å»åˆ†æé—®é¢˜æœ‰å¾ˆå¤§çš„å¸®åŠ©ï¼Œä¹Ÿèƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨å®é™…çš„å¼€å‘ä¸­å¿«é€Ÿæ’æŸ¥å’Œè§£å†³é—®é¢˜ã€‚</p><p>åŒæ—¶å¦ä¸€æ–¹é¢ï¼Œå»äº†è§£ä¸€æ¬¾å¥½çš„äº§å“æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Œä¸­é—´ä½¿ç”¨çš„å“ªäº›ç®—æ³•ï¼Œé‚£äº›ç®—æ³•å¯¹äºè§£å†³ç‰¹å®šçš„é—®é¢˜æœ‰ä»€ä¹ˆæ ·çš„æ•ˆæœï¼Œå¯¹äºç¨‹åºå‘˜çš„æˆ‘ä»¬æ¥è¯´ï¼Œè¿™äº›éƒ½æ˜¯éå¸¸å®è´µçš„å­¦ä¹ æœºä¼šã€‚</p></blockquote><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ä»€ä¹ˆæ˜¯åƒåœ¾ä»¥åŠå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åƒåœ¾ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥äº†è§£å¦‚ä½•å›æ”¶åƒåœ¾ï¼Œè¿™å°±æ˜¯åƒåœ¾å›æ”¶ç®—æ³•å’Œåƒåœ¾å›æ”¶å™¨éœ€è¦åšçš„äº‹æƒ…äº†ã€‚</p><p>PSï¼šå¦‚æœæˆ‘ä»¬æŠŠå†…å­˜çœ‹æˆä¸€å—å¤§çš„å››è¾¹å½¢åŒºåŸŸï¼ŒåŒºåŸŸä¸­ç”»äº†å¾ˆå¤šå¤§å°ç›¸åŒçš„å°æ–¹æ ¼ï¼Œåœ¨æ¯ä¸ªå°æ–¹æ ¼ä¸­ä¼šå­˜æ”¾ä¸€äº›ç‰©å“ï¼ˆæ•°æ®ï¼‰ï¼Œç°åœ¨æœ‰ä¸€ä¸ªç®¡ç†å‘˜è´Ÿè´£ç®¡ç†è¿™ç‰‡åŒºåŸŸï¼ˆç®¡ç†å‘˜JVMï¼‰ã€‚é‚£ä¹ˆå¦‚æœä½ æ˜¯è¿™ä¸ªç®¡ç†å‘˜ä½ ä¼šå¦‚ä½•ç®¡ç†è¿™ç‰‡åŒºåŸŸä¸è‡³äºè¢«ç‰©å“å¡æ»¡å‘¢ï¼Ÿ</p><p>è¿™ç‰‡åŒºåŸŸéšæ—¶éƒ½ä¼šæœ‰ç‰©å“æ”¾è¿›æ¥ï¼Œé‚£ä¹ˆä½ ä½œä¸ºç®¡ç†å‘˜ç®¡ç†è¿™ç‰‡åŒºåŸŸæ—¶å°±å¾ˆå›°éš¾å»è¿›è¡Œç®¡ç†ã€‚è¿™æ—¶å€™ä½ å‘é¢†å¯¼è¦æ±‚å½“ä½ å¯¹è¿™ç‰‡åŒºåŸŸæ¸…ç†æ—¶ä¸å…è®¸ä»»ä½•ç‰©å“æ”¾è¿›æ¥ï¼Œè¿™å°±æ˜¯JVMä¸­çš„å®‰å…¨ç‚¹çš„æ¦‚å¿µã€‚</p><h4 id="æ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•</h4><p>ç®¡ç†å‘˜æƒ³åˆ°äº†ä¸€ç§æ–¹æ³•ï¼Œä»–æƒ³å¦‚æœæˆ‘æ‰¾åˆ°ä¸€ä¸ªæ— ç”¨çš„ç‰©å“å°±è·‘åˆ°å¾ˆè¿œçš„åœ°æ–¹æŠŠè¿™ä¸ªä¸¢äº†å†å›æ¥ä¸­é—´çš„è€—æ—¶å¤ªå¤§äº†ï¼ˆåœ¨JVMä¸­åˆ‡æ¢æ¶ˆè€—è¾ƒå¤§ï¼‰ï¼Œé‚£ä¹ˆä»–å°±æƒ³å¦‚æœæˆ‘å…ˆæŠŠæ‰€æœ‰æ— æ•ˆçš„ç‰©å“æ ‡è®°å‡ºæ¥ï¼Œç„¶åè®©è½¦ä¸€æŠŠå…¨éƒ¨æ‹‰èµ°ä¸”ä¸å¿«é€Ÿã€‚è¿™å°±æ˜¯æ ‡è®°-æ¸…æ¥šç®—æ³•ï¼Œåˆ†ä¸ºä¸¤æ­¥ï¼Œå…ˆæ ‡è®°å‡ºæ— æ•ˆçš„ç‰©å“ï¼Œç„¶åç»Ÿä¸€æ¸…é™¤ã€‚</p><p>æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li>æ ‡è®°é˜¶æ®µï¼š<strong>æ ‡è®°å‡ºæ‰€æœ‰å¯ä»¥å›æ”¶çš„å¯¹è±¡</strong>ã€‚</li><li>æ¸…é™¤é˜¶æ®µï¼šå›æ”¶æ‰€æœ‰å·²è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œé‡Šæ”¾è¿™éƒ¨åˆ†ç©ºé—´ã€‚</li></ul><p>è¯¥ç®—æ³•å­˜åœ¨å¦‚ä¸‹ä¸è¶³ï¼š</p><ol><li><strong>å†…å­˜ç¢ç‰‡</strong>ã€‚ç”±äºJavaè™šæ‹Ÿæœºçš„å †ä¸­å¯¹è±¡å¿…é¡»æ˜¯è¿ç»­åˆ†å¸ƒçš„ï¼Œå› æ­¤å¯èƒ½å‡ºç°æ€»ç©ºé—²å†…å­˜è¶³å¤Ÿï¼Œä½†æ˜¯æ— æ³•åˆ†é…çš„æç«¯æƒ…å†µã€‚æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜ï¼Œè€Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚</li><li><strong>åˆ†é…æ•ˆç‡è¾ƒä½</strong>ã€‚å¦‚æœæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡é’ˆåŠ æ³•ï¼ˆpointer bumpingï¼‰æ¥åšåˆ†é…ã€‚è€Œå¯¹äºç©ºé—²åˆ—è¡¨ï¼ŒJavaè™šæ‹Ÿæœºåˆ™éœ€è¦é€ä¸ªè®¿é—®åˆ—è¡¨ä¸­çš„é¡¹ï¼Œæ¥æŸ¥è¯¢èƒ½å¤Ÿæ”¾å…¥æ–°å»ºå¯¹è±¡çš„ç©ºé—²å†…å­˜ã€‚</li></ol><p>PSï¼šå› ä¸ºåœ¨å†…å­˜åŒºåŸŸä¸­æ¯ä¸€ä¸ªå°æ–¹æ ¼çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå¦‚æœç°åœ¨æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç‰©å“ï¼Œéœ€è¦å‡ åä¸ªå°æ–¹æ ¼æ‰èƒ½è£…ä¸‹ï¼Œè€Œä¸”æˆ‘ä»¬ä¸èƒ½æŠŠè¿™ä¸ªç‰©å“ç»™åˆ†å‰²ï¼ˆJavaè™šæ‹Ÿæœºçš„å †ä¸­å¯¹è±¡å¿…é¡»æ˜¯è¿ç»­åˆ†å¸ƒçš„ï¼‰ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ²¡æœ‰åå‡ ä¸ªè¿ç»­çš„å°æ–¹æ ¼æ€ä¹ˆåŠï¼Ÿ</p><h4 id="å¤åˆ¶ç®—æ³•"><a href="#å¤åˆ¶ç®—æ³•" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h4><p>ä¸ºäº†è§£å†³æ ‡è®°-æ¸…æ¥šç®—æ³•å¯¼è‡´æ— è¾ƒå¤§çš„å†…å­˜åŒºåŸŸä¿å­˜æ•°æ®ï¼Œå³å¯¼è‡´å¤§é‡çš„å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œä½ æå‡ºæ¥ä¸€ä¸ªæ–°çš„ç®—æ³•â€”â€”å¤åˆ¶ç®—æ³•ã€‚ä½ åˆ›é€ æ€§çš„æå‡ºï¼ŒæŠŠç°åœ¨çš„åŒºåŸŸå†åˆ†æˆä¸¤ä¸ªå¤§çš„åŒºåŸŸï¼Œä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªåŒºåŸŸå·¥ä½œï¼Œç­‰ä½ éœ€è¦æ•´ç†æ—¶ï¼Œä½ ä¼šè¿›å…¥å½“å‰å·¥ä½œçš„é‚£ä¸ªåŒºåŸŸï¼Œæ ‡è®°å‡ºå½“å‰æœ‰ç”¨çš„ç‰©å“ï¼Œå¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªåŒºåŸŸä¸­ï¼Œç„¶åæŠŠå½“å‰åŒºåŸŸæ‰€æœ‰ç‰©å“å…¨éƒ¨æ¸…æ¥šï¼Œè®©å¦å¤–ä¸€ä¸ªåŒºåŸŸè¿è¡Œã€‚æ³¨æ„ä½ å¤åˆ¶è¿‡å»çš„æ•°æ®ä¼šä¾æ¬¡æ’æ”¾ï¼Œæ‰€ä»¥ä¸ä¼šé€ æˆå†…å­˜ç¢ç‰‡ã€‚</p><p>è¿™æ ·è™½ç„¶è§£å†³äº†å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œä½†å¾ˆæ˜¾ç„¶æ¶ˆè€—ä¹Ÿå¤§ï¼Œæ•ˆç‡ä¼šé™ä½ã€‚</p><ul><li>åˆ’åˆ†åŒºåŸŸï¼šå°†å†…å­˜åŒºåŸŸæŒ‰æ¯”ä¾‹åˆ’åˆ†ä¸º1ä¸ªEdenåŒºä½œä¸ºåˆ†é…å¯¹è±¡çš„â€œä¸»æˆ˜åœºâ€å’Œ2ä¸ªå¹¸å­˜åŒºï¼ˆå³Survivorç©ºé—´ï¼Œåˆ’åˆ†ä¸º2ä¸ªç­‰æ¯”ä¾‹çš„fromåŒºå’ŒtoåŒºï¼‰ã€‚</li><li>å¤åˆ¶ï¼šæ”¶é›†æ—¶ï¼Œæ‰“æ‰«â€œæˆ˜åœºâ€ï¼Œå°†EdenåŒºä¸­ä»å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°æŸä¸€å—å¹¸å­˜åŒºä¸­ã€‚</li><li>æ¸…é™¤ï¼šç”±äºä¸Šä¸€é˜¶æ®µå·²ç¡®ä¿ä»å­˜æ´»çš„å¯¹è±¡å·²è¢«å¦¥å–„å®‰ç½®ï¼Œç°åœ¨å¯ä»¥â€œæ¸…ç†æˆ˜åœºâ€äº†ï¼Œé‡Šæ”¾EdenåŒºå’Œå¦ä¸€å—å¹¸å­˜åŒºã€‚</li><li>æ™‹å‡ï¼šå¦‚åœ¨â€œå¤åˆ¶â€é˜¶æ®µï¼Œä¸€å—å¹¸å­˜åŒºæ¥çº³ä¸äº†æ‰€æœ‰çš„â€œå¹¸å­˜â€å¯¹è±¡ã€‚åˆ™ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261944999.webp" alt="å›¾ç‰‡"></p><p><strong>è¯¥ç®—æ³•è§£å†³äº†å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜ï¼Œä½†å †ç©ºé—´çš„ä½¿ç”¨æ•ˆç‡æå…¶ä½ä¸‹</strong>ã€‚åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶ï¼Œéœ€è¦è¿›è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡ä¼šå˜å¾—å¾ˆä½ã€‚</p><h4 id="æ ‡è®°-æ•´ç†ç®—æ³•"><a href="#æ ‡è®°-æ•´ç†ç®—æ³•" class="headerlink" title="æ ‡è®°-æ•´ç†ç®—æ³•"></a>æ ‡è®°-æ•´ç†ç®—æ³•</h4><p>ä¸ºäº†è§£å†³å†…å­˜ç¢ç‰‡åŒ–å’Œå †åˆ©ç”¨ç‡ä½çš„é—®é¢˜ï¼Œä½ åˆæå‡ºäº†ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•åœ¨å®‰å…¨ç‚¹æ—¶ï¼Œä½ ä¼šæ ‡è®°æ‰€æœ‰çš„éœ€è¦å›æ”¶ä¸¢å¼ƒçš„ç‰©å“ï¼ŒåŒæ—¶ä¼šè®©é‚£äº›é‡è¦çš„ç‰©å“å»æ›¿ä»£åºŸå¼ƒç‰©å“çš„ä½ç½®ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©å­˜æ´»çš„ç‰©å“æŒ‰é¡ºåºæ’æ”¾ï¼Œè¿™æ ·å†…å­˜ç¢ç‰‡å°±ä¼šå¤§å¹…åº¦å‡å°‘ã€‚ä½†æ˜¯ç”±äºå†…å­˜å˜åŠ¨é¢‘ç¹ï¼Œä½ éœ€è¦æ¶ˆè€—çš„æ—¶é—´å˜å¤šäº†ï¼Œä½ éœ€è¦æŠŠåŸä½ç½®çš„ç‰©å“æ¬è¿åˆ°æ–°çš„ä½ç½®ï¼Œä¸­é—´çš„æ¶ˆè€—çš„æ—¶é—´æ¯”å¤åˆ¶ç®—æ³•è¿˜è¦å¤šã€‚</p><p>è¯¥ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼š<strong>æ ‡è®°å‡ºæ‰€æœ‰å¯ä»¥å›æ”¶çš„å¯¹è±¡</strong>ã€‚</li><li><strong>å‹ç¼©é˜¶æ®µ</strong>ï¼šå°†æ ‡è®°é˜¶æ®µçš„å¯¹è±¡ç§»åŠ¨åˆ°<strong>ç©ºé—´çš„ä¸€ç«¯</strong>ï¼Œé‡Šæ”¾å‰©ä½™çš„ç©ºé—´ã€‚</li></ul><p>è¯¥ç®—æ³•çš„æ ‡è®°è¿‡ç¨‹ä¸æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><p><strong>è§£å†³äº†å†…å­˜ç¢ç‰‡çš„é—®é¢˜</strong>ï¼Œ<strong>ä¹Ÿè§„é¿äº†å¤åˆ¶ç®—æ³•åªèƒ½åˆ©ç”¨ä¸€åŠå†…å­˜åŒºåŸŸçš„å¼Šç«¯</strong>ã€‚çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œ<strong>ä½†å®ƒå¯¹å†…å­˜å˜åŠ¨æ›´é¢‘ç¹ï¼Œéœ€è¦æ•´ç†æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œåœ¨æ•ˆç‡ä¸Šæ¯”å¤åˆ¶ç®—æ³•è¦å·®å¾ˆå¤š</strong>ã€‚</p><p>æ ‡è®°-æ•´ç†ç®—æ³•çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š </p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261944227.png" alt="å›¾ç‰‡"></p><h4 id="åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="åˆ†ä»£æ”¶é›†ç®—æ³•"></a>åˆ†ä»£æ”¶é›†ç®—æ³•</h4><p>ä¸Šé¢çš„å‡ ä¸ªç®—æ³•å­˜åœ¨ä¸€äº›è®©ä½ æ— æ³•æ¥å—çš„ç¼ºç‚¹ï¼Œç°åœ¨ä½ æƒ³æƒ³ä¸€ä¸ªå¥½çš„åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½ è®¤çœŸçš„æ€è€ƒäº†å‰é¢çš„å‡ ç§ç®—æ³•ï¼Œå¤åˆ¶ç®—æ³•å¯¼è‡´å †çš„åˆ©ç”¨ç‡é™ä½ï¼Œæ ‡è®°æ•´ç†ç®—æ³•å¯¼è‡´å¤„ç†çš„æ•ˆç‡é™ä½ï¼Œé‚£ä¹ˆä½ æƒ³å¯ä¸å¯ä»¥æŠŠè¿™ä¸¤ä¸ªç»“åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæ‰€ä»¥ä½ æå‡ºäº†åˆ†ä»£æ”¶é›†ç®—æ³•ã€‚</p><p>æƒ³è¿™ç§ç»“åˆå‡ ä¸ªç®—æ³•çš„ä¼˜ç‚¹å½¢æˆä¸€ä¸ªæ–°çš„ç®—æ³•çš„æ€æƒ³åœ¨è®¡ç®—æœºä¸–ç•Œä¸­å¾ˆå¸¸ç”¨ï¼Œåœ¨ä¹‹åçš„å­¦ä¹ ä»¥åŠå®é™…å·¥ä½œä¸­è¦å­¦ä¼šä½¿ç”¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261944507.webp" alt="å›¾ç‰‡"></p><p>åˆ†ä»£æ”¶é›†ç®—æ³•é€šè¿‡æŠŠå†…å­˜åŒºåŸŸåˆ’åˆ†æˆå‡ å—å¤§å°ä¸ç­‰çš„åŒºåŸŸï¼Œæˆ‘ä»¬ç§°ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚</p><h5 id="æ–°ç”Ÿä»£"><a href="#æ–°ç”Ÿä»£" class="headerlink" title="æ–°ç”Ÿä»£"></a>æ–°ç”Ÿä»£</h5><p>æ–°ç”Ÿä»£å æ•´ä¸ªå†…å­˜åŒºåŸŸçš„ä¸‰åˆ†ä¹‹ä¸€ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡æ¥çš„å¿«æ¶ˆå¤±çš„ä¹Ÿå¿«ï¼Œå¤§é‡çš„å¯¹è±¡åˆ›å»ºç„¶åæ­»äº¡ï¼Œå¾ˆå°‘æœ‰å¯¹è±¡èƒ½å¤Ÿä¸€ç›´å­˜æ´»ã€‚</p><p>åœ¨è¿™ä¸€ç‰‡åŒºåŸŸæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©å¤åˆ¶ç®—æ³•æ¥å¤åˆ¶å­˜æ´»çš„å¯¹è±¡ï¼Œè¿™æ ·å°±æœ‰æ•ˆçš„é™ä½äº†å¤åˆ¶æ¶ˆè€—çš„æ—¶é—´ï¼Œ**ä½†æ˜¯å¤åˆ¶ä¸æ˜¯ä¼šé™ä½è¿™ç‰‡åŒºåŸŸçš„ä½¿ç”¨ç‡å—ï¼Ÿ**æˆ–è€…è¯´è¿™ä¸ªæŸå¤±åœ¨æˆ‘ä»¬å¯æ¥å—çš„èŒƒå›´ä¹‹å†…ï¼Ÿ</p><h5 id="è€å¹´ä»£"><a href="#è€å¹´ä»£" class="headerlink" title="è€å¹´ä»£"></a>è€å¹´ä»£</h5><p>å¦‚æœå¯¹è±¡åœ¨æ–°ç”Ÿä»£åŒºåŸŸä¸­å­˜æ´»äº†å‡ è½®å®‰å…¨ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¼šè¿›å…¥è€å¹´ä»£ï¼Œåœ¨è€å¹´ä»£ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯æŒä¹…æ€§å¯¹è±¡ï¼Œå°‘éƒ¨åˆ†å¯¹è±¡ä¼šè¿›å…¥æ­»äº¡ã€‚åƒè¿™ä¸ªéœ€è¦æ¸…é™¤å¯¹è±¡è¾ƒå°‘çš„åŒºåŸŸï¼Œæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©ä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•æˆ–è€…æ ‡è®°-æ•´ç†ç®—æ³•æ¥å¯¹æ­»äº¡å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚</p><h3 id="GCåˆ†ç±»"><a href="#GCåˆ†ç±»" class="headerlink" title="GCåˆ†ç±»"></a>GCåˆ†ç±»</h3><p><strong>Minor GCï¼š</strong></p><ul><li>é’ˆå¯¹æ–°ç”Ÿä»£ã€‚</li><li>æŒ‡å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼Œå› ä¸ºjavaå¯¹è±¡å¤§å¤šéƒ½å…·å¤‡<strong>æœç”Ÿå¤•æ­»</strong>çš„ç‰¹æ€§ï¼Œæ‰€ä»¥<strong>Minor GCéå¸¸é¢‘ç¹</strong>ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚</li><li>è§¦å‘æ¡ä»¶ï¼šEdenç©ºé—´æ»¡æ—¶ã€‚</li></ul><p><strong>Major GCï¼š</strong></p><ul><li>é’ˆå¯¹è€å¹´ä»£ã€‚</li><li>æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„GCï¼Œå‡ºç°äº†Major GCï¼Œ<strong>ç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„Minor GC</strong>ï¼ˆä½†éç»å¯¹çš„ï¼Œåœ¨Parallel Scavenge æ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡ŒMajor GCçš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹ï¼‰ã€‚Major GCçš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯”Minor GCæ…¢10å€ä»¥ä¸Šã€‚</li><li>è§¦å‘æ¡ä»¶ï¼šMinor GC ä¼šå°†å¯¹è±¡ç§»åˆ°è€å¹´ä»£ä¸­ï¼Œå¦‚æœæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸å¤Ÿï¼Œé‚£ä¹ˆè§¦å‘ Major GCã€‚</li></ul><p><strong>Full GCï¼š</strong></p><ul><li>æ¸…ç†æ•´ä¸ªå †ç©ºé—´ã€‚ä¸€å®šæ„ä¹‰ä¸ŠFull GC å¯ä»¥è¯´æ˜¯ Minor GC å’Œ Major GC çš„ç»“åˆã€‚</li><li>è§¦å‘æ¡ä»¶ï¼šè°ƒç”¨System.gc()ï¼›è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼›ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥ã€‚</li></ul><h2 id="ChatGPTé¢è¯•é¢˜"><a href="#ChatGPTé¢è¯•é¢˜" class="headerlink" title="ChatGPTé¢è¯•é¢˜"></a>ChatGPTé¢è¯•é¢˜</h2><h3 id="Javaå†…å­˜åŒºåŸŸå’Œå†…å­˜æº¢å‡ºå¼‚å¸¸é¢è¯•é¢˜"><a href="#Javaå†…å­˜åŒºåŸŸå’Œå†…å­˜æº¢å‡ºå¼‚å¸¸é¢è¯•é¢˜" class="headerlink" title="Javaå†…å­˜åŒºåŸŸå’Œå†…å­˜æº¢å‡ºå¼‚å¸¸é¢è¯•é¢˜"></a>Javaå†…å­˜åŒºåŸŸå’Œå†…å­˜æº¢å‡ºå¼‚å¸¸é¢è¯•é¢˜</h3><h3 id="Promote"><a href="#Promote" class="headerlink" title="Promote"></a>Promote</h3><blockquote><p>ç°åœ¨å‡è®¾ä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„JVMé¢è¯•å®˜ï¼Œç°åœ¨ä½ éœ€è¦é’ˆå¯¹JVMä¸­å†…å­˜åŒºåŸŸå’Œä¸å†…å­˜æº¢å‡ºå¼‚å¸¸è¿™ä¸€ä¸»é¢˜å‡ºä¸€å¥—é¢è¯•é¢˜ç›®ï¼Œè¯·ä½ ä¸è¦æ¶‰åŠåˆ°å…¶å®ƒä¸»é¢˜éƒ¨åˆ†ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶ç­‰å…¶ä»–ç°åœ¨ä¸éœ€è¦è¿›è¡Œè€ƒå¯Ÿçš„éƒ¨åˆ†ï¼Œè¯¥é¢è¯•é¢˜ç›®éš¾åº¦æ­£å¸¸ï¼Œç®€å•2é“ï¼Œä¸­ç­‰5é“ï¼Œå›°éš¾3é“ï¼Œè¯·ä½ ç›´æ¥ç»™å‡ºè¿™ä¸ªé¢è¯•é¢˜ç›®ï¼Œè¦æ±‚è¯¥è¿™å¥—é¢è¯•é¢˜ç›®å¯ä»¥å¾ˆå¥½çš„æ¶µç›–JVMè¿™å†…å­˜ç®¡ç†è¿™ä¸€ä¸»é¢˜ï¼Œå¹¶ä¸”ç¬¦åˆJavaç¨‹åºå‘˜éœ€è¦æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼Œè¯·ä½ é¿å…å‡ºæ— æ„ä¹‰çš„é¢˜ç›®ï¼Œæ‰€æœ‰çš„é¢˜ç›®éƒ½å…·æœ‰ä¸€å®šçš„è€ƒå¯Ÿä»·å€¼ã€‚æ³¨æ„ï¼šè¯·ä½ ç›´æ¥ç»™å‡ºé¢è¯•é¢˜ç›®ï¼Œæ— éœ€ç»™å‡ºç­”æ¡ˆï¼Œæˆ‘åé¢ä¼šè¿›è¡Œå›ç­”ã€‚</p></blockquote><h3 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h3><blockquote><h3 id="ç®€å•é¢˜"><a href="#ç®€å•é¢˜" class="headerlink" title="ç®€å•é¢˜"></a>ç®€å•é¢˜</h3><ol><li>è¯·ç®€è¿° JVM çš„å†…å­˜åŒºåŸŸåˆ’åˆ†ï¼Œå¹¶è¯´æ˜æ¯ä¸ªåŒºåŸŸçš„ä¸»è¦ä½œç”¨ã€‚  </li><li>ä»€ä¹ˆæ˜¯å †å†…å­˜å’Œæ ˆå†…å­˜ï¼Ÿä¸¤è€…åœ¨ä½¿ç”¨ä¸Šçš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><h3 id="ä¸­ç­‰é¢˜"><a href="#ä¸­ç­‰é¢˜" class="headerlink" title="ä¸­ç­‰é¢˜"></a>ä¸­ç­‰é¢˜</h3><ol start="3"><li>JVM ä¸­æ–¹æ³•åŒºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ JDK 8 ä¸­æ–¹æ³•åŒºçš„å®ç°æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ  </li><li>ä»€ä¹ˆæ˜¯ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰ï¼Ÿå®ƒçš„åˆ†é…å—ä»€ä¹ˆé™åˆ¶ï¼Ÿ  </li><li>å½“ JVM æŠ›å‡º <code>OutOfMemoryError</code> æ—¶ï¼Œå¯èƒ½ä¼šåœ¨å“ªäº›å†…å­˜åŒºåŸŸå‘ç”Ÿï¼Ÿè¯·åˆ—ä¸¾å¹¶è¯´æ˜å¯èƒ½çš„åŸå› ã€‚  </li><li>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæœ¬åœ°å˜é‡å­˜å‚¨åœ¨å“ªä¸ªå†…å­˜åŒºåŸŸï¼Ÿçº¿ç¨‹å®‰å…¨æ€§å¦‚ä½•ä¿è¯ï¼Ÿ  </li><li>åœ¨ JVM ä¸­å¦‚ä½•é€šè¿‡é…ç½®è°ƒæ•´å †å†…å­˜å¤§å°ï¼Ÿåˆ†åˆ«è¯´æ˜åˆå§‹å †å¤§å°å’Œæœ€å¤§å †å¤§å°çš„é…ç½®å‚æ•°ã€‚</li></ol><h3 id="å›°éš¾é¢˜"><a href="#å›°éš¾é¢˜" class="headerlink" title="å›°éš¾é¢˜"></a>å›°éš¾é¢˜</h3><ol start="8"><li>å½“ç¨‹åºä¸­é¢‘ç¹åˆ›å»ºå¤§é‡çŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æ—¶ï¼Œå¯èƒ½å¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚æœç¨‹åºå‡ºç°äº† <code>OutOfMemoryError: Java heap space</code>ï¼Œè¯¥å¦‚ä½•è¿›è¡Œè¯Šæ–­å’Œä¼˜åŒ–ï¼Ÿ  </li><li>è¯·æè¿°è™šæ‹Ÿæœºæ ˆæº¢å‡ºï¼ˆ<code>StackOverflowError</code>ï¼‰çš„æˆå› ï¼Œå¹¶åˆ—ä¸¾ä¸¤ä¸ªå¸¸è§çš„å¼•å‘åœºæ™¯ã€‚  </li><li>å¦‚æœç¨‹åºä¸­éœ€è¦é¢‘ç¹åŠ è½½å¤§é‡ç±»ï¼Œå¯¼è‡´ <code>OutOfMemoryError: Metaspace</code>ï¼Œä½ ä¼šå¦‚ä½•åˆ†æå’Œè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>34-01 æ•°æ®åº“-è¾¾æ¢¦æ•°æ®åº“</title>
      <link href="/2025/02/26/34-01%20%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>/2025/02/26/34-01%20%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="34-01-æ•°æ®åº“-è¾¾æ¢¦æ•°æ®åº“"><a href="#34-01-æ•°æ®åº“-è¾¾æ¢¦æ•°æ®åº“" class="headerlink" title="34-01 æ•°æ®åº“-è¾¾æ¢¦æ•°æ®åº“"></a>34-01 æ•°æ®åº“-è¾¾æ¢¦æ•°æ®åº“</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨ä¿¡æ¯å®‰å…¨æ—¥ç›Šé‡è¦çš„ä»Šå¤©ï¼Œå›½å†…å¾ˆå¤šéƒ¨é—¨éƒ½è¦æ±‚ä½¿ç”¨å›½äº§åŒ–çš„æ•°æ®åº“æ¥æ›¿ä»£åŸå…ˆå›½å¤–çš„æ•°æ®åº“ï¼Œåœ¨è¿™é‡Œä»‹ç»ä¸€æ¬¾å›½å†…è¾ƒçŸ¥åçš„æ•°æ®åº“â€”â€”è¾¾æ¢¦ã€‚</p><p>è¾¾æ¢¦æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ˜¯è¾¾æ¢¦å…¬å¸æ¨å‡ºçš„å…·æœ‰å®Œå…¨è‡ªä¸»çŸ¥è¯†äº§æƒçš„é«˜æ€§èƒ½æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œç®€ç§°DMã€‚è¾¾æ¢¦æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ7.0ç‰ˆæœ¬ï¼Œç®€ç§°DM7ã€‚</p><h2 id="è¾¾æ¢¦æ•°æ®åº“å®‰è£…"><a href="#è¾¾æ¢¦æ•°æ®åº“å®‰è£…" class="headerlink" title="è¾¾æ¢¦æ•°æ®åº“å®‰è£…"></a>è¾¾æ¢¦æ•°æ®åº“å®‰è£…</h2><p>è¿™é‡Œä»‹ç»çš„æ˜¯åœ¨Windowsç¯å¢ƒä¸‹å®‰è£…DMæ•°æ®åº“ã€‚</p><p>å‚è€ƒæ•™ç¨‹ï¼š<a href="https://blog.csdn.net/qq_37358909/article/details/108372770?login=from_csdn">Windowsç¯å¢ƒå®‰è£…è¾¾æ¢¦æ•°æ®åº“</a></p><p>æŒ‰ç…§è¿‡ç¨‹ä¸€æ­¥ä¸€æ­¥çš„è¿›è¡Œå³å¯ã€‚</p><p>é»˜è®¤ç”¨æˆ·åï¼šSYSDBA</p><p>é»˜è®¤å¯†ç ï¼šSYSDBA</p><h2 id="Ubuntuç¯å¢ƒä¸‹å®‰è£…è¾¾æ¢¦æ•°æ®åº“"><a href="#Ubuntuç¯å¢ƒä¸‹å®‰è£…è¾¾æ¢¦æ•°æ®åº“" class="headerlink" title="Ubuntuç¯å¢ƒä¸‹å®‰è£…è¾¾æ¢¦æ•°æ®åº“"></a>Ubuntuç¯å¢ƒä¸‹å®‰è£…è¾¾æ¢¦æ•°æ®åº“</h2><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/m0_46357847/article/details/125352435">Linuxå®‰è£…è¾¾æ¢¦æ•°æ®åº“&#x2F;DM8ï¼ˆé™„å¸¦å®¢æˆ·ç«¯å·¥å…·å®‰è£…å®Œæ•´ç‰ˆï¼‰</a></p><h3 id="åˆ›å»ºå®‰è£…ä¸è¿è¡Œçš„Linuxç”¨æˆ·"><a href="#åˆ›å»ºå®‰è£…ä¸è¿è¡Œçš„Linuxç”¨æˆ·" class="headerlink" title="åˆ›å»ºå®‰è£…ä¸è¿è¡Œçš„Linuxç”¨æˆ·"></a>åˆ›å»ºå®‰è£…ä¸è¿è¡Œçš„Linuxç”¨æˆ·</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 1.åˆ›å»ºå®‰è£…ç”¨æˆ·ç»„ dmsys</span><br><span class="line">[root@laizhenghua /]# groupadd dmsys</span><br><span class="line"></span><br><span class="line"># 2.åˆ›å»ºå®‰è£…ç”¨æˆ· dmdba</span><br><span class="line">[root@laizhenghua /]# sudo useradd -g dmsys -m -d /home/space/Documents/deployment/Softwares/Tong/DM -s /bin/bash dmdba</span><br><span class="line"></span><br><span class="line"># 3.åˆå§‹åŒ– dmdba ç”¨æˆ·å¯†ç </span><br><span class="line">[root@laizhenghua /]# passwd dmdba</span><br><span class="line"># æŒ‰ç³»ç»Ÿæç¤ºè¿›è¡Œå¯†ç è®¾ç½®å³å¯</span><br><span class="line"></span><br><span class="line"># 3.æŸ¥çœ‹ç”¨æˆ·å’Œç”¨æˆ·ç»„ID</span><br><span class="line">[root@laizhenghua /]# id dmdba</span><br><span class="line">uid=1000(dmdba) gid=1000(dmsys) groups=1000(dmsys)</span><br><span class="line"></span><br><span class="line"># 4.åˆ‡æ¢è‡³ dmdba</span><br><span class="line">[root@laizhenghua home]# su dmdba</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>dmdbaç”¨æˆ·å¯†ç ï¼š123</strong></p><h3 id="æ“ä½œç³»ç»Ÿèµ„æºé™åˆ¶æ£€æŸ¥"><a href="#æ“ä½œç³»ç»Ÿèµ„æºé™åˆ¶æ£€æŸ¥" class="headerlink" title="æ“ä½œç³»ç»Ÿèµ„æºé™åˆ¶æ£€æŸ¥"></a>æ“ä½œç³»ç»Ÿèµ„æºé™åˆ¶æ£€æŸ¥</h3><p>è¿™ä¹Ÿæ˜¯å®˜æ–¹ç»™å‡ºçš„æé†’ï¼Œåœ¨<code>Linux</code>ç³»ç»Ÿä¸­ï¼Œå› ä¸º<code>ulimit</code>å‘½ä»¤çš„å­˜åœ¨ï¼Œä¼šå¯¹ç¨‹åºä½¿ç”¨æ“ä½œç³»ç»Ÿèµ„æºè¿›è¡Œé™åˆ¶ï¼Œä¸ºäº†ä½¿è¾¾æ¢¦æ•°æ®åº“æœåŠ¡ç«¯æ­£å¸¸è¿è¡Œï¼Œè¦é€‚å½“è°ƒæ•´å½“å‰å®‰è£…ç”¨æˆ·çš„<code>ulimit</code>å‚æ•°ã€‚å¯ä»¥ä½¿ç”¨<code>ulimit -a</code>å‘½ä»¤æ£€æŸ¥ï¼Œå¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[dmdba@laizhenghua home]$ ulimit -a</span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 7699</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 65535</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 4096</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261947532.png" alt="image-20240717103808321"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261947578.png" alt="image-20240717103901348"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@laizhenghua /]# su - dmdba</span><br><span class="line">Last login: Sun Jun 19 13:26:42 CST 2022 on pts/0</span><br><span class="line"></span><br><span class="line">[dmdba@laizhenghua ~]$ cd /opt/soft</span><br><span class="line"># å¯èƒ½ä¼šæƒé™ä¸å¤Ÿè®°å¾—ä½¿ç”¨rootç”¨æˆ·ç»™æ–‡ä»¶èµ‹æƒ chmod 775 DMInstall.bin</span><br><span class="line">[dmdba@laizhenghua soft]$ ./DMInstall.bin -i</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 1.å®‰è£…è¯­è¨€é€‰ä¸­æ–‡</span><br><span class="line"># 2.è¾“å…¥ key æ–‡ä»¶è·¯å¾„é€‰æ²¡æœ‰ï¼Œä¸ä¼šå¯¹åç»­äº§ç”Ÿå½±å“</span><br><span class="line"># 3.è®¾ç½®æ—¶åŒºé€‰ä¸œ 8 åŒºå³å¯</span><br><span class="line"># 4.å®‰è£…ç±»å‹é€‰æœåŠ¡å™¨å®‰è£…</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">å…¸å‹å®‰è£…åŒ…æ‹¬ï¼šæœåŠ¡å™¨ã€å®¢æˆ·ç«¯ã€é©±åŠ¨ã€ç”¨æˆ·æ‰‹å†Œã€æ•°æ®åº“æœåŠ¡ã€‚</span><br><span class="line">æœåŠ¡å™¨å®‰è£…åŒ…æ‹¬ï¼šæœåŠ¡å™¨ã€é©±åŠ¨ã€ç”¨æˆ·æ‰‹å†Œã€æ•°æ®åº“æœåŠ¡ã€‚</span><br><span class="line">å®¢æˆ·ç«¯å®‰è£…åŒ…æ‹¬ï¼šå®¢æˆ·ç«¯ã€é©±åŠ¨ã€ç”¨æˆ·æ‰‹å†Œã€‚</span><br><span class="line">è‡ªå®šä¹‰å®‰è£…åŒ…æ‹¬ï¼šæ ¹æ®ç”¨æˆ·éœ€è¦å‹¾é€‰ç»„ä»¶ï¼Œå¯ä»¥æ˜¯æœåŠ¡å™¨ã€å®¢æˆ·ç«¯ã€é©±åŠ¨ã€ç”¨æˆ·æ‰‹å†Œã€æ•°æ®åº“æœåŠ¡ä¸­çš„ä»»æ„ç»„åˆã€‚</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"># 5.å®‰è£…ç›®å½•é€‰æ‹©æŒ‡å®šè·¯å¾„ /db/dmdbms</span><br><span class="line"># 6.æ˜¯å¦ç¡®è®¤å®‰è£…é€‰æ‹©yå³å¯</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¯·ä»¥rootç³»ç»Ÿç”¨æˆ·æ‰§è¡Œå‘½ä»¤:</span><br><span class="line">/home/dmdba/dmdbms/script/root/root_installer.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœå­˜åœ¨æ‰¾ä¸åˆ°è¿™ä¸ªæ–‡ä»¶çš„æƒ…å†µï¼Œè¯·ä½ ç»™è¿™ä¸ªæ–‡ä»¶æƒé™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š</span><br><span class="line">ls -l /home/dmdba/dmdbms/script/root/root_installer.sh</span><br><span class="line"></span><br><span class="line">æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š</span><br><span class="line">å¦‚æœæ–‡ä»¶æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ æ‰§è¡Œæƒé™ï¼š</span><br><span class="line">chmod +x /home/dmdba/dmdbms/script/root/root_installer.sh</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨å®Œæ•´è·¯å¾„æ‰§è¡Œè„šæœ¬ï¼š</span><br><span class="line">ä½¿ç”¨è„šæœ¬çš„å®Œæ•´è·¯å¾„æ¥æ‰§è¡Œå®ƒï¼Œç¡®ä¿å½“å‰å·¥ä½œç›®å½•æ­£ç¡®ï¼š</span><br><span class="line">sudo /home/dmdba/dmdbms/script/root/root_installer.sh</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–æ•°æ®åº“å®ä¾‹"><a href="#åˆå§‹åŒ–æ•°æ®åº“å®ä¾‹" class="headerlink" title="åˆå§‹åŒ–æ•°æ®åº“å®ä¾‹"></a>åˆå§‹åŒ–æ•°æ®åº“å®ä¾‹</h3><p>è¾¾æ¢¦æ•°æ®åº“çš„é€»è¾‘æ¶æ„å’Œ<code>Oracle</code>ä¸€æ ·ï¼Œæ•°æ®åº“çš„æ¦‚å¿µä¸å…¶ä»–æ•°æ®åº“ä¸ä¸€æ ·ï¼Œåªæœ‰å®ä¾‹ã€ç”¨æˆ·ã€è¡¨ã€è¡¨ç©ºé—´ç­‰è¿™äº›æ¦‚å¿µã€‚ä»¥ä¸Šè¿‡ç¨‹æˆ‘ä»¬åªå®Œæˆäº†æ•°æ®åº“çš„å®‰è£…ï¼Œè¿˜éœ€è¦åˆå§‹åŒ–è¾¾æ¢¦æ•°æ®åº“å®ä¾‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[dmdba@laizhenghua ~]$ cd /db/dmdbms/bin</span><br><span class="line">[dmdba@laizhenghua bin]$ ./dminit path=/dbdata db_name=test BLANK_PAD_MODE=1</span><br><span class="line">initdb V8</span><br><span class="line">db version: 0x7000c</span><br><span class="line">file dm.key not found, use default license!</span><br><span class="line">License will expire on 2023-05-25</span><br><span class="line">Normal of FAST</span><br><span class="line">Normal of DEFAULT</span><br><span class="line">Normal of RECYCLE</span><br><span class="line">Normal of KEEP</span><br><span class="line">Normal of ROLL</span><br><span class="line"></span><br><span class="line"> log file path: /dbdata/test/test01.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> log file path: /dbdata/test/test02.log</span><br><span class="line"></span><br><span class="line">write to dir [/dbdata/test].</span><br><span class="line">create dm database success. 2022-06-19 20:13:34</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨æ•°æ®åº“å®ä¾‹"><a href="#å¯åŠ¨æ•°æ®åº“å®ä¾‹" class="headerlink" title="å¯åŠ¨æ•°æ®åº“å®ä¾‹"></a>å¯åŠ¨æ•°æ®åº“å®ä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 1.å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨æ•°æ®åº“å®ä¾‹</span><br><span class="line"># su - dmdba</span><br><span class="line"># å¯†ç 123</span><br><span class="line">[dmdba@laizhenghua /]$ cd dmdbms/bin</span><br><span class="line">[dmdba@laizhenghua bin]$ ./dmserver /dbdata/test/dm.ini</span><br><span class="line"></span><br><span class="line"># 2.æ³¨å†Œæ“ä½œç³»ç»ŸæœåŠ¡</span><br><span class="line"># su root</span><br><span class="line">[root@laizhenghua root]# pwd</span><br><span class="line">/db/dmdbms/script/root</span><br><span class="line">[root@laizhenghua root]# ls</span><br><span class="line">dm_service_installer.sh  dm_service_uninstaller.sh  root_installer.sh</span><br><span class="line"></span><br><span class="line">[root@laizhenghua root]# ./dm_service_installer.sh -t dmserver -dm_ini /dbdata/test/dm.ini -p DMSERVER</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/DmServiceDMSERVER.service to /usr/lib/systemd/system/DmServiceDMSERVER.service.</span><br><span class="line">åˆ›å»ºæœåŠ¡(DmServiceDMSERVER)å®Œæˆ</span><br><span class="line"></span><br><span class="line"># 3.å¯åŠ¨æ•°æ®åº“å®ä¾‹</span><br><span class="line">[root@laizhenghua root]# systemctl start DmServiceDMSERVER.service </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="MYSQLæ•°æ®åº“è¿ç§»è‡³è¾¾æ¢¦æ•°æ®åº“"><a href="#MYSQLæ•°æ®åº“è¿ç§»è‡³è¾¾æ¢¦æ•°æ®åº“" class="headerlink" title="MYSQLæ•°æ®åº“è¿ç§»è‡³è¾¾æ¢¦æ•°æ®åº“"></a>MYSQLæ•°æ®åº“è¿ç§»è‡³è¾¾æ¢¦æ•°æ®åº“</h2><p>åœ¨å¾ˆå¤šé¡¹ç›®ä¸­å¯èƒ½éœ€è¦æ›´æ”¹æ•°æ®åº“ï¼ŒæŠŠåŸå…ˆä½¿ç”¨çš„MySQLæ•°æ®åº“æ”¹æˆä½¿ç”¨è¾¾æ¢¦æ•°æ®åº“ã€‚è¾¾æ¢¦æ•°æ®åº“æ”¯æŒä»MySQLä¸­ç›´æ¥æŠŠè¡¨è¿ç§»è¿‡æ¥ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/m0_71845127/article/details/130347623?login=from_csdn">MySQLæ•°æ®è¿ç§»è‡³è¾¾æ¢¦æ•°æ®åº“</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261947657.png" alt="img"></p><h2 id="Springé¡¹ç›®æ•´åˆè¾¾æ¢¦æ•°æ®åº“"><a href="#Springé¡¹ç›®æ•´åˆè¾¾æ¢¦æ•°æ®åº“" class="headerlink" title="Springé¡¹ç›®æ•´åˆè¾¾æ¢¦æ•°æ®åº“"></a>Springé¡¹ç›®æ•´åˆè¾¾æ¢¦æ•°æ®åº“</h2><p>å‚è€ƒèµ„æ–™ï¼š<strong><a href="https://gitcode.csdn.net/662b562575c93e11c8024a29.html?dp_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6MTY2ODE0NCwiZXhwIjoxNzE4ODU0NzI1LCJpYXQiOjE3MTgyNDk5MjUsInVzZXJuYW1lIjoiZnloMjk0NDE2MzI0MCJ9.ictijIg7ZveNMWrEA13IzxFGGnsDFQgCZDQzv28anEA">SpringBooté¡¹ç›®æ•´åˆè¾¾æ¢¦æ•°æ®åº“ï¼ˆMYSQL è½¬æ¢ è¾¾æ¢¦æ•°æ®åº“ï¼‰</a></strong></p><h3 id="Mavenå¯¼å…¥è¾¾æ¢¦æ•°æ®åº“é©±åŠ¨åŒ…"><a href="#Mavenå¯¼å…¥è¾¾æ¢¦æ•°æ®åº“é©±åŠ¨åŒ…" class="headerlink" title="Mavenå¯¼å…¥è¾¾æ¢¦æ•°æ®åº“é©±åŠ¨åŒ…"></a>Mavenå¯¼å…¥è¾¾æ¢¦æ•°æ®åº“é©±åŠ¨åŒ…</h3><p>è¯¥JARåŒ…æä¾›åœ¨ä¸‹è½½å¥½çš„DMå®‰è£…åŒ…ä¸­ï¼š\drivers\jdbc</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261948804.png" alt="img"></p><p>åœ¨è¿™é‡Œæˆ‘ä½¿ç”¨çš„JDKæ˜¯1.8åˆ™å¯¹åº”çš„ä½¿ç”¨DmJdbcDriver18ï¼Œè¯¦ç»†å¯¹åº”è¯·çœ‹æ–‡ä»¶å¤¹ä¸­çš„readme.txtæ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬éœ€è¦å°†è¯¥JARåŒ…æ‰‹åŠ¨æ·»åŠ åˆ°ä»“åº“ä¸­ï¼Œè¿œç¨‹ä»“åº“æ— è¯¥JARåŒ…ï¼Œæ‰€ä»¥åªèƒ½æ‰‹åŠ¨ã€‚</p><p>æ‰¾åˆ°æœ¬åœ°ä¸‹è½½çš„Mavenæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åè¿›å…¥binç›®å½•æ‰“å¼€cmdï¼Œè¾“å…¥å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file -DgroupId=com.dm -DartifactId=DmJdbcDriver -Dversion=1.8.0 -Dpackaging=jar -Dfile=D:\develop\dm8\drivers\jdbc\DmJdbcDriver18.jar</span><br><span class="line"></span><br><span class="line">å…¶ä¸­-Dfile=æŒ‡å‘è¯¥JARåŒ…çš„è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨IDEAä¸­ä½¿ç”¨IDEAè‡ªå¸¦çš„mvnè¿›è¡Œä¸‹è½½ï¼Œè¾“å…¥çš„å‘½ä»¤å¦‚ä¸Šã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261948645.png" alt="img"></p><p>åœ¨Mavenä¸­å¯¼å…¥è¾¾æ¢¦æ•°æ®åº“é©±åŠ¨åŒ…ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.dm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>DmJdbcDriver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Springé¡¹ç›®é…ç½®æ•°æ®åº“"><a href="#Springé¡¹ç›®é…ç½®æ•°æ®åº“" class="headerlink" title="Springé¡¹ç›®é…ç½®æ•°æ®åº“"></a>Springé¡¹ç›®é…ç½®æ•°æ®åº“</h3><p>åœ¨æœºåœºé¡¹ç›®ä¸­ï¼Œéœ€è¦åœ¨é…ç½®ä¸­å¿ƒä¹Ÿå°±æ˜¯Nacosä¸­ä½¿ç”¨å¦‚ä¸‹å†…å®¹æ¥æ›¿æ¢åŸå…ˆMySQLçš„é…ç½®ä¿¡æ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261948284.png" alt="img"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">datasource:</span></span><br><span class="line">  <span class="attr">driver-class-name:</span> <span class="string">dm.jdbc.driver.DmDriver</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">jdbc:dm://localhost:5236/SYSDBA?zeroDateTimeBehavior=convertToNull&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">SYSDBA</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">SYSDBA</span></span><br></pre></td></tr></table></figure><h3 id="è¡¨çš„å®ä½“æ˜ å°„"><a href="#è¡¨çš„å®ä½“æ˜ å°„" class="headerlink" title="è¡¨çš„å®ä½“æ˜ å°„"></a>è¡¨çš„å®ä½“æ˜ å°„</h3><p>åœ¨æœºåœºé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä»¥åº”ç”¨ä¿¡æ¯è¡¨ä¸ºä¾‹ã€‚åº”ç”¨é…ç½®å¦‚ä¸‹ä¿¡æ¯è¡¨ï¼š</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°†@TableNameä¸­Valueä¸­çš„å€¼è¿›è¡Œä¿®æ”¹ï¼ŒåŸæ¥ä½¿ç”¨MySQLå†…å®¹ä¸ºï¼š@TableName(value&#x3D;â€sys_applicationâ€)ç°åœ¨è¦æ›¿æ¢æˆ@TableName(value &#x3D; â€œSYSDBA.SYS_APPLICATIONâ€)</p><p>åœ¨è¾¾æ¢¦æ•°æ®åº“ä¸­éœ€è¦ä½¿ç”¨æ¨¡å‹.è¡¨åçš„ç»“æ„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.board.gov.domain.po;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.*;</span><br><span class="line"><span class="keyword">import</span> com.board.gov.domain.po.meta.MetaDataBasePO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.media.Schema;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> chao.lu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: èˆªç­åŸºæœ¬ä¿¡æ¯PO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/3/8 10:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;SYSDBA.SYS_APPLICATION&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DmTestPO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åº”ç”¨ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long appId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;ä¹è§‚é”æ ‡è¯†&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long version;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;ç§Ÿæˆ·ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long tenantId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åº”ç”¨åç§°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åº”ç”¨Key&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åº”ç”¨å¯†é’¥&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appSecret;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åº”ç”¨åŠ å¯†å¯†ç (32ä½)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appEncryptPassword;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;å›è°ƒURL&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String callbackUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;ä¸»é¡µURL&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String indexUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;IPç™½åå•&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ipWhiteList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;logo url&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String logoUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;Tokenè¿‡æœŸæ—¶é•¿(å¤©)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> tokenExpireDuration;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åº”ç”¨çŠ¶æ€(1-å¯ç”¨,2-ç¦ç”¨)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> status;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åˆ é™¤æ ‡è®°,1:å·²åˆ é™¤,0:æ­£å¸¸&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String delFlag;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;æè¿°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºäºº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åˆ›å»ºäºº&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String createBy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹äºº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.UPDATE)</span></span><br><span class="line">    <span class="meta">@Schema(description = &quot;ä¿®æ”¹äºº&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String updateBy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºæ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="meta">@Schema(description = &quot;åˆ›å»ºæ—¶é—´&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.UPDATE)</span></span><br><span class="line">    <span class="meta">@Schema(description = &quot;ä¿®æ”¹æ—¶é—´&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Mybatis-Mapperå±‚"><a href="#Mybatis-Mapperå±‚" class="headerlink" title="Mybatis Mapperå±‚"></a>Mybatis Mapperå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.board.gov.biz.ports.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.board.gov.domain.po.DmTestPO;</span><br><span class="line"><span class="keyword">import</span> com.space.common.data.datascope.SpaceBaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DmTestMapper</span> <span class="keyword">extends</span> <span class="title class_">SpaceBaseMapper</span>&lt;DmTestPO&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.board.gov.biz.ports.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.board.gov.domain.po.DmTestPO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DmTestService</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    List&lt;DmTestPO&gt; <span class="title function_">getDmTestPoList</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.board.gov.biz.ports.service.Impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.board.gov.biz.ports.mapper.DmTestMapper;</span><br><span class="line"><span class="keyword">import</span> com.board.gov.biz.ports.service.DmTestService;</span><br><span class="line"><span class="keyword">import</span> com.board.gov.domain.po.DmTestPO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DmTestServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;DmTestMapper, DmTestPO&gt; <span class="keyword">implements</span> <span class="title class_">DmTestService</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;DmTestPO&gt; <span class="title function_">getDmTestPoList</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.board.gov.biz.ports.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.board.gov.biz.ports.service.DmTestService;</span><br><span class="line"><span class="keyword">import</span> com.board.gov.domain.po.DmTestPO;</span><br><span class="line"><span class="keyword">import</span> com.space.common.security.annotation.Inner;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Inner(value = false)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DmTestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DmTestService dmTestService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getDmTestPoList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;DmTestPO&gt; <span class="title function_">getDmTestPoList</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dmTestService.getDmTestPoList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261948954.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261948511.png" alt="img"></p><h2 id="è¾¾æ¢¦æ•°æ®åº“SQLæŸ¥è¯¢æŠ¥é”™ä¸æ˜¯-GROUP-BY-è¡¨è¾¾å¼è§£å†³æ–¹æ³•"><a href="#è¾¾æ¢¦æ•°æ®åº“SQLæŸ¥è¯¢æŠ¥é”™ä¸æ˜¯-GROUP-BY-è¡¨è¾¾å¼è§£å†³æ–¹æ³•" class="headerlink" title="è¾¾æ¢¦æ•°æ®åº“SQLæŸ¥è¯¢æŠ¥é”™ä¸æ˜¯ GROUP BY è¡¨è¾¾å¼è§£å†³æ–¹æ³•"></a>è¾¾æ¢¦æ•°æ®åº“SQLæŸ¥è¯¢æŠ¥é”™ä¸æ˜¯ GROUP BY è¡¨è¾¾å¼è§£å†³æ–¹æ³•</h2><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/qq_37898570/article/details/126951104">https://blog.csdn.net/qq_37898570/article/details/126951104</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> è¾¾æ¢¦æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>34-03 Tong Webå®‰è£…</title>
      <link href="/2025/02/26/34-03%20TongWeb%E5%AE%89%E8%A3%9D/"/>
      <url>/2025/02/26/34-03%20TongWeb%E5%AE%89%E8%A3%9D/</url>
      
        <content type="html"><![CDATA[<h1 id="34-03-Tong-Webå®‰è£…"><a href="#34-03-Tong-Webå®‰è£…" class="headerlink" title="34-03 Tong Webå®‰è£…"></a>34-03 Tong Webå®‰è£…</h1><p>è‡ªè¡Œä¸‹è½½ï¼Œ</p><p><a href="https://blog.csdn.net/qq_38377190/article/details/127764475">TongWeb7æœ¬åœ°éƒ¨ç½²ï¼ˆWindowsï¼‰</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">startserver.bat å¯åŠ¨é¡¹ç›®</span><br><span class="line"></span><br><span class="line">stopserver.bat åœæ­¢é¡¹ç›®</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9060/console</span><br><span class="line"></span><br><span class="line">é»˜è®¤è´¦å·ï¼šthanos</span><br><span class="line"></span><br><span class="line">é»˜è®¤å¯†ç ï¼šthanos123.com</span><br><span class="line"></span><br><span class="line">ç°åœ¨æœ¬åœ°å¯†ç æ˜¯!Fyh2380514719</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261950510.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tong Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>34-04 Milvus</title>
      <link href="/2025/02/26/34-04%20Milvus/"/>
      <url>/2025/02/26/34-04%20Milvus/</url>
      
        <content type="html"><![CDATA[<h1 id="34-04-Milvus"><a href="#34-04-Milvus" class="headerlink" title="34-04 Milvus"></a>34-04 Milvus</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/lsb2002/article/details/132222947">ä¸ºAIè€Œç”Ÿçš„æ•°æ®åº“ï¼šMilvusè¯¦è§£åŠå®æˆ˜</a></li></ol><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h2 id="Pythonä½¿ç”¨Demo"><a href="#Pythonä½¿ç”¨Demo" class="headerlink" title="Pythonä½¿ç”¨Demo"></a>Pythonä½¿ç”¨Demo</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£… Python å®¢æˆ·ç«¯</span><br><span class="line">pip install pymilvus</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 3. åˆå§‹åŒ– Milvus å®¢æˆ·ç«¯</span><br><span class="line"></span><br><span class="line">from pymilvus import connections as milvus</span><br><span class="line"></span><br><span class="line"># åˆå§‹åŒ–ä¸€ä¸ª Milvus å®¢æˆ·ç«¯ï¼Œé»˜è®¤è¿æ¥åˆ°æœ¬åœ°çš„ Milvus æœåŠ¡</span><br><span class="line">client = milvus.connect(&#x27;default&#x27;, host=&#x27;localhost&#x27;, port=&#x27;19530&#x27;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 4. åˆ›å»ºé›†åˆ</span><br><span class="line"></span><br><span class="line">collection_name = &quot;face_collection&quot;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºé›†åˆï¼Œç¡®ä¿é›†åˆä¸å­˜åœ¨</span><br><span class="line">if not client.has_collection(collection_name):</span><br><span class="line">    client.create_collection(collection_name)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 5. å®šä¹‰å‘é‡å­—æ®µçš„ç±»å‹</span><br><span class="line"></span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å‘é‡å­—æ®µçš„ç±»å‹ï¼Œå‡è®¾å‘é‡ç»´åº¦ä¸º 128</span><br><span class="line">fields = [</span><br><span class="line">    (&quot;face_vector&quot;, &quot;float_vector&quot;, 128),</span><br><span class="line">    (&quot;face_name&quot;, &quot;text&quot;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 6. æ’å…¥æ•°æ®</span><br><span class="line"># å‡†å¤‡ä¸€äº›ç¤ºä¾‹æ•°æ®</span><br><span class="line">data_to_insert = [</span><br><span class="line">    &#123;&quot;face_vector&quot;: np.random.random(128).tolist(), &quot;face_name&quot;: &quot;Person1&quot;&#125;,</span><br><span class="line">    &#123;&quot;face_vector&quot;: np.random.random(128).tolist(), &quot;face_name&quot;: &quot;Person2&quot;&#125;,</span><br><span class="line">    # ... æ›´å¤šæ•°æ®</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># æ’å…¥æ•°æ®</span><br><span class="line">insert_result = client.insert(collection_name, fields, data_to_insert)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">7. æœç´¢ç›¸ä¼¼å‘é‡</span><br><span class="line"># å‡†å¤‡ä¸€ä¸ªæŸ¥è¯¢å‘é‡</span><br><span class="line">query_vector = np.random.random(128).tolist()</span><br><span class="line"></span><br><span class="line"># å®šä¹‰æœç´¢å‚æ•°</span><br><span class="line">search_params = &#123;</span><br><span class="line">    &quot;nprobe&quot;: 10,</span><br><span class="line">    &quot;metric_type&quot;: &quot;L2&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œæœç´¢</span><br><span class="line">top_k = 1  # è¿”å›æœ€ç›¸ä¼¼çš„ä¸€ä¸ªç»“æœ</span><br><span class="line">results = client.search(collection_name, &quot;face_vector&quot;, query_vector, top_k, search_params)</span><br><span class="line"></span><br><span class="line"># æ‰“å°ç»“æœ</span><br><span class="line">for result in results:</span><br><span class="line">    for item in result:</span><br><span class="line">        print(f&quot;ç›¸ä¼¼åº¦: &#123;item.distance&#125;, å¯¹åº”å­—ç¬¦ä¸²: &#123;item.entity.get(&#x27;face_name&#x27;)[0]&#125;&quot;)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> connections <span class="keyword">as</span> milvus</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ– Milvus å®¢æˆ·ç«¯</span></span><br><span class="line">client = milvus.connect(<span class="string">&#x27;default&#x27;</span>, host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="string">&#x27;19530&#x27;</span>)</span><br><span class="line"></span><br><span class="line">collection_name = <span class="string">&quot;face_collection&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé›†åˆ</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> client.has_collection(collection_name):</span><br><span class="line">    client.create_collection(collection_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å‘é‡å­—æ®µçš„ç±»å‹</span></span><br><span class="line">fields = [</span><br><span class="line">    (<span class="string">&quot;face_vector&quot;</span>, <span class="string">&quot;float_vector&quot;</span>, <span class="number">128</span>),</span><br><span class="line">    (<span class="string">&quot;face_name&quot;</span>, <span class="string">&quot;text&quot;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’å…¥æ•°æ®</span></span><br><span class="line">data_to_insert = [</span><br><span class="line">    &#123;<span class="string">&quot;face_vector&quot;</span>: np.random.random(<span class="number">128</span>).tolist(), <span class="string">&quot;face_name&quot;</span>: <span class="string">&quot;Person1&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;face_vector&quot;</span>: np.random.random(<span class="number">128</span>).tolist(), <span class="string">&quot;face_name&quot;</span>: <span class="string">&quot;Person2&quot;</span>&#125;,</span><br><span class="line">]</span><br><span class="line">insert_result = client.insert(collection_name, fields, data_to_insert)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡ä¸€ä¸ªæŸ¥è¯¢å‘é‡</span></span><br><span class="line">query_vector = np.random.random(<span class="number">128</span>).tolist()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æœç´¢å‚æ•°</span></span><br><span class="line">search_params = &#123;</span><br><span class="line">    <span class="string">&quot;nprobe&quot;</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">&quot;metric_type&quot;</span>: <span class="string">&quot;L2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œæœç´¢</span></span><br><span class="line">top_k = <span class="number">1</span>  <span class="comment"># è¿”å›æœ€ç›¸ä¼¼çš„ä¸€ä¸ªç»“æœ</span></span><br><span class="line">results = client.search(collection_name, <span class="string">&quot;face_vector&quot;</span>, query_vector, top_k, search_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°ç»“æœ</span></span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ç›¸ä¼¼åº¦: <span class="subst">&#123;item.distance&#125;</span>, å¯¹åº”å­—ç¬¦ä¸²: <span class="subst">&#123;item.entity.get(<span class="string">&#x27;face_name&#x27;</span>)[<span class="number">0</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç†èµ„æº</span></span><br><span class="line">client.drop_collection(collection_name)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Milvus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Milvus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>36 Javaæ³¨è§£ &amp; åˆ‡é¢ &amp; åå°„</title>
      <link href="/2025/02/26/36%20Java%E6%B3%A8%E8%A7%A3%20&amp;%20%E5%88%87%E9%9D%A2%20&amp;%20%E5%8F%8D%E5%B0%84/"/>
      <url>/2025/02/26/36%20Java%E6%B3%A8%E8%A7%A3%20&amp;%20%E5%88%87%E9%9D%A2%20&amp;%20%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<h1 id="36-Javaæ³¨è§£-åˆ‡é¢-åå°„"><a href="#36-Javaæ³¨è§£-åˆ‡é¢-åå°„" class="headerlink" title="36 Javaæ³¨è§£ &amp; åˆ‡é¢ &amp; åå°„"></a>36 Javaæ³¨è§£ &amp; åˆ‡é¢ &amp; åå°„</h1><h2 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h2><h3 id="1-æ³¨è§£çš„æ¦‚å¿µ"><a href="#1-æ³¨è§£çš„æ¦‚å¿µ" class="headerlink" title="1.æ³¨è§£çš„æ¦‚å¿µ"></a>1.æ³¨è§£çš„æ¦‚å¿µ</h3><ol><li>æ³¨è§£æ˜¯ä¸€ç§å…ƒæ•°æ®å½¢å¼ã€‚å³æ³¨è§£æ˜¯å±äºJavaçš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œå’Œç±»ã€æ¥å£ã€æ•°ç»„ã€æšä¸¾ç±»ä¼¼ã€‚</li><li>æ³¨è§£ç”¨æ¥ä¿®é¥°ï¼Œç±»ã€æ–¹æ³•ã€å˜é‡ã€å‚æ•°ã€åŒ…ã€‚</li><li><strong>æ³¨è§£ä¸ä¼šå¯¹æ‰€ä¿®é¥°çš„ä»£ç äº§ç”Ÿç›´æ¥çš„å½±å“ã€‚</strong></li></ol><h3 id="2-æ³¨è§£çš„ä½¿ç”¨èŒƒå›´"><a href="#2-æ³¨è§£çš„ä½¿ç”¨èŒƒå›´" class="headerlink" title="2.æ³¨è§£çš„ä½¿ç”¨èŒƒå›´"></a>2.æ³¨è§£çš„ä½¿ç”¨èŒƒå›´</h3><blockquote><p>æ³¨è§£åˆè®¸å¤šç”¨æ³•ï¼Œå…¶ä¸­æœ‰ï¼š<strong>ä¸ºç¼–è¯‘å™¨æä¾›ä¿¡æ¯</strong> - æ³¨è§£èƒ½è¢«ç¼–è¯‘å™¨æ£€æµ‹åˆ°é”™è¯¯æˆ–æŠ‘åˆ¶è­¦å‘Šã€‚<strong>ç¼–è¯‘æ—¶å’Œéƒ¨ç½²æ—¶çš„å¤„ç†</strong> - è½¯ä»¶å·¥å…·èƒ½å¤„ç†æ³¨è§£ä¿¡æ¯ä»è€Œç”Ÿæˆä»£ç ï¼ŒXMLæ–‡ä»¶ç­‰ç­‰ã€‚<strong>è¿è¡Œæ—¶çš„å¤„ç†</strong> - æœ‰äº›æ³¨è§£åœ¨è¿è¡Œæ—¶èƒ½è¢«æ£€æµ‹åˆ°ã€‚ </p></blockquote><h3 id="3-å¦‚ä½•è‡ªå®šä¹‰æ³¨è§£"><a href="#3-å¦‚ä½•è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="3.å¦‚ä½•è‡ªå®šä¹‰æ³¨è§£"></a>3.å¦‚ä½•è‡ªå®šä¹‰æ³¨è§£</h3><p>æ³¨è§£å…¶å®å°±æ˜¯ä¸€ç§æ ‡è®°ï¼Œå¯ä»¥åœ¨ç¨‹åºä»£ç ä¸­çš„å…³é”®èŠ‚ç‚¹ï¼ˆç±»ã€æ–¹æ³•ã€å˜é‡ã€å‚æ•°ã€åŒ…ï¼‰ä¸Šæ‰“ä¸Šè¿™äº›æ ‡è®°ï¼Œç„¶åç¨‹åºåœ¨<strong>ç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶</strong>å¯ä»¥æ£€æµ‹åˆ°è¿™äº›æ ‡è®°ä»è€Œæ‰§è¡Œä¸€äº›ç‰¹æ®Šæ“ä½œã€‚å› æ­¤å¯ä»¥å¾—å‡ºè‡ªå®šä¹‰æ³¨è§£ä½¿ç”¨çš„åŸºæœ¬æµç¨‹ï¼š</p><p>ç¬¬ä¸€æ­¥ï¼Œå®šä¹‰æ³¨è§£â€”â€”ç›¸å½“äºå®šä¹‰æ ‡è®°ï¼›<br>ç¬¬äºŒæ­¥ï¼Œé…ç½®æ³¨è§£â€”â€”æŠŠæ ‡è®°æ‰“åœ¨éœ€è¦ç”¨åˆ°çš„ç¨‹åºä»£ç ä¸­ï¼›<br>ç¬¬ä¸‰æ­¥ï¼Œè§£ææ³¨è§£â€”â€”åœ¨ç¼–è¯‘æœŸæˆ–è¿è¡Œæ—¶æ£€æµ‹åˆ°æ ‡è®°ï¼Œå¹¶è¿›è¡Œç‰¹æ®Šæ“ä½œã€‚</p><h3 id="4-è‡ªå®šä¹‰æ³¨è§£Demo"><a href="#4-è‡ªå®šä¹‰æ³¨è§£Demo" class="headerlink" title="4.è‡ªå®šä¹‰æ³¨è§£Demo"></a>4.è‡ªå®šä¹‰æ³¨è§£Demo</h3><p>æ ¹æ®æˆ‘ä»¬æ—¥å¸¸å®šä¹‰ç±»æˆ–æ¥å£çš„ç»éªŒï¼Œåœ¨ç±»ä¸­æ— éæ˜¯è¦å®šä¹‰æ„é€ æ–¹æ³•ã€å±æ€§æˆ–ä¸€èˆ¬æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œåœ¨è‡ªå®šä¹‰æ³¨è§£ä¸­ï¼Œå…¶å®ç°éƒ¨åˆ†<strong>åªèƒ½å®šä¹‰</strong>ä¸€ä¸ªä¸œè¥¿ï¼š<strong>æ³¨è§£ç±»å‹å…ƒç´ ï¼ˆannotation type elementï¼‰</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MetaDsConfig &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åº”ç”¨ç¼–ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">appCode</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®æºæ“ä½œç¼–ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">actionCode</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;actionCode&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®šä¹‰æ³¨è§£ç±»å‹å…ƒç´ æ—¶éœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š<br>1.è®¿é—®ä¿®é¥°ç¬¦å¿…é¡»ä¸ºpublicï¼Œä¸å†™é»˜è®¤ä¸ºpublicï¼›</p><p>2.è¯¥å…ƒç´ çš„ç±»å‹åªèƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€Stringã€Classã€æšä¸¾ç±»å‹ã€æ³¨è§£ç±»å‹ï¼ˆä½“ç°äº†æ³¨è§£çš„åµŒå¥—æ•ˆæœï¼‰ä»¥åŠä¸Šè¿°ç±»å‹çš„ä¸€ä½æ•°ç»„ï¼›</p><p>3.è¯¥å…ƒç´ çš„åç§°ä¸€èˆ¬å®šä¹‰ä¸ºåè¯ï¼Œå¦‚æœæ³¨è§£ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œè¯·æŠŠåå­—èµ·ä¸ºvalueï¼ˆåé¢ä½¿ç”¨ä¼šå¸¦æ¥ä¾¿åˆ©æ“ä½œï¼‰ï¼›</p><p>4.()ä¸æ˜¯å®šä¹‰æ–¹æ³•å‚æ•°çš„åœ°æ–¹ï¼Œä¹Ÿä¸èƒ½åœ¨æ‹¬å·ä¸­å®šä¹‰ä»»ä½•å‚æ•°ï¼Œä»…ä»…åªæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¯­æ³•ï¼›</p><p>5.defaultä»£è¡¨é»˜è®¤å€¼ï¼Œå€¼å¿…é¡»å’Œç¬¬2ç‚¹å®šä¹‰çš„ç±»å‹ä¸€è‡´ï¼›</p><p>6.å¦‚æœæ²¡æœ‰é»˜è®¤å€¼ï¼Œä»£è¡¨åç»­ä½¿ç”¨æ³¨è§£æ—¶å¿…é¡»ç»™è¯¥ç±»å‹å…ƒç´ èµ‹å€¼ã€‚</p></blockquote><h3 id="5-å…ƒæ³¨è§£"><a href="#5-å…ƒæ³¨è§£" class="headerlink" title="5.å…ƒæ³¨è§£"></a>5.å…ƒæ³¨è§£</h3><p>å…ƒæ³¨è§£çš„ä½œç”¨å°±æ˜¯è´Ÿè´£æ³¨è§£å…¶ä»–æ³¨è§£ã€‚JAVA5å®šä¹‰çš„å…ƒæ³¨è§£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Target,</span><br><span class="line">@Retention,</span><br><span class="line">@Documented,</span><br><span class="line">@Inherited</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261952086.png" alt="image-20240625174231388"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261952779.png" alt="image-20240625174405304"></p><h2 id="Javaæ³¨è§£å¤„ç†å™¨"><a href="#Javaæ³¨è§£å¤„ç†å™¨" class="headerlink" title="Javaæ³¨è§£å¤„ç†å™¨"></a>Javaæ³¨è§£å¤„ç†å™¨</h2><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://blog.csdn.net/github_35180164/article/details/52055994#:~:text=%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%88Annotation,Processor%EF%BC%89%E6%98%AFjavac%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B7%A5%E5%85%B7%EF%BC%8C%E5%AE%83%E7%94%A8%E6%9D%A5%E5%9C%A8%E7%BC%96%E8%AF%91%E6%97%B6%E6%89%AB%E6%8F%8F%E5%92%8C%E5%A4%84%E7%90%86%E6%B3%A8%E8%A7%A3%EF%BC%88Annotation%EF%BC%89%E3%80%82">Javaæ³¨è§£å¤„ç†å™¨ä½¿ç”¨è¯¦è§£</a></p><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆç”³æ˜ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ï¼šæˆ‘ä»¬å¹¶ä¸è®¨è®ºé‚£äº›åœ¨è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰é€šè¿‡åå°„æœºåˆ¶è¿è¡Œå¤„ç†çš„æ³¨è§£ï¼Œè€Œæ˜¯è®¨è®ºåœ¨ç¼–è¯‘æ—¶ï¼ˆCompile timeï¼‰å¤„ç†çš„æ³¨è§£ã€‚</p><p>æ³¨è§£å¤„ç†å™¨ï¼ˆAnnotation Processorï¼‰æ˜¯<strong>javac</strong>çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒç”¨æ¥åœ¨ç¼–è¯‘æ—¶æ‰«æå’Œå¤„ç†æ³¨è§£ï¼ˆAnnotationï¼‰ã€‚ä½ å¯ä»¥å¯¹è‡ªå®šä¹‰æ³¨è§£ï¼Œå¹¶æ³¨å†Œç›¸åº”çš„æ³¨è§£å¤„ç†å™¨ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘å‡è®¾ä½ å·²ç»çŸ¥é“ä»€ä¹ˆæ˜¯æ³¨è§£ï¼Œå¹¶ä¸”çŸ¥é“æ€ä¹ˆç”³æ˜çš„ä¸€ä¸ªæ³¨è§£ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰æ³¨è§£ï¼Œä½ å¯ä»¥åœ¨è¿™<a href="http://docs.oracle.com/javase/tutorial/java/annotations/index.html">å®˜æ–¹æ–‡æ¡£</a>ä¸­å¾—åˆ°æ›´å¤šä¿¡æ¯ã€‚æ³¨è§£å¤„ç†å™¨åœ¨Java 5å¼€å§‹å°±æœ‰äº†ï¼Œä½†æ˜¯ä»Java 6ï¼ˆ2006å¹´12æœˆå‘å¸ƒï¼‰å¼€å§‹æ‰æœ‰å¯ç”¨çš„APIã€‚è¿‡äº†ä¸€äº›æ—¶é—´ï¼ŒJavaä¸–ç•Œæ‰æ„è¯†åˆ°æ³¨è§£å¤„ç†å™¨çš„å¼ºå¤§ä½œç”¨ï¼Œæ‰€ä»¥å®ƒåˆ°æœ€è¿‘å‡ å¹´æ‰æµè¡Œèµ·æ¥ã€‚</p><p>ä¸€ä¸ªæ³¨è§£çš„æ³¨è§£å¤„ç†å™¨ï¼Œä»¥Javaä»£ç ï¼ˆæˆ–è€…ç¼–è¯‘è¿‡çš„å­—èŠ‚ç ï¼‰ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆæ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯.javaæ–‡ä»¶ï¼‰ä½œä¸ºè¾“å‡ºã€‚è¿™å…·ä½“çš„å«ä¹‰ä»€ä¹ˆå‘¢ï¼Ÿä½ å¯ä»¥ç”ŸæˆJavaä»£ç ï¼è¿™äº›ç”Ÿæˆçš„Javaä»£ç æ˜¯åœ¨ç”Ÿæˆçš„.javaæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥ä½ ä¸èƒ½ä¿®æ”¹å·²ç»å­˜åœ¨çš„Javaç±»ï¼Œä¾‹å¦‚å‘å·²æœ‰çš„ç±»ä¸­æ·»åŠ æ–¹æ³•ã€‚è¿™äº›ç”Ÿæˆçš„Javaæ–‡ä»¶ï¼Œä¼šåŒå…¶ä»–æ™®é€šçš„æ‰‹åŠ¨ç¼–å†™çš„Javaæºä»£ç ä¸€æ ·è¢«<strong>javac</strong>ç¼–è¯‘ã€‚</p><h3 id="è™šå¤„ç†å™¨AbstractProcessor"><a href="#è™šå¤„ç†å™¨AbstractProcessor" class="headerlink" title="è™šå¤„ç†å™¨AbstractProcessor"></a>è™šå¤„ç†å™¨AbstractProcessor</h3><p>æ¯ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨éƒ½ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰å¿…è¦çœ‹çœ‹è¿™ä¸ªæŠ½è±¡ç±»æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProcessor</span> <span class="keyword">extends</span> <span class="title class_">AbstractProcessor</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ProcessingEnvironment env)</span>&#123; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annoations, RoundEnvironment env)</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">getSupportedAnnotationTypes</span><span class="params">()</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SourceVersion <span class="title function_">getSupportedSourceVersion</span><span class="params">()</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>init(ProcessingEnvironment env): **æ¯ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨ç±»éƒ½å¿…é¡»æœ‰ä¸€ä¸ªç©ºçš„æ„é€ å‡½æ•°ã€‚**ç„¶è€Œï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„init()æ–¹æ³•ï¼Œå®ƒä¼šè¢«æ³¨è§£å¤„ç†å·¥å…·è°ƒç”¨ï¼Œå¹¶è¾“å…¥ProcessingEnviromentå‚æ•°ã€‚ProcessingEnviromentæä¾›å¾ˆå¤šæœ‰ç”¨çš„å·¥å…·ç±»Elements, Typeså’ŒFilerã€‚åé¢æˆ‘ä»¬å°†çœ‹åˆ°è¯¦ç»†çš„å†…å®¹ã€‚</li><li><strong>process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env) : è¿™ç›¸å½“äºæ¯ä¸ªå¤„ç†å™¨çš„ä¸»å‡½æ•°main()ã€‚ä½ åœ¨è¿™é‡Œå†™ä½ çš„æ‰«æã€è¯„ä¼°å’Œå¤„ç†æ³¨è§£çš„ä»£ç ï¼Œä»¥åŠç”ŸæˆJavaæ–‡ä»¶ã€‚è¾“å…¥å‚æ•°RoundEnviromentï¼Œå¯ä»¥è®©ä½ æŸ¥è¯¢å‡ºåŒ…å«ç‰¹å®šæ³¨è§£çš„è¢«æ³¨è§£å…ƒç´ ã€‚åé¢æˆ‘ä»¬å°†çœ‹åˆ°è¯¦ç»†çš„å†…å®¹ã€‚</strong></li><li><strong>getSupportedAnnotationTypes():</strong> è¿™é‡Œä½ å¿…é¡»æŒ‡å®šï¼Œè¿™ä¸ªæ³¨è§£å¤„ç†å™¨æ˜¯æ³¨å†Œç»™å“ªä¸ªæ³¨è§£çš„ã€‚æ³¨æ„ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„é›†åˆï¼ŒåŒ…å«æœ¬å¤„ç†å™¨æƒ³è¦å¤„ç†çš„æ³¨è§£ç±»å‹çš„åˆæ³•å…¨ç§°ã€‚æ¢å¥è¯è¯´ï¼Œä½ åœ¨è¿™é‡Œå®šä¹‰ä½ çš„æ³¨è§£å¤„ç†å™¨æ³¨å†Œåˆ°å“ªäº›æ³¨è§£ä¸Šã€‚</li><li><strong>getSupportedSourceVersion():</strong> ç”¨æ¥æŒ‡å®šä½ ä½¿ç”¨çš„Javaç‰ˆæœ¬ã€‚é€šå¸¸è¿™é‡Œè¿”å›SourceVersion.latestSupported()ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æœ‰è¶³å¤Ÿçš„ç†ç”±åªæ”¯æŒJava 6çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥è¿”å›SourceVersion.RELEASE_6ã€‚æˆ‘æ¨èä½ ä½¿ç”¨å‰è€…ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>37 MinIO</title>
      <link href="/2025/02/26/37%20MinIO/"/>
      <url>/2025/02/26/37%20MinIO/</url>
      
        <content type="html"><![CDATA[<h1 id="37-MinIO"><a href="#37-MinIO" class="headerlink" title="37 MinIO"></a>37 MinIO</h1><p>å‚è€ƒèµ„æ–™</p><p>1. </p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>MinIO æ˜¯ä¸€ä¸ªåŸºäºApache License v2.0å¼€æºåè®®çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ã€‚å®ƒå…¼å®¹äºšé©¬é€ŠS3äº‘å­˜å‚¨æœåŠ¡æ¥å£ï¼Œéå¸¸é€‚åˆäºå­˜å‚¨å¤§å®¹é‡éç»“æ„åŒ–çš„æ•°æ®ï¼Œ<strong>ä¾‹å¦‚å›¾ç‰‡ã€è§†é¢‘ã€æ—¥å¿—æ–‡ä»¶ã€å¤‡ä»½æ•°æ®å’Œå®¹å™¨&#x2F;è™šæ‹Ÿæœºé•œåƒç­‰</strong>ï¼Œè€Œä¸€ä¸ªå¯¹è±¡æ–‡ä»¶å¯ä»¥æ˜¯ä»»æ„å¤§å°ï¼Œä»å‡ kbåˆ°æœ€å¤§5Tä¸ç­‰ã€‚</p><p>MinIOæ˜¯ä¸€ä¸ªéå¸¸è½»é‡çš„æœåŠ¡,å¯ä»¥å¾ˆç®€å•çš„å’Œå…¶ä»–åº”ç”¨çš„ç»“åˆï¼Œç±»ä¼¼ NodeJS, Redis æˆ–è€… MySQLã€‚</p><h3 id="çº åˆ ç›"><a href="#çº åˆ ç›" class="headerlink" title="çº åˆ ç›"></a>çº åˆ ç›</h3><p>Minioä½¿ç”¨çº åˆ ç erasure codeå’Œæ ¡éªŒå’Œchecksumæ¥ä¿æŠ¤æ•°æ®å…å—ç¡¬ä»¶æ•…éšœå’Œæ— å£°æ•°æ®æŸåã€‚ å³ä¾¿æ‚¨ä¸¢å¤±ä¸€åŠæ•°é‡ï¼ˆN&#x2F;2ï¼‰çš„ç¡¬ç›˜ï¼Œæ‚¨ä»ç„¶å¯ä»¥æ¢å¤æ•°æ®ã€‚</p><p> <strong>çº åˆ ç æ˜¯ä¸€ç§æ¢å¤ä¸¢å¤±å’ŒæŸåæ•°æ®çš„æ•°å­¦ç®—æ³•</strong>ï¼Œ Minioé‡‡ç”¨Reed-Solomon codeå°†å¯¹è±¡æ‹†åˆ†æˆN&#x2F;2æ•°æ®å’ŒN&#x2F;2 å¥‡å¶æ ¡éªŒå—ã€‚ è¿™å°±æ„å‘³ç€å¦‚æœæ˜¯12å—ç›˜ï¼Œä¸€ä¸ªå¯¹è±¡ä¼šè¢«åˆ†æˆ6ä¸ªæ•°æ®å—ã€6ä¸ªå¥‡å¶æ ¡éªŒå—ï¼Œä½ å¯ä»¥ä¸¢å¤±ä»»æ„6å—ç›˜ï¼ˆä¸ç®¡å…¶æ˜¯å­˜æ”¾çš„æ•°æ®å—è¿˜æ˜¯å¥‡å¶æ ¡éªŒå—ï¼‰ï¼Œä½ ä»å¯ä»¥ä»å‰©ä¸‹çš„ç›˜ä¸­çš„æ•°æ®è¿›è¡Œæ¢å¤ çº åˆ ç çš„å·¥ä½œåŸç†å’ŒRAIDæˆ–è€…å¤åˆ¶ä¸åŒï¼ŒåƒRAID6å¯ä»¥åœ¨æŸå¤±ä¸¤å—ç›˜çš„æƒ…å†µä¸‹ä¸ä¸¢æ•°æ®ï¼Œè€ŒMinioçº åˆ ç å¯ä»¥åœ¨ä¸¢å¤±ä¸€åŠçš„ç›˜çš„æƒ…å†µä¸‹ï¼Œä»å¯ä»¥ä¿è¯æ•°æ®å®‰å…¨ã€‚ è€Œä¸”Minioçº åˆ ç æ˜¯ä½œç”¨åœ¨å¯¹è±¡çº§åˆ«ï¼Œå¯ä»¥ä¸€æ¬¡æ¢å¤ä¸€ä¸ªå¯¹è±¡ï¼Œè€ŒRAIDæ˜¯ä½œç”¨åœ¨å·çº§åˆ«ï¼Œæ•°æ®æ¢å¤æ—¶é—´å¾ˆé•¿ã€‚ Minioå¯¹æ¯ä¸ªå¯¹è±¡å•ç‹¬ç¼–ç ï¼Œå­˜å‚¨æœåŠ¡ä¸€ç»éƒ¨ç½²ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ä¸éœ€è¦æ›´æ¢ç¡¬ç›˜æˆ–è€…ä¿®å¤ã€‚Minioçº åˆ ç çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†æ€§èƒ½å’Œå°½å¯èƒ½çš„ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿã€‚</p><h2 id="MinIOå®‰è£…"><a href="#MinIOå®‰è£…" class="headerlink" title="MinIOå®‰è£…"></a>MinIOå®‰è£…</h2><h3 id="Windowsç¯å¢ƒMinIOå®‰è£…"><a href="#Windowsç¯å¢ƒMinIOå®‰è£…" class="headerlink" title="Windowsç¯å¢ƒMinIOå®‰è£…"></a>Windowsç¯å¢ƒMinIOå®‰è£…</h3><h4 id="å®˜ç½‘ä¸‹è½½"><a href="#å®˜ç½‘ä¸‹è½½" class="headerlink" title="å®˜ç½‘ä¸‹è½½"></a>å®˜ç½‘ä¸‹è½½</h4><p>å®˜ç½‘åœ°å€ï¼š<a href="https://min.io/">MinIO | S3 &amp; Kubernetes Native Object Storage for AI</a></p><h4 id="åˆ›å»ºæ–‡ä»¶å¤¹"><a href="#åˆ›å»ºæ–‡ä»¶å¤¹" class="headerlink" title="åˆ›å»ºæ–‡ä»¶å¤¹"></a>åˆ›å»ºæ–‡ä»¶å¤¹</h4><p>ä¸‹è½½å¥½ä¸éœ€è¦ç‚¹å‡»exeæ–‡ä»¶ï¼Œåˆ›å»ºå¥½æ–‡ä»¶å¤¹åï¼ŒæŠŠä¸‹è½½å¥½çš„æ–‡ä»¶ç§»åŠ¨åˆ°ä½ åˆ›å»ºå¥½çš„ç›®å½•ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261952601.png" alt="image-20240627152606796"></p><h4 id="ç®¡ç†å‘˜å‘½ä»¤è¡Œè¿è¡Œ"><a href="#ç®¡ç†å‘˜å‘½ä»¤è¡Œè¿è¡Œ" class="headerlink" title="ç®¡ç†å‘˜å‘½ä»¤è¡Œè¿è¡Œ"></a>ç®¡ç†å‘˜å‘½ä»¤è¡Œè¿è¡Œ</h4><p>ä»¥ç®¡ç†å‘˜çš„èº«ä»½æ‰“å¼€CMDï¼ŒCDåˆ°ä½ åˆšåˆšåˆ›å»ºçš„minio.exeæ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ä¸‹ã€‚è¿è¡Œå‘½ä»¤ï¼š</p><p>è¿™æ˜¯åœ¨è®¾ç½®ä½ MinIOçš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setx MINIO_ROOT_USER admin</span><br><span class="line">setx MINIO_ROOT_PASSWORD admin1234</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261952634.png" alt="image-20240627152627594"></p><h4 id="åˆ›å»ºMinIOå­˜å‚¨æ–‡ä»¶ç›®å½•"><a href="#åˆ›å»ºMinIOå­˜å‚¨æ–‡ä»¶ç›®å½•" class="headerlink" title="åˆ›å»ºMinIOå­˜å‚¨æ–‡ä»¶ç›®å½•"></a>åˆ›å»ºMinIOå­˜å‚¨æ–‡ä»¶ç›®å½•</h4><p>åœ¨æœ¬åœ°åˆ›å»ºMinIOå­˜å‚¨æ–‡ä»¶çš„ç›®å½•ï¼Œä¾‹å¦‚ï¼šd:\assets\OB-Storageï¼›</p><h4 id="MinIOå¯åŠ¨"><a href="#MinIOå¯åŠ¨" class="headerlink" title="MinIOå¯åŠ¨"></a>MinIOå¯åŠ¨</h4><p>ç»§ç»­åœ¨è¯¥CMDä¸­è¿è¡Œå‘½ä»¤å¯åŠ¨MinIOï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.\minio.exe server d:\assets\OB-Storage  --console-address &quot;:9001&quot; --address &quot;:9000&quot; </span><br><span class="line"></span><br><span class="line">.\minio.exe server D:\CodeFolder\ToolFolder\MinIO\data  --console-address &quot;:9001&quot; --address &quot;:9000&quot; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261952858.png" alt="image-20240627152800403"></p><h4 id="MinIOä½¿ç”¨"><a href="#MinIOä½¿ç”¨" class="headerlink" title="MinIOä½¿ç”¨"></a>MinIOä½¿ç”¨</h4><p>æ§åˆ¶å°ï¼š<a href="http://localhost:9001/">http://localhost:9001</a></p><p>åˆ›å»ºBucketï¼šã€é¡¹ç›®åã€‘-[æ¨¡å—å]-buck</p><p>åˆ›å»ºAcessKeyå’Œsecret</p><h4 id="MinIOç™»å½•"><a href="#MinIOç™»å½•" class="headerlink" title="MinIOç™»å½•"></a>MinIOç™»å½•</h4><p>Minioçš„é»˜è®¤è´¦å·å¯†ç è¿›è¡Œç™»å½•ï¼Œå¯¹åº”çš„è´¦å·å¯†ç éƒ½æ˜¯minioadmin</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261952924.png" alt="image-20240627161303822"></p><h2 id="SpringBooté›†æˆMinIO"><a href="#SpringBooté›†æˆMinIO" class="headerlink" title="SpringBooté›†æˆMinIO"></a>SpringBooté›†æˆMinIO</h2><h3 id="Nacosé…ç½®"><a href="#Nacosé…ç½®" class="headerlink" title="Nacosé…ç½®"></a>Nacosé…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">baas:</span><br><span class="line">  client:</span><br><span class="line">    enabled: true</span><br><span class="line">  storage:</span><br><span class="line">    enabled: true</span><br><span class="line">    endpoint: http://192.168.0.120:9000</span><br><span class="line">    access-key: M2vezlAtUmtcNIqc58MD</span><br><span class="line">    secret-key: g0CzJtIpEpKZ8UoRKUBszQfcHSpQfXhvNF39Suiv</span><br><span class="line">    bucket-name: space-intell-gas-bff-buck</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">space:</span><br><span class="line">  board:</span><br><span class="line">    gov:</span><br><span class="line">      biz:</span><br><span class="line">        resourceUrlPrefix: http://192.168.0.120:9000</span><br><span class="line">        resourceBucket: space-intell-gas-bff-buck</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„é…ç½®æ˜¯å®ä¹ é¡¹ç›®ä¸­çš„é…ç½®ã€‚</p><h3 id="ä¾èµ–å¼•å…¥"><a href="#ä¾èµ–å¼•å…¥" class="headerlink" title="ä¾èµ–å¼•å…¥"></a>ä¾èµ–å¼•å…¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- MinIO --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.minio&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;minio&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.2.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Hutool --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.8.18&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MinIO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>40 IDEA</title>
      <link href="/2025/02/26/40%20IDEA/"/>
      <url>/2025/02/26/40%20IDEA/</url>
      
        <content type="html"><![CDATA[<h1 id="40-IDEA"><a href="#40-IDEA" class="headerlink" title="40 IDEA"></a>40 IDEA</h1><h2 id="JAVAæ³¨è§£"><a href="#JAVAæ³¨è§£" class="headerlink" title="JAVAæ³¨è§£"></a>JAVAæ³¨è§£</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261954064.png" alt="image-20240701100256718"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line">* @Description </span><br><span class="line">$Param$</span><br><span class="line">$returns$</span><br><span class="line">* @Author yaoHui</span><br><span class="line">* @Date $date$</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261954785.png" alt="image-20240701100340538"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groovyScript(&quot;if(\&quot;$&#123;_1&#125;\&quot;.length() == 2) &#123;return &#x27;&#x27;;&#125; else &#123;def result=&#x27;&#x27;; def params=\&quot;$&#123;_1&#125;\&quot;.replaceAll(&#x27;[\\\\[|\\\\]|\\\\s]&#x27;, &#x27;&#x27;).split(&#x27;,&#x27;).toList();for(i = 0; i &lt; params.size(); i++) &#123;if(i==0)&#123;result+=&#x27;* @param &#x27; + params[i] + &#x27;  &#x27;&#125;else&#123;result+=&#x27;\\n&#x27; + &#x27; * @param &#x27; + params[i] + &#x27;  &#x27;&#125;&#125;; return result;&#125;&quot;, methodParameters()); </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groovyScript(&quot;def returnType = \&quot;$&#123;_1&#125;\&quot;; def result = &#x27;* @return &#123;@link &#x27; + returnType + &#x27; &#125;&#x27;; return result;&quot;, methodReturnType()); </span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261954353.png" alt="image-20240701100518078"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#if ($&#123;PACKAGE_NAME&#125; &amp;&amp; $&#123;PACKAGE_NAME&#125; != &quot;&quot;)package $&#123;PACKAGE_NAME&#125;;#end</span><br><span class="line">#parse(&quot;File Header.java&quot;)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* @FileName $&#123;NAME&#125;</span><br><span class="line">* @Description </span><br><span class="line">* @Author yaoHui</span><br><span class="line">* @date $&#123;YEAR&#125;-$&#123;MONTH&#125;-$&#123;DAY&#125;</span><br><span class="line">**/</span><br><span class="line">public class $&#123;NAME&#125; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261954625.png" alt="image-20240701100559862"></p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>46 Spring Security</title>
      <link href="/2025/02/26/46%20Spring%20Security/"/>
      <url>/2025/02/26/46%20Spring%20Security/</url>
      
        <content type="html"><![CDATA[<h1 id="46-Spring-Security"><a href="#46-Spring-Security" class="headerlink" title="46 Spring Security"></a>46 Spring Security</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><p><a href="https://blog.csdn.net/lht964249279/article/details/122757658">ã€SpringBootã€‘SpringBootâ€”â€”Spring Securityå®‰å…¨æ¡†æ¶</a></p></li><li><p><a href="https://springdoc.cn/spring-security/">Spring Security ä¸­æ–‡æ–‡æ¡£</a></p></li><li><p><a href="https://www.cnblogs.com/dw3306/p/12751373.html">Spring Securityä½¿ç”¨è¯¦è§£ï¼ˆåŸºæœ¬ç”¨æ³• ï¼‰ </a></p></li><li></li></ol><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Spring Securityæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªå®‰å…¨æ¡†æ¶ï¼Œå®ƒè‡´åŠ›äºåº”ç”¨çš„ä¸¤ä¸ªæ–¹é¢ï¼š<strong>è®¤è¯</strong>å’Œ<strong>æˆæƒ</strong>ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯éªŒè¯ä½ æ˜¯è°ï¼Ÿå’Œä½ æ˜¯å¦æœ‰æƒé™è®¿é—®è¿™ä¸ªèµ„æºï¼ˆè§’è‰²ï¼‰ã€‚</p><p>å®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ã€é«˜åº¦è‡ªå®šä¹‰çš„è®¤è¯å’Œè®¿é—®æ§åˆ¶æ¡†æ¶ã€‚å…¶æ ¸å¿ƒå°±æ˜¯ä¸€ç»„è¿‡æ»¤å™¨é“¾ï¼Œé¡¹ç›®å¯åŠ¨åä¼šè‡ªåŠ¨é…ç½®ã€‚</p><p>åœ¨æ¥è§¦Spring Securityä¹‹å‰æˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ç»„è¿‡æ»¤å™¨è¿‡æ»¤æ‰æ— ç™»å½•çŠ¶æ€çš„è¯·æ±‚å’Œä¸€äº›éæ³•è¯·æ±‚ï¼Œè€ŒSpring Securityå°±æ˜¯å°†è¿™äº›åŠŸèƒ½å°è£…å¥½äº†ï¼Œæ— éœ€å†é‡å¤ä¹¦å†™ã€‚</p><p><img src="/assets/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAc2hlbuWtkOaAoQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center.png" alt="img"></p><p>å…¶æ¶æ„å›¾å¦‚ä¸Šæ‰€ç¤ºï¼Œåœ¨è¿™äº›è¿‡æ»¤å™¨ä¸­æœ€å…³é”®çš„å°±æ˜¯Basic Authentication Filterï¼Œè¯¥è¿‡æ»¤å™¨ç”¨æ¥éªŒè¯å½“å‰ç”¨æˆ·çš„èº«ä»½ä¹Ÿå°±æ˜¯è§’è‰²ï¼Œå½“å‰ç”¨æˆ·å…·æœ‰ä»€ä¹ˆæƒé™ã€‚</p><h2 id="Spring-Security-Demo"><a href="#Spring-Security-Demo" class="headerlink" title="Spring Security Demo"></a>Spring Security Demo</h2><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://github.com/echisan/springboot-jwt-demo/blob/master/blog_content.md">https://github.com/echisan/springboot-jwt-demo/blob/master/blog_content.md</a></p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>åˆ›å»ºä¸€ä¸ªæ–°å·¥ç¨‹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ€è€ƒä¸€ä¸‹æˆ‘ä»¬æ¥ä¸‹æ¥éœ€è¦çš„ä¸€äº›æ­¥éª¤ï¼Œéœ€è¦åšä»€ä¹ˆï¼Œæ€ä¹ˆåšã€‚</p><ul><li>æ­å»ºspringbootå·¥ç¨‹</li><li>å¯¼å…¥springSecurityè·Ÿjwtçš„ä¾èµ–</li><li>ç”¨æˆ·çš„å®ä½“ç±»</li><li>daoå±‚</li><li>serviceå±‚ï¼ˆçœŸæ­£å¼€å‘æ—¶å†å†™ï¼Œè¿™é‡Œå°±ç›´æ¥è°ƒç”¨daoå±‚æ“ä½œæ•°æ®åº“ï¼‰</li><li>å®ç°UserDetailsServiceæ¥å£</li><li>å®ç°UserDetailsæ¥å£</li><li>éªŒè¯ç”¨æˆ·ç™»å½•ä¿¡æ¯çš„æ‹¦æˆªå™¨</li><li>éªŒè¯ç”¨æˆ·æƒé™çš„æ‹¦æˆªå™¨</li><li>springSecurityé…ç½®</li><li>è®¤è¯çš„Controllerä»¥åŠæµ‹è¯•çš„controller</li><li>æµ‹è¯•</li></ul><h3 id="é…ç½®æ‹¦æˆªå™¨"><a href="#é…ç½®æ‹¦æˆªå™¨" class="headerlink" title="é…ç½®æ‹¦æˆªå™¨"></a>é…ç½®æ‹¦æˆªå™¨</h3><p>åœ¨spring-securityä¸­éœ€è¦å®ç°ä¸¤ä¸ªè¿‡æ»¤å™¨ï¼Œä¸€æ˜¯ç”¨æˆ·éªŒè¯ï¼Œç¬¬äºŒæ˜¯é‰´æƒã€‚ã€‚ä½¿ç”¨<code>JWTAuthenticationFilter</code>å»è¿›è¡Œç”¨æˆ·è´¦å·çš„éªŒè¯ï¼Œä½¿ç”¨<code>JWTAuthorizationFilter</code>å»è¿›è¡Œç”¨æˆ·æƒé™çš„éªŒè¯ã€‚</p><p><strong>å‚è€ƒ17 Spring Cloud Gateway</strong></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>38 Spring</title>
      <link href="/2025/02/26/38%20Spring/"/>
      <url>/2025/02/26/38%20Spring/</url>
      
        <content type="html"><![CDATA[<h1 id="38-Spring"><a href="#38-Spring" class="headerlink" title="38 Spring"></a>38 Spring</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/weixin_44207403/article/details/106736102?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171955750516800182772377%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171955750516800182772377&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-106736102-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=Spring&spm=1018.2226.3001.4187">Spring-å…¨é¢è¯¦è§£ï¼ˆå­¦ä¹ æ€»ç»“ï¼‰</a></li></ol><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>Springç†å¿µ : ä½¿ç°æœ‰æŠ€æœ¯æ›´åŠ å®ç”¨ . æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤§æ‚çƒ© , æ•´åˆç°æœ‰çš„æ¡†æ¶æŠ€æœ¯ã€‚</p><p><strong>Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶åè½¬(IoC)å’Œé¢å‘åˆ‡é¢(AOP)çš„å®¹å™¨ï¼ˆæ¡†æ¶ï¼‰ã€‚</strong></p><h3 id="IOCæœ¬è´¨"><a href="#IOCæœ¬è´¨" class="headerlink" title="IOCæœ¬è´¨"></a>IOCæœ¬è´¨</h3><p>IOCå…¨ç§°ï¼šæ§åˆ¶åè½¬**(Inversion of Control)**ï¼Œ<strong>æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼ŒDI(ä¾èµ–æ³¨å…¥)æ˜¯å®ç°IoCçš„ä¸€ç§æ–¹æ³•</strong>ï¼Œä¹Ÿæœ‰äººè®¤ä¸ºDIåªæ˜¯IoCçš„å¦ä¸€ç§è¯´æ³•ã€‚æ²¡æœ‰IoCçš„ç¨‹åºä¸­ , æˆ‘ä»¬ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ , å¯¹è±¡çš„åˆ›å»ºä¸å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»å®Œå…¨ç¡¬ç¼–ç åœ¨ç¨‹åºä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºç”±ç¨‹åºè‡ªå·±æ§åˆ¶ï¼Œæ§åˆ¶åè½¬åå°†å¯¹è±¡çš„åˆ›å»ºè½¬ç§»ç»™ç¬¬ä¸‰æ–¹ï¼Œä¸ªäººè®¤ä¸ºæ‰€è°“æ§åˆ¶åè½¬å°±æ˜¯ï¼šè·å¾—ä¾èµ–å¯¹è±¡çš„æ–¹å¼åè½¬äº†ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œç°åœ¨æœ‰ä¸€ä¸ªæ¥å£UserDaoå’Œä¸€ä¸ªå®ç°ç±»UserDaoImplï¼Œæœ‰ä¸€ä¸ªUserServiceImplæ¥å£å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoMySqlImpl</span>();</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">       userDao.getUser();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç°åœ¨å¦‚æœprivate UserDao userDao &#x3D; new UserDaoMySqlImpl();éœ€è¦æ›´æ”¹æˆå…¶ä»–çš„å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨è¿™ä¸ªç±»ä¸­è¿›è¡Œæ›´æ”¹ï¼Œå¦‚æœæˆ‘ä»¬è¿™æ ·æ›´æ”¹å°±ä¼šé™ä½è€¦åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">   <span class="comment">// åˆ©ç”¨setå®ç°</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">       userDao.getUser();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œéœ€è¦è°ƒç”¨å¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨è€…æ‰‹åŠ¨æ¥åˆ›å»ºè¢«è°ƒç”¨è€…çš„å®ä¾‹ï¼Œå³å¯¹è±¡æ˜¯ç”±è°ƒç”¨è€…newå‡ºæ¥çš„ã€‚ä½†æ˜¯åœ¨Springæ¡†æ¶ä¸­ï¼Œåˆ›å»ºå¯¹è±¡çš„å·¥ä½œä¸å†ç”±è°ƒç”¨è€…æ¥å®Œæˆï¼Œè€Œæ˜¯äº¤ç»™IOCå®¹å™¨æ¥åˆ›å»ºï¼Œå†æ¨é€ç»™è°ƒç”¨è€…ï¼Œæ•´ä¸ªæµç¨‹å®Œæˆåè½¬ï¼Œæ‰€ä»¥æ˜¯æ§åˆ¶åè½¬ã€‚</p><h3 id="Beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Beançš„ç”Ÿå‘½å‘¨æœŸ"></a>Beançš„ç”Ÿå‘½å‘¨æœŸ</h3><p>è¿™ä¸ªæ¦‚å¿µåœ¨é¢è¯•ä¸­ç»å¸¸è¢«é¢è¯•å®˜è¯¢é—®ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜è¿™ä¸ªBeanåœ¨Springä¸­çš„ç”Ÿç”Ÿæ­»æ­»éå¸¸é‡è¦ï¼Œè€Œä¸”äº†è§£Beanæ˜¯å¦‚ä½•åˆ›å»ºå’Œå¦‚ä½•é”€æ¯çš„ï¼Œå¯¹äºæˆ‘ä»¬ç†è§£Springæ¥è¯´ä¹Ÿæ˜¯éå¸¸æœ‰ç›Šã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥Springçš„ä¸–ç•Œæ¥çœ‹çœ‹è¿™ä¸ªä¸–ç•Œæœ€é‡è¦çš„Beançš„ä¸€ç”Ÿã€‚</p><p>å…ˆçœ‹ä¸€å¼ å›¾ï¼Œè¿™å°±æ˜¯Beançš„ä¸€ç”Ÿã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261953130.png" alt="image-20241013185647984"></p><p>æˆ‘ä»¬åˆçœ‹ä¸æ˜è§‰å‰ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹èµ°ã€‚</p><p>æˆ‘ä»¬åœ¨äº†è§£ä¸€ä¸ªäººçš„ä¸€ç”Ÿæ—¶ï¼Œä¼šä»ä»–ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿï¼Œä»€ä¹ˆæ—¶å€™æ¥æ”¶äº†æ•™è‚²ï¼Œä»€ä¹ˆæ—¶å€™å»ä¸–æ¥å¤§è‡´äº†è§£ä»–çš„ä¸€ç”Ÿã€‚å¯¹äºBeanæ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨æ•´ä½“ï¼Œä¸éœ€è¦è¿‡å¤šçº ç»“ç»†èŠ‚ï¼Œçº ç»“è¿‡å¤šçš„ç»†èŠ‚ä¼šè®©æˆ‘ä»¬å¯¹Beançš„äº†è§£æ¨¡ç³Šã€‚</p><h4 id="å®ä¾‹åŒ–ï¼ˆå‡ºç”Ÿå•¦ï¼‰"><a href="#å®ä¾‹åŒ–ï¼ˆå‡ºç”Ÿå•¦ï¼‰" class="headerlink" title="å®ä¾‹åŒ–ï¼ˆå‡ºç”Ÿå•¦ï¼‰"></a>å®ä¾‹åŒ–ï¼ˆå‡ºç”Ÿå•¦ï¼‰</h4><p>åœ¨Springå®¹å™¨ä¹Ÿå°±æ˜¯IoCå®¹å™¨å¯åŠ¨ä¹‹åï¼Œå°±ä¼šåˆ°å¤„å¯»æ‰¾éœ€è¦å‡ºç”Ÿçš„Beanã€‚è¿™æ—¶å€™çš„Beanå°±æ˜¯ä¸€ä¸ªåˆšåˆšé™ä¸´è¿™ä¸ªä¸–ç•Œçš„å©´å„¿ï¼Œå®ƒåœ¨è¿™ä¸ªä¸–ç•Œæœ‰äº†å®ƒçš„ä½ç½®ï¼Œä½†æ˜¯å®ƒçš„èº«ä»½å’Œå®ƒé•¿å¤§å·¥ä½œéœ€è¦çš„è¿˜æ²¡æœ‰å‡†å¤‡å°±ç»ªã€‚</p><p>åˆ†é…åœ°å€å†…å­˜ç©ºé—´ã€‚</p><h4 id="è®¾ç½®å¯¹è±¡å±æ€§ï¼ˆå‡ºç”Ÿè¯æ˜ï¼‰"><a href="#è®¾ç½®å¯¹è±¡å±æ€§ï¼ˆå‡ºç”Ÿè¯æ˜ï¼‰" class="headerlink" title="è®¾ç½®å¯¹è±¡å±æ€§ï¼ˆå‡ºç”Ÿè¯æ˜ï¼‰"></a>è®¾ç½®å¯¹è±¡å±æ€§ï¼ˆå‡ºç”Ÿè¯æ˜ï¼‰</h4><p>ä¸€ä¸ªäººå‡ºç”Ÿä¹‹åï¼Œéœ€è¦ç»™ä»–èµ·åå­—ã€èµ‹äºˆèº«ä»½ï¼ˆèº«ä»½è¯å·ç ï¼‰ï¼Œä»¥åŠå…¶ä»–é‡è¦ä¿¡æ¯ï¼ˆæ¯”å¦‚å®¶åº­èƒŒæ™¯ï¼‰ã€‚è¿™ä¸ªé˜¶æ®µå°±åƒäººçš„<strong>åŸºç¡€èº«ä»½ä¿¡æ¯çš„å»ºç«‹</strong>ã€‚</p><p>åœ¨å®ä¾‹åŒ–ä¹‹åï¼ŒSpringä¼šå¯¹Beanè¿›è¡Œå±æ€§èµ‹å€¼ã€‚è¿™ä¸€æ­¥åŒ…æ‹¬ä¾èµ–æ³¨å…¥ï¼ŒæŠŠBeanéœ€è¦çš„èµ„æºå’Œä¾èµ–ï¼ˆæ¯”å¦‚å…¶ä»–Beanã€æ•°æ®åº“è¿æ¥ç­‰ï¼‰èµ‹å€¼ç»™å®ƒã€‚</p><p>å¯¹å±æ€§è¿›è¡Œèµ‹å€¼ã€‚</p><h4 id="åˆå§‹åŒ–ï¼ˆæ¥æ”¶æ•™è‚²ï¼Œå‡†å¤‡å·¥ä½œï¼‰"><a href="#åˆå§‹åŒ–ï¼ˆæ¥æ”¶æ•™è‚²ï¼Œå‡†å¤‡å·¥ä½œï¼‰" class="headerlink" title="åˆå§‹åŒ–ï¼ˆæ¥æ”¶æ•™è‚²ï¼Œå‡†å¤‡å·¥ä½œï¼‰"></a>åˆå§‹åŒ–ï¼ˆæ¥æ”¶æ•™è‚²ï¼Œå‡†å¤‡å·¥ä½œï¼‰</h4><p>è¿™ä¸€æ­¥åœ¨æ­£å¼æ­¥å…¥èŒåœºä¹‹å‰ï¼Œéœ€è¦å‡†å¤‡ä¸€äº›æŠ€èƒ½ï¼Œè¿™ä¸€æ­¥ä¹Ÿå°±æ˜¯åˆå§‹åŒ–ã€‚åˆå§‹åŒ–åˆ†å¾ˆå¤šæ­¥ï¼Œè¿™ä¹Ÿæ­£å¸¸ï¼Œæˆ‘ä»¬è¿˜å¾—è¯»å°å­¦ã€ä¸­å­¦ã€å¤§å­¦å‘¢ã€‚</p><p>æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥çœ‹çœ‹å…¶ä¸­çš„æµç¨‹ã€‚</p><h5 id="æ£€æŸ¥Awareç›¸å…³æ¥å£å¹¶è®¾ç½®ç›¸å…³ä¾èµ–"><a href="#æ£€æŸ¥Awareç›¸å…³æ¥å£å¹¶è®¾ç½®ç›¸å…³ä¾èµ–" class="headerlink" title="æ£€æŸ¥Awareç›¸å…³æ¥å£å¹¶è®¾ç½®ç›¸å…³ä¾èµ–"></a>æ£€æŸ¥Awareç›¸å…³æ¥å£å¹¶è®¾ç½®ç›¸å…³ä¾èµ–</h5><p><code>Aware</code>æ¥å£çš„ä½œç”¨æ˜¯è®©Beanæ„ŸçŸ¥Springå®¹å™¨çš„æŸäº›ç‰¹æ€§ï¼Œå¹¶åœ¨å¿…è¦æ—¶è·å–Springåº•å±‚ç»„ä»¶çš„å¼•ç”¨ã€‚è¿™ç§æœºåˆ¶éå¸¸çµæ´»ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨éœ€è¦æ—¶æ›´å¥½åœ°ä¸Springç¯å¢ƒäº¤äº’ï¼Œä½†è¦æ³¨æ„è¿‡åº¦ä½¿ç”¨è¿™äº›æ¥å£å¯èƒ½ä¼šå¢åŠ ä»£ç çš„è€¦åˆæ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> MyBeanApplicationContextAware</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-13</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanApplicationContextAware</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">        log.error(<span class="string">&quot;ApplicationContextAware is running&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">displayUserServiceBean</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> applicationContext.getBean(UserService.class);</span><br><span class="line">        userService.testApplicationContextAware();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="BeanPostProcessorå‰ç½®å¤„ç†"><a href="#BeanPostProcessorå‰ç½®å¤„ç†" class="headerlink" title="BeanPostProcessorå‰ç½®å¤„ç†"></a>BeanPostProcessorå‰ç½®å¤„ç†</h5><p><strong><code>BeanPostProcessor</code></strong> å…è®¸æˆ‘ä»¬åœ¨Springç®¡ç†çš„Beançš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œè¿™ç§æœºåˆ¶ä½¿å¾—æˆ‘ä»¬å¯ä»¥éå¸¸çµæ´»åœ°ç®¡ç†å’Œæ‰©å±•Beançš„è¡Œä¸ºã€‚</p><p>å¸¸è§çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬æ—¥å¿—è®°å½•ã€åŠ¨æ€ä»£ç†ã€ä»¥åŠæŸäº›Beançš„ç‰¹æ®Šå¤„ç†ã€‚</p><p>åœ¨æˆ‘ä»¬SSICé¡¹ç›®ä¸­ï¼Œå…¶ä¸­è‡ªå®šä¹‰çš„HuiMQä¸­ï¼Œæ¶ˆè´¹è€…ä¼šéœ€è¦è¯·æ±‚HuiMQå¾—åˆ°æ¶ˆæ¯ï¼Œéœ€è¦å¾—åˆ°æ¶ˆæ¯çš„æ–¹æ³•ä¼šè¢«@HuiListeneræ³¨è§£æ ‡æ³¨ã€‚è€Œæˆ‘ä»¬éœ€è¦çŸ¥é“å½“å‰æ‰€æœ‰Beanä¸­å“ªäº›æ–¹æ³•æ˜¯è¢«è¯¥æ³¨è§£æ ‡è®°çš„ï¼Œè¢«è¯¥æ³¨è§£æ ‡è®°çš„éœ€è¦åŠ å…¥ä¸€ä¸ªå¸¦æ¥å—æ¶ˆæ¯çš„æ–¹æ³•é›†åˆä¸­ï¼Œåç»­å°†ä¼šé€šè¿‡åå°„æ¥æ‰§è¡Œè¯¥æ–¹æ³•ã€‚</p><p>è¿™å°±æ˜¯ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> HuiListenerAnnotationBeanPostProcessor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuiListenerAnnotationBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">HuiListenerRegistry</span> <span class="variable">huiListenerRegistry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HuiListenerRegistry</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">huiListenerFlag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> åœ¨ bean çš„åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ <span class="doctag">@PostConstruct</span> æ³¨è§£çš„æ–¹æ³•æˆ– init-method æŒ‡å®šçš„æ–¹æ³•ï¼‰ä¹‹å‰è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> Object &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessBeforeInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> åœ¨ bean çš„åˆå§‹åŒ–æ–¹æ³•ä¹‹åè°ƒç”¨ã€‚æŸ¥çœ‹å½“å‰çš„beanæ˜¯å¦å­˜åœ¨è¢«HuiListeneræ³¨è§£è¿‡çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> Object &#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">        Method[] methods = bean.getClass().getMethods();</span><br><span class="line">        <span class="keyword">for</span>(Method method : methods)&#123;</span><br><span class="line">            <span class="keyword">if</span>(method.isAnnotationPresent(HuiListener.class))&#123;</span><br><span class="line">                processHuiListener(method,bean);</span><br><span class="line">                huiListenerFlag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessAfterInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processHuiListener</span><span class="params">(Method method,Object bean)</span>&#123;</span><br><span class="line">        <span class="type">HuiListener</span> <span class="variable">huiListener</span> <span class="operator">=</span> method.getAnnotation(HuiListener.class);</span><br><span class="line">        <span class="type">HuiListenerEndpoint</span> <span class="variable">huiListenerEndpoint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HuiListenerEndpoint</span>();</span><br><span class="line">        huiListenerEndpoint.setBean(bean);</span><br><span class="line">        huiListenerEndpoint.setMethod(method);</span><br><span class="line">        huiListenerRegistry.registerListenerEndpoint(huiListener.queueName(),huiListenerEndpoint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="æ˜¯å¦å®ç°InitializingBeanæ¥å£"><a href="#æ˜¯å¦å®ç°InitializingBeanæ¥å£" class="headerlink" title="æ˜¯å¦å®ç°InitializingBeanæ¥å£"></a>æ˜¯å¦å®ç°InitializingBeanæ¥å£</h5><p><code>InitializingBean</code>æ¥å£çš„<code>afterPropertiesSet()</code>æ–¹æ³•åªä¼šåœ¨å®ç°è¯¥æ¥å£çš„ç‰¹å®šBeanç±»çš„å®ä¾‹ä¸­æ‰§è¡Œä¸€æ¬¡ã€‚å¯¹äºå…¶ä»–æ²¡æœ‰å®ç°<code>InitializingBean</code>æ¥å£çš„Beanï¼Œè¿™ä¸ªæ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ã€‚</p><p>å…¶ä¼šåœ¨Beanåˆå§‹åŒ–ä¹‹åæ‰§è¡Œï¼Œåœ¨æ‰€æœ‰å‚æ•°èµ‹å€¼ä¹‹åå®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»å°±ä¼šæ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> MyBeanPostProcessor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-13</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, InitializingBean &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"><span class="comment">//        log.error(&quot;åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œï¼š&quot; + bean.toString());</span></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"><span class="comment">//        log.error(&quot;åˆå§‹åŒ–ä¹‹åæ‰§è¡Œï¼š&quot; + bean.toString());</span></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.error(<span class="string">&quot;afterPropertiesSet is running&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="BeanPostProcessoråç½®å¤„ç†"><a href="#BeanPostProcessoråç½®å¤„ç†" class="headerlink" title="BeanPostProcessoråç½®å¤„ç†"></a>BeanPostProcessoråç½®å¤„ç†</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> HuiListenerAnnotationBeanPostProcessor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuiListenerAnnotationBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">HuiListenerRegistry</span> <span class="variable">huiListenerRegistry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HuiListenerRegistry</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">huiListenerFlag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> åœ¨ bean çš„åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ <span class="doctag">@PostConstruct</span> æ³¨è§£çš„æ–¹æ³•æˆ– init-method æŒ‡å®šçš„æ–¹æ³•ï¼‰ä¹‹å‰è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> Object &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessBeforeInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> åœ¨ bean çš„åˆå§‹åŒ–æ–¹æ³•ä¹‹åè°ƒç”¨ã€‚æŸ¥çœ‹å½“å‰çš„beanæ˜¯å¦å­˜åœ¨è¢«HuiListeneræ³¨è§£è¿‡çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> Object &#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2024/10/12</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">        Method[] methods = bean.getClass().getMethods();</span><br><span class="line">        <span class="keyword">for</span>(Method method : methods)&#123;</span><br><span class="line">            <span class="keyword">if</span>(method.isAnnotationPresent(HuiListener.class))&#123;</span><br><span class="line">                processHuiListener(method,bean);</span><br><span class="line">                huiListenerFlag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessAfterInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processHuiListener</span><span class="params">(Method method,Object bean)</span>&#123;</span><br><span class="line">        <span class="type">HuiListener</span> <span class="variable">huiListener</span> <span class="operator">=</span> method.getAnnotation(HuiListener.class);</span><br><span class="line">        <span class="type">HuiListenerEndpoint</span> <span class="variable">huiListenerEndpoint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HuiListenerEndpoint</span>();</span><br><span class="line">        huiListenerEndpoint.setBean(bean);</span><br><span class="line">        huiListenerEndpoint.setMethod(method);</span><br><span class="line">        huiListenerRegistry.registerListenerEndpoint(huiListener.queueName(),huiListenerEndpoint);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="æ³¨å†ŒDestructionç›¸å…³æ¥å£"><a href="#æ³¨å†ŒDestructionç›¸å…³æ¥å£" class="headerlink" title="æ³¨å†ŒDestructionç›¸å…³æ¥å£"></a>æ³¨å†ŒDestructionç›¸å…³æ¥å£</h5><p><code>DisposableBean</code>æ¥å£æä¾›äº†ä¸€ä¸ª<code>destroy()</code>æ–¹æ³•ï¼Œå½“Beanè¢«é”€æ¯æ—¶ï¼ŒSpringä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.DisposableBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> <span class="keyword">implements</span> <span class="title class_">DisposableBean</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰çš„é”€æ¯é€»è¾‘</span></span><br><span class="line">        System.out.println(<span class="string">&quot;MyBean is being destroyed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¹¶ä¸æ˜¯çœŸæ­£çš„é”€æ¯ï¼ŒBeanè¿˜æ²¡å¼€å§‹ä½¿ç”¨å‘¢ï¼Œè¿™åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹ä¾¿ä¹‹åè¿›è¡Œé”€æ¯æ—¶è¿›è¡Œè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><p><strong>ä½¿ç”¨<code>@PreDestroy</code>æ³¨è§£</strong></p><p>Springè¿˜å…è®¸ä½¿ç”¨<code>@PreDestroy</code>æ³¨è§£æ¥æ ‡è®°ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨Beanè¢«é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">javaå¤åˆ¶ä»£ç <span class="keyword">import</span> javax.annotation.PreDestroy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnotherBean</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanup</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰çš„æ¸…ç†é€»è¾‘</span></span><br><span class="line">        System.out.println(<span class="string">&quot;AnotherBean is being destroyed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>ä¸å¿…å¤šè¯´</p><h4 id="é”€æ¯"><a href="#é”€æ¯" class="headerlink" title="é”€æ¯"></a>é”€æ¯</h4><h5 id="æ˜¯å¦å®ç°äº†DisposableBeanæ¥å£"><a href="#æ˜¯å¦å®ç°äº†DisposableBeanæ¥å£" class="headerlink" title="æ˜¯å¦å®ç°äº†DisposableBeanæ¥å£"></a>æ˜¯å¦å®ç°äº†DisposableBeanæ¥å£</h5><p><code>DisposableBean</code> æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œä¸“é—¨ç”¨äºå¤„ç† Bean çš„é”€æ¯è¿‡ç¨‹ã€‚é€šè¿‡å®ç°è¯¥æ¥å£ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ Bean çš„ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„æ¸…ç†é€»è¾‘ï¼Œä»¥ç¡®ä¿èµ„æºçš„æ­£ç¡®é‡Šæ”¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.DisposableBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> <span class="keyword">implements</span> <span class="title class_">DisposableBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œå¯ä»¥å®šä¹‰ä¸€äº›éœ€è¦çš„èµ„æºï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥ç­‰</span></span><br><span class="line">    <span class="keyword">private</span> String resource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿèµ„æºçš„åˆå§‹åŒ–</span></span><br><span class="line">        <span class="built_in">this</span>.resource = <span class="string">&quot;Some Resource&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyBean initialized with resource: &quot;</span> + resource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç° DisposableBean æ¥å£çš„ destroy æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰çš„æ¸…ç†é€»è¾‘</span></span><br><span class="line">        System.out.println(<span class="string">&quot;MyBean is being destroyed! Releasing resource: &quot;</span> + resource);</span><br><span class="line">        <span class="comment">// è¿™é‡Œå¯ä»¥æ·»åŠ èµ„æºé‡Šæ”¾çš„ä»£ç ï¼Œæ¯”å¦‚å…³é—­æ•°æ®åº“è¿æ¥ç­‰</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="æ˜¯å¦é…ç½®è‡ªå®šä¹‰çš„destory-method"><a href="#æ˜¯å¦é…ç½®è‡ªå®šä¹‰çš„destory-method" class="headerlink" title="æ˜¯å¦é…ç½®è‡ªå®šä¹‰çš„destory-method"></a>æ˜¯å¦é…ç½®è‡ªå®šä¹‰çš„destory-method</h5><p><code>destroy-method</code> æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºå®šä¹‰ Bean é”€æ¯æ–¹æ³•çš„ä¸€ä¸ªå±æ€§ï¼Œä¸»è¦ç”¨äºåœ¨ Bean è¢«é”€æ¯æ—¶æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•æ¥æ‰§è¡Œæ¸…ç†é€»è¾‘ã€‚è¿™ç§æ–¹å¼é€šå¸¸ç”¨äº XML é…ç½®æ–‡ä»¶ä¸­ï¼Œå…è®¸å¼€å‘è€…åœ¨ Spring å®¹å™¨å…³é—­æˆ– Bean è¢«é”€æ¯æ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„é€»è¾‘ã€‚</p><h3 id="Beançš„ä½œç”¨åŸŸ"><a href="#Beançš„ä½œç”¨åŸŸ" class="headerlink" title="Beançš„ä½œç”¨åŸŸ"></a>Beançš„ä½œç”¨åŸŸ</h3><p>Beançš„ä½œç”¨åŸŸæ˜¯æŒ‡Beanå®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸåŠå¯è§æ€§èŒƒå›´ï¼ŒSpringæ¡†æ¶å®šä¹‰äº†ä»¥ä¸‹6ç§ä½œç”¨åŸŸï¼š</p><ul><li>singletonï¼šå•ä¾‹ä½œç”¨åŸŸï¼Œæ‰€æœ‰å¯¹è¯¥Beançš„è¯·æ±‚éƒ½è¿”å›åŒä¸€ä¸ªBeanå®ä¾‹ã€‚</li><li>prototypeï¼šåŸå‹ä½œç”¨åŸŸï¼Œæ¯æ¬¡è¯·æ±‚æ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„Beanå®ä¾‹ã€‚</li><li>requestï¼šè¯·æ±‚ä½œç”¨åŸŸï¼Œæ¯ä¸ªHTTPè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanå®ä¾‹ï¼Œè¯¥Beanå®ä¾‹ä»…åœ¨å½“å‰è¯·æ±‚å†…æœ‰æ•ˆã€‚</li><li>sessionï¼šä¼šè¯ä½œç”¨åŸŸï¼Œæ¯ä¸ªHTTPä¼šè¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanå®ä¾‹ï¼Œè¯¥Beanå®ä¾‹ä»…åœ¨å½“å‰ä¼šè¯å†…æœ‰æ•ˆã€‚</li><li>applicationï¼šå…¨å±€ä½œç”¨åŸŸ,ä¸€ä¸ªbean å®šä¹‰å¯¹åº”äºå•ä¸ªServletContext çš„ç”Ÿå‘½å‘¨æœŸã€‚</li><li>websocketï¼š HTTP WebSocket ä½œç”¨åŸŸ,ä¸€ä¸ªbean å®šä¹‰å¯¹åº”äºå•ä¸ªwebsocket çš„ç”Ÿå‘½å‘¨æœŸã€‚</li></ul><p>singletonä½œç”¨åŸŸæ˜¯Springä¸­é»˜è®¤çš„ä½œç”¨åŸŸï¼Œ</p><p>ä½¿â½¤ @Scope æ ‡ç­¾å°±å¯ä»¥â½¤æ¥å£°æ˜ Bean çš„ä½œâ½¤åŸŸï¼Œâ½å¦‚è®¾ç½® Bean çš„ä½œâ½¤åŸŸï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Users</span> &#123;</span><br><span class="line">    <span class="meta">@Scope(prototype)</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;u&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;Hi user&quot;</span>); </span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Springä¾èµ–æ³¨å…¥çš„æ–¹å¼"><a href="#Springä¾èµ–æ³¨å…¥çš„æ–¹å¼" class="headerlink" title="Springä¾èµ–æ³¨å…¥çš„æ–¹å¼"></a>Springä¾èµ–æ³¨å…¥çš„æ–¹å¼</h3><h4 id="æ„é€ å™¨æ³¨å…¥"><a href="#æ„é€ å™¨æ³¨å…¥" class="headerlink" title="æ„é€ å™¨æ³¨å…¥"></a>æ„é€ å™¨æ³¨å…¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        userRepository.save(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;User &quot;</span> + username + <span class="string">&quot; saved.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Setter-æ–¹æ³•æ³¨å…¥"><a href="#Setter-æ–¹æ³•æ³¨å…¥" class="headerlink" title="Setter æ–¹æ³•æ³¨å…¥"></a>Setter æ–¹æ³•æ³¨å…¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Setter æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPaymentService</span><span class="params">(PaymentService paymentService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentService = paymentService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (paymentService != <span class="literal">null</span>) &#123;</span><br><span class="line">            paymentService.processPayment();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;No payment service available.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processPayment</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Payment processed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å­—æ®µæ³¨å…¥"><a href="#å­—æ®µæ³¨å…¥" class="headerlink" title="å­—æ®µæ³¨å…¥"></a>å­—æ®µæ³¨å…¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmailService emailService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendNotification</span><span class="params">()</span> &#123;</span><br><span class="line">        emailService.sendEmail();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Email sent.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ³¨è§£é…ç½®æ–¹å¼"><a href="#æ³¨è§£é…ç½®æ–¹å¼" class="headerlink" title="æ³¨è§£é…ç½®æ–¹å¼"></a>æ³¨è§£é…ç½®æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printAppName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Application Name: &quot;</span> + appName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="XML-é…ç½®"><a href="#XML-é…ç½®" class="headerlink" title="XML é…ç½®"></a>XML é…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userRepository&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.UserRepository&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.UserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;userRepository&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="BeanFactoryå’ŒApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#BeanFactoryå’ŒApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="BeanFactoryå’ŒApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«"></a>BeanFactoryå’ŒApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«</h3><p>æ˜¯springçš„æ ¸å¿ƒæ¥å£ï¼Œéƒ½å¯ä»¥ä½œä¸ºå®¹å™¨ï¼ŒApplicationContextæ˜¯BeanFactoryçš„å­æ¥å£ã€‚<br>BeanFactoryï¼š æ˜¯springæœ€åº•å±‚çš„æ¥å£ï¼ŒåŒ…å«å„ç§Beançš„å®šä¹‰å’ŒBeançš„ç®¡ç†ã€‚</p><p>åŒºåˆ«ï¼š</p><ul><li><strong>BeanFactroyé‡‡ç”¨çš„æ˜¯å»¶è¿ŸåŠ è½½å½¢å¼æ¥æ³¨å…¥Beançš„ï¼Œä½¿ç”¨åˆ°beanæ‰ä¼šåŠ è½½ã€‚ApplicationContextä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰beanã€‚</strong></li><li>BeanFactoryéœ€è¦æ‰‹åŠ¨æ³¨å†Œï¼Œè€ŒApplicationContextåˆ™æ˜¯è‡ªåŠ¨æ³¨å†Œã€‚</li><li>BeanFactoryä¸æ”¯æŒå›½é™…åŒ–ï¼ŒApplicationContextæ”¯æŒå›½é™…åŒ–(å®ç°MessageSourceæ¥å£)ã€‚</li><li>BeanFactoryä¸æ”¯æŒAOPï¼ŒApplicationContextæ”¯æŒAOPï¼Œå¯ä»¥ä¸Springçš„AOPæ¡†æ¶é›†æˆï¼Œæä¾›å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚</li></ul><h3 id="Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>è™½ç„¶Springä¸­çš„Beanæ˜¯singletonï¼Œä½†æ˜¯åœ¨ä¸€äº›å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¼šå‡ºç°çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CounterService counterService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">                counterService.increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">                counterService.increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread1.join();</span><br><span class="line">        thread2.join();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Final count: &quot;</span> + counterService.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å› ä¸ºcount++;æ“ä½œä¸æ˜¯åŸå­æ€§çš„ï¼Œæ‰€ä»¥ä¼šå‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ã€‚ä¸€èˆ¬çš„è§£å†³æ–¹æ³•æ˜¯ï¼š</p><ul><li>æ‰€å®šä¹‰çš„Beanæ˜¯æ— çŠ¶æ€çš„ï¼Œå³ä¸æ¶‰åŠä¸€äº›æ•°æ®ï¼Œä½†æ˜¯è¿™ä¸ç°å®ï¼›</li><li>åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªThreadLocalæˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜å˜é‡ä¿å­˜åœ¨ThreadLocalä¸­ï¼›</li><li>æŠŠæˆå‘˜å˜é‡å†™åœ¨æ–¹æ³•å†…ã€‚</li><li>ä¿®æ”¹beançš„ä½œç”¨åŸŸï¼Œsingletonæ”¹ä¸ºprototypeã€‚ï¼ˆ@Scopeï¼ˆâ€œprototypeâ€ï¼‰ï¼‰</li><li>ä½¿ç”¨synchronizedä¿®é¥°ã€‚</li></ul><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><h3 id="äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶"><a href="#äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶" class="headerlink" title="äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶"></a>äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶</h3><h4 id="ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡çš„ä¼ æ’­ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡çš„ä¼ æ’­ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡çš„ä¼ æ’­ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡çš„ä¼ æ’­ï¼Ÿ</h4><p>åœ¨å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæ–¹æ³•é—´çš„è°ƒç”¨å¯èƒ½è·¨è¶Šå¤šä¸ªæœåŠ¡ã€ç»„ä»¶æˆ–æ¨¡å—ï¼Œæ¯ä¸ªæ–¹æ³•å¯èƒ½éƒ½éœ€è¦äº‹åŠ¡æ§åˆ¶ã€‚å¦‚æœæ²¡æœ‰åˆç†çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><strong>äº‹åŠ¡åµŒå¥—</strong>ï¼šå¤šä¸ªæ–¹æ³•å½¼æ­¤åµŒå¥—ï¼Œå¦‚æœæ²¡æœ‰ç»Ÿä¸€ç®¡ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´äº‹åŠ¡æ··ä¹±ã€‚</li><li><strong>äº‹åŠ¡éš”ç¦»</strong>ï¼šä¸åŒçš„äº‹åŠ¡å¯èƒ½ä¼šå½±å“å½¼æ­¤çš„æ‰§è¡Œï¼Œéœ€è¦æ˜ç¡®æ¯ä¸ªæ–¹æ³•çš„äº‹åŠ¡ä½œç”¨åŸŸã€‚</li><li><strong>äº‹åŠ¡ä¼ é€’</strong>ï¼šè°ƒç”¨é“¾ä¸­çš„æŸäº›æ–¹æ³•å¯èƒ½éœ€è¦å¤ç”¨è°ƒç”¨è€…çš„äº‹åŠ¡ï¼Œæœ‰äº›æ–¹æ³•åˆ™éœ€è¦å¼€å¯è‡ªå·±çš„äº‹åŠ¡ã€‚</li></ul><p>äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶æä¾›äº†ç»Ÿä¸€çš„ç®¡ç†æ–¹å¼æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œç¡®ä¿äº‹åŠ¡çš„æ­£ç¡®ä¼ æ’­å’Œæ‰§è¡Œã€‚</p><h3 id="äº‹åŠ¡ä¼ æ’­ç±»å‹"><a href="#äº‹åŠ¡ä¼ æ’­ç±»å‹" class="headerlink" title="äº‹åŠ¡ä¼ æ’­ç±»å‹"></a>äº‹åŠ¡ä¼ æ’­ç±»å‹</h3><h4 id="PROPAGATION-REQUIREDï¼ˆé»˜è®¤ä¼ æ’­æœºåˆ¶ï¼Œpropagation-requiredï¼‰"><a href="#PROPAGATION-REQUIREDï¼ˆé»˜è®¤ä¼ æ’­æœºåˆ¶ï¼Œpropagation-requiredï¼‰" class="headerlink" title="PROPAGATION_REQUIREDï¼ˆé»˜è®¤ä¼ æ’­æœºåˆ¶ï¼Œpropagation_requiredï¼‰"></a><strong>PROPAGATION_REQUIRED</strong>ï¼ˆé»˜è®¤ä¼ æ’­æœºåˆ¶ï¼Œpropagation_requiredï¼‰</h4><p>å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚</p><p><strong>è§£å†³çš„é—®é¢˜</strong>ï¼šç¡®ä¿åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œäº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸ä¼ é€’ï¼Œå¹¶ä¸”é»˜è®¤å¼€å¯äº‹åŠ¡ç®¡ç†ã€‚</p><h4 id="PROPAGATION-REQUIRES-NEW"><a href="#PROPAGATION-REQUIRES-NEW" class="headerlink" title="PROPAGATION_REQUIRES_NEW"></a><strong>PROPAGATION_REQUIRES_NEW</strong></h4><ul><li>ä¸ç®¡æ˜¯å¦å­˜åœ¨äº‹åŠ¡ï¼Œæ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚å½“å‰å­˜åœ¨çš„äº‹åŠ¡ä¼šè¢«æŒ‚èµ·ï¼Œç­‰æ–°çš„äº‹åŠ¡å®Œæˆåå†æ¢å¤ã€‚</li><li><strong>è§£å†³çš„é—®é¢˜</strong>ï¼šå¦‚æœå½“å‰æ–¹æ³•éœ€è¦ç‹¬ç«‹çš„äº‹åŠ¡å¤„ç†ï¼Œä¸”ä¸å—è°ƒç”¨æ–¹äº‹åŠ¡çš„å½±å“ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥ä¼ æ’­æœºåˆ¶ã€‚</li></ul><h4 id="PROPAGATION-SUPPORTS"><a href="#PROPAGATION-SUPPORTS" class="headerlink" title="PROPAGATION_SUPPORTS"></a>PROPAGATION_SUPPORTS</h4><p>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥äº‹åŠ¡ï¼›å¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚</p><p><strong>è§£å†³çš„é—®é¢˜</strong>ï¼šåœ¨ä¸éœ€è¦å¼ºåˆ¶äº‹åŠ¡ç®¡ç†çš„åœºæ™¯ä¸­ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œã€‚</p><h4 id="PROPAGATION-NOT-SUPPORTED"><a href="#PROPAGATION-NOT-SUPPORTED" class="headerlink" title="PROPAGATION_NOT_SUPPORTED"></a>PROPAGATION_NOT_SUPPORTED</h4><p>å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·è¯¥äº‹åŠ¡ï¼Œå¹¶ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œè¯¥æ–¹æ³•ã€‚</p><p><strong>è§£å†³çš„é—®é¢˜</strong>ï¼šåœ¨æŸäº›æ“ä½œä¸é€‚åˆåœ¨äº‹åŠ¡ä¸­æ‰§è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥ä¼ æ’­æœºåˆ¶ã€‚ä¾‹å¦‚ä¸€äº›ä¸éœ€è¦äº‹åŠ¡çš„è€—æ—¶æ“ä½œã€‚</p><h4 id="PROPAGATION-NEVER"><a href="#PROPAGATION-NEVER" class="headerlink" title="PROPAGATION_NEVER"></a><strong>PROPAGATION_NEVER</strong></h4><ul><li>ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li><strong>è§£å†³çš„é—®é¢˜</strong>ï¼šå¼ºåˆ¶è§„å®šæŸä¸ªæ–¹æ³•ä¸å…è®¸åœ¨äº‹åŠ¡ç¯å¢ƒä¸­æ‰§è¡Œã€‚</li></ul><h4 id="PROPAGATION-MANDATORY"><a href="#PROPAGATION-MANDATORY" class="headerlink" title="PROPAGATION_MANDATORY"></a><strong>PROPAGATION_MANDATORY</strong></h4><ul><li>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥äº‹åŠ¡ï¼›å¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li><strong>è§£å†³çš„é—®é¢˜</strong>ï¼šå¼ºåˆ¶è¦æ±‚æ–¹æ³•å¿…é¡»åœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰äº‹åŠ¡åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><h4 id="PROPAGATION-NESTED"><a href="#PROPAGATION-NESTED" class="headerlink" title="PROPAGATION_NESTED"></a><strong>PROPAGATION_NESTED</strong></h4><ul><li>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨å½“å‰äº‹åŠ¡å†…å¼€å¯ä¸€ä¸ªå­äº‹åŠ¡ï¼ˆåµŒå¥—äº‹åŠ¡ï¼‰ï¼›å¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚</li><li><strong>è§£å†³çš„é—®é¢˜</strong>ï¼šæä¾›åµŒå¥—äº‹åŠ¡çš„æ”¯æŒï¼Œå½“å­äº‹åŠ¡å¤±è´¥æ—¶ï¼Œçˆ¶äº‹åŠ¡å¯ä»¥é€‰æ‹©å›æ»šå­äº‹åŠ¡çš„æ“ä½œï¼Œè€Œä¸å½±å“æ•´ä¸ªäº‹åŠ¡ã€‚</li></ul><h3 id="äº‹åŠ¡ä¼ æ’­çš„å®é™…æ¡ˆä¾‹"><a href="#äº‹åŠ¡ä¼ æ’­çš„å®é™…æ¡ˆä¾‹" class="headerlink" title="äº‹åŠ¡ä¼ æ’­çš„å®é™…æ¡ˆä¾‹"></a>äº‹åŠ¡ä¼ æ’­çš„å®é™…æ¡ˆä¾‹</h3><h4 id="åœºæ™¯ï¼šè®¢å•å¤„ç†"><a href="#åœºæ™¯ï¼šè®¢å•å¤„ç†" class="headerlink" title="åœºæ™¯ï¼šè®¢å•å¤„ç†"></a>åœºæ™¯ï¼šè®¢å•å¤„ç†</h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªè®¢å•å¤„ç†ç³»ç»Ÿï¼ŒåŒ…å«ä¸¤ä¸ªæ“ä½œï¼šç”Ÿæˆè®¢å•å’Œæ‰£é™¤ç”¨æˆ·ä½™é¢ã€‚ä½ å¸Œæœ›è¿™ä¸¤ä¸ªæ“ä½œéƒ½åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªå¤±è´¥ï¼Œéƒ½åº”è¯¥å›æ»šã€‚</p><p><strong>æ–¹æ³•ä¸€</strong>ï¼šå¤„ç†è®¢å•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    createOrder(order);</span><br><span class="line">    deductUserBalance(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒ</strong>ï¼šåˆ›å»ºè®¢å•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºè®¢å•é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•ä¸‰</strong>ï¼šæ‰£é™¤ç”¨æˆ·ä½™é¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductUserBalance</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰£é™¤ç”¨æˆ·ä½™é¢é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œ<code>processOrder</code> å’Œ <code>deductUserBalance</code> å…±äº«åŒä¸€ä¸ªäº‹åŠ¡ï¼Œè€Œ <code>createOrder</code> ç”±äºä½¿ç”¨äº† <code>REQUIRES_NEW</code>ï¼Œå³ä½¿ <code>processOrder</code> ä¸­çš„äº‹åŠ¡å¤±è´¥ï¼Œå®ƒçš„åˆ›å»ºè®¢å•æ“ä½œä¹Ÿä¼šç‹¬ç«‹æäº¤æˆ–å›æ»šï¼Œä¸ä¼šå—åˆ°å½±å“ã€‚è¿™å°±æ˜¯äº‹åŠ¡ä¼ æ’­æœºåˆ¶å¸®åŠ©æ§åˆ¶ä¸åŒæ“ä½œçš„äº‹åŠ¡è¡Œä¸ºï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>49 Java JDBC</title>
      <link href="/2025/02/26/49%20Java%20JDBC/"/>
      <url>/2025/02/26/49%20Java%20JDBC/</url>
      
        <content type="html"><![CDATA[<h1 id="49-Java-JDBC"><a href="#49-Java-JDBC" class="headerlink" title="49 Java JDBC"></a>49 Java JDBC</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/weixin_45187434/article/details/127510916">JavaJDBCï¼šè¿æ¥æ± </a></li><li><a href="https://blog.csdn.net/qq_39093474/article/details/136850812?ops_request_misc=&request_id=&biz_id=102&utm_term=Druid&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-136850812.142%5Ev100%5Epc_search_result_base2&spm=1018.2226.3001.4187">springbooté›†æˆDruidï¼Œé…ç½®è¯¦è§£æ–°æ‰‹å¿…é¡»è¯»</a></li></ol><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ•°æ®åº“è¿æ¥æ± é¡¾åæ€ä¹‰å°±æ˜¯å­˜æ”¾æ•°æ®åº“è¿æ¥çŠ¶æ€çš„æ± å­ï¼Œåœ¨è¯¥æŠ€æœ¯æå‡ºä¹‹å‰ï¼Œå¦‚æœéœ€è¦è¿æ¥æ•°æ®åº“ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªJDBCè¿æ¥å¯¹è±¡ï¼Œå½“ç»“æŸçš„æ—¶å€™ï¼Œè¯¥å¯¹è±¡å°±ä¼šè¢«å›æ”¶ã€‚æ‰€ä»¥å¦‚æœé‡å¤çš„åˆ›å»ºåŒæ ·çš„æ•°æ®åº“è¿æ¥ï¼Œå°±ä¼šé€ æˆèµ„æºçš„æå¤§æµªè´¹ï¼Œæ•°æ®åº“è¿æ¥æ± åº”è¿è€Œç”Ÿã€‚</p><p>åœ¨æ•°æ®åº“è¿æ¥æ± ä¸­å­˜æ”¾ä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥ï¼Œå½“ç”¨æˆ·éœ€è¦è¿æ¥æ—¶ï¼Œå¹¶éåˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè€Œæ˜¯æŸ¥çœ‹è¿æ¥æ± ä¸­æ˜¯å¦å·²ç»å­˜åœ¨äº†è¯¥è¿æ¥ï¼Œå¦‚æœæœ‰åˆ™ä¼šç›´æ¥æ‹¿å‡ºä½¿ç”¨ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p><p>è¿æ¥æ± ä¼˜ç‚¹ï¼š</p><ol><li>å‡å°‘è¿æ¥åˆ›å»ºæ—¶é—´ï¼šè™½ç„¶ä¸å…¶å®ƒæ•°æ®åº“ç›¸æ¯” GBase æä¾›äº†è¾ƒä¸ºå¿«é€Ÿè¿æ¥åŠŸèƒ½ï¼Œä½†æ˜¯åˆ›å»ºæ–°çš„ JDBC è¿æ¥ä»ä¼šæ‹›è‡´ç½‘ç»œå’Œ JDBC é©±åŠ¨çš„å¼€é”€ã€‚å¦‚æœè¿™ç±»è¿æ¥æ˜¯â€œå¾ªç¯â€ä½¿ç”¨çš„ï¼Œä½¿ç”¨è¯¥æ–¹å¼è¿™äº›èŠ±é”€å°±å¯é¿å…</li><li>ç®€åŒ–çš„ç¼–ç¨‹æ¨¡å¼ï¼šå½“ä½¿ç”¨è¿æ¥æ± æ—¶ï¼Œæ¯ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹èƒ½å¤Ÿåƒåˆ›å»ºäº†ä¸€ä¸ªè‡ªå·±çš„ JDBC è¿æ¥ä¸€æ ·æ“ä½œï¼Œå…è®¸ç”¨æˆ·ç›´æ¥ä½¿ç”¨JDBCç¼–ç¨‹æŠ€æœ¯ã€‚</li><li>å—æ§çš„èµ„æºä½¿ç”¨ï¼šå¦‚æœç”¨æˆ·ä¸ä½¿ç”¨è¿æ¥æ± ï¼Œè€Œæ˜¯æ¯å½“çº¿ç¨‹éœ€è¦æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œé‚£ä¹ˆç”¨æˆ·çš„åº”ç”¨ç¨‹åºçš„èµ„æºä½¿ç”¨ä¼šäº§ç”Ÿéå¸¸å¤§çš„æµªè´¹å¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´é«˜è´Ÿè½½ä¸‹çš„å¼‚å¸¸å‘ç”Ÿã€‚è¿æ¥æ± èƒ½å¤Ÿä½¿æ€§èƒ½æœ€å¤§åŒ–ï¼ŒåŒæ—¶è¿˜èƒ½å°†èµ„æºåˆ©ç”¨æ§åˆ¶åœ¨ä¸€å®šçš„æ°´å¹³ä¹‹ä¸‹ï¼Œå¦‚æœè¶…è¿‡è¯¥æ°´å¹³ï¼Œåº”ç”¨ç¨‹åºå°†å´©æºƒè€Œä¸ä»…ä»…æ˜¯å˜æ…¢ã€‚</li></ol><h2 id="è¿æ¥æ± åŸç†"><a href="#è¿æ¥æ± åŸç†" class="headerlink" title="è¿æ¥æ± åŸç†"></a>è¿æ¥æ± åŸç†</h2><ol><li>å»ºç«‹æ•°æ®åº“è¿æ¥æ± å¯¹è±¡ï¼ˆæœåŠ¡å™¨å¯åŠ¨ï¼‰ã€‚</li><li>æŒ‰ç…§äº‹å…ˆæŒ‡å®šçš„å‚æ•°åˆ›å»ºåˆå§‹æ•°é‡çš„æ•°æ®åº“è¿æ¥ï¼ˆå³ï¼šç©ºé—²è¿æ¥æ•°ï¼‰ã€‚</li><li>å¯¹äºä¸€ä¸ªæ•°æ®åº“çš„è®¿é—®è¯·æ±‚ï¼Œç›´æ¥ä»è¿æ¥æ± ä¸­å¾—åˆ°ä¸€ä¸ªè¿æ¥ï¼Œå¦‚æœæ•°æ®åº“è¿æ¥æ± å¯¹è±¡ä¸­æœ‰ç©ºé—²è¿æ¥åˆ™ç›´æ¥ä½¿ç”¨ã€è‹¥æ²¡æœ‰ç©ºé—²çš„é“¾æ¥ï¼Œä¸”è¿æ¥æ•°æ²¡æœ‰è¾¾åˆ°æœ€å¤§ï¼ˆå³ï¼šæœ€å¤§æ´»è·ƒè¿æ¥æ•°ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“è¿æ¥æ¥å¤„ç†è¯¥è¯·æ±‚ï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²è¿æ¥å¹¶ä¸”è¾¾åˆ°æœ€å¤§æ´»è·ƒå€¼åˆ™è¿›è¡Œç­‰å¾…å…¶å®ƒçš„é“¾æ¥é‡Šæ”¾å†è¿›è¡Œè¯¥è¯·æ±‚çš„å¤„ç†ã€‚</li><li>å­˜å–æ•°æ®åº“ã€‚</li><li>å…³é—­æ•°æ®åº“ï¼Œé‡Šæ”¾æ‰€æœ‰æ•°æ®åº“è¿æ¥ï¼ˆæ­¤æ—¶ç¦å®‰æ¯”æ•°æ®åº“è¿æ¥ï¼Œå¹¶éçœŸæ­£çš„å…³é—­ï¼Œè€Œæ˜¯å°†å…¶æ”¾å…¥ç©ºé—²é˜Ÿåˆ—ä¸­ã€‚å¦‚æœå®é™…ç©ºé—²è¿æ¥æ•°å¤§äºåˆå§‹ç©ºé—²è¿æ¥æ•°åˆ™é‡Šæ”¾è¿æ¥ï¼‰ã€‚</li><li>é‡Šæ”¾æ•°æ®åº“è¿æ¥æ± å¯¹è±¡ï¼ˆåœ¨æœåŠ¡å™¨åœæ­¢ã€ç»´æŠ¤æœŸé—´ï¼ŒçœŸæ­£çš„é‡Šæ”¾æ•°æ®åº“è¿æ¥æ± å¯¹è±¡ï¼Œå¹¶é‡Šæ”¾æ‰€æœ‰èµ„æºï¼‰ã€‚</li></ol><h2 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a>Druid</h2><h3 id="å‰è¨€-1"><a href="#å‰è¨€-1" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>Druid æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®åº“è¿æ¥æ± å’Œç›‘æ§åº“ï¼Œå®ƒæä¾›äº†æ¯”å¸¸è§çš„æ•°æ®åº“è¿æ¥æ± æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚è¿æ¥æ± ç›‘æ§ã€ç»Ÿè®¡<a href="https://so.csdn.net/so/search?q=SQL&spm=1001.2101.3001.7020">SQL</a>ä¿¡æ¯ã€SQL ç›‘æ§ã€é˜² SQL æ³¨å…¥ç­‰ã€‚åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼ŒDruid å¯ä»¥å¾ˆå®¹æ˜“åœ°é›†æˆå¹¶è¿›è¡Œé…ç½®ã€‚</p><h3 id="SpringBooté…ç½®Druid"><a href="#SpringBooté…ç½®Druid" class="headerlink" title="SpringBooté…ç½®Druid"></a>SpringBooté…ç½®Druid</h3><h4 id="åŠ å…¥Maven"><a href="#åŠ å…¥Maven" class="headerlink" title="åŠ å…¥Maven"></a>åŠ å…¥Maven</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ä½¿ç”¨ log4j2 è®°å½•æ—¥å¿—--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">mybatisï¼Œå¼•å…¥äº† SpringBootçš„ JDBC æ¨¡å—ï¼Œ</span></span><br><span class="line"><span class="comment">æ‰€ä»¥ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨ hikari ä½œä¸ºæ•°æ®æº</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ’é™¤é»˜è®¤çš„ HikariCP æ•°æ®æº --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>47 Demo Repository</title>
      <link href="/2025/02/26/47%20Demo%20Repository/"/>
      <url>/2025/02/26/47%20Demo%20Repository/</url>
      
        <content type="html"><![CDATA[<h1 id="47-Demo-Repository"><a href="#47-Demo-Repository" class="headerlink" title="47 Demo Repository"></a>47 Demo Repository</h1><h2 id="SpringCloud-gateway-Spring-Security-JWTå®ç°ç™»å½•å’Œç”¨æˆ·æƒé™æ ¡éªŒ"><a href="#SpringCloud-gateway-Spring-Security-JWTå®ç°ç™»å½•å’Œç”¨æˆ·æƒé™æ ¡éªŒ" class="headerlink" title="SpringCloud gateway+Spring Security + JWTå®ç°ç™»å½•å’Œç”¨æˆ·æƒé™æ ¡éªŒ"></a>SpringCloud gateway+Spring Security + JWTå®ç°ç™»å½•å’Œç”¨æˆ·æƒé™æ ¡éªŒ</h2><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li><a href="https://blog.csdn.net/yuan__once/article/details/127022613">https://blog.csdn.net/yuan__once/article/details/127022613</a></li><li><a href="https://blog.csdn.net/qq_40758535/article/details/110291798">å¾®æœåŠ¡ spring gateway+nacos +security+JWT è®¤è¯æˆæƒ</a></li></ol><h2 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h2><p>MySQLï¼š8.0.22</p><p>Redisï¼š3.0.503</p><h2 id="0722"><a href="#0722" class="headerlink" title="0722"></a>0722</h2><p>åœ¨æ‰§è¡Œæ‰€æœ‰çš„SQLè¯­å¥ä¹‹å‰æ‰“å°æ—¥å¿—ï¼Œæ‰€æœ‰çš„æ—¥å¿—æŒç»­åŒ–ä¿å­˜ã€‚</p><h3 id="MyBatis-MyBatis-plusæ‰“å°æ—¥å¿—"><a href="#MyBatis-MyBatis-plusæ‰“å°æ—¥å¿—" class="headerlink" title="MyBatis&amp;MyBatis-plusæ‰“å°æ—¥å¿—"></a>MyBatis&amp;MyBatis-plusæ‰“å°æ—¥å¿—</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#by zhengkai.blog.csdn.net</span></span><br><span class="line"><span class="comment">#mybatis-plusé…ç½®æ§åˆ¶å°æ‰“å°å®Œæ•´å¸¦å‚æ•°SQLè¯­å¥</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><h2 id="MyBatis-MyBatis-Plusè‡ªå®šä¹‰SQLæ—¥å¿—"><a href="#MyBatis-MyBatis-Plusè‡ªå®šä¹‰SQLæ—¥å¿—" class="headerlink" title="MyBatis&amp;MyBatis-Plusè‡ªå®šä¹‰SQLæ—¥å¿—"></a>MyBatis&amp;MyBatis-Plusè‡ªå®šä¹‰SQLæ—¥å¿—</h2><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li><a href="https://blog.csdn.net/qq_38164123/article/details/131285599?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522172180375316800225582158%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=172180375316800225582158&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~times_rank-6-131285599-null-null.nonecase&utm_term=MyBatis-Plus%E8%87%AA%E5%AE%9A%E4%B9%89SQL%E6%97%A5%E5%BF%97&spm=1018.2226.3001.4450">SpringBootåŸºäºMybatisæˆ–Mybatis-Plusè‡ªå®šä¹‰å®ç°å®Œæ•´SQLæ‰“å°å’Œæ‰§è¡Œè€—æ—¶</a></li><li></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">        @Signature(type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">                method = &quot;query&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;Statement.class, ResultHandler.class&#125;),</span></span><br><span class="line"><span class="meta">        @Signature(</span></span><br><span class="line"><span class="meta">                type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">                method = &quot;update&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;Statement.class&#125;</span></span><br><span class="line"><span class="meta">        ),</span></span><br><span class="line"><span class="meta">        @Signature(</span></span><br><span class="line"><span class="meta">        type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">        method = &quot;batch&quot;,</span></span><br><span class="line"><span class="meta">        args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ª MyBatis æ‹¦æˆªå™¨ï¼Œè¯¥æ‹¦æˆªå™¨å°†æ‹¦æˆªä»¥ä¸‹ä¸‰ä¸ªæ•°æ®åº“æ“ä½œçš„æ–¹æ³•ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//query: æ‰§è¡ŒæŸ¥è¯¢æ“ä½œçš„æ–¹æ³•ï¼Œæ¥æ”¶ Statement å’Œ ResultHandler ä½œä¸ºå‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">//update: æ‰§è¡Œæ›´æ–°æ“ä½œçš„æ–¹æ³•ï¼Œåªæ¥æ”¶ Statement ä½œä¸ºå‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">//batch: æ‰§è¡Œæ‰¹é‡æ“ä½œçš„æ–¹æ³•ï¼Œæ¥æ”¶ Statement ä½œä¸ºå‚æ•°ã€‚</span></span><br></pre></td></tr></table></figure><p>mybatis sql æ—¥å¿—æ‹¦æˆªå™¨, ç”¨äºæ‰“å°SQLç›¸å…³ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šå®é™…æ‰§è¡ŒSQLè¯­å¥ï¼ŒSQLæ‰§è¡Œæ—¶é—´ï¼ŒæŸ¥è¯¢è®°å½•æ•°ç­‰ï¼‰</p><p>å…³äº @Interceptsæ³¨è§£è¯´æ˜ï¼š</p><p>ä¸ºäº†è®©æ‹¦æˆªå™¨èƒ½å¤Ÿç²¾ç¡®åœ°æ‹¦æˆªç‰¹å®šçš„æ–¹æ³•ï¼Œéœ€è¦ä½¿ç”¨ @Intercepts æ³¨è§£æ¥å£°æ˜æ‹¦æˆªçš„æ–¹æ³•å’Œå‚æ•°ç±»å‹</p><p>è¯¥æ³¨è§£åŒ…å«ä¸€ä¸ªå‚æ•°ï¼Œå³ä¸€ä¸ª @Signature ç±»å‹çš„æ•°ç»„ï¼Œç”¨äºæŒ‡å®šè¦æ‹¦æˆªçš„æ–¹æ³•ã€‚æ¯ä¸ª @Signature æ³¨è§£è¡¨ç¤ºä¸€ä¸ªè¦æ‹¦æˆªçš„æ–¹æ³•ç­¾åï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹å±æ€§ï¼š</p><p>typeï¼šè¢«æ‹¦æˆªçš„ç›®æ ‡ç±»æˆ–æ¥å£ã€‚åœ¨è¿™é‡Œï¼ŒStatementHandler.class è¡¨ç¤ºæ‹¦æˆª MyBatis ä¸­çš„ StatementHandler ç±»ã€‚</p><p>methodï¼šè¢«æ‹¦æˆªçš„æ–¹æ³•åã€‚å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æŒ‡å®šæ–¹æ³•åæˆ–ä½¿ç”¨æ–¹æ³•å¼•ç”¨ã€‚</p><p>argsï¼šè¢«æ‹¦æˆªæ–¹æ³•çš„å‚æ•°ç±»å‹æ•°ç»„ã€‚ç”¨äºæŒ‡å®šè¢«æ‹¦æˆªæ–¹æ³•çš„å‚æ•°ç±»å‹åŠé¡ºåºã€‚åœ¨ä»¥ä¸‹ä»£ç ä¸­çš„æ³¨è§£ç¤ºä¾‹ä¸­ï¼Œæ‹¦æˆªå™¨æŒ‡å®šäº†å¯¹ StatementHandler ç±»ä¸­çš„ä¸‰ä¸ªæ–¹æ³•è¿›è¡Œæ‹¦æˆªï¼Œåˆ†åˆ«æ˜¯ï¼š</p><p>query(Statement.class, ResultHandler.class)ï¼šæ‹¦æˆª StatementHandler ç±»ä¸­çš„ query æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ Statement å’Œ ResultHandlerã€‚</p><p>update(Statement.class)ï¼šæ‹¦æˆª StatementHandler ç±»ä¸­çš„ update æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°ï¼Œå³ Statementã€‚</p><p>batch(Statement.class)ï¼šæ‹¦æˆª StatementHandler ç±»ä¸­çš„ batch æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå³ Statementã€‚</p><p>é€šè¿‡ä½¿ç”¨ @Intercepts æ³¨è§£å’Œ @Signature æ³¨è§£ï¼Œå¯ä»¥ç²¾ç¡®åœ°æŒ‡å®šè¦æ‹¦æˆªçš„æ–¹æ³•å’Œå‚æ•°ç±»å‹ï¼Œä»è€Œå®ç°å¯¹ç‰¹å®šæ–¹æ³•çš„æ‹¦æˆªå’Œå¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.demo.comfangdemoupm.Interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.cloud.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.reflect.FieldUtils;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.ObjectUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.parameter.ParameterHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.BoundSql;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.ParameterMapping;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.ParameterMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Intercepts;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Invocation;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Signature;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.ResultHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.TypeHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> MybatisSqlInterceptor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> Mybatis-Plus è‡ªå®šä¹‰SQLæ‹¦æˆªå¤„ç†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-07-24</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">        @Signature(type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">                method = &quot;query&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;Statement.class, ResultHandler.class&#125;),</span></span><br><span class="line"><span class="meta">        @Signature(</span></span><br><span class="line"><span class="meta">                type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">                method = &quot;update&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;Statement.class&#125;</span></span><br><span class="line"><span class="meta">        ),</span></span><br><span class="line"><span class="meta">        @Signature(</span></span><br><span class="line"><span class="meta">        type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">        method = &quot;batch&quot;,</span></span><br><span class="line"><span class="meta">        args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisSqlInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ä¸€ä¸ªåŒ…å«éœ€è¦æ·»åŠ å•å¼•å·æ‹¬èµ·æ¥çš„å‚æ•°ç±»å‹é›†åˆã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; NEED_BRACKETS =</span><br><span class="line">            Collections.unmodifiableSet(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;String&quot;</span>, <span class="string">&quot;Date&quot;</span>, <span class="string">&quot;Time&quot;</span>, <span class="string">&quot;LocalDate&quot;</span>, <span class="string">&quot;LocalTime&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;LocalDateTime&quot;</span>, <span class="string">&quot;BigDecimal&quot;</span>, <span class="string">&quot;Timestamp&quot;</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * MyBatisçš„é…ç½®å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> invocation.getTarget();</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–è¡Œæ•°ä¸º 1</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">lines</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// é»˜è®¤çŠ¶æ€ä¸º &quot;å¤±è´¥&quot;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> <span class="string">&quot;failed&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡ŒåŸå§‹æ–¹æ³•ï¼Œå¹¶è·å–è¿”å›ç»“æœ</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line">            <span class="comment">// å¦‚æœè¿”å›ç»“æœä¸ºé›†åˆï¼Œåˆ™ç»Ÿè®¡è¡Œæ•°</span></span><br><span class="line">            <span class="keyword">if</span> (proceed <span class="keyword">instanceof</span> Collection&lt;?&gt;) &#123;</span><br><span class="line">                lines = ((List&lt;?&gt;) proceed).size();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰§è¡ŒæˆåŠŸï¼Œå°†çŠ¶æ€è®¾ç½®ä¸º &quot;æˆåŠŸ&quot;</span></span><br><span class="line">            status = <span class="string">&quot;success&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> proceed;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// è®¡ç®— SQL æ‰§è¡Œè€—æ—¶</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">sqlCost</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">            <span class="comment">// è·å– SQL è¯­å¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="built_in">this</span>.getSql(target);</span><br><span class="line">            <span class="comment">// æ‰“å°æ—¥å¿—</span></span><br><span class="line">            log.info(<span class="string">&quot;\u001B[38;5;220mSQL æ‰§è¡Œç»“æœï¼š&#123;&#125;. SQL ä¿¡æ¯ï¼š&#123;&#125;\u001B[0m&quot;</span>, status, sql);</span><br><span class="line">            log.info(<span class="string">&quot;\u001B[38;5;220mè€—æ—¶ï¼š&#123;&#125; mm. Totalï¼š&#123;&#125;\u001B[0m&quot;</span>, sqlCost, lines);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> è·å–å³å°†ä¼šæ‰§è¡Œçš„SQLè¯­å¥ å¹¶æŠŠå‚æ•°æ’å…¥åˆ°SQLè¯­å¥ä¸­</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> target</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> String &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/7/24</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getSql</span><span class="params">(Object target)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// è·å– StatementHandler å¯¹è±¡</span></span><br><span class="line">            <span class="type">StatementHandler</span> <span class="variable">statementHandler</span> <span class="operator">=</span> (StatementHandler) target;</span><br><span class="line">            <span class="comment">// è·å– BoundSql å¯¹è±¡</span></span><br><span class="line">            <span class="comment">// BoundSqlå¯¹è±¡ä¸­å¸¦æœ‰å³å°†æ‰§è¡Œçš„SQLè¯­å¥å’ŒSQLå‚æ•°</span></span><br><span class="line">            <span class="type">BoundSql</span> <span class="variable">boundSql</span> <span class="operator">=</span> statementHandler.getBoundSql();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(ObjectUtils.isNull(configuration))&#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">ParameterHandler</span> <span class="variable">parameterHandler</span> <span class="operator">=</span> statementHandler.getParameterHandler();</span><br><span class="line">                <span class="built_in">this</span>.configuration = (Configuration) FieldUtils.readField(parameterHandler, <span class="string">&quot;configuration&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> formatSql(boundSql,configuration);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            log.warn(<span class="string">&quot;è·å– SQL è¯­å¥å¤±è´¥ï¼š&#123;&#125;&quot;</span>, target, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;æ— æ³•è§£æçš„ SQL è¯­å¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">formatSql</span><span class="params">(BoundSql boundSql,Configuration configuration)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> boundSql.getSql();</span><br><span class="line">        <span class="comment">// è·å–å‚æ•°æ˜ å°„åˆ—è¡¨</span></span><br><span class="line">        List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</span><br><span class="line">        <span class="comment">// è·å–å‚æ•°å¯¹è±¡</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">parameterObject</span> <span class="operator">=</span> boundSql.getParameterObject();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(sql) || Objects.isNull(configuration)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å– TypeHandlerRegistry å¯¹è±¡</span></span><br><span class="line">        <span class="type">TypeHandlerRegistry</span> <span class="variable">typeHandlerRegistry</span> <span class="operator">=</span> configuration.getTypeHandlerRegistry();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»é™¤ SQL å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰</span></span><br><span class="line">        sql = sql.replaceAll(<span class="string">&quot;[\n\r ]+&quot;</span>, <span class="string">&quot; &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿‡æ»¤æ‰è¾“å‡ºå‚æ•°çš„å‚æ•°æ˜ å°„</span></span><br><span class="line">        <span class="keyword">if</span> (parameterMappings == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> sql;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        parameterMappings = parameterMappings.stream()</span><br><span class="line">                .filter(it -&gt; it.getMode() != ParameterMode.OUT)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ StringBuilder ä¿å­˜æ ¼å¼åŒ–åçš„ SQL</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(sql);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£æé—®å·å¹¶æ›¿æ¢å‚æ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> result.length(); i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.charAt(i - <span class="number">1</span>) != <span class="string">&#x27;?&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ParameterMapping</span> <span class="variable">parameterMapping</span> <span class="operator">=</span> parameterMappings.get(parameterMappings.size() - <span class="number">1</span>);</span><br><span class="line">            Object value;</span><br><span class="line">            <span class="type">String</span> <span class="variable">propertyName</span> <span class="operator">=</span> parameterMapping.getProperty();</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ç»‘å®šçš„é™„åŠ å‚æ•°ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å±æ€§å</span></span><br><span class="line">            <span class="keyword">if</span> (boundSql.hasAdditionalParameter(propertyName)) &#123;</span><br><span class="line">                value = boundSql.getAdditionalParameter(propertyName);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parameterObject == <span class="literal">null</span>) &#123;</span><br><span class="line">                value = <span class="literal">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123;</span><br><span class="line">                value = parameterObject;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨ MetaObject è·å–å±æ€§å€¼</span></span><br><span class="line">                <span class="type">MetaObject</span> <span class="variable">metaObject</span> <span class="operator">=</span> configuration.newMetaObject(parameterObject);</span><br><span class="line">                value = metaObject.getValue(propertyName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// åˆ¤æ–­å‚æ•°ç±»å‹ï¼Œå¦‚æœæ˜¯éœ€è¦æ·»åŠ æ‹¬å·çš„ç±»å‹ï¼Œåˆ™æ·»åŠ å•å¼•å·</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> value.getClass().getSimpleName();</span><br><span class="line">                <span class="keyword">if</span> (NEED_BRACKETS.contains(type)) &#123;</span><br><span class="line">                    result.replace(i - <span class="number">1</span>, i, <span class="string">&quot;&#x27;&quot;</span> + value + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    result.replace(i - <span class="number">1</span>, i, value.toString());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å‚æ•°å€¼ä¸ºç©ºæ—¶ï¼Œæ›¿æ¢ä¸º &quot;null&quot;</span></span><br><span class="line">                result.replace(i - <span class="number">1</span>, i, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ç§»é™¤å·²å¤„ç†çš„å‚æ•°æ˜ å°„</span></span><br><span class="line">            parameterMappings.remove(parameterMappings.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;Mybatis-Plus æ‹¦æˆªSQL:&#123;&#125;&quot;</span>,result.toString());</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è„šæ‰‹æ¶ä»‹ç»"><a href="#è„šæ‰‹æ¶ä»‹ç»" class="headerlink" title="è„šæ‰‹æ¶ä»‹ç»"></a>è„šæ‰‹æ¶ä»‹ç»</h2><h3 id="com-fang-demo-maven"><a href="#com-fang-demo-maven" class="headerlink" title="com-fang-demo-maven"></a>com-fang-demo-maven</h3><p>æ˜¯æ•´ä¸ªé¡¹ç›®çš„çˆ¶pomæ–‡ä»¶ï¼Œæ‰€æœ‰çš„ä¾èµ–å’Œç‰ˆæœ¬éƒ½ä¼šåœ¨è¿™é‡Œè¿›è¡Œç»´æŠ¤</p><h3 id="com-fang-demo-nacos"><a href="#com-fang-demo-nacos" class="headerlink" title="com-fang-demo-nacos"></a>com-fang-demo-nacos</h3><p>æºç è¿è¡ŒNacosï¼Œæ–¹ä¾¿å¼€å‘</p><h3 id="com-fang-demo-gateway"><a href="#com-fang-demo-gateway" class="headerlink" title="com-fang-demo-gateway"></a>com-fang-demo-gateway</h3><p>ç½‘å…³ï¼Œå…¶ä¸­é›†æˆäº†Spring Securityï¼Œå¯¹æ— ç™»é™†çŠ¶æ€&amp;æ— æƒé™çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œæ— æƒé™å¤„ç†é€»è¾‘æš‚æœªå†™ï¼Œåç»­å¯æ ¹æ®å®é™…æƒ…å†µè‡ªå®šä¹‰</p><h3 id="com-fang-demo-upm"><a href="#com-fang-demo-upm" class="headerlink" title="com-fang-demo-upm"></a>com-fang-demo-upm</h3><p>ç”¨æˆ·ç®¡ç† æˆ–è€… åå°ç®¡ç† æˆ–è€… å…·ä½“çš„ä¸šåŠ¡æ¨¡å—ï¼Œä½†æ˜¯æœ€å¥½æ”¾åœ¨com-fang-demo-platformä¸­</p><h3 id="com-fang-demo-communal"><a href="#com-fang-demo-communal" class="headerlink" title="com-fang-demo-communal"></a>com-fang-demo-communal</h3><p>å…¬å…±æ¨¡å—ï¼Œä¸€èˆ¬æ”¾ç½®å…¬å…±æ¥å£ä»¥ä¾›Dubboè°ƒç”¨ï¼Œæˆ–è€…æ”¾ç½®ä¸€äº›å…¬å…±çš„å·¥å…·ç±»ã€é…ç½®ç±»ç­‰ç­‰</p><h3 id="com-fang-demo-domin"><a href="#com-fang-demo-domin" class="headerlink" title="com-fang-demo-domin"></a>com-fang-demo-domin</h3><p>å®ä½“ç±»å­˜æ”¾ä½ç½®ï¼ŒPOã€DTO and VO ç­‰</p><h2 id="å‹åŠ›æµ‹è¯•"><a href="#å‹åŠ›æµ‹è¯•" class="headerlink" title="å‹åŠ›æµ‹è¯•"></a>å‹åŠ›æµ‹è¯•</h2><ol><li><a href="https://blog.csdn.net/nhb687096/article/details/136451264?ops_request_misc=&request_id=&biz_id=102&utm_term=%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-136451264.nonecase&spm=1018.2226.3001.4187">ä»€ä¹ˆæ˜¯å‹åŠ›æµ‹è¯•ï¼Ÿå¦‚ä½•è¿›è¡ŒJmeterå‹åŠ›æµ‹è¯•</a></li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>50 æ—¥å¿—ç³»ç»Ÿ</title>
      <link href="/2025/02/26/50%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/"/>
      <url>/2025/02/26/50%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="50-æ—¥å¿—ç³»ç»Ÿ"><a href="#50-æ—¥å¿—ç³»ç»Ÿ" class="headerlink" title="50 æ—¥å¿—ç³»ç»Ÿ"></a>50 æ—¥å¿—ç³»ç»Ÿ</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/m0_60353039/article/details/131532602">ã€Spring Bootã€‘Spring Bootæ—¥å¿—è¯¦æƒ…ï¼šåŸºäºlombokçš„æ—¥å¿—è¾“å‡º</a></li></ol><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>æ—¥å¿—æ–‡ä»¶å°±æ˜¯å¸®åŠ©æˆ‘ä»¬è®°å½•ç¨‹åºå¼€å‘æˆ–è€…ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›å¿…è¦ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬è¿›è¡ŒåæœŸçš„ç»´æŠ¤å’Œçº é”™</strong></p><p>æ€»ä¹‹ï¼Œæ—¥å¿—æ˜¯å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿæ’æŸ¥é—®é¢˜ï¼Œä¼˜åŒ–æ€§èƒ½ï¼Œå¹¶ä¿è¯åº”ç”¨ç¨‹åºçš„å®‰å…¨å’Œå¯é æ€§ã€‚</p><h2 id="æ—¥å¿—çº§åˆ«"><a href="#æ—¥å¿—çº§åˆ«" class="headerlink" title="æ—¥å¿—çº§åˆ«"></a>æ—¥å¿—çº§åˆ«</h2><p>â½‡å¿—çš„çº§åˆ«åˆ†ä¸ºï¼š</p><ol><li>traceï¼šå¾®é‡ï¼Œå°‘è®¸çš„æ„æ€ï¼Œçº§åˆ«æœ€ä½ï¼›</li><li>debugï¼šéœ€è¦è°ƒè¯•æ—¶å€™çš„å…³é”®ä¿¡æ¯æ‰“å°ï¼›</li><li>infoï¼šæ™®é€šçš„æ‰“å°ä¿¡æ¯ï¼ˆé»˜è®¤â½‡å¿—çº§åˆ«ï¼‰ï¼›</li><li>warnï¼šè­¦å‘Šï¼Œä¸å½±å“ä½¿â½¤ï¼Œä½†éœ€è¦æ³¨æ„çš„é—®é¢˜ï¼›</li><li>errorï¼šé”™è¯¯ä¿¡æ¯ï¼Œçº§åˆ«è¾ƒâ¾¼çš„é”™è¯¯â½‡å¿—ä¿¡æ¯ï¼›</li><li>fatalï¼šè‡´å‘½çš„ï¼Œå› ä¸ºä»£ç å¼‚å¸¸å¯¼è‡´ç¨‹åºé€€å‡ºæ‰§â¾çš„äº‹ä»¶ã€‚</li></ol><h2 id="æ—¥å¿—çº§åˆ«çš„è®¾ç½®"><a href="#æ—¥å¿—çº§åˆ«çš„è®¾ç½®" class="headerlink" title="æ—¥å¿—çº§åˆ«çš„è®¾ç½®"></a>æ—¥å¿—çº§åˆ«çš„è®¾ç½®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¥å¿—çº§åˆ«è®¾ç½®</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">error</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ—¥å¿—æŒä¹…åŒ–"><a href="#æ—¥å¿—æŒä¹…åŒ–" class="headerlink" title="æ—¥å¿—æŒä¹…åŒ–"></a>æ—¥å¿—æŒä¹…åŒ–</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„ç›®å½•</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">D:\\home\\log</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">D:\\home\\log\\spring-1024.log</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="lombok"><a href="#lombok" class="headerlink" title="lombok"></a>lombok</h2><p>Lombok æ˜¯ä¸€ç§ Java åº“ï¼Œå®ƒæä¾›äº†ä¸€äº›æ³¨è§£æ¥è‡ªåŠ¨ç”Ÿæˆ Java ä»£ç ã€‚Lombok çš„åŸç†æ˜¯åœ¨ç¼–è¯‘æ—¶é€šè¿‡ Java çš„æ³¨è§£å¤„ç†å™¨å’Œ ASTï¼ˆAbstract Syntax Treeï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼‰è½¬æ¢å™¨ä»£æ›¿å¼€å‘äººå‘˜æ‰‹åŠ¨ç¼–å†™å¸¸è§çš„ Java ä»£ç ï¼ˆå¦‚æ„é€ å‡½æ•°ã€getter å’Œ setter æ–¹æ³•ã€equals å’Œ hashCode æ–¹æ³•ç­‰ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒLombok åœ¨ç¼–è¯‘æœŸé—´ç”Ÿæˆä»£ç ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆã€‚ Lombok çš„ä½¿ç”¨å¯ä»¥èŠ‚çœå¼€å‘è€…åœ¨ç¼–å†™ Java ä»£ç æ—¶çš„æ—¶é—´å’Œç²¾åŠ›ï¼Œå¹¶ä¸”å¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´æ˜“æ‡‚ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261958381.png" alt="img"></p><h3 id="xmlé…ç½®"><a href="#xmlé…ç½®" class="headerlink" title="xmlé…ç½®"></a>xmlé…ç½®</h3><p><strong>logback.xmlçš„åŠ è½½é¡ºåºæ—©äºspringbootçš„application.yml (æˆ–application.properties) é…ç½®æ–‡ä»¶å½“ç„¶è¯»ä¸åˆ°application.ymlï¼ˆæˆ–application.propertiesï¼‰æ–‡ä»¶ä¸­çš„å€¼äº†ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;springProperty scope=&quot;context&quot; name=&quot;application_name&quot; source=&quot;spring.application.name&quot; /&gt;</span><br></pre></td></tr></table></figure><p>éœ€è¦é€šè¿‡springPropertyæ ‡ç­¾æ¥å¼•ç”¨ï¼š<springProperty scope="context" name="log.path" source="path.log"/>è¿™é‡Œçš„nameå’Œä¸Šé¢propertyæ ‡ç­¾ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    å°æŠ€å·§: åœ¨æ ¹pomé‡Œé¢è®¾ç½®ç»Ÿä¸€å­˜æ”¾è·¯å¾„ï¼Œç»Ÿä¸€ç®¡ç†æ–¹ä¾¿ç»´æŠ¤</span></span><br><span class="line"><span class="comment">    &lt;properties&gt;</span></span><br><span class="line"><span class="comment">        &lt;log-path&gt;/Users/chao.lu&lt;/log-path&gt;</span></span><br><span class="line"><span class="comment">    &lt;/properties&gt;</span></span><br><span class="line"><span class="comment">    1. å…¶ä»–æ¨¡å—åŠ æ—¥å¿—è¾“å‡ºï¼Œç›´æ¥copyæœ¬æ–‡ä»¶æ”¾åœ¨resources ç›®å½•å³å¯</span></span><br><span class="line"><span class="comment">    2. æ³¨æ„ä¿®æ”¹ &lt;property name=&quot;$&#123;log-path&#125;/log.path&quot; value=&quot;&quot;/&gt; çš„valueæ¨¡å—</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span> <span class="attr">scan</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;application_name&quot;</span> <span class="attr">source</span>=<span class="string">&quot;spring.application.name&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log.path&quot;</span> <span class="attr">value</span>=<span class="string">&quot;./log/$&#123;application_name&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å½©è‰²æ—¥å¿—æ ¼å¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE_LOG_PATTERN&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">value</span>=<span class="string">&quot;$&#123;CONSOLE_LOG_PATTERN:-%clr(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å½©è‰²æ—¥å¿—ä¾èµ–çš„æ¸²æŸ“ç±» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">&quot;clr&quot;</span> <span class="attr">converterClass</span>=<span class="string">&quot;org.springframework.boot.logging.logback.ColorConverter&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">&quot;wex&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">converterClass</span>=<span class="string">&quot;org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">&quot;wEx&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">converterClass</span>=<span class="string">&quot;org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Console log output --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Log file debug output --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/debug.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/%d&#123;yyyy-MM, aux&#125;/debug.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>50MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date [%thread] %-5level [%logger&#123;50&#125;] %file:%line - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">level</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Log file info output --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;info&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/%d&#123;yyyy-MM, aux&#125;/info.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>50MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date [%thread] %-5level [%logger&#123;50&#125;] %file:%line - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Log file error output --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;error&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/%d&#123;yyyy-MM&#125;/error.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>50MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date [%thread] %-5level [%logger&#123;50&#125;] %file:%line - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--nacos å¿ƒè·³ INFO å±è”½--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.alibaba.nacos&quot;</span> <span class="attr">level</span>=<span class="string">&quot;OFF&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;error&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Level: FATAL 0  ERROR 3  WARN 4  INFO 6  DEBUG 7 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;debug&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;error&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;info&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>48 Redis</title>
      <link href="/2025/02/26/48%20Redis/"/>
      <url>/2025/02/26/48%20Redis/</url>
      
        <content type="html"><![CDATA[<h1 id="48-Redis"><a href="#48-Redis" class="headerlink" title="48 Redis"></a>48 Redis</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Redisï¼ˆRemote Dictionary Server )ï¼Œå³è¿œç¨‹å­—å…¸æœåŠ¡ã€‚æ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯<strong>æŒä¹…åŒ–</strong>çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚</p><p>redisä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†master-slave(ä¸»ä»)åŒæ­¥ã€‚</p><p>å…è´¹å’Œå¼€æºï¼æ˜¯å½“ä¸‹æœ€çƒ­é—¨çš„ NoSQL æŠ€æœ¯ä¹‹ä¸€ï¼ä¹Ÿè¢«äººä»¬ç§°ä¹‹ä¸º<strong>ç»“æ„åŒ–æ•°æ®åº“</strong>ï¼</p><ul><li>Redisèƒ½å¹²å˜›ï¼Ÿ<br>1ã€å†…å­˜å­˜å‚¨ã€æŒä¹…åŒ–ï¼Œå†…å­˜ä¸­æ˜¯æ–­ç”µå³å¤±ã€æ‰€ä»¥è¯´æŒä¹…åŒ–å¾ˆé‡è¦ï¼ˆrdbã€aofï¼‰ 2ã€æ•ˆç‡é«˜ï¼Œå¯ä»¥ç”¨äºé«˜é€Ÿç¼“å­˜<br>3ã€å‘å¸ƒè®¢é˜…ç³»ç»Ÿ<br>4ã€åœ°å›¾ä¿¡æ¯åˆ†æ<br>5ã€è®¡æ—¶å™¨ã€è®¡æ•°å™¨ï¼ˆæµè§ˆé‡ï¼ï¼‰<br>6ã€â€¦</li></ul><h2 id="åˆ†å¸ƒå¼ç¼“å­˜"><a href="#åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜"></a>åˆ†å¸ƒå¼ç¼“å­˜</h2><h3 id="æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ"><a href="#æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ" class="headerlink" title="æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ"></a>æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ</h3><ul><li>Memcached</li><li>Redis</li></ul><p>æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯Redisï¼Œåˆ†å¸ƒå¼ç¼“å­˜ä¸»è¦è§£å†³çš„æ˜¯å•æœºç¼“å­˜çš„å®¹é‡å—æœåŠ¡å™¨é™åˆ¶å¹¶ä¸”æ— æ³•ä¿å­˜é€šç”¨ä¿¡æ¯çš„é—®é¢˜ï¼Œå› ä¸ºæœ¬åœ°ç¼“å­˜åªåœ¨å½“å‰æœåŠ¡é‡Œæœ‰æ•ˆï¼Œæ¯”å¦‚ä½ éƒ¨ç½²äº†ä¸¤ä¸ªç›¸åŒçš„æœåŠ¡åœ¨ä¸¤ä¸ªä¸åŒçš„ç‰©ç†æœºä¸Šï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç¼“å­˜æ•°æ®æ˜¯æ— æ³•å…±åŒçš„ã€‚</p><p>å®ƒä»¬ä¸¤ä¸ªçš„åŒºåˆ«ä¸»è¦å°±æ˜¯åœ¨Redisæ”¯æŒæŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ï¼Œè€ŒMemcachedå¹¶ä¸æ”¯æŒæŒä¹…åŒ–ï¼Œä¸€æ—¦é‡å¯ï¼Œå†…å­˜ä¸­çš„æ•°æ®ä¼šä¸¢å¤±ã€‚</p><p>è€Œä¸”Redisçš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œæ¯”å¦‚Rediså°±å…·æœ‰æ›´å¤šçš„æ•°æ®ç±»å‹ï¼ˆkvï¼Œlistï¼Œsetï¼Œhashç­‰ï¼‰ </p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦å†é¡¹ç›®ä¸­ä½¿ç”¨ç¼“å­˜å‘¢ï¼Ÿæˆ‘ä»¬ä»é«˜å¹¶å‘å’Œé«˜æ€§èƒ½çš„è§’åº¦æ¥åˆ†æè¿™ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éƒ½æ¸…æ¥šå†…å­˜ä¸­çš„æ•°æ®è¯»å–å’Œå†™å…¥æ˜¯æ˜æ˜¾å¿«äºç¡¬ç›˜çš„ï¼Œé‚£ä¹ˆå¦‚æœå¯¹äºä¸€ä¸ªé¡¹ç›®æ¥è¯´ï¼Œå®ƒå¯¹æŸä¸ªæ•°æ®å…·æœ‰å¤§é‡çš„è®¿é—®ï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡éƒ½éœ€è¦ä»ç¡¬ç›˜ä¹Ÿå°±æ˜¯æ•°æ®åº“ä¸­è¯»å–ï¼Œé‚£ä¹ˆå…¶æ•ˆç‡ä¼šå¾ˆä½ï¼Œè€Œç°åœ¨æœ‰ä¸€ä¸ªæ•°æ®åº“æ˜¯è¿è¡Œåœ¨å†…å­˜ä¸­çš„ï¼Œæ¯æ¬¡è¯»å–éƒ½ç›´æ¥åœ¨å†…å­˜ä¸­æ“ä½œï¼Œå…¶é€Ÿåº¦è‚¯å®šæ˜¯ä¼˜äºå¤–å­˜çš„ï¼Œè¿™å°±æ˜¯é«˜æ€§èƒ½ï¼›é‚£å¯¹äºé«˜å¹¶å‘å‘¢ï¼Ÿä¹Ÿå“¼æ˜æ˜¾ï¼Œå†…å­˜çš„å¹¶å‘é‡QPSè‚¯å®šæ˜¯é«˜äºå¤–å­˜ï¼ŒRedisçš„QPSå¯ä»¥è¾¾åˆ°30W+ï¼Œè€ŒMySQLä¹‹ç±»çš„æ•°æ®åº“çš„QPSå¤§æ¦‚åœ¨10W+å·¦å³ã€‚</p><h2 id="Redisç”¨é€”"><a href="#Redisç”¨é€”" class="headerlink" title="Redisç”¨é€”"></a>Redisç”¨é€”</h2><ul><li>ç”¨äºç¼“å­˜</li><li>ç”¨äºåˆ†å¸ƒå¼é”</li><li>é™æµ</li><li>æ¶ˆæ¯é˜Ÿåˆ—</li><li>å¤æ‚ä¸šåŠ¡åœºæ™¯</li></ul><h3 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/fuzhongmin05/article/details/119251590?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522D3B5136A-DFFF-4ADD-826B-4D77DB204146%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=D3B5136A-DFFF-4ADD-826B-4D77DB204146&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-119251590-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=Redis%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81&spm=1018.2226.3001.4187">å¦‚ä½•ç”¨Rediså®ç°åˆ†å¸ƒå¼é”</a></p><h4 id="åœºæ™¯æè¿°"><a href="#åœºæ™¯æè¿°" class="headerlink" title="åœºæ™¯æè¿°"></a>åœºæ™¯æè¿°</h4><p>å‡è®¾æˆ‘ä»¬åœ¨ä¸€ä¸ªç”µå•†å¹³å°ä¸Šé‡åˆ°ä¸€ä¸ªâ€œç§’æ€â€æ´»åŠ¨ï¼Œç”¨æˆ·åœ¨åŒä¸€æ—¶é—´æ®µå†…æŠ¢è´­é™é‡å•†å“ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªç”¨æˆ·èƒ½å¤Ÿè´­ä¹°åˆ°åŒä¸€ä»¶å•†å“ï¼Œè€Œä¸æ˜¯å¤šä¸ªç”¨æˆ·åŒæ—¶è´­ä¹°å¯¼è‡´è¶…å–ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼ŒRedis åˆ†å¸ƒå¼é”æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h4><p>Redis æä¾›äº†ä¸€ä¸ªç®€å•çš„<strong>SETNX</strong>ï¼ˆSET if Not Existsï¼‰å‘½ä»¤ï¼Œå¯ä»¥ç”¨äºå®ç°åˆ†å¸ƒå¼é”ã€‚</p><ul><li><p><strong>æ­¥éª¤1</strong>ï¼šç”¨æˆ·è¯·æ±‚æŠ¢è´­å•†å“æ—¶ï¼Œé¦–å…ˆä½¿ç”¨ <code>SETNX</code>ï¼ˆSET if Not Existsï¼‰å‘½ä»¤æ¥åŠ é”ï¼Œè¡¨ç¤ºè¯¥å•†å“æ­£åœ¨è¢«å¤„ç†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETNX lock:product:1001 1</span><br></pre></td></tr></table></figure></li><li><p><strong>æ­¥éª¤2</strong>ï¼šå¦‚æœ <code>SETNX</code> è¿”å› <code>1</code>ï¼Œè¡¨ç¤ºæˆåŠŸè·å¾—é”ï¼Œå¯ä»¥ç»§ç»­å¤„ç†è®¢å•é€»è¾‘ã€‚</p></li><li><p><strong>æ­¥éª¤3</strong>ï¼šåœ¨å¤„ç†è®¢å•å®Œæˆåï¼Œé€šè¿‡ <code>DEL</code> å‘½ä»¤é‡Šæ”¾é”ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEL lock:product:1001</span><br></pre></td></tr></table></figure></li><li><p><strong>é˜²æ­¢æ­»é”</strong>ï¼šå¯ä»¥ä¸ºé”è®¾ç½®ä¸€ä¸ªè‡ªåŠ¨è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢ç”±äºæœåŠ¡å¼‚å¸¸å¯¼è‡´é”æœªèƒ½é‡Šæ”¾çš„é—®é¢˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET lock:product:1001 1 EX 10 NX</span><br></pre></td></tr></table></figure></li></ul><p>è¿™æ ·ï¼ŒRedis çš„åˆ†å¸ƒå¼é”ç¡®ä¿äº†é«˜å¹¶å‘åœºæ™¯ä¸‹çš„èµ„æºç‹¬å ï¼Œé¿å…äº†è¶…å–æˆ–åº“å­˜ä¸è¶³çš„é—®é¢˜ã€‚</p><p>å¯¹äºä½¿ç”¨Redisä½œä¸ºåˆ†å¸ƒå¼é”çš„è¯ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œä¸‹é¢å°±æ˜¯å¯¹è¿™äº›é—®é¢˜çš„ä¸€äº›ç®€å•çš„ä»‹ç»ã€‚</p><p>åœ¨ä¸Šé¢æ‰€ä»‹ç»çš„å¦‚æœç›´æ¥åŠ é”çš„è¯ï¼Œé‚£ä¹ˆå¦‚æœåœ¨ç¨‹åºåŠ é”ä¹‹åï¼Œå¦‚æœç¨‹åºç«¯å‡ºç°äº†å¼‚å¸¸ï¼Œå¯¼è‡´é”æ²¡æœ‰æ¥å¾—åŠé‡Šæ”¾ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æ­»é”ã€‚</p><p>ä¸ºäº†é¿å…æ­»é”ï¼Œæ‰€ä»¥ä¸ºä¸ºè¯¥é”æ·»åŠ äº†ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆç¨‹åºå´©æºƒä¹‹åï¼Œè¾¾åˆ°è¿‡æœŸæ—¶é—´ä¹‹åï¼Œè¯¥é”å°±ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œè¿™æ ·æ­»é”é—®é¢˜å°±è§£å†³äº†ã€‚</p><p>æ€»ä¹‹è¿™ä¸¤æ¡å‘½ä»¤å¦‚æœä¸èƒ½ä¿è¯æ˜¯åŸå­æ“ä½œï¼Œå°±æœ‰æ½œåœ¨çš„é£é™©å¯¼è‡´è¿‡æœŸæ—¶é—´è®¾ç½®å¤±è´¥ï¼Œä¾æ—§æœ‰å¯èƒ½å‘ç”Ÿæ­»é”é—®é¢˜ã€‚å¹¸å¥½åœ¨Redis 2.6.12ä¹‹åï¼ŒRedisæ‰©å±•äº†SETå‘½ä»¤çš„å‚æ•°ï¼Œå¯ä»¥åœ¨SETçš„åŒæ—¶æŒ‡å®šEXPIREæ—¶é—´ï¼Œè¿™æ¡æ“ä½œæ˜¯åŸå­çš„ï¼Œä¾‹å¦‚ä»¥ä¸‹å‘½ä»¤æ˜¯è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ä¸º10ç§’ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET lock_key 1 EX 10 NX</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·å°±ä¼šå¯¼è‡´å‡ºç°ä¸€äº›é—®é¢˜</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261956542.png" alt="image-20240910150402014"></p><p>è¿™é‡Œå­˜åœ¨ä¸¤ä¸ªä¸¥é‡çš„é—®é¢˜ï¼š</p><ul><li>é”è¿‡æœŸ</li><li>é‡Šæ”¾äº†åˆ«äººçš„é”</li></ul><p><strong>ä¸ºäº†é¿å…é‡Šæ”¾äº†åˆ«äººçš„é”</strong>ï¼Œè§£å†³åŠæ³•æ˜¯ï¼Œè®¾ç½®åªæœ‰ä¸€ä¸ªè‡ªå·±çŸ¥é“çš„å”¯ä¸€æ ‡è¯†è¿›å»ï¼Œæ¯”å¦‚è‡ªå·±çš„çº¿ç¨‹IDã€‚</p><p>å¦‚æœæ˜¯rediså®ç°ï¼Œå°±æ˜¯SET key unique_value EX 10 NXã€‚ä¹‹ååœ¨é‡Šæ”¾é”æ—¶ï¼Œè¦å…ˆåˆ¤æ–­è¿™æŠŠé”æ˜¯å¦å½’è‡ªå·±æŒæœ‰ï¼Œåªæœ‰æ˜¯è‡ªå·±çš„æ‰èƒ½é‡Šæ”¾å®ƒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//é‡Šæ”¾é” æ¯”è¾ƒunique_valueæ˜¯å¦ç›¸ç­‰ï¼Œé¿å…è¯¯é‡Šæ”¾</span><br><span class="line">if redis.get(&quot;key&quot;) == unique_value then</span><br><span class="line">    return redis.del(&quot;key&quot;)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸¤ä¸ªæ“ä½œï¼Œä¸€ä¸ªæ˜¯getå’Œdelï¼Œé‚£ä¹ˆå°±åˆä¼šå‡ºç°åŸå­æ€§çš„é—®é¢˜ã€‚</p><blockquote><ol><li>å®¢æˆ·ç«¯1æ‰§è¡ŒGETï¼Œåˆ¤æ–­é”æ˜¯è‡ªå·±çš„</li><li>å®¢æˆ·ç«¯2æ‰§è¡Œäº†SETå‘½ä»¤ï¼Œå¼ºåˆ¶è·å–åˆ°é”ï¼ˆè™½ç„¶å‘ç”Ÿæ¦‚å¿µå¾ˆä½ï¼Œä½†è¦ä¸¥è°¨è€ƒè™‘é”çš„å®‰å…¨æ€§ï¼‰</li><li>å®¢æˆ·ç«¯1æ‰§è¡ŒDELï¼Œå´é‡Šæ”¾äº†å®¢æˆ·ç«¯2çš„é”</li></ol></blockquote><p>é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯é€šè¿‡Luaè„šæœ¬ï¼Œå¯ä»¥æŠŠä¸Šé¢çš„é€»è¾‘å†™æˆLuaè„šæœ¬ï¼Œè®©Redisæ‰§è¡Œï¼Œå› ä¸ºRediså¤„ç†æ¯ä¸ªè¯·æ±‚æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œåœ¨æ‰§è¡Œä¸€ä¸ªLuaè„šæœ¬å…¶å®ƒå¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°è¿™ä¸ªLuaè„šæœ¬å¤„ç†å®Œæˆï¼Œè¿™æ ·ä¸€æ¥get+delä¹‹é—´å°±åªèƒ½ç”¨ç”±ä¸€ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//Luaè„šæœ¬è¯­è¨€ï¼Œé‡Šæ”¾é” æ¯”è¾ƒunique_valueæ˜¯å¦ç›¸ç­‰ï¼Œé¿å…è¯¯é‡Šæ”¾</span><br><span class="line">if redis.call(&quot;get&quot;,KEYS[1]) == ARGV[1] then</span><br><span class="line">    return redis.call(&quot;del&quot;,KEYS[1])</span><br><span class="line">else</span><br><span class="line">    return 0</span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¯¥å¦‚ä½•ç¡®å®šé”çš„è¿‡æœŸæ—¶é—´å‘¢ï¼Ÿ</p><p>å‰é¢æåˆ°è¿‡ï¼Œè¿‡æœŸæ—¶é—´å¦‚æœè¯„ä¼°å¾—ä¸å¥½ï¼Œè¿™ä¸ªé”å°±ä¼šæœ‰æå‰è¿‡æœŸçš„é£é™©ï¼Œä¸€ç§å¦¥åçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå°½é‡å†—ä½™è¿‡æœŸæ—¶é—´ï¼Œé™ä½é”æå‰è¿‡æœŸçš„æ¦‚ç‡ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆå¹¶ä¸èƒ½å®Œç¾è§£å†³é—®é¢˜ã€‚æ˜¯å¦å¯ä»¥è®¾ç½®è¿™æ ·çš„æ–¹æ¡ˆï¼ŒåŠ é”æ—¶ï¼Œå…ˆè®¾ç½®ä¸€ä¸ªé¢„ä¼°çš„è¿‡æœŸæ—¶é—´ï¼Œç„¶åå¼€å¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œå®šæ—¶å»æ£€æµ‹è¿™ä¸ªé”çš„å¤±æ•ˆæ—¶é—´ï¼Œå¦‚æœé”å¿«è¦è¿‡æœŸäº†ï¼Œæ“ä½œå…±äº«èµ„æºè¿˜æœªå®Œæˆï¼Œé‚£ä¹ˆå°±è‡ªåŠ¨å¯¹é”è¿›è¡Œç»­æœŸï¼Œé‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p><p>è¿™æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆï¼Œå·²ç»æœ‰ä¸€ä¸ªåº“æŠŠè¿™äº›å·¥ä½œéƒ½å°è£…å¥½äº†ï¼Œå®ƒå°±æ˜¯Redissonã€‚Redissonæ˜¯ä¸€ä¸ªJavaè¯­è¨€å®ç°çš„Redis SDKå®¢æˆ·ç«¯ï¼Œåœ¨ä½¿ç”¨åˆ†å¸ƒå¼é”æ—¶ï¼Œå®ƒå°±é‡‡ç”¨äº†è‡ªåŠ¨ç»­æœŸçš„æ–¹æ¡ˆæ¥é¿å…é”è¿‡æœŸï¼Œè¿™ä¸ªå®ˆæŠ¤çº¿ç¨‹æˆ‘ä»¬ä¸€èˆ¬å«å®ƒçœ‹é—¨ç‹—çº¿ç¨‹ã€‚è¿™ä¸ªSDKæä¾›çš„APIéå¸¸å‹å¥½ï¼Œå®ƒå¯ä»¥åƒæ“ä½œæœ¬åœ°é”ä¸€æ ·æ“ä½œåˆ†å¸ƒå¼é”ã€‚å®¢æˆ·ç«¯ä¸€æ—¦åŠ é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogçœ‹é—¨ç‹—çº¿ç¨‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œä¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆè¿™æ®µæ—¶é—´çš„é•¿åº¦ä¸è®¾ç½®çš„é”çš„è¿‡æœŸæ—¶é—´æœ‰å…³ï¼‰æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœæ£€æŸ¥æ—¶å®¢æˆ·ç«¯è¿˜æŒæœ‰é”keyï¼ˆä¹Ÿå°±æ˜¯è¯´è¿˜åœ¨æ“ä½œå…±äº«èµ„æºï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šå»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261956345.png" alt="img"></p><h4 id="Rediså¸¸è§çš„éƒ¨ç½²æ–¹å¼å¯¹é”çš„å½±å“"><a href="#Rediså¸¸è§çš„éƒ¨ç½²æ–¹å¼å¯¹é”çš„å½±å“" class="headerlink" title="Rediså¸¸è§çš„éƒ¨ç½²æ–¹å¼å¯¹é”çš„å½±å“"></a>Rediså¸¸è§çš„éƒ¨ç½²æ–¹å¼å¯¹é”çš„å½±å“</h4><ul><li>å•æœºæ¨¡å¼ï¼›</li><li>ä¸»ä»æ¨¡å¼ï¼›</li><li>å“¨å…µï¼ˆsentinelï¼‰æ¨¡å¼ï¼›</li><li>é›†ç¾¤æ¨¡å¼ï¼›</li></ul><p>æˆ‘ä»¬ä½¿ç”¨Redisæ—¶ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨ä¸»ä»é›†ç¾¤+å“¨å…µçš„æ¨¡å¼éƒ¨ç½²ï¼Œå“¨å…µçš„ä½œç”¨å°±æ˜¯ç›‘æµ‹redisèŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€ã€‚æ™®é€šçš„ä¸»ä»æ¨¡å¼ï¼Œå½“masterå´©æºƒæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨åˆ‡æ¢è®©slaveæˆä¸ºmasterï¼Œä½¿ç”¨ä¸»ä»+å“¨å…µç»“åˆçš„å¥½å¤„åœ¨äºï¼Œå½“masterå¼‚å¸¸å®•æœºæ—¶ï¼Œå“¨å…µå¯ä»¥å®ç°æ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼ŒæŠŠslaveæå‡ä¸ºæ–°çš„masterï¼Œç»§ç»­æä¾›æœåŠ¡ï¼Œä»¥æ­¤ä¿è¯å¯ç”¨æ€§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261956331.png" alt="img"></p><ol><li><p>å®¢æˆ·ç«¯1åœ¨masterä¸Šæ‰§è¡ŒSETå‘½ä»¤ï¼ŒåŠ é”æˆåŠŸ</p></li><li><p>æ­¤æ—¶ï¼Œmasterå¼‚å¸¸å®•æœºï¼ŒSETå‘½ä»¤è¿˜æœªåŒæ­¥åˆ°slaveä¸Šï¼ˆä¸»ä»å¤åˆ¶æ˜¯å¼‚æ­¥çš„ï¼‰</p></li><li><p>å“¨å…µå°†slaveæå‡ä¸ºæ–°çš„masterï¼Œä½†è¿™ä¸ªé”åœ¨æ–°çš„masterä¸Šä¸¢å¤±äº†ï¼Œå¯¼è‡´å®¢æˆ·ç«¯2æ¥åŠ é”æˆåŠŸäº†ï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯å…±åŒæ“ä½œå…±äº«èµ„æº</p></li></ol><h4 id="é›†ç¾¤æ¨¡å¼-Redlockå®ç°é«˜å¯é çš„åˆ†å¸ƒå¼é”"><a href="#é›†ç¾¤æ¨¡å¼-Redlockå®ç°é«˜å¯é çš„åˆ†å¸ƒå¼é”" class="headerlink" title="é›†ç¾¤æ¨¡å¼+Redlockå®ç°é«˜å¯é çš„åˆ†å¸ƒå¼é”"></a>é›†ç¾¤æ¨¡å¼+Redlockå®ç°é«˜å¯é çš„åˆ†å¸ƒå¼é”</h4><p>ä¸ºäº†é¿å…Rediså®ä¾‹æ•…éšœè€Œå¯¼è‡´çš„é”æ— æ³•å·¥ä½œçš„é—®é¢˜ï¼ŒRedisçš„å¼€å‘è€… Antirezæå‡ºäº†åˆ†å¸ƒå¼é”ç®—æ³•Redlockã€‚Redlockç®—æ³•çš„åŸºæœ¬æ€è·¯ï¼Œæ˜¯è®©å®¢æˆ·ç«¯å’Œå¤šä¸ªç‹¬ç«‹çš„Rediså®ä¾‹ä¾æ¬¡è¯·æ±‚åŠ é”ï¼Œå¦‚æœå®¢æˆ·ç«¯èƒ½å¤Ÿå’ŒåŠæ•°ä»¥ä¸Šçš„å®ä¾‹æˆåŠŸåœ°å®ŒæˆåŠ é”æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºï¼Œå®¢æˆ·ç«¯æˆåŠŸåœ°è·å¾—åˆ†å¸ƒå¼é”äº†ï¼Œå¦åˆ™åŠ é”å¤±è´¥ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æœ‰å•ä¸ªRediså®ä¾‹å‘ç”Ÿæ•…éšœï¼Œå› ä¸ºé”å˜é‡åœ¨å…¶å®ƒå®ä¾‹ä¸Šä¹Ÿæœ‰ä¿å­˜ï¼Œæ‰€ä»¥ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æ­£å¸¸åœ°è¿›è¡Œé”æ“ä½œï¼Œé”å˜é‡å¹¶ä¸ä¼šä¸¢å¤±ã€‚</p><p>æ¥å…·ä½“çœ‹ä¸‹Redlockç®—æ³•çš„æ‰§è¡Œæ­¥éª¤ã€‚Redlockç®—æ³•çš„å®ç°è¦æ±‚Redisé‡‡ç”¨é›†ç¾¤éƒ¨ç½²æ¨¡å¼ï¼Œæ— å“¨å…µèŠ‚ç‚¹ï¼Œéœ€è¦æœ‰Nä¸ªç‹¬ç«‹çš„Rediså®ä¾‹ï¼ˆå®˜æ–¹æ¨èè‡³å°‘5ä¸ªå®ä¾‹ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æˆ3æ­¥æ¥å®ŒæˆåŠ é”æ“ä½œã€‚</p><ol><li><p>ç¬¬ä¸€æ­¥æ˜¯ï¼Œå®¢æˆ·ç«¯è·å–å½“å‰æ—¶é—´ã€‚</p></li><li><p>ç¬¬äºŒæ­¥æ˜¯ï¼Œå®¢æˆ·ç«¯æŒ‰é¡ºåºä¾æ¬¡å‘Nä¸ªRediså®ä¾‹æ‰§è¡ŒåŠ é”æ“ä½œã€‚</p></li></ol><p>è¿™é‡Œçš„åŠ é”æ“ä½œå’Œåœ¨å•å®ä¾‹ä¸Šæ‰§è¡Œçš„åŠ é”æ“ä½œä¸€æ ·ï¼Œä½¿ç”¨SETå‘½ä»¤ï¼Œå¸¦ä¸ŠNXã€EX&#x2F;PXé€‰é¡¹ï¼Œä»¥åŠå¸¦ä¸Šå®¢æˆ·ç«¯çš„å”¯ä¸€æ ‡è¯†ã€‚å½“ç„¶ï¼Œå¦‚æœæŸä¸ªRediså®ä¾‹å‘ç”Ÿæ•…éšœäº†ï¼Œä¸ºäº†ä¿è¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRedlockç®—æ³•èƒ½å¤Ÿç»§ç»­è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦ç»™åŠ é”æ“ä½œè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚å¦‚æœå®¢æˆ·ç«¯åœ¨å’Œä¸€ä¸ªRediså®ä¾‹è¯·æ±‚åŠ é”æ—¶ï¼Œä¸€ç›´åˆ°è¶…æ—¶éƒ½æ²¡æœ‰æˆåŠŸï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå’Œä¸‹ä¸€ä¸ªRediså®ä¾‹ç»§ç»­è¯·æ±‚åŠ é”ã€‚åŠ é”æ“ä½œçš„è¶…æ—¶æ—¶é—´éœ€è¦è¿œè¿œåœ°å°äºé”çš„æœ‰æ•ˆæ—¶é—´ï¼Œä¸€èˆ¬ä¹Ÿå°±æ˜¯è®¾ç½®ä¸ºå‡ åæ¯«ç§’ã€‚</p><p>ç¬¬ä¸‰æ­¥æ˜¯ï¼Œä¸€æ—¦å®¢æˆ·ç«¯å®Œæˆäº†å’Œæ‰€æœ‰Rediså®ä¾‹çš„åŠ é”æ“ä½œï¼Œå®¢æˆ·ç«¯å°±è¦è®¡ç®—æ•´ä¸ªåŠ é”è¿‡ç¨‹çš„æ€»è€—æ—¶ã€‚</p><p>å®¢æˆ·ç«¯åªæœ‰åœ¨æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œæ‰èƒ½è®¤ä¸ºæ˜¯åŠ é”æˆåŠŸï¼Œæ¡ä»¶ä¸€æ˜¯å®¢æˆ·ç«¯ä»è¶…è¿‡åŠæ•°ï¼ˆå¤§äºç­‰äº N&#x2F;2+1ï¼‰çš„Rediså®ä¾‹ä¸ŠæˆåŠŸè·å–åˆ°äº†é”ï¼›æ¡ä»¶äºŒæ˜¯å®¢æˆ·ç«¯è·å–é”çš„æ€»è€—æ—¶æ²¡æœ‰è¶…è¿‡é”çš„æœ‰æ•ˆæ—¶é—´ã€‚</p><p>ä¸ºä»€ä¹ˆå¤§å¤šæ•°å®ä¾‹åŠ é”æˆåŠŸæ‰èƒ½ç®—æˆåŠŸå‘¢ï¼Ÿå¤šä¸ªRediså®ä¾‹ä¸€èµ·æ¥ç”¨ï¼Œå…¶å®å°±ç»„æˆäº†ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ€»ä¼šå‡ºç°å¼‚å¸¸èŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨è°ˆè®ºåˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œéœ€è¦è€ƒè™‘å¼‚å¸¸èŠ‚ç‚¹è¾¾åˆ°å¤šå°‘ä¸ªï¼Œä¹Ÿä¾æ—§ä¸å½±å“æ•´ä¸ªç³»ç»Ÿçš„æ­£ç¡®è¿è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„å®¹é”™é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜çš„ç»“è®ºæ˜¯ï¼šå¦‚æœåªå­˜åœ¨æ•…éšœèŠ‚ç‚¹ï¼Œåªè¦å¤§å¤šæ•°èŠ‚ç‚¹æ­£å¸¸ï¼Œé‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿä¾æ—§å¯ä»¥æä¾›æ­£ç¡®æœåŠ¡ã€‚</p><p>åœ¨æ»¡è¶³äº†è¿™ä¸¤ä¸ªæ¡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°è®¡ç®—è¿™æŠŠé”çš„æœ‰æ•ˆæ—¶é—´ï¼Œè®¡ç®—çš„ç»“æœæ˜¯é”çš„æœ€åˆæœ‰æ•ˆæ—¶é—´å‡å»å®¢æˆ·ç«¯ä¸ºè·å–é”çš„æ€»è€—æ—¶ã€‚å¦‚æœé”çš„æœ‰æ•ˆæ—¶é—´å·²ç»æ¥ä¸åŠå®Œæˆå…±äº«æ•°æ®çš„æ“ä½œäº†ï¼Œæˆ‘ä»¬å¯ä»¥é‡Šæ”¾é”ï¼Œä»¥å…å‡ºç°è¿˜æ²¡å®Œæˆå…±äº«èµ„æºæ“ä½œï¼Œé”å°±è¿‡æœŸäº†çš„æƒ…å†µã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨å’Œæ‰€æœ‰å®ä¾‹æ‰§è¡Œå®ŒåŠ é”æ“ä½œåï¼Œæ²¡èƒ½åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆï¼Œå®¢æˆ·ç«¯å°±è¦å‘æ‰€æœ‰RedisèŠ‚ç‚¹å‘èµ·é‡Šæ”¾é”çš„æ“ä½œã€‚ä¸ºä»€ä¹ˆé‡Šæ”¾é”ï¼Œè¦æ“ä½œæ‰€æœ‰çš„èŠ‚ç‚¹å‘¢ï¼Œä¸èƒ½åªæ“ä½œé‚£äº›åŠ é”æˆåŠŸçš„èŠ‚ç‚¹å—ï¼Ÿå› ä¸ºåœ¨æŸä¸€ä¸ªRedisèŠ‚ç‚¹åŠ é”æ—¶ï¼Œå¯èƒ½å› ä¸ºç½‘ç»œåŸå› å¯¼è‡´åŠ é”å¤±è´¥ï¼Œä¾‹å¦‚ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨ä¸€ä¸ªRediså®ä¾‹ä¸ŠåŠ é”æˆåŠŸï¼Œä½†åœ¨è¯»å–å“åº”ç»“æœæ—¶ç”±äºç½‘ç»œé—®é¢˜å¯¼è‡´è¯»å–å¤±è´¥ï¼Œé‚£è¿™æŠŠé”å…¶å®å·²ç»åœ¨Redisä¸ŠåŠ é”æˆåŠŸäº†ã€‚æ‰€ä»¥é‡Šæ”¾é”æ—¶ï¼Œä¸ç®¡ä¹‹å‰æœ‰æ²¡æœ‰åŠ é”æˆåŠŸï¼Œéœ€è¦é‡Šæ”¾æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„é”ä»¥ä¿è¯æ¸…ç†èŠ‚ç‚¹ä¸Šçš„æ®‹ç•™çš„é”ã€‚</p><p>åœ¨Redlockç®—æ³•ä¸­ï¼Œé‡Šæ”¾é”çš„æ“ä½œå’Œåœ¨å•å®ä¾‹ä¸Šé‡Šæ”¾é”çš„æ“ä½œä¸€æ ·ï¼Œåªè¦æ‰§è¡Œé‡Šæ”¾é”çš„ Luaè„šæœ¬å°±å¯ä»¥äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªè¦Nä¸ªRediså®ä¾‹ä¸­çš„åŠæ•°ä»¥ä¸Šå®ä¾‹èƒ½æ­£å¸¸å·¥ä½œï¼Œå°±èƒ½ä¿è¯åˆ†å¸ƒå¼é”çš„æ­£å¸¸å·¥ä½œäº†ã€‚æ‰€ä»¥ï¼Œåœ¨å®é™…çš„ä¸šåŠ¡åº”ç”¨ä¸­ï¼Œå¦‚æœä½ æƒ³è¦æå‡åˆ†å¸ƒå¼é”çš„å¯é æ€§ï¼Œå°±å¯ä»¥é€šè¿‡Redlockç®—æ³•æ¥å®ç°ã€‚</p><h3 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://mp.weixin.qq.com/s/kyFAWH3mVNJvurQDt4vchA">æˆ‘å¸ç”¨äº† 6 å¹´çš„ Redis åˆ†å¸ƒå¼é™æµå™¨ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å‰å®³äº†ï¼</a></p><p>ä¸€èˆ¬æ˜¯é€šè¿‡Rediså’ŒLuaè„šæœ¬çš„æ–¹å¼æ¥å®ç°é™æµã€‚</p><h4 id="é™æµæ–¹æ¡ˆ"><a href="#é™æµæ–¹æ¡ˆ" class="headerlink" title="é™æµæ–¹æ¡ˆ"></a>é™æµæ–¹æ¡ˆ</h4><h5 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h5><p>Javaå†…éƒ¨ä¹Ÿå¯ä»¥é€šè¿‡åŸå­ç±»è®¡æ•°å™¨<code>AtomicInteger</code>ã€<code>Semaphore</code>ä¿¡å·é‡æ¥åšç®€å•çš„é™æµã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é™æµçš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxCount</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="comment">// æŒ‡å®šçš„æ—¶é—´å†…</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="variable">interval</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line"><span class="comment">// åŸå­ç±»è®¡æ•°å™¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// èµ·å§‹æ—¶é—´</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">limit</span><span class="params">(<span class="type">int</span> maxCount, <span class="type">int</span> interval)</span> &#123;</span><br><span class="line">    atomicInteger.addAndGet(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (atomicInteger.get() == <span class="number">1</span>) &#123;</span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        atomicInteger.addAndGet(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¶…è¿‡äº†é—´éš”æ—¶é—´ï¼Œç›´æ¥é‡æ–°å¼€å§‹è®¡æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (System.currentTimeMillis() - startTime &gt; interval * <span class="number">1000</span>) &#123;</span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        atomicInteger.set(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿˜åœ¨é—´éš”æ—¶é—´å†…,checkæœ‰æ²¡æœ‰è¶…è¿‡é™æµçš„ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">if</span> (atomicInteger.get() &gt; maxCount) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ¼æ¡¶ç®—æ³•"><a href="#æ¼æ¡¶ç®—æ³•" class="headerlink" title="æ¼æ¡¶ç®—æ³•"></a>æ¼æ¡¶ç®—æ³•</h5><p>æ¼æ¡¶ç®—æ³•æ€è·¯å¾ˆç®€å•ï¼Œæˆ‘ä»¬æŠŠæ°´æ¯”ä½œæ˜¯<code>è¯·æ±‚</code>ï¼Œæ¼æ¡¶æ¯”ä½œæ˜¯<code>ç³»ç»Ÿå¤„ç†èƒ½åŠ›æé™</code>ï¼Œæ°´å…ˆè¿›å…¥åˆ°æ¼æ¡¶é‡Œï¼Œæ¼æ¡¶é‡Œçš„æ°´æŒ‰ä¸€å®šé€Ÿç‡æµå‡ºï¼Œå½“æµå‡ºçš„é€Ÿç‡å°äºæµå…¥çš„é€Ÿç‡æ—¶ï¼Œç”±äºæ¼æ¡¶å®¹é‡æœ‰é™ï¼Œåç»­è¿›å…¥çš„æ°´ç›´æ¥æº¢å‡ºï¼ˆæ‹’ç»è¯·æ±‚ï¼‰ï¼Œä»¥æ­¤å®ç°é™æµã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261956880.png" alt="image-20240910153455239"></p><h5 id="ä»¤ç‰Œæ¡¶ç®—æ³•"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•"></a>ä»¤ç‰Œæ¡¶ç®—æ³•</h5><p>ä»¤ç‰Œæ¡¶ç®—æ³•çš„åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£æˆåŒ»é™¢çš„æŒ‚å·çœ‹ç—…ï¼Œåªæœ‰æ‹¿åˆ°å·ä»¥åæ‰å¯ä»¥è¿›è¡Œè¯Šç—…ã€‚</p><p>ç³»ç»Ÿä¼šç»´æŠ¤ä¸€ä¸ªä»¤ç‰Œï¼ˆ<code>token</code>ï¼‰æ¡¶ï¼Œä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼ˆ<code>token</code>ï¼‰ï¼Œè¿™æ—¶å¦‚æœæœ‰è¯·æ±‚è¿›æ¥æƒ³è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»æ¡¶é‡Œè·å–ä¸€ä¸ªä»¤ç‰Œï¼ˆ<code>token</code>ï¼‰ï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œï¼ˆ<code>token</code>ï¼‰å¯å–æ—¶ï¼Œåˆ™è¯¥è¯·æ±‚å°†è¢«æ‹’ç»æœåŠ¡ã€‚ä»¤ç‰Œæ¡¶ç®—æ³•é€šè¿‡æ§åˆ¶æ¡¶çš„å®¹é‡ã€å‘æ”¾ä»¤ç‰Œçš„é€Ÿç‡ï¼Œæ¥è¾¾åˆ°å¯¹è¯·æ±‚çš„é™åˆ¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261956127.png" alt="image-20240910153705064"></p><h5 id="Redis-Lua"><a href="#Redis-Lua" class="headerlink" title="Redis + Lua"></a>Redis + Lua</h5><p>å¾ˆå¤šåŒå­¦ä¸çŸ¥é“<code>Lua</code>æ˜¯å•¥ï¼Ÿä¸ªäººç†è§£ï¼Œ<code>Lua</code>è„šæœ¬å’Œ <code>MySQL</code>æ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹æ¯”è¾ƒç›¸ä¼¼ï¼Œä»–ä»¬æ‰§è¡Œä¸€ç»„å‘½ä»¤ï¼Œæ‰€æœ‰å‘½ä»¤çš„æ‰§è¡Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œä»¥æ­¤è¾¾åˆ°åŸå­æ€§ã€‚ä¹Ÿå¯ä»¥æŠŠ<code>Lua</code>è„šæœ¬ç†è§£ä¸ºï¼Œä¸€æ®µå…·æœ‰ä¸šåŠ¡é€»è¾‘çš„ä»£ç å—ã€‚</p><p>è€Œ<code>Lua</code>æœ¬èº«å°±æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œè™½ç„¶<code>redis</code> å®˜æ–¹æ²¡æœ‰ç›´æ¥æä¾›é™æµç›¸åº”çš„<code>API</code>ï¼Œä½†å´æ”¯æŒäº† <code>Lua</code> è„šæœ¬çš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå®ç°å¤æ‚çš„ä»¤ç‰Œæ¡¶æˆ–æ¼æ¡¶ç®—æ³•ï¼Œä¹Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°é™æµçš„ä¸»è¦æ–¹å¼ä¹‹ä¸€ã€‚</p><p>ç›¸æ¯”<code>Redis</code>äº‹åŠ¡ï¼Œ<code>Luaè„šæœ¬</code>çš„ä¼˜ç‚¹ï¼š</p><ul><li>å‡å°‘ç½‘ç»œå¼€é”€ï¼šä½¿ç”¨<code>Lua</code>è„šæœ¬ï¼Œæ— éœ€å‘<code>Redis</code> å‘é€å¤šæ¬¡è¯·æ±‚ï¼Œæ‰§è¡Œä¸€æ¬¡å³å¯ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“</li><li>åŸå­æ“ä½œï¼š<code>Redis</code> å°†æ•´ä¸ª<code>Lua</code>è„šæœ¬ä½œä¸ºä¸€ä¸ªå‘½ä»¤æ‰§è¡Œï¼ŒåŸå­ï¼Œæ— éœ€æ‹…å¿ƒå¹¶å‘</li><li>å¤ç”¨ï¼š<code>Lua</code>è„šæœ¬ä¸€æ—¦æ‰§è¡Œï¼Œä¼šæ°¸ä¹…ä¿å­˜ <code>Redis</code> ä¸­,ï¼Œå…¶ä»–å®¢æˆ·ç«¯å¯å¤ç”¨</li></ul><p><code>Lua</code>è„šæœ¬å¤§è‡´é€»è¾‘å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-- è·å–è°ƒç”¨è„šæœ¬æ—¶ä¼ å…¥çš„ç¬¬ä¸€ä¸ªkeyå€¼ï¼ˆç”¨ä½œé™æµçš„ keyï¼‰</span><br><span class="line">local key = KEYS[1]</span><br><span class="line">-- è·å–è°ƒç”¨è„šæœ¬æ—¶ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å€¼ï¼ˆé™æµå¤§å°ï¼‰</span><br><span class="line">local limit = tonumber(ARGV[1])</span><br><span class="line"></span><br><span class="line">-- è·å–å½“å‰æµé‡å¤§å°</span><br><span class="line">local curentLimit = tonumber(redis.call(&#x27;get&#x27;, key) or &quot;0&quot;)</span><br><span class="line"></span><br><span class="line">-- æ˜¯å¦è¶…å‡ºé™æµ</span><br><span class="line">if curentLimit + 1 &gt; limit then</span><br><span class="line">    -- è¿”å›(æ‹’ç»)</span><br><span class="line">    return 0</span><br><span class="line">else</span><br><span class="line">    -- æ²¡æœ‰è¶…å‡º value + 1</span><br><span class="line">    redis.call(&quot;INCRBY&quot;, key, 1)</span><br><span class="line">    -- è®¾ç½®è¿‡æœŸæ—¶é—´</span><br><span class="line">    redis.call(&quot;EXPIRE&quot;, key, 2)</span><br><span class="line">    -- è¿”å›(æ”¾è¡Œ)</span><br><span class="line">    return 1</span><br><span class="line">end</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡<code>KEYS[1]</code> è·å–ä¼ å…¥çš„keyå‚æ•°</li><li>é€šè¿‡<code>ARGV[1]</code>è·å–ä¼ å…¥çš„<code>limit</code>å‚æ•°</li><li><code>redis.call</code>æ–¹æ³•ï¼Œä»ç¼“å­˜ä¸­<code>get</code>å’Œ<code>key</code>ç›¸å…³çš„å€¼ï¼Œå¦‚æœä¸º<code>null</code>é‚£ä¹ˆå°±è¿”å›0</li><li>æ¥ç€åˆ¤æ–­ç¼“å­˜ä¸­è®°å½•çš„æ•°å€¼æ˜¯å¦ä¼šå¤§äºé™åˆ¶å¤§å°ï¼Œå¦‚æœè¶…å‡ºè¡¨ç¤ºè¯¥è¢«é™æµï¼Œè¿”å›0</li><li>å¦‚æœæœªè¶…è¿‡ï¼Œé‚£ä¹ˆè¯¥keyçš„ç¼“å­˜å€¼+1ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º1ç§’é’Ÿä»¥åï¼Œå¹¶è¿”å›ç¼“å­˜å€¼+1</li></ul><p>è¿™ç§æ–¹å¼æ˜¯æœ¬æ–‡æ¨èçš„æ–¹æ¡ˆï¼Œå…·ä½“å®ç°ä¼šåœ¨åè¾¹åšç»†è¯´ã€‚</p><h3 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h3><p>Redis â¾ƒå¸¦çš„ list æ•°æ®ç»“æ„å¯ä»¥ä½œä¸ºâ¼€ä¸ªç®€å•çš„é˜Ÿåˆ—ä½¿â½¤ã€‚Redis 5.0 ä¸­å¢åŠ çš„ Stream ç±»å‹çš„æ•°æ®ç»“æ„æ›´åŠ é€‚åˆâ½¤æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ã€‚å®ƒâ½á«¾ç±»ä¼¼äº Kafkaï¼Œæœ‰ä¸»é¢˜å’Œæ¶ˆè´¹ç»„çš„æ¦‚ å¿µï¼Œâ½€æŒæ¶ˆæ¯æŒä¹…åŒ–ä»¥åŠ ACK æœºåˆ¶ã€‚</p><p>Rediså¯ä»¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒRedis 5.0 æ–°å¢åŠ çš„â¼€ä¸ªæ•°æ®ç»“æ„ Stream å¯ä»¥â½¤æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œ Stream â½€æŒï¼š</p><ul><li>å‘å¸ƒ &#x2F; è®¢é˜…æ¨¡å¼ </li><li>æŒ‰ç…§æ¶ˆè´¹è€…ç»„è¿›â¾æ¶ˆè´¹ </li><li>æ¶ˆæ¯æŒä¹…åŒ–ï¼ˆ RDB å’Œ AOFï¼‰</li></ul><p>ä¸è¿‡ï¼Œå’Œä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ç›¸â½ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šâ½‹ç¼ºçš„åœ°â½…â½å¦‚æ¶ˆæ¯ä¸¢å¤±å’Œå †ç§¯é—®é¢˜ä¸å¥½è§£å†³ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸å»ºè®®æ˜¯ä¸ä½¿â½¤ Redis æ¥åšæ¶ˆæ¯é˜Ÿåˆ—çš„ï¼Œä½ å®Œå…¨å¯ä»¥é€‰æ‹©å¸‚â¾¯ä¸Šâ½æˆç†Ÿçš„â¼€äº›æ¶ˆæ¯é˜Ÿåˆ—â½å¦‚ RocketMQã€Kafkaã€‚</p><h3 id="å¤æ‚ä¸šåŠ¡åœºæ™¯"><a href="#å¤æ‚ä¸šåŠ¡åœºæ™¯" class="headerlink" title="å¤æ‚ä¸šåŠ¡åœºæ™¯"></a>å¤æ‚ä¸šåŠ¡åœºæ™¯</h3><p>é€šè¿‡ Redis ä»¥åŠ Redis æ‰©å±•ï¼ˆâ½å¦‚ Redissonï¼‰æä¾›çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆâ½… ä¾¿åœ°å®Œæˆå¾ˆå¤šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯â½å¦‚é€šè¿‡ bitmap ç»Ÿè®¡æ´»è·ƒâ½¤æˆ·ã€é€šè¿‡ sorted set ç»´æŠ¤æ’â¾æ¦œã€‚</p><h2 id="Redisçš„äº”å¤§æ•°æ®ç±»å‹"><a href="#Redisçš„äº”å¤§æ•°æ®ç±»å‹" class="headerlink" title="Redisçš„äº”å¤§æ•°æ®ç±»å‹"></a>Redisçš„äº”å¤§æ•°æ®ç±»å‹</h2><p>Redisæ˜¯key-valueå­˜å‚¨ç³»ç»Ÿï¼Œkeyä¸€èˆ¬ä¸ºstringç±»å‹çš„å­—ç¬¦ä¸²ï¼Œvalueæ˜¯rediså¯¹è±¡(object)ã€‚Redis å…±æœ‰ 5 ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼šStringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€Hashï¼ˆæ•£åˆ—ï¼‰ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261956596.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="String-è¿˜æ˜¯-Hash-å­˜å‚¨å¯¹è±¡æ•°æ®æ›´å¥½å‘¢ï¼Ÿ"><a href="#String-è¿˜æ˜¯-Hash-å­˜å‚¨å¯¹è±¡æ•°æ®æ›´å¥½å‘¢ï¼Ÿ" class="headerlink" title="String è¿˜æ˜¯ Hash å­˜å‚¨å¯¹è±¡æ•°æ®æ›´å¥½å‘¢ï¼Ÿ"></a>String è¿˜æ˜¯ Hash å­˜å‚¨å¯¹è±¡æ•°æ®æ›´å¥½å‘¢ï¼Ÿ</h3><ul><li><p>String å­˜å‚¨çš„æ˜¯åºåˆ—åŒ–åçš„å¯¹è±¡æ•°æ®ï¼Œå­˜æ”¾çš„æ˜¯æ•´ä¸ªå¯¹è±¡ã€‚Hash æ˜¯å¯¹å¯¹è±¡çš„æ¯ä¸ªå­—æ®µå•ç‹¬å­˜å‚¨ï¼Œå¯ä»¥è·å–éƒ¨åˆ†å­—æ®µçš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹æˆ–è€…æ·»åŠ éƒ¨åˆ†å­—æ®µï¼ŒèŠ‚çœâ½¹ç»œæµé‡ã€‚å¦‚æœå¯¹è±¡ä¸­æŸäº› å­—æ®µéœ€è¦ç»å¸¸å˜åŠ¨æˆ–è€…ç»å¸¸éœ€è¦å•ç‹¬æŸ¥è¯¢å¯¹è±¡ä¸­çš„ä¸ªåˆ«å­—æ®µä¿¡æ¯ï¼ŒHash å°±â¾®å¸¸é€‚åˆã€‚</p></li><li><p>String å­˜å‚¨ç›¸å¯¹æ¥è¯´æ›´åŠ èŠ‚çœå†…å­˜ï¼Œç¼“å­˜ç›¸åŒæ•°é‡çš„å¯¹è±¡æ•°æ®ï¼ŒString æ¶ˆè€—çš„å†…å­˜çº¦æ˜¯ Hash çš„ â¼€åŠã€‚å¹¶ä¸”ï¼Œå­˜å‚¨å…·æœ‰å¤šå±‚åµŒå¥—çš„å¯¹è±¡æ—¶ä¹Ÿâ½…ä¾¿å¾ˆå¤šã€‚å¦‚æœç³»ç»Ÿå¯¹æ€§èƒ½å’Œèµ„æºæ¶ˆè€—â¾®å¸¸æ•æ„Ÿçš„ è¯ï¼ŒString å°±â¾®å¸¸é€‚åˆã€‚</p></li></ul><p>åœ¨ç»â¼¤éƒ¨åˆ†æƒ…å†µï¼Œæˆ‘ä»¬å»ºè®®ä½¿â½¤ String æ¥å­˜å‚¨å¯¹è±¡æ•°æ®å³å¯ï¼ é‚£æ ¹æ®ä½ çš„ä»‹ç»ï¼Œè´­ç‰©â»‹ä¿¡æ¯â½¤ String è¿˜æ˜¯ Hash å­˜å‚¨æ›´å¥½å‘¢ï¼Ÿ</p><p>è´­ç‰©â»‹ä¿¡æ¯å»ºè®®ä½¿â½¤ Hash å­˜å‚¨ï¼š â½¤æˆ· id ä¸º key å•†å“ id ä¸º fieldï¼Œå•†å“æ•°é‡ä¸º value ç”±äºè´­ç‰©â»‹ä¸­çš„å•†å“é¢‘ç¹ä¿®æ”¹å’Œå˜åŠ¨ï¼Œè¿™ä¸ªæ—¶å€™ Hash å°±â¾®å¸¸é€‚åˆäº†ï¼</p><h2 id="Redisçº¿ç¨‹æ¨¡å‹"><a href="#Redisçº¿ç¨‹æ¨¡å‹" class="headerlink" title="Redisçº¿ç¨‹æ¨¡å‹"></a>Redisçº¿ç¨‹æ¨¡å‹</h2><p>å¯¹äºè¯»å†™å‘½ä»¤æ¥è¯´ï¼ŒRedis â¼€ç›´æ˜¯å•çº¿ç¨‹æ¨¡å‹ã€‚ä¸è¿‡ï¼Œåœ¨ Redis 4.0 ç‰ˆæœ¬ä¹‹åå¼•â¼Šäº†å¤šçº¿ç¨‹æ¥æ‰§â¾â¼€ äº›â¼¤é”®å€¼å¯¹çš„å¼‚æ­¥åˆ é™¤æ“ä½œï¼Œ Redis 6.0 ç‰ˆæœ¬ä¹‹åå¼•â¼Šäº†å¤šçº¿ç¨‹æ¥å¤„ç†â½¹ç»œè¯·æ±‚ï¼ˆæâ¾¼â½¹ç»œ IO è¯»å†™ æ€§èƒ½ï¼‰ã€‚</p><p>Rediså•çº¿ç¨‹æ¨¡å‹äº†è§£ï¼Ÿ</p><p>RedisåŸºäºå•çº¿ç¨‹ï¼Œé‚£ä¹ˆæ˜¯æ€ä¹ˆç›‘å¬å¤§é‡çš„å®¢æˆ·ç«¯è¿æ¥å‘¢ï¼Ÿ</p><blockquote><p>Redisé€šè¿‡IOå¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼Œæˆ–è€…è¯´æ˜¯ç›‘å¬å¤šä¸ªsocketï¼Œå®ƒä¼šå°†æ„Ÿå…´è¶£çš„äº‹ä»¶å³ç±»å‹æ³¨å†Œåˆ°å†…æ ¸ä¸­å¹¶ç›‘å¬æ¯ä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚</p></blockquote><p>è¿™æ ·çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼šI&#x2F;Oå¤šè·¯å¤ç”¨æŠ€æœ¯çš„ä½¿ç”¨è®©Redisä¸éœ€è¦é¢å¤–åˆ›å»ºå¤šä½™çš„çº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼Œé™ä½äº†èµ„æºçš„æ¶ˆè€—ï¼ˆå’ŒNIOä¸­çš„Selectorç»„ä»¶å¾ˆåƒï¼‰ã€‚</p><p>å¦å¤–ï¼ŒRedisæœåŠ¡å™¨æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç¨‹åºï¼ŒæœåŠ¡å™¨éœ€è¦å¤„ç†ä¸¤ç±»äº‹ä»¶ï¼š</p><ul><li>â½‚ä»¶äº‹ä»¶(file event) ï¼šâ½¤äºå¤„ç† Redis æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„â½¹ç»œ IOã€‚ </li><li>æ—¶é—´äº‹ä»¶(time eveat) ï¼šRedis æœåŠ¡å™¨ä¸­çš„â¼€äº›æ“ä½œï¼ˆâ½å¦‚ serverCron å‡½æ•°ï¼‰éœ€è¦åœ¨ç»™å®šçš„æ—¶ é—´ç‚¹æ‰§â¾ï¼Œâ½½æ—¶é—´äº‹ä»¶å°±æ˜¯å¤„ç†è¿™ç±»å®šæ—¶æ“ä½œçš„ã€‚</li></ul><p>æ—¶é—´äº‹ä»¶ä¸éœ€è¦å¤šèŠ±æ—¶é—´äº†è§£ï¼Œæˆ‘ä»¬æ¥è§¦æœ€å¤šçš„è¿˜æ˜¯ â½‚ä»¶äº‹ä»¶ï¼ˆå®¢æˆ·ç«¯è¿›â¾è¯»å–å†™â¼Šç­‰æ“ä½œï¼Œæ¶‰åŠ â¼€ç³»åˆ—â½¹ç»œé€šä¿¡ï¼‰ã€‚</p><blockquote><p>Redis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†â¾ƒâ¼°çš„â½¹ç»œäº‹ä»¶å¤„ç†å™¨ï¼šè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºâ½‚ä»¶äº‹ä»¶å¤„ç†å™¨ ï¼ˆfile event handlerï¼‰ã€‚â½‚ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿â½¤ I&#x2F;O å¤šè·¯å¤â½¤ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤š ä¸ªå¥—æ¥å­—ï¼Œå¹¶æ ¹æ®å¥—æ¥å­—â½¬å‰æ‰§â¾çš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚ å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§â¾è¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™â¼Šï¼ˆwriteï¼‰ã€å…³ é—­ ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œä¸æ“ä½œç›¸å¯¹åº”çš„â½‚ä»¶äº‹ä»¶å°±ä¼šäº§â½£ï¼Œè¿™æ—¶â½‚ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒâ½¤å¥—æ¥å­— ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚ è™½ç„¶â½‚ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹â½…å¼è¿â¾ï¼Œä½†é€šè¿‡ä½¿â½¤ I&#x2F;O å¤šè·¯å¤â½¤ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œâ½‚ ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†â¾¼æ€§èƒ½çš„â½¹ç»œé€šä¿¡æ¨¡å‹ï¼Œâ¼œå¯ä»¥å¾ˆå¥½åœ°ä¸ Redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å• çº¿ç¨‹â½…å¼è¿â¾çš„æ¨¡å—è¿›â¾å¯¹æ¥ï¼Œè¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚</p></blockquote><p>å¯ä»¥çœ‹å‡ºï¼Œâ½‚ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ä¸»è¦æ˜¯åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š </p><ul><li>å¤šä¸ª socketï¼ˆå®¢æˆ·ç«¯è¿æ¥ï¼‰ </li><li>IO å¤šè·¯å¤â½¤ç¨‹åºï¼ˆâ½€æŒå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„å…³é”®ï¼‰ </li><li>â½‚ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼ˆå°† socket å…³è”åˆ°ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼‰ </li><li>äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰</li></ul><h2 id="Rediså†…å­˜ç®¡ç†"><a href="#Rediså†…å­˜ç®¡ç†" class="headerlink" title="Rediså†…å­˜ç®¡ç†"></a>Rediså†…å­˜ç®¡ç†</h2><p>Redis é€šè¿‡â¼€ä¸ªå«åšè¿‡æœŸå­—å…¸ï¼ˆå¯ä»¥çœ‹ä½œæ˜¯ hash è¡¨ï¼‰æ¥ä¿å­˜æ•°æ®è¿‡æœŸçš„æ—¶é—´ã€‚è¿‡æœŸå­—å…¸çš„é”®æŒ‡å‘ Redis æ•°æ®åº“ä¸­çš„æŸä¸ª key(é”®)ï¼Œè¿‡æœŸå­—å…¸çš„å€¼æ˜¯â¼€ä¸ª long long ç±»å‹çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä¿å­˜äº† key æ‰€æŒ‡å‘çš„æ•°æ®åº“é”®çš„è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ç²¾åº¦çš„ UNIX æ—¶é—´æˆ³ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261956718.png" alt="image-20240910171943654"></p><h3 id="è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ"><a href="#è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ" class="headerlink" title="è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ"></a>è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ</h3><p>è¿‡æœŸæ•°æ®åˆ é™¤ç­–ç•¥å°±ä¸¤ä¸ªï¼š</p><ol><li><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šåªä¼šåœ¨å–å‡º key çš„æ—¶å€™æ‰å¯¹æ•°æ®è¿›â¾è¿‡æœŸæ£€æŸ¥ã€‚è¿™æ ·å¯¹ CPU æœ€å‹å¥½ï¼Œä½†æ˜¯å¯èƒ½ä¼š é€ æˆå¤ªå¤šè¿‡æœŸ key æ²¡æœ‰è¢«åˆ é™¤ã€‚</li><li><strong>å®šæœŸåˆ é™¤</strong>ï¼šæ¯éš”â¼€æ®µæ—¶é—´æŠ½å–â¼€æ‰¹ key æ‰§â¾åˆ é™¤è¿‡æœŸ key æ“ä½œã€‚å¹¶ä¸”ï¼ŒRedis åº•å±‚ä¼šé€šè¿‡é™åˆ¶ åˆ é™¤æ“ä½œæ‰§â¾çš„æ—¶â»“å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU æ—¶é—´çš„å½±å“ã€‚</li></ol><p>å®šæœŸåˆ é™¤å¯¹å†…å­˜æ›´åŠ å‹å¥½ï¼Œæƒ°æ€§åˆ é™¤å¯¹CPUæ›´åŠ å‹å¥½ï¼Œä¸¤è€…å„æœ‰åƒç§‹ï¼Œ<strong>æ‰€ä»¥Redisé‡‡ç”¨çš„æ˜¯å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤ã€‚</strong></p><p>ä½†æ˜¯ï¼Œä»…ä»…é€šè¿‡ç»™ key è®¾ç½®è¿‡æœŸæ—¶é—´è¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸ºè¿˜æ˜¯å¯èƒ½å­˜åœ¨å®šæœŸåˆ é™¤å’Œæƒ°æ€§åˆ é™¤æ¼æ‰äº† å¾ˆå¤šè¿‡æœŸ key çš„æƒ…å†µã€‚è¿™æ ·å°±å¯¼è‡´â¼¤é‡è¿‡æœŸ key å †ç§¯åœ¨å†…å­˜â¾¥ï¼Œç„¶åå°± Out of memory äº†ã€‚</p><p> æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼šRedis å†…å­˜æ·˜æ±°æœºåˆ¶ã€‚</p><h3 id="Rediså†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"><a href="#Rediså†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ" class="headerlink" title="***Rediså†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"></a>***Rediså†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ</h3><p>Redisæä¾›6ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š</p><ul><li><strong>volatile-lru</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰**æœ€è¿‘æœ€å°‘ä½¿â½¤**çš„æ•°æ®æ·˜æ±°ï¼›</li><li><strong>volatile-ttl</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ï¼›</li><li><strong>volatile-random</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ï¼›</li><li><strong>allkeys-lru</strong>ï¼šå½“å†…å­˜ä¸â¾œä»¥å®¹çº³æ–°å†™â¼Šæ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿â½¤çš„ keyï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸â½¤çš„ï¼‰ï¼›</li><li><strong>allkeys-random</strong>ï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ï¼›</li><li><strong>no-eviction</strong>ï¼šç¦â½Œé©±é€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å†…å­˜ä¸â¾œä»¥å®¹çº³æ–°å†™â¼Šæ•°æ®æ—¶ï¼Œæ–°å†™â¼Šæ“ä½œä¼šæŠ¥é”™ã€‚ è¿™ä¸ªåº”è¯¥æ²¡â¼ˆä½¿â½¤å§ï¼</li><li><strong>volatile-lfu</strong>ï¼ˆleast frequently usedï¼‰ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ æŒ‘é€‰æœ€ä¸ç»å¸¸ä½¿â½¤çš„æ•°æ®æ·˜æ±° </li><li><strong>allkeys-lfu</strong>ï¼ˆleast frequently usedï¼‰ï¼šå½“å†…å­˜ä¸â¾œä»¥å®¹çº³æ–°å†™â¼Šæ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€ ä¸ç»å¸¸ä½¿â½¤çš„ keyï¼›</li></ul><blockquote><p>åœ¨ Redis ä¸­ï¼Œ<code>volatile-lfu</code> å’Œ <code>volatile-lru</code> æ˜¯ä¸¤ç§ä¸åŒçš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œç”¨äºåœ¨å†…å­˜è¾¾åˆ°é™åˆ¶æ—¶å†³å®šå“ªäº›é”®å€¼å¯¹åº”è¯¥è¢«æ·˜æ±°ã€‚è¿™ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬å¦‚ä½•é€‰æ‹©è¦æ·˜æ±°çš„æ•°æ®ã€‚</p><h3 id="1-volatile-lfuï¼ˆLeast-Frequently-Usedï¼‰"><a href="#1-volatile-lfuï¼ˆLeast-Frequently-Usedï¼‰" class="headerlink" title="1. volatile-lfuï¼ˆLeast Frequently Usedï¼‰"></a>1. <strong>volatile-lfu</strong>ï¼ˆLeast Frequently Usedï¼‰</h3><ul><li><p><strong>è§£é‡Š</strong>ï¼š<code>volatile-lfu</code> ç­–ç•¥ä¼šé€‰æ‹©é‚£äº›<strong>ä½¿ç”¨é¢‘ç‡æœ€å°‘</strong>çš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚Redis é€šè¿‡è®°å½•é”®è¢«è®¿é—®çš„æ¬¡æ•°æ¥å†³å®šå“ªäº›æ•°æ®ä¸ç»å¸¸ä½¿ç”¨ã€‚</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚åˆé‚£äº›æœ‰â€çƒ­ç‚¹â€æ•°æ®çš„åœºæ™¯ã€‚æŸäº›æ•°æ®å¯èƒ½ä¸€æ®µæ—¶é—´å†…è¢«é¢‘ç¹è®¿é—®ï¼Œè€Œå…¶ä»–æ•°æ®å¾ˆå°‘è¢«è®¿é—®ï¼Œ<code>LFU</code> èƒ½æ›´å¥½åœ°ä¿æŒé¢‘ç¹ä½¿ç”¨çš„æ•°æ®ï¼Œæ·˜æ±°é‚£äº›é•¿æœŸä¸è¢«ä½¿ç”¨çš„æ•°æ®ã€‚</p></li><li><p><strong>è¡Œä¸ºç¤ºä¾‹</strong>ï¼š<br>å‡è®¾ Redis ä¸­æœ‰ä»¥ä¸‹é”®å€¼å¯¹åŠå…¶è®¿é—®é¢‘ç‡ï¼ˆåœ¨è¿‡æœŸé”®é›†åˆ <code>expires</code> ä¸­ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">key1 -&gt; 10 (è®¿é—®æ¬¡æ•°)</span><br><span class="line">key2 -&gt; 5  (è®¿é—®æ¬¡æ•°)</span><br><span class="line">key3 -&gt; 1  (è®¿é—®æ¬¡æ•°)</span><br><span class="line">key4 -&gt; 20 (è®¿é—®æ¬¡æ•°)</span><br></pre></td></tr></table></figure><p>å½“ Redis å†…å­˜ä¸å¤Ÿç”¨ï¼Œéœ€è¦æ·˜æ±°é”®æ—¶ï¼Œ<code>volatile-lfu</code> ä¼šé€‰æ‹©è®¿é—®é¢‘ç‡æœ€ä½çš„ <code>key3</code> è¿›è¡Œæ·˜æ±°ï¼Œå› ä¸ºå®ƒçš„ä½¿ç”¨æ¬¡æ•°æ˜¯æœ€å°‘çš„ã€‚</p></li></ul><h3 id="2-volatile-lruï¼ˆLeast-Recently-Usedï¼‰"><a href="#2-volatile-lruï¼ˆLeast-Recently-Usedï¼‰" class="headerlink" title="2. volatile-lruï¼ˆLeast Recently Usedï¼‰"></a>2. <strong>volatile-lru</strong>ï¼ˆLeast Recently Usedï¼‰</h3><ul><li><p><strong>è§£é‡Š</strong>ï¼š<code>volatile-lru</code> ç­–ç•¥ä¼šæ·˜æ±°é‚£äº›<strong>æœ€è¿‘æœ€å°‘ä½¿ç”¨</strong>çš„æ•°æ®ï¼Œè€Œä¸æ˜¯çœ‹æ•°æ®çš„è®¿é—®é¢‘ç‡ã€‚Redis ä¼šè®°å½•æ¯ä¸ªé”®æœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´ï¼Œé€‰æ‹©é‚£äº›é•¿æ—¶é—´æœªè¢«è®¿é—®çš„é”®è¿›è¡Œæ·˜æ±°ã€‚</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚åˆé‚£äº›è®¿é—®æ•°æ®çš„â€æ–°é²œåº¦â€å¾ˆé‡è¦çš„åœºæ™¯ã€‚å³ä½¿ä¸€ä¸ªé”®æ›¾ç»è¢«é¢‘ç¹è®¿é—®ï¼Œä½†å¦‚æœé•¿æ—¶é—´æœªè¢«è®¿é—®ï¼Œä¹Ÿå¯èƒ½ä¸å†æœ‰ä»·å€¼ï¼Œè¿™æ—¶ <code>LRU</code> ç­–ç•¥å°±ä¼šå°†å…¶æ·˜æ±°ã€‚</p></li><li><p><strong>è¡Œä¸ºç¤ºä¾‹</strong>ï¼š<br>å‡è®¾ Redis ä¸­æœ‰ä»¥ä¸‹é”®å€¼å¯¹åŠå…¶æœ€è¿‘è®¿é—®æ—¶é—´ï¼ˆåœ¨è¿‡æœŸé”®é›†åˆ <code>expires</code> ä¸­ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">key1 -&gt; 2 åˆ†é’Ÿå‰è®¿é—®</span><br><span class="line">key2 -&gt; 5 åˆ†é’Ÿå‰è®¿é—®</span><br><span class="line">key3 -&gt; 1 å°æ—¶å‰è®¿é—®</span><br><span class="line">key4 -&gt; 10 ç§’å‰è®¿é—®</span><br></pre></td></tr></table></figure><p>å½“ Redis å†…å­˜ä¸è¶³æ—¶ï¼Œ<code>volatile-lru</code> ä¼šé€‰æ‹© <code>key3</code> è¿›è¡Œæ·˜æ±°ï¼Œå› ä¸ºå®ƒæ˜¯æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„ã€‚</p></li></ul><h3 id="3-åŒºåˆ«æ€»ç»“"><a href="#3-åŒºåˆ«æ€»ç»“" class="headerlink" title="3. åŒºåˆ«æ€»ç»“"></a>3. <strong>åŒºåˆ«æ€»ç»“</strong></h3><ul><li><strong>volatile-lfu</strong>ï¼šæ ¹æ®<strong>è®¿é—®é¢‘ç‡</strong>é€‰æ‹©æœ€ä¸å¸¸ä½¿ç”¨çš„é”®è¿›è¡Œæ·˜æ±°ã€‚é€‚åˆéœ€è¦ä¿ç•™æœ€å¸¸è®¿é—®æ•°æ®çš„åœºæ™¯ã€‚</li><li><strong>volatile-lru</strong>ï¼šæ ¹æ®<strong>æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´</strong>é€‰æ‹©æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®è¿›è¡Œæ·˜æ±°ã€‚é€‚åˆéœ€è¦ä¿ç•™æœ€æ–°è®¿é—®æ•°æ®çš„åœºæ™¯ã€‚</li></ul><h3 id="4-ç¤ºä¾‹ä»£ç è¯´æ˜"><a href="#4-ç¤ºä¾‹ä»£ç è¯´æ˜" class="headerlink" title="4. ç¤ºä¾‹ä»£ç è¯´æ˜"></a>4. ç¤ºä¾‹ä»£ç è¯´æ˜</h3><p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨ Java æ¨¡æ‹Ÿ Redis çš„è¿™ä¸¤ç§ç­–ç•¥ï¼ˆä¼ªä»£ç ï¼‰ã€‚</p><h4 id="volatile-lfu-ç¤ºä¾‹ï¼š"><a href="#volatile-lfu-ç¤ºä¾‹ï¼š" class="headerlink" title="volatile-lfu ç¤ºä¾‹ï¼š"></a>volatile-lfu ç¤ºä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileLFU</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; frequency = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        data.put(key, value.hashCode());</span><br><span class="line">        frequency.put(key, frequency.getOrDefault(key, <span class="number">0</span>) + <span class="number">1</span>);  <span class="comment">// æ›´æ–°è®¿é—®é¢‘ç‡</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">evict</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">leastUsedKey</span> <span class="operator">=</span> Collections.min(frequency.entrySet(), Map.Entry.comparingByValue()).getKey();</span><br><span class="line">        data.remove(leastUsedKey);</span><br><span class="line">        frequency.remove(leastUsedKey);</span><br><span class="line">        System.out.println(<span class="string">&quot;Evicted key with least frequency: &quot;</span> + leastUsedKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VolatileLFU</span> <span class="variable">cache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VolatileLFU</span>();</span><br><span class="line">        cache.put(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;value2&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;key3&quot;</span>, <span class="string">&quot;value3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        cache.evict();  <span class="comment">// æ·˜æ±°è®¿é—®æ¬¡æ•°æœ€å°‘çš„é”®</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="volatile-lru-ç¤ºä¾‹ï¼š"><a href="#volatile-lru-ç¤ºä¾‹ï¼š" class="headerlink" title="volatile-lru ç¤ºä¾‹ï¼š"></a>volatile-lru ç¤ºä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileLRU</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Long&gt; lastAccessed = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        data.put(key, value.hashCode());</span><br><span class="line">        lastAccessed.put(key, System.currentTimeMillis());  <span class="comment">// æ›´æ–°æœ€åè®¿é—®æ—¶é—´</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">evict</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">leastRecentlyUsedKey</span> <span class="operator">=</span> Collections.min(lastAccessed.entrySet(), Map.Entry.comparingByValue()).getKey();</span><br><span class="line">        data.remove(leastRecentlyUsedKey);</span><br><span class="line">        lastAccessed.remove(leastRecentlyUsedKey);</span><br><span class="line">        System.out.println(<span class="string">&quot;Evicted least recently used key: &quot;</span> + leastRecentlyUsedKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VolatileLRU</span> <span class="variable">cache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VolatileLRU</span>();</span><br><span class="line">        cache.put(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;value2&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;key3&quot;</span>, <span class="string">&quot;value3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        cache.evict();  <span class="comment">// æ·˜æ±°æœ€è¿‘æœ€å°‘è®¿é—®çš„é”®</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h3><ul><li><strong>volatile-lfu</strong>ï¼šåŸºäºè®¿é—®é¢‘ç‡æ·˜æ±°é”®ï¼Œé€‚åˆé‚£äº›æœ‰â€œçƒ­ç‚¹â€æ•°æ®çš„åœºæ™¯ã€‚</li><li><strong>volatile-lru</strong>ï¼šåŸºäºæœ€åè®¿é—®æ—¶é—´æ·˜æ±°é”®ï¼Œé€‚åˆé‚£äº›æ•°æ®â€æ–°é²œåº¦â€è¾ƒé‡è¦çš„åœºæ™¯ã€‚</li></ul></blockquote><h2 id="RedisæŒä¹…åŒ–æœºåˆ¶"><a href="#RedisæŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="RedisæŒä¹…åŒ–æœºåˆ¶"></a>RedisæŒä¹…åŒ–æœºåˆ¶</h2><h3 id="æ€ä¹ˆä¿è¯RedisæŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤å—ï¼Ÿ"><a href="#æ€ä¹ˆä¿è¯RedisæŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤å—ï¼Ÿ" class="headerlink" title="æ€ä¹ˆä¿è¯RedisæŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤å—ï¼Ÿ"></a>æ€ä¹ˆä¿è¯RedisæŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤å—ï¼Ÿ</h3><p>Redis çš„â¼€ç§æŒä¹…åŒ–â½…å¼å«å¿«ç…§ï¼ˆsnapshottingï¼ŒRDBï¼‰ï¼Œå¦â¼€ç§â½…å¼æ˜¯åªè¿½åŠ â½‚ä»¶ ï¼ˆappend-only file, AOFï¼‰ã€‚</p><p>Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥â½£æˆ RDB å¿«ç…§â½‚ä»¶ï¼š </p><ul><li>save : ä¸»çº¿ç¨‹æ‰§â¾ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼› </li><li>bgsave : â¼¦çº¿ç¨‹æ‰§â¾ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œé»˜è®¤é€‰é¡¹</li></ul><h3 id="RDBå¿«ç…§"><a href="#RDBå¿«ç…§" class="headerlink" title="RDBå¿«ç…§"></a>RDBå¿«ç…§</h3><p>RDBåˆ©ç”¨çš„å°±æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„COWï¼ˆå†™æ—¶å¤åˆ¶)æ¥å®ç°çš„ã€‚</p><p>RDBæ˜¯åŸºäºå¿«ç…§ä¸€æ¬¡çš„å…¨é‡å¤‡ä»½ï¼Œå³<strong>å‘¨æœŸæ€§</strong>çš„æŠŠrediså½“å‰å†…å­˜ä¸­çš„å…¨é‡æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªå¿«ç…§æ–‡ä»¶ä¸­(å‘¨æœŸæ—¶é—´å¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒæ•´)ã€‚redisæ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œè¿™ä¸ªçº¿ç¨‹è¦åŒæ—¶è´Ÿè´£å¤šä¸ªå®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ï¼Œè¿˜è¦è´Ÿè´£å‘¨æœŸæ€§çš„æŠŠå½“å‰å†…å­˜ä¸­çš„æ•°æ®å†™åˆ°å¿«ç…§æ–‡ä»¶ä¸­RDBä¸­ï¼Œæ•°æ®å†™åˆ°<strong>RDB</strong>æ–‡ä»¶æ˜¯IOæ“ä½œï¼ŒIOæ“ä½œä¼šä¸¥é‡å½±å“redisçš„æ€§èƒ½ï¼Œç”šè‡³åœ¨æŒä¹…åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œè¯»å†™è¯·æ±‚ä¼šé˜»å¡ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒRedisé‡‡ç”¨å¤šè¿›ç¨‹æ¥åŒæ—¶è¿›è¡Œè¯»å†™è¯·æ±‚å’ŒæŒä¹…åŒ–æ“ä½œã€‚è¿™æ ·åˆä¼šå¯¼è‡´å¦å¤–çš„é—®é¢˜ï¼ŒæŒä¹…åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¿˜åœ¨æ”¹å˜ï¼Œå‡å¦‚redisæ­£åœ¨è¿›è¡ŒæŒä¹…åŒ–ä¸€ä¸ªå¤§çš„æ•°æ®ç»“æ„ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªåˆ é™¤è¯·æ±‚ï¼ŒæŠŠè¿™ä¸ªå¤§çš„æ•°æ®ç»“æ„åˆ æ‰äº†ï¼Œè¿™æ—¶å€™æŒä¹…åŒ–çš„åŠ¨ä½œè¿˜æ²¡æœ‰å®Œæˆï¼Œé‚£ä¹ˆredisè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p><strong>redis</strong>ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„å¤šè¿›ç¨‹<strong>COW</strong>(Copy On Write)æœºåˆ¶æ¥å®ç°å¿«ç…§çš„æŒä¹…åŒ–ï¼Œåœ¨æŒä¹…åŒ–è¿‡ç¨‹ä¸­è°ƒç”¨ glibc(Linuxä¸‹çš„Cå‡½æ•°åº“) çš„å‡½æ•°fork()äº§ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¿«ç…§æŒä¹…åŒ–å®Œå…¨äº¤ç»™å­è¿›ç¨‹æ¥å¤„ç†ï¼Œçˆ¶è¿›ç¨‹ç»§ç»­å¤„ç†å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚å­è¿›ç¨‹åˆšåˆšäº§ç”Ÿæ—¶ï¼Œå’Œçˆ¶è¿›ç¨‹å…±äº«å†…å­˜é‡Œé¢çš„ä»£ç æ®µå’Œæ•°æ®æ®µï¼Œè¿™æ˜¯Linuxæ“ä½œç³»ç»Ÿçš„æœºåˆ¶ï¼Œä¸ºäº†èŠ‚çº¦å†…å­˜èµ„æºï¼Œæ‰€ä»¥å°½å¯èƒ½è®©çˆ¶å­è¿›ç¨‹å…±äº«å†…å­˜ï¼Œè¿™æ ·åœ¨è¿›ç¨‹åˆ†ç¦»çš„ä¸€ç¬é—´ï¼Œå†…å­˜çš„å¢é•¿å‡ ä¹æ²¡æœ‰æ˜æ˜¾å˜åŒ–ã€‚</p><h3 id="AOPæŒä¹…åŒ–"><a href="#AOPæŒä¹…åŒ–" class="headerlink" title="AOPæŒä¹…åŒ–"></a>AOPæŒä¹…åŒ–</h3><p>ä¸å¿«ç…§æŒä¹…åŒ–ç›¸â½ï¼ŒAOF æŒä¹…åŒ–çš„å®æ—¶æ€§æ›´å¥½ï¼Œå› æ­¤å·²æˆä¸ºä¸»æµçš„æŒä¹…åŒ–â½…æ¡ˆã€‚é»˜è®¤æƒ…å†µä¸‹ Redis æ²¡æœ‰å¼€å¯ AOFï¼ˆappend only fileï¼‰â½…å¼çš„æŒä¹…åŒ–ï¼Œå¯ä»¥é€šè¿‡ appendonly å‚æ•°å¼€å¯ï¼š</p><p>åœ¨å…³ç³»å‹æ•°æ®åº“é€šå¸¸éƒ½æ˜¯æ‰§è¡Œå‘½ä»¤ä¹‹å‰è®°å½•æ—¥å¿—ï¼ˆæ–¹ä¾¿æ•…éšœæ¢å¤ï¼‰ï¼Œè€ŒRedis AOFæŒä¹…åŒ–æœºåˆ¶æ˜¯åœ¨æ‰§è¡Œå®Œå‘½ä»¤ä¹‹åå†è®°å½•æ—¥å¿—ã€‚</p><p>è¿™æ˜¯ä¸ºäº†é¿å…é¢å¤–çš„æ£€æŸ¥å¼€é”€ï¼ŒAOFè®°å½•æ—¥å¿—ä¼šå¯¹å‘½ä»¤è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼›åœ¨å‘½ä»¤æ‰§è¡Œå®Œä¹‹åå†è®°å½•ï¼Œä¸ä¼šé˜»å¡å½“å‰å‘½ä»¤çš„æ‰§è¡Œã€‚</p><p>ä½†æ˜¯è¿™æ ·ä¹Ÿä¼šå¯¼è‡´å‡ºç°Rediså®•æœºä»è€Œå¯¹åº”çš„ä¿®æ”¹ä¸¢å¤±ï¼Œå¯èƒ½ä¹Ÿä¼šé˜»å¡åç»­å…¶å®ƒå‘½ä»¤çš„æ‰§è¡Œï¼ŒAOFè®°å½•æ—¥å¿—å®åœ¨Redisä¸»çº¿ç¨‹ä¸­è¿›è¡Œçš„ã€‚</p><p>AOF é‡å†™äº†è§£å—ï¼Ÿ AOF é‡å†™å¯ä»¥äº§â½£â¼€ä¸ªæ–°çš„ AOF â½‚ä»¶ï¼Œè¿™ä¸ªæ–°çš„ AOF â½‚ä»¶å’ŒåŸæœ‰çš„ AOF â½‚ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶ æ€â¼€æ ·ï¼Œä½†ä½“ç§¯æ›´â¼©ã€‚ AOF é‡å†™æ˜¯â¼€ä¸ªæœ‰æ­§ä¹‰çš„åå­—ï¼Œè¯¥åŠŸèƒ½æ˜¯é€šè¿‡è¯»å–æ•°æ®åº“ä¸­çš„é”®å€¼å¯¹æ¥å®ç°çš„ï¼Œç¨‹åºâ½†é¡»å¯¹ç°æœ‰ AOF â½‚ä»¶è¿›â¾ä»»ä½•è¯»â¼Šã€åˆ†ææˆ–è€…å†™â¼Šæ“ä½œã€‚</p><h2 id="Redisäº‹åŠ¡"><a href="#Redisäº‹åŠ¡" class="headerlink" title="Redisäº‹åŠ¡"></a>Redisäº‹åŠ¡</h2><p>Redis å¯ä»¥é€šè¿‡ MULTI ï¼Œ EXEC ï¼Œ DISCARD å’Œ WATCH ç­‰å‘½ä»¤æ¥å®ç°äº‹åŠ¡(transaction)åŠŸèƒ½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">&gt; SET USER &quot;Guideå“¥&quot;</span><br><span class="line">QUEUED</span><br><span class="line">&gt; GET USER</span><br><span class="line">QUEUED</span><br><span class="line">&gt; EXEC</span><br><span class="line">1) OK</span><br><span class="line">2) &quot;Guideå“¥&quot;</span><br></pre></td></tr></table></figure><p>DISCARDå–æ¶ˆä¸€ä¸ªäº‹åŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">&gt; SET USER &quot;Guideå“¥&quot;</span><br><span class="line">QUEUED</span><br><span class="line">&gt; GET USER</span><br><span class="line">QUEUED</span><br><span class="line">&gt; DISCARD</span><br><span class="line">OK</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>WATCH å‘½ä»¤â½¤äºç›‘å¬æŒ‡å®šçš„é”®ï¼Œå½“è°ƒâ½¤ EXEC å‘½ä»¤æ‰§â¾äº‹åŠ¡æ—¶ï¼Œå¦‚æœâ¼€ä¸ªè¢« WATCH å‘½ä»¤ç›‘ è§†çš„é”®è¢«ä¿®æ”¹çš„è¯ï¼Œæ•´ä¸ªäº‹åŠ¡éƒ½ä¸ä¼šæ‰§â¾ï¼Œç›´æ¥è¿”å›å¤±è´¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; WATCH USER</span><br><span class="line">OK</span><br><span class="line">&gt; MULTI</span><br><span class="line">&gt; SET USER &quot;Guideå“¥&quot;</span><br><span class="line">OK</span><br><span class="line">&gt; GET USER</span><br><span class="line">Guideå“¥</span><br><span class="line">&gt; EXEC</span><br><span class="line">ERR EXEC without MULTI</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…³ç³»å‹æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼šåŸå­æ€§ã€æŒä¹…æ€§ã€éš”ç¦»æ€§å’Œä¸€è‡´æ€§ï¼›ä½†æ˜¯Redisä¸æ»¡è¶³åœ¨äº‹åŠ¡è¿è¡Œé”™è¯¯çš„æƒ…å†µä¸‹è¿›è¡Œå›æ»šï¼Œå³ä¸æ»¡è¶³åŸå­æ€§ï¼ŒRedisä¹Ÿå®šä¸æ»¡è¶³æŒä¹…æ€§ã€‚</p><p>Redisäº‹åŠ¡æä¾›ä¸€ç§å°†å¤šä¸ªå‘½ä»¤æ‰“åŒ…çš„åŠŸèƒ½ï¼Œç„¶åå†æŒ‰é¡ºåºæ‰§è¡Œæ‰“åŒ…çš„æ‰€æœ‰å‘½ä»¤ï¼Œå¹¶ä¸”ä¸ä¼šè¢«ä¸­é€”æ‰“æ–­ã€‚</p><p>é™¤äº†ä¸æ»¡â¾œåŸâ¼¦æ€§ä¹‹å¤–ï¼Œäº‹åŠ¡ä¸­çš„æ¯æ¡å‘½ä»¤éƒ½ä¼šä¸ Redis æœåŠ¡å™¨è¿›â¾â½¹ç»œäº¤äº’ï¼Œè¿™æ˜¯â½á«¾æµªè´¹èµ„æº çš„â¾ä¸ºã€‚ å› æ­¤ï¼ŒRedis äº‹åŠ¡æ˜¯ä¸å»ºè®®åœ¨â½‡å¸¸å¼€å‘ä¸­ä½¿â½¤çš„ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨Redis2.6ä¹‹åæå‡ºäº†Luaæœºåˆ¶ï¼Œé€šè¿‡ä½¿ç”¨Luaè„šæœ¬æ¥æ‰¹é‡æ‰§è¡Œå¤šæ¡Rediså‘½ä»¤ï¼Œè€Œä¸”è¿™äº›Redisä¼šä¸€æ¬¡æ€§æ‰“åŒ…åˆ°RedisæœåŠ¡å™¨ä¸­æ‰§è¡Œã€‚</p><p>ä½†æ˜¯é€šè¿‡Luaè„šæœ¬æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿä¸ä¼šæ»¡è¶³åŸå­æ€§ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªLuaè„šæœ¬ä¸­çš„å‘½ä»¤å¦‚æœå‡ºç°æ‰§è¡Œé”™è¯¯çš„å‘½ä»¤åˆ™ä¼šåœæ­¢æ‰§è¡Œæ¥ä¸‹æ¥çš„å‘½ä»¤ï¼Œä½†æ˜¯ä¹‹å‰çš„å‘½ä»¤ä¸ä¼šå›æ»šã€‚</p><h2 id="Redisä¼˜åŒ–"><a href="#Redisä¼˜åŒ–" class="headerlink" title="Redisä¼˜åŒ–"></a>Redisä¼˜åŒ–</h2><h3 id="Redis-bigkey"><a href="#Redis-bigkey" class="headerlink" title="Redis bigkey"></a>Redis bigkey</h3><p>ä»€ä¹ˆæ˜¯ bigkeyï¼Ÿ ç®€å•æ¥è¯´ï¼Œå¦‚æœâ¼€ä¸ª key å¯¹åº”çš„ value æ‰€å â½¤çš„å†…å­˜æ¯”è¾ƒå¤§ï¼Œé‚£è¿™ä¸ª key å°±å¯ä»¥çœ‹ä½œæ˜¯ bigkeyã€‚å…· ä½“å¤šâ¼¤æ‰ç®—â¼¤å‘¢ï¼Ÿæœ‰â¼€ä¸ªä¸æ˜¯ç‰¹åˆ«ç²¾ç¡®çš„å‚è€ƒæ ‡å‡†ï¼šstring ç±»å‹çš„ value è¶…è¿‡ 10 kbï¼Œå¤åˆç±»å‹çš„ value åŒ…å«çš„å…ƒç´ è¶…è¿‡ 5000 ä¸ªï¼ˆå¯¹äºå¤åˆç±»å‹çš„ value æ¥è¯´ï¼Œä¸â¼€å®šåŒ…å«çš„å…ƒç´ è¶Šå¤šï¼Œå â½¤çš„å†…å­˜ å°±è¶Šå¤šï¼‰ã€‚</p><p>bigkeyå¯¹æ€§èƒ½çš„å½±å“å¾ˆå¤§ï¼Œåœ¨å®é™…çš„å¼€å‘ä¸­åº”è¯¥å°½é‡é¿å…bigkeyã€‚</p><p>é€šè¿‡åˆ†æRDBæ–‡ä»¶æ¥å¾—åˆ°bigkeyï¼Œå‰ææ˜¯Redisé‡‡ç”¨çš„æ˜¯RDBæŒä¹…åŒ–ã€‚</p><h3 id="å¤§é‡keyé›†ä¸­è¿‡æœŸé—®é¢˜"><a href="#å¤§é‡keyé›†ä¸­è¿‡æœŸé—®é¢˜" class="headerlink" title="å¤§é‡keyé›†ä¸­è¿‡æœŸé—®é¢˜"></a>å¤§é‡keyé›†ä¸­è¿‡æœŸé—®é¢˜</h3><p>è¿™ä¸€é—®é¢˜æ˜¯åœ¨æŸä¸€æ—¶åˆ»é‡åˆ°äº†å¤§é‡çš„keyè¿‡æœŸï¼Œè€Œè¿™ä¸ªæ¸…é™¤Redisè¿‡æœŸæ•°æ®æ˜¯ç”±Redisä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå¯¼è‡´å®¢æˆ·ç«¯è¯·æ±‚å“åº”é€Ÿåº¦å‡æ…¢ã€‚</p><p>é’ˆå¯¹keyåœ¨æŸä¸€æ—¶åˆ»åŒæ—¶è¿‡æœŸï¼Œæˆ‘ä»¬æå‡ºï¼šä¸ºkeyè®¾ç½®ä¸€ä¸ªéšæœºè¿‡æœŸæ—¶é—´ï¼Œé¿å…é€ æˆæ‹¥å µï¼›</p><p>é’ˆå¯¹æ¸…é™¤è¿‡æœŸkeyå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©æ¸…é™¤è¿‡æœŸkeyäº¤ç»™ä¸€ä¸ªå­çº¿ç¨‹ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ–¹æ³•ä¸ºlazy-freeï¼ˆæƒ°æ€§åˆ é™¤&#x2F;å»¶è¿Ÿé‡Šæ”¾ï¼‰</p><h2 id="Redisç”Ÿäº§é—®é¢˜"><a href="#Redisç”Ÿäº§é—®é¢˜" class="headerlink" title="Redisç”Ÿäº§é—®é¢˜"></a>Redisç”Ÿäº§é—®é¢˜</h2><h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€</h4><p>ç®€å•çš„è¯´å°±æ˜¯å¤§é‡çš„è¯·æ±‚keyä¸å­˜åœ¨ç¼“å­˜ä¸­ï¼Œå¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æ¥æ‰“åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›æ¿€å¢ã€‚è§£å†³åŠæ³•å¦‚ä¸‹ï¼š</p><ol><li><p>ç¼“å­˜æ— æ•ˆçš„keyï¼›</p><blockquote><p>å¦‚æœç¼“å­˜å’Œæ•°æ®åº“éƒ½æŸ¥ä¸åˆ°æŸä¸ª key çš„æ•°æ®å°±å†™â¼€ä¸ªåˆ° Redis ä¸­å»å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…·ä½“å‘½ä»¤å¦‚ ä¸‹ï¼š SET key value EX 10086 ã€‚è¿™ç§â½…å¼å¯ä»¥è§£å†³è¯·æ±‚çš„ key å˜åŒ–ä¸é¢‘ç¹çš„æƒ…å†µï¼Œå¦‚æœâ¿Šå®¢æ¶æ„æ”» å‡»ï¼Œæ¯æ¬¡æ„å»ºä¸åŒçš„è¯·æ±‚ keyï¼Œä¼šå¯¼è‡´ Redis ä¸­ç¼“å­˜â¼¤é‡â½†æ•ˆçš„ key ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§â½…æ¡ˆå¹¶ä¸èƒ½ä» æ ¹æœ¬ä¸Šè§£å†³æ­¤é—®é¢˜ã€‚å¦‚æœâ¾®è¦â½¤è¿™ç§â½…å¼æ¥è§£å†³ç©¿é€é—®é¢˜çš„è¯ï¼Œå°½é‡å°†â½†æ•ˆçš„ key çš„è¿‡æœŸæ—¶é—´è®¾ç½® çŸ­â¼€ç‚¹â½å¦‚ 1 åˆ†é’Ÿã€‚ å¦å¤–ï¼Œè¿™â¾¥å¤šè¯´â¼€å˜´ï¼Œâ¼€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯è¿™æ ·è®¾è®¡ key çš„ï¼š è¡¨å:åˆ—å:ä¸»é”®å:ä¸»é”®å€¼ ã€‚</p></blockquote></li><li><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼›</p><blockquote><p>å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜ åœ¨ï¼Œâ¼©æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ â¼€å®šä¸åœ¨ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨çš„æœ¬è´¨æ˜¯å“ˆå¸Œå‡½æ•°ï¼Œå› ä¸ºæ˜¯å“ˆå¸Œå‡½æ•°ï¼Œé‚£ä¹ˆå°±å­˜åœ¨ä¸€å®šçš„å‡ ç‡å‡ºç°å“ˆå¸Œå†²çªï¼Œæ‰€ä»¥å°±ä¼šå‡ºç°å¸ƒéš†è¿‡æ»¤å™¨è¯´å®ƒä¸åœ¨å®ƒä¸€å®šä¸åœ¨ï¼Œè¯´å®ƒåœ¨å®ƒä¸ä¸€å®šåœ¨ã€‚</p></blockquote></li></ol><h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p>ç¼“å­˜åœ¨åŒâ¼€æ—¶é—´â¼¤â¾¯ç§¯çš„å¤±æ•ˆï¼Œåâ¾¯çš„è¯·æ±‚éƒ½ç›´ æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—â¼¤é‡è¯·æ±‚ã€‚ è¿™å°±å¥½â½é›ªå´©â¼€æ ·ï¼Œæ‘§æ¯æ‹‰æœ½ä¹‹åŠ¿ï¼Œæ•°æ® åº“çš„å‹â¼’å¯æƒ³â½½çŸ¥ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†ã€‚</p><blockquote><p>å¯ä»¥å‘ç°ç¼“å­˜é›ªå´©å’Œç¼“å­˜ç©¿é€çš„åŒºåˆ«å°±æ˜¯è¿™ä¸ªkeyæ˜¯å¦çœŸå®æœ‰æ•ˆå­˜åœ¨çš„ã€‚</p></blockquote><p>æœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ é’ˆå¯¹ Redis æœåŠ¡ä¸å¯â½¤çš„æƒ…å†µï¼š </p><ol><li>é‡‡â½¤ Redis é›†ç¾¤ï¼Œé¿å…å•æœºå‡ºç°é—®é¢˜æ•´ä¸ªç¼“å­˜æœåŠ¡éƒ½æ²¡åŠæ³•ä½¿â½¤ã€‚ </li><li>é™æµï¼Œé¿å…åŒæ—¶å¤„ç†â¼¤é‡çš„è¯·æ±‚ã€‚</li></ol><p>é’ˆå¯¹çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š </p><ol><li>è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´â½å¦‚éšæœºè®¾ç½®ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ã€‚</li><li>ç¼“å­˜æ°¸ä¸å¤±æ•ˆ</li></ol><h2 id="å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§"><a href="#å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§" class="headerlink" title="å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§"></a>å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§</h2><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzIyOTYxNDI5OA==&mid=2247487312&idx=1&sn=fa19566f5729d6598155b5c676eee62d&chksm=e8beb8e5dfc931f3e35655da9da0b61c79f2843101c130cf38996446975014f958a6481aacf1&scene=178&cur_album_id=1699766580538032128#rd">ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†</a></p><p>æˆ‘ä»¬é¦–å…ˆå°±éœ€è¦æ˜ç¡®ä¸€ä¸‹ä¸ºä»€ä¹ˆå¼•å…¥ç¼“å­˜ä¹‹åä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œåœ¨å¼•å…¥ç¼“å­˜ä¹‹å‰ï¼Œæˆ‘ä»¬å­˜å–æ•°æ®éƒ½æ˜¯åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­è¿›è¡Œæ“ä½œçš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å¼•å…¥äº†ç¼“å­˜ä¹‹åï¼Œç³»ç»Ÿè¯»çš„æ—¶å€™ä¼šä¼˜å…ˆä»ç¼“å­˜ä¸­è¯»å–ï¼Œé‚£ä¹ˆå¦‚æœç¼“å­˜ä¸­çš„æ•°æ®å’Œç£ç›˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´è¯¥å¦‚ä½•æ˜¯å¥½ï¼Ÿ</p><p>æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦è®¤çœŸæ€è€ƒä¸€ä¸‹è¯¥å¦‚ä½•è§£å†³ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦é¢å¯¹ä¸‹é¢å‡ ä¸ªé€‰æ‹©ï¼š</p><ul><li>æ›´æ–°ç¼“å­˜ OR åˆ é™¤ç¼“å­˜</li><li>å¦‚æœæ˜¯æ›´æ–°ç¼“å­˜ï¼Œæ˜¯å…ˆæ›´æ–°ç¼“å­˜è¿˜æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼›</li><li>å¦‚æœæ˜¯åˆ é™¤ç¼“å­˜ï¼Œæ˜¯å…ˆåˆ é™¤ç¼“å­˜è¿˜æ˜¯å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜ï¼›</li></ul><p>ä¸‹é¢æˆ‘ä»¬ä¾æ¬¡æ¥çœ‹çœ‹è¿™äº›æ–¹æ¡ˆåˆ†åˆ«ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚</p><h3 id="æ›´æ–°ç¼“å­˜"><a href="#æ›´æ–°ç¼“å­˜" class="headerlink" title="æ›´æ–°ç¼“å­˜"></a>æ›´æ–°ç¼“å­˜</h3><p>å¦‚æœæˆ‘ä»¬é€‰æ‹©æ›´æ–°ç¼“å­˜è¿™ä¸€å¤§æ–¹æ¡ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šå‡ºç°ä¸‹é¢å‡ ä¸ªé€‰æ‹©ï¼šå…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜ORå…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ã€‚</p><p>åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯å…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“è¿˜æ˜¯å…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜éƒ½å›å‡ºç°ä¸‹é¢è¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬ä»¥å…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ä¸ºä¾‹æ¥ä»‹ç»å…¶å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261957695.png" alt="image-20240911115932602"></p><h3 id="åˆ é™¤ç¼“å­˜"><a href="#åˆ é™¤ç¼“å­˜" class="headerlink" title="åˆ é™¤ç¼“å­˜"></a>åˆ é™¤ç¼“å­˜</h3><h4 id="å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“"><a href="#å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“" class="headerlink" title="å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“"></a>å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261957053.png" alt="image-20240911120051711"></p><h4 id="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜"><a href="#å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜" class="headerlink" title="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜"></a>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜</h4><p>å¦‚æœå…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜ï¼Œæ˜¯ä¸ä¼šå‡ºç°ä¸Šé¢è¿™ç§æƒ…å†µçš„ï¼Œä½†æ˜¯è¿˜ä¼šå‡ºç°ä¸‹é¢è¿™ä¸ªé—®é¢˜ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261957387.png" alt="image-20240911122040552"></p><p>æ‰€ä»¥ä¸ºäº†è§£å†³å¹¶å‘æƒ…å†µçš„æœ€å¥½è§£å†³æ–¹æ¡ˆæ˜¯ï¼šå…ˆæ›´æ–°æ•°æ®åº“ååˆ é™¤ç¼“å­˜ï¼›</p><p>ä½†æ˜¯æ— è®ºæ˜¯æ›´æ–°ç¼“å­˜è¿˜æ˜¯åˆ é™¤ç¼“å­˜ï¼Œåªè¦ç¬¬äºŒæ­¥å‘ç”Ÿå¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´ã€‚</p><p>ä¿è¯ç¬¬äºŒæ­¥æˆåŠŸæ‰§è¡Œå°±æ˜¯è§£å†³é—®é¢˜çš„å…³é”®ï¼Œæœ€ç®€å•çš„åŠæ³•æ˜¯<strong>é‡è¯•</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261957109.png" alt="image-20240911122740355"></p><h3 id="å¼‚æ­¥é‡è¯•"><a href="#å¼‚æ­¥é‡è¯•" class="headerlink" title="å¼‚æ­¥é‡è¯•"></a>å¼‚æ­¥é‡è¯•</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261957752.png" alt="image-20240911122814117"></p><p><strong>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œæƒ³è¦ä¿è¯æ•°æ®åº“å’Œç¼“å­˜ä¸€è‡´æ€§ï¼Œæ¨èé‡‡ç”¨ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€æ–¹æ¡ˆï¼Œå¹¶é…åˆã€Œæ¶ˆæ¯é˜Ÿåˆ—ã€æˆ–ã€Œè®¢é˜…å˜æ›´æ—¥å¿—ã€çš„æ–¹å¼æ¥åšã€‚</strong></p><h2 id="Bugè§£å†³"><a href="#Bugè§£å†³" class="headerlink" title="Bugè§£å†³"></a>Bugè§£å†³</h2><h3 id="è§£å†³Rediiså®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡å™¨ä¸ŠRedisæœåŠ¡é—®é¢˜"><a href="#è§£å†³Rediiså®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡å™¨ä¸ŠRedisæœåŠ¡é—®é¢˜" class="headerlink" title="è§£å†³Rediiså®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡å™¨ä¸ŠRedisæœåŠ¡é—®é¢˜"></a><a href="https://blog.csdn.net/m0_51295655/article/details/128791852?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-128791852-blog-82425785.235%5Ev43%5Econtrol&spm=1001.2101.3001.4242.1&utm_relevant_index=1">è§£å†³Rediiså®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡å™¨ä¸ŠRedisæœåŠ¡é—®é¢˜</a></h3>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>53 LinuxæœåŠ¡å™¨</title>
      <link href="/2025/02/26/53%20Linux%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2025/02/26/53%20Linux%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="53-LinuxæœåŠ¡å™¨"><a href="#53-LinuxæœåŠ¡å™¨" class="headerlink" title="53 LinuxæœåŠ¡å™¨"></a>53 LinuxæœåŠ¡å™¨</h1><h2 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h2><p>æœåŠ¡å™¨IPï¼š1.94.101.104</p><p>åä¸ºäº‘è´¦å·ï¼š15107031522</p><p>åä¸ºäº‘å¯†ç ï¼šfyh2380514719</p><p>æœåŠ¡å™¨ç™»å½•å¯†ç ï¼š!Fyh2380514719</p><h2 id="Linuxç›¸å…³å‘½ä»¤"><a href="#Linuxç›¸å…³å‘½ä»¤" class="headerlink" title="Linuxç›¸å…³å‘½ä»¤"></a>Linuxç›¸å…³å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linuxå‘½ä»¤è¡Œè®¿é—®ç½‘é¡µ</span></span><br><span class="line">curl http://localhost:9200</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæä¾›vimçš„ä¸€äº›æ“ä½œå¸®åŠ©</span></span><br><span class="line"><span class="comment"># Shift + Iç¼–è¾‘æ–‡æ¡£</span></span><br><span class="line"><span class="comment"># Escé€€å‡ºç¼–è¾‘</span></span><br><span class="line"><span class="comment"># :q!    å…³é—­æ–‡æ¡£</span></span><br><span class="line"><span class="comment"># :wq!ä¿å­˜æ–‡æ¡£å¹¶å…³é—­</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line"><span class="comment"># .tar.gz åç¼€</span></span><br><span class="line">tar -zxvf æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line"><span class="comment"># .tar.xz åç¼€</span></span><br><span class="line">tar -Jxvf æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°apt</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">free -m</span><br><span class="line">top</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šç«¯å£æ˜¯å¦å ç”¨</span></span><br><span class="line">netstat -tulnp | grep &lt;ç«¯å£å·&gt;</span><br></pre></td></tr></table></figure><h2 id="è½¯ä»¶"><a href="#è½¯ä»¶" class="headerlink" title="è½¯ä»¶"></a>è½¯ä»¶</h2><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨MySQL</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="comment"># å¯†ç  fyh2380514719</span></span><br><span class="line"><span class="comment"># ç”¨æˆ·å root</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡å¯åŠ¨</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦æ­£å¸¸å¯åŠ¨ </span></span><br><span class="line"><span class="built_in">sudo</span> systemctl status mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ol><li><a href="https://blog.csdn.net/mazaiting/article/details/106661158">MySQL å¼‚å¸¸: â€œHost â€˜xxxâ€™ is not allowed to connect to this MySQL serverâ€</a></li><li><a href="https://blog.csdn.net/weixin_45626288/article/details/133220238">åœ¨Ubuntu 22.04 LTS ä¸Šå®‰è£… MySQLä¸¤ç§æ–¹å¼ï¼šåœ¨çº¿æ–¹å¼å’Œç¦»çº¿æ–¹å¼</a></li><li><a href="https://blog.csdn.net/qq_43116788/article/details/84146918">MySql ERROR 1046(3D000): No Database Selectedçš„è§£å†³åŠæ³•</a></li></ol><h3 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºæ–°ç”¨æˆ·fang</span><br><span class="line"># å¯†ç ï¼šfang</span><br><span class="line"></span><br><span class="line">su - fang</span><br><span class="line">cd /home/fang/software/elasticsearch-7.8.0/bin/</span><br><span class="line">./elasticsearch</span><br><span class="line"></span><br><span class="line"># 2ã€ç„¶åä½¿ç”¨å‘½ä»¤ç»‘å®šbashå³å¯ã€‚</span><br><span class="line">usermod -s /bin/bash name</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>54 å†…ç½‘ç©¿é€</title>
      <link href="/2025/02/26/54%20%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"/>
      <url>/2025/02/26/54%20%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="54-å†…ç½‘ç©¿é€"><a href="#54-å†…ç½‘ç©¿é€" class="headerlink" title="54 å†…ç½‘ç©¿é€"></a>54 å†…ç½‘ç©¿é€</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/gui951753/article/details/79593307">NAT(åœ°å€è½¬æ¢æŠ€æœ¯)è¯¦è§£</a></li><li><a href="https://www.cnblogs.com/cyrus0w/p/13123504.html">å†…ç½‘ç©¿é€è¯¦è§£</a></li><li><a href="https://blog.csdn.net/m0_46109609/article/details/127881735">ç®€å•ä½¿ç”¨FRPå®ç°æœ¬åœ°mysqlçš„å†…ç½‘ç©¿é€</a></li></ol><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é˜…è¯»æœ¬æ–‡å‰éœ€è¦å…ˆææ‡‚NATã€PATã€ç«¯å£æ˜ å°„å‡ ä¸ªæ¦‚å¿µã€‚</p><p>å†…ç½‘å®½å¸¦ä¸­çš„ä¸»æœºå¯ä»¥è®¿é—®å…¬ç½‘å®½å¸¦ä¸»æœºï¼Œåä¹‹ä¸å¯ä»¥è®¿é—®ï¼›å…¬ç½‘å®½å¸¦ä¸»æœºå¯ä»¥å’Œå…¬ç½‘å®½å¸¦ä¸»æœºåŒå‘è®¿é—®ï¼›å†…ç½‘å®½å¸¦ä¸­çš„ä¸»æœºå’Œå†…ç½‘å®½å¸¦ä¸­çš„ä¸»æœºäº’ç›¸æ— æ³•è®¿é—®ã€‚é‚£ä¹ˆå†…ç½‘å®½å¸¦ä¸­çš„å®¢æˆ·æœºå’Œå…¬ç½‘å®½å¸¦ä¸­çš„å®¢æˆ·æœºå¦‚ä½•è®¿é—®å¦ä¸€ä¸ªå†…ç½‘å®½å¸¦ä¸­çš„æœåŠ¡å™¨å‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦ç”¨åˆ°å†…ç½‘ç©¿é€æŠ€æœ¯ã€‚</p><h2 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h2><p>NATåå­—å¾ˆå‡†ç¡®ï¼Œç½‘ç»œåœ°å€è½¬æ¢ï¼Œå°±æ˜¯æ›¿æ¢IPæŠ¥æ–‡å¤´éƒ¨çš„åœ°å€ä¿¡æ¯ã€‚NATé€šå¸¸éƒ¨ç½²åœ¨ä¸€ä¸ªç»„ç»‡çš„ç½‘ç»œå‡ºå£ä½ç½®ï¼Œé€šè¿‡å°†å†…éƒ¨ç½‘ç»œIPåœ°å€æ›¿æ¢ä¸ºå‡ºå£çš„IPåœ°å€æä¾›å…¬ç½‘å¯è¾¾æ€§å’Œä¸Šå±‚åè®®çš„è¿æ¥èƒ½åŠ›ã€‚</p><p>å¯¹äºæœ‰Internetè®¿é—®éœ€æ±‚è€Œå†…éƒ¨åˆä½¿ç”¨ç§æœ‰åœ°å€çš„ç½‘ç»œï¼Œå°±è¦åœ¨ç»„ç»‡çš„å‡ºå£ä½ç½®éƒ¨ç½²NATç½‘å…³ï¼Œåœ¨æŠ¥æ–‡ç¦»å¼€ç§ç½‘è¿›å…¥Internetæ—¶ï¼Œå°†æºIPæ›¿æ¢ä¸ºå…¬ç½‘åœ°å€ï¼Œé€šå¸¸æ˜¯å‡ºå£è®¾å¤‡çš„æ¥å£åœ°å€ã€‚ä¸€ä¸ªå¯¹å¤–çš„è®¿é—®è¯·æ±‚åœ¨åˆ°è¾¾ç›®æ ‡ä»¥åï¼Œè¡¨ç°ä¸ºç”±æœ¬ç»„ç»‡å‡ºå£è®¾å¤‡å‘èµ·ï¼Œå› æ­¤è¢«è¯·æ±‚çš„æœåŠ¡ç«¯å¯å°†å“åº”ç”±Internetå‘å›å‡ºå£ç½‘å…³ã€‚å‡ºå£ç½‘å…³å†å°†ç›®çš„åœ°å€æ›¿æ¢ä¸ºç§ç½‘çš„æºä¸»æœºåœ°å€ï¼Œå‘å›å†…éƒ¨ã€‚è¿™æ ·ä¸€æ¬¡ç”±ç§ç½‘ä¸»æœºå‘å…¬ç½‘æœåŠ¡ç«¯çš„è¯·æ±‚å’Œå“åº”å°±åœ¨é€šä¿¡ä¸¤ç«¯å‡æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å®Œæˆäº†ã€‚ä¾æ®è¿™ç§æ¨¡å‹ï¼Œæ•°é‡åºå¤§çš„å†…ç½‘ä¸»æœºå°±ä¸å†éœ€è¦å…¬æœ‰IPåœ°å€äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262001430.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>åœ¨æ•´ä¸ªNATçš„è½¬æ¢ä¸­ï¼Œæœ€å…³é”®çš„æµç¨‹æœ‰ä»¥ä¸‹å‡ ç‚¹</p><ol><li>ç½‘ç»œè¢«åˆ†ä¸ºç§ç½‘å’Œå…¬ç½‘ä¸¤ä¸ªéƒ¨åˆ†ï¼ŒNATç½‘å…³è®¾ç½®åœ¨ç§ç½‘åˆ°å…¬ç½‘çš„è·¯ç”±å‡ºå£ä½ç½®ï¼ŒåŒå‘æµé‡å¿…é¡»éƒ½è¦ç»è¿‡NATç½‘å…³ï¼›</li><li>ç½‘ç»œè®¿é—®åªèƒ½å…ˆç”±ç§ç½‘ä¾§å‘èµ·ï¼Œå…¬ç½‘æ— æ³•ä¸»åŠ¨è®¿é—®ç§ç½‘ä¸»æœºï¼›</li><li>NATç½‘å…³åœ¨ä¸¤ä¸ªè®¿é—®æ–¹å‘ä¸Šå®Œæˆä¸¤æ¬¡åœ°å€çš„è½¬æ¢æˆ–ç¿»è¯‘ï¼Œå‡ºæ–¹å‘åšæºä¿¡æ¯æ›¿æ¢ï¼Œå…¥æ–¹å‘åšç›®çš„ä¿¡æ¯æ›¿æ¢ï¼›</li><li>NATç½‘å…³çš„å­˜åœ¨å¯¹é€šä¿¡åŒæ–¹æ˜¯ä¿æŒé€æ˜çš„ï¼›</li><li>NATç½‘å…³ä¸ºäº†å®ç°åŒå‘ç¿»è¯‘çš„åŠŸèƒ½ï¼Œéœ€è¦ç»´æŠ¤ä¸€å¼ å…³è”è¡¨ï¼ŒæŠŠä¼šè¯çš„ä¿¡æ¯ä¿å­˜ä¸‹æ¥ã€‚</li></ol><h3 id="åŠ¨æ€NAT"><a href="#åŠ¨æ€NAT" class="headerlink" title="åŠ¨æ€NAT"></a><strong>åŠ¨æ€NAT</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262003735.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><h3 id="NATé‡è½½ï¼ˆç»å¸¸åº”ç”¨åˆ°å®é™…ä¸­ï¼‰"><a href="#NATé‡è½½ï¼ˆç»å¸¸åº”ç”¨åˆ°å®é™…ä¸­ï¼‰" class="headerlink" title="NATé‡è½½ï¼ˆç»å¸¸åº”ç”¨åˆ°å®é™…ä¸­ï¼‰"></a><strong>NATé‡è½½</strong>ï¼ˆç»å¸¸åº”ç”¨åˆ°å®é™…ä¸­ï¼‰</h3><p>è¿™æ˜¯æœ€å¸¸ç”¨çš„NATç±»å‹ã€‚NATé‡è½½ä¹Ÿæ˜¯åŠ¨æ€NATï¼Œå®ƒåˆ©ç”¨æºç«¯å£å°†å¤šä¸ªç§ç½‘ipåœ°å€æ˜ å°„åˆ°ä¸€ä¸ªå…¬ç½‘ipåœ°å€(å¤šå¯¹ä¸€)ã€‚é‚£ä¹ˆï¼Œå®ƒçš„ç‹¬ç‰¹ä¹‹å¤„ä½•åœ¨å‘¢?å®ƒä¹Ÿè¢«ç§°ä¸ºç«¯å£åœ°å€ç‰¹æ¢(PAT)ã€‚é€šè¿‡ä½¿ç”¨PAT(NATé‡è½½)ï¼Œåªéœ€ä½¿ç”¨ä¸€ä¸ªå…¬ç½‘ipåœ°å€ï¼Œå°±å¯å°†æ•°åƒåç”¨æˆ·è¿æ¥åˆ°å› ç‰¹ç½‘ã€‚å…¶æ ¸å¿ƒä¹‹å¤„å°±åœ¨äºåˆ©ç”¨ç«¯å£å·å®ç°å…¬ç½‘å’Œç§ç½‘çš„è½¬æ¢ã€‚</p><p>é¢å¯¹ç§ç½‘å†…éƒ¨æ•°é‡åºå¤§çš„ä¸»æœºï¼Œå¦‚æœNATåªè¿›è¡ŒIPåœ°å€çš„ç®€å•æ›¿æ¢ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼š**å½“æœ‰å¤šä¸ªå†…éƒ¨ä¸»æœºå»è®¿é—®åŒä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œä»è¿”å›çš„ä¿¡æ¯ä¸è¶³ä»¥åŒºåˆ†å“åº”åº”è¯¥è½¬å‘åˆ°å“ªä¸ªå†…éƒ¨ä¸»æœºã€‚**æ­¤æ—¶ï¼Œéœ€è¦NATè®¾å¤‡æ ¹æ®ä¼ è¾“å±‚ä¿¡æ¯æˆ–å…¶ä»–ä¸Šå±‚åè®®å»åŒºåˆ†ä¸åŒçš„ä¼šè¯ï¼Œå¹¶ä¸”å¯èƒ½è¦å¯¹ä¸Šå±‚åè®®çš„æ ‡è¯†è¿›è¡Œè½¬æ¢ï¼Œæ¯”å¦‚TCPæˆ–UDPç«¯å£å·ã€‚è¿™æ ·NATç½‘å…³å°±å¯ä»¥å°†ä¸åŒçš„å†…éƒ¨è¿æ¥è®¿é—®æ˜ å°„åˆ°åŒä¸€å…¬ç½‘IPçš„ä¸åŒä¼ è¾“å±‚ç«¯å£ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å®ç°å…¬ç½‘IPçš„å¤ç”¨å’Œè§£å¤ç”¨ã€‚è¿™ç§æ–¹å¼ä¹Ÿè¢«ç§°ä¸ºç«¯å£è½¬æ¢PATã€NAPTæˆ–IPä¼ªè£…ï¼Œä½†æ›´å¤šæ—¶å€™ç›´æ¥è¢«ç§°ä¸ºNATï¼Œå› ä¸ºå®ƒæ˜¯æœ€å…¸å‹çš„ä¸€ç§åº”ç”¨æ¨¡å¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262003619.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼ŒNATåˆ©ç”¨ç«¯å£å·çš„å”¯ä¸€æ€§å®ç°äº†å…¬ç½‘ipè½¬æ¢ä¸ºç§ç½‘ipçš„è¿™ä¸€æ­¥ã€‚PATï¼ˆNATé‡è½½ï¼‰èƒ½å¤Ÿä½¿ç”¨ä¼ è¾“å±‚ç«¯å£å·æ¥æ ‡è¯†ä¸»æœºï¼Œå› æ­¤ï¼Œä»ç†è®ºä¸Šè¯´ï¼Œæœ€å¤šå¯è®©å¤§çº¦65000å°ä¸»æœºå…±ç”¨ä¸€ä¸ªå…¬æœ‰IPåœ°å€</strong></p><p>ä½†æ˜¯è¿™æ ·å°±ä¼šæœ‰ä¸Šé¢æåˆ°çš„é‚£ä¸ªé—®é¢˜ï¼šå†…ç½‘å®½å¸¦ä¸­çš„å®¢æˆ·æœºå’Œå…¬ç½‘å®½å¸¦ä¸­çš„å®¢æˆ·æœºå¦‚ä½•è®¿é—®å¦ä¸€ä¸ªå†…ç½‘å®½å¸¦ä¸­çš„æœåŠ¡å™¨å‘¢ï¼Ÿ</p><h2 id="å†…ç½‘ç©¿é€"><a href="#å†…ç½‘ç©¿é€" class="headerlink" title="å†…ç½‘ç©¿é€"></a>å†…ç½‘ç©¿é€</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å¯¹äºåœ¨NATä¹‹åçš„æœåŠ¡å™¨æ¥è¯´ï¼Œå…¶ä¸æ˜¯ä¸èƒ½ä¸»åŠ¨è®¿é—®å…¬ç½‘ç«¯å£ï¼Œè€Œæ˜¯ä¸èƒ½åè¿‡æ¥æœ‰æ•ˆçš„è¢«å…¬ç½‘è®¿é—®ã€‚æ‰€ä»¥å¯ä»¥åœ¨ä¸­é—´æ¶è®¾ä¸€ä¸ªå…¬ç½‘æœåŠ¡å™¨ï¼Œ<strong>è®©åœ¨NATä¹‹åçš„æœåŠ¡å™¨æŒç»­ä¸»åŠ¨è®¿é—®è¿™ä¸ªæ‹¥æœ‰å…¬ç½‘IPåœ°å€çš„æœåŠ¡å™¨ï¼Œ</strong>ï¼Œè¿™æ ·å†…ç½‘æœåŠ¡å™¨å°±æˆåŠŸä¸å…¬ç½‘ä¸­è½¬æœåŠ¡å™¨å»ºç«‹äº†ä¸€ä¸ªè¿æ¥é€šé“ã€‚ç„¶åå½“æœ‰ä»»ä½•å…¶ä»–NATåçš„å®¢æˆ·ç«¯ä¸»åŠ¨è¿æ¥å…¬ç½‘ä¸­è½¬æœåŠ¡å™¨æ—¶ï¼Œå…¬ç½‘æœåŠ¡å™¨æ¥æ”¶åˆ°è¿æ¥è¯·æ±‚ä¹‹åé©¬ä¸ŠæŠŠè¿™è¿æ¥è¯·æ±‚é€šè¿‡å…ˆå‰å»ºç«‹å¥½çš„éš§é“è½¬å‘åˆ°å†…ç½‘æœåŠ¡å™¨ï¼Œå†…ç½‘æœåŠ¡å™¨å°†å“åº”æ•°æ®åŒ…å†åŸè·¯è½¬å‘å›å»ï¼Œæœ€ç»ˆåˆ°è¾¾å…¬ç½‘ä¸­è½¬æœåŠ¡å™¨ï¼Œç„¶åè¿”å›ç»™å…¶ä»–NATåçš„å®¢æˆ·ç«¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262002431.png" alt="img"></p><h3 id="ç‚¹å¯¹ç‚¹ç©¿é€åŸç†"><a href="#ç‚¹å¯¹ç‚¹ç©¿é€åŸç†" class="headerlink" title="ç‚¹å¯¹ç‚¹ç©¿é€åŸç†"></a>ç‚¹å¯¹ç‚¹ç©¿é€åŸç†</h3><p>åœ¨å†…ç½‘ç©¿é€ä¼ è¾“å¤§é‡æ•°æ®æ—¶å¦‚æœéƒ½ç»è¿‡æœåŠ¡å™¨ä¸­è½¬çš„è¯ï¼Œè¿™æ ·ä¼šå¯¹æœåŠ¡å™¨ç«¯å¸¦å®½å‹åŠ›æ¯”è¾ƒå¤§ã€‚åªè¦æ˜¯æ•°æ®é‡å¾ˆå¤§ï¼Œè€Œä¸€èˆ¬åˆ©ç”¨ä¸­è½¬æœåŠ¡å™¨åˆéœ€è¦ä¸€å®šè§„æ¨¡æŠ•å…¥çš„åº”ç”¨ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è€ƒè™‘ç”¨P2PæŠ€æœ¯ã€‚</p><p>1.UDPæ‰“æ´æŠ€æœ¯</p><p>æœ€ä¸ºå¸¸è§çš„å®ç°P2Pçš„æ–¹å¼æ˜¯é‡‡ç”¨UDPæ‰“æ´æŠ€æœ¯ï¼ŒUDPæ‰“æ´æŠ€æœ¯æ˜¯é€šè¿‡ä¸­é—´æœåŠ¡å™¨çš„ååŠ©åœ¨å„è‡ªçš„NATç½‘å…³ä¸Šå»ºç«‹ç›¸å…³çš„è¡¨é¡¹ï¼Œä½¿P2Pè¿æ¥çš„åŒæ–¹å‘é€çš„æŠ¥æ–‡èƒ½å¤Ÿç›´æ¥ç©¿é€å¯¹æ–¹çš„NATç½‘å…³ï¼Œä»è€Œå®ç°P2På®¢æˆ·ç«¯äº’è¿ã€‚å¦‚æœä¸¤å°ä½äºNATè®¾å¤‡åé¢çš„P2På®¢æˆ·ç«¯å¸Œæœ›åœ¨è‡ªå·±çš„NATç½‘å…³ä¸Šæ‰“ä¸ªæ´ï¼Œé‚£ä¹ˆä»–ä»¬éœ€è¦ä¸€ä¸ªååŠ©è€…â€”â€”é›†ä¸­æœåŠ¡å™¨ï¼Œå¹¶ä¸”è¿˜éœ€è¦ä¸€ç§ç”¨äºæ‰“æ´çš„Sessionå»ºç«‹æœºåˆ¶ã€‚</p><p>Sessionå»ºç«‹æœºåˆ¶ï¼š</p><p>å‡å®šå®¢æˆ·ç«¯Aè¦å‘èµ·å¯¹å®¢æˆ·ç«¯Bçš„ç›´æ¥è¿æ¥ï¼Œå…·ä½“çš„â€œæ‰“æ´â€è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰Aæœ€åˆä¸çŸ¥é“å¦‚ä½•å‘å®¢æˆ·ç«¯Bå‘èµ·è¿æ¥ï¼Œäºæ˜¯Aå‘é›†ä¸­æœåŠ¡å™¨ï¼ˆæœ¬è´¨ä¸Šæ˜¯ä¸€å°è¢«è®¾ç½®åœ¨å…¬ç½‘ä¸Šçš„æœåŠ¡å™¨ï¼Œå»ºç«‹P2Pçš„åŒæ–¹éƒ½å¯ä»¥ç›´æ¥è®¿é—®åˆ°è¿™å°æœåŠ¡å™¨ã€‚ä½äºNATç½‘å…³åé¢çš„å®¢æˆ·ç«¯Aå’ŒBéƒ½å¯ä»¥ä¸ä¸€å°å·²çŸ¥çš„é›†ä¸­æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå¹¶é€šè¿‡è¿™å°é›†ä¸­æœåŠ¡å™¨äº†è§£å¯¹æ–¹çš„ä¿¡æ¯å¹¶ä¸­è½¬å„è‡ªçš„ä¿¡æ¯ï¼‰å‘é€æ¶ˆæ¯ï¼Œè¯·æ±‚é›†ä¸­æœåŠ¡å™¨å¸®åŠ©å»ºç«‹ä¸å®¢æˆ·ç«¯Bçš„UDPè¿æ¥ã€‚</p><p>ï¼ˆ2ï¼‰é›†ä¸­æœåŠ¡å™¨å°†å«æœ‰Bçš„å¤–ç½‘å’Œå†…ç½‘çš„åœ°å€äºŒå…ƒç»„å‘ç»™Aï¼ŒåŒæ—¶ï¼Œé›†ä¸­æœåŠ¡å™¨å°†åŒ…å«æœ‰Açš„å¤–ç½‘å’Œå†…ç½‘çš„åœ°å€äºŒå…ƒç»„ä¿¡æ¯çš„æ¶ˆæ¯ä¹Ÿå‘ç»™Bã€‚è¿™æ ·ä¸€æ¥ï¼Œ Aä¸Bå°±éƒ½çŸ¥é“å¯¹æ–¹å¤–ç½‘å’Œå†…ç½‘çš„åœ°å€äºŒå…ƒç»„ä¿¡æ¯äº†ã€‚</p><p>ï¼ˆ3ï¼‰å½“Aæ”¶åˆ°ç”±é›†ä¸­æœåŠ¡å™¨å‘æ¥çš„åŒ…å«Bçš„å¤–ç½‘å’Œå†…ç½‘çš„åœ°å€äºŒå…ƒç»„ä¿¡æ¯åï¼ŒAå¼€å§‹å‘Bçš„åœ°å€äºŒå…ƒç»„å‘é€UDPæ•°æ®åŒ…ï¼Œå¹¶ä¸”Aä¼šè‡ªåŠ¨é”å®šç¬¬ä¸€ä¸ªç»™å‡ºå“åº”çš„Bçš„åœ°å€äºŒå…ƒç»„ã€‚åŒç†ï¼Œå½“Bæ”¶åˆ°ç”±é›†ä¸­æœåŠ¡å™¨å‘æ¥çš„Açš„å¤–ç½‘å’Œå†…ç½‘åœ°å€äºŒå…ƒç»„ä¿¡æ¯åï¼Œä¹Ÿä¼šå¼€å§‹å‘Açš„å¤–ç½‘å’Œå†…ç½‘çš„åœ°å€äºŒå…ƒç»„å‘é€UDPæ•°æ®åŒ…ï¼Œå¹¶ä¸”è‡ªåŠ¨é”å®šç¬¬ä¸€ä¸ªå¾—åˆ°Aå›åº”çš„åœ°å€äºŒå…ƒç»„ã€‚ä¸€æ—¦Aä¸Béƒ½å‘å¯¹æ–¹çš„NATè®¾å¤‡åœ¨å¤–ç½‘ä¸Šçš„åœ°å€äºŒå…ƒç»„å‘é€äº†æ•°æ®åŒ…ï¼Œå°±æ‰“å¼€äº†Aä¸Bä¹‹é—´çš„â€œæ´â€ï¼ŒAä¸Bå‘å¯¹æ–¹çš„å¤–ç½‘åœ°å€å‘é€æ•°æ®ï¼Œç­‰æ•ˆä¸ºå‘å¯¹æ–¹çš„å®¢æˆ·ç«¯ç›´æ¥å‘é€UDPæ•°æ®åŒ…äº†ã€‚ä¸€æ—¦åº”ç”¨ç¨‹åºç¡®è®¤å·²ç»å¯ä»¥é€šè¿‡å¾€å¯¹æ–¹çš„å¤–ç½‘åœ°å€å‘é€æ•°æ®åŒ…çš„æ–¹å¼è®©æ•°æ®åŒ…åˆ°è¾¾NATåé¢çš„ç›®çš„åº”ç”¨ç¨‹åºï¼Œç¨‹åºä¼šè‡ªåŠ¨åœæ­¢ç»§ç»­å‘é€ç”¨äºâ€œæ‰“æ´â€çš„æ•°æ®åŒ…ï¼Œè½¬è€Œå¼€å§‹çœŸæ­£çš„P2Pæ•°æ®ä¼ è¾“ã€‚</p><p>å½“ç„¶ï¼ŒUDPè½¬æ¢åè®®æä¾›çš„â€œæ´â€ä¸æ˜¯ç»å¯¹å¯é çš„ï¼Œå¤šæ•°NATè®¾å¤‡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªUDPè½¬æ¢çš„ç©ºé—²çŠ¶æ€è®¡æ—¶å™¨ï¼Œå¦‚æœåœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰UDPæ•°æ®é€šä¿¡ï¼ŒNATè®¾å¤‡ä¼šå…³æ‰ç”±â€œæ‰“æ´â€è¿‡ç¨‹æ‰“å‡ºæ¥çš„â€œæ´â€ã€‚å¦‚æœP2Påº”ç”¨ç¨‹åºå¸Œæœ›â€œæ´â€çš„å­˜æ´»æ—¶é—´ä¸å—NATç½‘å…³çš„é™åˆ¶ï¼Œå°±æœ€å¥½åœ¨ç©¿è¶ŠNATä»¥åè®¾å®šä¸€ä¸ªç©¿è¶Šçš„æœ‰æ•ˆæœŸã€‚</p><p>2.TCPæ‰“æ´æŠ€æœ¯<br>ä»ç°åœ¨çš„ä¸»æµåº”ç”¨çš„è§’åº¦ä¸Šæ¥çœ‹ï¼ŒåŸºäºTCPçš„P2Påº”ç”¨æ˜¾ç„¶ä¸å¦‚åŸºäºUDPçš„åº”ç”¨é‚£ä¹ˆå¹¿æ³›ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨æ‰“æ´çš„éœ€æ±‚ã€‚TCPç›¸å¯¹äºUDPè€Œè¨€è¦å¤æ‚çš„å¤šï¼ŒTCPè¿æ¥çš„å»ºç«‹è¦ä¾èµ–äºä¸‰æ¬¡æ¡æ‰‹çš„äº¤äº’ï¼Œæ‰€ä»¥NATç½‘å…³åœ¨å¤„ç†TCPè¿æ¥çš„æ—¶å€™ï¼Œéœ€è¦æ›´å¤šçš„å¼€é”€ã€‚ä½†æ˜¯ï¼Œç”±äºTCPåè®®å®Œå¤‡çš„çŠ¶æ€æœºæœºåˆ¶ï¼ŒTCPåè€Œæ¯”UDPæ›´èƒ½ç²¾ç¡®çš„è·å–æŸä¸ªSessionçš„ç”Ÿå‘½æœŸã€‚</p><p>ä¸€ç§æ–°çš„ä»£ç†ç±»å‹ XTCP èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ç°æ–¹å¼å¯ä»¥æ˜¯é‡‡ç”¨æ­å»ºFRPæœåŠ¡å™¨çš„æ–¹å¼ï¼Œåœ¨ä¼ è¾“æ•°æ®çš„ä¸¤ç«¯éƒ½éƒ¨ç½²ä¸ŠFRPå®¢æˆ·ç«¯ç”¨äºå»ºç«‹ç›´æ¥çš„è¿æ¥ã€‚</p><blockquote><p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œé€šå¸¸ä¼šåœ¨ç½‘ç»œä¸­åŠ å…¥é˜²ç«å¢™ï¼Œé˜²ç«å¢™æœ‰å…¥ç«™è§„åˆ™å’Œå‡ºç«™è§„åˆ™ã€‚å¦‚æœä¸æ˜¯éå¸¸ä¸¥æ ¼çš„å®‰å…¨ç®¡æ§ï¼Œé€šå¸¸æ˜¯ä¸ä¼šè®¾ç½®å‡ºç«™è§„åˆ™çš„ï¼Œä½†æ˜¯å…¥ç«™è§„åˆ™ä¸€èˆ¬éƒ½ä¼šè®¾ç½®çš„ï¼Œæ¯”å¦‚è¯´å¤–éƒ¨å¯ä»¥é€šè¿‡80ç«¯å£ä¼ å…¥å†…ç½‘çš„WEBæœåŠ¡å™¨è®¿é—®ç½‘é¡µï¼Œä½†æ˜¯ä¸èƒ½é€šè¿‡3389ç«¯å£ç™»é™†å†…ç½‘çš„è¿œç¨‹æ¡Œé¢ã€‚è€Œåœ¨å†…ç½‘æ¸—é€çš„è¿‡ç¨‹ä¸­ç¢°åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ©ä¸Šé¢å†…ç½‘ä¼ ç»Ÿçš„æ–¹å¼å®ç°ç©¿é€é˜²ç«å¢™çš„å…¥ç«™è§„åˆ™ã€‚å› ä¸ºé˜²ç«å¢™é€šå¸¸åªæ‹¦æˆªäº†å…¥ç«™ï¼Œæ²¡æœ‰æ‹¦æˆªå‡ºç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©å†…ç½‘æœåŠ¡å™¨ä¸»åŠ¨å‡ºç«™ï¼ˆä¸»åŠ¨è¿æ¥åˆ°é»‘å®¢çš„æœåŠ¡å™¨ï¼‰ï¼Œä¸é»‘å®¢è‡ªå·±çš„æœåŠ¡å™¨æ‰“é€šéš§é“ï¼Œæœ€ç»ˆç»•è¿‡é˜²ç«å¢™è¿ä¸Š3389è¿œç¨‹æ¡Œé¢ã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯æˆ‘ä»¬å·²ç»æ‹¿ä¸‹äº†å†…ç½‘å…¶ä¸­ä¸€å°å¹¶æ²¡æœ‰åšä»»ä½•é˜²ç«å¢™è§„åˆ™çš„ç™½åå•æœåŠ¡å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¿ä¸Šå†…ç½‘å¦ä¸€å°åšäº†å…¥ç«™è§„åˆ™çš„ç›®æ ‡æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©è¿™å°ç™½åå•æœåŠ¡å™¨ä½œä¸ºä¸€ä¸ªè·³æ¿ï¼Œè®©ä»–å…ˆç›‘å¬è‡ªèº«ä»»æ„ä¸€ä¸ªç«¯å£ï¼Œç„¶ååœ¨æœ‰ä»»ä½•ç”¨æˆ·è¿ä¸Šè¿™ä¸ªç«¯å£ä¹‹åï¼Œç™½åå•æœåŠ¡å™¨å°±ä¸»åŠ¨è¿ä¸Šå†…ç½‘çš„ç›®æ ‡æœåŠ¡å™¨ï¼Œç„¶åå€ŸåŠ©è¿™å°ç™½åå•æœåŠ¡å™¨æ‰“é€šé»‘å®¢å’Œç›®æ ‡æœåŠ¡å™¨çš„è¿æ¥éš§é“ã€‚è€Œåœ¨é»‘å®¢å·¥å…·ä¸­å¤§åé¼é¼çš„lcxåŸç†ä¹Ÿå°±æ˜¯å¦‚æ­¤ï¼Œå‰è€…çš„å®ç°æ˜¯lcxçš„listenå’Œslaveå‘½ä»¤ï¼Œåè€…çš„å®ç°æ˜¯lcxçš„tranå‘½ä»¤ã€‚</p></blockquote><blockquote><p><strong>å†…ç½‘ç©¿é€ä¼ ç»Ÿæ–¹å¼ä¼šå‡ºç°æœåŠ¡å™¨å’Œå®¢æˆ·æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“å…¨éƒ¨ç»è¿‡ä¸­è½¬æœåŠ¡å™¨ï¼Œä¼ è¾“é€Ÿåº¦å°†å—åˆ¶äºä¸­è½¬æœåŠ¡å™¨çš„ä¸Šä¸‹è¡Œå¸¦å®½ï¼Œä¸è¿‡ç¨³å®šæ€§å¾ˆå¥½ï¼Œå¯¹äºè‡ªå·±è¦è´­ç½®çš„äº‘ä¸»æœºè¦æ±‚å°±æ˜¯å¤§å¸¦å®½ï¼Œä¸€èˆ¬è¿™ç§äº‘ä¸»æœºæŒ‰æµé‡è®¡è´¹ï¼Œä¼ è¾“çš„æ•°æ®é‡è¶Šå¤§ä»·æ ¼è‡ªç„¶è¶Šè´µã€‚æ‰€ä»¥ç‚¹å¯¹ç‚¹ç©¿é€ä¾¿èƒ½è§£å†³æµé‡å¸¦æ¥çš„å›°æ‰°ï¼Œç‚¹å¯¹ç‚¹å¯ä»¥å®ç°æœåŠ¡å™¨å’Œå®¢æˆ·æœºä¹‹é—´æ‰“æ´ç›´æ¥è¿›è¡Œæ•°æ®é€šä¿¡ï¼Œè¿™ç§æ–¹å¼ä¸€èˆ¬ç”¨äºudpåè®®çš„ä¼ è¾“ï¼Œæ¯”å¦‚åº”ç”¨äºè¿œç¨‹NASçœ‹è§†é¢‘å¬æ­Œï¼Œä½†è¿™ç§æ–¹å¼éœ€è¦æœåŠ¡å™¨å’Œå®¢æˆ·æœºéƒ½å®‰è£…ç©¿é€å·¥å…·ï¼Œå¯¹ç”¨æˆ·è®¿é—®ç«¯æ¥è¯´ä¸å¤Ÿæ–¹ä¾¿ï¼Œè€Œä¸”è¿™ç§æ–¹å¼å—å¤æ‚ç½‘ç»œç¯å¢ƒå½±å“è¾ƒå¤§ï¼Œä¸èƒ½100%å®ç°ï¼Œç¨³å®šæ€§æ¬ ç¼ºã€‚</strong></p></blockquote><h2 id="FRPå†…ç½‘ç©¿é€"><a href="#FRPå†…ç½‘ç©¿é€" class="headerlink" title="FRPå†…ç½‘ç©¿é€"></a>FRPå†…ç½‘ç©¿é€</h2><h3 id="å‰è¨€-1"><a href="#å‰è¨€-1" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>FRPä½¿ç”¨ Go è¯­è¨€å¼€å‘ï¼Œå¯ä»¥æ”¯æŒ Windowsã€Linuxã€macOSã€ARM ç­‰å¤šå¹³å°éƒ¨ç½²ã€‚frpå†…ç½‘ç©¿é€æ— éœ€å¤šå¤æ‚çš„é…ç½®å°±å¯ä»¥è¾¾åˆ°æ¯”è¾ƒå¥½çš„ç©¿é€æ•ˆæœï¼Œå…·æœ‰è¾ƒå¼ºçš„æ‰©å±•æ€§ï¼Œæ”¯æŒtcp, udp, http, https åè®®ï¼Œå¹¶ä¸” web æœåŠ¡æ”¯æŒæ ¹æ®åŸŸåè¿›è¡Œè·¯ç”±è½¬å‘ã€‚æ­¤å¤–ï¼Œ**FRP æä¾›äº†ä¸€ç§æ–°çš„ä»£ç†ç±»å‹ XTCP ï¼Œå¯ä»¥åœ¨ä¼ è¾“å¤§é‡æ•°æ®æ—¶è®©æµé‡ä¸ç»è¿‡æœåŠ¡å™¨ä¸­è½¬ï¼Œç”¨äºå®ç°ç‚¹å¯¹ç‚¹ç©¿é€,**å½“ç„¶ï¼Œæ­¤åŠŸèƒ½å¹¶ä¸èƒ½ä¿è¯åœ¨ä½ çš„ç½‘ç»œç¯å¢ƒ 100% å¯ç”¨ï¼ŒæˆåŠŸç‡è¾ƒä½ï¼Œè€Œä¸”è¿˜è¦æ±‚è®¿é—®ç«¯ä¹Ÿå¾—è¿è¡Œ FRP å®¢æˆ·ç«¯ (ç›®å‰æ‰‹æœºç«¯iosæ²¡æœ‰frpå®¢æˆ·ç«¯è½¯ä»¶)ã€‚ç”±äºå®ç°æ¡ä»¶è¾ƒå¤šï¼Œæ‰€ä»¥æœ‰æ–‡ä»¶ä¼ è¾“éœ€æ±‚çš„æœ‹å‹ä½†å¿…é¡»ç”¨frpçš„æœ‹å‹è¿˜æ˜¯å»ºè®®ä¹°å¸¦å®½ç¨å¤§ä¸€ç‚¹çš„ VPS ä¼šæ¯”è¾ƒçœå¿ƒã€‚<strong>frpé€‚åˆæœ‰linuxåŸºç¡€çš„ä¸ªäººï¼Œä¸”éœ€è¦è‡ªè´­ä¸€ä¸ªäº‘ä¸»æœºåšä¸­è½¬ï¼Œä¼ä¸šè¿½æ±‚ç¨³å®šå¯ä»¥è€ƒè™‘å…¶ä»–æ–¹å¼ã€‚</strong></p><h3 id="ä¸­è½¬æœåŠ¡å™¨FRPæ­å»º"><a href="#ä¸­è½¬æœåŠ¡å™¨FRPæ­å»º" class="headerlink" title="ä¸­è½¬æœåŠ¡å™¨FRPæ­å»º"></a>ä¸­è½¬æœåŠ¡å™¨FRPæ­å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> wget <span class="string">&quot;https://github.com/fatedier/frp/releases/download/v0.33.0/frp_0.33.0_linux_amd64.tar.gz&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; $ vi frps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000     <span class="comment">#éš§é“ç«¯å£ï¼Œé»˜è®¤é…ç½®ä¸­ç›‘å¬çš„æ˜¯ 7000 ç«¯å£ï¼Œå¯æ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹ã€‚</span></span><br><span class="line">subdomain_host = frp.abc.top  <span class="comment">#é…ç½®ä¸­è½¬æœåŠ¡å™¨åŸŸåç»‘å®š,å¯é€‰é…ç½®ï¼Œå¦‚æœåŸŸåå¤šå¯ä»¥è®¾ç½®ä¸€ä¸ª</span></span><br><span class="line">authentication_method = token  <span class="comment">#å¯ç”¨tokenéªŒè¯ï¼Œfrpcä¹Ÿéœ€è¦åŠ æ­¤å‚æ•°</span></span><br><span class="line">token = changeit              <span class="comment">#tokenå¯†ç </span></span><br><span class="line">vhost_http_port = 80                 <span class="comment">#å†…ç½‘æœåŠ¡å™¨httpæ˜ å°„çš„ç«¯å£ï¼Œå†…ç½‘å¯ä»¥æœ‰å¤šä¸ªç½‘ç«™ä½¿ç”¨è¿™ä¸ªç«¯å£</span></span><br><span class="line">vhost_https_port = 443               <span class="comment">#å†…ç½‘æœåŠ¡å™¨httpsæ˜ å°„çš„ç«¯å£ï¼Œå†…ç½‘å¯ä»¥æœ‰å¤šä¸ªç½‘ç«™ä½¿ç”¨è¿™ä¸ªç«¯å£</span></span><br><span class="line">dashboard_port = 7500   <span class="comment">#é…ç½®Dashboardç›‘æ§frpçŠ¶æ€çš„ç«¯å£ï¼Œåé¢å¯ä»¥ç›´æ¥è®¿é—®http://frp.abc.top:7500/æˆ–http://ä¸­è½¬æœåŠ¡å™¨å…¬ç½‘IP:7500/</span></span><br><span class="line">dashboard_user = admin  <span class="comment">#ç›‘æ§è®¿é—®è´¦æˆ·</span></span><br><span class="line">dashboard_pwd = admin   <span class="comment">#ç›‘æ§è®¿é—®å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‰å°å¯åŠ¨frps</span></span><br><span class="line">./frps -c ./frps.ini</span><br></pre></td></tr></table></figure><p><a href="http://1.94.101.104:7500/static/#/">http://1.94.101.104:7500/static/#/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#å¯åŠ¨</span><br><span class="line">sudo systemctl start frps </span><br><span class="line">#å…³é—­</span><br><span class="line">sudo systemctl stop frps</span><br><span class="line">#é‡å¯</span><br><span class="line">sudo systemctl restart frps</span><br><span class="line">#æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">sudo systemctl status frps</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Windowsä¸­è½¬æœåŠ¡å™¨FRPæ­å»º"><a href="#Windowsä¸­è½¬æœåŠ¡å™¨FRPæ­å»º" class="headerlink" title="Windowsä¸­è½¬æœåŠ¡å™¨FRPæ­å»º"></a>Windowsä¸­è½¬æœåŠ¡å™¨FRPæ­å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 1.94.101.104</span><br><span class="line">server_port = 7000</span><br><span class="line">authentication_method = token  </span><br><span class="line">token = fyh2380514719</span><br><span class="line"></span><br><span class="line">[ssh]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 22</span><br><span class="line">remote_port = 6000</span><br><span class="line"></span><br><span class="line">[secret_ssh]                             </span><br><span class="line"><span class="built_in">type</span> = stcp            </span><br><span class="line">sk = abcdefg           </span><br><span class="line">local_ip = 127.0.0.1                                                                                            </span><br><span class="line">local_port = 22                                                                                                  </span><br><span class="line">remote_port = 6000 </span><br><span class="line"></span><br><span class="line">[web]            </span><br><span class="line"><span class="built_in">type</span> = http         </span><br><span class="line">local_port = 80   </span><br><span class="line">custom_domains = 1.94.101.104</span><br><span class="line">remote_port = 8000</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 3306</span><br><span class="line">remote_port = 13306</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frpc.exe -c frpc.ini</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>56 ç®—æ³•</title>
      <link href="/2025/02/26/56%20%E7%AE%97%E6%B3%95/"/>
      <url>/2025/02/26/56%20%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="56-ç®—æ³•"><a href="#56-ç®—æ³•" class="headerlink" title="56 ç®—æ³•"></a>56 ç®—æ³•</h1><h2 id="Javaæ§åˆ¶å°è¾“å…¥"><a href="#Javaæ§åˆ¶å°è¾“å…¥" class="headerlink" title="Javaæ§åˆ¶å°è¾“å…¥"></a>Javaæ§åˆ¶å°è¾“å…¥</h2><p>åœ¨Javaä¸­è´Ÿè´£è¾“å…¥çš„ç±»æ˜¯Scannerï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è¿›è¡Œè¾“å…¥æ—¶ï¼Œéœ€è¦åˆ›å»ºè¿™ä¸ªå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in); <span class="comment">// å‚æ•°System.in è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ§åˆ¶å°è¾“å…¥</span></span><br></pre></td></tr></table></figure><p>åœ¨Scannerä¸­å®šä¹‰äº†å¤šç§æ–¹æ³•ç”¨æ¥è·å–æ§åˆ¶å°è¾“å…¥ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.nextLine(); <span class="comment">// è·å–ä¸€è¡Œçš„å­—ç¬¦ä¸²ï¼Œæ³¨æ„å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œä¸”è¾“å…¥ä¹‹å‰å­˜åœ¨æ¢è¡Œ éœ€è¦ä½¿ç”¨in.nextLine()ï¼›æ¥æŠµæ¶ˆæ‰æ¢è¡Œã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.next(); <span class="comment">// è·å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šä»¥ç©ºæ ¼ã€å›è½¦ä¸ºç»“æŸç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> in.nextInt(); <span class="comment">// è·å–æ•´å‹</span></span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="variable">x</span> <span class="operator">=</span> in.nextFloat(); <span class="comment">// è·å–å•ç²¾åº¦æµ®ç‚¹å‹</span></span><br><span class="line"></span><br><span class="line"><span class="type">Double</span> <span class="variable">x</span> <span class="operator">=</span> in.nextDouble(); <span class="comment">// è·å–åŒç²¾åº¦æµ®ç‚¹å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(in.hasNextLine())&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.nextLine();</span><br><span class="line">&#125; <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿˜å­˜åœ¨ä¸‹ä¸€è¡Œè¾“å…¥</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">while</span>(in.hasNext())&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.next();</span><br><span class="line">&#125; <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿˜å­˜åœ¨ä¸‹ä¸€ä¸ªè¾“å…¥</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ç±»åå¿…é¡»ä¸º Main, ä¸è¦æœ‰ä»»ä½• package xxx ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">// æ³¨æ„ hasNext å’Œ hasNextLine çš„åŒºåˆ«</span></span><br><span class="line">        <span class="keyword">while</span> (in.hasNextInt()) &#123; <span class="comment">// æ³¨æ„ while å¤„ç†å¤šä¸ª case</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            System.out.println(a + b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²æ“ä½œ"><a href="#å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²æ“ä½œ"></a>å­—ç¬¦ä¸²æ“ä½œ</h2><p><a href="https://blog.csdn.net/m0_53067943/article/details/127636615?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522F3FEC682-D11D-4F95-AAC3-C91548DFD580%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=F3FEC682-D11D-4F95-AAC3-C91548DFD580&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-127636615-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=java%20string%E7%B1%BB%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95&spm=1018.2226.3001.4187">Javaä¸­Stringç±»çš„å¸¸ç”¨æ–¹æ³•</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005778.png" alt="image-20240903103624074"></p><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><h3 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h3><h4 id="æœ€å¤§å­åºå’Œ"><a href="#æœ€å¤§å­åºå’Œ" class="headerlink" title="æœ€å¤§å­åºå’Œ"></a>æœ€å¤§å­åºå’Œ</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005332.png" alt="image-20240905093844829"></p><p>ä»é¢˜ç›®ä¸­æˆ‘ä»¬å¯ä»¥åˆ†æå¾—å‡ºï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å­˜åœ¨ä¸¤ç§çŠ¶æ€ï¼Œå³å½“å‰å…ƒç´ é€‰è¿˜æ˜¯ä¸é€‰ï¼Œä¸”æˆ‘ä»¬éœ€è¦æ±‚ è¯¥æ•°ç»„çš„æœ€è‡ªåºå’Œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨è®¾dp[i]è¡¨ç¤ºä»¥iç»“å°¾çš„æ•°ç»„çš„æœ€å¤§å­åºå’Œçš„å€¼ã€‚</p><p>é‚£ä¹ˆå¦‚æœå‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“äº†dp[i-1]çš„å€¼ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æ±‚è§£dp[i]çš„å€¼å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è®¤çœŸæƒ³äº†ä¸€ä¸‹ï¼Œå½“å‰å…ƒç´ æœ‰ä¸¤ç§çŠ¶æ€ï¼šé€‰ or ä¸é€‰ï¼Œæ‰€æœ‰æˆ‘ä»¬æŠŠçŠ¶æ€è½¬ç§»æ–¹ç¨‹è¿›è¡Œæ›´æ”¹æˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dp[i][2]: dp[i][0] è¡¨ç¤ºå½“å‰å…ƒç´ ä¸é€‰æ‹©çš„æœ€å¤§å­åºå’Œ dp[i][1] è¡¨ç¤ºå½“å‰å…ƒç´ é€‰æ‹©åçš„æœ€å¤§å­åºå’Œ</span><br><span class="line"></span><br><span class="line">è¿™æ ·æˆ‘ä»¬çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¹Ÿå°±å¾ˆæ˜æ˜¾äº†</span><br><span class="line"></span><br><span class="line">dp[i][0] = max(dp[i-1][0],dp[i-1][1]);</span><br><span class="line">dp[i][1] = max(nums[i],dp[i-1][1] + nums[i]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="æœ€å¤§å­åºå’Œå˜å½¢"><a href="#æœ€å¤§å­åºå’Œå˜å½¢" class="headerlink" title="æœ€å¤§å­åºå’Œå˜å½¢"></a>æœ€å¤§å­åºå’Œå˜å½¢</h5><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005758.png" alt="image-20240905105011958"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005189.png" alt="image-20240905105030682"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> energy intæ•´å‹ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> intæ•´å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxEnergyCircular</span> <span class="params">(<span class="type">int</span>[] energy)</span> &#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> energy.length;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> energy[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> energy[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i] = Math.max(dp[i - <span class="number">1</span>], <span class="number">0</span>) + energy[i];</span><br><span class="line">            max = Math.max(max, dp[i]);</span><br><span class="line">            sum += energy[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> energy[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i] = Math.min(dp[i - <span class="number">1</span>], <span class="number">0</span>) + energy[i];</span><br><span class="line">            min = Math.min(min, dp[i]);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max &lt; <span class="number">0</span> ? max : Math.max(max, sum - min);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æœ€å¤§æ— è¿ç»­å’Œ"><a href="#æœ€å¤§æ— è¿ç»­å’Œ" class="headerlink" title="æœ€å¤§æ— è¿ç»­å’Œ"></a>æœ€å¤§æ— è¿ç»­å’Œ</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005892.png" alt="image-20240906095905909"></p><h5 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h5><p>å½“å‰æ¯ä¸€ä¸ªè‰å †éƒ½å­˜åœ¨ä¸¤ç§çŠ¶æ€ï¼šåƒ OR ä¸åƒï¼Œä¸”åƒä¸åƒä¸ä¸Šä¸€ä¸ªè‰å †çš„çŠ¶æ€ç›¸å…³è”ï¼Œå¦‚æœå‡è®¾æˆ‘ä»¬å‰ä¸€ä¸ªè‰å †çš„é€‰æ‹©åçš„ç»“æœå·²çŸ¥ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„åŠ¨æ€è§„åˆ’é—®é¢˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è®¾dp[i][0]è¡¨ç¤ºå½“å‰è‰å †ä¸åƒæ—¶çš„æœ€é«˜é¥±è…¹åº¦ï¼›</span><br><span class="line">dp[i][1]è¡¨ç¤ºå½“å‰è‰å †åƒæ—¶çš„æœ€é«˜é¥±è…¹åº¦</span><br><span class="line"></span><br><span class="line">é‚£ä¹ˆçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š</span><br><span class="line">dp[i][0] = max(dp[i-1][1],dp[i-1][0])</span><br><span class="line">dp[i][1] = dp[i-1][0] + nums[i]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums intæ•´å‹ä¸€ç»´æ•°ç»„ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> intæ•´å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">eatGrass</span> <span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> [][]dp = <span class="keyword">new</span> <span class="title class_">int</span>[len+<span class="number">10</span>][<span class="number">2</span>];</span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">1</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>;i&lt;=len;i++)&#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>],dp[i-<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">            dp[i][<span class="number">1</span>] = dp[i-<span class="number">1</span>][<span class="number">0</span>] + nums[i-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Math.max(dp[len][<span class="number">0</span>],dp[len][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¾ªç¯æœ€å¤§æ— è¿ç»­å’Œ"><a href="#å¾ªç¯æœ€å¤§æ— è¿ç»­å’Œ" class="headerlink" title="å¾ªç¯æœ€å¤§æ— è¿ç»­å’Œ"></a>å¾ªç¯æœ€å¤§æ— è¿ç»­å’Œ</h5><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005037.png" alt="image-20240906100513338"></p><p>æ€è·¯ï¼šå¾ªç¯æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„é€‰æ‹©ä¼šå½±å“æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€çš„è½¬ç§»éœ€è¦çŸ¥é“ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å’Œå‰ä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©åˆ†ç±»ï¼šå½“ç¬¬ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹©æ—¶ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸é€‰æ—¶çš„æœ€é«˜é¥±è…¹åº¦ï¼›å½“ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸é€‰æ‹©æ—¶çš„æœ€é«˜é¥±è…¹åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums intæ•´å‹ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> intæ•´å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">eatGrass</span> <span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> [][] dp1 = <span class="keyword">new</span> <span class="title class_">int</span>[len + <span class="number">10</span>][<span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> [][] dp2 = <span class="keyword">new</span> <span class="title class_">int</span> [len + <span class="number">10</span>][<span class="number">2</span>];</span><br><span class="line">        dp1[<span class="number">1</span>][<span class="number">1</span>] = nums[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= len; i++) &#123;</span><br><span class="line">            dp1[i][<span class="number">0</span>] = Math.max(dp1[i - <span class="number">1</span>][<span class="number">1</span>], dp1[i - <span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span> (i != <span class="number">2</span> &amp;&amp; i != len) &#123;</span><br><span class="line">                dp1[i][<span class="number">1</span>] = dp1[i - <span class="number">1</span>][<span class="number">0</span>] + nums[i - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= len; i++) &#123;</span><br><span class="line">            dp2[i][<span class="number">0</span>] = Math.max(dp2[i - <span class="number">1</span>][<span class="number">1</span>], dp2[i - <span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">            dp2[i][<span class="number">1</span>] = dp2[i - <span class="number">1</span>][<span class="number">0</span>] + nums[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Math.max(dp1[len][<span class="number">1</span>],Math.max(dp1[len][<span class="number">0</span>],Math.max(dp2[len][<span class="number">0</span>],dp2[len][<span class="number">1</span>])));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æœ€é•¿å›æ–‡ä¸²"><a href="#æœ€é•¿å›æ–‡ä¸²" class="headerlink" title="æœ€é•¿å›æ–‡ä¸²"></a>æœ€é•¿å›æ–‡ä¸²</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005717.png" alt="image-20240909095536037"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s stringå­—ç¬¦ä¸² </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> stringå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">longestPalindrome</span> <span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxLen</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">boolean</span> [][]dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[len+<span class="number">10</span>][len+<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            dp[i][i] = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// start = i;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>;j&lt;len;j++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;j;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(s.charAt(i) == s.charAt(j) &amp;&amp; (j-i&gt;=<span class="number">1</span> || dp[i+<span class="number">1</span>][j-<span class="number">1</span>]))&#123;</span><br><span class="line">                    dp[i][j] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(j -i + <span class="number">1</span> &gt; maxLen)&#123;</span><br><span class="line">                        maxLen = j - i + <span class="number">1</span>;</span><br><span class="line">                        start = i;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> s.substring(start,start + maxLen);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æœ€é•¿ä¸¥æ ¼ä¸Šå‡å­åºåˆ—"><a href="#æœ€é•¿ä¸¥æ ¼ä¸Šå‡å­åºåˆ—" class="headerlink" title="æœ€é•¿ä¸¥æ ¼ä¸Šå‡å­åºåˆ—"></a>æœ€é•¿ä¸¥æ ¼ä¸Šå‡å­åºåˆ—</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005657.png" alt="image-20240921110446331"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ç±»åå¿…é¡»ä¸º Main, ä¸è¦æœ‰ä»»ä½• package xxx ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++ i ) &#123;</span><br><span class="line">            a[i] = in.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] low = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++ i ) &#123;</span><br><span class="line">            <span class="keyword">if</span>(p == -<span class="number">1</span>) low[++ p] = a[i];</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(low[p] &lt; a[i]) low[++ p] = a[i];</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">ti</span> <span class="operator">=</span> lowerbound(low, <span class="number">0</span>, p, a[i]);</span><br><span class="line">                    low[ti] = a[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(p + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">lowerbound</span><span class="params">(<span class="type">int</span>[] low, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt;= r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(low[mid] &lt; k) &#123;</span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">                ans = mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/lxt_Lucia/article/details/81206439">https://blog.csdn.net/lxt_Lucia/article/details/81206439</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005242.png" alt="image-20240921110531082"></p><h4 id="å®Œå…¨èƒŒåŒ…"><a href="#å®Œå…¨èƒŒåŒ…" class="headerlink" title="å®Œå…¨èƒŒåŒ…"></a>å®Œå…¨èƒŒåŒ…</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005731.png" alt="image-20240922105201700"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String [] args)</span>&#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">V</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> [] v = <span class="keyword">new</span> <span class="title class_">int</span> [n+<span class="number">10</span>];</span><br><span class="line">        <span class="type">int</span> [] w = <span class="keyword">new</span> <span class="title class_">int</span> [n+<span class="number">10</span>];</span><br><span class="line">        <span class="type">int</span> []dp = <span class="keyword">new</span> <span class="title class_">int</span> [V + <span class="number">10</span>];</span><br><span class="line">        <span class="type">int</span> []dp1 = <span class="keyword">new</span> <span class="title class_">int</span>[V + <span class="number">10</span>];</span><br><span class="line">        Arrays.fill(dp1,Integer.MIN_VALUE);</span><br><span class="line">        dp1[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            v[i] = in.nextInt();</span><br><span class="line">            w[i] = in.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> v[i];j&lt;=V;j++)&#123;</span><br><span class="line">                dp[j] = Math.max(dp[j],dp[j-v[i]] + w[i]);</span><br><span class="line">                dp1[j] = Math.max(dp1[j],dp1[j-v[i]] + w[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        System.out.println(dp[V]);</span><br><span class="line">        System.out.println(dp1[V] &gt; <span class="number">0</span>?dp1[V]:<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å·®åˆ†æ³•"><a href="#å·®åˆ†æ³•" class="headerlink" title="å·®åˆ†æ³•"></a>å·®åˆ†æ³•</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005577.png" alt="image-20240922105328604"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åŸæ•°ç»„ï¼šd[i]</span><br><span class="line">å·®åˆ†æ•°ç»„ï¼šf[i]</span><br><span class="line">æ±‚å·®åˆ†æ•°ç»„ï¼šf[i] = d[i] - d[i-1]</span><br><span class="line">åŒºé—´å†…è¿›è¡ŒåŒæ ·çš„æ“ä½œ ï¼ŒåŒºé—´å·¦è¾¹indexåšä¸€æ¬¡è¯¥æ“ä½œï¼ŒåŒºé—´æœ€å³è¾¹åšä¸€æ¬¡åå‘æ“ä½œï¼›</span><br><span class="line">è¿˜åŸï¼š d[i] = f[i] + d[i-1];</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="åŒºé—´å·®åˆ†"><a href="#åŒºé—´å·®åˆ†" class="headerlink" title="åŒºé—´å·®åˆ†"></a>åŒºé—´å·®åˆ†</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">q</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> [][] dp = <span class="keyword">new</span> <span class="title class_">long</span>[n+<span class="number">10</span>][m+<span class="number">10</span>];</span><br><span class="line">        <span class="type">long</span> [][] d = <span class="keyword">new</span> <span class="title class_">long</span>[n+<span class="number">10</span>][m+<span class="number">10</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">                d[i][j] = in.nextInt();</span><br><span class="line">                dp[i][j] = d[i][j] - d[i][j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;q;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x1</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">y1</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">x2</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">y2</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span>  <span class="operator">=</span> in.nextInt();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> x1;j&lt;=x2;j++)&#123;</span><br><span class="line">                dp[j][y1] += k;</span><br><span class="line">                dp[j][y2+<span class="number">1</span>] -= k;</span><br><span class="line"><span class="comment">//                 System.out.print(j+&quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">                d[i][j] = dp[i][j] + d[i][j-<span class="number">1</span>];</span><br><span class="line">                System.out.print(d[i][j] +<span class="string">&quot; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‰ç¼€å’Œ"><a href="#å‰ç¼€å’Œ" class="headerlink" title="å‰ç¼€å’Œ"></a>å‰ç¼€å’Œ</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005324.png" alt="image-20240923094644267"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">q</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> [][] dp = <span class="keyword">new</span> <span class="title class_">long</span>[n+<span class="number">10</span>][m+<span class="number">10</span>];</span><br><span class="line">        <span class="type">long</span> [][] d = <span class="keyword">new</span> <span class="title class_">long</span>[n+<span class="number">10</span>][m+<span class="number">10</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">                d[i][j] = in.nextInt();</span><br><span class="line">                dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-<span class="number">1</span>] - dp[i-<span class="number">1</span>][j-<span class="number">1</span>] + d[i][j];</span><br><span class="line"><span class="comment">//                 System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//             System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;q;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x1</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">y1</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">x2</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">y2</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            </span><br><span class="line">            <span class="type">long</span> <span class="variable">res</span> <span class="operator">=</span> dp[x2][y2] - dp[x2][y1-<span class="number">1</span>] - dp[x1-<span class="number">1</span>][y2] + dp[x1-<span class="number">1</span>][y1-<span class="number">1</span>];</span><br><span class="line">            System.out.println(res);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯»æ‰¾æœ€çŸ­è·¯å¾„å¯ä»¥èµ°å®Œæ‰€æœ‰èŠ‚ç‚¹ä¸”æ¯ä¸€ä¸ªèŠ‚ç‚¹åªèƒ½èµ°ä¸€æ¬¡"><a href="#å¯»æ‰¾æœ€çŸ­è·¯å¾„å¯ä»¥èµ°å®Œæ‰€æœ‰èŠ‚ç‚¹ä¸”æ¯ä¸€ä¸ªèŠ‚ç‚¹åªèƒ½èµ°ä¸€æ¬¡" class="headerlink" title="å¯»æ‰¾æœ€çŸ­è·¯å¾„å¯ä»¥èµ°å®Œæ‰€æœ‰èŠ‚ç‚¹ä¸”æ¯ä¸€ä¸ªèŠ‚ç‚¹åªèƒ½èµ°ä¸€æ¬¡"></a>å¯»æ‰¾æœ€çŸ­è·¯å¾„å¯ä»¥èµ°å®Œæ‰€æœ‰èŠ‚ç‚¹ä¸”æ¯ä¸€ä¸ªèŠ‚ç‚¹åªèƒ½èµ°ä¸€æ¬¡</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005572.png" alt="image-20241017105304467"></p><h3 id="è§£é¢˜æ€è·¯ï¼š"><a href="#è§£é¢˜æ€è·¯ï¼š" class="headerlink" title="è§£é¢˜æ€è·¯ï¼š"></a>è§£é¢˜æ€è·¯ï¼š</h3><ol><li><strong>çŠ¶æ€å‹ç¼©</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹åªèƒ½è®¿é—®ä¸€æ¬¡ï¼Œå¯ä»¥ç”¨ä½æ©ç ï¼ˆbitmaskï¼‰æ¥è¡¨ç¤ºå“ªäº›èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå…±æœ‰ <code>n</code> ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªä½æ©ç  <code>mask</code> è¡¨ç¤ºè®¿é—®è¿‡çš„èŠ‚ç‚¹çŠ¶æ€ï¼Œ<code>mask</code> çš„ç¬¬ <code>i</code> ä½ä¸º <code>1</code> è¡¨ç¤ºèŠ‚ç‚¹ <code>i</code> å·²ç»è®¿é—®è¿‡ï¼Œä¸º <code>0</code> è¡¨ç¤ºæœªè®¿é—®ã€‚</li><li><strong>åŠ¨æ€è§„åˆ’</strong>ï¼šå®šä¹‰ä¸€ä¸ª <code>dp[mask][i]</code>ï¼Œè¡¨ç¤ºå½“å‰å¤„äºèŠ‚ç‚¹ <code>i</code>ï¼Œè®¿é—®è¿‡çš„èŠ‚ç‚¹é›†åˆä¸º <code>mask</code> æ—¶ï¼Œä»èŠ‚ç‚¹ <code>i</code> å¼€å§‹ï¼Œè®¿é—®æ‰€æœ‰æœªè®¿é—®çš„èŠ‚ç‚¹ï¼Œå†å›åˆ°èŠ‚ç‚¹ <code>0</code> æ‰€éœ€çš„æœ€å°æ¶ˆè€—ã€‚</li></ol><h3 id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š"><a href="#çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š" class="headerlink" title="çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š"></a>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</h3><p>è®¾ <code>mask</code> è¡¨ç¤ºå½“å‰è®¿é—®çš„èŠ‚ç‚¹é›†åˆï¼Œ<code>i</code> è¡¨ç¤ºå½“å‰å¤„äºçš„èŠ‚ç‚¹ï¼Œåˆ™çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š</p><p>dp[mask][i]&#x3D;minâ¡(dp[maskâˆ–(1&lt;&lt;i)][j]+costs[j][i])âˆ€jâˆˆmask,jâ‰ idp[mask][i] &#x3D; \min(dp[mask \setminus (1 &lt;&lt; i)][j] + costs[j][i]) \quad \forall j \in \text{mask}, j \neq idp[mask][i]&#x3D;min(dp[maskâˆ–(1&lt;&lt;i)][j]+costs[j][i])âˆ€jâˆˆmask,jî€ &#x3D;i</p><p>æœ€ç»ˆçš„ç­”æ¡ˆæ˜¯ï¼š</p><p>minâ¡(dp[2nâˆ’1][i]+costs[i][0])âˆ€iâˆˆ[1,nâˆ’1]\min(dp[2^n - 1][i] + costs[i][0]) \quad \forall i \in [1, n-1]min(dp[2nâˆ’1][i]+costs[i][0])âˆ€iâˆˆ[1,nâˆ’1]</p><p>å…¶ä¸­ <code>2^n - 1</code> è¡¨ç¤ºæ‰€æœ‰èŠ‚ç‚¹éƒ½å·²è®¿é—®ã€‚</p><p>è¿™æ˜¯å…¸å‹çš„<strong>æ—…è¡Œå•†é—®é¢˜ï¼ˆTraveling Salesman Problem, TSPï¼‰</strong>ï¼Œå¯ä»¥ä½¿ç”¨<strong>åŠ¨æ€è§„åˆ’</strong>å’Œ<strong>çŠ¶æ€å‹ç¼©</strong>æ¥æ±‚è§£æœ€å°‘æ¶ˆè€—è·¯å¾„ã€‚æ—…è¡Œå•†é—®é¢˜è¦æ±‚ä»ä¸€ä¸ªèµ·ç‚¹å‡ºå‘ï¼Œç»è¿‡æ‰€æœ‰èŠ‚ç‚¹ä¸€æ¬¡ï¼Œæœ€åå›åˆ°åŸç‚¹ï¼Œå¹¶ä½¿è·¯å¾„çš„æ€»æ¶ˆè€—æœ€å°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TravelingSalesman</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">tsp</span><span class="params">(<span class="type">int</span>[][] costs)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> costs.length;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1</span> &lt;&lt; n][n];  <span class="comment">// dp[mask][i] è¡¨ç¤ºè®¿é—®maské›†åˆä¸‹ï¼Œåˆ°è¾¾èŠ‚ç‚¹içš„æœ€å°æ¶ˆè€—</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] row : dp) &#123;</span><br><span class="line">            Arrays.fill(row, Integer.MAX_VALUE / <span class="number">2</span>);  <span class="comment">// é˜²æ­¢æº¢å‡ºï¼Œåˆå§‹åŒ–ä¸ºä¸€ä¸ªå¤§å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;  <span class="comment">// ä»èŠ‚ç‚¹0å¼€å§‹ï¼Œmask=1è¡¨ç¤ºåªè®¿é—®äº†èŠ‚ç‚¹0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰çš„çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">mask</span> <span class="operator">=</span> <span class="number">1</span>; mask &lt; (<span class="number">1</span> &lt;&lt; n); mask++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((mask &amp; (<span class="number">1</span> &lt;&lt; i)) == <span class="number">0</span>) <span class="keyword">continue</span>;  <span class="comment">// èŠ‚ç‚¹iæ²¡æœ‰è¢«è®¿é—®</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((mask &amp; (<span class="number">1</span> &lt;&lt; j)) != <span class="number">0</span>) <span class="keyword">continue</span>;  <span class="comment">// èŠ‚ç‚¹jå·²ç»è¢«è®¿é—®</span></span><br><span class="line">                    dp[mask | (<span class="number">1</span> &lt;&lt; j)][j] = Math.min(dp[mask | (<span class="number">1</span> &lt;&lt; j)][j], dp[mask][i] + costs[i][j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰¾åˆ°æœ€å°æ¶ˆè€—è·¯å¾„ï¼Œå›åˆ°èŠ‚ç‚¹0</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            result = Math.min(result, dp[(<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>][i] + costs[i][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] costs = &#123;</span><br><span class="line">            &#123;<span class="number">0</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">20</span>&#125;,</span><br><span class="line">            &#123;<span class="number">10</span>, <span class="number">0</span>, <span class="number">35</span>, <span class="number">25</span>&#125;,</span><br><span class="line">            &#123;<span class="number">15</span>, <span class="number">35</span>, <span class="number">0</span>, <span class="number">30</span>&#125;,</span><br><span class="line">            &#123;<span class="number">20</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">0</span>&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€å°‘æ¶ˆè€—: &quot;</span> + tsp(costs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç»™ä¸€ç»„åæ ‡ç‚¹ï¼ˆæ•´æ•°ï¼‰ï¼Œæ±‚è¿™ç»„åæ ‡ç‚¹çš„å‚ç›´å¹³åˆ†çº¿ä¸åŒçš„ä¸ªæ•°"><a href="#ç»™ä¸€ç»„åæ ‡ç‚¹ï¼ˆæ•´æ•°ï¼‰ï¼Œæ±‚è¿™ç»„åæ ‡ç‚¹çš„å‚ç›´å¹³åˆ†çº¿ä¸åŒçš„ä¸ªæ•°" class="headerlink" title="ç»™ä¸€ç»„åæ ‡ç‚¹ï¼ˆæ•´æ•°ï¼‰ï¼Œæ±‚è¿™ç»„åæ ‡ç‚¹çš„å‚ç›´å¹³åˆ†çº¿ä¸åŒçš„ä¸ªæ•°"></a>ç»™ä¸€ç»„åæ ‡ç‚¹ï¼ˆæ•´æ•°ï¼‰ï¼Œæ±‚è¿™ç»„åæ ‡ç‚¹çš„å‚ç›´å¹³åˆ†çº¿ä¸åŒçš„ä¸ªæ•°</h2><p>è€ƒå¯Ÿç‚¹ï¼šç›´çº¿çš„ä¸€èˆ¬è¡¨è¾¾å¼ï¼Œset</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262005059.png" alt="image-20241025213217718"></p><p>ä¸¤ç‚¹çš„å‚ç›´å¹³åˆ†çº¿çš„å„å‚æ•°çš„è¡¨è¾¾å¼å¦‚ä¸Šï¼Œè¿˜å¯ä»¥æŠŠå„ä¸ªå¯¹è±¡çš„å‚æ•°å˜æˆStringæ–¹ä¾¿å¿«é€ŸæŸ¥é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">gcd</span><span class="params">(<span class="type">long</span> a,<span class="type">long</span> b)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b==<span class="number">0</span>?a:gcd(b,a%b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(t &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            t--;</span><br><span class="line">            </span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span>[][] points = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>][n];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">                points[<span class="number">0</span>][i] = in.nextInt();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">                points[<span class="number">1</span>][i] = in.nextInt();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Set&lt;String&gt; lines = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;   </span><br><span class="line">                <span class="type">long</span> <span class="variable">x0</span> <span class="operator">=</span> points[<span class="number">0</span>][i];</span><br><span class="line">                <span class="type">long</span> <span class="variable">y0</span> <span class="operator">=</span> points[<span class="number">1</span>][i];</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">x1</span> <span class="operator">=</span> points[<span class="number">0</span>][j];</span><br><span class="line">                    <span class="type">long</span> <span class="variable">y1</span> <span class="operator">=</span> points[<span class="number">1</span>][j];</span><br><span class="line">                    </span><br><span class="line">                    <span class="type">long</span> <span class="variable">a</span> <span class="operator">=</span> (x1 - x0)*<span class="number">2L</span>;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">b</span> <span class="operator">=</span> (y1 - y0) * <span class="number">2L</span>;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">c</span> <span class="operator">=</span> -((x1-x0)*(x0+x1)*<span class="number">1L</span> + (y1-y0)*(y0+y1)*<span class="number">1L</span>);</span><br><span class="line">                    <span class="type">long</span> <span class="variable">ha</span> <span class="operator">=</span> gcd(gcd(a,b),c);</span><br><span class="line">                    a/=ha;</span><br><span class="line">                    b/=ha;</span><br><span class="line">                    c/=ha;</span><br><span class="line">                    <span class="keyword">if</span>(a &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                        a = -a;</span><br><span class="line">                        b = -b;</span><br><span class="line">                        c = -c;</span><br><span class="line">                    &#125;</span><br><span class="line">                    lines.add(a+<span class="string">&quot; &quot;</span>+b+<span class="string">&quot; &quot;</span>+c);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(lines.size());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>55 WebSocket</title>
      <link href="/2025/02/26/55%20WebSocket/"/>
      <url>/2025/02/26/55%20WebSocket/</url>
      
        <content type="html"><![CDATA[<h1 id="55-WebSocket"><a href="#55-WebSocket" class="headerlink" title="55 WebSocket"></a>55 WebSocket</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><p><a href="https://blog.csdn.net/qq_54773998/article/details/123863493?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522172285079816800213042439%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=172285079816800213042439&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-123863493-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=WebSocket&spm=1018.2226.3001.4187">WebSocket</a></p></li><li><p><a href="https://blog.csdn.net/qq_43595018/article/details/135290793?ops_request_misc=&request_id=&biz_id=102&utm_term=WebSocket%20SpringBoot&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-135290793.142%5Ev100%5Epc_search_result_base1&spm=1018.2226.3001.4187">SpringBootä½¿ç”¨WebSocket</a></p></li><li><p><a href="https://blog.csdn.net/qq_42402854/article/details/130948270?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522172292203816800172571906%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=172292203816800172571906&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-130948270-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=SpringBoot%20WebSocket&spm=1018.2226.3001.4187">SpringBoot é›†æˆWebSocketè¯¦è§£</a></p></li><li></li></ol><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li>WebSocketæ˜¯HTML5ä¸‹ä¸€ç§æ–°çš„åè®®ï¼ˆwebsocketåè®®æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäº<strong>tcp</strong>çš„åè®®ï¼‰</li><li>å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡ï¼Œèƒ½æ›´å¥½çš„èŠ‚çœæœåŠ¡å™¨èµ„æºå’Œå¸¦å®½å¹¶è¾¾åˆ°å®æ—¶é€šè®¯çš„ç›®çš„</li><li>WebSocketæ˜¯ä¸€ä¸ª<strong>æŒä¹…åŒ–</strong>çš„åè®®</li><li>WebSocketçº¦å®šäº†ä¸€ä¸ªé€šä¿¡çš„è§„èŒƒï¼Œé€šè¿‡ä¸€ä¸ªæ¡æ‰‹çš„æœºåˆ¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´èƒ½å»ºç«‹ä¸€ä¸ªç±»ä¼¼tcpçš„è¿æ¥ï¼Œä»è€Œæ–¹ä¾¿å®ƒä»¬ä¹‹é—´çš„é€šä¿¡</li><li>åœ¨WebSocketå‡ºç°ä¹‹å‰ï¼Œwebäº¤äº’ä¸€èˆ¬æ˜¯åŸºäºhttpåè®®çš„çŸ­è¿æ¥æˆ–è€…é•¿è¿æ¥</li><li>WebSocketæ˜¯ä¸€ç§å…¨æ–°çš„åè®®ï¼Œä¸å±äºHTTPæ— çŠ¶æ€åè®®ï¼Œåè®®åä¸ºâ€wsâ€</li></ul><h2 id="WebSocketå’ŒHTTP"><a href="#WebSocketå’ŒHTTP" class="headerlink" title="WebSocketå’ŒHTTP"></a>WebSocketå’ŒHTTP</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262003985.png" alt="img"></p><h3 id="ç›¸åŒç‚¹"><a href="#ç›¸åŒç‚¹" class="headerlink" title="ç›¸åŒç‚¹"></a>ç›¸åŒç‚¹</h3><ul><li>éƒ½æ˜¯åŸºäºTCPåè®®å³éƒ½æ˜¯å¯é æ€§ä¼ è¾“åè®®ï¼›</li><li>éƒ½æ˜¯åº”ç”¨å±‚åè®®ï¼›</li></ul><h3 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h3><ol><li><strong>WebSocketæ˜¯åŒå‘é€šä¿¡åè®®ï¼Œæ¨¡æ‹ŸSocketåè®®ï¼Œå¯ä»¥åŒå‘å‘é€æˆ–æ¥å—ä¿¡æ¯</strong></li><li><strong>HTTPæ˜¯å•å‘çš„</strong></li><li><strong>WebSocketæ˜¯éœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨æ¡æ‰‹è¿›è¡Œå»ºç«‹è¿æ¥çš„</strong></li><li><strong>è€ŒHTTPæ˜¯æµè§ˆå™¨å‘èµ·å‘æœåŠ¡å™¨çš„è¿æ¥ï¼ŒæœåŠ¡å™¨é¢„å…ˆå¹¶ä¸çŸ¥é“è¿™ä¸ªè¿æ¥</strong></li></ol><p><strong>WebSocketåœ¨å»ºç«‹æ¡æ‰‹æ—¶ï¼Œæ•°æ®æ˜¯é€šè¿‡HTTPä¼ è¾“çš„ã€‚ä½†æ˜¯å»ºç«‹ä¹‹åï¼Œåœ¨çœŸæ­£ä¼ è¾“æ—¶å€™æ˜¯ä¸éœ€è¦HTTPåè®®çš„</strong></p><h3 id="æ€»ç»“ï¼ˆæ€»ä½“è¿‡ç¨‹ï¼‰ï¼š"><a href="#æ€»ç»“ï¼ˆæ€»ä½“è¿‡ç¨‹ï¼‰ï¼š" class="headerlink" title="æ€»ç»“ï¼ˆæ€»ä½“è¿‡ç¨‹ï¼‰ï¼š"></a>æ€»ç»“ï¼ˆæ€»ä½“è¿‡ç¨‹ï¼‰ï¼š</h3><ul><li>é¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘èµ·httpè¯·æ±‚ï¼Œç»è¿‡3æ¬¡æ¡æ‰‹åï¼Œå»ºç«‹èµ·TCPè¿æ¥ï¼›httpè¯·æ±‚é‡Œå­˜æ”¾WebSocketæ”¯æŒçš„ç‰ˆæœ¬å·ç­‰ä¿¡æ¯ï¼Œå¦‚ï¼šUpgradeã€Connectionã€WebSocket-Versionç­‰ï¼›</li><li>ç„¶åï¼ŒæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¡æ‰‹è¯·æ±‚åï¼ŒåŒæ ·é‡‡ç”¨HTTPåè®®å›é¦ˆæ•°æ®ï¼›</li><li>æœ€åï¼Œå®¢æˆ·ç«¯æ”¶åˆ°è¿æ¥æˆåŠŸçš„æ¶ˆæ¯åï¼Œå¼€å§‹å€ŸåŠ©äºTCPä¼ è¾“ä¿¡é“è¿›è¡Œå…¨åŒå·¥é€šä¿¡ã€‚</li></ul><h2 id="WebSocketè§£å†³çš„é—®é¢˜"><a href="#WebSocketè§£å†³çš„é—®é¢˜" class="headerlink" title="WebSocketè§£å†³çš„é—®é¢˜"></a>WebSocketè§£å†³çš„é—®é¢˜</h2><h3 id="HTTPå­˜åœ¨çš„é—®é¢˜"><a href="#HTTPå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="HTTPå­˜åœ¨çš„é—®é¢˜"></a>HTTPå­˜åœ¨çš„é—®é¢˜</h3><p>å¦‚æœæ˜¯åŸºäºHTTPåè®®ï¼Œåœ¨æˆ‘ä»¬å¼€å‘çš„æ—¶å€™ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨æƒ³è¦ç»™å®¢æˆ·ç«¯å‘é€ä¿¡æ¯æ˜¯æ— æ³•å®ç°çš„ï¼Œæˆ‘ä»¬åªèƒ½ç­‰å®¢æˆ·ç«¯å‘é€è¯·æ±‚åæ‰èƒ½æŠŠè¯¥ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><p>è¿™æ˜¯å› ä¸ºHTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œæ¯å½“ä¸€æ¬¡ä¼šè¯å®Œæˆåï¼ŒæœåŠ¡ç«¯éƒ½ä¸çŸ¥é“ä¸‹ä¸€æ¬¡çš„å®¢æˆ·ç«¯æ˜¯è°ï¼Œéœ€è¦æ¯æ¬¡çŸ¥é“å¯¹æ–¹æ˜¯è°ï¼Œæ‰è¿›è¡Œç›¸åº”çš„å“åº”ï¼Œå› æ­¤æœ¬èº«å¯¹äºå®æ—¶é€šè®¯å°±æ˜¯ä¸€ç§æå¤§çš„éšœç¢ã€‚</p><p>httpåè®®é‡‡ç”¨ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”ï¼Œæ¯æ¬¡è¯·æ±‚å’Œå“åº”å°±æºå¸¦æœ‰å¤§é‡çš„headerå¤´ï¼Œå¯¹äºå®æ—¶é€šè®¯æ¥è¯´ï¼Œè§£æè¯·æ±‚å¤´ä¹Ÿæ˜¯éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œå› æ­¤ï¼Œæ•ˆç‡ä¹Ÿæ›´ä½ä¸‹ã€‚</p><p>æœ€é‡è¦çš„æ˜¯ï¼Œéœ€è¦å®¢æˆ·ç«¯ä¸»åŠ¨å‘ï¼ŒæœåŠ¡ç«¯è¢«åŠ¨å‘ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”ï¼Œä¸èƒ½å®ç°ä¸»åŠ¨å‘é€ã€‚</p><h4 id="long-poll-é•¿è½®è¯¢"><a href="#long-poll-é•¿è½®è¯¢" class="headerlink" title="long poll(é•¿è½®è¯¢)"></a>long poll(é•¿è½®è¯¢)</h4><p>HTTPä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æå‡ºæ¥ä¸€ç§æŠ€æœ¯ï¼Œé‚£å°±æ˜¯long poll(é•¿è½®è¯¢)ï¼ŒåŸºäºHTTPçš„ç‰¹æ€§ï¼Œç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯å®¢æˆ·ç«¯å‘èµ·é•¿è½®è¯¢ï¼Œå¦‚æœæœåŠ¡ç«¯çš„æ•°æ®æ²¡æœ‰å‘ç”Ÿå˜æ›´ï¼Œä¼š hold ä½è¯·æ±‚ï¼Œç›´åˆ°æœåŠ¡ç«¯çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…ç­‰å¾…ä¸€å®šæ—¶é—´è¶…æ—¶æ‰ä¼šè¿”å›ã€‚è¿”å›åï¼Œå®¢æˆ·ç«¯åˆä¼šç«‹å³å†æ¬¡å‘èµ·ä¸‹ä¸€æ¬¡é•¿è½®è¯¢ã€‚</p><p>å¾ˆæ˜¾ç„¶è¿™æ ·ä¼šå ç”¨å¾ˆå¤šçš„èµ„æºï¼Œå¦‚æœç”¨æˆ·é‡å¾ˆå¤§ï¼Œå¾ˆå¤šè¯·æ±‚éƒ½åœ¨ç­‰å¾…ï¼Œè¿™éœ€è¦å¾ˆå¤§çš„å¹¶å‘é‡ã€‚</p><h4 id="Ajaxè½®è¯¢"><a href="#Ajaxè½®è¯¢" class="headerlink" title="Ajaxè½®è¯¢"></a>Ajaxè½®è¯¢</h4><p>åŒæ ·ä¹Ÿæ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæå‡ºäº†Ajaxè½®è¯¢ï¼Œå³è®©å‰ç«¯é¡µé¢æ¯éš”ä¸€æ®µæ—¶é—´å°±å‘åç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚</p><ul><li>æ€»çš„æ¥çœ‹ï¼ŒAjaxè½®è¯¢å­˜åœ¨çš„é—®é¢˜ï¼š</li></ul><ol><li>æ¨é€å»¶è¿Ÿã€‚</li><li>æœåŠ¡ç«¯å‹åŠ›ã€‚é…ç½®ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œé¢‘ç¹çš„è½®è¯¢ä¼šç»™æœåŠ¡ç«¯é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚</li><li>æ¨é€å»¶è¿Ÿå’ŒæœåŠ¡ç«¯å‹åŠ›æ— æ³•ä¸­å’Œã€‚é™ä½è½®è¯¢çš„é—´éš”ï¼Œå»¶è¿Ÿé™ä½ï¼Œå‹åŠ›å¢åŠ ï¼›å¢åŠ è½®è¯¢çš„é—´éš”ï¼Œå‹åŠ›é™ä½ï¼Œå»¶è¿Ÿå¢é«˜</li></ol><h4 id="websocketçš„æ”¹è¿›"><a href="#websocketçš„æ”¹è¿›" class="headerlink" title="websocketçš„æ”¹è¿›"></a>websocketçš„æ”¹è¿›</h4><p>ä¸€æ—¦WebSocketè¿æ¥å»ºç«‹åï¼Œåç»­æ•°æ®éƒ½ä»¥å¸§åºåˆ—çš„å½¢å¼ä¼ è¾“ã€‚åœ¨å®¢æˆ·ç«¯æ–­å¼€WebSocketè¿æ¥æˆ–Serverç«¯ä¸­æ–­è¿æ¥å‰ï¼Œä¸éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é‡æ–°å‘èµ·è¿æ¥è¯·æ±‚ã€‚åœ¨æµ·é‡å¹¶å‘åŠå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨äº¤äº’è´Ÿè½½æµé‡å¤§çš„æƒ…å†µä¸‹ï¼Œæå¤§çš„èŠ‚çœäº†ç½‘ç»œå¸¦å®½èµ„æºçš„æ¶ˆè€—ï¼Œæœ‰æ˜æ˜¾çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œä¸”å®¢æˆ·ç«¯å‘é€å’Œæ¥å—æ¶ˆæ¯æ˜¯åœ¨åŒä¸€ä¸ªæŒä¹…è¿æ¥ä¸Šå‘èµ·ï¼Œå®ç°äº†â€œçœŸÂ·é•¿é“¾æ¥â€ï¼Œå®æ—¶æ€§ä¼˜åŠ¿æ˜æ˜¾ã€‚</p><p>WebSocketå»ºç«‹è¿æ¥æ˜¯é€šè¿‡TCPçš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…¶æ¥ä¸‹æ¥çš„é€šä¿¡ä¹Ÿæ˜¯é€šè¿‡å‡çº§HTTPæ¥è¾¾åˆ°æ•ˆæœçš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262004395.png" alt="img"></p><p>è¿æ¥å»ºç«‹è¿‡ç¨‹</p><p>WebSocketåè®®çš„å»ºç«‹è¿æ¥è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªHTTPè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œè¯·æ±‚ä¸­åŒ…æ‹¬å¸Œæœ›å‡çº§ä¸ºWebSocketåè®®çš„ä¿¡æ¯ï¼Œå³åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«Upgradeå­—æ®µï¼Œå€¼ä¸ºâ€websocketâ€ï¼›</li><li>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šè¿”å›ä¸€ä¸ªHTTP 101çŠ¶æ€ç ï¼Œè¡¨ç¤ºåŒæ„å‡çº§ä¸ºWebSocketåè®®ï¼ŒåŒæ—¶åœ¨å“åº”å¤´ä¸­æ·»åŠ Upgradeå­—æ®µå’ŒConnectionå­—æ®µï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯å·²å‡çº§ä¸ºWebSocketåè®®ï¼›</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”åï¼Œä¼šé€šè¿‡TCPé€šé“è¿›è¡Œä¼ è¾“é€šä¿¡ã€‚</li><li></li></ul><h2 id="åœ¨SpringBootä¸­å®ç°WebSocketå®æ—¶é€šä¿¡"><a href="#åœ¨SpringBootä¸­å®ç°WebSocketå®æ—¶é€šä¿¡" class="headerlink" title="åœ¨SpringBootä¸­å®ç°WebSocketå®æ—¶é€šä¿¡"></a>åœ¨SpringBootä¸­å®ç°WebSocketå®æ—¶é€šä¿¡</h2><p>ä¸ºäº†åŠ æ·±å¯¹WebSocketçš„äº†è§£ä»¥åŠå®ƒçš„ä½¿ç”¨ï¼Œä¸ºæ­¤ç”¨ä¸€ä¸ªç®€å•çš„å°ä¾‹å­æ¥ä½¿ç”¨WebSocketï¼Œå‰ç«¯åŸºäºvue2ï¼Œåç«¯åŸºäºSpringBootã€WebSocketæ¥ç®€å•çš„åšä¸€ä¸ªå¥½å‹èŠå¤©çš„åŠŸèƒ½é¡µé¢ã€‚</p><p>å…·ä½“é¡µé¢æƒ…å†µå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262004634.png" alt="image-20241009171712368"></p><p>ä¸‹é¢å°±ä¸€æ­¥ä¸€æ­¥æ¥ä»‹ç»å…¶å®ç°ã€‚</p><h3 id="WebSocketä¾èµ–æ³¨å…¥é—®é¢˜"><a href="#WebSocketä¾èµ–æ³¨å…¥é—®é¢˜" class="headerlink" title="WebSocketä¾èµ–æ³¨å…¥é—®é¢˜"></a>WebSocketä¾èµ–æ³¨å…¥é—®é¢˜</h3><p>åœ¨ Spring Boot WebSocket ä¸­ï¼Œä¾èµ–æ³¨å…¥å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ WebSocket ç«¯ç‚¹ç±»ä¸­ä½¿ç”¨ <code>@Autowired</code> æ³¨è§£æ—¶ã€‚åŸå› ä¸»è¦ä¸ WebSocket çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œ Spring çš„ç®¡ç†æœºåˆ¶ä¹‹é—´çš„å·®å¼‚æœ‰å…³ã€‚</p><p>WebSocket å®ä¾‹ç”± Web å®¹å™¨ç®¡ç†è€Œé Spring å®¹å™¨ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.screw.chat.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.BeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpointConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> CustomSpringConfigurator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> è¿™æ®µä»£ç çš„ä¸»è¦ä½œç”¨æ˜¯å°†Springæ¡†æ¶ä¸WebSocketé›†æˆï¼Œä½¿å¾—WebSocketç«¯ç‚¹èƒ½å¤Ÿé€šè¿‡Springçš„ä¾èµ–æ³¨å…¥æœºåˆ¶è·å–Springç®¡ç†çš„Beanã€‚</span></span><br><span class="line"><span class="comment"> * å…·ä½“æ¥è¯´ï¼Œå®ƒé€šè¿‡å®ç°ServerEndpointConfig.Configuratoræ¥å£å’ŒApplicationContextAwareæ¥å£ï¼Œå°†Springçš„ApplicationContext</span></span><br><span class="line"><span class="comment"> * æ³¨å…¥åˆ°WebSocketé…ç½®ä¸­ï¼Œä»è€Œå…è®¸WebSocketç«¯ç‚¹ä½¿ç”¨Springçš„ä¾èµ–æ³¨å…¥åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-08</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomSpringConfigurator</span> <span class="keyword">extends</span> <span class="title class_">ServerEndpointConfig</span>.Configurator <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> BeanFactory context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span>  &lt;T&gt; T <span class="title function_">getEndpointInstance</span><span class="params">(Class&lt;T&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.getBean(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        CustomSpringConfigurator.context = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/websocket/&#123;myUserId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocket</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MessageMapper messageMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessageMapper</span><span class="params">(MessageMapper messageMapper)</span>&#123;</span><br><span class="line">        WebSocket.messageMapper = messageMapper;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;main1&quot;&gt;</span><br><span class="line">      .</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;main&quot;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&quot;contact&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;top&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;left&quot;&gt;</span><br><span class="line">            &lt;img class=&quot;avatar&quot; src=&quot;&quot; alt=&quot;&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;div class=&quot;right&quot;&gt;</span><br><span class="line">            &#123;&#123; user.username &#125;&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- æ·»åŠ å¥½å‹æŒ‰é’® --&gt;</span><br><span class="line">          &lt;button @click=&quot;showModal = true&quot; class=&quot;add-friend-button&quot;&gt;Add Friend&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- å¼¹å‡ºçš„å°é¡µé¢ï¼ˆæ¨¡æ€æ¡†ï¼‰ --&gt;</span><br><span class="line">          &lt;div v-if=&quot;showModal&quot; class=&quot;modal&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;modal-content&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;modal-header&quot;&gt;</span><br><span class="line">                &lt;h2&gt;Add a Friend&lt;/h2&gt;</span><br><span class="line">                &lt;span @click=&quot;showModal = false&quot; class=&quot;close&quot;&gt;&amp;times;&lt;/span&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">              &lt;!-- æœç´¢æ¡† --&gt;</span><br><span class="line">              &lt;div class=&quot;search-section&quot;&gt;</span><br><span class="line">                &lt;input v-model=&quot;searchQuery&quot; type=&quot;text&quot; placeholder=&quot;Search by username or phone number&quot;</span><br><span class="line">                  class=&quot;search-input&quot; @keyup.enter=&quot;searchFriends&quot; /&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">              &lt;!-- æœç´¢ç»“æœå±•ç¤º --&gt;</span><br><span class="line">              &lt;div class=&quot;friend-list&quot;&gt;</span><br><span class="line">                &lt;div v-for=&quot;friend in filteredFriends&quot; :key=&quot;friend.id&quot; class=&quot;friend-item&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;friend-avatar&quot;&gt;</span><br><span class="line">                    &lt;img :src=&quot;friend.avatar&quot; :alt=&quot;friend.username&quot; /&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div class=&quot;friend-info&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;friend-name&quot;&gt;&#123;&#123; friend.username &#125;&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;button @click=&quot;addFriend(friend)&quot; class=&quot;add-button&quot;&gt;Add&lt;/button&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div v-if=&quot;friends.length&quot; class=&quot;bottom&quot;&gt;</span><br><span class="line">          &lt;div v-for=&quot;(friend, i) in friends&quot; class=&quot;friend&quot; :class=&quot;&#123;activeColor: isActive(i)&#125;&quot;</span><br><span class="line">            @click=&quot;selectFriend(friend)&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;left&quot;&gt;</span><br><span class="line">              &lt;img class=&quot;avatar&quot; src=&quot;&quot; alt=&quot;&quot; /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;right&quot;&gt;</span><br><span class="line">              &#123;&#123; friend.userBName &#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div v-else class=&quot;info&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;msg&quot;&gt;</span><br><span class="line">            è¿˜æ²¡æœ‰å¥½å‹~~~</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div v-if=&quot;selectedFriend&quot; class=&quot;dialog&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;top1&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;name&quot;&gt;</span><br><span class="line">            &#123;&#123; selectedFriend.userBName &#125;&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;middle&quot; @mouseover=&quot;over&quot; @mouseout=&quot;out&quot;&gt;</span><br><span class="line">          &lt;div v-if=&quot;msgList.length&quot;&gt;</span><br><span class="line">            &lt;div v-for=&quot;msg in msgList&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;msg&quot;</span><br><span class="line">                :style=&quot;msg.sendUser === selectedFriend.userB ? &#x27;flex-direction: row;&#x27; : &#x27;flex-direction: row-reverse;&#x27;&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;avatar&quot;&gt;</span><br><span class="line">                  &lt;img alt=&quot;&quot; src=&quot;&quot; /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div v-if=&quot;msg.sendUser === selectedFriend.userB&quot; style=&quot;flex: 13;&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;bubble-msg-left&quot; style=&quot;margin-right: 75px;&quot;&gt;</span><br><span class="line">                    &#123;&#123; msg.message &#125;&#125;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div v-else style=&quot;flex: 13;&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;bubble-msg-right&quot; style=&quot;margin-left: 75px;&quot;&gt;</span><br><span class="line">                    &#123;&#123; msg.message &#125;&#125;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;bottom&quot;&gt;</span><br><span class="line">          &lt;label&gt;</span><br><span class="line">            &lt;textarea class=&quot;messageText&quot; maxlength=&quot;256&quot; v-model=&quot;msg&quot; :placeholder=&quot;hint&quot;</span><br><span class="line">              @keydown.enter=&quot;sendMsg($event)&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">          &lt;/label&gt;</span><br><span class="line">          &lt;button class=&quot;send&quot; :class=&quot;&#123;emptyText: isEmptyText&#125;&quot; title=&quot;æŒ‰ä¸‹ ENTER å‘é€&quot; @click=&quot;sendMsg()&quot;&gt;å‘é€&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div v-else class=&quot;info&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;msg&quot;&gt;</span><br><span class="line">          æ‰¾ä¸ªå¥½å‹èŠå¤©å§~~~</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        showModal: false,   // æ§åˆ¶æ¨¡æ€æ¡†çš„æ˜¾ç¤ºä¸éšè—</span><br><span class="line">        searchQuery: &#x27;&#x27;,    // æœç´¢æ¡†çš„è¾“å…¥å†…å®¹</span><br><span class="line">        msg: &#x27;&#x27;,</span><br><span class="line">        friends: [],</span><br><span class="line">        selectedFriend: null,</span><br><span class="line">        chatHistory: [],</span><br><span class="line">        newMessage: &#x27;&#x27;,</span><br><span class="line">        websocket: null,</span><br><span class="line">        hint: &#x27;&#x27;,</span><br><span class="line">        bubbleMsg: &#x27;&#x27;,</span><br><span class="line">        interval: null,</span><br><span class="line">        isEmptyText: true,</span><br><span class="line">        msgList: [],</span><br><span class="line">        filteredFriends: [] // æœç´¢åˆ°çš„å¥½å‹</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      user () &#123;</span><br><span class="line">        return JSON.parse(localStorage.getItem(&#x27;currentUser&#x27;))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">      msgList () &#123;</span><br><span class="line">        const mid = document.querySelector(&#x27;.middle&#x27;)</span><br><span class="line">        this.$nextTick(() =&gt; &#123;</span><br><span class="line">          mid &amp;&amp; (mid.scrollTop = mid.scrollHeight)</span><br><span class="line">          document.querySelector(&#x27;.messageText&#x27;).focus()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      msg () &#123;</span><br><span class="line">        this.isEmptyText = !this.msg</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      searchFriends () &#123;</span><br><span class="line">        // æ¨¡æ‹Ÿé€šè¿‡ç”¨æˆ·åæˆ–ç”µè¯å·ç æœç´¢å¥½å‹</span><br><span class="line">        this.$http.get(this.$constant.baseURL + &quot;/upm/user/getUserByUserNameOrEmail/&quot; + this.searchQuery)</span><br><span class="line">          .then((res) =&gt; &#123;</span><br><span class="line">            if (!this.$common.isEmpty(res.data)) &#123;</span><br><span class="line">              this.filteredFriends = res.data;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch((error) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: error.message,</span><br><span class="line">              type: &quot;error&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      addFriend (friend) &#123;</span><br><span class="line">        alert(`Friend request sent to $&#123;friend.username&#125;`);</span><br><span class="line"></span><br><span class="line">        this.$http.post(this.$constant.baseURL + &quot;/chat/addFriend&quot;, &#123;</span><br><span class="line">          &quot;id&quot;: friend.id</span><br><span class="line">        &#125;)</span><br><span class="line">          .then((res) =&gt; &#123;</span><br><span class="line">            alert(&quot;æ·»åŠ æˆåŠŸ&quot;);</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch((error) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: error.message,</span><br><span class="line">              type: &quot;error&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">        // æ‰§è¡Œæ·»åŠ å¥½å‹çš„é€»è¾‘</span><br><span class="line">      &#125;,</span><br><span class="line">      over () &#123;</span><br><span class="line">        this.setColor(&#x27;#c9c7c7&#x27;)</span><br><span class="line">      &#125;,</span><br><span class="line">      out () &#123;</span><br><span class="line">        this.setColor(&#x27;#0000&#x27;)</span><br><span class="line">      &#125;,</span><br><span class="line">      setColor (color) &#123;</span><br><span class="line">        document.documentElement.style.setProperty(&#x27;--scroll-color&#x27;, `$&#123;color&#125;`)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      getFriends () &#123;</span><br><span class="line">        this.$http.get(this.$constant.baseURL + &quot;/chat/getFriendsListById&quot;)</span><br><span class="line">          .then((res) =&gt; &#123;</span><br><span class="line">            if (!this.$common.isEmpty(res.data)) &#123;</span><br><span class="line">              this.friends = res.data</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch((error) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: error.message,</span><br><span class="line">              type: &quot;error&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      selectFriend (friend) &#123;</span><br><span class="line">        this.selectedFriend = friend;</span><br><span class="line">        this.loadChatHistory(friend);</span><br><span class="line">      &#125;,</span><br><span class="line">      loadChatHistory (friend) &#123;</span><br><span class="line">        this.$http.post(this.$constant.baseURL + &quot;/chat/message/getMessage&quot;, friend)</span><br><span class="line">          .then((res) =&gt; &#123;</span><br><span class="line">            if (!this.$common.isEmpty(res.data)) &#123;</span><br><span class="line">              this.msgList = res.data;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch((error) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: error.message,</span><br><span class="line">              type: &quot;error&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      sendMsg (e) &#123;</span><br><span class="line">        if (e) &#123;</span><br><span class="line">          e.preventDefault()</span><br><span class="line">        &#125;</span><br><span class="line">        if (!this.msg) &#123;</span><br><span class="line">          this.hint = &#x27;ä¿¡æ¯ä¸å¯ä¸ºç©ºï¼&#x27;</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        let entity = &#123;</span><br><span class="line">          sendUser: JSON.parse(localStorage.getItem(&#x27;currentUser&#x27;)).id,</span><br><span class="line">          receiveUser: this.selectedFriend.userB,</span><br><span class="line">          message: this.msg.trim(),</span><br><span class="line">          // time: new Date()</span><br><span class="line">        &#125;</span><br><span class="line">        this.websocket.send(JSON.stringify(entity))</span><br><span class="line">        var ha = JSON.stringify(entity);</span><br><span class="line">        this.msgList.push(entity);</span><br><span class="line">        this.msg = &#x27;&#x27;</span><br><span class="line">        this.hint = &#x27;&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">      ,</span><br><span class="line">      sendMessage () &#123;</span><br><span class="line">        if (this.newMessage.trim() === &#x27;&#x27;) return;</span><br><span class="line"></span><br><span class="line">        const message = &#123; content: this.newMessage, isMine: true &#125;;</span><br><span class="line">        this.chatHistory.push(message);</span><br><span class="line"></span><br><span class="line">        let entity = &#123;</span><br><span class="line">          sendUser: JSON.parse(localStorage.getItem(&#x27;currentUser&#x27;)).id,</span><br><span class="line">          receiveUser: this.selectedFriend.userB,</span><br><span class="line">          message: this.newMessage.trim(),</span><br><span class="line">          // time: new Date()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        this.websocket.send(JSON.stringify(entity)); // Send message through WebSocket</span><br><span class="line">        this.newMessage = &#x27;&#x27;;</span><br><span class="line">      &#125;,</span><br><span class="line">      setupWebSocket () &#123;</span><br><span class="line">        this.websocket = new WebSocket(`ws://localhost:56281/websocket/$&#123;JSON.parse(localStorage.getItem(&#x27;currentUser&#x27;)).id&#125;`);</span><br><span class="line">        this.websocket.onmessage = (event) =&gt; &#123;</span><br><span class="line">          const receivedMessage = JSON.parse(event.data);</span><br><span class="line">          this.msgList.push(receivedMessage);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      setContact (index) &#123;</span><br><span class="line">        this.active = index</span><br><span class="line">        delete this.friendList[index].password</span><br><span class="line">        this.$emit(&#x27;set-contact&#x27;, this.friendList[index])</span><br><span class="line">      &#125;,</span><br><span class="line">      isActive (index) &#123;</span><br><span class="line">        return this.active === index</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted () &#123;</span><br><span class="line">      this.setupWebSocket();</span><br><span class="line">      this.getFriends();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">  .contact &#123;</span><br><span class="line">    width: 360px;</span><br><span class="line">    height: 100%;</span><br><span class="line">    float: left;</span><br><span class="line">    border-right: #d0d0d0 1px solid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .top &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 80px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    border-bottom: #e0dfdf 1px solid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .activeColor &#123;</span><br><span class="line">    background-color: #c9cbcb;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .top .left &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">    text-align: center;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .avatar &#123;</span><br><span class="line">    width: 48px;</span><br><span class="line">    height: 48px;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .top .right &#123;</span><br><span class="line">    flex: 3;</span><br><span class="line">    color: black;</span><br><span class="line">    /* è®¾ç½®å­—ä½“é¢œè‰²ä¸ºé»‘è‰² */</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .friend &#123;</span><br><span class="line">    width: 360px;</span><br><span class="line">    height: 60px;</span><br><span class="line">    line-height: 60px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    border-bottom: #faf7f7 1px solid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .friend .left &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">    margin-top: 24px;</span><br><span class="line">    text-align: center;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .friend .right &#123;</span><br><span class="line">    flex: 3;</span><br><span class="line">    color: #575454;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    color: black;</span><br><span class="line">    /* è®¾ç½®å­—ä½“é¢œè‰²ä¸ºé»‘è‰² */</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .friend .avatar &#123;</span><br><span class="line">    width: 36px;</span><br><span class="line">    height: 36px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .info &#123;</span><br><span class="line">    margin-top: 230px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .info .msg &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  #app &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    background-size: cover;</span><br><span class="line">    background-image: url(&quot;../assets/img/chat-bg.jpg&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .main &#123;</span><br><span class="line">    width: 1080px;</span><br><span class="line">    height: 648px;</span><br><span class="line">    margin-top: 72px;</span><br><span class="line">    margin-left: auto;</span><br><span class="line">    margin-right: auto;</span><br><span class="line">    border-radius: 5px;</span><br><span class="line">    background-color: #efeded;</span><br><span class="line">    border: #d0d0d0 1px solid;</span><br><span class="line">    box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);</span><br><span class="line">    /* æ–°å¢çš„ Flexbox æ ·å¼ */</span><br><span class="line">    display: flex;</span><br><span class="line">    /* å¯ç”¨ Flexbox å¸ƒå±€ */</span><br><span class="line">    flex-direction: row;</span><br><span class="line">    /* æ°´å¹³æ–¹å‘æ’åˆ—å­å…ƒç´  */</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    /* å­å…ƒç´ é—´çš„è·ç¦»è‡ªåŠ¨åˆ†é…ï¼Œæˆ–æ ¹æ®éœ€è¦è°ƒæ•´ */</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  :root &#123;</span><br><span class="line">    --scroll-color: #0000;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .dialog &#123;</span><br><span class="line">    width: 719px;</span><br><span class="line">    height: 100%;</span><br><span class="line">    float: right;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .name &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    top: 22px;</span><br><span class="line">    left: 25px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .info &#123;</span><br><span class="line">    width: 719px;</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .info .msg &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">    text-align: center;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .top1 &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 60px;</span><br><span class="line">    border-bottom: #d0d0d0 1px solid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .top1::after &#123;</span><br><span class="line">    content: &quot; &quot;;</span><br><span class="line">    float: right;</span><br><span class="line">    position: relative;</span><br><span class="line">    top: 40px;</span><br><span class="line">    border: 4px solid #0000;</span><br><span class="line">    border-top-color: #8e9292;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .middle &#123;</span><br><span class="line">    height: 432px;</span><br><span class="line">    overflow: auto;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    margin: 6px 0 11px 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .middle::-webkit-scrollbar &#123;</span><br><span class="line">    width: 8px;</span><br><span class="line">    height: 1px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .middle::-webkit-scrollbar-thumb &#123;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    background-color: var(--scroll-color);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .middle::-webkit-scrollbar-track &#123;</span><br><span class="line">    background: #efeded;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .middle .msg &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .avatar &#123;</span><br><span class="line">    margin: 8px;</span><br><span class="line">    flex: 1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .avatar img &#123;</span><br><span class="line">    width: 36px;</span><br><span class="line">    height: 36px;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .bubble-msg-left,</span><br><span class="line">  .bubble-msg-right &#123;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    margin-top: 10px;</span><br><span class="line">    line-height: 24px;</span><br><span class="line">    border-radius: 5px;</span><br><span class="line">    width: fit-content;</span><br><span class="line">    line-break: anywhere;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .bubble-msg-left &#123;</span><br><span class="line">    float: left;</span><br><span class="line">    color: black;</span><br><span class="line">    margin-left: -12px;</span><br><span class="line">    text-indent: -0.5em;</span><br><span class="line">    background-color: white;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .bubble-msg-right &#123;</span><br><span class="line">    float: right;</span><br><span class="line">    color: white;</span><br><span class="line">    background-color: #1e6ee1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .bubble-msg-right::before &#123;</span><br><span class="line">    content: &quot; &quot;;</span><br><span class="line">    float: right;</span><br><span class="line">    position: relative;</span><br><span class="line">    left: 18px;</span><br><span class="line">    border: 4px solid #0000;</span><br><span class="line">    border-left-color: #1e6ee1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .bubble-msg-left::before &#123;</span><br><span class="line">    content: &quot; &quot;;</span><br><span class="line">    float: left;</span><br><span class="line">    position: relative;</span><br><span class="line">    left: -18px;</span><br><span class="line">    border: 4px solid #0000;</span><br><span class="line">    border-right-color: white;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .line &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 0;</span><br><span class="line">    position: relative;</span><br><span class="line">    top: -6px;</span><br><span class="line">    border-top: #d0d0d0 1px solid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .dialog .bottom &#123;</span><br><span class="line">    padding-left: 10px;</span><br><span class="line">    padding-right: 25px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .messageText &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    margin-right: 2px;</span><br><span class="line">    font: 14px/1.5 Helvetica, Arial, Tahoma, å¾®è½¯é›…é»‘;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 106px;</span><br><span class="line">    outline: none;</span><br><span class="line">    background: #efeded;</span><br><span class="line">    border: 0 none;</span><br><span class="line">    overflow-y: auto;</span><br><span class="line">    -webkit-box-sizing: border-box;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">    resize: none;</span><br><span class="line">    vertical-align: middle;</span><br><span class="line">    display: inline-block;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .dialog .bottom::after &#123;</span><br><span class="line">    content: &quot; &quot;;</span><br><span class="line">    float: right;</span><br><span class="line">    position: relative;</span><br><span class="line">    top: -121px;</span><br><span class="line">    left: 75px;</span><br><span class="line">    border: 4px solid #0000;</span><br><span class="line">    border-bottom-color: #8e9292;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .send &#123;</span><br><span class="line">    float: right;</span><br><span class="line">    position: relative;</span><br><span class="line">    top: -20px;</span><br><span class="line">    left: 10px;</span><br><span class="line">    background-color: #51a5e6;</span><br><span class="line">    border: #87ceeb;</span><br><span class="line">    color: #fff;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    width: 50px;</span><br><span class="line">    height: 22px;</span><br><span class="line">    border-radius: 3px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .send:focus &#123;</span><br><span class="line">    outline: none;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .emptyText &#123;</span><br><span class="line">    background-color: #d0d0d0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .name &#123;</span><br><span class="line">    color: black;</span><br><span class="line">    /* è®¾ç½®å­—ä½“é¢œè‰²ä¸ºé»‘è‰² */</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /* ä¸»ä½“æŒ‰é’®æ ·å¼ */</span><br><span class="line">  .add-friend-button &#123;</span><br><span class="line">    padding: 10px 20px;</span><br><span class="line">    background-color: #007bff;</span><br><span class="line">    color: white;</span><br><span class="line">    font-size: 18px;</span><br><span class="line">    border: none;</span><br><span class="line">    border-radius: 20px;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    transition: background-color 0.3s;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .add-friend-button:hover &#123;</span><br><span class="line">    background-color: #0056b3;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* æ¨¡æ€æ¡†èƒŒæ™¯ */</span><br><span class="line">  .modal &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* æ¨¡æ€æ¡†å†…å®¹ */</span><br><span class="line">  .modal-content &#123;</span><br><span class="line">    background-color: #fff;</span><br><span class="line">    padding: 20px;</span><br><span class="line">    border-radius: 15px;</span><br><span class="line">    width: 400px;</span><br><span class="line">    max-width: 100%;</span><br><span class="line">    box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* æ¨¡æ€æ¡†å¤´éƒ¨ */</span><br><span class="line">  .modal-header &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .modal-header h2 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 24px;</span><br><span class="line">    font-family: &#x27;KaiTi&#x27;, serif;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .close &#123;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    font-size: 24px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* æœç´¢æ¡†æ ·å¼ */</span><br><span class="line">  .search-input &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    border: 2px solid #ccc;</span><br><span class="line">    border-radius: 10px;</span><br><span class="line">    font-size: 18px;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* å¥½å‹åˆ—è¡¨æ ·å¼ */</span><br><span class="line">  .friend-list &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* å•ä¸ªå¥½å‹é¡¹ */</span><br><span class="line">  .friend-item &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    margin-bottom: 15px;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    border: 1px solid #ccc;</span><br><span class="line">    border-radius: 10px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .friend-avatar img &#123;</span><br><span class="line">    width: 50px;</span><br><span class="line">    height: 50px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    margin-right: 15px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .friend-info &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    width: 100%;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .friend-name &#123;</span><br><span class="line">    font-size: 18px;</span><br><span class="line">    font-family: &#x27;KaiTi&#x27;, serif;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* æ·»åŠ å¥½å‹æŒ‰é’® */</span><br><span class="line">  .add-button &#123;</span><br><span class="line">    padding: 8px 15px;</span><br><span class="line">    background-color: #28a745;</span><br><span class="line">    color: white;</span><br><span class="line">    border: none;</span><br><span class="line">    border-radius: 10px;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    font-size: 16px;</span><br><span class="line">    transition: background-color 0.3s;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .add-button:hover &#123;</span><br><span class="line">    background-color: #218838;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/websocket/&#123;myUserId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocket</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸å®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡ä»–æ¥ç»™å®¢æˆ·ç«¯å‘æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Session session;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  concurrentåŒ…çš„çº¿ç¨‹å®‰å…¨Setï¼Œç”¨æ¥å­˜æ”¾æ¯ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„MyWebSocketå¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">     *  è™½ç„¶<span class="doctag">@Component</span>é»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼çš„ï¼Œä½†springbootè¿˜æ˜¯ä¼šä¸ºæ¯ä¸ªwebsocketè¿æ¥åˆå§‹åŒ–ä¸€ä¸ªbeanï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸€ä¸ªé™æ€setä¿å­˜èµ·æ¥ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CopyOnWriteArraySet&lt;WebSocket&gt; webSockets =<span class="keyword">new</span> <span class="title class_">CopyOnWriteArraySet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *ç”¨æ¥å­˜åœ¨çº¿è¿æ¥ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;Integer,Session&gt; sessionPool = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;Integer,Session&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MessageMapper messageMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessageMapper</span><span class="params">(MessageMapper messageMapper)</span>&#123;</span><br><span class="line">        WebSocket.messageMapper = messageMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥æˆåŠŸæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session è¿æ¥ä¼šè¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId ç”¨æˆ·ç¼–å·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session , <span class="meta">@PathParam(&quot;myUserId&quot;)</span> Integer userId)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.session = session;</span><br><span class="line">            <span class="built_in">this</span>.userId = userId;</span><br><span class="line">            webSockets.add(<span class="built_in">this</span>);</span><br><span class="line">            sessionPool.put(userId, session);</span><br><span class="line">            log.info(<span class="string">&quot;ã€websocketæ¶ˆæ¯ã€‘ ç”¨æˆ·ï¼š&quot;</span> + userId + <span class="string">&quot; åŠ å…¥è¿æ¥...&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;---------------WebSocketè¿æ¥å¼‚å¸¸---------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­è¿æ¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            webSockets.remove(<span class="built_in">this</span>);</span><br><span class="line">            sessionPool.remove(<span class="built_in">this</span>.userId);</span><br><span class="line">            log.info(<span class="string">&quot;ã€websocketæ¶ˆæ¯ã€‘ ç”¨æˆ·ï¼š&quot;</span>+ <span class="built_in">this</span>.userId + <span class="string">&quot; æ–­å¼€è¿æ¥...&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;---------------WebSocketæ–­å¼€å¼‚å¸¸---------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String body)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å°†Bodyè§£æ</span></span><br><span class="line">            <span class="type">MessageEntityDecode</span> <span class="variable">messageEntityDecode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageEntityDecode</span>();</span><br><span class="line">            <span class="type">MessageVO</span> <span class="variable">messageVO</span> <span class="operator">=</span> messageEntityDecode.decode(body);</span><br><span class="line">            log.info(messageVO.toString());</span><br><span class="line">            sendOneMessage(messageVO.getReceiveUser(),messageVO.getMessage());</span><br><span class="line"></span><br><span class="line">            <span class="type">MessagePO</span> <span class="variable">messagePO</span> <span class="operator">=</span> messageVO.transformPO();</span><br><span class="line">            messageMapper.insert(messagePO);</span><br><span class="line">            </span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;---------------WebSocketæ¶ˆæ¯å¼‚å¸¸---------------&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å•ç‚¹æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendOneMessage</span><span class="params">(Integer userId, String message)</span> &#123;</span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> sessionPool.get(userId);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="literal">null</span>&amp;&amp;session.isOpen()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;ã€websocketæ¶ˆæ¯ã€‘ å•ç‚¹æ¶ˆæ¯:&quot;</span>+message);</span><br><span class="line">                <span class="type">MessageVO</span> <span class="variable">messageVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageVO</span>();</span><br><span class="line">                messageVO.setMessage(message);</span><br><span class="line">                messageVO.setSendUser(<span class="built_in">this</span>.userId);</span><br><span class="line">                messageVO.setReceiveUser(userId);</span><br><span class="line"></span><br><span class="line">                <span class="type">MessageEntityEncode</span> <span class="variable">messageEntityEncode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageEntityEncode</span>();</span><br><span class="line">                session.getAsyncRemote().sendText(messageEntityEncode.encode(messageVO));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;---------------WebSocketå•ç‚¹æ¶ˆæ¯å‘é€å¼‚å¸¸---------------&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WebSocket </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> WebSocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>52 SIDC</title>
      <link href="/2025/02/26/52%20SIDC/"/>
      <url>/2025/02/26/52%20SIDC/</url>
      
        <content type="html"><![CDATA[<h1 id="52-SIDC"><a href="#52-SIDC" class="headerlink" title="52 SIDC"></a>52 SIDC</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>SIDCå…¨ç§°<strong>èºé’‰ITå¼€å‘ç¤¾åŒº</strong>ï¼ˆScrew IT Development Communityï¼‰ï¼Œä¸»è¦åŠŸèƒ½ä¸ºï¼šå¼€å‘è€…æ‰“é€ ä¸“ä¸šæŠ€æœ¯å†™ä½œã€åˆ†äº«ä¸äº¤æµå¹³å°ï¼Œä¸ºæŠ€æœ¯äººæä¾›èµ„è®¯ä¸<a href="https://baike.baidu.com/item/%E7%9F%A5%E8%AF%86%E4%BA%A4%E6%B5%81/56528577?fromModule=lemma_inlink">çŸ¥è¯†äº¤æµ</a>äº’åŠ¨ã€‚ä¸ºä¸ªäººå¼€å‘è€…æä¾›é¡¹ç›®å­¦ä¹ æ¡ˆä¾‹ï¼Œè¯¥é¡¹ç›®ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚</p><p><strong>æ³¨æ„ä½ ä¸ä»…ä»…åªæ˜¯ä¸ºäº†å®Œæˆè¿™ä¸€ä¸ªé¡¹ç›®ï¼Œè€Œæ˜¯ä¸ºäº†åœ¨è¿™ä¸ªé¡¹ç›®ä¸­å­¦ä¹ ï¼Œå­¦ä¹ æ‰€æœ‰ä½¿ç”¨åˆ°çš„æŠ€æœ¯å’Œå¯èƒ½ä¼šé¢ä¸´çš„é—®é¢˜ï¼Œå¯¹å¾…æ¯ä¸€ä¸ªæŠ€æœ¯ã€æ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹éƒ½éœ€è¦å»æ·±æŒ–ï¼Œè€Œä¸æ˜¯æµ…å°è¾„æ­¢ï¼Œä»…ä»…å¤„äºä¼šä½¿ç”¨çš„å±‚é¢ï¼Œå› ä¸ºä¼šä½¿ç”¨è€Œæ²¾æ²¾è‡ªå–œï¼Œè€Œä¸å»æ·±æŒ–å…¶å†…åœ¨ã€‚</strong></p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>SIDCä¸»è¦åŠŸèƒ½æœ‰ï¼š</p><ol><li>ç”¨æˆ·æ¨¡å—ï¼šç”¨æˆ·ç™»å½•æ³¨å†Œã€ç”¨æˆ·å…³æ³¨ã€ç”¨æˆ·å¹³å°ç§ä¿¡äº¤æµï¼›</li><li>åšå®¢æ¨¡å—ï¼šåšå®¢æµè§ˆã€åšå®¢è¯„ä»·ã€åšå®¢æ”¶è—ã€åšå®¢ç‚¹èµã€åšå®¢æœç´¢ã€å…³æ³¨è€…åšå®¢æ¨é€ã€åšå®¢å‘è¡¨ã€åšå®¢ç®¡ç†ï¼›</li><li></li></ol><h2 id="é¡¹ç›®å¯åŠ¨"><a href="#é¡¹ç›®å¯åŠ¨" class="headerlink" title="é¡¹ç›®å¯åŠ¨"></a>é¡¹ç›®å¯åŠ¨</h2><ol><li><p>å¯åŠ¨MySQLï¼›</p></li><li><p>å¯åŠ¨Redisï¼›</p></li><li><p>å¯åŠ¨Elasticsearchï¼›</p></li><li><p>å¯åŠ¨minioï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.\minio.exe server D:\CodeFolder\ToolFolder\MinIO\data  --console-address &quot;:9001&quot; --address &quot;:9000&quot; </span><br><span class="line"></span><br><span class="line">cd /d D:\CodeFolder\ToolFolder\MinIO &amp;&amp; .\minio.exe server D:\CodeFolder\ToolFolder\MinIO\data --console-address &quot;:9001&quot; --address &quot;:9000&quot;</span><br><span class="line"></span><br><span class="line">è´¦å·ï¼šadmin</span><br><span class="line">å¯†ç ï¼šadmin1234</span><br><span class="line">http://localhost:9001</span><br></pre></td></tr></table></figure></li></ol><h2 id="ä¿®æ”¹profile"><a href="#ä¿®æ”¹profile" class="headerlink" title="ä¿®æ”¹profile"></a>ä¿®æ”¹profile</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959604.png" alt="image-20250225182928012"></p><h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><h3 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h3><table><thead><tr><th align="center">åç§°</th><th align="center">ç‰ˆæœ¬</th></tr></thead><tbody><tr><td align="center">SpringBoot</td><td align="center"></td></tr><tr><td align="center">SpringCloud</td><td align="center"></td></tr><tr><td align="center">MyBatis</td><td align="center"></td></tr><tr><td align="center">MyBatis-Plus</td><td align="center"></td></tr><tr><td align="center">Redis</td><td align="center"></td></tr><tr><td align="center">Dubbo</td><td align="center"></td></tr><tr><td align="center">Nacos</td><td align="center"></td></tr><tr><td align="center">Spring Security</td><td align="center"></td></tr><tr><td align="center">Spring Gateway</td><td align="center"></td></tr><tr><td align="center">Feign</td><td align="center"></td></tr><tr><td align="center">RabbitMQ</td><td align="center"></td></tr></tbody></table><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><table><thead><tr><th align="center">åç§°</th><th align="center">ç‰ˆæœ¬</th></tr></thead><tbody><tr><td align="center">Elasticsearch</td><td align="center"></td></tr><tr><td align="center">MySQL</td><td align="center"></td></tr><tr><td align="center">MinIo</td><td align="center"></td></tr></tbody></table><h3 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><table><thead><tr><th align="center">åç§°</th><th align="center">ç‰ˆæœ¬</th></tr></thead><tbody><tr><td align="center">Vue</td><td align="center"></td></tr><tr><td align="center">HTML</td><td align="center"></td></tr><tr><td align="center">JS</td><td align="center"></td></tr><tr><td align="center">CSS</td><td align="center"></td></tr></tbody></table><h2 id="å‰ç«¯è®¾è®¡"><a href="#å‰ç«¯è®¾è®¡" class="headerlink" title="å‰ç«¯è®¾è®¡"></a>å‰ç«¯è®¾è®¡</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959554.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959563.png" alt="å›¾ç‰‡2"></p><h3 id="å‰ç«¯é¡µé¢è®¾è®¡"><a href="#å‰ç«¯é¡µé¢è®¾è®¡" class="headerlink" title="å‰ç«¯é¡µé¢è®¾è®¡"></a>å‰ç«¯é¡µé¢è®¾è®¡</h3><h4 id="ChatGPT"><a href="#ChatGPT" class="headerlink" title="ChatGPT"></a>ChatGPT</h4><p>ç”Ÿæˆä»£ç promoteï¼š</p><blockquote><p>ç°åœ¨å‡è®¾ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„Vue3+ElementUIå¼€å‘è€…ï¼Œä¸”ä½ å¯¹ç¾å­¦æœ‰æ·±åˆ»çš„ç†è§£ï¼Œä½ ä¼šåˆ©ç”¨å‰ç«¯å¼€å‘å·¥å…·å¼€å‘å‡ºç®€çº¦ä¸”å…·æœ‰ç¾æ„Ÿçš„é¡µé¢ã€‚ç›¸å…³ä¾èµ–æˆ‘å·²ç»ä¸‹è½½è¿‡ï¼Œè¯·ä½ ç›´æ¥ç»™å‡ºé¡µé¢çš„vueä»£ç å³å¯ï¼æ‰€æœ‰çš„æ¨¡å—ï¼Œè¾“å…¥æ¡†ï¼ŒæŒ‰é’®ç­‰éƒ½è¯·ä½¿ç”¨åœ†è§’æ ·å¼ï¼Œå­—ä½“ä¸ºæ¥·ä½“ï¼Œå­—ä½“è¾ƒå¤§ï¼Œä¸”ä½ ç”Ÿæˆçš„æ‰€æœ‰ä»£ç éƒ½æ˜¯å±€åŸŸsetupè¯­æ³•ç³–ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§æˆ‘çš„æè¿°å’Œè¦æ±‚ç”Ÿæˆï¼ï¼ï¼ã€‚ </p><p>è¯·ä½ å¸®æˆ‘å®ç°ä¸€ä¸ªç”¨æˆ·æ³¨å†Œé¡µé¢ï¼Œè¦æ±‚ç”¨æˆ·è¾“å…¥çš„æœ‰ç”¨æˆ·åã€å¯†ç ã€é‡å¤å¯†ç ã€é‚®ç®±ã€ç”µè¯å·ç ã€éªŒè¯ç ï¼Œè¦æ±‚ç”Ÿæˆçš„é¡µé¢ç®€çº¦ï¼Œä¸”æ‰€æœ‰çš„è¾“å…¥æ¡†å‡æ˜¯åœ†è§’ï¼Œé¡µé¢éœ€è¦è‡ªå®šä¹‰èƒŒæ™¯å›¾ç‰‡ï¼Œä¸”æ‰€æœ‰çš„è¾“å…¥æ¡†è¾ƒå®½è¾ƒå¤§ï¼Œä¸åŒçš„è¾“å…¥æ¡†ç›´æ¥ä¸Šä¸‹é—´è·è¾ƒå¤§ï¼Œå­—ä½“è¾ƒå¤§ä¸”ä½¿ç”¨è‰ºæœ¯å­—ä½“ï¼Œæ‰€æœ‰è¾“å…¥æ¡†æ‰€å±çš„è¿™ä¸ªdivåº”è¯¥è¾ƒå¤§ã€‚</p></blockquote><h4 id="ç™»å½•é¡µé¢"><a href="#ç™»å½•é¡µé¢" class="headerlink" title="ç™»å½•é¡µé¢"></a>ç™»å½•é¡µé¢</h4><blockquote><p>ç°åœ¨å‡è®¾ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„Vue3+ElementUIå¼€å‘è€…ï¼Œä¸”ä½ å¯¹ç¾å­¦æœ‰æ·±åˆ»çš„ç†è§£ï¼Œä½ ä¼šåˆ©ç”¨å‰ç«¯å¼€å‘å·¥å…·å¼€å‘å‡ºç®€çº¦ä¸”å…·æœ‰ç¾æ„Ÿçš„é¡µé¢ã€‚ç›¸å…³ä¾èµ–æˆ‘å·²ç»ä¸‹è½½è¿‡ï¼Œè¯·ä½ ç›´æ¥ç»™å‡ºé¡µé¢çš„vueä»£ç å³å¯ï¼æ‰€æœ‰çš„æ¨¡å—ï¼Œè¾“å…¥æ¡†ï¼ŒæŒ‰é’®ç­‰éƒ½è¯·ä½¿ç”¨åœ†è§’æ ·å¼ï¼Œå­—ä½“ä¸ºæ¥·ä½“ï¼Œå­—ä½“è¾ƒå¤§ï¼Œä¸”ä½ ç”Ÿæˆçš„æ‰€æœ‰ä»£ç éƒ½æ˜¯åŸºäºsetupè¯­æ³•ç³–ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§æˆ‘çš„æè¿°å’Œè¦æ±‚ç”Ÿæˆï¼ï¼ï¼</p><p> è¯·ä½ å¸®æˆ‘å®ç°ä¸€ä¸ªç”¨æˆ·ç™»å½•é¡µé¢ï¼Œè¦æ±‚ç”¨æˆ·è¾“å…¥çš„æœ‰ç”¨æˆ·åã€å¯†ç ã€‚è¦æ±‚ç”Ÿæˆçš„é¡µé¢ç®€çº¦ï¼Œä¸”æ‰€æœ‰çš„è¾“å…¥æ¡†å‡æ˜¯åœ†è§’ï¼Œé¡µé¢éœ€è¦è‡ªå®šä¹‰èƒŒæ™¯å›¾ç‰‡ï¼Œä¸”æ‰€æœ‰çš„è¾“å…¥æ¡†è¾ƒå®½è¾ƒå¤§ï¼Œä¸åŒçš„è¾“å…¥æ¡†ç›´æ¥ä¸Šä¸‹é—´è·è¾ƒå¤§ï¼Œå­—ä½“è¾ƒå¤§ä¸”ä½¿ç”¨æ¥·ä½“ï¼Œæ‰€æœ‰è¾“å…¥æ¡†æ‰€å±çš„è¿™ä¸ªdivåº”è¯¥è¾ƒå¤§ï¼Œæ•´ä¸ªè¡¨è¾¾åº”è¯¥ä½äºæ•´ä¸ªé¡µé¢çš„å·¦è¾¹ï¼Œæ•´ä¸ªè¡¨å•ä¸Šæ–¹åº”æœ‰ï¼šSIDNç”¨æˆ·ç™»å½•ï¼Œä¸‹æ–¹åº”è¯¥æä¾›ç”¨æˆ·æ³¨å†Œå’Œå¿˜è®°å¯†ç è·³è½¬æŒ‰é’®ï¼Œä¸¤ä¸ªæŒ‰é’®åº”è¯¥ä½äºåŒä¸€è¡Œä¸”å±…ä¸­ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959544.png" alt="image-20240729222526580"></p><h4 id="æ³¨å†Œé¡µé¢"><a href="#æ³¨å†Œé¡µé¢" class="headerlink" title="æ³¨å†Œé¡µé¢"></a>æ³¨å†Œé¡µé¢</h4><blockquote><p>ç°åœ¨å‡è®¾ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„Vue3+ElementUIå¼€å‘è€…ï¼Œä¸”ä½ å¯¹ç¾å­¦æœ‰æ·±åˆ»çš„ç†è§£ï¼Œä½ ä¼šåˆ©ç”¨å‰æ®µå¼€å‘å·¥å…·å¼€å‘å‡ºç®€çº¦ä¸”å…·æœ‰ç¾æ„Ÿçš„é¡µé¢ã€‚ç›¸å…³ä¾èµ–æˆ‘å·²ç»ä¸‹è½½è¿‡ï¼Œè¯·ä½ ç›´æ¥ç»™å‡ºé¡µé¢çš„vueä»£ç å³å¯ï¼</p><p> è¯·ä½ å¸®æˆ‘å®ç°ä¸€ä¸ªç”¨æˆ·æ³¨å†Œé¡µé¢ï¼Œè¦æ±‚ç”¨æˆ·è¾“å…¥çš„æœ‰ç”¨æˆ·åã€å¯†ç ã€é‡å¤å¯†ç ã€é‚®ç®±ã€ç”µè¯å·ç ã€éªŒè¯ç ï¼Œè¦æ±‚ç”Ÿæˆçš„é¡µé¢ç®€çº¦ï¼Œä¸”æ‰€æœ‰çš„è¾“å…¥æ¡†å‡æ˜¯åœ†è§’ï¼Œé¡µé¢éœ€è¦è‡ªå®šä¹‰èƒŒæ™¯å›¾ç‰‡ï¼Œä¸”æ‰€æœ‰çš„è¾“å…¥æ¡†è¾ƒå®½è¾ƒå¤§ï¼Œä¸åŒçš„è¾“å…¥æ¡†ç›´æ¥ä¸Šä¸‹é—´è·è¾ƒå¤§ï¼Œå­—ä½“è¾ƒå¤§ä¸”ä½¿ç”¨è‰ºæœ¯å­—ä½“ï¼Œæ‰€æœ‰è¾“å…¥æ¡†æ‰€å±çš„è¿™ä¸ªdivåº”è¯¥è¾ƒå¤§ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959541.png" alt="image-20240729222558501"></p><h4 id="ç»„ä»¶è®¾è®¡"><a href="#ç»„ä»¶è®¾è®¡" class="headerlink" title="ç»„ä»¶è®¾è®¡"></a>ç»„ä»¶è®¾è®¡</h4><h5 id="å¯¼èˆªæ "><a href="#å¯¼èˆªæ " class="headerlink" title="å¯¼èˆªæ "></a>å¯¼èˆªæ </h5><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959007.png" alt="image-20240803101845892"></p><h4 id="é¦–é¡µ"><a href="#é¦–é¡µ" class="headerlink" title="é¦–é¡µ"></a>é¦–é¡µ</h4><h5 id="é¦–é¡µå‚è€ƒå¦‚ä¸‹"><a href="#é¦–é¡µå‚è€ƒå¦‚ä¸‹" class="headerlink" title="é¦–é¡µå‚è€ƒå¦‚ä¸‹"></a>é¦–é¡µå‚è€ƒå¦‚ä¸‹</h5><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959088.png" alt="image-20240726115403176"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959638.png" alt="image-20240803102018659"></p><blockquote><p>ç°åœ¨å‡è®¾ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„Vue3+ElementUIå¼€å‘è€…ï¼Œä¸”ä½ å¯¹ç¾å­¦æœ‰æ·±åˆ»çš„ç†è§£ï¼Œä½ ä¼šåˆ©ç”¨å‰ç«¯å¼€å‘å·¥å…·å¼€å‘å‡ºç®€çº¦ä¸”å…·æœ‰ç¾æ„Ÿçš„é¡µé¢ã€‚ç›¸å…³ä¾èµ–æˆ‘å·²ç»ä¸‹è½½è¿‡ï¼Œè¯·ä½ ç›´æ¥ç»™å‡ºé¡µé¢çš„vueä»£ç å³å¯ï¼æ‰€æœ‰çš„æ¨¡å—ï¼Œè¾“å…¥æ¡†ï¼ŒæŒ‰é’®ç­‰éƒ½è¯·ä½¿ç”¨åœ†è§’æ ·å¼ï¼Œå­—ä½“ä¸ºæ¥·ä½“ï¼Œå­—ä½“è¾ƒå¤§ï¼Œä¸”ä½ ç”Ÿæˆçš„æ‰€æœ‰ä»£ç éƒ½æ˜¯å±€åŸŸsetupè¯­æ³•ç³–ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§æˆ‘çš„æè¿°å’Œè¦æ±‚ç”Ÿæˆï¼ï¼ï¼ã€‚</p><p> è¯·ä½ å¸®æˆ‘å®ç°ä¸€ä¸ªåšå®¢æµè§ˆé¦–é¡µï¼Œè¯·ä½ æŒ‰ç…§ä¸‹é¢çš„è¦æ±‚å¸®æˆ‘ç”Ÿæˆé¡µé¢ä»£ç ï¼š 1ã€è¯¥é¦–é¡µé¦–å…ˆå…·æœ‰ä¸€ä¸ªå¯¼èˆªæ ï¼Œè¯¥å¯¼èˆªå…·æœ‰ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€æ¶ˆæ¯ã€å†å²ç­‰æ¨¡å—ï¼Œè¿™äº›æ¨¡å—çš„å­—ä½“éƒ½å¤„äºå¯¼èˆªæ çš„ä¸­é—´ï¼Œä¸”ç”¨æˆ·æµè§ˆå¾€ä¸‹ç¿»æ—¶ï¼Œè¯¥å¯¼èˆªæ ä¼šä¸€ç›´æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šæ–¹ï¼Œå¯¼èˆªæ å¯ä»¥è®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼› 2ã€åœ¨å¯¼èˆªæ çš„ä¸‹æ–¹å°±æ˜¯ä¸€ä¸ªæœç´¢è¾“å…¥æ¡†ï¼Œè¾“å…¥æ¡†åœ†è§’ï¼Œè¾“å…¥æ¡†çš„æœç´¢æŒ‰é’®å’Œè¾“å…¥æ¡†ä¸€ä½“ï¼Œä¸èƒ½æœ‰æ˜æ˜¾çš„åˆ†å‰²ï¼Œä¸”ç”¨æˆ·æµè§ˆå¾€ä¸‹ç¿»æ—¶ï¼Œå…¶æœç´¢æ¡†ä¼šä¸€ç›´æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šé¢è·Ÿéšè€…å¯¼èˆªæ ä¸€èµ·ï¼Œæœç´¢æŒ‰é’®è¯·è®¾ç½®æˆçº¢è‰²ï¼Œä¸­é—´æœ‰ä¸€ä¸ªæœç´¢çš„logoå›¾æ ‡ï¼› 3ã€ç„¶åä¸‹æ–¹å°±æ˜¯ä¸€ä¸ªdivï¼Œå…¶é»˜è®¤æŠ˜å ï¼Œåªä¼šæ˜¾ç¤ºä¸€è¡Œï¼Œè¿™ä¸»è¦æ˜¯æ”¾ç½®å„ç§åšå®¢çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼šåç«¯ã€å‰ç«¯ã€Javaç­‰ï¼Œå…¶ä¸­é—´æœ‰ä¸€ä¸ªå°å›¾æ ‡ï¼Œç‚¹å‡»ä¹‹åä¼šå±•å¼€æ‰€æœ‰çš„ç±»å‹ï¼Œè¿å…è®¸æˆ‘è®¾ç½®å›¾ç‰‡èƒŒæ™¯åœ¨è¿™ä¸ªdivï¼Œåœ†è§’ã€‚ ä¸Šé¢æ‰€æœ‰çš„éƒ½éœ€è¦æ˜¾ç¤ºåœ¨é¡µé¢ä¸­é—´ï¼Œè·ç¦»å·¦å³ä¸¤è¾¹æœ‰ä¸€å®šçš„è¾¹è·ï¼Œä¸å¤šä¹Ÿä¸å°‘ï¼Œä¸”æ ·å¼åº”è¯¥ç®€çº¦ä¸”å…·æœ‰ä¸€ç§ç¾å­¦çš„å¤§æ°”ã€‚</p></blockquote><h5 id="å¤´æ¡"><a href="#å¤´æ¡" class="headerlink" title="å¤´æ¡"></a>å¤´æ¡</h5><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959106.png" alt="image-20240803112433125"></p><h4 id="åšå®¢æ¨¡å—"><a href="#åšå®¢æ¨¡å—" class="headerlink" title="åšå®¢æ¨¡å—"></a>åšå®¢æ¨¡å—</h4><h5 id="åšå®¢ä¸Šä¼ "><a href="#åšå®¢ä¸Šä¼ " class="headerlink" title="åšå®¢ä¸Šä¼ "></a>åšå®¢ä¸Šä¼ </h5><blockquote><p>ç°åœ¨å‡è®¾ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„Vue3+ElementUIå¼€å‘è€…ï¼Œä¸”ä½ å¯¹ç¾å­¦æœ‰æ·±åˆ»çš„ç†è§£ï¼Œä½ ä¼šåˆ©ç”¨å‰ç«¯å¼€å‘å·¥å…·å¼€å‘å‡ºç®€çº¦ä¸”å…·æœ‰ç¾æ„Ÿçš„é¡µé¢ã€‚ç›¸å…³ä¾èµ–æˆ‘å·²ç»ä¸‹è½½è¿‡ï¼Œè¯·ä½ ç›´æ¥ç»™å‡ºé¡µé¢çš„vueä»£ç å³å¯ï¼æ‰€æœ‰çš„æ¨¡å—ï¼Œè¾“å…¥æ¡†ï¼ŒæŒ‰é’®ç­‰éƒ½è¯·ä½¿ç”¨åœ†è§’æ ·å¼ï¼Œå­—ä½“ä¸ºæ¥·ä½“ï¼Œå­—ä½“è¾ƒå¤§ï¼Œä¸”ä½ ç”Ÿæˆçš„æ‰€æœ‰ä»£ç éƒ½æ˜¯å±€åŸŸsetupè¯­æ³•ç³–ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§æˆ‘çš„æè¿°å’Œè¦æ±‚ç”Ÿæˆï¼ï¼ï¼ã€‚ </p><p>è¯·ä½ å¸®æˆ‘å®ç°ä¸€ä¸ªç”¨æˆ·åšå®¢ä¸Šä¼ åŠŸèƒ½ï¼Œç”¨æˆ·åªèƒ½ä¸Šä¼ mdæ ¼å¼çš„æ–‡ä»¶ï¼Œæ”¯æŒç”¨æˆ·æ‹–æ–‡ä»¶ä¸Šä¼ ã€‚ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ç¡®å®šä¹‹åï¼Œä½ éœ€è¦æå–è¿™ä¸ªmdæ–‡ä»¶ä¸­çš„æ‰€æœ‰å›¾ç‰‡ï¼Œå¹¶ä¸Šä¼ åç«¯æœåŠ¡å™¨ï¼Œå¹¶è·å–åˆ°åç«¯æœåŠ¡å™¨ä¿å­˜çš„åœ°å€ï¼Œç„¶åæ›¿æ¢ç°åœ¨çš„mdæ–‡ä»¶ä¸­çš„åœ°å€ï¼Œæ‰€æœ‰æ›¿æ¢å®Œæˆåå†å°†è¯¥åšå®¢ä¸Šä¼ åˆ°åç«¯æœåŠ¡å™¨ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container style=&quot;padding: 20px; font-family: æ¥·ä½“; font-size: larger;&quot;&gt;</span><br><span class="line">    &lt;el-header&gt;</span><br><span class="line">      &lt;h2&gt;ä¸Šä¼ åšå®¢&lt;/h2&gt;</span><br><span class="line">    &lt;/el-header&gt;</span><br><span class="line">    &lt;el-main&gt;</span><br><span class="line">      &lt;el-upload</span><br><span class="line">        drag</span><br><span class="line">        action=&quot;&quot;</span><br><span class="line">        :http-request=&quot;uploadMdFile&quot;</span><br><span class="line">        :accept=&quot;.md&quot;</span><br><span class="line">        :on-success=&quot;handleSuccess&quot;</span><br><span class="line">        :before-upload=&quot;beforeUpload&quot;</span><br><span class="line">        :on-remove=&quot;handleRemove&quot;</span><br><span class="line">        :show-file-list=&quot;false&quot;</span><br><span class="line">        style=&quot;border-radius: 15px;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;i class=&quot;el-icon-upload&quot; style=&quot;font-size: 48px;&quot;&gt;&lt;/i&gt;</span><br><span class="line">        &lt;div class=&quot;el-upload__text&quot;&gt;å°† Markdown æ–‡ä»¶æ‹–åˆ°è¿™é‡Œï¼Œæˆ–&lt;em&gt;ç‚¹å‡»ä¸Šä¼ &lt;/em&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/el-upload&gt;</span><br><span class="line">      &lt;el-button </span><br><span class="line">        v-if=&quot;file&quot; </span><br><span class="line">        type=&quot;primary&quot; </span><br><span class="line">        @click=&quot;uploadBlog&quot; </span><br><span class="line">        style=&quot;margin-top: 20px; border-radius: 10px;&quot;&gt;</span><br><span class="line">        ä¸Šä¼ åšå®¢</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">    &lt;/el-main&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; ElMessage &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line"></span><br><span class="line">const file = ref(null)</span><br><span class="line"></span><br><span class="line">const beforeUpload = (file) =&gt; &#123;</span><br><span class="line">  const isMarkdown = file.type === &#x27;text/markdown&#x27;</span><br><span class="line">  if (!isMarkdown) &#123;</span><br><span class="line">    ElMessage.error(&#x27;åªèƒ½ä¸Šä¼  Markdown æ–‡ä»¶!&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  return isMarkdown</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleSuccess = (response, file) =&gt; &#123;</span><br><span class="line">  ElMessage.success(&#x27;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ!&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleRemove = () =&gt; &#123;</span><br><span class="line">  file.value = null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const uploadMdFile = async (file) =&gt; &#123;</span><br><span class="line">  file.value = file.raw</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const uploadBlog = async () =&gt; &#123;</span><br><span class="line">  if (!file.value) return</span><br><span class="line">  </span><br><span class="line">  const reader = new FileReader()</span><br><span class="line">  reader.readAsText(file.value)</span><br><span class="line">  </span><br><span class="line">  reader.onload = async () =&gt; &#123;</span><br><span class="line">    let content = reader.result</span><br><span class="line">    </span><br><span class="line">    // æå–æ‰€æœ‰å›¾ç‰‡é“¾æ¥å¹¶ä¸Šä¼ </span><br><span class="line">    const imgRegex = /!\[.*?\]\((.*?)\)/g</span><br><span class="line">    let match</span><br><span class="line">    while ((match = imgRegex.exec(content)) !== null) &#123;</span><br><span class="line">      const imgUrl = match[1]</span><br><span class="line">      const imgData = await fetch(imgUrl).then(res =&gt; res.blob())</span><br><span class="line">      const formData = new FormData()</span><br><span class="line">      formData.append(&#x27;file&#x27;, imgData, &#x27;image.png&#x27;)</span><br><span class="line">      </span><br><span class="line">      // å‡è®¾ä½ çš„åç«¯å›¾ç‰‡ä¸Šä¼ æ¥å£æ˜¯ /upload/image</span><br><span class="line">      const response = await axios.post(&#x27;/upload/image&#x27;, formData)</span><br><span class="line">      const newImgUrl = response.data.url</span><br><span class="line">      </span><br><span class="line">      content = content.replace(imgUrl, newImgUrl)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ä¸Šä¼ æœ€ç»ˆçš„ Markdown æ–‡ä»¶</span><br><span class="line">    const blogFormData = new FormData()</span><br><span class="line">    const finalBlob = new Blob([content], &#123; type: &#x27;text/markdown&#x27; &#125;)</span><br><span class="line">    blogFormData.append(&#x27;file&#x27;, finalBlob, file.value.name)</span><br><span class="line">    </span><br><span class="line">    // å‡è®¾ä½ çš„åç«¯åšå®¢ä¸Šä¼ æ¥å£æ˜¯ /upload/blog</span><br><span class="line">    await axios.post(&#x27;/upload/blog&#x27;, blogFormData)</span><br><span class="line">    </span><br><span class="line">    ElMessage.success(&#x27;åšå®¢ä¸Šä¼ æˆåŠŸ!&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.el-upload &#123;</span><br><span class="line">  background: #f5f5f5;</span><br><span class="line">  border: 2px dashed #d9d9d9;</span><br><span class="line">  border-radius: 15px;</span><br><span class="line">  padding: 40px 20px;</span><br><span class="line">  text-align: center;</span><br><span class="line">  transition: border-color 0.3s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-upload:hover &#123;</span><br><span class="line">  border-color: #409eff;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ç‰ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container style=&quot;padding: 20px; font-family: æ¥·ä½“,serif; font-size: larger;&quot;&gt;</span><br><span class="line">    &lt;el-header&gt;</span><br><span class="line">      &lt;h2&gt;ä¸Šä¼ åšå®¢&lt;/h2&gt;</span><br><span class="line">    &lt;/el-header&gt;</span><br><span class="line">    &lt;el-main&gt;</span><br><span class="line">      &lt;el-upload</span><br><span class="line">          drag</span><br><span class="line">          :headers=&quot;upload.headers&quot;</span><br><span class="line">          :action=&quot;upload.url&quot;</span><br><span class="line">          accept=&quot;.md&quot;</span><br><span class="line">          :on-success=&quot;handleSuccess&quot;</span><br><span class="line">          :before-upload=&quot;beforeUpload&quot;</span><br><span class="line">          auto-upload:false</span><br><span class="line">          :show-file-list=&quot;true&quot;</span><br><span class="line">          style=&quot;border-radius: 15px;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;i class=&quot;el-icon-upload&quot; style=&quot;font-size: 48px;&quot;&gt;&lt;/i&gt;</span><br><span class="line">        &lt;div class=&quot;el-upload__text&quot;&gt;å°† Markdown æ–‡ä»¶æ‹–åˆ°è¿™é‡Œï¼Œæˆ–&lt;em&gt;ç‚¹å‡»ä¸Šä¼ &lt;/em&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/el-upload&gt;</span><br><span class="line">    &lt;/el-main&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">// import &#123; ElMessage &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line"></span><br><span class="line">const file = ref(null)</span><br><span class="line"></span><br><span class="line">const upload = (&#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    Authorization: &quot;Bearer &quot;,</span><br><span class="line">    &#x27;Access-Control-Allow-Origin&#x27;: &#x27;*&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  url: &#x27;/screw/api/blog/addBlogMDFile1&#x27;,  // åœ°å€,ä»¥aaaæ‰“å¤´</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const beforeUpload = (file) =&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  const allowedTypes = [&#x27;.md&#x27;];</span><br><span class="line">  const fileType = file.name.split(&#x27;.&#x27;).pop().toLowerCase();</span><br><span class="line">  if (!allowedTypes.includes(&#x27;.&#x27; + fileType)) &#123;</span><br><span class="line">    ElMessage.error(&#x27;åªèƒ½ä¸Šä¼ .mdæ ¼å¼çš„æ–‡ä»¶ï¼&#x27;);</span><br><span class="line">    return false; // é˜»æ­¢ä¸Šä¼ </span><br><span class="line">  &#125;</span><br><span class="line">  console.log(&quot;æ ¼å¼ç¬¦åˆ&quot;)</span><br><span class="line"></span><br><span class="line">  if (!file.name) return</span><br><span class="line">  console.log(file.name)</span><br><span class="line"></span><br><span class="line">  const reader = new FileReader()</span><br><span class="line">  reader.readAsText(file)</span><br><span class="line"></span><br><span class="line">  reader.onload = async () =&gt; &#123;</span><br><span class="line">    let content = reader.result</span><br><span class="line"></span><br><span class="line">    // æå–æ‰€æœ‰å›¾ç‰‡é“¾æ¥å¹¶ä¸Šä¼ </span><br><span class="line">    const imgRegex = /!\[.*?\]\((.*?)\)/g</span><br><span class="line">    let match</span><br><span class="line">    while ((match = imgRegex.exec(content)) !== null) &#123;</span><br><span class="line">      const imgUrl = match[1]</span><br><span class="line">      console.log(imgUrl)</span><br><span class="line">      // const imgData = await fetch(imgUrl).then(res =&gt; res.blob())</span><br><span class="line">      // const formData = new FormData()</span><br><span class="line">      // formData.append(&#x27;file&#x27;, imgData, &#x27;image.png&#x27;)</span><br><span class="line"></span><br><span class="line">      // å‡è®¾ä½ çš„åç«¯å›¾ç‰‡ä¸Šä¼ æ¥å£æ˜¯ /upload/image</span><br><span class="line">      // const response = await axios.post(&#x27;/upload/image&#x27;, formData)</span><br><span class="line">      // const newImgUrl = response.data.url</span><br><span class="line"></span><br><span class="line">      // content = content.replace(imgUrl, newImgUrl)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ä¸Šä¼ æœ€ç»ˆçš„ Markdown æ–‡ä»¶</span><br><span class="line">    const blogFormData = new FormData()</span><br><span class="line">    const finalBlob = new Blob([content], &#123;type: &#x27;text/markdown&#x27;&#125;)</span><br><span class="line">    blogFormData.append(&#x27;file&#x27;, finalBlob, file.value.name)</span><br><span class="line"></span><br><span class="line">    // å‡è®¾ä½ çš„åç«¯åšå®¢ä¸Šä¼ æ¥å£æ˜¯ /upload/blog</span><br><span class="line">    // await axios.post(&#x27;/upload/blog&#x27;, blogFormData)</span><br><span class="line"></span><br><span class="line">    console.log(&#x27;åšå®¢ä¸Šä¼ æˆåŠŸ!&#x27;)</span><br><span class="line"></span><br><span class="line">    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šçš„æ–‡ä»¶æ£€æŸ¥é€»è¾‘</span><br><span class="line">    return true; // å…è®¸ä¸Šä¼ </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleSuccess = (response, file) =&gt; &#123;</span><br><span class="line">  ElMessage.success(&#x27;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ!&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleRemove = () =&gt; &#123;</span><br><span class="line">  file.value = null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const uploadMdFile = async (file) =&gt; &#123;</span><br><span class="line">  file.value = file.raw</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function readFileFirefox(fileBrowser) &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  catch (e) &#123;</span><br><span class="line">    alert(&#x27;æ— æ³•è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼Œç”±äºæµè§ˆå™¨å®‰å…¨è®¾ç½®ã€‚ä¸ºäº†å…‹æœè¿™ä¸€ç‚¹ï¼Œè¯·æŒ‰ç…§ä¸‹åˆ—æ­¥éª¤æ“ä½œï¼š(1)åœ¨åœ°å€æ è¾“å…¥&quot;about:config&quot;;(2) å³é”®ç‚¹å‡»å¹¶é€‰æ‹© New-&gt;Boolean; (3) è¾“å…¥&quot;signed.applets.codebase_principal_support&quot; ï¼ˆä¸å«å¼•å·ï¼‰ä½œä¸ºä¸€ä¸ªæ–°çš„é¦–é€‰é¡¹çš„åç§°;(4) ç‚¹å‡»OKå¹¶è¯•ç€é‡æ–°åŠ è½½æ–‡ä»¶&#x27;);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  var fileName=fileBrowser.value; //è¿™ä¸€æ­¥å°±èƒ½å¾—åˆ°å®¢æˆ·ç«¯å®Œæ•´è·¯å¾„ã€‚ä¸‹é¢çš„æ˜¯å¦åˆ¤æ–­çš„å¤ªå¤æ‚ï¼Œè¿˜æœ‰ä¸‹é¢å¾—åˆ°ieçš„ä¹Ÿå¾ˆå¤æ‚ã€‚</span><br><span class="line">  var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span><br><span class="line">      .createInstance(Components.interfaces.nsILocalFile);</span><br><span class="line">  try &#123;</span><br><span class="line">    // Back slashes for windows</span><br><span class="line">    file.initWithPath( fileName.replace(/\//g, &quot;\\\\&quot;) );</span><br><span class="line">  &#125;</span><br><span class="line">  catch(e) &#123;</span><br><span class="line">    if (e.result!=Components.results.NS_ERROR_FILE_UNRECOGNIZED_PATH) throw e;</span><br><span class="line">    alert(&quot;File &#x27;&quot; + fileName + &quot;&#x27; cannot be loaded: relative paths are not allowed. Please provide an absolute path to this file.&quot;);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  if ( file.exists() == false ) &#123;</span><br><span class="line">    alert(&quot;File &#x27;&quot; + fileName + &quot;&#x27; not found.&quot;);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  return file.path;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.el-upload &#123;</span><br><span class="line">  background: #f5f5f5;</span><br><span class="line">  border: 2px dashed #d9d9d9;</span><br><span class="line">  border-radius: 15px;</span><br><span class="line">  padding: 40px 20px;</span><br><span class="line">  text-align: center;</span><br><span class="line">  transition: border-color 0.3s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-upload:hover &#123;</span><br><span class="line">  border-color: #409eff;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="è¯»å–æœ¬åœ°æ–‡ä»¶è·¯å¾„ä»£ç "><a href="#è¯»å–æœ¬åœ°æ–‡ä»¶è·¯å¾„ä»£ç " class="headerlink" title="è¯»å–æœ¬åœ°æ–‡ä»¶è·¯å¾„ä»£ç "></a>è¯»å–æœ¬åœ°æ–‡ä»¶è·¯å¾„ä»£ç </h5><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/u011250186/article/details/122387755">html5åŠ jså®ç°æœ¬åœ°æ–‡ä»¶è¯»å–å’Œå†™å…¥å¹¶è·å–æœ¬åœ°æ–‡ä»¶è·¯å¾„</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//FXè·å–æ–‡ä»¶è·¯å¾„æ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">readFileFirefox</span>(<span class="params">fileBrowser</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            netscape.<span class="property">security</span>.<span class="property">PrivilegeManager</span>.<span class="title function_">enablePrivilege</span>(<span class="string">&quot;UniversalXPConnect&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;æ— æ³•è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼Œç”±äºæµè§ˆå™¨å®‰å…¨è®¾ç½®ã€‚ä¸ºäº†å…‹æœè¿™ä¸€ç‚¹ï¼Œè¯·æŒ‰ç…§ä¸‹åˆ—æ­¥éª¤æ“ä½œï¼š(1)åœ¨åœ°å€æ è¾“å…¥&quot;about:config&quot;;(2) å³é”®ç‚¹å‡»å¹¶é€‰æ‹© New-&gt;Boolean; (3) è¾“å…¥&quot;signed.applets.codebase_principal_support&quot; ï¼ˆä¸å«å¼•å·ï¼‰ä½œä¸ºä¸€ä¸ªæ–°çš„é¦–é€‰é¡¹çš„åç§°;(4) ç‚¹å‡»OKå¹¶è¯•ç€é‡æ–°åŠ è½½æ–‡ä»¶&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> fileName=fileBrowser.<span class="property">value</span>; <span class="comment">//è¿™ä¸€æ­¥å°±èƒ½å¾—åˆ°å®¢æˆ·ç«¯å®Œæ•´è·¯å¾„ã€‚ä¸‹é¢çš„æ˜¯å¦åˆ¤æ–­çš„å¤ªå¤æ‚ï¼Œè¿˜æœ‰ä¸‹é¢å¾—åˆ°ieçš„ä¹Ÿå¾ˆå¤æ‚ã€‚</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> file = <span class="title class_">Components</span>.<span class="property">classes</span>[<span class="string">&quot;@mozilla.org/file/local;1&quot;</span>]</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">createInstance</span>(<span class="title class_">Components</span>.<span class="property">interfaces</span>.<span class="property">nsILocalFile</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// Back slashes for windows</span></span></span><br><span class="line"><span class="language-javascript">            file.<span class="title function_">initWithPath</span>( fileName.<span class="title function_">replace</span>(<span class="regexp">/\//g</span>, <span class="string">&quot;\\\\&quot;</span>) );</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">catch</span>(e) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (e.<span class="property">result</span>!=<span class="title class_">Components</span>.<span class="property">results</span>.<span class="property">NS_ERROR_FILE_UNRECOGNIZED_PATH</span>) <span class="keyword">throw</span> e;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;File &#x27;&quot;</span> + fileName + <span class="string">&quot;&#x27; cannot be loaded: relative paths are not allowed. Please provide an absolute path to this file.&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> ( file.<span class="title function_">exists</span>() == <span class="literal">false</span> ) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;File &#x27;&quot;</span> + fileName + <span class="string">&quot;&#x27; not found.&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> file.<span class="property">path</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//æ ¹æ®ä¸åŒæµè§ˆå™¨è·å–è·¯å¾„</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">getvl</span>(<span class="params">obj</span>)&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="comment">//åˆ¤æ–­æµè§ˆå™¨</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> <span class="title class_">Sys</span> = &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> ua = navigator.<span class="property">userAgent</span>.<span class="title function_">toLowerCase</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> s;</span></span><br><span class="line"><span class="language-javascript">        (s = ua.<span class="title function_">match</span>(<span class="regexp">/msie ([\d.]+)/</span>)) ? <span class="title class_">Sys</span>.<span class="property">ie</span> = s[<span class="number">1</span>] :</span></span><br><span class="line"><span class="language-javascript">            (s = ua.<span class="title function_">match</span>(<span class="regexp">/firefox\/([\d.]+)/</span>)) ? <span class="title class_">Sys</span>.<span class="property">firefox</span> = s[<span class="number">1</span>] :</span></span><br><span class="line"><span class="language-javascript">                (s = ua.<span class="title function_">match</span>(<span class="regexp">/chrome\/([\d.]+)/</span>)) ? <span class="title class_">Sys</span>.<span class="property">chrome</span> = s[<span class="number">1</span>] :</span></span><br><span class="line"><span class="language-javascript">                    (s = ua.<span class="title function_">match</span>(<span class="regexp">/opera.([\d.]+)/</span>)) ? <span class="title class_">Sys</span>.<span class="property">opera</span> = s[<span class="number">1</span>] :</span></span><br><span class="line"><span class="language-javascript">                        (s = ua.<span class="title function_">match</span>(<span class="regexp">/version\/([\d.]+).*safari/</span>)) ? <span class="title class_">Sys</span>.<span class="property">safari</span> = s[<span class="number">1</span>] : <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> file_url=<span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span>(<span class="title class_">Sys</span>.<span class="property">ie</span>&lt;=<span class="string">&quot;6.0&quot;</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//ie5.5,ie6.0</span></span></span><br><span class="line"><span class="language-javascript">            file_url = obj.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="title class_">Sys</span>.<span class="property">ie</span>&gt;=<span class="string">&quot;7.0&quot;</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//ie7,ie8</span></span></span><br><span class="line"><span class="language-javascript">            obj.<span class="title function_">select</span>();</span></span><br><span class="line"><span class="language-javascript">            file_url = <span class="variable language_">document</span>.<span class="property">selection</span>.<span class="title function_">createRange</span>().<span class="property">text</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="title class_">Sys</span>.<span class="property">firefox</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//fx</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//file_url = document.getElementById(&quot;file&quot;).files[0].getAsDataURL();//è·å–çš„è·¯å¾„ä¸ºFFè¯†åˆ«çš„åŠ å¯†å­—ç¬¦ä¸²</span></span></span><br><span class="line"><span class="language-javascript">            file_url = <span class="title function_">readFileFirefox</span>(obj);</span></span><br><span class="line"><span class="language-javascript">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="title class_">Sys</span>.<span class="property">chrome</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            file_url = obj.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//alert(file_url);</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;text&quot;</span>).<span class="property">innerHTML</span>=<span class="string">&quot;è·å–æ–‡ä»¶åŸŸå®Œæ•´è·¯å¾„ä¸ºï¼š&quot;</span>+file_url;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>JSè·å–æ–‡ä»¶åŸŸå®Œæ•´è·¯å¾„çš„æ–¹æ³•ï¼Œå…¼å®¹ä¸åŒæµè§ˆå™¨<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:#f00;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;getvl(this)&quot;</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="åšå®¢é˜…è¯»"><a href="#åšå®¢é˜…è¯»" class="headerlink" title="åšå®¢é˜…è¯»"></a>åšå®¢é˜…è¯»</h5><p>å‚è€ƒè®¾è®¡</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959533.png" alt="image-20240805100336400"></p><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ol><li><a href="https://blog.csdn.net/Kiruthika/article/details/124974833">vueé¡¹ç›®å›¾ç‰‡æ»‘åŠ¨éªŒè¯ç  å‰ç«¯+åç«¯éªŒè¯</a></li></ol><h3 id="äºŒæ¬¡å°è£…"><a href="#äºŒæ¬¡å°è£…" class="headerlink" title="äºŒæ¬¡å°è£…"></a>äºŒæ¬¡å°è£…</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/Vivien_CC/article/details/127507545">vueä¸­axiosçš„äºŒæ¬¡å°è£…â€”â€”vue å°è£…axiosè¯¦ç»†æ­¥éª¤</a></p><p>apiç»Ÿä¸€ç®¡ç†ï¼Œä¸ç®¡æ¥å£æœ‰å¤šå°‘ï¼Œæ‰€æœ‰çš„æ¥å£éƒ½å¯ä»¥éå¸¸æ¸…æ™°ï¼Œå®¹æ˜“ç»´æŠ¤ã€‚</p><p>é€šå¸¸æˆ‘ä»¬çš„é¡¹ç›®ä¼šè¶Šåšè¶Šå¤§ï¼Œé¡µé¢ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œå¦‚æœé¡µé¢éå¸¸çš„å°‘ï¼Œç›´æ¥ç”¨axiosä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§çš„å½±å“ï¼Œé‚£é¡µé¢ç»„ä»¶å¤šäº†èµ·æ¥ï¼Œä¸Šç™¾ä¸ªæ¥å£å‘¢ï¼Œè¿™ä¸ªæ—¶å€™åç«¯æ”¹äº†æ¥å£ï¼Œå¤šåŠ äº†ä¸€ä¸ªå‚æ•°ä»€ä¹ˆçš„å‘¢ï¼Ÿé‚£å°±åªæœ‰æ‰¾åˆ°é‚£ä¸ªé¡µé¢ï¼Œè¿›å»ä¿®æ”¹ï¼Œæ•´ä¸ªè¿‡ç¨‹å¾ˆç¹çï¼Œä¸æ˜“äºé¡¹ç›®çš„ç»´æŠ¤å’Œè¿­ä»£ã€‚</p><p>è¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬ç»Ÿä¸€çš„åŒºç®¡ç†æ¥å£ï¼Œéœ€è¦ä¿®æ”¹æŸä¸€ä¸ªæ¥å£çš„æ—¶å€™ç›´æ¥åœ¨apié‡Œä¿®æ”¹å¯¹åº”çš„è¯·æ±‚ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬ç”¨çš„æœ€å¤šçš„è¿˜æ˜¯get postè¯·æ±‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹å°è£…ã€‚</p><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><table><thead><tr><th><code>width</code></th><th><code>100px</code>, <code>50%</code>, <code>auto</code> - å…ƒç´ çš„å®½åº¦ï¼Œå¯ä»¥æ˜¯å…·ä½“æ•°å€¼ã€ç™¾åˆ†æ¯”æˆ–è‡ªåŠ¨ã€‚</th></tr></thead><tbody><tr><td><code>height</code></td><td><code>200px</code>, <code>30%</code>, <code>auto</code> - å…ƒç´ çš„é«˜åº¦ï¼Œå¯ä»¥æ˜¯å…·ä½“æ•°å€¼ã€ç™¾åˆ†æ¯”æˆ–è‡ªåŠ¨ã€‚</td></tr><tr><td><code>margin</code></td><td><code>10px</code>, <code>5%</code>, <code>10px 20px</code> - å…ƒç´ çš„å¤–è¾¹è·ï¼Œå¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–å¤šä¸ªå€¼ã€‚</td></tr><tr><td><code>padding</code></td><td><code>5px</code>, <code>2%</code>, <code>10px 5px 2px 8px</code> - å…ƒç´ çš„å†…è¾¹è·ï¼Œå¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–å¤šä¸ªå€¼ã€‚</td></tr><tr><td><code>border</code></td><td><code>1px solid black</code> - å…ƒç´ è¾¹æ¡†çš„å®½åº¦ã€æ ·å¼å’Œé¢œè‰²ã€‚</td></tr><tr><td><code>border-radius</code></td><td><code>5px</code>, <code>50%</code> - å…ƒç´ è¾¹æ¡†çš„åœ†è§’åŠå¾„ï¼Œå¯ä»¥æ˜¯å…·ä½“æ•°å€¼æˆ–ç™¾åˆ†æ¯”ã€‚</td></tr><tr><td><code>background</code></td><td><code>#f0f0f0</code>, <code>url(image.jpg)</code> - å…ƒç´ èƒŒæ™¯çš„é¢œè‰²æˆ–å›¾åƒã€‚</td></tr><tr><td><code>color</code></td><td><code>red</code>, <code>#ff0000</code>, <code>rgb(255, 0, 0)</code> - æ–‡æœ¬é¢œè‰²ã€‚</td></tr><tr><td><code>font-size</code></td><td><code>16px</code>, <code>1.5em</code> - å­—ä½“å¤§å°ã€‚</td></tr><tr><td><code>font-family</code></td><td><code>Arial, sans-serif</code> - å­—ä½“æ—ã€‚</td></tr><tr><td><code>line-height</code></td><td><code>1.5</code>, <code>20px</code> - è¡Œé«˜ï¼Œå¯ä»¥æ˜¯æ•°å­—æˆ–å…·ä½“æ•°å€¼ã€‚</td></tr><tr><td><code>text-align</code></td><td><code>left</code>, <code>right</code>, <code>center</code>, <code>justify</code> - æ–‡æœ¬å¯¹é½æ–¹å¼ã€‚</td></tr><tr><td><code>display</code></td><td><code>block</code>, <code>inline</code>, <code>flex</code>, <code>none</code> - å…ƒç´ çš„æ˜¾ç¤ºç±»å‹ã€‚</td></tr><tr><td><code>position</code></td><td><code>static</code>, <code>relative</code>, <code>absolute</code>, <code>fixed</code> - å…ƒç´ çš„å®šä½æ–¹å¼ã€‚</td></tr><tr><td><code>top</code>, <code>right</code>, <code>bottom</code>, <code>left</code></td><td>ä¸<code>position</code>å±æ€§é…åˆä½¿ç”¨ï¼Œå®šä¹‰å…ƒç´ çš„ä½ç½®ã€‚</td></tr><tr><td><code>z-index</code></td><td><code>10</code>, <code>100</code> - å…ƒç´ çš„å †å é¡ºåºã€‚</td></tr><tr><td><code>opacity</code></td><td><code>0.5</code> - å…ƒç´ çš„é€æ˜åº¦ï¼Œ0å®Œå…¨é€æ˜ï¼Œ1å®Œå…¨ä¸é€æ˜ã€‚</td></tr><tr><td><code>overflow</code></td><td><code>visible</code>, <code>hidden</code>, <code>scroll</code> - å…ƒç´ å†…å®¹æº¢å‡ºæ—¶çš„å¤„ç†æ–¹å¼ã€‚</td></tr><tr><td><code>cursor</code></td><td><code>pointer</code>, <code>default</code>, <code>none</code> - é¼ æ ‡æŒ‡é’ˆåœ¨å…ƒç´ ä¸Šçš„å½¢çŠ¶ã€‚</td></tr><tr><td><code>box-shadow</code></td><td><code>10px 10px 5px grey</code> - å…ƒç´ çš„é˜´å½±æ•ˆæœã€‚</td></tr><tr><td><code>text-shadow</code></td><td><code>2px 2px 2px grey</code> - æ–‡æœ¬çš„é˜´å½±æ•ˆæœã€‚</td></tr><tr><td><code>transition</code></td><td><code>all 0.3s ease</code> - å±æ€§å€¼å˜åŒ–æ—¶çš„è¿‡æ¸¡æ•ˆæœã€‚</td></tr><tr><td><code>transform</code></td><td><code>rotate(45deg)</code>, <code>scale(1.5)</code> - å…ƒç´ çš„å˜æ¢æ•ˆæœã€‚</td></tr></tbody></table><h2 id="åç«¯è®¾è®¡"><a href="#åç«¯è®¾è®¡" class="headerlink" title="åç«¯è®¾è®¡"></a>åç«¯è®¾è®¡</h2><h3 id="1-0ç‰ˆ"><a href="#1-0ç‰ˆ" class="headerlink" title="1.0ç‰ˆ"></a>1.0ç‰ˆ</h3><p>å…³äºåç«¯æœåŠ¡åˆ’åˆ†å¤§æ¦‚ä¼šåˆ’åˆ†ä¸ºï¼šç”¨æˆ·æœåŠ¡ã€åšå®¢æœåŠ¡ã€‚</p><p>ç”¨æˆ·æœåŠ¡ï¼šåœ¨è¯¥ç‰ˆæœ¬ä¸­ä¸»è¦å®ç°ç”¨æˆ·ç™»å½•ï¼Œç”¨æˆ·æ³¨å†Œã€ç”¨æˆ·ä¿®æ”¹å¯†ç ã€ç”¨æˆ·å…³æ³¨åˆ—è¡¨ã€æƒé™ç®¡ç†ã€VIPç”¨æˆ·ã€ç­‰ã€‚</p><p>åšå®¢æœåŠ¡ï¼šåšå®¢å‘è¡¨ã€åšå®¢æµè§ˆã€åšå®¢æŸ¥çœ‹ã€VIPåšå®¢ã€ä»˜è´¹åšå®¢ç»Ÿä¸€ç®¡ç†ã€åšå®¢æœç´¢ã€</p><h3 id="åŠŸèƒ½è®¾è®¡"><a href="#åŠŸèƒ½è®¾è®¡" class="headerlink" title="åŠŸèƒ½è®¾è®¡"></a>åŠŸèƒ½è®¾è®¡</h3><h2 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h2><h3 id="1-0"><a href="#1-0" class="headerlink" title="1.0"></a>1.0</h3><h4 id="ç”¨æˆ·è¡¨è®¾è®¡"><a href="#ç”¨æˆ·è¡¨è®¾è®¡" class="headerlink" title="ç”¨æˆ·è¡¨è®¾è®¡"></a>ç”¨æˆ·è¡¨è®¾è®¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h4 id="è¯„è®ºè¡¨"><a href="#è¯„è®ºè¡¨" class="headerlink" title="è¯„è®ºè¡¨"></a>è¯„è®ºè¡¨</h4><h4 id="åšå®¢è¡¨"><a href="#åšå®¢è¡¨" class="headerlink" title="åšå®¢è¡¨"></a>åšå®¢è¡¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PUT /blogs</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 1,</span><br><span class="line">    &quot;number_of_replicas&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;id&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;,</span><br><span class="line">      &quot;title&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;,</span><br><span class="line">      &quot;content&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;,</span><br><span class="line">      &quot;summary&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;,</span><br><span class="line">      &quot;author&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;,</span><br><span class="line">      &quot;create_time&quot;: &#123; &quot;type&quot;: &quot;date&quot;,&quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot; &#125;,</span><br><span class="line">      &quot;update_time&quot;: &#123; &quot;type&quot;: &quot;date&quot;,&quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot; &#125;,</span><br><span class="line">      &quot;views&quot;: &#123; &quot;type&quot;: &quot;integer&quot; &#125;,</span><br><span class="line">      &quot;likes&quot;: &#123; &quot;type&quot;: &quot;integer&quot; &#125;,</span><br><span class="line">      &quot;comments_count&quot;: &#123; &quot;type&quot;: &quot;integer&quot; &#125;,</span><br><span class="line">      &quot;tags&quot;: &#123; &quot;type&quot;: &quot;integer&quot;,&quot;index&quot;: true &#125;,</span><br><span class="line">      &quot;category&quot;: &#123; &quot;type&quot;: &quot;integer&quot;,&quot;index&quot;: true &#125;,</span><br><span class="line">      &quot;status&quot;: &#123; &quot;type&quot;: &quot;integer&quot; &#125;,</span><br><span class="line">      &quot;images&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;,</span><br><span class="line">      &quot;attachments&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;,</span><br><span class="line">      &quot;access_control&quot;: &#123; &quot;type&quot;: &quot;integer&quot;,&quot;index&quot;: true &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Minio"><a href="#Minio" class="headerlink" title="Minio"></a>Minio</h3><h2 id="åŠŸèƒ½æ¨¡å—è®¾è®¡"><a href="#åŠŸèƒ½æ¨¡å—è®¾è®¡" class="headerlink" title="åŠŸèƒ½æ¨¡å—è®¾è®¡"></a>åŠŸèƒ½æ¨¡å—è®¾è®¡</h2><h3 id="å³æ—¶é€šä¿¡äº¤æµæ¨¡å—"><a href="#å³æ—¶é€šä¿¡äº¤æµæ¨¡å—" class="headerlink" title="å³æ—¶é€šä¿¡äº¤æµæ¨¡å—"></a>å³æ—¶é€šä¿¡äº¤æµæ¨¡å—</h3><h4 id="å‚è€ƒèµ„æ–™-1"><a href="#å‚è€ƒèµ„æ–™-1" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li><a href="https://blog.csdn.net/zhizhengguan/article/details/121600366?ops_request_misc=%257B%2522request%255Fid%2522%253A%25226079B66A-5D06-438D-8C92-D1283E96C0E1%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=6079B66A-5D06-438D-8C92-D1283E96C0E1&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-121600366-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=%E6%B6%88%E6%81%AF%E6%94%B6%E5%8F%91%E6%9E%B6%E6%9E%84&spm=1018.2226.3001.4187">å³æ—¶æ¶ˆæ¯ï¼šæ¶ˆæ¯æ”¶å‘æ¶æ„</a></li><li><a href="https://blog.csdn.net/m0_68103666/article/details/141359336?ops_request_misc=&request_id=&biz_id=102&utm_term=Java%20IM%E6%9C%8D%E5%8A%A1%E5%99%A8&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-141359336.142%5Ev100%5Epc_search_result_base2&spm=1018.2226.3001.4187">æ¨èä¸€æ¬¾ Java å¼€å‘çš„å³æ—¶é€šè®¯ç³»ç»Ÿï¼Œè½»é‡ã€é«˜æ€§èƒ½ã€å•æœºæ”¯æŒå‡ åä¸‡è‡³ç™¾ä¸‡åœ¨çº¿ç”¨æˆ·ï¼ˆé™„æºç ï¼‰</a></li><li><a href="https://blog.csdn.net/qq_41698074/article/details/113741753#:~:text=%E5%89%8D%E8%A8%80%20%E6%9C%80%E8%BF%91%E5%9C%A8%E5%81%9A%E4%B8%80%E4%B8%AA%E8%81%8A#:~:text=%E5%89%8D%E8%A8%80%20%E6%9C%80%E8%BF%91%E5%9C%A8%E5%81%9A%E4%B8%80%E4%B8%AA%E8%81%8A">SpringBoot + Vue å®ç°åŸºäº WebSocket çš„èŠå¤©å®¤(å•èŠ)</a></li><li><a href="https://github.com/zhangjiwei1221/blog/blob/master/chat/chat-back/src/main/java/cn/zjw/chatback/websocket/WebSocketServer.java">https://github.com/zhangjiwei1221/blog/blob/master/chat/chat-back/src/main/java/cn/zjw/chatback/websocket/WebSocketServer.java</a></li><li></li></ul><h4 id="æ•°æ®åº“è®¾è®¡-1"><a href="#æ•°æ®åº“è®¾è®¡-1" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959662.png" alt="image-20240806145003799"></p><p>å¦‚æœæœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯ç»™è¯¥æ¥æ”¶æ–¹æ—¶ã€‚è¯¥æ¶ˆæ¯ä¼šè¢«ä¿å­˜åˆ°Redisä¸­ï¼Œä»¥æ¥æ”¶æ–¹userIdä½œä¸ºKeyã€‚å¹¶è®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å³æ¯ååˆ†é’Ÿï¼ˆä¸¾ä¾‹å­ï¼‰è¯»Redisä¸­çš„å†…å®¹å¹¶ä¿å­˜åˆ°MySQLä¸­ï¼Œç„¶åæ¸…é™¤Redisä¸­å¯¹åº”çš„æ¶ˆæ¯å†…å®¹ã€‚</p><p>å¯¹äºæ¯ä¸ªç”¨æˆ·è®¾ç½®ä¸¤ä¸ªç¼“å­˜åŒºï¼Œä¸€ä¸ªæ˜¯æ–°æ¶ˆæ¯åŒºã€ä¸€ä¸ªæ˜¯å†å²æ¶ˆæ¯åŒºå’Œä¸€ä¸ªä¼šè¯åŒºã€‚å¦‚æœç”¨æˆ·æœ‰æ–°æ¶ˆæ¯ï¼Œå°±ä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯ä¿å­˜åˆ°Redisç¼“å­˜çš„æ–°æ¶ˆæ¯åŒºã€‚</p><p>å½“ç”¨æˆ·ç™»å½•ä¹‹åï¼Œå°±ä¼šå¼€å§‹æ¶ˆæ¯åˆå§‹åŒ–æ“ä½œï¼Œå…ˆæŸ¥çœ‹</p><p>æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸¤ä¸ªè¡¨ï¼šä¼šè¯è¡¨&amp;æ¶ˆæ¯è®°å½•è¡¨ï¼›ä¼šè¯è¡¨ä¿å­˜ç”¨æˆ·å½“å‰é¡µé¢ä¸Šç»´æŒçš„ä¼šè¯ï¼Œå­—æ®µå¤§æ¦‚å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user_conversation:</span><br><span class="line">id: ä¼šè¯ID</span><br><span class="line">send_user_id: ä¼šè¯å‘é€æ–¹</span><br><span class="line">current_id: ä¼šè¯æ‹¥æœ‰æ–¹</span><br><span class="line">not_read_num: æœªè¯»æ¶ˆæ¯æ•°ç›®</span><br><span class="line">last_message: ä¼šè¯æœ€åä¸€æ¡æ¶ˆæ¯å†…å®¹</span><br><span class="line">last_message_time: æœ€åä¸€æ¡æ¶ˆæ¯å‘é€æ—¶é—´</span><br><span class="line">del_flag: æ˜¯å¦åˆ é™¤</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">message_history:</span><br><span class="line">idï¼šæ¶ˆæ¯ID</span><br><span class="line">conversation_id:ä¼šè¯ID</span><br><span class="line">send_user_id:æ¶ˆæ¯å‘é€æ–¹ID</span><br><span class="line">revice_user_id:æ¶ˆæ¯æ¥æ”¶æ–¹ID</span><br><span class="line">messageï¼šå…·ä½“æ¶ˆæ¯</span><br><span class="line">send_time:æ¶ˆæ¯å‘é€æ—¶é—´</span><br><span class="line">message_type:æ¶ˆæ¯ç±»å‹ï¼š1-æ–‡å­—ã€2-å›¾ç‰‡ã€3-æ–‡ä»¶ã€4-å…¶å®ƒ</span><br></pre></td></tr></table></figure><h4 id="æŠ€æœ¯æ–¹æ¡ˆ"><a href="#æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="æŠ€æœ¯æ–¹æ¡ˆ"></a>æŠ€æœ¯æ–¹æ¡ˆ</h4><p>ç›®å‰è®¡åˆ’ä½¿ç”¨WebSocketæ¥å®ç°å³æ—¶é€šä¿¡è¿™ä¸€é¡¹åŠŸèƒ½ï¼Œè®¡åˆ’é‡‡ç”¨Redisã€MySQLåšæŒä¹…åŒ–å¤„ç†ï¼Œå‰ç«¯å¢åŠ ä¸€ä¸ªæ¶ˆæ¯æ¨¡å—ï¼Œå‰ç«¯é¡µé¢è®¾è®¡ä»githubä¸Šè·å–ï¼Œæ— éœ€å¤šå¥½çœ‹ï¼Œèƒ½ç”¨å°±è¡Œï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ï¼Œæˆ‘ä»¬é‡ç‚¹éœ€è¦æŠŠè¿™ä¸ªå³æ—¶é€šä¿¡å¼„å¥½ã€‚</p><p>å…³äºæ•°æ®åº“è¯¥å¦‚ä½•è®¾è®¡ï¼Œå…¶ä¸­æ¶‰åŠåˆ°å¾ˆå¤šæŠ€æœ¯ç»†èŠ‚ï¼Œåç»­å†è¯¦ç»†çš„ç»™å‡ºã€‚</p><p>å…³äºå‘é€çš„æ¶ˆæ¯æŒä¹…åŒ–è¿™ä¸€æ­¥å…¶ä¸­å¯èƒ½ä¼šé‡åˆ°å“ªäº›é—®é¢˜ï¼Œè¿™äº›é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆæ ·çš„éƒ½éœ€è¦åç»­è¯¦ç»†çš„åˆ†æä¸€ä¸‹ã€‚</p><h4 id="å·¥ä½œå®‰æ’"><a href="#å·¥ä½œå®‰æ’" class="headerlink" title="å·¥ä½œå®‰æ’"></a>å·¥ä½œå®‰æ’</h4><p>TODO</p><ol><li><del>ç®€å•è·‘é€šWebSocketåœ¨SpringBooté¡¹ç›®ä¸­ï¼ˆç›®å‰åªæ˜¯è·‘é€šäº†ç®€å•çš„ç¾¤å‘WebSocketä»¥åŠåˆæ­¥ç†è§£äº†WebSocketçš„æ¦‚å¿µï¼Œç‚¹å¯¹ç‚¹èŠå¤©è¿˜æœªè·‘é€šï¼‰ï¼›</del></li><li>ç®€å•è·‘é€šWebSocketçš„ç‚¹å¯¹ç‚¹èŠå¤©æ¡ˆä¾‹ï¼›</li></ol><h3 id="åšå®¢ä¸Šä¼ -1"><a href="#åšå®¢ä¸Šä¼ -1" class="headerlink" title="åšå®¢ä¸Šä¼ "></a>åšå®¢ä¸Šä¼ </h3><h4 id="åšå®¢ä¿å­˜"><a href="#åšå®¢ä¿å­˜" class="headerlink" title="åšå®¢ä¿å­˜"></a>åšå®¢ä¿å­˜</h4><p><a href="http://localhost:8081/article/saveArticle">http://localhost:8081/article/saveArticle</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;articleTitle&quot;: &quot;Testä¸Šä¼ &quot;,</span><br><span class="line">  &quot;articleContent&quot;: &quot;# 34-04 Milvus\n\n## å‚è€ƒèµ„æ–™\n\n1. [ä¸ºAIè€Œç”Ÿçš„æ•°æ®åº“ï¼šMilvusè¯¦è§£åŠå®æˆ˜](https://blog.csdn.net/lsb2002/article/details/132222947)\n\n\n\n## æ¦‚è¿°\n\n\n\n\n\n## Pythonä½¿ç”¨Demo\n\n```\n# å®‰è£… Python å®¢æˆ·ç«¯\npip install pymilvus\n```\n\n```\n# 3. åˆå§‹åŒ– Milvus å®¢æˆ·ç«¯\n\nfrom pymilvus import connections as milvus\n\n# åˆå§‹åŒ–ä¸€ä¸ª Milvus å®¢æˆ·ç«¯ï¼Œé»˜è®¤è¿æ¥åˆ°æœ¬åœ°çš„ Milvus æœåŠ¡\nclient = milvus.connect(&#x27;default&#x27;, host=&#x27;localhost&#x27;, port=&#x27;19530&#x27;)\n```\n\n```\n# 4. åˆ›å»ºé›†åˆ\n\ncollection_name = \&quot;face_collection\&quot;\n\n# åˆ›å»ºé›†åˆï¼Œç¡®ä¿é›†åˆä¸å­˜åœ¨\nif not client.has_collection(collection_name):\n    client.create_collection(collection_name)\n```\n\n```\n# 5. å®šä¹‰å‘é‡å­—æ®µçš„ç±»å‹\n\nimport numpy as np\n\n# å®šä¹‰å‘é‡å­—æ®µçš„ç±»å‹ï¼Œå‡è®¾å‘é‡ç»´åº¦ä¸º 128\nfields = [\n    (\&quot;face_vector\&quot;, \&quot;float_vector\&quot;, 128),\n    (\&quot;face_name\&quot;, \&quot;text\&quot;)\n]\n```\n\n```\n# 6. æ’å…¥æ•°æ®\n# å‡†å¤‡ä¸€äº›ç¤ºä¾‹æ•°æ®\ndata_to_insert = [\n    &#123;\&quot;face_vector\&quot;: np.random.random(128).tolist(), \&quot;face_name\&quot;: \&quot;Person1\&quot;&#125;,\n    &#123;\&quot;face_vector\&quot;: np.random.random(128).tolist(), \&quot;face_name\&quot;: \&quot;Person2\&quot;&#125;,\n    # ... æ›´å¤šæ•°æ®\n]\n\n# æ’å…¥æ•°æ®\ninsert_result = client.insert(collection_name, fields, data_to_insert)\n```\n\n```\n7. æœç´¢ç›¸ä¼¼å‘é‡\n# å‡†å¤‡ä¸€ä¸ªæŸ¥è¯¢å‘é‡\nquery_vector = np.random.random(128).tolist()\n\n# å®šä¹‰æœç´¢å‚æ•°\nsearch_params = &#123;\n    \&quot;nprobe\&quot;: 10,\n    \&quot;metric_type\&quot;: \&quot;L2\&quot;\n&#125;\n\n# æ‰§è¡Œæœç´¢\ntop_k = 1  # è¿”å›æœ€ç›¸ä¼¼çš„ä¸€ä¸ªç»“æœ\nresults = client.search(collection_name, \&quot;face_vector\&quot;, query_vector, top_k, search_params)\n\n# æ‰“å°ç»“æœ\nfor result in results:\n    for item in result:\n        print(f\&quot;ç›¸ä¼¼åº¦: &#123;item.distance&#125;, å¯¹åº”å­—ç¬¦ä¸²: &#123;item.entity.get(&#x27;face_name&#x27;)[0]&#125;\&quot;)\n```\n\n```python\nfrom pymilvus import connections as milvus\nimport numpy as np\n\n# åˆå§‹åŒ– Milvus å®¢æˆ·ç«¯\nclient = milvus.connect(&#x27;default&#x27;, host=&#x27;localhost&#x27;, port=&#x27;19530&#x27;)\n\ncollection_name = \&quot;face_collection\&quot;\n\n# åˆ›å»ºé›†åˆ\nif not client.has_collection(collection_name):\n    client.create_collection(collection_name)\n\n# å®šä¹‰å‘é‡å­—æ®µçš„ç±»å‹\nfields = [\n    (\&quot;face_vector\&quot;, \&quot;float_vector\&quot;, 128),\n    (\&quot;face_name\&quot;, \&quot;text\&quot;)\n]\n\n# æ’å…¥æ•°æ®\ndata_to_insert = [\n    &#123;\&quot;face_vector\&quot;: np.random.random(128).tolist(), \&quot;face_name\&quot;: \&quot;Person1\&quot;&#125;,\n    &#123;\&quot;face_vector\&quot;: np.random.random(128).tolist(), \&quot;face_name\&quot;: \&quot;Person2\&quot;&#125;,\n]\ninsert_result = client.insert(collection_name, fields, data_to_insert)\n\n# å‡†å¤‡ä¸€ä¸ªæŸ¥è¯¢å‘é‡\nquery_vector = np.random.random(128).tolist()\n\n# å®šä¹‰æœç´¢å‚æ•°\nsearch_params = &#123;\n    \&quot;nprobe\&quot;: 10,\n    \&quot;metric_type\&quot;: \&quot;L2\&quot;\n&#125;\n\n# æ‰§è¡Œæœç´¢\ntop_k = 1  # è¿”å›æœ€ç›¸ä¼¼çš„ä¸€ä¸ªç»“æœ\nresults = client.search(collection_name, \&quot;face_vector\&quot;, query_vector, top_k, search_params)\n\n# æ‰“å°ç»“æœ\nfor result in results:\n    for item in result:\n        print(f\&quot;ç›¸ä¼¼åº¦: &#123;item.distance&#125;, å¯¹åº”å­—ç¬¦ä¸²: &#123;item.entity.get(&#x27;face_name&#x27;)[0]&#125;\&quot;)\n\n# æ¸…ç†èµ„æº\nclient.drop_collection(collection_name)\n```\n\n&quot;,</span><br><span class="line">  &quot;commentStatus&quot;: true,</span><br><span class="line">  &quot;recommendStatus&quot;: true,</span><br><span class="line">  &quot;viewStatus&quot;: true,</span><br><span class="line">  &quot;password&quot;: &quot;&quot;,</span><br><span class="line">  &quot;tips&quot;: &quot;&quot;,</span><br><span class="line">  &quot;articleCover&quot;: &quot;æ— &quot;,</span><br><span class="line">  &quot;videoUrl&quot;: &quot;æ— &quot;,</span><br><span class="line">  &quot;sortId&quot;: 1,</span><br><span class="line">  &quot;labelId&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åšå®¢ä¸­çš„articleContentä¸­çš„å›¾ç‰‡éœ€è¦è¿›è¡Œå¤„ç†ï¼Œå›¾ç‰‡åˆ†ä¸ºä¸¤ç§çŠ¶æ€ï¼š</p><ol><li>æœ¬åœ°ç…§ç‰‡</li><li>ç½‘ç»œç…§ç‰‡</li></ol><p>å¦‚æœæ˜¯æœ¬åœ°ç…§ç‰‡ï¼Œéœ€è¦åœ¨ä¸Šä¼ çš„å›¾ç‰‡è¡¨ä¸­æ‰¾åˆ°è¯¥å¯¹åº”å›¾ç‰‡çš„æ–‡ä»¶èµ„æºä¸­çš„åœ°å€å¹¶è¿›è¡Œæ›¿æ¢ï¼›</p><p>å¦‚æœæ˜¯ç½‘ç»œç…§ç‰‡åˆ™ä¸éœ€è¦è¿›è¡Œå¤„ç†ï¼›</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959916.png" alt="img"></p><h3 id="å‰åç«¯é¡µé¢æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½è¿›è¡ŒåŠ å¯†å¤„ç†"><a href="#å‰åç«¯é¡µé¢æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½è¿›è¡ŒåŠ å¯†å¤„ç†" class="headerlink" title="å‰åç«¯é¡µé¢æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½è¿›è¡ŒåŠ å¯†å¤„ç†"></a>å‰åç«¯é¡µé¢æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½è¿›è¡ŒåŠ å¯†å¤„ç†</h3><p>åœ¨ä¸€æ¬¡é¢è¯•ä¸­ï¼Œé¢è¯•è¯¢é—®ï¼Œæ˜¯å¦åšè¿‡å‰åç«¯çš„è¯·æ±‚å’Œå“åº”éƒ½åšåŠ å¯†å¤„ç†ã€‚å½“æ—¶å¯¹è¿™ä¸ªåªæ˜¯å¤§æ¦‚çš„è¿›è¡Œäº†ä»‹ç»ï¼Œç°åœ¨æˆ‘æ‰“ç®—åœ¨è¿™ä¸ªé¡¹ç›®ä¸­åº”ç”¨ä¸Šã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li><a href="https://blog.csdn.net/qq_35250826/article/details/106111767#:~:text=1%E3%80%81%E9%80%9A%E4%BF%A1%E4%BD%BF%E7%94%A8">å‰åç«¯APIäº¤äº’åŠ å¯†è§£å¯†ï¼ˆjsã€Javaï¼‰</a></li><li><a href="https://www.cnblogs.com/huanzi-qch/p/10913636.html">å‰åç«¯APIäº¤äº’æ•°æ®åŠ å¯†â€”â€”AESä¸RSAæ··åˆåŠ å¯†å®Œæ•´å®ä¾‹ </a></li><li><a href="https://blog.csdn.net/qq_33803102/article/details/110927078">SpringCloudGatewayè¯·æ±‚&#x2F;å“åº”æ‹¦æˆªï¼ŒåŠ &#x2F;è§£å¯†</a></li></ol><p>ç°åœ¨åœ¨è¿™ä¸ªé¡¹ç›®ä¸­æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨RSA+AESè¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œé€šè¿‡RSAåŠ å¯†äº¤æ¢å‰åç«¯AESçš„å¯†é’¥ï¼Œäº¤æ¢æˆåŠŸåï¼Œä½¿ç”¨AESå¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†å¤„ç†ã€‚</p><p>å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959828.png" alt="image-20240926215944099"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959881.png" alt="image-20240926225001815"></p><p>é€šè¿‡åˆ‡é¢çš„æ–¹å¼æ¥å¯¹ç«¯å£è¿›è¡ŒåŠ å¯†è§£å¯†ã€‚</p><p>ä¸Šé¢çš„æ–¹æ³•å¦å†³ã€‚</p><p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­æˆ‘é€‰æ‹©ä½¿ç”¨ç½‘å…³è¿›è¡Œæ‹¦æˆªï¼Œå‰ç«¯å¯¹æ‰€æœ‰çš„è¯·æ±‚è¿›è¡ŒåŠ å¯†å¤„ç†åï¼Œæ‰“åˆ°åç«¯ç½‘å…³ï¼Œåç«¯ç½‘å…³æ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚ï¼Œå¹¶è¿›è¡Œè§£å¯†åç„¶åè¿›è¡Œå¤„ç†ã€‚åŒæ ·çš„ï¼Œç½‘å…³ä¼šæ‹¦æˆªæ‰€æœ‰çš„å“åº”ï¼Œå¹¶æŠŠå“åº”è¿›è¡ŒåŠ å¯†åä¼ é€ç»™å‰ç«¯ï¼Œå‰ç«¯è¿›è¡Œè§£å¯†ååœ¨é¡µé¢è¿›è¡Œæ˜¾ç¤ºã€‚</p><p><strong>å…³äºå‰ç«¯å¯¹æ‰€æœ‰çš„postè¿›è¡ŒåŠ å¯†å·²ç»å®ç°äº†ï¼Œä½†æ˜¯åç«¯å¯¹äºæ‰€æœ‰çš„å“åº”è¿›è¡ŒåŠ å¯†å’Œå‰ç«¯å¯¹æ‰€æœ‰çš„å“åº”è¿›è¡Œè§£å¯†è¿˜æœªå®ç°ã€‚</strong></p><h3 id="å…±åŒå¥½å‹"><a href="#å…±åŒå¥½å‹" class="headerlink" title="å…±åŒå¥½å‹"></a>å…±åŒå¥½å‹</h3><p>Redisä¸­ä½¿ç”¨setæ¥ä¿å­˜è¯¥ç”¨æˆ·çš„å¥½å‹ï¼ŒRedisä¸­setæœ‰ä¸€ä¸ªå°è£…å¥½çš„å‡½æ•°sinter set1 set2</p><h3 id="å®šæ—¶ä»»åŠ¡ï¼ˆå¤šçº¿ç¨‹ã€xxjobã€å®šæ—¶æ¸…ç†è¿‡æœŸçš„ç™»å½•æ—¥å¿—ï¼‰"><a href="#å®šæ—¶ä»»åŠ¡ï¼ˆå¤šçº¿ç¨‹ã€xxjobã€å®šæ—¶æ¸…ç†è¿‡æœŸçš„ç™»å½•æ—¥å¿—ï¼‰" class="headerlink" title="å®šæ—¶ä»»åŠ¡ï¼ˆå¤šçº¿ç¨‹ã€xxjobã€å®šæ—¶æ¸…ç†è¿‡æœŸçš„ç™»å½•æ—¥å¿—ï¼‰"></a>å®šæ—¶ä»»åŠ¡ï¼ˆå¤šçº¿ç¨‹ã€xxjobã€å®šæ—¶æ¸…ç†è¿‡æœŸçš„ç™»å½•æ—¥å¿—ï¼‰</h3><h3 id="åˆ‡é¢åº”ç”¨ï¼ˆåˆ‡é¢ï¼‰"><a href="#åˆ‡é¢åº”ç”¨ï¼ˆåˆ‡é¢ï¼‰" class="headerlink" title="åˆ‡é¢åº”ç”¨ï¼ˆåˆ‡é¢ï¼‰"></a>åˆ‡é¢åº”ç”¨ï¼ˆåˆ‡é¢ï¼‰</h3><p>å‚è€ƒèµ„æ–™</p><ol><li><a href="https://blog.csdn.net/qq_52227892/article/details/133876816#:~:text=%E5%88%9B%E5%BB%BA%E4%BA%86%E4%B8%80%E4%B8%AA">Spring AOP + å¼‚æ­¥ä»»åŠ¡å®ç°æ—¥å¿—è®°å½•ï¼ˆæ“ä½œæ—¥å¿—ã€å¼‚å¸¸æ—¥å¿—ï¼‰å‚è€ƒruoyi</a></li></ol><p>ä¸ºäº†æ›´å¥½å¯¹AOPçš„ä½¿ç”¨æœ‰æ›´æ·±çš„äº†è§£ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ä¸‹é¢è¿™ä¸ªåœºæ™¯è¿›è¡Œå®ç°ï¼š</p><blockquote><p>ç°åœ¨åœ¨é¡¹ç›®ä¸­æœ‰ä¸€äº›æ¥å£éœ€è¦è¿›è¡Œæƒé™æ ¡éªŒï¼Œå³æŸäº›ç”¨æˆ·æ˜¯æ— æƒè®¿é—®è¿™ä¸ªæ¥å£çš„ï¼Œå¦‚æœæ— æƒé™åº”è¿›è¡Œæ‹¦æˆªã€‚åŒæ—¶è¿™ä¸ªæ¥å£å¾ˆé‡è¦ï¼Œåº”è¯¥é¿å…æŸäº›äººå‘˜è¿›è¡Œæ¶æ„çš„åˆ·æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œé˜²åˆ·ã€‚å¯¹æŸäº›æ¶æ„åˆ·çš„IPè¿›è¡Œå°ç¦ï¼Œå¹¶è¿›è¡Œé™æµï¼Œè¯·ä½ åŸºäºAOPæ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p></blockquote><p>è¯¦ç»†æŸ¥çœ‹<a href="https://blog.csdn.net/fyh2944163240/article/details/142794529?spm=1001.2014.3001.5501">65 åˆ‡é¢</a></p><h3 id="ç½‘å…³é‰´æƒ"><a href="#ç½‘å…³é‰´æƒ" class="headerlink" title="ç½‘å…³é‰´æƒ"></a>ç½‘å…³é‰´æƒ</h3><h3 id="è®°å½•è¿ç»­ç™»å½•æ—¶é—´"><a href="#è®°å½•è¿ç»­ç™»å½•æ—¶é—´" class="headerlink" title="è®°å½•è¿ç»­ç™»å½•æ—¶é—´"></a>è®°å½•è¿ç»­ç™»å½•æ—¶é—´</h3><h3 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h3><h4 id="3-è¯„è®ºç³»ç»Ÿä¸å¼‚æ­¥é€šçŸ¥"><a href="#3-è¯„è®ºç³»ç»Ÿä¸å¼‚æ­¥é€šçŸ¥" class="headerlink" title="3. è¯„è®ºç³»ç»Ÿä¸å¼‚æ­¥é€šçŸ¥"></a>3. <strong>è¯„è®ºç³»ç»Ÿä¸å¼‚æ­¥é€šçŸ¥</strong></h4><h5 id="ä¸šåŠ¡åœºæ™¯ï¼š"><a href="#ä¸šåŠ¡åœºæ™¯ï¼š" class="headerlink" title="ä¸šåŠ¡åœºæ™¯ï¼š"></a>ä¸šåŠ¡åœºæ™¯ï¼š</h5><p>ç”¨æˆ·åœ¨æ–‡ç« ä¸‹è¯„è®ºæˆ–å›å¤ä»–äººè¯„è®ºæ—¶ï¼Œç½‘ç«™éœ€è¦é€šçŸ¥æ–‡ç« ä½œè€…æˆ–è¢«å›å¤çš„ç”¨æˆ·ã€‚è¿™ç±»æ“ä½œå¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†ï¼Œä»¥é¿å…ç›´æ¥åœ¨è¯„è®ºæäº¤æ—¶æ‰§è¡Œé€šçŸ¥æ“ä½œï¼Œå‡å°‘ä¸»ä¸šåŠ¡ç³»ç»Ÿçš„å»¶è¿Ÿã€‚</p><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><p>äº‹åŠ¡åœ¨å®é™…å¼€å‘ä¸­å¯èƒ½ä¼šå­˜åœ¨çš„ä¸€äº›é—®é¢˜è¯¥æ€ä¹ˆå»è§£å†³ç­‰ç­‰ã€‚</p><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><p>é¿å…ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ç­‰é—®é¢˜ï¼Œå…·ä½“çš„å®ç°ã€‚</p><h3 id="æ•°æ®åº“åŠ å¯†"><a href="#æ•°æ®åº“åŠ å¯†" class="headerlink" title="æ•°æ®åº“åŠ å¯†"></a>æ•°æ®åº“åŠ å¯†</h3><p>å¦‚æœå¯¹æ•°æ®åº“ä¸­çš„æŸä¸ªè¡¨ä¸­çš„å†…å®¹è¿›è¡ŒåŠ å¯†åï¼Œé‚£ä¹ˆå¦‚ä½•è¿›è¡ŒæŸ¥è¯¢å‘¢ï¼Ÿæ¨¡ç³ŠæŸ¥è¯¢å‘¢ï¼Ÿ</p><h3 id="åšå®¢ä¸Šä¼ â€”â€”æœåŠ¡å™¨ç‰ˆ"><a href="#åšå®¢ä¸Šä¼ â€”â€”æœåŠ¡å™¨ç‰ˆ" class="headerlink" title="åšå®¢ä¸Šä¼ â€”â€”æœåŠ¡å™¨ç‰ˆ"></a>åšå®¢ä¸Šä¼ â€”â€”æœåŠ¡å™¨ç‰ˆ</h3><p>å°†æœåŠ¡éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šæ—¶ï¼Œå¦‚æœä¸€æ¬¡æ€§æ‰¹é‡ä¸Šä¼ è¿‡å¤šçš„å›¾ç‰‡ï¼Œå°±ä¼šå¯¼è‡´è¶…æ—¶ï¼Œå¯¼è‡´ä¸Šä¼ å¤±è´¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502261959593.png" alt="image-20241031191823443"></p><p>å› ä¸ºåœ¨åç«¯æœåŠ¡ä¸­ï¼Œè¿™ä¸ªä¸Šä¼ å›¾ç‰‡åŠŸèƒ½æ˜¯åŒæ­¥çš„ï¼Œéœ€è¦ç­‰å¾…minioä¸Šä¼ å¥½äº†ä¹‹åï¼Œä¿å­˜åˆ°MySQLä¹‹åæ‰èƒ½ç»™å‰ç«¯è¿›è¡Œè¿”å›ï¼Œè¿™æ˜¯é˜»å¡çš„ï¼Œä¸¥é‡é™åˆ¶äº†æ•ˆç‡ï¼Œæ‰€ä»¥æ˜¯å¦å¯ä»¥é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ï¼ŒæŠŠæœåŠ¡ä¸Šä¼ è¿™ä¸ªä»»åŠ¡äº¤ç»™å…¶å®ƒæœåŠ¡è‡ªåŠ¨çš„æ¥ä¸Šä¼ ï¼Œè‡ªåŠ¨çš„å¤„ç†è¶…æ—¶ç­‰ä¸€äº›å…¶å®ƒé—®é¢˜ï¼Œä»è€Œå˜æˆå¼‚æ­¥çš„ã€‚</p><h2 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h2><h3 id="åšå®¢ä¿å­˜-1"><a href="#åšå®¢ä¿å­˜-1" class="headerlink" title="åšå®¢ä¿å­˜"></a>åšå®¢ä¿å­˜</h3><p>Q :  å‡è®¾ä½ æ˜¯ä¸€åéå¸¸èµ„æ·±çš„Javaç¨‹åºå‘˜ï¼Œç°åœ¨è¯·ä½ å¸®æˆ‘æ€è€ƒä¸€ä¸‹ä¸‹é¢çš„csdnä¿å­˜è¿™ç¯‡åšå®¢æ˜¯å¦‚ä½•å®ç°ï¼š CSDNè¿™ä¸ªåœ¨çº¿åšå®¢ç½‘å€ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸Šé¢å‘è¡¨åšå®¢ï¼Œç”¨æˆ·åœ¨ç½‘å€ä¸Šå†™åšå®¢ï¼Œå¹¶åœ¨æ–‡å­—ä¸­æ’å…¥å›¾ç‰‡ï¼Œé‚£ä¹ˆè¯·é—®å¦‚æœç”¨æˆ·ç‚¹å‡»å‘è¡¨ï¼Œcsdnè¯¥å¦‚ä½•ä¿å­˜è¿™ç¯‡åšå®¢å‘¢ï¼Ÿ</p><p>A ï¼šä½œä¸ºä¸€åèµ„æ·±çš„Javaç¨‹åºå‘˜ï¼Œå®ç°ä¸€ä¸ªåƒCSDNè¿™æ ·çš„åœ¨çº¿åšå®¢å¹³å°çš„â€ä¿å­˜åšå®¢â€åŠŸèƒ½ï¼Œå¯ä»¥åˆ†ä¸ºå‡ ä¸ªå…³é”®æ­¥éª¤ï¼š</p><ol><li><strong>å‰ç«¯æ•°æ®æ”¶é›†</strong>ï¼š<ul><li>ç”¨æˆ·é€šè¿‡å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚TinyMCEã€CKEditorç­‰ï¼‰è¾“å…¥å’Œæ ¼å¼åŒ–æ–‡æœ¬ã€‚</li><li>ç”¨æˆ·å¯ä»¥ä¸Šä¼ å›¾ç‰‡æˆ–æ’å…¥ç½‘ç»œå›¾ç‰‡é“¾æ¥ã€‚</li><li>æ‰€æœ‰è¿™äº›æ•°æ®é€šå¸¸è¢«æ”¶é›†åˆ°ä¸€ä¸ªè¡¨å•ä¸­ï¼Œå¹¶é€šè¿‡AJAXè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ã€‚</li></ul></li><li><strong>åç«¯æ¥æ”¶æ•°æ®</strong>ï¼š<ul><li>æœåŠ¡å™¨ç«¯ï¼ˆå¯èƒ½æ˜¯ä½¿ç”¨Javaçš„Spring Bootæ¡†æ¶ï¼‰æ¥æ”¶æ¥è‡ªå‰ç«¯çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ–‡æœ¬å†…å®¹ã€å›¾ç‰‡ã€ä»¥åŠå…¶ä»–å…ƒæ•°æ®ï¼ˆå¦‚æ ‡é¢˜ã€æ ‡ç­¾ã€åˆ†ç±»ç­‰ï¼‰ã€‚</li></ul></li><li><strong>æ•°æ®éªŒè¯</strong>ï¼š<ul><li>éªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§ï¼Œä¾‹å¦‚æ£€æŸ¥æ–‡æœ¬æ˜¯å¦ä¸ºç©ºï¼Œå›¾ç‰‡æ ¼å¼æ˜¯å¦è¢«æ”¯æŒç­‰ã€‚</li></ul></li><li><strong>å›¾ç‰‡å¤„ç†</strong>ï¼š<ul><li>å¦‚æœç”¨æˆ·ä¸Šä¼ äº†å›¾ç‰‡ï¼ŒæœåŠ¡å™¨éœ€è¦å¤„ç†è¿™äº›å›¾ç‰‡ï¼ˆå¦‚è°ƒæ•´å¤§å°ã€å‹ç¼©ã€ç”Ÿæˆç¼©ç•¥å›¾ç­‰ï¼‰ã€‚</li><li>å°†å›¾ç‰‡å­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿæˆ–äº‘å­˜å‚¨æœåŠ¡ï¼Œå¹¶ä¿å­˜å›¾ç‰‡çš„URLã€‚</li></ul></li><li><strong>æ–‡æœ¬å†…å®¹å¤„ç†</strong>ï¼š<ul><li>å°†å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç”Ÿæˆçš„HTMLå†…å®¹è¿›è¡Œæ¸…ç†å’Œè½¬ä¹‰ï¼Œä»¥é˜²æ­¢XSSæ”»å‡»ã€‚</li><li>å¯èƒ½éœ€è¦å°†HTMLè½¬æ¢ä¸ºMarkdownæˆ–å…¶ä»–æ ¼å¼ï¼Œä»¥ä¾¿å­˜å‚¨ã€‚</li></ul></li><li><strong>æ•°æ®åº“å­˜å‚¨</strong>ï¼š<ul><li>å°†åšå®¢çš„å…ƒæ•°æ®å’Œæ–‡æœ¬å†…å®¹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°åˆ›å»ºæ–°çš„è¡¨è®°å½•æˆ–æ›´æ–°ç°æœ‰è®°å½•ã€‚</li><li>æ•°æ®åº“è®¾è®¡å¯èƒ½åŒ…æ‹¬<code>blogs</code>è¡¨ï¼ˆå­˜å‚¨åšå®¢IDã€æ ‡é¢˜ã€å†…å®¹ã€åˆ›å»ºæ—¶é—´ç­‰ï¼‰ï¼Œ<code>blog_images</code>è¡¨ï¼ˆå­˜å‚¨åšå®¢IDã€å›¾ç‰‡URLç­‰ï¼‰ã€‚</li></ul></li><li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼š<ul><li>ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½¿ç”¨æ•°æ®åº“äº‹åŠ¡æ¥å¤„ç†å¯èƒ½çš„å¹¶å‘é—®é¢˜ã€‚</li></ul></li><li><strong>åé¦ˆç»™ç”¨æˆ·</strong>ï¼š<ul><li>æ“ä½œå®Œæˆåï¼Œç»™ç”¨æˆ·ä¸€ä¸ªæˆåŠŸæˆ–å¤±è´¥çš„åé¦ˆã€‚</li><li>å¦‚æœæˆåŠŸï¼Œå¯èƒ½è¿˜ä¼šé‡å®šå‘åˆ°åšå®¢çš„å±•ç¤ºé¡µé¢æˆ–æä¾›åšå®¢çš„æ°¸ä¹…é“¾æ¥ã€‚</li></ul></li><li><strong>æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰</strong>ï¼š<ul><li>ä¸ºäº†æé«˜åšå®¢çš„å¯å‘ç°æ€§ï¼Œå¯èƒ½éœ€è¦ç”Ÿæˆåšå®¢çš„SEOå‹å¥½çš„URLã€‚</li></ul></li><li><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼š<ul><li>å¯¹äºé«˜æµé‡çš„åšå®¢ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼ˆå¦‚Redisï¼‰æ¥æé«˜è¯»å–é€Ÿåº¦ã€‚</li></ul></li><li><strong>å®‰å…¨æ€§è€ƒè™‘</strong>ï¼š<ul><li>ç¡®ä¿æ•´ä¸ªæµç¨‹è€ƒè™‘åˆ°äº†å®‰å…¨æ€§ï¼Œå¦‚é˜²æ­¢SQLæ³¨å…¥ã€XSSæ”»å‡»ç­‰ã€‚</li></ul></li><li><strong>APIè®¾è®¡</strong>ï¼š<ul><li>è®¾è®¡RESTful APIæ¥å¤„ç†å‰ç«¯çš„è¯·æ±‚ï¼Œä¾‹å¦‚ä½¿ç”¨POSTè¯·æ±‚æ¥ä¿å­˜åšå®¢ã€‚</li></ul></li><li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼š<ul><li>å¯¹äºè€—æ—¶çš„æ“ä½œï¼ˆå¦‚å›¾ç‰‡å¤„ç†ï¼‰ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚RabbitMQã€Kafkaç­‰ï¼‰æ¥æé«˜å“åº”é€Ÿåº¦ã€‚</li></ul></li><li><strong>æ—¥å¿—è®°å½•</strong>ï¼š<ul><li>è®°å½•å…³é”®æ“ä½œçš„æ—¥å¿—ï¼Œä»¥ä¾¿äºé—®é¢˜è¿½è¸ªå’Œæ€§èƒ½ç›‘æ§ã€‚</li></ul></li><li><strong>å‰ç«¯ä¸åç«¯çš„äº¤äº’</strong>ï¼š<ul><li>ä½¿ç”¨JSONæˆ–å…¶ä»–æ ¼å¼åœ¨å‰ç«¯å’Œåç«¯ä¹‹é—´äº¤æ¢æ•°æ®ã€‚</li></ul></li></ol><p>è¿™æ˜¯ä¸€ä¸ªé«˜å±‚æ¬¡çš„æ¦‚è¿°ï¼Œå®é™…å®ç°æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘è®¸å¤šç»†èŠ‚å’Œç‰¹å®šåœºæ™¯çš„éœ€æ±‚ã€‚</p><h4 id="ä¸Šä¼ å®‰å…¨"><a href="#ä¸Šä¼ å®‰å…¨" class="headerlink" title="ä¸Šä¼ å®‰å…¨"></a>ä¸Šä¼ å®‰å…¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MarkdownController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload-markdown&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadMarkdown</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è¯»å–Markdownæ–‡ä»¶å†…å®¹</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">markdownContent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(file.getBytes(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä½¿ç”¨å®‰å…¨çš„Markdownè§£æå™¨è½¬æ¢ä¸ºHTML</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">htmlContent</span> <span class="operator">=</span> parseMarkdownToHtml(markdownContent);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ¸…ç†HTMLå†…å®¹ï¼Œé˜²æ­¢XSSæ”»å‡»</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">safeHtmlContent</span> <span class="operator">=</span> sanitizeHtml(htmlContent);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å­˜å‚¨æˆ–è¿”å›å®‰å…¨çš„HTMLå†…å®¹</span></span><br><span class="line">            <span class="keyword">return</span> safeHtmlContent;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// é”™è¯¯å¤„ç†</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Error processing file&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">parseMarkdownToHtml</span><span class="params">(String markdown)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨å®‰å…¨çš„Markdownè§£æå™¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SomeSecureMarkdownParser</span>().parse(markdown);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">sanitizeHtml</span><span class="params">(String html)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨HTMLæ¸…ç†åº“ï¼Œå¦‚Jsoup</span></span><br><span class="line">        <span class="keyword">return</span> Jsoup.clean(html);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åšå®¢å›¾ç‰‡"><a href="#åšå®¢å›¾ç‰‡" class="headerlink" title="åšå®¢å›¾ç‰‡"></a>åšå®¢å›¾ç‰‡</h3><p>Qï¼šé‚£ä¹ˆå¦‚æœç”¨æˆ·æŸ¥çœ‹è¿™ç¯‡åšå®¢çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•çŸ¥é“è¿™ä¸ªåšå®¢å›¾ç‰‡çš„åº”è¯¥æ’å…¥åšå®¢ä¸­çš„å“ªä¸ªä½ç½®å‘¢ï¼Ÿ</p><p>A ï¼š å½“ç”¨æˆ·æŸ¥çœ‹åšå®¢æ—¶ï¼Œç¡®ä¿å›¾ç‰‡æ­£ç¡®æ’å…¥åˆ°åšå®¢æ–‡æœ¬ä¸­çš„æ­£ç¡®ä½ç½®æ˜¯ä¸€ä¸ªå…³é”®åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å®ç°è¿™ä¸€åŠŸèƒ½çš„å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„ä½¿ç”¨</strong>ï¼š<ul><li>ç”¨æˆ·åœ¨æ’°å†™åšå®¢æ—¶ï¼Œé€šå¸¸ä½¿ç”¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚TinyMCEã€CKEditorç­‰ï¼‰ã€‚è¿™äº›ç¼–è¾‘å™¨å…è®¸ç”¨æˆ·åœ¨æ–‡æœ¬ä¸­æ’å…¥å›¾ç‰‡ï¼Œå¹¶åœ¨æ–‡æœ¬ä¸­æŒ‡å®šå›¾ç‰‡çš„ä½ç½®ã€‚</li></ul></li><li><strong>å›¾ç‰‡ä½ç½®çš„æ ‡è®°</strong>ï¼š<ul><li>åœ¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­ï¼Œå›¾ç‰‡é€šå¸¸è¢«æ’å…¥åˆ°ç‰¹å®šçš„HTMLæ ‡ç­¾ä¸­ï¼Œä¾‹å¦‚<code>&lt;img&gt;</code>æ ‡ç­¾ã€‚ç¼–è¾‘å™¨ä¼šç”Ÿæˆç›¸åº”çš„HTMLä»£ç ï¼Œå…¶ä¸­åŒ…å«å›¾ç‰‡çš„URLå’Œå¯èƒ½çš„å…¶ä»–å±æ€§ï¼ˆå¦‚å®½åº¦ã€é«˜åº¦ã€å¯¹é½æ–¹å¼ç­‰ï¼‰ã€‚</li></ul></li><li><strong>å›¾ç‰‡æ•°æ®çš„å­˜å‚¨</strong>ï¼š<ul><li>å½“ç”¨æˆ·æäº¤åšå®¢æ—¶ï¼Œåç«¯éœ€è¦å°†ç¼–è¾‘å™¨ç”Ÿæˆçš„HTMLå†…å®¹ï¼ˆåŒ…æ‹¬å›¾ç‰‡æ ‡ç­¾ï¼‰å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°å°†HTMLå†…å®¹å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡æœ¬å­—æ®µã€‚</li></ul></li><li><strong>æ•°æ®åº“è®¾è®¡</strong>ï¼š<ul><li>æ•°æ®åº“ä¸­é€šå¸¸ä¼šæœ‰ä¸€ä¸ªè¡¨æ¥å­˜å‚¨åšå®¢å†…å®¹ï¼Œå…¶ä¸­åŒ…å«åšå®¢çš„æ–‡æœ¬å­—æ®µã€‚å›¾ç‰‡çš„URLå¯ä»¥ä½œä¸ºæ–‡æœ¬çš„ä¸€éƒ¨åˆ†å­˜å‚¨åœ¨åšå®¢å†…å®¹å­—æ®µä¸­ã€‚</li></ul></li><li><strong>å›¾ç‰‡URLçš„å¤„ç†</strong>ï¼š<ul><li>å›¾ç‰‡çš„URLåœ¨å­˜å‚¨æ—¶éœ€è¦ç¡®ä¿å…¶æ­£ç¡®æ€§å’Œå®‰å…¨æ€§ã€‚åç«¯å¯èƒ½éœ€è¦éªŒè¯å›¾ç‰‡URLï¼Œå¹¶å¤„ç†ä»»ä½•ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„çš„é—®é¢˜ã€‚</li></ul></li><li><strong>å‰ç«¯å±•ç¤º</strong>ï¼š<ul><li>å½“ç”¨æˆ·æŸ¥çœ‹åšå®¢æ—¶ï¼Œå‰ç«¯é¡µé¢ä¼šä»æ•°æ®åº“ä¸­è¯»å–åšå®¢å†…å®¹ï¼Œå¹¶å°†å…¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚è¿™åŒ…æ‹¬è§£æHTMLå†…å®¹ï¼Œå¹¶æ­£ç¡®æ˜¾ç¤ºå…¶ä¸­çš„å›¾ç‰‡ã€‚</li></ul></li><li><strong>å›¾ç‰‡çš„åŠ è½½å’Œç¼“å­˜</strong>ï¼š<ul><li>å›¾ç‰‡çš„åŠ è½½å¯èƒ½éœ€è¦è€ƒè™‘åŠ è½½æ—¶é—´å’Œç¼“å­˜ç­–ç•¥ã€‚å¯ä»¥ä½¿ç”¨CDNæ¥åŠ é€Ÿå›¾ç‰‡çš„åŠ è½½ï¼Œå¹¶ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜æ¥å‡å°‘é‡å¤åŠ è½½çš„å¼€é”€ã€‚</li></ul></li><li><strong>å“åº”å¼è®¾è®¡</strong>ï¼š<ul><li>ç¡®ä¿å›¾ç‰‡åœ¨ä¸åŒè®¾å¤‡å’Œå±å¹•å°ºå¯¸ä¸Šæ­£ç¡®æ˜¾ç¤ºã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°ä½¿ç”¨CSSæ¥è°ƒæ•´å›¾ç‰‡çš„å°ºå¯¸å’Œå¸ƒå±€ã€‚</li></ul></li><li><strong>SEOä¼˜åŒ–</strong>ï¼š<ul><li>å›¾ç‰‡çš„åŠ è½½å’Œæ˜¾ç¤ºä¹Ÿéœ€è¦è€ƒè™‘æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰ã€‚ç¡®ä¿å›¾ç‰‡çš„<code>alt</code>å±æ€§è¢«æ­£ç¡®è®¾ç½®ï¼Œä»¥æé«˜åšå®¢çš„å¯è®¿é—®æ€§å’Œæœç´¢å¼•æ“æ’åã€‚</li></ul></li><li><strong>å®‰å…¨æ€§</strong>ï¼š<ul><li>ç¡®ä¿å›¾ç‰‡çš„åŠ è½½ä¸ä¼šå¼•å…¥å®‰å…¨é£é™©ï¼Œå¦‚è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ã€‚å¯¹å›¾ç‰‡URLè¿›è¡Œé€‚å½“çš„è¿‡æ»¤å’ŒéªŒè¯ã€‚</li></ul></li><li><strong>é”™è¯¯å¤„ç†</strong>ï¼š<ul><li>å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå‰ç«¯éœ€è¦æœ‰ç›¸åº”çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¾‹å¦‚æ˜¾ç¤ºä¸€ä¸ªå ä½ç¬¦æˆ–é”™è¯¯ä¿¡æ¯ã€‚</li></ul></li><li><strong>ç¼–è¾‘å’Œæ›´æ–°</strong>ï¼š<ul><li>å¦‚æœç”¨æˆ·éœ€è¦ç¼–è¾‘åšå®¢ï¼Œç¼–è¾‘å™¨éœ€è¦èƒ½å¤Ÿæ­£ç¡®å¤„ç†å’Œæ›´æ–°å›¾ç‰‡çš„ä½ç½®å’ŒURLã€‚</li></ul></li></ol><p>é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œå¯ä»¥ç¡®ä¿ç”¨æˆ·åœ¨æŸ¥çœ‹åšå®¢æ—¶ï¼Œå›¾ç‰‡èƒ½å¤Ÿæ­£ç¡®åœ°æ’å…¥åˆ°åšå®¢æ–‡æœ¬ä¸­æŒ‡å®šçš„ä½ç½®ã€‚è¿™éœ€è¦å‰ç«¯å’Œåç«¯çš„ç´§å¯†åä½œï¼Œä»¥åŠå¯¹HTMLå†…å®¹å’Œå›¾ç‰‡å¤„ç†çš„æ·±å…¥ç†è§£ã€‚</p><h3 id="åšå®¢MDæ ¼å¼æ–‡ä»¶ä¸Šä¼ "><a href="#åšå®¢MDæ ¼å¼æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="åšå®¢MDæ ¼å¼æ–‡ä»¶ä¸Šä¼ "></a>åšå®¢MDæ ¼å¼æ–‡ä»¶ä¸Šä¼ </h3><h4 id="Kimi"><a href="#Kimi" class="headerlink" title="Kimi"></a>Kimi</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; @change=&quot;handleFileChange&quot; /&gt;</span><br><span class="line">    &lt;button @click=&quot;uploadFile&quot;&gt;ä¸Šä¼ &lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import axios from &#x27;axios&#x27;;</span><br><span class="line">import &#123; saveAs &#125; from &#x27;file-saver&#x27;;</span><br><span class="line"></span><br><span class="line">const file = ref(null);</span><br><span class="line">const fileContent = ref(&#x27;&#x27;);</span><br><span class="line"></span><br><span class="line">const handleFileChange = (e) =&gt; &#123;</span><br><span class="line">  const file = e.target.files[0];</span><br><span class="line">  if (file) &#123;</span><br><span class="line">    const reader = new FileReader();</span><br><span class="line">    reader.onload = (event) =&gt; &#123;</span><br><span class="line">      fileContent.value = event.target.result;</span><br><span class="line">      // å¤„ç†å›¾ç‰‡å¹¶ä¸Šä¼ </span><br><span class="line">      handleImagesInMd(fileContent.value);</span><br><span class="line">    &#125;;</span><br><span class="line">    reader.readAsText(file);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const handleImagesInMd = (mdContent) =&gt; &#123;</span><br><span class="line">  const imageRegex = /!\[.*?\]\((.*?)\)/g;</span><br><span class="line">  let match;</span><br><span class="line">  let updatedContent = mdContent;</span><br><span class="line"></span><br><span class="line">  while ((match = imageRegex.exec(mdContent)) !== null) &#123;</span><br><span class="line">    const imageUrl = match[1];</span><br><span class="line">    uploadImage(imageUrl).then((serverUrl) =&gt; &#123;</span><br><span class="line">      updatedContent = updatedContent.replace(match[0], `!$&#123;match[0].split(&#x27;(&#x27;)[0]&#125;($&#123;serverUrl&#125;)`);</span><br><span class="line">      if (imageRegex.lastIndex === mdContent.length) &#123;</span><br><span class="line">        // æ‰€æœ‰å›¾ç‰‡å¤„ç†å®Œæˆï¼Œä¸Šä¼ MDæ–‡ä»¶</span><br><span class="line">        uploadMdFile(updatedContent);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const uploadImage = (url) =&gt; &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    const img = new Image();</span><br><span class="line">    img.crossOrigin = &#x27;Anonymous&#x27;;</span><br><span class="line">    img.onload = () =&gt; &#123;</span><br><span class="line">      const canvas = document.createElement(&#x27;canvas&#x27;);</span><br><span class="line">      const ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">      canvas.width = img.width;</span><br><span class="line">      canvas.height = img.height;</span><br><span class="line">      ctx.drawImage(img, 0, 0);</span><br><span class="line">      canvas.toBlob((blob) =&gt; &#123;</span><br><span class="line">        const formData = new FormData();</span><br><span class="line">        formData.append(&#x27;image&#x27;, blob);</span><br><span class="line">        axios.post(&#x27;/upload-image&#x27;, formData, &#123;</span><br><span class="line">          headers: &#123; &#x27;Content-Type&#x27;: &#x27;multipart/form-data&#x27; &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        .then((response) =&gt; &#123;</span><br><span class="line">          resolve(response.data.url);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          reject(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    img.onerror = reject;</span><br><span class="line">    img.src = url;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const uploadMdFile = (content) =&gt; &#123;</span><br><span class="line">  axios.post(&#x27;/upload-md&#x27;, content, &#123;</span><br><span class="line">    headers: &#123; &#x27;Content-Type&#x27;: &#x27;text/plain&#x27; &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(() =&gt; &#123;</span><br><span class="line">    console.log(&#x27;MDæ–‡ä»¶ä¸Šä¼ æˆåŠŸ&#x27;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch((error) =&gt; &#123;</span><br><span class="line">    console.error(&#x27;MDæ–‡ä»¶ä¸Šä¼ å¤±è´¥&#x27;, error);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardCopyOption;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload-image&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadImage</span><span class="params">(<span class="meta">@RequestParam(&quot;image&quot;)</span> MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + <span class="string">&quot;.png&quot;</span>;</span><br><span class="line">            <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Files.createTempFile(<span class="string">&quot;images&quot;</span>, fileName);</span><br><span class="line">            Files.write(path, file.getBytes(), StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/images/&quot;</span> + fileName; <span class="comment">// è¿”å›å›¾ç‰‡çš„æœåŠ¡å™¨è·¯å¾„</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ–‡ä»¶ä¿å­˜å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload-md&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uploadMdFile</span><span class="params">(<span class="meta">@RequestParam(&quot;mdFile&quot;)</span> String mdContent)</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå¯ä»¥æ·»åŠ ä»£ç å°†mdContentä¿å­˜åˆ°Elasticsearch</span></span><br><span class="line">        System.out.println(<span class="string">&quot;MDæ–‡ä»¶å†…å®¹: &quot;</span> + mdContent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ChatGPT-1"><a href="#ChatGPT-1" class="headerlink" title="ChatGPT"></a>ChatGPT</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;upload-container&quot;&gt;</span><br><span class="line">    &lt;el-upload</span><br><span class="line">      class=&quot;upload-demo&quot;</span><br><span class="line">      action=&quot;http://localhost:8080/api/upload&quot;</span><br><span class="line">      :http-request=&quot;handleUpload&quot;</span><br><span class="line">      :show-file-list=&quot;false&quot;</span><br><span class="line">      accept=&quot;.md&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; class=&quot;upload-button&quot;&gt;ä¸Šä¼  Markdown æ–‡ä»¶&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-upload&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; ElUpload, ElButton, ElMessage &#125; from &#x27;element-plus&#x27;;</span><br><span class="line">import axios from &#x27;axios&#x27;;</span><br><span class="line"></span><br><span class="line">const handleUpload = async (file) =&gt; &#123;</span><br><span class="line">  const formData = new FormData();</span><br><span class="line">  formData.append(&#x27;file&#x27;, file.file);</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    const response = await axios.post(&#x27;http://localhost:8080/api/upload&#x27;, formData, &#123;</span><br><span class="line">      headers: &#123;</span><br><span class="line">        &#x27;Content-Type&#x27;: &#x27;multipart/form-data&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    ElMessage.success(&#x27;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&#x27;);</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    ElMessage.error(&#x27;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.upload-container &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  align-items: center;</span><br><span class="line">  height: 100vh;</span><br><span class="line">  background-color: #f0f2f5;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.upload-button &#123;</span><br><span class="line">  border-radius: 25px;</span><br><span class="line">  font-size: 18px;</span><br><span class="line">  font-family: &#x27;KaiTi&#x27;, serif;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.upload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.support.ServletUriComponentsBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;file.upload-dir&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uploadDir;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">uploadFile</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">uploadPath</span> <span class="operator">=</span> Paths.get(uploadDir);</span><br><span class="line">            <span class="keyword">if</span> (!Files.exists(uploadPath)) &#123;</span><br><span class="line">                Files.createDirectories(uploadPath);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¿å­˜Markdownæ–‡ä»¶</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> uploadPath.resolve(file.getOriginalFilename());</span><br><span class="line">            Files.copy(file.getInputStream(), filePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¤„ç†Markdownæ–‡ä»¶ä¸­çš„å›¾ç‰‡</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">markdownContent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Files.readAllBytes(filePath));</span><br><span class="line">            Map&lt;String, String&gt; imageUrlMap = extractAndUploadImages(markdownContent);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ›¿æ¢Markdownæ–‡ä»¶ä¸­çš„å›¾ç‰‡URL</span></span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : imageUrlMap.entrySet()) &#123;</span><br><span class="line">                markdownContent = markdownContent.replace(entry.getKey(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¿å­˜Markdownå†…å®¹åˆ°Elasticsearch</span></span><br><span class="line">            saveToElasticsearch(file.getOriginalFilename(), markdownContent);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(<span class="number">500</span>).body(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; <span class="title function_">extractAndUploadImages</span><span class="params">(String markdownContent)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Map&lt;String, String&gt; imageUrlMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;!\\[.*?\\]\\((.*?)\\)&quot;</span>);</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(markdownContent);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-upload</span><br><span class="line">        accept=&quot;.md&quot;</span><br><span class="line">        :headers=&quot;upload.headers&quot;</span><br><span class="line">        :action=&quot;upload.url&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-icon class=&quot;el-icon--upload&quot;&gt;</span><br><span class="line">        &lt;upload-filled /&gt;</span><br><span class="line">      &lt;/el-icon&gt;</span><br><span class="line">      &lt;div class=&quot;el-upload__text&quot;&gt;å°†æ–‡ä»¶æ‹–åˆ°æ­¤å¤„ï¼Œæˆ–&lt;em&gt;ç‚¹å‡»ä¸Šä¼ &lt;/em&gt;&lt;/div&gt;</span><br><span class="line">      &lt;template #tip&gt;</span><br><span class="line">        &lt;div class=&quot;el-upload__tip text-center&quot;&gt;</span><br><span class="line">          &lt;span&gt;ä»…å…è®¸å¯¼å…¥pdfæ ¼å¼æ–‡ä»¶ã€‚&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-upload&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">const upload = (&#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    Authorization: &quot;Bearer &quot;,</span><br><span class="line">    &#x27;Access-Control-Allow-Origin&#x27;:&#x27;*&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  url: &#x27;/screw/api/blog/addBlogMDFile&#x27;,  // åœ°å€,ä»¥aaaæ‰“å¤´</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="åç«¯-1"><a href="#åç«¯-1" class="headerlink" title="åç«¯"></a>åç«¯</h4><p>ç”¨æˆ·åœ¨å‰ç«¯ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶ä¹‹åï¼Œåœ¨åç«¯ï¼Œä¸Šä¼ çš„æ–‡ä»¶é¦–å…ˆè¢«æš‚æ—¶å­˜å‚¨åœ¨æœåŠ¡å™¨çš„å†…å­˜ä¸­ï¼ˆé€šå¸¸æ˜¯åœ¨JVMçš„å †å†…å­˜é‡Œï¼‰ï¼Œæˆ–è€…å¦‚æœæ–‡ä»¶å¤ªå¤§ï¼Œå¯èƒ½è¢«å­˜å‚¨åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼ˆåœ¨æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚<code>/tmp</code>ç›®å½•ä¸‹ï¼‰ã€‚</p><p>åç«¯æœåŠ¡<code>FileStorageService</code>æ¥æ”¶åˆ°<code>MultipartFile</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä»£è¡¨äº†ä¸Šä¼ çš„æ–‡ä»¶åŠå…¶å…ƒæ•°æ®ï¼ˆå¦‚æ–‡ä»¶åã€å¤§å°ã€ç±»å‹ï¼‰ã€‚</p><h3 id="ç”¨æˆ·é‡å¤ç™»å½•"><a href="#ç”¨æˆ·é‡å¤ç™»å½•" class="headerlink" title="ç”¨æˆ·é‡å¤ç™»å½•"></a>ç”¨æˆ·é‡å¤ç™»å½•</h3><h4 id="ç–‘é—®-1"><a href="#ç–‘é—®-1" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h4><p>åœ¨ç”¨æˆ·ç™»å½•æ¨¡å—ä¸­ï¼Œå¦‚æœç”¨æˆ·ä¸€ç›´é‡å¤ç™»å½•ï¼Œå¦‚æœè¯¥ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯éƒ½æ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šä¸æ–­çš„ç”ŸæˆTokenï¼Œå¹¶å°†è¯¥Tokenæºå¸¦çš„ç”¨æˆ·ä¿¡æ¯å­˜å…¥Redisä¸­ï¼Œç”±äºTokenæ˜¯å”¯ä¸€çš„ä¸”ä¸æ–­å˜åŒ–çš„ï¼Œæ‰€ä»¥å¦‚æœç”¨æˆ·ä¸€ç›´ç™»å½•ï¼ŒRediså°±ä¼šä¸€ç›´å­˜ï¼Œæœ€åRediså­˜æ»¡å¯¼è‡´é—®é¢˜ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>åœ¨Redisä¸­è®°å½•å½“å‰ç”¨æˆ·æ˜¯å¦ç™»å½•è¿‡ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•ï¼Œå°±å°†è¯¥ç”Ÿæˆçš„Tokenä¹Ÿå­˜æ”¾ä¸€ä»½åœ¨Redis ç”¨æˆ·ç™»å½•çŠ¶æ€ä¸­ï¼Œå¦‚æœç™»å½•è¿‡ï¼Œå°±ç›´æ¥è¿”å›Redisä¸­ä¿å­˜çš„tokenï¼Œä»è€Œé¿å…ç”¨æˆ·æ¶æ„é‡å¤ç™»å½•å¯¼è‡´Rediså†…å­˜ä¸å¤Ÿã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦ç™»å½• ç™»é™†è¿‡å°±æ— éœ€å†ç”ŸæˆTokenç„¶åä¿å­˜åˆ°Redisä¸­</span></span><br><span class="line"><span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> (String) redisUtils.get(RedisDynamicParameter.REDIS_USER_LOGIN_STATUS + blogUserDTO.getId());</span><br><span class="line"><span class="keyword">if</span>(ObjectUtils.isNotEmpty(token))&#123;</span><br><span class="line">    <span class="keyword">return</span> R.ok(token);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">tokenKey</span> <span class="operator">=</span> RedisDynamicParameter.REDIS_USER_LOGIN_TOKEN +uuid;</span><br><span class="line"></span><br><span class="line">redisUtils.set(tokenKey,blogUserDTO,EXPIRATION_TIME);</span><br><span class="line">token = JWTUtils.generateToken(uuid,<span class="number">1L</span>);</span><br><span class="line">redisUtils.set(RedisDynamicParameter.REDIS_USER_LOGIN_STATUS + blogUserDTO.getId(),token,EXPIRATION_TIME);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> R.ok(token);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨æˆ·ç™»å½•Key</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">REDIS_USER_LOGIN_TOKEN</span> <span class="operator">=</span> <span class="string">&quot;screw:user:login:token:&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">REDIS_USER_LOGIN_STATUS</span> <span class="operator">=</span> <span class="string">&quot;screw:user:login:status:&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="MyBatis-MyBatis-PlusäºŒæ¬¡å¼€å‘"><a href="#MyBatis-MyBatis-PlusäºŒæ¬¡å¼€å‘" class="headerlink" title="MyBatis &amp; MyBatis-PlusäºŒæ¬¡å¼€å‘"></a>MyBatis &amp; MyBatis-PlusäºŒæ¬¡å¼€å‘</h3><p>åœ¨ä½¿ç”¨MyBatiså¯¹æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå‘ç°å…¶æ— æ³•å¯¹create_timeç­‰å­—æ®µè‡ªåŠ¨æ’å…¥ï¼Œä¸”åœ¨å¾ˆå¤šæŸ¥è¯¢æ—¶éœ€è¦è‡ªåŠ¨åŠ å…¥del_flag &#x3D; 0è¿™ä¸ªæ¡ä»¶è¯­å¥ï¼Œä¸ºäº†å‡å°‘å¼€å‘é‡ï¼Œæˆ‘ä»¬éœ€è¦å¯¹MyBatisè¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå®ç°ä¸Šè¿°åŠŸèƒ½ã€‚</p><h4 id="æ‹¦æˆªMyBatis-SQLå¹¶è¿›è¡Œä¿®æ”¹"><a href="#æ‹¦æˆªMyBatis-SQLå¹¶è¿›è¡Œä¿®æ”¹" class="headerlink" title="æ‹¦æˆªMyBatis SQLå¹¶è¿›è¡Œä¿®æ”¹"></a>æ‹¦æˆªMyBatis SQLå¹¶è¿›è¡Œä¿®æ”¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> MyBatisQuerySqlInterceptor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-07-28</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">            method = &quot;prepare&quot;,</span></span><br><span class="line"><span class="meta">            args = &#123;Connection.class, Integer.class&#125;),</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisQuerySqlInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">StatementHandler</span> <span class="variable">statementHandler</span> <span class="operator">=</span> (StatementHandler) invocation.getTarget();</span><br><span class="line"></span><br><span class="line">        <span class="type">BoundSql</span> <span class="variable">boundSql</span> <span class="operator">=</span> statementHandler.getBoundSql();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> boundSql.getSql();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.contains(sql,<span class="string">&quot;WHERE&quot;</span>))&#123;</span><br><span class="line">            sql = sql.substring(<span class="number">0</span>,sql.length() - <span class="number">1</span>);</span><br><span class="line">            sql = sql + <span class="string">&quot; AND del_flag = &quot;</span> + NOT_DEL_FLAG;</span><br><span class="line"></span><br><span class="line">            sql = sql + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            sql = sql + <span class="string">&quot; WHERE (&quot;</span>;</span><br><span class="line">            sql = sql + <span class="string">&quot;del_flag = &quot;</span> + NOT_DEL_FLAG;</span><br><span class="line">            sql = sql + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> boundSql.getClass().getDeclaredField(<span class="string">&quot;sql&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(boundSql,sql);</span><br><span class="line"></span><br><span class="line">        log.info(boundSql.getSql().toString());</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> MyBatisSqlInterceptor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> ä¸ºMyBatisæ‰§è¡ŒSQLè‡ªåŠ¨æ’å…¥æŸäº›å…¬å…±æ¡ä»¶ æˆ– è‡ªåŠ¨æ’å…¥å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-07-28</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">        @Signature(type = Executor.class,</span></span><br><span class="line"><span class="meta">                method = &quot;query&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;),</span></span><br><span class="line"><span class="meta">        @Signature(</span></span><br><span class="line"><span class="meta">                type = Executor.class,</span></span><br><span class="line"><span class="meta">                method = &quot;update&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;MappedStatement.class, Object.class&#125;</span></span><br><span class="line"><span class="meta">        ),</span></span><br><span class="line"><span class="meta">//        @Signature(</span></span><br><span class="line"><span class="meta">//                type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">//                method = &quot;batch&quot;,</span></span><br><span class="line"><span class="meta">//                args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisUpdateSqlInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">MappedStatement</span> <span class="variable">mappedStatement</span> <span class="operator">=</span> (MappedStatement) invocation.getArgs()[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// è·å– SQL å‘½ä»¤</span></span><br><span class="line">        <span class="type">SqlCommandType</span> <span class="variable">sqlCommandType</span> <span class="operator">=</span> mappedStatement.getSqlCommandType();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åªåˆ¤æ–­æ–°å¢å’Œä¿®æ”¹</span></span><br><span class="line">        <span class="keyword">if</span> (SqlCommandType.INSERT.equals(sqlCommandType) || SqlCommandType.UPDATE.equals(sqlCommandType)) &#123;</span><br><span class="line">            <span class="comment">// è·å–å‚æ•°</span></span><br><span class="line"><span class="comment">//            Object parameter = invocation.getArgs()[1];</span></span><br><span class="line">            <span class="comment">// è·å–å‚æ•°</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">parameter</span> <span class="operator">=</span> invocation.getArgs()[<span class="number">1</span>];</span><br><span class="line">            setParameter(parameter, sqlCommandType);</span><br><span class="line"><span class="comment">//            //æ‰¹é‡æ“ä½œæ—¶</span></span><br><span class="line"><span class="comment">//            if (parameter instanceof MapperMethod.ParamMap) &#123;</span></span><br><span class="line"><span class="comment">//                MapperMethod.ParamMap map = (MapperMethod.ParamMap) parameter;</span></span><br><span class="line"><span class="comment">//                Object obj = map.get(&quot;list&quot;);</span></span><br><span class="line"><span class="comment">//                List&lt;?&gt; list = (List&lt;?&gt;) obj;</span></span><br><span class="line"><span class="comment">//                if (list != null) &#123;</span></span><br><span class="line"><span class="comment">//                    for (Object o : list) &#123;</span></span><br><span class="line"><span class="comment">//                        setParameter(o, sqlType);</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125; else &#123;</span></span><br><span class="line"><span class="comment">//                setParameter(parameter, sqlType);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParameter</span><span class="params">(Object parameter, SqlCommandType sqlCommandType)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        Class&lt;?&gt; aClass = parameter.getClass();</span><br><span class="line"><span class="comment">//        Field[] declaredFields;</span></span><br><span class="line">        List&lt;Field[]&gt; declaredFields = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// è·å–å½“å‰ç±»å’Œçˆ¶ç±»çš„å±æ€§</span></span><br><span class="line">        <span class="keyword">while</span>(ObjectUtils.isNotEmpty(aClass) &amp;&amp; aClass != Object.class)&#123;</span><br><span class="line">            declaredFields.add(aClass.getDeclaredFields());</span><br><span class="line">            aClass = aClass.getSuperclass();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Field[] fields : declaredFields)&#123;</span><br><span class="line">            <span class="keyword">for</span> (Field field : fields)&#123;</span><br><span class="line">                <span class="type">TableField</span> <span class="variable">annotation</span> <span class="operator">=</span> field.getAnnotation(TableField.class);</span><br><span class="line">                <span class="keyword">if</span> (ObjectUtils.isEmpty(annotation))&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (SqlCommandType.INSERT.equals(sqlCommandType)) &#123; <span class="comment">// insert è¯­å¥æ’å…¥ createBy</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> annotation.value();</span><br><span class="line">                    <span class="keyword">if</span>(StringUtils.equals(value,<span class="string">&quot;create_time&quot;</span>))&#123;</span><br><span class="line">                        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                        field.set(parameter, LocalDateTime.now());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(StringUtils.equals(value,<span class="string">&quot;update_time&quot;</span>))&#123;</span><br><span class="line">                        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                        field.set(parameter, LocalDateTime.now());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (SqlCommandType.UPDATE.equals(sqlCommandType)) &#123; <span class="comment">// update è¯­å¥æ’å…¥ updateTime</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> annotation.value();</span><br><span class="line">                    <span class="keyword">if</span>(StringUtils.equals(value,<span class="string">&quot;update_time&quot;</span>))&#123;</span><br><span class="line">                        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                        field.set(parameter, LocalDateTime.now());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> otherï¼Œé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>59 Springæºç </title>
      <link href="/2025/02/26/59%20Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
      <url>/2025/02/26/59%20Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="59-Springæºç "><a href="#59-Springæºç " class="headerlink" title="59 Springæºç "></a>59 Springæºç </h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä¸»è¦å€Ÿé‰´ç½‘ç»œä¸Šå¯¹Springæºç è§£æçš„æ–‡ç« ï¼Œå¹¶èå…¥è‡ªå·±çš„ç†è§£åå¾—åˆ°çš„è®°å½•æ–‡ç« ã€‚</p><p>å¸Œæœ›åœ¨è®°å½•çš„è¿‡ç¨‹ä¸­å¯ä»¥å¯¹Springçš„å¯åŠ¨ä»¥åŠç›¸å…³çš„æ€æƒ³æœ‰ä¸€å®šçš„äº†è§£å­¦ä¹ ã€‚</p><p>ä¹Ÿå¸Œæœ›åœ¨è¿™ä¸ªå­¦ä¹ çš„è¿‡ç¨‹ä¸­èƒ½å¤ŸåŠ æ·±å¯¹Springæ¡†æ¶çš„åŸºç¡€ç»“æ„ï¼Œå¯¹IoCã€Aopå’ŒMVCç­‰åŸºç¡€æ¦‚å¿µæœ‰äº†æ›´æ·±çš„äº†è§£ã€‚</p><p>å‚è€ƒèµ„æ–™æ¥è‡ªäºï¼š<a href="https://blog.csdn.net/qq_36882793/article/details/106440723">Springæºç åˆ†æï¼šå…¨é›†æ•´ç†</a></p><h2 id="Spring-Boot-å¯åŠ¨æµç¨‹"><a href="#Spring-Boot-å¯åŠ¨æµç¨‹" class="headerlink" title="Spring Boot å¯åŠ¨æµç¨‹"></a>Spring Boot å¯åŠ¨æµç¨‹</h2><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/qq_36882793/article/details/112305866">https://blog.csdn.net/qq_36882793/article/details/112305866</a></p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨Spring bootä¸­çš„å¯åŠ¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootDemoApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">run</span> <span class="operator">=</span> SpringApplication.run(SpringbootDemoApplication.class, args);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨è¿™æ®µä»£ç ä¸­å­˜åœ¨ä¸¤ä¸ªé‡ç‚¹ä»£ç ï¼š@SpringBootApplicationå’ŒSpringApplication.runï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«å¯¹è¿™äº›è¿›è¡Œè¯¦ç»†çš„è§£é‡Šã€‚</p><h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><p>è¯¥æ³¨è§£æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œå…¶æ³¨è§£æ˜¯ç”±å…¶å®ƒçš„æ³¨è§£ç»„åˆèµ·æ¥ä»è€Œå¾—åˆ°çš„ï¼Œä»–çš„ä½œç”¨å°±æ˜¯æ ‡è®°å’Œè¯´æ˜è¿™ä¸ªç±»æ˜¯Springbootçš„ä¸»é…ç½®ç±»ã€‚</p><p>è¯¥æ³¨è§£ä¸»è¦ç”±ä¸‹é¢ä¸‰ä¸ªæ³¨è§£ç»„æˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication = @SpringBootConfiguration + @EnableAutoConfiguration + @ComponentScan</span><br></pre></td></tr></table></figure><ol><li><blockquote><p>@SpringBootConfiguration<br>@SpringBootConfiguration &#x3D; @Configuration + @Component</p><p>è¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œè€Œé…ç½®ç±»ä¹Ÿæ˜¯Springå®¹å™¨ä¸­çš„ç»„ä»¶</p><p>è¯¥æ³¨è§£ä¸»è¦æ ‡è®°å¯åŠ¨ç±»ï¼Œå¹¶ä¸ºSpringbootåº”ç”¨æä¾›é¢å¤–çš„é…ç½®æ”¯æŒ</p></blockquote></li><li><blockquote><p>@EnableAutoConfiguration</p><p>@EnableConfiguration  &#x3D; @AutoConfigurationPackage + @Import</p><p><code>@EnableAutoConfiguration</code> æ˜¯ Spring Boot çš„æ ¸å¿ƒæ³¨è§£ä¹‹ä¸€ã€‚å®ƒçš„ä½œç”¨æ˜¯æ ¹æ®åº”ç”¨çš„ç±»è·¯å¾„ã€é¡¹ç›®æ‰€å£°æ˜çš„ Bean å®šä¹‰ä»¥åŠå…¶ä»–ç¯å¢ƒé…ç½®è‡ªåŠ¨é…ç½® Spring åº”ç”¨çš„ä¸Šä¸‹æ–‡ã€‚</p><p>@AutoConfigurationPackageè¯¥æ³¨è§£å°±æ˜¯å°†è¯¥å¯åŠ¨ç±»æ‰€åœ¨åŒ…ä»¥åŠå…¶å­åŒ…ä¸­çš„æ‰€æœ‰ç»„ä»¶éƒ½æ‰«æå¹¶åŠ è½½åˆ°Springçš„å®¹å™¨ä¸­ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨åˆ©ç”¨springbootè¿›è¡Œå¼€å‘çš„æ—¶å€™ï¼Œæ— è®ºæ˜¯Controllerè¿˜æ˜¯Serviceçš„è·¯å¾„éƒ½æ˜¯ä¸ä¸»é…ç½®ç±»åŒçº§æˆ–è€…æ¬¡çº§çš„åŸå› ã€‚</p></blockquote></li><li><blockquote><p>@ComponentScan</p><p>è¯¥æ³¨è§£ç”¨äºè‡ªåŠ¨æ‰«ææŒ‡å®šåŒ…åŠå­åŒ…ä¸­çš„Springç»„ä»¶ï¼Œè¿™é‡Œå’Œä¸Šé¢ä¸åŒä¹‹å¤„åœ¨äºï¼Œè¯¥æ³¨è§£æ”¯æŒæŒ‡å®šåŒ…ï¼Œä»–ä¼šå°†æŒ‡å®šåŒ…åŠå…¶å­åŒ…ä¸­æ‰€æœ‰çš„Springç»„ä»¶éƒ½æ³¨å†ŒæˆSpringå®¹å™¨ä¸­çš„Beansã€‚</p></blockquote></li></ol><h3 id="SpringApplication-runæ–¹æ³•"><a href="#SpringApplication-runæ–¹æ³•" class="headerlink" title="SpringApplication.runæ–¹æ³•"></a>SpringApplication.runæ–¹æ³•</h3><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥çœ‹SpringApplication.runè°ƒç”¨çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(Class&lt;?&gt;[] primarySources, String[] args)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SpringApplication</span>(primarySources).run(args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¥ç€å¾€å…¶è°ƒç”¨çš„runæ–¹æ³•çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> &#123;</span><br><span class="line"><span class="comment">// å¼€å¯å…³äºå¯åŠ¨æ—¶é—´çš„ä¿¡æ¯ç›‘æ§</span></span><br><span class="line"><span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">stopWatch.start();</span><br><span class="line"><span class="comment">// å‡†å¤‡ ApplicationContext</span></span><br><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//java.awt.headlessæ˜¯J2SEçš„ä¸€ç§æ¨¡å¼ç”¨äºåœ¨ç¼ºå°‘æ˜¾ç¤ºå±ã€é”®ç›˜æˆ–è€…é¼ æ ‡æ—¶çš„ç³»ç»Ÿé…ç½®ï¼Œå¾ˆå¤šç›‘æ§å·¥å…·å¦‚jconsole éœ€è¦å°†è¯¥å€¼è®¾ç½®ä¸ºtrueï¼Œç³»ç»Ÿå˜é‡é»˜è®¤ä¸ºtrue</span></span><br><span class="line">configureHeadlessProperty();</span><br><span class="line"><span class="comment">// 1. è·å–Springçš„ç›‘å¬å™¨ç±»ï¼Œè¿™é‡Œæ˜¯ä» spring.factories ä¸­å»è·å–ï¼Œé»˜è®¤çš„æ˜¯ä»¥ org.springframework.boot.SpringApplicationRunListener ä¸ºkey,è·å–åˆ°çš„ç›‘å¬å™¨ç±»å‹ä¸º EventPublishingRunListenerã€‚</span></span><br><span class="line"><span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line"><span class="comment">// 1.1 ç›‘å¬å™¨å‘é€å¯åŠ¨äº‹ä»¶</span></span><br><span class="line">listeners.starting();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// å°è£…å‚æ•°</span></span><br><span class="line"><span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(args);</span><br><span class="line"><span class="comment">// 2. æ„é€ å®¹å™¨ç¯å¢ƒã€‚å°†å®¹å™¨çš„ä¸€äº›é…ç½®å†…å®¹åŠ è½½åˆ° environment  ä¸­</span></span><br><span class="line"><span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners, applicationArguments);</span><br><span class="line"><span class="comment">// é…ç½®BeanInfoçš„å¿½ç•¥ ï¼šâ€œspring.beaninfo.ignoreâ€ï¼Œå€¼ä¸ºâ€œtrueâ€è¡¨ç¤ºè·³è¿‡å¯¹BeanInfoç±»çš„æœç´¢</span></span><br><span class="line">configureIgnoreBeanInfo(environment);</span><br><span class="line"><span class="comment">// æ‰“å°ä¿¡æ¯å¯¹è±¡</span></span><br><span class="line"><span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> printBanner(environment);</span><br><span class="line"><span class="comment">// 3. åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line">context = createApplicationContext();</span><br><span class="line"><span class="comment">// ä» spring.factries ä¸­è·å–é”™è¯¯æŠ¥å‘Šçš„ç±»ã€‚å‡ºé”™çš„æ—¶å€™ä¼šè°ƒç”¨å…¶æ–¹æ³•é€šçŸ¥</span></span><br><span class="line">exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; ConfigurableApplicationContext.class &#125;, context);</span><br><span class="line"><span class="comment">// 4. å‡†å¤‡åˆ·æ–°ä¸Šä¸‹æ–‡</span></span><br><span class="line">prepareContext(context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line"><span class="comment">// 5. åˆ·æ–°ä¸Šä¸‹æ–‡</span></span><br><span class="line">refreshContext(context);</span><br><span class="line"><span class="comment">// ç»“æŸåˆ·æ–°ï¼Œç•™å¾…æ‰©å±•åŠŸèƒ½ï¼Œå¹¶æœªå®ç°ä»€ä¹ˆ</span></span><br><span class="line">afterRefresh(context, applicationArguments);</span><br><span class="line"><span class="comment">// åœæ­¢ç›‘å¬</span></span><br><span class="line">stopWatch.stop();</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) &#123;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç›‘å¬å™¨å‘é€å¯åŠ¨ç»“æŸæ—¶é—´</span></span><br><span class="line">listeners.started(context);</span><br><span class="line"><span class="comment">// è°ƒç”¨ ApplicationRunner å’Œ CommandLineRunner å¯¹åº”çš„æ–¹æ³•</span></span><br><span class="line">callRunners(context, applicationArguments);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">handleRunFailure(context, ex, exceptionReporters, listeners);</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// å‘é€å®¹å™¨è¿è¡Œäº‹ä»¶</span></span><br><span class="line">listeners.running(context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">handleRunFailure(context, ex, exceptionReporters, <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Spring-IoC"><a href="#Spring-IoC" class="headerlink" title="Spring IoC"></a>Spring IoC</h2><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/weixin_51146329/article/details/140086129?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522AA3F56AE-6CB8-4C56-B60E-3FF70F24D9E3%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=AA3F56AE-6CB8-4C56-B60E-3FF70F24D9E3&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-140086129-null-null.142%5Ev100%5Epc_search_result_base9&utm_term=Spring%20IOC%E6%BA%90%E7%A0%81&spm=1018.2226.3001.4187">ã€Springæˆç¥ä¹‹è·¯ã€‘ä¸€æ¬¡SpringIOCæºç ä¹‹æ—…ï¼Œå¥³æœ‹å‹ä¹Ÿæˆä¸ºäº†Springå¤§ç¥ï¼</a></p><h3 id="å‰è¨€-1"><a href="#å‰è¨€-1" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä»Spring IOCçš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸ç›´è§‚çš„æ„Ÿå—åˆ°Spring IOCä»£æ›¿æˆ‘ä»¬ç¨‹åºå‘˜å®Œæˆäº†ä¸€ä¸ªå¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†è¿‡ç¨‹ã€‚</p><p>ä¹Ÿè®¸ä½ è§‰å¾—ä¸å°±æ˜¯new ä¸€ä¸ªå¯¹è±¡å—ï¼Œä½•å¿…éœ€è¦ä¸“é—¨è®¾è®¡ä¸€ä¸ªIOCæ¥æ›¿æˆ‘ä»¬ç®¡ç†å‘¢ï¼Ÿè¿™æ ·ä¸æ˜¯åè€Œä¼šæ›´å¤æ‚å—ï¼Ÿä¹Ÿè®¸æˆ‘ä»¬å¯èƒ½æƒ³é”™äº†ï¼Œå¦‚æœåœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­è¶Šæ¥è¶Šå¤æ‚ï¼Œä¸€ä¸ªå¯¹è±¡çš„ä¾èµ–å…³ç³»ä¼šè¶Šæ¥è¶Šå¤æ‚ï¼Œæ¯”å¦‚ç±»AåŒæ—¶ä¾èµ–ç±»Bã€ç±»Cã€ç±»Dï¼Œè€Œç±»Båˆä¾èµ–ç±»Xã€ç±»Yã€ç±»Zï¼Œå½“ä½ å°è¯•<code>new</code>ä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ä¸å¯é¿å…çš„ä¼šæ„Ÿè§‰å¿ƒç´¯ã€‚</p><h3 id="æºç è§£è¯»"><a href="#æºç è§£è¯»" class="headerlink" title="æºç è§£è¯»"></a>æºç è§£è¯»</h3><p>æ—¢ç„¶Spring IOCæ˜¯æ›¿æˆ‘ä»¬ç®¡ç†ç€æ‰€æœ‰çš„Beanï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦é€šè¿‡æºç å»çœ‹ä»–çš„è®¾è®¡æ€æƒ³çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å¸¦ç€â€œBeanå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿä»€ä¹ˆæ—¶å€™å®ä¾‹åŒ–ï¼Ÿæ€ä¹ˆè·å–çš„ï¼Ÿâ€ä¸‰ä¸ªé—®é¢˜æ¥çœ‹Spring IOCæºç ã€‚</p><p>é¦–å…ˆæ¥çœ‹çœ‹Spring åŠ è½½æ—¶çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;application.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;context å¯åŠ¨æˆåŠŸ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(userService.selectList());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathXmlApplicationContext</span> <span class="keyword">extends</span> <span class="title class_">AbstractXmlApplicationContext</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClassPathXmlApplicationContext</span><span class="params">(String configLocation)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="keyword">new</span> <span class="title class_">String</span>[] &#123;configLocation&#125;, <span class="literal">true</span>, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClassPathXmlApplicationContext</span><span class="params">(String[] configLocations, <span class="type">boolean</span> refresh, ApplicationContext parent)</span></span><br><span class="line">        <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>(parent);</span><br><span class="line">        setConfigLocations(configLocations);</span><br><span class="line">        <span class="keyword">if</span> (refresh) &#123;</span><br><span class="line">            refresh();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä»£ç å¯ä»¥åˆ†æå‡ºSpringå®¹å™¨åˆ›å»ºçš„æ—¶å€™å°±å®Œæˆäº†Spring Beançš„æ³¨å…¥ã€‚</p><p>è¿™é‡Œæœ€é‡è¦çš„æ˜¯refresh()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè§¦å‘Springå®¹å™¨çš„åˆ·æ–°ï¼ŒåŠ è½½Beançš„å®šä¹‰ã€‚å®ƒè´Ÿè´£æ•´ä¸ªIOCå®¹å™¨çš„åˆå§‹åŒ–å’Œåˆ·æ–°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">        <span class="comment">// 1. å‡†å¤‡åˆ·æ–°ä¸Šä¸‹æ–‡ç¯å¢ƒ</span></span><br><span class="line">        prepareRefresh();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºå¹¶è·å– `BeanFactory`</span></span><br><span class="line">        <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. å‡†å¤‡ BeanFactoryï¼Œè®¾ç½®ç›¸å…³é…ç½®</span></span><br><span class="line">        prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 4. å…è®¸å­ç±»å®ç°çš„é¢å¤–æ“ä½œ</span></span><br><span class="line">            postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5. è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ BeanFactoryPostProcessor</span></span><br><span class="line">            invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6. æ³¨å†Œ BeanPostProcessors</span></span><br><span class="line">            registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7. åˆå§‹åŒ–ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚å›½é™…åŒ–ã€äº‹ä»¶ç­‰ï¼‰</span></span><br><span class="line">            initMessageSource();</span><br><span class="line">            initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 8. åˆå§‹åŒ–å…¶ä»–ç‰¹æ®Š beanï¼ˆå¦‚ ApplicationListenerï¼‰</span></span><br><span class="line">            onRefresh();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 9. å®Œæˆæ‰€æœ‰å•ä¾‹ bean çš„é¢„å®ä¾‹åŒ–</span></span><br><span class="line">            finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 10. å®Œæˆåˆ·æ–°è¿‡ç¨‹ï¼Œå‘å¸ƒç›¸åº”äº‹ä»¶</span></span><br><span class="line">            finishRefresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">            destroyBeans();</span><br><span class="line">            cancelRefresh(ex);</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            resetCommonCaches();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Spring-Beanç®¡ç†"><a href="#Spring-Beanç®¡ç†" class="headerlink" title="Spring Beanç®¡ç†"></a>Spring Beanç®¡ç†</h2><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/mr_xioabai/article/details/129865414?ops_request_misc=%257B%2522request%255Fid%2522%253A%252224449F8C-B35C-4AD5-9AEF-FED26D190A5F%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=24449F8C-B35C-4AD5-9AEF-FED26D190A5F&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-129865414-null-null.142%5Ev100%5Epc_search_result_base9&utm_term=Spring%20%E6%98%AF%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86Bean%E7%9A%84&spm=1018.2226.3001.4187">Springä¸­çš„Beançš„ç®¡ç†ï¼ˆå²ä¸Šæœ€å…¨ï¼‰</a></p><h3 id="å‰è¨€-2"><a href="#å‰è¨€-2" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>Springçš„æœ¬è´¨æ˜¯ä¸€ä¸ªbeanå·¥å‚(beanFactory)æˆ–è€…è¯´beanå®¹å™¨ï¼Œå®ƒæŒ‰ç…§æˆ‘ä»¬çš„è¦æ±‚ï¼Œç”Ÿäº§æˆ‘ä»¬éœ€è¦çš„å„ç§å„æ ·çš„beanï¼Œæä¾›ç»™æˆ‘ä»¬ä½¿ç”¨ã€‚åªæ˜¯åœ¨ç”Ÿäº§beançš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è§£å†³beanä¹‹é—´çš„ä¾èµ–é—®é¢˜ï¼Œæ‰å¼•å…¥äº†ä¾èµ–æ³¨å…¥(DI)è¿™ç§æŠ€æœ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ä¾èµ–æ³¨å…¥æ˜¯beanFactoryç”Ÿäº§beanæ—¶ä¸ºäº†è§£å†³beanä¹‹é—´çš„ä¾èµ–çš„ä¸€ç§æŠ€æœ¯è€Œå·²ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>58 MySQL</title>
      <link href="/2025/02/26/58%20MySQL/"/>
      <url>/2025/02/26/58%20MySQL/</url>
      
        <content type="html"><![CDATA[<h1 id="58-MySQL"><a href="#58-MySQL" class="headerlink" title="58 MySQL"></a>58 MySQL</h1><h2 id="MySQLåŸºç¡€"><a href="#MySQLåŸºç¡€" class="headerlink" title="MySQLåŸºç¡€"></a>MySQLåŸºç¡€</h2><h3 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h3><p>å…ƒç»„ï¼šå…³ç³»æ˜¯â¼€å¼ è¡¨ï¼Œè¡¨ä¸­çš„æ¯â¾ï¼ˆå³æ•°æ®åº“ä¸­çš„ æ¯æ¡è®°å½•ï¼‰å°±æ˜¯â¼€ä¸ªå…ƒç»„ï¼Œæ¯åˆ—å°±æ˜¯â¼€ä¸ªå±æ€§ã€‚ åœ¨â¼†ç»´è¡¨â¾¥ï¼Œå…ƒç»„ä¹Ÿç§°ä¸º**â¾**ï¼›</p><p>ç ï¼šç æŒ‡çš„æ˜¯èƒ½å¤Ÿå”¯ä¸€æ ‡è¯†&#x2F;åŒºåˆ†å…ƒç»„ï¼ˆè¡Œï¼‰çš„ä¸€ä¸ªæˆ–è€…ä¸€ç»„å±æ€§ï¼›</p><p>å€™é€‰ç ï¼šåœ¨ä¸€ä¸ªæ•°æ®è¡¨ä¸­ç å¯èƒ½å­˜åœ¨å¾ˆå¤šç»„ï¼Œè€Œåœ¨è¿™äº›ç ä¸­å­˜åœ¨<strong>å…¶ä»»ä½•å­é›†éƒ½ä¸èƒ½å”¯ä¸€æ ‡è¯†è¯¥å…ƒç»„çš„ç </strong>æˆ‘ä»¬ç§°ä¹‹ä¸ºå€™é€‰ç ï¼›</p><p>ä¸»ç ï¼šä¸€ä¸ªè¡¨å­˜åœ¨å¤šä¸ªå€™é€‰ç ï¼Œä»å€™é€‰ç ä¸­é€‰å‡ºä¸€ä¸ªï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå€™é€‰ç ç§°ä¹‹ä¸ºä¸»ç ï¼Œä¸€ä¸ªè¡¨åªèƒ½å­˜åœ¨ä¸€ä¸ªä¸»ç ï¼Œæˆ‘ä»¬ä¹Ÿç§°ä¸»ç ä¸ºä¸»é”®ï¼›</p><p>å¤–ç ï¼šæˆ‘ä»¬ç±»æ¯”ä¸€ä¸‹ï¼Œå¤–ç å°±æ˜¯éæœ¬è¡¨çš„ä¸»ç ï¼›</p><p>ä¸»å±æ€§ï¼šå‡ºç°åœ¨å€™é€‰ç ä¸­çš„å±æ€§éƒ½ç§°ä¸ºä¸»å±æ€§ï¼›</p><p>éä¸»å±æ€§ï¼šåœ¨è¿™ä¸ªè¡¨ä¸­çš„æ‰€æœ‰å±æ€§ä¸­ï¼Œåªè¦ä¸æ˜¯ä¸»å±æ€§å°±æ˜¯éä¸»å±æ€§ã€‚</p><h4 id="ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨å¤–é”®å’Œçº§è”"><a href="#ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨å¤–é”®å’Œçº§è”" class="headerlink" title="ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨å¤–é”®å’Œçº§è”"></a>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨å¤–é”®å’Œçº§è”</h4><p>åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¤–é”®å¯èƒ½ä¼šé€ æˆçº§è”æ›´æ–°ï¼Œçº§è”æ›´æ–°æ˜¯å¼ºé˜»å¡ï¼Œå­˜ åœ¨æ•°æ®åº“æ›´æ–°â»›æš´çš„â»›é™©; å¤–é”®å½±å“æ•°æ®åº“çš„æ’â¼Šé€Ÿåº¦ã€‚</p><p>å¤–é”®åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¼šå¢åŠ å¤æ‚æ€§ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†é¢å¤–å·¥ä½œï¼Œå¯¹åˆ†åº“åˆ†è¡¨ä¸å‹å¥½ï¼›</p><h4 id="æ•°æ®åº“èŒƒå¼"><a href="#æ•°æ®åº“èŒƒå¼" class="headerlink" title="æ•°æ®åº“èŒƒå¼"></a>æ•°æ®åº“èŒƒå¼</h4><h5 id="ç¬¬ä¸€èŒƒå¼"><a href="#ç¬¬ä¸€èŒƒå¼" class="headerlink" title="ç¬¬ä¸€èŒƒå¼"></a>ç¬¬ä¸€èŒƒå¼</h5><p>é€šä¿—çš„æ¥è®²å°±æ˜¯åœ¨ä¸€ä¸ªè¡¨ä¸­çš„å±æ€§ä¸å¯åˆ†å‰²ï¼Œå³ä¸å¯å†åˆ†ï¼Œ1NFæ˜¯æ‰€æœ‰å…³ç³»å‹æ•°æ®åº“çš„æœ€åŸºæœ¬è¦æ±‚ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006719.png" alt="image-20240906144004121"></p><h5 id="ç¬¬äºŒèŒƒå¼"><a href="#ç¬¬äºŒèŒƒå¼" class="headerlink" title="ç¬¬äºŒèŒƒå¼"></a>ç¬¬äºŒèŒƒå¼</h5><p><strong>2NF åœ¨ 1NF çš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¶ˆé™¤äº†â¾®ä¸»å±æ€§å¯¹äºç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚</strong></p><p><strong>ç¬¬äºŒèŒƒå¼éœ€è¦ç¡®ä¿æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å’Œä¸»é”®ç›¸å…³ï¼Œè€Œä¸èƒ½åªä¸ä¸»é”®çš„æŸä¸€éƒ¨åˆ†ç›¸å…³ï¼ˆä¸»è¦é’ˆå¯¹è”åˆä¸»é”®è€Œè¨€ï¼‰ã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006551.png" alt="image-20240906144228145"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006981.png" alt="image-20240906145007347"></p><h5 id="ç¬¬ä¸‰èŒƒå¼"><a href="#ç¬¬ä¸‰èŒƒå¼" class="headerlink" title="ç¬¬ä¸‰èŒƒå¼"></a>ç¬¬ä¸‰èŒƒå¼</h5><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006282.png" alt="image-20240906144716968"></p><p>**3NF åœ¨ 2NF çš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¶ˆé™¤äº†â¾®ä¸»å±æ€§å¯¹äºç çš„ä¼ é€’å‡½æ•°ä¾èµ– ã€‚**ç¬¦åˆ 3NF è¦æ±‚çš„æ•°æ®åº“è®¾è®¡ï¼Œ åŸºæœ¬ä¸Šè§£å†³äº†æ•°æ®å†—ä½™è¿‡â¼¤ï¼Œæ’â¼Šå¼‚å¸¸ï¼Œä¿®æ”¹å¼‚å¸¸ï¼Œåˆ é™¤å¼‚å¸¸çš„é—®é¢˜ã€‚</p><p><strong>åœ¨2NFåŸºç¡€ä¸Šï¼Œä»»ä½•éä¸»å±æ€§(opens new window)ä¸ä¾èµ–äºå…¶å®ƒéä¸»å±æ€§ï¼ˆåœ¨2NFåŸºç¡€ä¸Šæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼‰ã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006137.png" alt="image-20240906144832578"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006634.png" alt="image-20240906145143433"></p><h4 id="dropã€delete-ä¸-truncate-åŒºåˆ«ï¼Ÿ"><a href="#dropã€delete-ä¸-truncate-åŒºåˆ«ï¼Ÿ" class="headerlink" title="dropã€delete ä¸ truncate åŒºåˆ«ï¼Ÿ"></a>dropã€delete ä¸ truncate åŒºåˆ«ï¼Ÿ</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006417.png" alt="image-20240906162330746"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006693.png" alt="image-20240906162517712"></p><h4 id="å¸¸è§å…³ç³»å‹æ•°æ®åº“"><a href="#å¸¸è§å…³ç³»å‹æ•°æ®åº“" class="headerlink" title="å¸¸è§å…³ç³»å‹æ•°æ®åº“"></a>å¸¸è§å…³ç³»å‹æ•°æ®åº“</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006292.png" alt="image-20240906163157862"></p><h4 id="MySQLåŸºç¡€æ¶æ„"><a href="#MySQLåŸºç¡€æ¶æ„" class="headerlink" title="MySQLåŸºç¡€æ¶æ„"></a>MySQLåŸºç¡€æ¶æ„</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006522.png" alt="image-20240909190029815"></p><p>MySQLæŸ¥è¯¢ç¼“å­˜åœ¨MySQL8.0ä¹‹åè¢«ç§»é™¤ï¼Œå› ä¸ºå…¶çš„å®ç”¨æ€§å¹¶ä¸æ˜¯å¾ˆå¥½ã€‚</p><h4 id="ä½•æ—¶é€‰æ‹©SQLåˆä»€ä¹ˆæ—¶å€™é€‰æ‹©NoSQLå‘¢"><a href="#ä½•æ—¶é€‰æ‹©SQLåˆä»€ä¹ˆæ—¶å€™é€‰æ‹©NoSQLå‘¢" class="headerlink" title="ä½•æ—¶é€‰æ‹©SQLåˆä»€ä¹ˆæ—¶å€™é€‰æ‹©NoSQLå‘¢"></a>ä½•æ—¶é€‰æ‹©SQLåˆä»€ä¹ˆæ—¶å€™é€‰æ‹©NoSQLå‘¢</h4><p>å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œä¸»è¦é’ˆå¯¹äºSQLæ»¡è¶³å››å¤§ç‰¹æ€§ï¼Œå³ACIDï¼Œè€ŒNoSQLæ»¡è¶³BASDã€‚è¿™åˆ†åˆ«ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>SQLï¼šåŸå­æ€§ã€æŒä¹…æ€§ã€éš”ç¦»æ€§ä¿è¯äº†å¼ºä¸€è‡´æ€§ï¼Œè€ŒNoSQLåªä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ‰€ä»¥åœ¨å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ä¸­å¦‚æœå¯¹æ•°æ®è¦æ±‚å¼ºä¸€è‡´æ€§çš„è¯è€ƒè™‘SQLæ•°æ®åº“ã€‚</p><p>ä½†æ˜¯NoSQLå¯æ‰©å±•æ€§å¾ˆå¥½ï¼Œä¸”æ•°æ®ç›´æ¥æ˜¯æ— å…³ç³»çš„ã€‚NoSQLæ•°æ®ä¹‹é—´æ— å…³ç³»ï¼Œè¿™æ ·å°±éå¸¸å®¹æ˜“æ‰©å±•ï¼Œä¹Ÿæ— å½¢ä¹‹é—´ï¼Œåœ¨æ¶æ„çš„å±‚é¢ä¸Šå¸¦æ¥äº†å¯æ‰©å±•çš„èƒ½åŠ›ã€‚æ¯”å¦‚ redis è‡ªå¸¦ä¸»ä»å¤åˆ¶æ¨¡å¼ã€å“¨å…µæ¨¡å¼ã€åˆ‡ç‰‡é›†ç¾¤æ¨¡å¼ã€‚ ç›¸åå…³ç³»å‹æ•°æ®åº“çš„æ•°æ®ä¹‹é—´å­˜åœ¨å…³è”æ€§ï¼Œæ°´å¹³æ‰©å±•è¾ƒéš¾ ï¼Œéœ€è¦è§£å†³è·¨æœåŠ¡å™¨ JOINï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ç­‰é—®é¢˜ã€‚</p><h4 id="MySQLå¦‚ä½•è¿›è¡Œè”è¡¨æŸ¥è¯¢"><a href="#MySQLå¦‚ä½•è¿›è¡Œè”è¡¨æŸ¥è¯¢" class="headerlink" title="MySQLå¦‚ä½•è¿›è¡Œè”è¡¨æŸ¥è¯¢"></a>MySQLå¦‚ä½•è¿›è¡Œè”è¡¨æŸ¥è¯¢</h4><h5 id="å†…è¿æ¥ï¼ˆINNER-JOIN"><a href="#å†…è¿æ¥ï¼ˆINNER-JOIN" class="headerlink" title="å†…è¿æ¥ï¼ˆINNER JOIN)"></a>å†…è¿æ¥ï¼ˆINNER JOIN)</h5><p>ä¸€å¥è¯ï¼š<strong>å†…è¿æ¥</strong>ä¼šè¿”å›ä¸¤ä¸ªè¡¨ä¸­<strong>æ»¡è¶³è¿æ¥æ¡ä»¶</strong>çš„åŒ¹é…è®°å½•ï¼Œè¿‡æ»¤æ‰ä¸åŒ¹é…çš„è®°å½•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> åˆ—å</span><br><span class="line"><span class="keyword">FROM</span> è¡¨<span class="number">1</span></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> è¡¨<span class="number">2</span></span><br><span class="line"><span class="keyword">ON</span> è¡¨<span class="number">1.</span>å…³è”åˆ— <span class="operator">=</span> è¡¨<span class="number">2.</span>å…³è”åˆ—;</span><br></pre></td></tr></table></figure><h5 id="å·¦å¤–è¿æ¥-LEFT-JOIN"><a href="#å·¦å¤–è¿æ¥-LEFT-JOIN" class="headerlink" title="å·¦å¤–è¿æ¥ (LEFT JOIN)"></a>å·¦å¤–è¿æ¥ (LEFT JOIN)</h5><p>ä¸€å¥è¯ï¼šè¿”å›å·¦è¡¨ï¼ˆä¸»è¡¨ï¼‰çš„æ‰€æœ‰è®°å½•ï¼Œå³ä½¿å³è¡¨æ²¡æœ‰åŒ¹é…ã€‚ è‹¥å³è¡¨æ— åŒ¹é…ï¼Œå³è¡¨å­—æ®µæ˜¾ç¤ºä¸º NULLã€‚ æ ¸å¿ƒé€»è¾‘ï¼šâ€œå·¦è¡¨ä¸ºä¸»ï¼Œå³è¡¨è¡¥å……â€ã€‚</p><h5 id="å³å¤–è¿æ¥-RIGHT-JOIN"><a href="#å³å¤–è¿æ¥-RIGHT-JOIN" class="headerlink" title="å³å¤–è¿æ¥ (RIGHT JOIN)"></a>å³å¤–è¿æ¥ (RIGHT JOIN)</h5><p>ä¸€å¥è¯ï¼šè¿”å›å³è¡¨ï¼ˆä¸»è¡¨ï¼‰çš„æ‰€æœ‰è®°å½•ï¼Œå³ä½¿å·¦è¡¨æ²¡æœ‰åŒ¹é…ã€‚ è‹¥å·¦è¡¨æ— åŒ¹é…ï¼Œå·¦è¡¨å­—æ®µæ˜¾ç¤ºä¸º NULLã€‚ æ ¸å¿ƒé€»è¾‘ï¼šâ€œå³è¡¨ä¸ºä¸»ï¼Œå·¦è¡¨è¡¥å……â€ã€‚</p><h5 id="å…¨å¤–è¿æ¥"><a href="#å…¨å¤–è¿æ¥" class="headerlink" title="å…¨å¤–è¿æ¥"></a>å…¨å¤–è¿æ¥</h5><p>ä¸€å¥è¯ï¼šéƒ½è¦ï¼Œä¸ºNulléƒ½è¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503121411192.png" alt="image-20250312141103084"></p><h4 id="Group-By-èšåˆå‡½æ•°"><a href="#Group-By-èšåˆå‡½æ•°" class="headerlink" title="Group By èšåˆå‡½æ•°"></a>Group By èšåˆå‡½æ•°</h4><p><a href="https://so.csdn.net/so/search?q=%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0&spm=1001.2101.3001.7020">èšåˆå‡½æ•°</a>å¯¹ä¸€ç»„å€¼è¿›è¡Œè®¡ç®—å¹¶è¿”å›å•ä¸€çš„å€¼ï¼Œé€šå¸¸èšåˆå‡½æ•°ä¼šä¸SELECTè¯­å¥çš„GROUP BYå­å¥ä¸€åŒä½¿ç”¨ï¼Œåœ¨ä¸GROUP BYå­å¥ä½¿ç”¨æ—¶ï¼Œèšåˆå‡½æ•°ä¼šä¸ºæ¯ä¸€ä¸ªç»„äº§ç”Ÿä¸€ä¸ªå•ä¸€å€¼ï¼Œè€Œä¸ä¼šä¸ºæ•´ä¸ªè¡¨äº§ç”Ÿä¸€ä¸ªå•ä¸€å€¼.</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503121434191.png" alt="image-20250312143404138"></p><h4 id="SQLæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåºæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"><a href="#SQLæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåºæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ" class="headerlink" title="SQLæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåºæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"></a>SQLæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåºæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503121446316.png" alt="image-20250312144616250"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(9) SELECT </span><br><span class="line">(10) DISTINCT &lt;column&gt;,</span><br><span class="line">(6) AGG_FUNC &lt;column&gt; or &lt;expression&gt;, ...</span><br><span class="line">(1) FROM &lt;left_table&gt; </span><br><span class="line">    (3) &lt;join_type&gt;JOIN&lt;right_table&gt;</span><br><span class="line">    (2) ON&lt;join_condition&gt;</span><br><span class="line">(4) WHERE &lt;where_condition&gt;</span><br><span class="line">(5) GROUP BY &lt;group_by_list&gt;</span><br><span class="line">(7) WITH &#123;CUBE|ROLLUP&#125;</span><br><span class="line">(8) HAVING &lt;having_condtion&gt;</span><br><span class="line">(11) ORDER BY &lt;order_by_list&gt;</span><br><span class="line">(12) LIMIT &lt;limit_number&gt;;</span><br></pre></td></tr></table></figure><h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>SQLï¼ˆStructured Query Languageï¼‰æ˜¯â€œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€â€ï¼Œå®ƒæ˜¯å¯¹å…³ç³»å‹æ•°æ®åº“çš„æ“ä½œè¯­è¨€ã€‚å®ƒå¯ä»¥åº”ç”¨åˆ°æ‰€æœ‰å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œä¾‹å¦‚ï¼šMySQLã€Oracleã€SQL Server ç­‰ã€‚SQL æ ‡å‡†ï¼ˆANSI&#x2F;ISOï¼‰æœ‰ï¼š</p><p>SQL-92ï¼š1992 å¹´å‘å¸ƒçš„ SQL è¯­è¨€æ ‡å‡†ï¼›</p><p>SQL:1999ï¼š1999 å¹´å‘å¸ƒçš„ SQL è¯­è¨€æ ‡ç­¾ï¼›</p><p>SQL:2003ï¼š2003 å¹´å‘å¸ƒçš„ SQL è¯­è¨€æ ‡ç­¾ï¼›</p><p>è¿™äº›æ ‡å‡†å°±ä¸ JDK çš„ç‰ˆæœ¬ä¸€æ ·ï¼Œåœ¨æ–°çš„ç‰ˆæœ¬ä¸­æ€»è¦æœ‰ä¸€äº›è¯­æ³•çš„å˜åŒ–ã€‚ä¸åŒæ—¶æœŸçš„æ•°æ®åº“å¯¹ä¸åŒæ ‡å‡†åšäº†å®ç°ã€‚</p><p>è™½ç„¶ SQL å¯ä»¥ç”¨åœ¨æ‰€æœ‰å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œä½†å¾ˆå¤šæ•°æ®åº“è¿˜éƒ½æœ‰æ ‡å‡†ä¹‹åçš„ä¸€äº›è¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºâ€œæ–¹è¨€â€ã€‚ä¾‹å¦‚ MySQL ä¸­çš„ LIMIT è¯­å¥å°±æ˜¯ MySQL ç‹¬æœ‰çš„æ–¹è¨€ï¼Œå…¶å®ƒæ•°æ®åº“éƒ½ä¸æ”¯æŒï¼å½“ç„¶ï¼ŒOracle æˆ– SQL Server éƒ½æœ‰è‡ªå·±çš„æ–¹è¨€ã€‚</p><ul><li>SQL è¯­å¥å¯ä»¥å•è¡Œæˆ–å¤šè¡Œä¹¦å†™ï¼Œä»¥åˆ†å·ç»“å°¾ï¼›</li><li>å¯ä»¥ç”¨ç©ºæ ¼å’Œç¼©è¿›æ¥æ¥å¢å¼ºè¯­å¥çš„å¯è¯»æ€§ï¼›</li><li>å…³é”®å­—ä¸åŒºåˆ«å¤§å°å†™ï¼Œå»ºè®®ä½¿ç”¨å¤§å†™ï¼›</li></ul><h4 id="SQLåˆ†ç±»"><a href="#SQLåˆ†ç±»" class="headerlink" title="SQLåˆ†ç±»"></a>SQLåˆ†ç±»</h4><ol><li><p>DDLï¼ˆData Definition Languageï¼‰ï¼šæ•°æ®å®šä¹‰è¯­è¨€ï¼Œç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡ï¼šåº“ã€è¡¨ã€åˆ—ç­‰ï¼›</p></li><li><p>DMLï¼ˆData Manipulation Languageï¼‰ï¼šæ•°æ®æ“ä½œè¯­è¨€ï¼Œç”¨æ¥å®šä¹‰æ•°æ®åº“è®°å½•ï¼ˆæ•°æ®ï¼‰ï¼›</p></li><li><p>DCLï¼ˆData Control Languageï¼‰ï¼šæ•°æ®æ§åˆ¶è¯­è¨€ï¼Œç”¨æ¥å®šä¹‰è®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«ï¼›</p></li><li><p>DQLï¼ˆData Query Languageï¼‰ï¼šæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œç”¨æ¥æŸ¥è¯¢è®°å½•ï¼ˆæ•°æ®ï¼‰</p></li></ol><h4 id="DDLï¼ˆData-Definition-Languageï¼‰ï¼šæ•°æ®å®šä¹‰è¯­è¨€"><a href="#DDLï¼ˆData-Definition-Languageï¼‰ï¼šæ•°æ®å®šä¹‰è¯­è¨€" class="headerlink" title="DDLï¼ˆData Definition Languageï¼‰ï¼šæ•°æ®å®šä¹‰è¯­è¨€"></a>DDLï¼ˆData Definition Languageï¼‰ï¼šæ•°æ®å®šä¹‰è¯­è¨€</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases; <span class="operator">/</span><span class="operator">/</span> æŸ¥çœ‹å½“å‰å»ºç«‹çš„æ‰€æœ‰æ•°æ®åº“</span><br><span class="line">use mysqldb; <span class="operator">/</span><span class="operator">/</span> åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“</span><br><span class="line"><span class="keyword">create</span> database [if <span class="keyword">not</span> <span class="keyword">exists</span>] mydb1; <span class="operator">/</span><span class="operator">/</span> åˆ›å»ºæ•°æ®åº“ å¦‚æœæ²¡æœ‰å­˜åœ¨çš„è¯</span><br><span class="line"><span class="keyword">drop</span> database [if <span class="keyword">exists</span>] mydb1; <span class="operator">/</span><span class="operator">/</span> åˆ é™¤æŒ‡å®šæ•°æ®åº“</span><br><span class="line"><span class="keyword">alter</span> database mydb1 <span class="keyword">character set</span> utf8; <span class="operator">/</span><span class="operator">/</span> ä¿®æ”¹æ•°æ®åº“ç¼–ç </span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> åˆ›å»ºè¡¨</span><br><span class="line"><span class="keyword">CREATE TABLE</span> stu(</span><br><span class="line">sid <span class="type">CHAR</span>(<span class="number">6</span>), </span><br><span class="line">sname <span class="type">VARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">age <span class="type">INT</span>, </span><br><span class="line">gender <span class="type">VARCHAR</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> è¡¨åï¼› <span class="operator">/</span><span class="operator">/</span> æŸ¥çœ‹è¡¨çš„ç»“æ„</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> è¡¨åï¼› <span class="operator">/</span><span class="operator">/</span> åˆ é™¤è¡¨</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ä¿®æ”¹è¡¨</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> æ·»åŠ åˆ—ï¼šç»™ stu è¡¨æ·»åŠ  classname åˆ—</span><br><span class="line"><span class="keyword">ALTER TABLE</span> stu <span class="keyword">ADD</span> (classname <span class="type">varchar</span>(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ä¿®æ”¹åˆ—çš„æ•°æ®ç±»å‹ï¼šä¿®æ”¹ stu è¡¨çš„ gender åˆ—ç±»å‹ä¸º <span class="type">CHAR</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">ALTER TABLE</span> stu MODIFY gender <span class="type">CHAR</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ä¿®æ”¹åˆ—åï¼šä¿®æ”¹ stu è¡¨çš„ gender åˆ—åä¸º sex</span><br><span class="line"><span class="keyword">ALTER TABLE</span> stu change gender sex <span class="type">CHAR</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> åˆ é™¤åˆ—ï¼šåˆ é™¤ stu è¡¨çš„ classname åˆ—</span><br><span class="line"><span class="keyword">ALTER TABLE</span> stu <span class="keyword">DROP</span> classname;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ä¿®æ”¹è¡¨åç§°ï¼šä¿®æ”¹ stu è¡¨åç§°ä¸º student</span><br><span class="line"><span class="keyword">ALTER TABLE</span> stu RENAME <span class="keyword">TO</span> student;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ•°æ®ç±»å‹ï¼š</p><ul><li>intï¼šæ•´å‹</li><li>doubleï¼šæµ®ç‚¹å‹ï¼Œä¾‹å¦‚ double(5,2)è¡¨ç¤ºæœ€å¤š 5 ä½ï¼Œå…¶ä¸­å¿…é¡»æœ‰ 2 ä½å°æ•°ï¼Œå³æœ€å¤§å€¼ä¸º 999.99ï¼›</li><li>decimalï¼šæ³›å‹å‹ï¼Œåœ¨è¡¨å•çº¿æ–¹é¢ä½¿ç”¨è¯¥ç±»å‹ï¼Œå› ä¸ºä¸ä¼šå‡ºç°ç²¾åº¦ç¼ºå¤±é—®é¢˜ï¼›</li><li>charï¼šå›ºå®šé•¿åº¦å­—ç¬¦ä¸²ç±»å‹ï¼›(å½“è¾“å…¥çš„å­—ç¬¦ä¸å¤Ÿé•¿åº¦æ—¶ä¼šè¡¥ç©ºæ ¼)</li><li>varcharï¼šå›ºå®šé•¿åº¦å­—ç¬¦ä¸²ç±»å‹ï¼›</li><li>textï¼šå­—ç¬¦ä¸²ç±»å‹ï¼›</li><li>blobï¼šå­—èŠ‚ç±»å‹ï¼›</li><li>dateï¼šæ—¥æœŸç±»å‹ï¼Œæ ¼å¼ä¸ºï¼šyyyy-MM-ddï¼›</li><li>timeï¼šæ—¶é—´ç±»å‹ï¼Œæ ¼å¼ä¸ºï¼šhh:mm:ss</li><li>timestampï¼šæ—¶é—´æˆ³ç±»å‹ï¼›</li></ul><h4 id="DMLï¼ˆData-Manipulation-Languageï¼‰ï¼šæ•°æ®æ“ä½œè¯­è¨€"><a href="#DMLï¼ˆData-Manipulation-Languageï¼‰ï¼šæ•°æ®æ“ä½œè¯­è¨€" class="headerlink" title="DMLï¼ˆData Manipulation Languageï¼‰ï¼šæ•°æ®æ“ä½œè¯­è¨€"></a>DMLï¼ˆData Manipulation Languageï¼‰ï¼šæ•°æ®æ“ä½œè¯­è¨€</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> æ’å…¥æ•°æ®</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> è¯­æ³•<span class="number">1</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu(sid, sname) <span class="keyword">VALUES</span>(<span class="string">&#x27;s_1001&#x27;</span>, <span class="string">&#x27;zhangSan&#x27;</span>);</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> è¯­æ³• <span class="number">2</span> </span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> å› ä¸ºæ²¡æœ‰æŒ‡å®šè¦æ’å…¥çš„åˆ—ï¼Œè¡¨ç¤ºæŒ‰åˆ›å»ºè¡¨æ—¶åˆ—çš„é¡ºåºæ’å…¥æ‰€æœ‰åˆ—çš„å€¼ï¼š</span><br><span class="line"><span class="keyword">INSERT INTO</span> stu <span class="keyword">VALUES</span>(<span class="string">&#x27;s_1002&#x27;</span>, <span class="string">&#x27;liSi&#x27;</span>, <span class="number">32</span>, <span class="string">&#x27;female&#x27;</span>);</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> æ³¨æ„ï¼šæ‰€æœ‰å­—ç¬¦ä¸²æ•°æ®å¿…é¡»ä½¿ç”¨å•å¼•ç”¨ï¼</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ä¿®æ”¹æ•°æ®</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> <span class="keyword">UPDATE</span> è¡¨å <span class="keyword">SET</span> åˆ—å <span class="number">1</span><span class="operator">=</span>å€¼ <span class="number">1</span>, â€¦ åˆ—å n<span class="operator">=</span>å€¼ n [<span class="keyword">WHERE</span> æ¡ä»¶];</span><br><span class="line"><span class="keyword">UPDATE</span> stu <span class="keyword">SET</span> sname<span class="operator">=</span>â€™zhangSanSanâ€™, age<span class="operator">=</span>â€™<span class="number">32</span>â€™, gender<span class="operator">=</span>â€™femaleâ€™ <span class="keyword">WHERE</span> sid<span class="operator">=</span>â€™s_1001â€™;</span><br><span class="line"><span class="keyword">UPDATE</span> stu <span class="keyword">SET</span> sname<span class="operator">=</span>â€™liSiâ€™, age<span class="operator">=</span>â€™<span class="number">20</span>â€™<span class="keyword">WHERE</span> age<span class="operator">&gt;</span><span class="number">50</span> <span class="keyword">AND</span> gender<span class="operator">=</span>â€™maleâ€™;</span><br><span class="line"><span class="keyword">UPDATE</span> stu <span class="keyword">SET</span> sname<span class="operator">=</span>â€™wangWuâ€™, age<span class="operator">=</span>â€™<span class="number">30</span>â€™<span class="keyword">WHERE</span> age<span class="operator">&gt;</span><span class="number">60</span> <span class="keyword">OR</span> gender<span class="operator">=</span>â€™femaleâ€™;</span><br><span class="line"><span class="keyword">UPDATE</span> stu <span class="keyword">SET</span> gender<span class="operator">=</span>â€™femaleâ€™<span class="keyword">WHERE</span> gender <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">UPDATE</span> stu <span class="keyword">SET</span> age<span class="operator">=</span>age<span class="operator">+</span><span class="number">1</span> <span class="keyword">WHERE</span> sname<span class="operator">=</span>â€™zhaoLiuâ€™;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> åˆ é™¤æ•°æ®</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> <span class="keyword">DELETE</span> <span class="keyword">FROM</span> è¡¨å [<span class="keyword">WHERE</span> æ¡ä»¶];</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> stu <span class="keyword">WHERE</span> sid<span class="operator">=</span>â€™s_1001â€™<span class="number">003</span>B;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> stu <span class="keyword">WHERE</span> sname<span class="operator">=</span>â€™chenQiâ€™ <span class="keyword">OR</span> age <span class="operator">&gt;</span> <span class="number">30</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> stu;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> è¯­æ³• <span class="number">2</span>ï¼š<span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> è¡¨å;</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> stu;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼šè™½ç„¶ <span class="keyword">TRUNCATE</span> å’Œ <span class="keyword">DELETE</span> éƒ½å¯ä»¥åˆ é™¤è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œä½†æœ‰åŸç†ä¸åŒã€‚<span class="keyword">DELETE</span>çš„æ•ˆç‡æ²¡æœ‰ <span class="keyword">TRUNCATE</span> é«˜ï¼<span class="keyword">TRUNCATE</span> å…¶å®å±æ€§ DDL è¯­å¥ï¼Œå› ä¸ºå®ƒæ˜¯å…ˆ <span class="keyword">DROP</span> <span class="keyword">TABLE</span>ï¼Œå† <span class="keyword">CREATE TABLE</span>ã€‚è€Œä¸”<span class="keyword">TRUNCATE</span>åˆ é™¤çš„è®°å½•æ˜¯æ— æ³•å›æ»šçš„ï¼Œä½†<span class="keyword">DELETE</span>åˆ é™¤çš„è®°å½•æ˜¯å¯ä»¥å›æ»šçš„ï¼ˆå›æ»šæ˜¯äº‹åŠ¡çš„çŸ¥è¯†ï¼ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="DCLï¼ˆData-Control-Languageï¼‰ï¼šæ•°æ®æ§åˆ¶è¯­è¨€"><a href="#DCLï¼ˆData-Control-Languageï¼‰ï¼šæ•°æ®æ§åˆ¶è¯­è¨€" class="headerlink" title="DCLï¼ˆData Control Languageï¼‰ï¼šæ•°æ®æ§åˆ¶è¯­è¨€"></a>DCLï¼ˆData Control Languageï¼‰ï¼šæ•°æ®æ§åˆ¶è¯­è¨€</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> åˆ›å»ºç”¨æˆ·</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> è¯­æ³•ï¼š<span class="keyword">CREATE</span> <span class="keyword">USER</span> â€˜ç”¨æˆ·åâ€™@åœ°å€ IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;å¯†ç &#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> â€˜user1â€™<span class="variable">@localhost</span> IDENTIFIED <span class="keyword">BY</span> â€˜<span class="number">123</span>â€™;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> â€˜user2â€™@â€™<span class="operator">%</span>â€™ IDENTIFIED <span class="keyword">BY</span> â€˜<span class="number">123</span>â€™;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ç»™ç”¨æˆ·æˆæƒ</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> è¯­æ³•ï¼š<span class="keyword">GRANT</span> æƒé™ <span class="number">1</span>, â€¦ , æƒé™ n <span class="keyword">ON</span> æ•°æ®åº“.<span class="operator">*</span> <span class="keyword">TO</span> â€˜ç”¨æˆ·åâ€™@åœ°å€;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span>,<span class="keyword">ALTER</span>,<span class="keyword">DROP</span>,<span class="keyword">INSERT</span>,<span class="keyword">UPDATE</span>,<span class="keyword">DELETE</span>,<span class="keyword">SELECT</span> <span class="keyword">ON</span> mydb1.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;user1&#x27;</span><span class="variable">@localhost</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> mydb1.<span class="operator">*</span> <span class="keyword">TO</span> user2<span class="variable">@localhost</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> æ’¤é”€æˆæƒ</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> è¯­æ³•ï¼š<span class="keyword">REVOKE</span> æƒé™ <span class="number">1</span>, â€¦ , æƒé™ n <span class="keyword">ON</span> æ•°æ®åº“.<span class="operator">*</span> <span class="keyword">FROM</span> â€˜ç”¨æˆ·åâ€™@åœ°å€;</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">CREATE</span>,<span class="keyword">ALTER</span>,<span class="keyword">DROP</span> <span class="keyword">ON</span> mydb1.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;user1&#x27;</span><span class="variable">@localhost</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> æŸ¥çœ‹ç”¨æˆ·æƒé™</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> è¯­æ³•ï¼š<span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> â€˜ç”¨æˆ·åâ€™@åœ°å€;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;user1&#x27;</span><span class="variable">@localhost</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> åˆ é™¤ç”¨æˆ·</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> è¯­æ³•ï¼š<span class="keyword">DROP</span> <span class="keyword">USER</span> â€˜ç”¨æˆ·åâ€™@åœ°å€;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> â€˜user1â€™<span class="variable">@localhost</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼ˆä»¥rootèº«ä»½ï¼‰</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> è¯­æ³• ï¼šuse mysql;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span><span class="variable">@localhost</span> identified <span class="keyword">by</span> <span class="string">&#x27;æ–°å¯†ç &#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="DQLï¼ˆData-Query-Languageï¼‰ï¼šæ•°æ®æŸ¥è¯¢è¯­è¨€"><a href="#DQLï¼ˆData-Query-Languageï¼‰ï¼šæ•°æ®æŸ¥è¯¢è¯­è¨€" class="headerlink" title="DQLï¼ˆData Query Languageï¼‰ï¼šæ•°æ®æŸ¥è¯¢è¯­è¨€"></a>DQLï¼ˆData Query Languageï¼‰ï¼šæ•°æ®æŸ¥è¯¢è¯­è¨€</h4><p>è¯­æ³•ï¼š</p><ul><li>select åˆ—å â€”-&gt; è¦æŸ¥è¯¢çš„åˆ—åç§°</li><li>from è¡¨å â€”-&gt; è¦æŸ¥è¯¢çš„è¡¨åç§°</li><li>where æ¡ä»¶ â€”-&gt; è¡Œæ¡ä»¶</li><li>group by åˆ†ç»„åˆ— â€”-&gt; å¯¹ç»“æœåˆ†ç»„</li><li>having åˆ†ç»„æ¡ä»¶ â€”-&gt; åˆ†ç»„åçš„è¡Œæ¡ä»¶</li><li>order by æ’åºåˆ— â€”-&gt; å¯¹ç»“æœåˆ†ç»„</li><li>limit èµ·å§‹è¡Œ, è¡Œæ•° â€”-&gt; ç»“æœé™å®š</li></ul><h5 id="æ¡ä»¶æŸ¥è¯¢"><a href="#æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="æ¡ä»¶æŸ¥è¯¢"></a>æ¡ä»¶æŸ¥è¯¢</h5><p>æ¡ä»¶æŸ¥è¯¢ä»‹ç»<br>æ¡ä»¶æŸ¥è¯¢å°±æ˜¯åœ¨æŸ¥è¯¢æ—¶ç»™å‡º WHERE å­å¥ï¼Œåœ¨ WHERE å­å¥ä¸­å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¿ç®—ç¬¦åŠå…³é”®å­—ï¼š</p><ul><li>&#x3D;ã€!&#x3D;ã€&lt;&gt;ã€&lt;ã€&lt;&#x3D;ã€&gt;ã€&gt;&#x3D;ï¼›</li><li>BETWEENâ€¦ANDï¼›</li><li>IN(set)ï¼›</li><li>IS NULLï¼›</li><li>ANDï¼›</li><li>ORï¼›</li><li>NOTï¼›</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006155.png" alt="image-20240904110449093"></p><h5 id="æ¨¡ç³ŠæŸ¥è¯¢"><a href="#æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="æ¨¡ç³ŠæŸ¥è¯¢"></a>æ¨¡ç³ŠæŸ¥è¯¢</h5><p>SELECT å­—æ®µ FROM è¡¨ WHERE æŸå­—æ®µ Like æ¡ä»¶<br>å…¶ä¸­å…³äºæ¡ä»¶ï¼ŒSQL æä¾›äº†ä¸¤ç§åŒ¹é…æ¨¡å¼ï¼š</p><p>% ï¼šè¡¨ç¤ºä»»æ„ 0 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚å¯åŒ¹é…ä»»æ„ç±»å‹å’Œé•¿åº¦çš„å­—ç¬¦ï¼Œæœ‰äº›æƒ…å†µä¸‹è‹¥æ˜¯ä¸­æ–‡ï¼Œè¯·ä½¿ç”¨ä¸¤ä¸ªç™¾åˆ†å·ï¼ˆ%%ï¼‰è¡¨ç¤ºã€‚</p><p>_ ï¼š è¡¨ç¤ºä»»æ„å•ä¸ªå­—ç¬¦ã€‚åŒ¹é…å•ä¸ªä»»æ„å­—ç¬¦ï¼Œå®ƒå¸¸ç”¨æ¥é™åˆ¶è¡¨è¾¾å¼çš„å­— ç¬¦é•¿åº¦è¯­å¥ã€‚</p><h5 id="å­—æ®µæ§åˆ¶æŸ¥è¯¢"><a href="#å­—æ®µæ§åˆ¶æŸ¥è¯¢" class="headerlink" title="å­—æ®µæ§åˆ¶æŸ¥è¯¢"></a>å­—æ®µæ§åˆ¶æŸ¥è¯¢</h5><p>å»æ‰é‡å¤è®°å½•</p><p>å»é™¤é‡å¤è®°å½•ï¼ˆä¸¤è¡Œæˆ–ä¸¤è¡Œä»¥ä¸Šè®°å½•ä¸­ç³»åˆ—çš„ä¸Šçš„æ•°æ®éƒ½ç›¸åŒï¼‰ï¼Œä¾‹å¦‚ emp è¡¨ä¸­ sal å­—æ®µå°±å­˜åœ¨ç›¸åŒçš„è®°å½•ã€‚å½“åªæŸ¥è¯¢ emp è¡¨çš„ sal å­—æ®µæ—¶ï¼Œé‚£ä¹ˆä¼šå‡ºç°é‡å¤è®°å½•ï¼Œé‚£ä¹ˆæƒ³å»é™¤é‡å¤è®°å½•ï¼Œéœ€è¦ä½¿ç”¨ <strong>DISTINCT</strong>ï¼š</p><p>SELECT DISTINCT sal FROM emp;</p><p>æŸ¥çœ‹é›‡å‘˜çš„æœˆè–ªä¸ä½£é‡‘ä¹‹å’Œ</p><p>å› ä¸º sal å’Œ comm ä¸¤åˆ—çš„ç±»å‹éƒ½æ˜¯æ•°å€¼ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥åšåŠ è¿ç®—ã€‚å¦‚æœ sal æˆ– comm ä¸­æœ‰ä¸€ä¸ªå­—æ®µä¸æ˜¯æ•°å€¼ç±»å‹ï¼Œé‚£ä¹ˆä¼šå‡ºé”™ã€‚</p><p>SELECT *,<br>sal+comm FROM emp;</p><p>comm åˆ—æœ‰å¾ˆå¤šè®°å½•çš„å€¼ä¸º NULLï¼Œå› ä¸ºä»»ä½•ä¸œè¥¿ä¸ NULL ç›¸åŠ ç»“æœè¿˜æ˜¯ NULLï¼Œæ‰€ä»¥ç»“ç®—ç»“æœå¯èƒ½ä¼šå‡ºç° NULLã€‚ä¸‹é¢ä½¿ç”¨äº†æŠŠ NULL è½¬æ¢æˆæ•°å€¼ 0 çš„å‡½æ•° IFNULLï¼š</p><p>SELECT *, sal+IFNULL(comm,0) FROM emp;</p><p>ç»™åˆ—åæ·»åŠ åˆ«å</p><p>åœ¨ä¸Šé¢æŸ¥è¯¢ä¸­å‡ºç°åˆ—åä¸º sal+IFNULL(comm,0)ï¼Œè¿™å¾ˆä¸ç¾è§‚ï¼Œç°åœ¨æˆ‘ä»¬ç»™è¿™ä¸€åˆ—ç»™å‡ºä¸€ä¸ªåˆ«åï¼Œä¸º totalï¼š</p><p>SELECT *, sal+IFNULL(comm,0) AS total FROM emp;<br>ç»™åˆ—èµ·åˆ«åæ—¶ï¼Œæ˜¯å¯ä»¥çœç•¥ AS å…³é”®å­—çš„ï¼š</p><p>SELECT *, sal+IFNULL(comm,0) total FROM emp;</p><h4 id="çª—å£å‡½æ•°"><a href="#çª—å£å‡½æ•°" class="headerlink" title="çª—å£å‡½æ•°"></a>çª—å£å‡½æ•°</h4><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li><a href="https://www.zhihu.com/tardis/zm/art/92654574?source_id=1005">é€šä¿—æ˜“æ‡‚çš„å­¦ä¼šï¼šSQLçª—å£å‡½æ•°</a></li></ol><h5 id="çª—å£å‡½æ•°åº”ç”¨åœºæ™¯"><a href="#çª—å£å‡½æ•°åº”ç”¨åœºæ™¯" class="headerlink" title="çª—å£å‡½æ•°åº”ç”¨åœºæ™¯"></a>çª—å£å‡½æ•°åº”ç”¨åœºæ™¯</h5><p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦<strong>åœ¨æ¯ç»„å†…æ’å</strong>ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¸šåŠ¡éœ€æ±‚ï¼š</p><blockquote><p><strong>æ’åé—®é¢˜ï¼š<strong>æ¯ä¸ªéƒ¨é—¨æŒ‰ä¸šç»©æ¥æ’å</strong><br>       <strong>topNé—®é¢˜</strong>ï¼šæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨æ’åå‰Nçš„å‘˜å·¥è¿›è¡Œå¥–åŠ±</strong></p></blockquote><h5 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span>çª—å£å‡½æ•°<span class="operator">&gt;</span> <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> <span class="operator">&lt;</span>ç”¨äºåˆ†ç»„çš„åˆ—å<span class="operator">&gt;</span></span><br><span class="line">                <span class="keyword">order</span> <span class="keyword">by</span> <span class="operator">&lt;</span>ç”¨äºæ’åºçš„åˆ—å<span class="operator">&gt;</span>)</span><br><span class="line">                </span><br></pre></td></tr></table></figure><blockquote><p>&lt;çª—å£å‡½æ•°&gt;çš„ä½ç½®ï¼Œå¯ä»¥æ”¾ä»¥ä¸‹ä¸¤ç§å‡½æ•°ï¼š</p><p>1ï¼‰ ä¸“ç”¨çª—å£å‡½æ•°ï¼ŒåŒ…æ‹¬åé¢è¦è®²åˆ°çš„rank, dense_rank, row_numberç­‰ä¸“ç”¨çª—å£å‡½æ•°ã€‚</p><p>2ï¼‰ èšåˆå‡½æ•°ï¼Œå¦‚sum. avg, count, max, minç­‰</p><p>å› ä¸ºçª—å£å‡½æ•°æ˜¯å¯¹whereæˆ–è€…group byå­å¥å¤„ç†åçš„ç»“æœè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥çª—å£å‡½æ•°åŸåˆ™ä¸Šåªèƒ½å†™åœ¨selectå­å¥ä¸­ã€‚</p></blockquote><p><strong>çª—å£å‡½æ•°æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</strong></p><p>1ï¼‰åŒæ—¶å…·æœ‰åˆ†ç»„ï¼ˆpartition byï¼‰å’Œæ’åºï¼ˆorder byï¼‰çš„åŠŸèƒ½</p><p>2ï¼‰ä¸å‡å°‘åŸè¡¨çš„è¡Œæ•°ï¼Œæ‰€ä»¥ç»å¸¸ç”¨æ¥åœ¨æ¯ç»„å†…æ’å</p><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006373.png" alt="image-20240905221424939"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262006254.png" alt="image-20240905221437164"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span>,</span><br><span class="line">   <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> ç­çº§</span><br><span class="line">                 <span class="keyword">order</span> <span class="keyword">by</span> æˆç»© <span class="keyword">desc</span>) <span class="keyword">as</span> ranking</span><br><span class="line"><span class="keyword">from</span> ç­çº§è¡¨</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262009309.png" alt="image-20240905222107861"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007776.png" alt="image-20240905222135175"></p><p><strong>ç®€å•æ¥è¯´ï¼Œçª—å£å‡½æ•°æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</strong></p><p>1ï¼‰åŒæ—¶å…·æœ‰åˆ†ç»„å’Œæ’åºçš„åŠŸèƒ½</p><p>2ï¼‰ä¸å‡å°‘åŸè¡¨çš„è¡Œæ•°</p><p>3ï¼‰è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span>çª—å£å‡½æ•°<span class="operator">&gt;</span> <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> <span class="operator">&lt;</span>ç”¨äºåˆ†ç»„çš„åˆ—å<span class="operator">&gt;</span></span><br><span class="line">                <span class="keyword">order</span> <span class="keyword">by</span> <span class="operator">&lt;</span>ç”¨äºæ’åºçš„åˆ—å<span class="operator">&gt;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007609.png" alt="image-20240905222441114"></p><h5 id="èšåˆå‡½æ•°ä½œä¸ºçª—å£å‡½æ•°"><a href="#èšåˆå‡½æ•°ä½œä¸ºçª—å£å‡½æ•°" class="headerlink" title="èšåˆå‡½æ•°ä½œä¸ºçª—å£å‡½æ•°"></a>èšåˆå‡½æ•°ä½œä¸ºçª—å£å‡½æ•°</h5><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007320.png" alt="image-20240905222532998"></p><h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><p>MySQL5.5ç‰ˆæœ¬ä¹‹å‰ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“æ˜¯MyISAMï¼Œåç»­ä½¿ç”¨çš„æ˜¯InnoDBï¼Œä»–ä»¬ç›´æ¥çš„åŒºåˆ«å°±æ˜¯ï¼š</p><ul><li>MyISAMä¸æ”¯æŒè¡Œçº§é”ï¼Œè¯¥å­˜å‚¨å¼•æ“ä¸€é”å°±é”ä½äº†æ•´ä¸ªè¡¨ï¼›</li><li>ä¸”ä¸æ”¯æŒäº‹åŠ¡ï¼›</li><li>ä¸”ä¸æ”¯æŒå¤–é”®ï¼Œå°½ç®¡å¤–é”®å¯¹äºç»´æŠ¤æ•°æ®åº“ä¸­çš„ä¸€è‡´æ€§æœ‰éå¸¸å¥½çš„ä½œç”¨ï¼Œä½†æ˜¯å…¶æ€§èƒ½çš„æŸè€—å¤ªå¤§ï¼Œæ‰€ä»¥ä¸€èˆ¬åœ¨å®é™…çš„å¼€å‘ç¯å¢ƒä¸­æ˜¯ä¸å»ºè®®ä½¿ç”¨å¤–é”®çš„ï¼›</li><li>ä¸”ä¸æ”¯æŒæ•°æ®åº“å´©æºƒåå®‰å…¨æ¢å¤ï¼ŒInnoDBæ˜¯æ”¯æŒçš„ï¼Œè¿™éƒ½æ˜¯åŸºäºredo logè€Œå®Œæˆçš„ï¼›</li><li>ä¸æ”¯æŒMVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼›</li><li>ç´¢å¼•å®ç°ä¸ä¸€æ ·ï¼Œå°½ç®¡ä»–ä»¬ä¸¤ä¸ªéƒ½ä½¿ç”¨B+Treeä½œä¸ºå…¶ç´¢å¼•ç»“æ„ï¼Œ</li></ul><p>å­˜å‚¨å¼•æ“æ˜¯æ’ä»¶å¼çš„ï¼Œå®ƒå¯ä»¥ä¸ºä¸€ä¸ªæ•°æ®åº“ä¸­çš„ä¸åŒçš„è¡¨æŒ‡å®šä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œå³å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„</p><h3 id="ä¸€æ¡SQLè¯·æ±‚çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€æ¡SQLè¯·æ±‚çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€æ¡SQLè¯·æ±‚çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€æ¡SQLè¯·æ±‚çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å‰é¢äº†è§£äº†ä¸€ä¸ªSQLæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼Œé‚£ä¹ˆè¿™é‡Œä¸€ä¸ªSQè¯·æ±‚çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503121453148.png" alt="image-20250312145326067"></p><h3 id="InnoDBäºMyISAMå­˜å‚¨å¼•æ“æœ‰å“ªäº›åŒºåˆ«"><a href="#InnoDBäºMyISAMå­˜å‚¨å¼•æ“æœ‰å“ªäº›åŒºåˆ«" class="headerlink" title="InnoDBäºMyISAMå­˜å‚¨å¼•æ“æœ‰å“ªäº›åŒºåˆ«"></a>InnoDBäºMyISAMå­˜å‚¨å¼•æ“æœ‰å“ªäº›åŒºåˆ«</h3><ul><li>äº‹åŠ¡ï¼šInnoDB æ”¯æŒäº‹åŠ¡ï¼ŒMyISAM ä¸æ”¯æŒäº‹åŠ¡ï¼Œè¿™æ˜¯ MySQL å°†é»˜è®¤å­˜å‚¨å¼•æ“ä» MyISAM å˜æˆ InnoDB çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚ </li><li>ç´¢å¼•ç»“æ„ï¼šInnoDB æ˜¯èšç°‡ç´¢å¼•ï¼ŒMyISAM æ˜¯éèšç°‡ç´¢å¼•ã€‚èšç°‡ç´¢å¼•çš„æ–‡ä»¶å­˜æ”¾åœ¨ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤ InnoDB å¿…é¡»è¦æœ‰ä¸»é”®ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ•ˆç‡å¾ˆé«˜ã€‚ä½†æ˜¯è¾…åŠ©ç´¢å¼•éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼Œå…ˆæŸ¥è¯¢åˆ°ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°æ•°æ®ã€‚å› æ­¤ï¼Œä¸»é”®ä¸åº”è¯¥è¿‡å¤§ï¼Œå› ä¸ºä¸»é”®å¤ªå¤§ï¼Œå…¶ä»–ç´¢å¼•ä¹Ÿéƒ½ä¼šå¾ˆå¤§ã€‚è€Œ MyISAM æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•ä¿å­˜çš„æ˜¯æ•°æ®æ–‡ä»¶çš„æŒ‡é’ˆã€‚ä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ˜¯ç‹¬ç«‹çš„ã€‚</li><li>é”ç²’åº¦ï¼šInnoDB æœ€å°çš„é”ç²’åº¦æ˜¯è¡Œé”ï¼ŒMyISAM æœ€å°çš„é”ç²’åº¦æ˜¯è¡¨é”ã€‚ä¸€ä¸ªæ›´æ–°è¯­å¥ä¼šé”ä½æ•´å¼ è¡¨ï¼Œå¯¼è‡´å…¶ä»–æŸ¥è¯¢å’Œæ›´æ–°éƒ½ä¼šè¢«é˜»å¡ï¼Œå› æ­¤å¹¶å‘è®¿é—®å—é™ã€‚ </li><li>count çš„æ•ˆç‡ï¼šInnoDB ä¸ä¿å­˜è¡¨çš„å…·ä½“è¡Œæ•°ï¼Œæ‰§è¡Œ select count(*) from table æ—¶éœ€è¦å…¨è¡¨æ‰«æã€‚è€ŒMyISAM ç”¨ä¸€ä¸ªå˜é‡ä¿å­˜äº†æ•´ä¸ªè¡¨çš„è¡Œæ•°ï¼Œæ‰§è¡Œä¸Šè¿°è¯­å¥æ—¶åªéœ€è¦è¯»å‡ºè¯¥å˜é‡å³å¯ï¼Œé€Ÿåº¦å¾ˆå¿«</li></ul><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><h3 id="è¯·ä½ ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç´¢å¼•"><a href="#è¯·ä½ ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç´¢å¼•" class="headerlink" title="è¯·ä½ ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç´¢å¼•"></a>è¯·ä½ ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç´¢å¼•</h3><p>ç´¢å¼•ç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ï¼Œå¯ä»¥å‡å°‘æ‰«æçš„æ•°æ®é‡ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ </p><ul><li>å¦‚æœæŸ¥è¯¢çš„æ—¶å€™ï¼Œæ²¡æœ‰ç”¨åˆ°ç´¢å¼•å°±ä¼šå…¨è¡¨æ‰«æï¼Œè¿™æ—¶å€™æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯On</li><li>å¦‚æœç”¨åˆ°äº†ç´¢å¼•ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥åŸºäºäºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼Œé€šè¿‡ç´¢å¼•å¿«é€Ÿå®šä½åˆ°ç›®æ ‡æ•°æ®ï¼Œ mysql ç´¢å¼•çš„æ•°æ®ç»“æ„ä¸€èˆ¬æ˜¯ b+æ ‘ï¼Œå…¶æœç´¢å¤æ‚åº¦ä¸ºO(logdN)ï¼Œå…¶ä¸­ d è¡¨ç¤ºèŠ‚ç‚¹å…è®¸çš„æœ€å¤§å­èŠ‚ç‚¹ä¸ªæ•°ä¸º d ä¸ªã€‚</li></ul><h3 id="è¯·ä½ ä»‹ç»ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»"><a href="#è¯·ä½ ä»‹ç»ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»" class="headerlink" title="è¯·ä½ ä»‹ç»ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»"></a>è¯·ä½ ä»‹ç»ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503121514919.png" alt="image-20250312151403870"></p><h3 id="è¯·ä½ ä»‹ç»ä¸€ä¸‹ä¸ºä»€ä¹ˆé€‰æ‹©B-Treeä½œä¸ºå…¶ç´¢å¼•æ•°æ®ç»“æ„å‘¢"><a href="#è¯·ä½ ä»‹ç»ä¸€ä¸‹ä¸ºä»€ä¹ˆé€‰æ‹©B-Treeä½œä¸ºå…¶ç´¢å¼•æ•°æ®ç»“æ„å‘¢" class="headerlink" title="è¯·ä½ ä»‹ç»ä¸€ä¸‹ä¸ºä»€ä¹ˆé€‰æ‹©B+Treeä½œä¸ºå…¶ç´¢å¼•æ•°æ®ç»“æ„å‘¢"></a>è¯·ä½ ä»‹ç»ä¸€ä¸‹ä¸ºä»€ä¹ˆé€‰æ‹©B+Treeä½œä¸ºå…¶ç´¢å¼•æ•°æ®ç»“æ„å‘¢</h3><p>é¦–å…ˆé’ˆå¯¹äºB+æ ‘çš„ç‰¹æ€§æ¥è¿›è¡Œä»‹ç»ï¼ŒB+æ ‘ç›¸å¯¹äºBæ ‘ï¼Œå…¶éå¶å­ç»“ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆè¯¥éå¶å­èŠ‚ç‚¹å°±æœ‰å¤§é‡çš„ç©ºé—´ä¿å­˜å…¶ä¸‹è¡ŒèŠ‚ç‚¹ï¼ˆé”®å€¼å¯¹ï¼‰ï¼Œå³å¯ä»¥é™ä½æ ‘çš„é«˜åº¦ä¸”å‡å°‘ç¡¬ç›˜çš„è¯»å–æ¬¡æ•°ã€‚</p><p>ä¸”å¶å­èŠ‚ç‚¹ä¹‹é—´æœ‰æŒ‡é’ˆäº’ç›¸è¿æ¥ï¼Œé‚£ä¹ˆå…¶å¤©ç„¶çš„æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œå…¶èŒƒå›´æŸ¥è¯¢çš„æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚</p><p>B+æ ‘èŠ‚ç‚¹å¤§å°é€šå¸¸è®¾ç½®ä¸ºç£ç›˜å—å¤§å°ï¼ˆå¦‚16KBï¼‰ï¼Œæœ€å¤§åŒ–å•æ¬¡I&#x2F;Oè¯»å–çš„æ•°æ®é‡ã€‚</p><h3 id="B-æ ‘æ˜¯å¦‚ä½•æ„å»ºçš„"><a href="#B-æ ‘æ˜¯å¦‚ä½•æ„å»ºçš„" class="headerlink" title="B+æ ‘æ˜¯å¦‚ä½•æ„å»ºçš„"></a>B+æ ‘æ˜¯å¦‚ä½•æ„å»ºçš„</h3><blockquote><h3 id="B-æ ‘æ’å…¥ä¸åˆ é™¤æ“ä½œè¯¦è§£ï¼ˆä»¥é˜¶æ•°m-3ä¸ºä¾‹ï¼‰"><a href="#B-æ ‘æ’å…¥ä¸åˆ é™¤æ“ä½œè¯¦è§£ï¼ˆä»¥é˜¶æ•°m-3ä¸ºä¾‹ï¼‰" class="headerlink" title="B+æ ‘æ’å…¥ä¸åˆ é™¤æ“ä½œè¯¦è§£ï¼ˆä»¥é˜¶æ•°m&#x3D;3ä¸ºä¾‹ï¼‰"></a>B+æ ‘æ’å…¥ä¸åˆ é™¤æ“ä½œè¯¦è§£ï¼ˆä»¥é˜¶æ•°m&#x3D;3ä¸ºä¾‹ï¼‰</h3><hr><h4 id="1-åˆå§‹B-æ ‘ç»“æ„"><a href="#1-åˆå§‹B-æ ‘ç»“æ„" class="headerlink" title="1. åˆå§‹B+æ ‘ç»“æ„"></a><strong>1. åˆå§‹B+æ ‘ç»“æ„</strong></h4><p>å‡è®¾é˜¶æ•°m&#x3D;3ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨3ä¸ªé”®ï¼Œè¶…è¿‡åˆ™åˆ†è£‚ï¼‰ï¼Œåˆå§‹æ ‘ä¸ºç©ºã€‚<br><strong>æ’å…¥é¡ºåº</strong>ï¼šä¾æ¬¡æ’å…¥é”®å€¼ <code>5, 10, 15, 20, 25, 30, 35, 40</code>ï¼Œè§‚å¯Ÿåˆ†è£‚è¿‡ç¨‹ã€‚</p><hr><h4 id="2-æ’å…¥æ“ä½œä¸èŠ‚ç‚¹åˆ†è£‚"><a href="#2-æ’å…¥æ“ä½œä¸èŠ‚ç‚¹åˆ†è£‚" class="headerlink" title="2. æ’å…¥æ“ä½œä¸èŠ‚ç‚¹åˆ†è£‚"></a><strong>2. æ’å…¥æ“ä½œä¸èŠ‚ç‚¹åˆ†è£‚</strong></h4><h5 id="2-1-æ’å…¥5ã€10ã€15"><a href="#2-1-æ’å…¥5ã€10ã€15" class="headerlink" title="2.1 æ’å…¥5ã€10ã€15"></a><strong>2.1 æ’å…¥5ã€10ã€15</strong></h5><p>â€¢ <strong>æ“ä½œ</strong>ï¼šä¾æ¬¡æ’å…¥ <code>5 â†’ 10 â†’ 15</code>ã€‚<br>â€¢ <strong>ç»“æœ</strong>ï¼šå•ä¸ªå¶å­èŠ‚ç‚¹å­˜å‚¨å…¨éƒ¨é”®å€¼ï¼ˆæœªè¶…è¿‡å®¹é‡ï¼‰ã€‚<br>  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[å¶å­èŠ‚ç‚¹]</span><br><span class="line">â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”</span><br><span class="line">â”‚ 5  â”‚ 10 â”‚ 15 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure></p><h5 id="2-2-æ’å…¥20ï¼ˆè§¦å‘åˆ†è£‚ï¼‰"><a href="#2-2-æ’å…¥20ï¼ˆè§¦å‘åˆ†è£‚ï¼‰" class="headerlink" title="2.2 æ’å…¥20ï¼ˆè§¦å‘åˆ†è£‚ï¼‰"></a><strong>2.2 æ’å…¥20ï¼ˆè§¦å‘åˆ†è£‚ï¼‰</strong></h5><p>â€¢ <strong>æ’å…¥20</strong>ï¼šå¶å­èŠ‚ç‚¹é”®æ•°è¶…è¿‡3ï¼ˆ4ä¸ªé”®ï¼‰ï¼Œéœ€åˆ†è£‚ã€‚<br>â€¢ <strong>åˆ†è£‚è§„åˆ™</strong>ï¼š</p><ol><li>å°†ä¸­é—´é”®ï¼ˆç¬¬2ä¸ªé”®ï¼Œ<code>15</code>ï¼‰æå‡åˆ°çˆ¶èŠ‚ç‚¹ï¼ˆæ­¤æ—¶çˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ ¹èŠ‚ç‚¹ï¼‰ã€‚</li><li>å·¦å­èŠ‚ç‚¹ä¿ç•™ <code>5, 10</code>ï¼Œå³å­èŠ‚ç‚¹ä¿ç•™ <code>15, 20</code>ã€‚<br>â€¢ <strong>ç»“æ„å˜åŒ–</strong>ï¼š</li></ol>  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">          [æ ¹èŠ‚ç‚¹ï¼ˆéå¶å­ï¼‰]</span><br><span class="line">                â”‚</span><br><span class="line">                â–¼</span><br><span class="line">          â”Œâ”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">          â”‚  15   â”‚</span><br><span class="line">          â””â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br><span class="line">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">              â–¼           â–¼</span><br><span class="line">[å¶å­èŠ‚ç‚¹1]          [å¶å­èŠ‚ç‚¹2]</span><br><span class="line">â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”</span><br><span class="line">â”‚ 5  â”‚ 10 â”‚      â”‚ 15 â”‚ 20 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h5 id="2-3-æ’å…¥25ã€30"><a href="#2-3-æ’å…¥25ã€30" class="headerlink" title="2.3 æ’å…¥25ã€30"></a><strong>2.3 æ’å…¥25ã€30</strong></h5><p>â€¢ <strong>æ’å…¥25 â†’ 30</strong>ï¼šæ’å…¥åˆ°å¶å­èŠ‚ç‚¹2ï¼Œå½“å‰é”®æ•°ä¸º <code>15, 20, 25, 30</code>ï¼Œè§¦å‘åˆ†è£‚ã€‚<br>â€¢ <strong>åˆ†è£‚è§„åˆ™</strong>ï¼š</p><ol><li>ä¸­é—´é”® <code>25</code> æå‡åˆ°çˆ¶èŠ‚ç‚¹ã€‚</li><li>å·¦å­èŠ‚ç‚¹ä¿ç•™ <code>15, 20</code>ï¼Œå³å­èŠ‚ç‚¹ä¿ç•™ <code>25, 30</code>ã€‚<br>â€¢ <strong>ç»“æ„å˜åŒ–</strong>ï¼š</li></ol>  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">          [æ ¹èŠ‚ç‚¹ï¼ˆéå¶å­ï¼‰]</span><br><span class="line">          â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">          â”‚  15   â”‚  25   â”‚</span><br><span class="line">          â””â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br><span class="line">              â–¼       â–¼       â–¼</span><br><span class="line">[å¶å­1]   [å¶å­2]   [å¶å­3]</span><br><span class="line">â”Œâ”€â”€â”¬â”€â”€â”  â”Œâ”€â”€â”¬â”€â”€â”  â”Œâ”€â”€â”¬â”€â”€â”</span><br><span class="line">â”‚5 â”‚10â”‚  â”‚15â”‚20â”‚  â”‚25â”‚30â”‚</span><br><span class="line">â””â”€â”€â”´â”€â”€â”˜  â””â”€â”€â”´â”€â”€â”˜  â””â”€â”€â”´â”€â”€â”˜</span><br></pre></td></tr></table></figure><h5 id="2-4-æ’å…¥35ã€40"><a href="#2-4-æ’å…¥35ã€40" class="headerlink" title="2.4 æ’å…¥35ã€40"></a><strong>2.4 æ’å…¥35ã€40</strong></h5><p>â€¢ <strong>æ’å…¥35 â†’ 40</strong>ï¼šæ’å…¥åˆ°å¶å­èŠ‚ç‚¹3ï¼Œé”®æ•°ä¸º <code>25, 30, 35, 40</code>ï¼Œè§¦å‘åˆ†è£‚ã€‚<br>â€¢ <strong>åˆ†è£‚è§„åˆ™</strong>ï¼š</p><ol><li>ä¸­é—´é”® <code>35</code> æå‡åˆ°çˆ¶èŠ‚ç‚¹ã€‚</li><li>å·¦å­èŠ‚ç‚¹ä¿ç•™ <code>25, 30</code>ï¼Œå³å­èŠ‚ç‚¹ä¿ç•™ <code>35, 40</code>ã€‚<br>â€¢ <strong>ç»“æ„å˜åŒ–</strong>ï¼š</li></ol>  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">          [æ ¹èŠ‚ç‚¹ï¼ˆéå¶å­ï¼‰]</span><br><span class="line">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">      â”‚  15   â”‚  25   â”‚  35   â”‚</span><br><span class="line">      â””â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br><span class="line">          â–¼       â–¼       â–¼       â–¼</span><br><span class="line">[å¶å­1] [å¶å­2] [å¶å­3] [å¶å­4]</span><br><span class="line">â”Œâ”€â”€â”¬â”€â”€â”â”Œâ”€â”€â”¬â”€â”€â”â”Œâ”€â”€â”¬â”€â”€â”â”Œâ”€â”€â”¬â”€â”€â”</span><br><span class="line">â”‚5â”‚10â”‚â”‚15â”‚20â”‚â”‚25â”‚30â”‚â”‚35â”‚40â”‚</span><br><span class="line">â””â”€â”€â”´â”€â”€â”˜â””â”€â”€â”´â”€â”€â”˜â””â”€â”€â”´â”€â”€â”˜â””â”€â”€â”´â”€â”€â”˜</span><br></pre></td></tr></table></figure><hr><h4 id="3-åˆ é™¤æ“ä½œä¸èŠ‚ç‚¹åˆå¹¶-é‡æ–°åˆ†é…"><a href="#3-åˆ é™¤æ“ä½œä¸èŠ‚ç‚¹åˆå¹¶-é‡æ–°åˆ†é…" class="headerlink" title="3. åˆ é™¤æ“ä½œä¸èŠ‚ç‚¹åˆå¹¶&#x2F;é‡æ–°åˆ†é…"></a><strong>3. åˆ é™¤æ“ä½œä¸èŠ‚ç‚¹åˆå¹¶&#x2F;é‡æ–°åˆ†é…</strong></h4><h5 id="3-1-åˆ é™¤15ï¼ˆç›´æ¥åˆ é™¤ï¼‰"><a href="#3-1-åˆ é™¤15ï¼ˆç›´æ¥åˆ é™¤ï¼‰" class="headerlink" title="3.1 åˆ é™¤15ï¼ˆç›´æ¥åˆ é™¤ï¼‰"></a><strong>3.1 åˆ é™¤15ï¼ˆç›´æ¥åˆ é™¤ï¼‰</strong></h5><p>â€¢ <strong>æ“ä½œ</strong>ï¼šåˆ é™¤å¶å­èŠ‚ç‚¹2ä¸­çš„é”® <code>15</code>ï¼Œå‰©ä½™é”®ä¸º <code>20</code>ï¼ˆæœªä½äºæœ€å°å€¼ âŒˆm&#x2F;2âŒ‰-1&#x3D;1ï¼‰ã€‚<br>â€¢ <strong>ç»“æœ</strong>ï¼šæ— éœ€åˆå¹¶ï¼Œç›´æ¥åˆ é™¤ã€‚<br>  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[å¶å­2]</span><br><span class="line">â”Œâ”€â”€â”€â”€â”</span><br><span class="line">â”‚ 20 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure></p><h5 id="3-2-åˆ é™¤25ï¼ˆè§¦å‘é‡æ–°åˆ†é…ï¼‰"><a href="#3-2-åˆ é™¤25ï¼ˆè§¦å‘é‡æ–°åˆ†é…ï¼‰" class="headerlink" title="3.2 åˆ é™¤25ï¼ˆè§¦å‘é‡æ–°åˆ†é…ï¼‰"></a><strong>3.2 åˆ é™¤25ï¼ˆè§¦å‘é‡æ–°åˆ†é…ï¼‰</strong></h5><p>â€¢ <strong>æ“ä½œ</strong>ï¼šåˆ é™¤å¶å­èŠ‚ç‚¹3ä¸­çš„é”® <code>25</code>ï¼Œå‰©ä½™é”®ä¸º <code>30</code>ï¼ˆä¸è¶³1ä¸ªé”®ï¼‰ã€‚<br>â€¢ <strong>é‡æ–°åˆ†é…è§„åˆ™</strong>ï¼š  </p><ol><li>å‘å…„å¼ŸèŠ‚ç‚¹ï¼ˆå¶å­4ï¼‰å€Ÿä¸€ä¸ªé”® <code>35</code>ï¼Œå¹¶æ›´æ–°çˆ¶èŠ‚ç‚¹é”®ä¸º <code>35</code> â†’ <code>30</code>ã€‚  </li><li>å¶å­3å’Œå¶å­4åˆå¹¶ä¸º <code>30, 35, 40</code>ï¼ˆéœ€è°ƒæ•´çˆ¶èŠ‚ç‚¹ï¼‰ã€‚<br>â€¢ <strong>ç»“æ„å˜åŒ–</strong>ï¼š</li></ol>  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">          [æ ¹èŠ‚ç‚¹ï¼ˆéå¶å­ï¼‰]</span><br><span class="line">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">      â”‚  15   â”‚  30   â”‚</span><br><span class="line">      â””â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br><span class="line">          â–¼       â–¼       â–¼</span><br><span class="line">[å¶å­1] [å¶å­2] [å¶å­3-4åˆå¹¶]</span><br><span class="line">â”Œâ”€â”€â”¬â”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”</span><br><span class="line">â”‚5â”‚10â”‚â”‚20â”‚â”‚30â”‚35â”‚40â”‚</span><br><span class="line">â””â”€â”€â”´â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”´â”€â”€â”´â”€â”€â”˜</span><br></pre></td></tr></table></figure><h5 id="3-3-åˆ é™¤5ï¼ˆè§¦å‘åˆå¹¶ï¼‰"><a href="#3-3-åˆ é™¤5ï¼ˆè§¦å‘åˆå¹¶ï¼‰" class="headerlink" title="3.3 åˆ é™¤5ï¼ˆè§¦å‘åˆå¹¶ï¼‰"></a><strong>3.3 åˆ é™¤5ï¼ˆè§¦å‘åˆå¹¶ï¼‰</strong></h5><p>â€¢ <strong>æ“ä½œ</strong>ï¼šåˆ é™¤å¶å­1ä¸­çš„é”® <code>5</code>ï¼Œå‰©ä½™é”®ä¸º <code>10</code>ï¼ˆä»æ»¡è¶³æœ€å°å€¼ï¼‰ã€‚<br>â€¢ <strong>æ— éœ€æ“ä½œ</strong>ï¼Œç›´æ¥åˆ é™¤ï¼š<br>  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[å¶å­1]</span><br><span class="line">â”Œâ”€â”€â”€â”€â”</span><br><span class="line">â”‚ 10 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure></p><h5 id="3-4-åˆ é™¤10ï¼ˆè§¦å‘èŠ‚ç‚¹åˆå¹¶ï¼‰"><a href="#3-4-åˆ é™¤10ï¼ˆè§¦å‘èŠ‚ç‚¹åˆå¹¶ï¼‰" class="headerlink" title="3.4 åˆ é™¤10ï¼ˆè§¦å‘èŠ‚ç‚¹åˆå¹¶ï¼‰"></a><strong>3.4 åˆ é™¤10ï¼ˆè§¦å‘èŠ‚ç‚¹åˆå¹¶ï¼‰</strong></h5><p>â€¢ <strong>æ“ä½œ</strong>ï¼šåˆ é™¤å¶å­1ä¸­çš„é”® <code>10</code>ï¼Œæ­¤æ—¶å¶å­1ä¸ºç©ºã€‚<br>â€¢ <strong>åˆå¹¶è§„åˆ™</strong>ï¼š</p><ol><li>å°†ç›¸é‚»å¶å­èŠ‚ç‚¹ï¼ˆå¶å­2ï¼‰çš„é”® <code>20</code> ç§»åŠ¨åˆ°çˆ¶èŠ‚ç‚¹ã€‚  </li><li>åˆå¹¶å¶å­1å’Œå¶å­2ï¼Œåˆ é™¤çˆ¶èŠ‚ç‚¹ä¸­çš„é”® <code>15</code>ã€‚<br>â€¢ <strong>æœ€ç»ˆç»“æ„</strong>ï¼š</li></ol>  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    [æ ¹èŠ‚ç‚¹ï¼ˆéå¶å­ï¼‰]</span><br><span class="line">          â”‚</span><br><span class="line">          â–¼</span><br><span class="line">    â”Œâ”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">    â”‚  30   â”‚</span><br><span class="line">    â””â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br><span class="line">        â–¼</span><br><span class="line">[åˆå¹¶åçš„å¶å­èŠ‚ç‚¹]</span><br><span class="line">â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”</span><br><span class="line">â”‚20â”‚30â”‚35â”‚40â”‚</span><br><span class="line">â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜</span><br></pre></td></tr></table></figure><hr><h4 id="4-å…³é”®æœºåˆ¶æ€»ç»“"><a href="#4-å…³é”®æœºåˆ¶æ€»ç»“" class="headerlink" title="4. å…³é”®æœºåˆ¶æ€»ç»“"></a><strong>4. å…³é”®æœºåˆ¶æ€»ç»“</strong></h4><table><thead><tr><th><strong>æ“ä½œ</strong></th><th><strong>è§¦å‘æ¡ä»¶</strong></th><th><strong>å¤„ç†æ–¹å¼</strong></th></tr></thead><tbody><tr><td>æ’å…¥</td><td>èŠ‚ç‚¹é”®æ•° &gt; m-1</td><td>åˆ†è£‚ä¸ºä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸­é—´é”®æå‡åˆ°çˆ¶èŠ‚ç‚¹</td></tr><tr><td>åˆ é™¤</td><td>èŠ‚ç‚¹é”®æ•° &lt; âŒˆm&#x2F;2âŒ‰-1</td><td>è‹¥å…„å¼ŸèŠ‚ç‚¹å¯å€Ÿé”®ï¼Œåˆ™é‡æ–°åˆ†é…ï¼›å¦åˆ™åˆå¹¶èŠ‚ç‚¹</td></tr><tr><td>é‡æ–°åˆ†é…</td><td>å…„å¼ŸèŠ‚ç‚¹æœ‰å¯Œä½™é”®ï¼ˆâ‰¥âŒˆm&#x2F;2âŒ‰ï¼‰</td><td>å€Ÿä¸€ä¸ªé”®å¹¶æ›´æ–°çˆ¶èŠ‚ç‚¹</td></tr><tr><td>åˆå¹¶</td><td>å…„å¼ŸèŠ‚ç‚¹æ— å¯Œä½™é”®</td><td>åˆå¹¶ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹åˆ é™¤å¯¹åº”é”®</td></tr></tbody></table><hr><h4 id="5-B-æ ‘æ“ä½œå¯¹æ€§èƒ½çš„å½±å“"><a href="#5-B-æ ‘æ“ä½œå¯¹æ€§èƒ½çš„å½±å“" class="headerlink" title="5. B+æ ‘æ“ä½œå¯¹æ€§èƒ½çš„å½±å“"></a><strong>5. B+æ ‘æ“ä½œå¯¹æ€§èƒ½çš„å½±å“</strong></h4><p>â€¢ <strong>æ’å…¥åˆ†è£‚</strong>ï¼š<br>  å¯èƒ½å¯¼è‡´çˆ¶èŠ‚ç‚¹é€’å½’åˆ†è£‚ï¼Œæœ€åæƒ…å†µæ ‘é«˜å¢åŠ ï¼Œä½†æ¦‚ç‡æä½ï¼ˆé˜¶æ•°é€šå¸¸è¾ƒå¤§ï¼‰ã€‚<br>â€¢ <strong>åˆ é™¤åˆå¹¶</strong>ï¼š<br>  é¢‘ç¹åˆå¹¶å¯èƒ½å¢åŠ ç¢ç‰‡ï¼Œä½†InnoDBé€šè¿‡å¡«å……å› å­ï¼ˆ<code>innodb_fill_factor</code>ï¼‰é¢„ç•™ç©ºé—´å‡å°‘åˆå¹¶ã€‚<br>â€¢ <strong>å¹³è¡¡æ€§</strong>ï¼š<br>  æ‰€æœ‰æ“ä½œä¿è¯æ ‘é«˜å¹³è¡¡ï¼ŒæŸ¥è¯¢æ•ˆç‡ç¨³å®šåœ¨ ( O(\log_m n) )ã€‚</p><hr><p>é€šè¿‡ä»¥ä¸Šç¤ºä¾‹ï¼Œå¯ä»¥æ¸…æ™°ç†è§£B+æ ‘å¦‚ä½•é€šè¿‡åˆ†è£‚å’Œåˆå¹¶ä¿æŒå¹³è¡¡ï¼Œä»è€Œé«˜æ•ˆæ”¯æŒæ•°æ®åº“çš„å¢åˆ æŸ¥æ”¹æ“ä½œã€‚</p></blockquote><hr><h2 id="MySQLè¿›é˜¶"><a href="#MySQLè¿›é˜¶" class="headerlink" title="MySQLè¿›é˜¶"></a>MySQLè¿›é˜¶</h2><h3 id="MySQLæ¶æ„"><a href="#MySQLæ¶æ„" class="headerlink" title="MySQLæ¶æ„"></a>MySQLæ¶æ„</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://mp.weixin.qq.com/s/QevKTIIadpguyWxm7od6SQ">ç¾å›¢äºŒé¢æ‹·æ‰“ï¼šMySQLä¸­ SELECT è¯­å¥æ‰§è¡Œæµç¨‹ï¼Ÿ</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007401.png" alt="image-20241008114828024"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262009368.png" alt="image-20241008114849197"></p><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>åœ¨2024å¹´9æœˆ24æ—¥é¢è¯•ä¸­ï¼Œé¢è¯•å®˜å¯¹MySQLäº‹åŠ¡è¿›è¡Œäº†æé—®ï¼Œä½†æ˜¯æˆ‘å¿˜è®°äº†ã€‚ä¸ºä»€ä¹ˆä¼šå¿˜è®°å‘¢ï¼Ÿé¦–å…ˆå¯¹äºMySQLäº‹åŠ¡çš„ç†è§£å¹¶ä¸æ·±ï¼Œä»…ä»…çŸ¥è¯†åœç•™åœ¨äº†äº†è§£çš„å±‚é¢ä¸Šï¼Œå¯¹äºå…¶å†…åœ¨å­˜åœ¨çš„é€»è¾‘ï¼Œä¸æ¯«ä¸æ˜ã€‚æ‰€ä»¥å°±ä¼šå‡ºç°ä»Šå¤©çœ‹å®Œå¥½ä¼¼æ‡‚äº†ï¼Œä½†æ˜¯æ˜å¤©å†é—®å°±å…¨éƒ½å›ç­”ä¸ä¸Šæ¥äº†ã€‚æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘è¦å¯¹è¿™éƒ¨åˆ†å†…å®¹åˆ°è¾¾ç†è§£çš„åœ°æ­¥ã€‚</p><h5 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡</h5><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç™½ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿäº‹åŠ¡æ˜¯ä¸€ç§æ¦‚å¿µï¼Œå®ƒå¯ä»¥å­˜åœ¨MySQLä¸­ï¼Œä¹Ÿå¯ä»¥å­˜åœ¨åç«¯ä»£ç ä¸­ï¼Œç”šè‡³æ˜¯Redisä¸­ã€‚äº‹åŠ¡å°±æ˜¯ä¸€ç»„æ“ä½œï¼Œè¿™ç»„æ“ä½œæ˜¯ä¸¥å¯†ç›¸å…³çš„ã€‚ä¸€å¥è¯å®ƒä»¬åŒç”Ÿæ­»ï¼Œè¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥ã€‚</p><h5 id="ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡"><a href="#ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡"></a>ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡</h5><p>æˆ‘ä»¬éƒ½çŸ¥é“äº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„çŠ¶æ€ä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ç§çŠ¶æ€ä¸€è‡´æ˜¯ä¸ºäº†è§£å†³å­˜åœ¨çš„ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><p>ä¸¾ä¸ªæ —å­ï¼Œè½¬è´¦æ˜¯æœ€ç»å…¸çš„äº‹åŠ¡é—®é¢˜ã€‚Aç»™Bè½¬è´¦ï¼ŒAè´¦æˆ·éœ€è¦æ‰£é’±ï¼ŒBè´¦æˆ·éœ€è¦åŠ é’±ï¼Œè¿™å°±æ˜¯ä¸€ç»„æ“ä½œï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæˆåŠŸäº†å°±ä¼šå¯¼è‡´æ•°æ®åº“ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼è¿™å°±ä¼šå‡ºç°å¾ˆå¤§çš„é—®é¢˜ã€‚</p><p>è¿™å°±æ˜¯äº‹åŠ¡å­˜åœ¨çš„æ„ä¹‰ã€‚</p><h5 id="äº‹åŠ¡æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢"><a href="#äº‹åŠ¡æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢" class="headerlink" title="äº‹åŠ¡æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢"></a>äº‹åŠ¡æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢</h5><p>é€šè¿‡äº‹åŠ¡çš„æ¦‚å¿µæ¥çœ‹ï¼Œè¦ä¹ˆéƒ½æˆåŠŸã€è¦ä¹ˆéƒ½å¤±è´¥ã€‚å¾ˆæ˜¾ç„¶è¿™ç»„æ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œæˆ‘ä»¬ç§°ä¸º<strong>åŸå­æ€§</strong>ã€‚</p><p>å¾ˆå¥½ï¼Œè¿™åªæ˜¯å•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç°åœ¨æˆ‘ä»¬å‰å¾€å¤šçº¿ç¨‹ã€‚æˆ‘ä»¬éƒ½çŸ¥é“äº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œè¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œçº¿ç¨‹Aè®¿é—®æ•°æ®dataï¼Œçº¿ç¨‹Bä¹Ÿè®¿é—®æ•°æ®ï¼Œä»–ä»¬çš„è®¿é—®é¡ºåºä¸å®šï¼Œè¿™å°±æ˜¯é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„ä¸ç¡®å®šã€‚</p><p>æˆ‘ä»¬ä¹Ÿä¸¾ä¸ªæ —å­ï¼ŒAè¯»å–äº†æ•°æ®100ï¼Œç„¶åå‡å»äº†50ï¼Œä½†æ˜¯Aè¿˜æ²¡æœ‰ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œçº¿ç¨‹Bå°±å¼€å§‹æ‰§è¡Œã€‚å®ƒä¹Ÿå»è¯»å–äº†è¿™ä¸ªæ•°æ®ï¼Œå› ä¸ºAè¿˜æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥Bè¯»å–çš„æ•°æ®è¿˜æ˜¯100.å¦‚æœè¿™æ—¶å€™Bç»§ç»­æ‰§è¡Œï¼Œå¹¶å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œæ“ä½œå’Œä¿å­˜ï¼Œé‚£ä¹ˆå¦‚æœAæœ€ç»ˆå¤±è´¥å›æ»šï¼Œä½†æ˜¯è¿™æ•°æ®å·²ç»é”™è¯¯ï¼Œå› ä¸ºBå·²ç»åŸºäºé”™è¯¯çš„æ•°æ®åšäº†å†³ç­–ã€‚è¿™å°±æ˜¯äº‹åŠ¡é‡Œé¢æœ€å›°éš¾çš„ä¸€ç‚¹<strong>éš”ç¦»æ€§</strong>ã€‚</p><p>æˆ‘ä»¬ä¸Šé¢é™åˆ°ï¼Œå¦‚æœäº‹åŠ¡ä¸­æŸä¸€ä¸ªå‡ºé”™äº†ï¼Œéœ€è¦å›æ»šï¼Œé‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆå›æ»šçš„å‘¢ï¼Ÿé‚£è‚¯å®šå°±æ˜¯è¯»å–ä¹‹å‰ä¿å­˜çš„æ•°æ®æ¥è¦†ç›–å°±è¡Œäº†å‘€ã€‚æ‰€ä»¥è¿™å°±éœ€è¦ä¸€ä¸ªç‰¹ç‚¹<strong>æŒä¹…æ€§</strong>ã€‚</p><p>ä¸Šé¢æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯ä¸ºäº†ä¿è¯æœ€åä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£ä¹ˆå°±æ˜¯æ•°æ®<strong>ä¸€è‡´æ€§</strong>ã€‚æˆ‘ä»¬æ‰€æœ‰åšçš„ä¸€åˆ‡éƒ½æ˜¯ä¸ºäº†ä¿è¯MySQLä¸­çš„æ•°æ®ä¸€è‡´ï¼Œä¸ä¼šå‡ºç°é”™è¯¯ã€‚</p><p>æˆ‘ä»¬é€šè¿‡åˆ†æå¾—åˆ°äº†äº‹åŠ¡çš„å››ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚åœ¨æ¥ä¸‹æ¥çš„é¢è¯•ä¸­è¿˜æ˜¯å…·ä½“å¼€å‘ä¸­ï¼Œäº‹åŠ¡è¿™ä¸€ä¸ªæ¦‚å¿µæ¶‰åŠåˆ°æœ€å¤šçš„å°±æ˜¯<strong>éš”ç¦»æ€§</strong>ã€‚</p><h5 id="éš”ç¦»æ€§"><a href="#éš”ç¦»æ€§" class="headerlink" title="éš”ç¦»æ€§"></a>éš”ç¦»æ€§</h5><p>åœ¨ä¸Šé¢æˆ‘ä»¬ç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹äº‹åŠ¡çš„ç‰¹ç‚¹ä¸­çš„éš”ç¦»æ€§ï¼Œä½†æ˜¯è¿™è¿œè¿œä¸å¤Ÿã€‚æˆ‘ä»¬å‡è®¾ç°åœ¨æ˜¯é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹äº‹åŠ¡ä¹‹é—´è®¿é—®ç›¸åŒçš„æ•°æ®ï¼Œå¹¶å¯¹è¿™ä¸ªæ•°æ®åšè¯»å†™æ“ä½œï¼Œè¯·é—®è¿™ä¼šé€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>ä»ä¸Šé¢ç®€å•çš„æ¥çœ‹ï¼Œå¾ˆæ˜¾ç„¶ä¸€ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œè¯»å–åˆ°äº†å…¶å®ƒäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œå°±æ˜¯è¿™ä¸ªæ•°æ®è¢«åˆ«çš„äº‹åŠ¡è¯»å–äº†ç”šè‡³æ“ä½œäº†ï¼Œä½†æ˜¯ç›®å‰è¿˜ä¸çŸ¥é“è¿™ä¸ªäº‹åŠ¡æ˜¯å¦å¯ä»¥å…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œã€‚é‚£ä¹ˆå¦‚æœç°åœ¨ä½ å»è¯»å–è¿™ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆå°±æ˜¯è¯»å–åˆ°äº†å¯èƒ½ä¼šå­˜åœ¨é—®é¢˜çš„æ•°æ®ï¼Œè¿™å°±å«è¯»å–åˆ°äº†æœªæäº¤çš„æ•°æ®ï¼è¿™ä¸ªä¹Ÿè¢«ç§°ä¸º<strong>è„è¯»</strong>ï¼</p><p>é‚£ä¹ˆè¯·é—®æˆ‘è¯¥å¦‚ä½•é¿å…è„è¯»å‘¢ï¼Ÿ</p><p>è§£å†³åŠæ³•ï¼ŒMySQLå·²ç»ç»™å‡ºäº†ã€‚MySQLé’ˆå¯¹æ¯ä¸€å¼ è¡¨éƒ½å¯ä»¥è®¾ç½®è¿™å¼ è¡¨çš„éš”ç¦»ç­‰çº§ï¼Œä¸åŒçš„éš”ç¦»ç­‰çº§å¯ä»¥è§£å†³ä¸åŒç¨‹åº¦ä¸‹é«˜å¹¶å‘å¸¦æ¥çš„éš”ç¦»æ€§é—®é¢˜ã€‚</p><p>MySQLæœ‰å››ä¸ªéš”ç¦»ç­‰çº§ï¼Œåˆ†åˆ«æ˜¯ï¼šè¯»å–æœªæäº¤ã€è¯»å–å·²æäº¤ã€å¯é‡å¤è¯»å’Œå¯ä¸²è¡ŒåŒ–ã€‚è¿™å››ä¸ªéš”ç¦»ç­‰çº§æ˜¯é€æ­¥å‡é«˜ã€‚å¯èƒ½ç°åœ¨è¿˜è®°ä¸ä½å®ƒï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°†é€æ­¥å»ä»‹ç»è¿™äº›æ¦‚å¿µã€‚</p><p>å‰é¢ä¸æ˜¯è¯´åˆ°äº†è„è¯»å—ï¼Ÿè„è¯»é€ æˆçš„ä¸»è¦åŸå› ä¸å°±æ˜¯çº¿ç¨‹è¯»å–åˆ°äº†æœªæäº¤çš„æ•°æ®å—ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†äº‹åŠ¡ç­‰çº§æ”¹æˆè¯»å–å·²æäº¤å°±å¯ä»¥é¿å…çº¿ç¨‹å»è¯»å–æœªæäº¤çš„æ•°æ®ã€‚</p><p>é‚£è¿™æ ·çš„è¯ï¼Œè¿˜éœ€è¦ä¸‹é¢å¯é‡å¤è¯»å’Œå¯ä¸²è¡Œä¸¤ä¸ªäº‹åŠ¡ç­‰çº§åšä»€ä¹ˆç”¨å‘¢ï¼Ÿï¼å¾ˆæ˜¾ç„¶ï¼Œåœ¨å…·ä½“çš„å¼€å‘ä¸­ï¼Œè¯»å–å·²æäº¤çš„æ•°æ®è¿˜æ˜¯ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><p>æˆ‘å®åœ¨æ— æ³•çœŸæ­£ç†è§£ä¸å¯é‡å¤è¯»å’Œå¹»è¯»åœ¨å®é™…åœºæ™¯ä¸­å‡ºç°çš„é—®é¢˜ï¼Œå¦‚æœåç»­æœ‰ç†è§£äº†ä¼šæ›´æ–°ã€‚</p><p>æŒ‰ç…§æ¦‚å¿µæ¥è®²ï¼Œ<strong>ä¸å¯é‡å¤è¯»</strong>æ˜¯é«˜å¹¶å‘æƒ…å†µä¸‹ä¼šå‡ºç°çš„é—®é¢˜ã€‚å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ä¸¤ä¸ªæŸ¥è¯¢åŒä¸€ä¸ªæ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å°±å«åšä¸å¯é‡å¤è¯»ã€‚ä¸ºä»€ä¹ˆå«ä¸å¯é‡å¤è¯»å‘¢ï¼Ÿå› ä¸ºä¸¤æ¬¡è¯»çš„ä¸ä¸€æ ·å˜›ï¼Œæ‰€ä»¥ä¸è®©ä½ é‡å¤è¯»å˜›ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯<strong>å¹»è¯»</strong>å‘¢ï¼Ÿå¹»è¯»å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªäº‹åŠ¡ä¸­ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä½†æ˜¯è·Ÿä¸å¯é‡å¤è¯»ä¸ä¸€æ ·çš„åœ¨äºå¹»è¯»å˜åŒ–çš„ä¸»è¦åœ¨æ–°å¢æƒ…å†µä¸‹çš„å˜åŒ–ï¼Œä¸å¯é‡å¤è¯»ä¸»è¦åœ¨æ•°æ®æ›´æ”¹ä¸Šã€‚</p><p>å°†äº‹åŠ¡ç­‰çº§æé«˜åœ¨å¯é‡å¤è¯»å°±å¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜ï¼ŒæŠŠäº‹åŠ¡ç­‰çº§æé«˜åˆ°å¯ä¸²è¡ŒåŒ–å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·å¹¶å‘æ•ˆæœä¼šé™ä½ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ«ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ä¹‹é—´çš„åŒºåˆ«å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºMySQLäº‹åŠ¡åœ¨å¤„ç†å®ƒä»¬çš„æ–¹æ¡ˆä¸ä¸€æ ·ã€‚</p><p>è§£å†³ä¸å¯é‡å¤è¯»å°±æ˜¯ç›´æ¥å¯¹è®°å½•åŠ é”ï¼Œä½†æ˜¯æ–°å¢çš„è¯è¿™æ ·å°±é”ä¸ä½äº†ï¼Œè¿™å°±é€ æˆäº†å¹»è¯»å’¯ã€‚é‚£ä¹ˆæ€ä¹ˆè§£å†³æ–°å¢åŠ é”é—®é¢˜å‘¢ï¼Œæ–¹æ¡ˆæ˜¯å¯¹IDåŠ é”ï¼Œå«åšNext-Key Lock(Recoed Lock + Gap Lock)ã€‚å…·ä½“æ˜¯å¦‚ä½•å®ç°ä¸å¤ªäº†è§£ã€‚</p><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>äº‹åŠ¡ç®€å•çš„æ¥è¯´æ˜¯æ•°æ®åº“ä¸­çš„ä¸€ç»„æ“ä½œï¼Œè¿™ç»„æ“ä½œå…·æœ‰ä¸€å®šçš„ç‰¹æ®Šæ€§ï¼Œæ‰€ä»¥æŠ€æœ¯äººå‘˜å°†å…·æœ‰è¿™ç»„ç‰¹æ®Šæ€§çš„æ“ä½œç§°ä¸ºäº‹åŠ¡ã€‚é‚£ä¹ˆè¿™ç‰¹æ®Šæ€§ç‰¹æ®Šåœ¨å“ªé‡Œå‘¢ï¼Ÿå³è¿™ç»„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥ï¼Œå³è¿™ç»„æ“ä½œæ˜¯æåº¦è€¦åˆã€‚</p><p>ä¸€æ—¦è¿™ç»„æ“ä½œä¸­çš„æŸä¸ªæ“ä½œå¤±è´¥äº†ï¼Œæ•°æ®åº“å°±ä¼šå›æ»šåˆ°è¿™ç»„æ“ä½œä¹‹å‰çš„çŠ¶æ€ï¼Œå³ä¸ä¼šä¿ç•™è¿™ç»„æ“ä½œä¸­æŸäº›æ­£å¸¸æ‰§è¡Œçš„ç»“æœã€‚</p><p>MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤â½€æŒçš„éš”ç¦»çº§åˆ«æ˜¯ REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</p><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><p>é€šè¿‡ä¸Šé¢å¯¹äº‹åŠ¡æ¦‚å¿µçš„ä»‹ç»ï¼Œç›¸ä¿¡ä¹Ÿèƒ½çŒœåˆ°äº‹åŠ¡çš„ä¸€äº›ç‰¹ç‚¹ã€‚</p><h5 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h5><p>é¦–å…ˆå°±æ˜¯åŸå­æ€§å•¦ï¼Œè¿™ç»„æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼Œå³è¿™ç»„æ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å€Ÿç”¨åŸå­è¿™ä¸ªåè¯æ¥æè¿°è¿™ä¸€ç‰¹æ€§ï¼Œå°±ç§°ä¸ºåŸå­æ€§ï¼›</p><h5 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h5><p>æ‹¿è½¬è´¦çš„ä¾‹å­æ¥è§£é‡Šï¼ŒAç»™Bè½¬äº†é’±ï¼Œé‚£ä¹ˆAçš„è´¦æˆ·å°±å¿…é¡»æ‰£é’±ï¼ŒBçš„è´¦æˆ·å¿…é¡»åŠ é’±ï¼Œè¿™ä¸ªçŠ¶æ€å¿…é¡»ä¸€è‡´ï¼›ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°åŸå­æ€§æ˜¯ä¸€è‡´æ€§çš„å‰æï¼Œä¸€è‡´æ€§æ˜¯åŸå­æ€§çš„ä¿éšœï¼›</p><h5 id="éš”ç¦»æ€§-1"><a href="#éš”ç¦»æ€§-1" class="headerlink" title="éš”ç¦»æ€§"></a>éš”ç¦»æ€§</h5><p>éš”ç¦»æ€§æ˜¯æŒ‡åœ¨å¹¶å‘çš„ç¯å¢ƒä¸‹ï¼Œä¸åŒçš„äº‹åŠ¡ä¹‹é—´è¿›è¡Œéš”ç¦»ï¼Œä»è€Œé¿å…å„ç§å¹¶å‘é—®é¢˜ã€‚</p><p>1. </p><h6 id="è¯»æœªæäº¤"><a href="#è¯»æœªæäº¤" class="headerlink" title="è¯»æœªæäº¤"></a>è¯»æœªæäº¤</h6><p>åœ¨è¿™ç§çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å…¶å®ƒäº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œè¿™ç§çº§åˆ«çš„äº‹åŠ¡ç­‰çº§ä¼šé€ æˆ<strong>è„è¯»</strong>ã€‚è¿™ä¸ªçº§åˆ«çš„å¹¶å‘æ€§æœ€é«˜ï¼Œä½†æ•°æ®ä¸€è‡´æ€§æœ€å·®ã€‚</p><p><strong>ä¾‹å­</strong>ï¼š</p><ul><li>äº‹åŠ¡Aå¼€å§‹ï¼Œè¯»å–è´¦æˆ·1çš„ä½™é¢ä¸º100å…ƒã€‚</li><li>äº‹åŠ¡Bå¼€å§‹ï¼Œä¿®æ”¹è´¦æˆ·1çš„ä½™é¢ä¸º200å…ƒï¼Œä½†æœªæäº¤ã€‚</li><li>äº‹åŠ¡Aå†æ¬¡è¯»å–è´¦æˆ·1çš„ä½™é¢ï¼Œä¼šçœ‹åˆ°200å…ƒï¼Œå³ä½¿äº‹åŠ¡Bè¿˜æ²¡æœ‰æäº¤ã€‚è¿™å°±æ˜¯<strong>è„è¯»</strong>ã€‚</li></ul><h6 id="è¯»å·²æäº¤"><a href="#è¯»å·²æäº¤" class="headerlink" title="è¯»å·²æäº¤"></a>è¯»å·²æäº¤</h6><p>åœ¨è¿™ç§éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ã€‚è¿™è§£å†³äº†è„è¯»çš„é—®é¢˜ï¼Œä½†å¯èƒ½ä¼šäº§ç”Ÿä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚</p><p><strong>å¯èƒ½é€ æˆçš„é—®é¢˜ï¼š</strong></p><ul><li><p><strong>æ€§èƒ½å½±å“ï¼š</strong> ç”±äºéš”ç¦»çº§åˆ«éå¸¸ä¸¥æ ¼ï¼Œäº‹åŠ¡ä¹‹é—´å‡ ä¹ä¸å…è®¸å¹¶å‘æ‰§è¡Œï¼Œè¿™å¯èƒ½å¯¼è‡´ç³»ç»Ÿæ€§èƒ½é™ä½ã€‚</p></li><li><p><strong>ä¾‹å­ï¼š</strong></p><ol><li>äº‹åŠ¡Aè¯»å–æŸä¸ªæ•°æ®é¡¹çš„å€¼ä¸º100ã€‚</li><li>äº‹åŠ¡Bä¿®æ”¹è¯¥æ•°æ®é¡¹çš„å€¼å¹¶æäº¤ï¼Œæ–°çš„å€¼ä¸º200ã€‚</li><li>äº‹åŠ¡Aå†æ¬¡è¯»å–è¯¥æ•°æ®é¡¹æ—¶ï¼Œå¾—åˆ°çš„æ˜¯200ï¼Œè€Œä¸æ˜¯æœ€åˆè¯»å–çš„100ã€‚</li></ol><p><strong>ç¤ºä¾‹ï¼š</strong> å‡è®¾äº‹åŠ¡AæŸ¥è¯¢ä¸€ä¸ªå•†å“çš„åº“å­˜é‡ï¼Œå¾—åˆ°çš„æ˜¯50ã€‚æ­¤æ—¶äº‹åŠ¡Bä¿®æ”¹å¹¶æäº¤åº“å­˜é‡ä¸º30ã€‚å½“äº‹åŠ¡Aå†æ¬¡æŸ¥è¯¢åº“å­˜é‡æ—¶ï¼Œå¾—åˆ°çš„æ˜¯30ï¼Œè€Œä¸æ˜¯æœ€åˆè¯»å–çš„50ï¼Œè¿™å°±æ˜¯ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚</p></li></ul><h6 id="å¯é‡å¤è¯»"><a href="#å¯é‡å¤è¯»" class="headerlink" title="å¯é‡å¤è¯»"></a>å¯é‡å¤è¯»</h6><p>è¿™<strong>æ˜¯MySQLé»˜è®¤çš„éš”ç¦»çº§åˆ«</strong>ã€‚åœ¨è¿™ç§éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨å¼€å§‹åï¼Œå…¶è¯»å–çš„æ•°æ®ä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡çš„æ›´æ–°æ‰€å½±å“ï¼Œç›´åˆ°è¯¥äº‹åŠ¡ç»“æŸã€‚ <strong>ä¿è¯ä¸€ä¸ªäº‹åŠ¡åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…å¤šæ¬¡è¯»å–åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„</strong>ï¼Œ<strong>ä½†ä»å¯èƒ½ä¼šæœ‰å¹»è¯»é—®é¢˜</strong>ã€‚</p><p><strong>ä¾‹å­</strong>ï¼š</p><ul><li>äº‹åŠ¡Aå¼€å§‹ï¼Œè¯»å–è´¦æˆ·1çš„ä½™é¢ä¸º100å…ƒã€‚</li><li>äº‹åŠ¡Bå¼€å§‹ï¼Œä¿®æ”¹è´¦æˆ·1çš„ä½™é¢ä¸º200å…ƒï¼Œç„¶åæäº¤ã€‚</li><li>äº‹åŠ¡Aå†æ¬¡è¯»å–è´¦æˆ·1çš„ä½™é¢ï¼Œä»ç„¶ä¼šçœ‹åˆ°100å…ƒï¼Œå› ä¸ºå®ƒåœ¨äº‹åŠ¡å¼€å§‹æ—¶åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®çš„å¿«ç…§ï¼Œå³ä½¿å…¶ä»–äº‹åŠ¡æäº¤äº†æ›´æ–°ã€‚</li></ul><h6 id="ä¸²è¡ŒåŒ–"><a href="#ä¸²è¡ŒåŒ–" class="headerlink" title="ä¸²è¡ŒåŒ–"></a>ä¸²è¡ŒåŒ–</h6><p>è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡é”å®šæ¶‰åŠçš„æ•°æ®è¡Œæ¥é¿å…å¹¶å‘é—®é¢˜ï¼Œå®é™…ä¸Šæ˜¯å°†äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œã€‚</p><p><strong>ä¾‹å­</strong>ï¼š</p><ul><li>äº‹åŠ¡Aå¼€å§‹ï¼Œè¯»å–è´¦æˆ·1çš„ä½™é¢ä¸º100å…ƒï¼Œå¹¶é”å®šè¯¥è¡Œã€‚</li><li>äº‹åŠ¡Bå°è¯•è¯»å–æˆ–ä¿®æ”¹è´¦æˆ·1çš„ä½™é¢ï¼Œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡Aç»“æŸå¹¶é‡Šæ”¾é”ã€‚</li><li>äº‹åŠ¡Aç»“æŸï¼Œäº‹åŠ¡Bæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007817.png" alt="image-20240909110054353"></p><h5 id="æŒä¹…æ€§"><a href="#æŒä¹…æ€§" class="headerlink" title="æŒä¹…æ€§"></a>æŒä¹…æ€§</h5><p>â¼€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ® åº“å‘â½£æ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</p><p>åªæœ‰ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸâ¼¦æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œâ¼€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿éšœã€‚ ä¹Ÿå°±æ˜¯è¯´ Aã€Iã€D æ˜¯â¼¿æ®µï¼ŒC æ˜¯â½¬çš„ï¼</p><h4 id="å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜"><a href="#å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜"></a>å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007138.png" alt="image-20240909103442559"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007592.png" alt="image-20240909104643321"></p><h5 id="è„è¯»"><a href="#è„è¯»" class="headerlink" title="è„è¯»"></a>è„è¯»</h5><p>å‡ºç°å¹»è¯»çš„åŸå› æ˜¯äº‹åŠ¡è¯»å–åˆ°äº†æœªæäº¤çš„æ•°æ®ï¼Œä¾æ®è¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å°±å¾—å‡ºäº†æˆ‘ä»¬ç¬¬ä¸€ç§æ–¹æ¡ˆã€‚</p><p>æ–¹æ¡ˆä¸€ï¼šè®¾ç½®æ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºread committedï¼Œå³åªèƒ½è¯»å–å·²æäº¤çš„æ•°æ®ï¼›</p><h5 id="ä¸å¯é‡å¤è¯»-Non-Repeatable-read"><a href="#ä¸å¯é‡å¤è¯»-Non-Repeatable-read" class="headerlink" title="ä¸å¯é‡å¤è¯»(Non-Repeatable read)"></a>ä¸å¯é‡å¤è¯»(Non-Repeatable read)</h5><p>ä¸å¯é‡å¤è¯»ç®€å•çš„æ¥è¯´å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œå‘ç°è¯¥æ•°æ®å‰åä¸ä¸€è‡´è€Œå‡ºç°çš„é—®é¢˜ã€‚</p><p>æŠŠæ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºå¯é‡å¤è¯»Repeatable readã€‚</p><h5 id="å¹»è¯»"><a href="#å¹»è¯»" class="headerlink" title="å¹»è¯»"></a>å¹»è¯»</h5><p>å¹»è¯»ï¼šåŒæ„äº‹åŠ¡å‰åè¯»å–æ•°æ®çš„æ€»é‡ä¸ä¸€è‡´ã€‚</p><p>æˆ‘ä»¬æŠŠæ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®æˆæœ€é«˜çº§ï¼šä¸²è¡ŒåŒ–æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šserializable ã€‚</p><p>ä½†æ˜¯è¿™æ ·å°±ä¼šå¯¼è‡´æ•°æ®åº“å°±å˜æˆäº†å•çº¿ç¨‹è®¿é—®çš„æ•°æ®åº“ï¼Œå¯¼è‡´æ€§èƒ½é™ä½å¾ˆå¤šã€‚</p><p>Isolation å±æ€§ä¸€å…±æ”¯æŒäº”ç§äº‹åŠ¡è®¾ç½®ï¼Œå…·ä½“ä»‹ç»å¦‚ä¸‹ï¼š</p><p>DEFAULTï¼š ä½¿ç”¨æ•°æ®åº“è®¾ç½®çš„éš”ç¦»çº§åˆ« ( é»˜è®¤ ) ï¼Œç”± DBA é»˜è®¤çš„è®¾ç½®æ¥å†³å®šéš”ç¦»çº§åˆ« .</p><p>READ_UNCOMMITTEDï¼š ä¼šè¯»åˆ°æœªæäº¤çš„æ•°æ®ï¼Œ å‡ºç°è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» ( éš”ç¦»çº§åˆ«æœ€ä½ï¼Œå¹¶å‘æ€§èƒ½é«˜ )ã€‚</p><p>READ_COMMITTEDï¼š ä¸ä¼šè¯»åˆ°æœªæäº¤çš„æ•°æ®ï¼Œä¼šå‡ºç°ä¸å¯é‡å¤è¯»ã€å¹»è¯»é—®é¢˜ï¼ˆé”å®šæ­£åœ¨è¯»å–çš„è¡Œï¼‰</p><p>REPEATABLE_READ ï¼šä¼šå‡ºå¹»è¯»ï¼ˆé”å®šæ‰€è¯»å–çš„æ‰€æœ‰è¡Œï¼‰</p><p>SERIALIZABLE ï¼šä¿è¯æ‰€æœ‰çš„æƒ…å†µä¸ä¼šå‘ç”Ÿï¼ˆé”è¡¨ï¼‰ã€‚</p><h4 id="MySQL-çš„éš”ç¦»çº§åˆ«æ˜¯åŸºäºé”å®ç°çš„å—"><a href="#MySQL-çš„éš”ç¦»çº§åˆ«æ˜¯åŸºäºé”å®ç°çš„å—" class="headerlink" title="MySQL çš„éš”ç¦»çº§åˆ«æ˜¯åŸºäºé”å®ç°çš„å—"></a>MySQL çš„éš”ç¦»çº§åˆ«æ˜¯åŸºäºé”å®ç°çš„å—</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007610.png" alt="image-20240909110559001"></p><p><strong>MVCC</strong></p><blockquote><p>MVCCï¼ˆMulti-Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æ˜¯ä¸€ç§æ•°æ®åº“çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œï¼ŒåŒæ—¶é¿å…äº†é”æœºåˆ¶å¸¦æ¥çš„æ€§èƒ½ç“¶é¢ˆå’Œæ­»é”é—®é¢˜ã€‚é€šè¿‡ç»´æŠ¤æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼ŒMVCC å¯ä»¥ä½¿è¯»æ“ä½œä¸é˜»å¡å†™æ“ä½œï¼Œå†™æ“ä½œä¹Ÿä¸é˜»å¡è¯»æ“ä½œï¼Œä»è€Œæé«˜å¹¶å‘æ€§èƒ½ã€‚</p></blockquote><blockquote><h3 id="MVCC-çš„æ ¸å¿ƒæ€æƒ³ï¼š"><a href="#MVCC-çš„æ ¸å¿ƒæ€æƒ³ï¼š" class="headerlink" title="MVCC çš„æ ¸å¿ƒæ€æƒ³ï¼š"></a>MVCC çš„æ ¸å¿ƒæ€æƒ³ï¼š</h3><p>MVCC æœºåˆ¶åœ¨æ•°æ®åº“ä¸­ç»´æŠ¤äº†æ¯ä¸€è¡Œæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œé€šå¸¸æ¯è¡Œæ•°æ®éƒ½ä¼šå­˜å‚¨ä»¥ä¸‹å‡ ä¸ªé¢å¤–çš„ä¿¡æ¯ï¼š</p><ol><li><strong>ç‰ˆæœ¬å·</strong>æˆ–<strong>äº‹åŠ¡ID</strong>ï¼šæ¯æ¬¡æ•°æ®ä¿®æ”¹ï¼ˆINSERTã€UPDATEã€DELETEï¼‰æ—¶ï¼Œæ•°æ®åº“éƒ½ä¼šåˆ†é…ä¸€ä¸ªäº‹åŠ¡IDï¼Œä½œä¸ºè¯¥ç‰ˆæœ¬çš„æ ‡è¯†ã€‚</li><li><strong>åˆ é™¤æ ‡è®°</strong>ï¼šæ ‡è¯†è¯¥æ•°æ®è¡Œæ˜¯å¦è¢«åˆ é™¤ã€‚</li><li><strong>å¼€å§‹ç‰ˆæœ¬å·å’Œç»“æŸç‰ˆæœ¬å·</strong>ï¼šè®°å½•è¯¥æ•°æ®è¡Œä½•æ—¶è¢«åˆ›å»ºå’Œä½•æ—¶å¤±æ•ˆï¼ˆåœ¨è¢«æ›´æ–°æˆ–åˆ é™¤æ—¶ï¼‰ã€‚</li></ol><p>å½“ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå®ƒåªä¼šçœ‹åˆ°åœ¨å½“å‰äº‹åŠ¡å¼€å§‹æ—¶å¯è§çš„ç‰ˆæœ¬ï¼Œè¿™æ ·å°±ä¿è¯äº†äº‹åŠ¡ä¹‹é—´çš„éš”ç¦»æ€§ã€‚</p></blockquote><h4 id="MySQLé”"><a href="#MySQLé”" class="headerlink" title="MySQLé”"></a>MySQLé”</h4><p>åœ¨MySQL5.5ç‰ˆæœ¬ä¹‹å‰é»˜è®¤ä½¿ç”¨å­˜å‚¨å¼•æ“æ˜¯MyISAMï¼Œä¹‹åMySQLé»˜è®¤çš„å­˜å‚¨å¼•æ“æ˜¯InnoDBã€‚</p><p>MyISAMä»…ä»…æ”¯æŒè¡¨çº§é”ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä¸€é”å°±é”ä½æ•´ä¸ªè¡¨ï¼Œå¾ˆæ˜¾ç„¶è¿™æ ·ä¼šå¯¼è‡´å¹¶å‘æ€§èƒ½å¾ˆå·®ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåœ¨5.5ç‰ˆæœ¬ä¹‹åèˆå¼ƒè¯¥å­˜å‚¨å¼•æ“æ¢æˆInnoDBã€‚</p><p>InnoDBæ”¯æŒè¡Œçº§é”ï¼Œæ˜¾ç„¶ä¹Ÿæ”¯æŒè¡¨çº§é”ï¼Œé»˜è®¤ä½¿ç”¨è¡Œçº§é”ã€‚â¾ çº§é”çš„ç²’åº¦æ›´â¼©ï¼Œä»…å¯¹ç›¸å…³çš„è®°å½•ä¸Šé”å³å¯ï¼ˆå¯¹â¼€â¾æˆ–è€…å¤šâ¾è®°å½•åŠ é”ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå¹¶å‘å†™â¼Šæ“ä½œæ¥ è¯´ï¼Œ InnoDB çš„æ€§èƒ½æ›´â¾¼ã€‚</p><p><strong>è¡Œçº§é”</strong>ï¼š</p><ul><li>ä¼˜ç‚¹: å¹¶å‘åº¦é«˜ï¼›</li><li>ç¼ºç‚¹ï¼šåŠ é”å¼€é”€å¤§ï¼Œå¯èƒ½ä¼šå‡ºç°æ­»é”ï¼›</li></ul><p>è¡Œçº§é”æ˜¯åŸºäºè¡¨çš„ç´¢å¼•è¿›è¡ŒåŠ é”çš„ï¼Œæ‰€ä»¥å¦‚æœå¯¹äºé‚£äº›SQLæ²¡æœ‰å‘½ä¸­ç´¢å¼•æˆ–è€…ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼Œå°±ä¼šé”ä½æ•´ä¸ªè¡¨</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007121.png" alt="image-20240909193523534"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007856.png" alt="image-20240909195036859"></p><h4 id="MySQLæ•°æ®åº“çš„äº‹åŠ¡å®ç°åŸç†"><a href="#MySQLæ•°æ®åº“çš„äº‹åŠ¡å®ç°åŸç†" class="headerlink" title="MySQLæ•°æ®åº“çš„äº‹åŠ¡å®ç°åŸç†"></a>MySQLæ•°æ®åº“çš„äº‹åŠ¡å®ç°åŸç†</h4><p>ä»¥MySQL çš„InnoDB ï¼ˆInnoDB æ˜¯ MySQL çš„â¼€ä¸ªå­˜å‚¨å¼•æ“ï¼‰ä¸ºä¾‹ï¼Œä»‹ç»â¼€ ä¸‹å•â¼€æ•°æ®åº“çš„äº‹åŠ¡å®ç°åŸç†ã€‚ InnoDB æ˜¯é€šè¿‡ â½‡å¿—å’Œé” æ¥ä¿è¯çš„äº‹åŠ¡çš„ ACIDç‰¹æ€§ï¼Œå…·ä½“å¦‚ä¸‹ï¼š </p><ul><li>ï¼ˆ1ï¼‰é€šè¿‡æ•°æ®åº“é”çš„æœºåˆ¶ï¼Œä¿éšœäº‹åŠ¡çš„éš”ç¦»æ€§ï¼› </li><li>ï¼ˆ2ï¼‰é€šè¿‡ Redo Logï¼ˆé‡åšâ½‡å¿—ï¼‰æ¥ï¼Œä¿éšœäº‹åŠ¡çš„æŒä¹…æ€§ï¼› </li><li>ï¼ˆ3ï¼‰é€šè¿‡ Undo Log ï¼ˆæ’¤é”€â½‡å¿—ï¼‰æ¥ï¼Œä¿éšœäº‹åŠ¡çš„åŸâ¼¦æ€§ï¼› </li><li>ï¼ˆ4ï¼‰é€šè¿‡ Undo Log ï¼ˆæ’¤é”€â½‡å¿—ï¼‰æ¥ï¼Œä¿éšœäº‹åŠ¡çš„â¼€è‡´æ€§ï¼›</li></ul><p><strong>Undo Log å¦‚ä½•ä¿éšœäº‹åŠ¡çš„åŸâ¼¦æ€§å‘¢ï¼Ÿ</strong> å…·ä½“çš„â½…å¼ä¸ºï¼šåœ¨æ“ä½œä»»ä½•æ•°æ®ä¹‹å‰ï¼Œâ¾¸å…ˆå°†æ•°æ®å¤‡ä»½åˆ°â¼€ä¸ªåœ°â½…ï¼ˆè¿™ä¸ª å­˜å‚¨æ•°æ®å¤‡ä»½çš„åœ°â½…ç§°ä¸º Undo Logï¼‰ï¼Œç„¶åè¿›â¾æ•°æ®çš„ä¿®æ”¹ã€‚å¦‚æœå‡ºç°äº† é”™è¯¯æˆ–è€…â½¤æˆ·æ‰§â¾äº† Rollback è¯­å¥ï¼Œç³»ç»Ÿå¯ä»¥åˆ©â½¤ Undo Log ä¸­çš„å¤‡ä»½å°† æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚ </p><p><strong>Redo Logå¦‚ä½•ä¿éšœäº‹åŠ¡çš„æŒä¹…æ€§å‘¢ï¼Ÿ</strong> å…·ä½“çš„â½…å¼ä¸ºï¼šRedo Log è®°å½•çš„æ˜¯æ–°æ•°æ®çš„å¤‡ä»½ï¼ˆå’Œ Undo Log ç›¸åï¼‰ã€‚ åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°† Redo Log æŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ã€‚å½“ ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯ Redo Log å·²ç»æŒä¹…åŒ–ã€‚ç³»ç»Ÿå¯ ä»¥æ ¹æ® Redo Log çš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°å´©æºƒä¹‹å‰çš„çŠ¶æ€ã€‚</p><p><strong>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong>ï¼šç”¨äºè®°å½•äº‹åŠ¡æ“ä½œçš„æ—¥å¿—ï¼Œç¡®ä¿å³ä½¿åœ¨æ•°æ®åº“å´©æºƒæ—¶ï¼Œé€šè¿‡é‡åšæ—¥å¿—ä¹Ÿèƒ½æ¢å¤æ•°æ®ã€‚</p><p><strong>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰</strong>ï¼šç”¨äºè®°å½•æ’¤é”€æ“ä½œï¼Œä»¥æ”¯æŒäº‹åŠ¡çš„å›æ»šã€‚undo logå¸®åŠ©åœ¨äº‹åŠ¡å¤±è´¥æˆ–æ˜¾å¼å›æ»šæ—¶ï¼Œæ’¤é”€å·²æ‰§è¡Œçš„æ“ä½œï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p><strong>é”æœºåˆ¶</strong>ï¼šInnoDBå®ç°äº†ä¸¤ç§ç±»å‹çš„é”æœºåˆ¶ï¼š<strong>è¡Œçº§é”</strong>å’Œ<strong>è¡¨çº§é”</strong>ã€‚è¡Œçº§é”ä¿è¯äº†é«˜å¹¶å‘æ€§èƒ½ï¼Œè€Œè¡¨çº§é”é€‚ç”¨äºå¤§æ‰¹é‡æ“ä½œã€‚</p><p><strong>MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</strong>ï¼šInnoDBé€šè¿‡MVCCå®ç°è¡Œçº§å¹¶å‘æ§åˆ¶ã€‚å®ƒçš„å…³é”®æœºåˆ¶æ˜¯é€šè¿‡ä¿å­˜æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬æ¥å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œï¼Œé¿å…é”å®šå†²çªï¼Œç‰¹åˆ«æ˜¯åœ¨è¾ƒä½çš„éš”ç¦»çº§åˆ«ï¼ˆå¦‚READ COMMITTEDã€REPEATABLE READï¼‰ä¸‹ã€‚</p><p>æ€ä¹ˆè¯´å‘¢ï¼ŸMySQLäº‹åŠ¡çš„ä¿è¯æ˜¯åŸºäºMVCCæ¥å®ç°çš„ï¼Œå…¶ä¸­MVCCä¸ºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå…¶æ˜¯å¦‚ä½•å…·ä½“æ¥å®ç°è¿™ä¸ªäº‹åŠ¡çš„å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°undo logå’Œredo logä¸¤ä¸ªéå¸¸é‡è¦çš„æ—¥å¿—ï¼Œé€šè¿‡è¿™ä¸ªæ—¥å¿—å’Œé”æ¥ä¿è¯å…¶äº‹åŠ¡ã€‚</p><p>å°±é‚£MySQLé»˜è®¤çš„å¯é‡å¤è¯»è¿™ä¸ªé»˜è®¤çš„äº‹åŠ¡ç­‰çº§æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹æ¥ä¿®æ”¹è¿™ä¸ªæ•°æ®æ—¶ï¼Œå…¶ä¼šå°†å…¶è€æ•°æ®ç”Ÿæˆä¸€ä¸ªå¿«ç…§ä¿å­˜åˆ°undo logä¸­ï¼Œä¸€æ–¹é¢ä¸ºäº†å…¶å®ƒçº¿ç¨‹å¯ä»¥è¯»å–è€æ•°æ®ï¼Œè¿™æ ·å°±èƒ½å¤Ÿä¿è¯é«˜å¹¶å‘ã€‚åŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†å¦‚æœè¿™ä¸ªäº‹åŠ¡æ‰§è¡Œå¤±è´¥äº†ï¼Œå¯ä»¥é€šè¿‡undo logæ¥è¿›è¡Œå›æ»šã€‚åœ¨äº‹åŠ¡æ‰§è¡ŒæˆåŠŸåï¼Œå…¶ä¼šé‡‡ç”¨ä¸¤é˜¶æ®µæäº¤æäº¤çš„æ–¹å¼æ¥æŒä¹…åŒ–ï¼Œé¦–å…ˆä¼šæŠŠè¿™ä¸ªäº‹åŠ¡ç»“æœå†™å…¥redo logï¼Œç„¶åå†æäº¤è¿™ä¸ªäº‹åŠ¡ï¼Œè¿™æ ·è¿™ä¸ªæ•°æ®æ‰æ˜¯çœŸæ­£çš„è¢«å†™å…¥äº†æ•°æ®åº“ä¸­ã€‚é€šè¿‡ä¸Šé¢çš„æè¿°ç›¸ä¿¡å¯¹MySQLä¸­çš„äº‹åŠ¡æœ‰äº†æ›´æ·±å±‚æ¬¡çš„äº†è§£ã€‚</p><h3 id="ç´¢å¼•-1"><a href="#ç´¢å¼•-1" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><p>2024å¹´9æœˆ24æ—¥ï¼Œé¢è¯•ï¼Œé—®äº†ç´¢å¼•å¤±æ•ˆï¼Œå¾ˆå¹¸è¿ï¼Œä¹‹å‰çœ‹äº†ï¼Œå¾ˆä¸å¹¸ï¼Œå¿˜è®°äº†ï¼Œæ— è¯­ingã€‚</p><p>ä¸»è¦åŸå› è¿˜æ˜¯æ²¡æœ‰çœŸæ­£çš„å»ç†è§£ç´¢å¼•è¿™ä¸€ä¸ªæ¦‚å¿µï¼Œæ‰€ä»¥ä»Šå¤©æ™šä¸Šä¹Ÿå°±ä»Šå¤©é—®çš„å‡ ä¸ªæ¦‚å¿µå»çœŸæ­£çš„å»ç†è§£ä¸€ä¸‹ã€‚</p><p>è¦ç†è§£ç´¢å¼•ï¼Œé¦–å…ˆå°±å¾—çŸ¥é“ä»€ä¹ˆæ˜¯ç´¢å¼•å§ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ç´¢å¼•å‘¢ï¼Ÿ</p><h4 id="ä»€ä¹ˆæ˜¯ç´¢å¼•"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•</h4><p>ç´¢å¼•å°±æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹æˆä¸€æœ¬ä¹¦çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•è®°å½•ç€è¿™ä¸ªæ•°æ®åº“ä¸­ä½ åˆ›å»ºç´¢å¼•ä¸‹æ ‡çš„å€¼ï¼Œå¹¶ä¸”æŸ¥è¯¢å¾ˆå¿«ã€‚</p><p>å®˜æ–¹ä»‹ç»ç´¢å¼•æ˜¯å¸®åŠ©MySQL<strong>é«˜æ•ˆè·å–æ•°æ®</strong>çš„<strong>æ•°æ®ç»“æ„</strong>ã€‚æ›´é€šä¿—çš„è¯´ï¼Œæ•°æ®åº“ç´¢å¼•å¥½æ¯”æ˜¯ä¸€æœ¬ä¹¦å‰é¢çš„ç›®å½•ï¼Œèƒ½<strong>åŠ å¿«æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦</strong>ã€‚</p><h4 id="ç´¢å¼•ç±»å‹"><a href="#ç´¢å¼•ç±»å‹" class="headerlink" title="ç´¢å¼•ç±»å‹"></a>ç´¢å¼•ç±»å‹</h4><p>æ ¹æ®è®¾å®šç´¢å¼•åˆ—ä¸Šçš„ç±»å‹è¿›è¡Œåˆ’åˆ†ï¼Œæ¯”å¦‚ç´¢å¼•åˆ—ä¸Šçš„å€¼æ˜¯å¦å¯ä»¥ä¸ºç©ºã€æ˜¯å¦å¯ä»¥é‡å¤ï¼Œè¿™æ ·å°±åˆ†ä¸ºï¼šä¸»é”®ç´¢å¼•ï¼ˆä¸é‡å¤ã€ä¸ä¸ºç©ºï¼‰ã€å”¯ä¸€ç´¢å¼•ï¼ˆä¸é‡å¤ã€å¯ä»¥ä¸ºç©ºï¼‰ã€æ™®é€šç´¢å¼•ï¼ˆæ— è¦æ±‚ï¼‰ã€å…¨æ–‡ç´¢å¼•ï¼ˆæ–‡æœ¬ç±»å‹ï¼Œå­—æ®µè¾ƒé•¿ï¼‰ã€ç©ºé—´ç´¢å¼•ï¼ˆå‡ ä½•æ•°æ®ï¼‰å’Œå‰ç¼€ç´¢å¼•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262009128.png" alt="image-20241014192208575"></p><p>MySQL ä¸­çš„ç´¢å¼•æ•°æ®ç»“æ„è‡³å…³é‡è¦ï¼Œå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚æœ€å¸¸ç”¨çš„ç´¢å¼•ç»“æ„æ˜¯ <strong>B+æ ‘</strong>ï¼Œæ­¤å¤–è¿˜æœ‰ <strong>å“ˆå¸Œç´¢å¼•</strong>ã€<strong>å…¨æ–‡ç´¢å¼•</strong> å’Œ <strong>ç©ºé—´æ•°æ®ç´¢å¼• (R-Tree)</strong>ã€‚</p><h4 id="ç´¢å¼•çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿"><a href="#ç´¢å¼•çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿" class="headerlink" title="ç´¢å¼•çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿"></a>ç´¢å¼•çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿</h4><h5 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h5><p>å¾ˆæ˜¾ç„¶ï¼ŒåŠ å¿«æ•°æ®åº“è®¿é—®é€Ÿåº¦ã€‚</p><h5 id="åŠ£åŠ¿"><a href="#åŠ£åŠ¿" class="headerlink" title="åŠ£åŠ¿"></a>åŠ£åŠ¿</h5><p>å ç©ºé—´ï¼Œä½†æ˜¯å¦‚æœæ›´æ–°ç´¢å¼•ä¸­çš„æ•°æ®çš„è¯ï¼Œæ›´æ–°é€Ÿåº¦å°±å¾ˆæ…¢ã€‚</p><h4 id="ç´¢å¼•å¤±æ•ˆ"><a href="#ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆ"></a>ç´¢å¼•å¤±æ•ˆ</h4><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/weixin_46224056/article/details/137597431#:~:text=%E4%BB%8A%E5%A4%A9%E5%B0%B1%E8%B7%9F%E5%A4%A7%E5%AE%B6">ç´¢å¼•å¤±æ•ˆçš„10ç§åœºæ™¯ï¼Œä½ çŸ¥é“å‡ ä¸ªå‘¢ï¼Ÿï¼ˆé¢è¯•å¿…åˆ·!ï¼‰</a></p><h5 id="æœ€å·¦åŒ¹é…åŸåˆ™"><a href="#æœ€å·¦åŒ¹é…åŸåˆ™" class="headerlink" title="æœ€å·¦åŒ¹é…åŸåˆ™"></a>æœ€å·¦åŒ¹é…åŸåˆ™</h5><p>æœ€å·¦åŒ¹é…åŸåˆ™æŒ‡çš„å°±æ˜¯ä½ åœ¨æŸ¥è¯¢æ—¶çš„æ¡ä»¶å¿…é¡»è¦ä»æœ€å·¦è¾¹çš„å­—æ®µå¼€å§‹ï¼Œå¦åˆ™å°±ä¸ä¼šèµ°ç´¢å¼•ã€‚å°±æ˜¯è¯´å¦‚æœç›´æ¥æŸ¥è¯¢Bæˆ–è€…Cè¿˜æœ‰å…¶å®ƒéƒ½ä¸ä¼šèµ°ç´¢å¼•ã€‚</p><p>ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™çš„éƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p><p>å³åœ¨SQLè¯­å¥ä¸­ä¸€å®šè¦æœ‰ç´¢å¼•æœ€å·¦è¾¹çš„é‚£ä¸ªå­—æ®µï¼Œæ²¡æœ‰ä¹Ÿå¯ä»¥ï¼ŒSelect é€‰ç”¨æ‰€æœ‰çš„ç´¢å¼•å­—æ®µä¹Ÿä¼šèµ°ç´¢å¼•ã€‚</p><h5 id="ä½¿ç”¨äº†select"><a href="#ä½¿ç”¨äº†select" class="headerlink" title="ä½¿ç”¨äº†select *"></a>ä½¿ç”¨äº†select *</h5><p>ä½¿ç”¨äº†Select * å¦‚æœä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œæ˜¾ç„¶ç´¢å¼•ä¹Ÿæ˜¯ä¸€å®šä¼šå¤±æ•ˆçš„ã€‚ä½†æ˜¯åœ¨ä¸€å®šçš„æƒ…å†µä¸‹å¯èƒ½ä¼šæˆåŠŸï¼Œå°±æ˜¯æ˜ç¡®æŸ¥è¯¢å¾—åˆ°çš„å­—æ®µéƒ½æ˜¯ç´¢å¼•å­—æ®µï¼Œé‚£ä¹ˆè¿™ä¹Ÿæ˜¯å¯ä»¥èµ°ç´¢å¼•æŸ¥è¯¢çš„ï¼ŒæŸ¥è¯¢æ¡ä»¶å°±æ˜¯å…·æœ‰ç´¢å¼•ä¸­çš„å­—æ®µã€‚</p><h5 id="ç´¢å¼•ä¸Šæœ‰è®¡ç®—"><a href="#ç´¢å¼•ä¸Šæœ‰è®¡ç®—" class="headerlink" title="ç´¢å¼•ä¸Šæœ‰è®¡ç®—"></a>ç´¢å¼•ä¸Šæœ‰è®¡ç®—</h5><p>å¦‚æœæ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä½†æ˜¯ç´¢å¼•ä¸Šæœ‰è®¡ç®—ä¹Ÿä¼šå¤±æ•ˆã€‚è¿™æ˜¯å› ä¸ºç´¢å¼•å»ºç«‹çš„ç»“æ„æ²¡æœ‰ä½ è¿ç®—ä¹‹åçš„ç»“æœï¼Œå®ƒä¹Ÿå°±æ— æ³•æ ¹æ®ç»“æœæ¥ç›´æ¥æŸ¥è¯¢åˆ°è¿™ä¸ªåœ¨å“ªé‡Œäº†ã€‚</p><h5 id="ç´¢å¼•ä¸Šæœ‰å‡½æ•°"><a href="#ç´¢å¼•ä¸Šæœ‰å‡½æ•°" class="headerlink" title="ç´¢å¼•ä¸Šæœ‰å‡½æ•°"></a>ç´¢å¼•ä¸Šæœ‰å‡½æ•°</h5><p>å¾ˆæ˜¾ç„¶ï¼Œå‡½æ•°ä¹Ÿæ˜¯è®¡ç®—ï¼Œç´¢å¼•å¤±æ•ˆ</p><h5 id="å­—æ®µç±»å‹ä¸åŒ"><a href="#å­—æ®µç±»å‹ä¸åŒ" class="headerlink" title="å­—æ®µç±»å‹ä¸åŒ"></a>å­—æ®µç±»å‹ä¸åŒ</h5><p>å¦‚æœç´¢å¼•ä¸­çš„ç±»å‹æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½†æ˜¯ä½ åœ¨whereä¸­é€‰æ‹©çš„ç±»å‹æ˜¯å…¶å®ƒç±»å‹ï¼Œå°±ä¼šå¯¼è‡´ç´¢å¼•æ— æ³•é€‚é…ï¼Œå¯¼è‡´å®ƒè®¤ä¸ºä½ æ‰¾çš„ä¸æ˜¯è¿™ä¸ªç´¢å¼•ï¼Œå°±ä¸ä¼šèµ°ç´¢å¼•äº†ã€‚</p><h5 id="likeå·¦è¾¹åŒ…å«"><a href="#likeå·¦è¾¹åŒ…å«" class="headerlink" title="likeå·¦è¾¹åŒ…å«%"></a>likeå·¦è¾¹åŒ…å«%</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">where</span> code <span class="keyword">like</span> <span class="string">&#x27;%1%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç´¢å¼•å°±ä¼šå¤±æ•ˆï¼ŒæŸ¥è¯¢èŒƒå›´å¤ªå¤§ï¼Œæ— æ•ˆã€‚</p><p>å…¶å®å¾ˆå¥½ç†è§£ï¼Œç´¢å¼•å°±åƒå­—å…¸ä¸­çš„ç›®å½•ã€‚ä¸€èˆ¬ç›®å½•æ˜¯æŒ‰å­—æ¯æˆ–è€…æ‹¼éŸ³ä»å°åˆ°å¤§ï¼Œä»å·¦åˆ°å³æ’åºï¼Œæ˜¯æœ‰é¡ºåºçš„ã€‚</p><p>æˆ‘ä»¬åœ¨æŸ¥ç›®å½•æ—¶ï¼Œé€šå¸¸ä¼šå…ˆä»å·¦è¾¹ç¬¬ä¸€ä¸ªå­—æ¯è¿›è¡ŒåŒ¹å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œå†åŒ¹å¯¹å·¦è¾¹ç¬¬äºŒä¸ªå­—æ¯ï¼Œå¦‚æœå†ç›¸åŒåŒ¹å¯¹å…¶ä»–çš„å­—æ¯ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬èƒ½å¿«é€Ÿé”å®šä¸€ä¸ªå…·ä½“çš„ç›®å½•ï¼Œæˆ–è€…ç¼©å°ç›®å½•çš„èŒƒå›´ã€‚</p><h5 id="åˆ—å¯¹æ¯”"><a href="#åˆ—å¯¹æ¯”" class="headerlink" title="åˆ—å¯¹æ¯”"></a>åˆ—å¯¹æ¯”</h5><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007667.png" alt="image-20240924223117186"></p><h5 id="ä½¿ç”¨ORå…³é”®è¯"><a href="#ä½¿ç”¨ORå…³é”®è¯" class="headerlink" title="ä½¿ç”¨ORå…³é”®è¯"></a>ä½¿ç”¨ORå…³é”®è¯</h5><p>ORä¸­å¦‚æœå­˜åœ¨ä¸€ä¸ªä¸åœ¨ç´¢å¼•å†…çš„å­—æ®µï¼Œéƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain SELECT del_flag FROM `mysql_table` WHERE NAME = &#x27;Siu Tin Wing&#x27; or  age = 1;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå­—æ®µéƒ½å»ºç«‹äº†ç´¢å¼•ï¼Œä½†æ˜¯æœ€åå´æ²¡æœ‰èµ°ç´¢å¼•ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007267.png" alt="image-20241014195345355"></p><p>å¦‚æœ <code>NAME</code> å­—æ®µçš„å”¯ä¸€æ€§è¾ƒå·®ï¼ˆå³é‡å¤å€¼è¾ƒå¤šï¼‰ï¼Œæˆ–è€… <code>age</code> å­—æ®µæœ‰å¤§é‡ç›¸åŒå€¼ï¼ŒMySQL ä¼˜åŒ–å™¨å¯èƒ½ä¼šåˆ¤æ–­ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡ä¸é«˜ã€‚</p><h5 id="not-inå’Œnot-exists"><a href="#not-inå’Œnot-exists" class="headerlink" title="not inå’Œnot exists"></a>not inå’Œnot exists</h5><p>æ™®é€šç´¢å¼•å­—æ®µèµ°not inä¼šå¤±æ•ˆï¼Œä½†æ˜¯ä¸»é”®ç´¢å¼•èµ°not inä¾æ—§æœ‰æ•ˆ</p><p>åŒæ ·ä½¿ç”¨not existsç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆ</p><h5 id="ä½¿ç”¨-ORDER-BY-æˆ–-GROUP-BY-æ—¶çš„ç´¢å¼•å¤±æ•ˆ"><a href="#ä½¿ç”¨-ORDER-BY-æˆ–-GROUP-BY-æ—¶çš„ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ä½¿ç”¨ ORDER BY  æˆ– GROUP BY æ—¶çš„ç´¢å¼•å¤±æ•ˆ"></a>ä½¿ç”¨ <code>ORDER BY</code>  æˆ– GROUP BY æ—¶çš„ç´¢å¼•å¤±æ•ˆ</h5><p><code>ORDER BY</code> å¯¹ç´¢å¼•çš„è¦æ±‚æ¯”è¾ƒä¸¥æ ¼ï¼Œå¦‚æœ <code>ORDER BY</code> å­—æ®µä¸æ˜¯ç´¢å¼•çš„æœ€å·¦å‰ç¼€æˆ–åŒ…å«äº†éç´¢å¼•å­—æ®µï¼Œç´¢å¼•ä¼šå¤±æ•ˆã€‚</p><ul><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¤åˆ¶ä»£ç SELECT * FROM users WHERE id = 1 ORDER BY name; -- ç´¢å¼•ç”Ÿæ•ˆ</span><br><span class="line">SELECT * FROM users ORDER BY name; -- ç´¢å¼•å¤±æ•ˆ</span><br></pre></td></tr></table></figure></li><li><p><strong>åŸå› </strong>ï¼š<code>ORDER BY</code> å­—æ®µå¿…é¡»ä¸ <code>WHERE</code> ä¸­ä½¿ç”¨çš„ç´¢å¼•å­—æ®µä¸€è‡´ï¼ŒMySQLæ‰èƒ½é«˜æ•ˆä½¿ç”¨ç´¢å¼•ï¼Œå¦åˆ™ä¼šè¿›è¡Œæ–‡ä»¶æ’åºï¼ˆfile sortï¼‰ã€‚</p></li><li><p><strong>è§£å†³æ–¹æ³•</strong>ï¼šå°½é‡ä¿è¯ <code>ORDER BY</code> ä¸­çš„å­—æ®µä¸ <code>WHERE</code> ä¸­çš„ç´¢å¼•å­—æ®µåŒ¹é…ï¼Œæˆ–è€…åœ¨ <code>ORDER BY</code> å­—æ®µä¸Šåˆ›å»ºç‹¬ç«‹çš„ç´¢å¼•ã€‚</p></li></ul><p>ä¸ <code>ORDER BY</code> ç±»ä¼¼ï¼Œ<code>GROUP BY</code> ä¹Ÿè¦æ±‚ç´¢å¼•å­—æ®µç¬¦åˆæœ€å·¦å‰ç¼€åŒ¹é…è§„åˆ™ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p><h4 id="æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•"><a href="#æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•" class="headerlink" title="æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•"></a>æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•</h4><p>24å¹´9æœˆ25æ—¥ä¸Šåˆé¢è¯•ï¼Œåˆé—®äº†ç´¢å¼•ï¼Œä½†æ˜¯æ²¡æœ‰é—®ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼Œè€Œæ˜¯é—®äº†å¦‚ä½•æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ã€‚å¾ˆä¸å¹¸ï¼Œæ˜¨å¤©åˆšåˆšçœ‹äº†å¯¹explainæœ‰ç‚¹å½±å“ï¼Œä½†æ˜¯ä¸ç¡®å®šï¼Œæ²¡æ‰“å‡ºæ¥ã€‚</p><p>ç­”æ¡ˆå°±æ˜¯ä½¿ç”¨EXPLAINå…³é”®å­—ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> A, B, C <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> B<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> A<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><h4 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h4><p>é¢è¯•å·²ç»ä¸æ­¢ä¸€æ¬¡é—®è¿‡äº†ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡çš„é—®é¢˜éƒ½åƒå¥‡ç™¾æ€ªï¼Œå®åœ¨ä¸èƒ½å¿äº†ã€‚ç°åœ¨è¿™é‡Œç»“åˆä¸€ä¸ªå®æˆ˜æ¥çœ‹çœ‹è¿™ä¸ªç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ€ä¹ˆä¼šå‡ºç°é—®é¢˜ï¼Œä»¥åŠæœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªè¡¨ï¼Œå­—æ®µæœ‰idï¼Œnameï¼Œphoneï¼Œdel_flagï¼Œageï¼Œurlï¼Œå…¶ä¸­æœ‰10ä¸‡æ¡æ•°æ®ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å…ˆä¸å»ºç«‹ç´¢å¼•ï¼Œæ¥æ‰§è¡Œä¸€ä¸‹è¿™æ¡å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain SELECT * FROM `mysql_table` WHERE age = 10;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007749.png" alt="image-20241014190806851"></p><p>å…¶ä¸­çœ‹åˆ°typeå­—æ®µæ˜¾ç¤ºè¯¥SQLèµ°çš„æ˜¯å…¨å±€æŸ¥æ‰¾ï¼Œæ²¡æœ‰èµ°ç´¢å¼•ã€‚<strong>æ•°æ®åº“ä¸­çš„B+Treeç´¢å¼•å¯ä»¥åˆ†ä¸ºèšé›†ç´¢å¼•ï¼ˆclustered indexï¼‰å’Œè¾…åŠ©ç´¢å¼•ï¼ˆsecondary indexï¼‰</strong>ã€‚</p><h3 id="æ…¢SQL"><a href="#æ…¢SQL" class="headerlink" title="æ…¢SQL"></a>æ…¢SQL</h3><h4 id="æ…¢SQLå®šä½"><a href="#æ…¢SQLå®šä½" class="headerlink" title="æ…¢SQLå®šä½"></a>æ…¢SQLå®šä½</h4><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/laodanqiu/article/details/131423834">ã€MySQLé«˜çº§ã€‘MySQLæ‰¾å‡ºæ‰§è¡Œæ…¢çš„SQLã€æ…¢æŸ¥è¯¢æ—¥å¿—ä½¿ç”¨ä¸åˆ†æã€‘</a></p><p>åœ¨ä¼—å¤šçš„å¯¹æ•°æ®åº“æŸ¥è¯¢çš„è¯­å¥ä¸­æˆ‘ä»¬å¾—å…ˆè¦çŸ¥é“æˆ‘ä»¬çš„æ•Œäººæ˜¯è°æŠŠï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä½åˆ°å“ªäº›SQLå¯¹äºæˆ‘ä»¬æ¥è¯´æ˜¯æ…¢çš„ã€‚æ…¢SQLæ²¡æœ‰ç»å¯¹åªæœ‰ç›¸å¯¹ï¼Œæˆ‘ä»¬ç§°æŸäº›SQLæ‰§è¡Œçš„æ—¶é—´è¶…è¿‡äº†æˆ‘ä»¬è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œæˆ‘ä»¬å°±ç§°è¯¥SQLä¸ºæ…¢SQLã€‚é‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å®šä½åˆ°æ…¢SQLå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯æ—¥å¿—ã€‚</p><p>æˆ‘ä»¬éœ€è¦æ‰“å¼€æ•°æ®åº“çš„æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒMySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯MySQLæä¾›çš„ä¸€ç§æ—¥å¿—è®°å½•ï¼Œå®ƒç”¨æ¥è®°å½•åœ¨MySQLä¸­å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼çš„è¯­å¥ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡long_query_timeå€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p><ul><li>long_query_timeçš„é»˜è®¤å€¼ä¸º10ï¼Œæ„æ€æ˜¯è¿è¡Œ10ç§’ä»¥ä¸Šçš„è¯­å¥</li><li>ç”±æ…¢æŸ¥è¯¢æ—¥å¿—æ¥æŸ¥çœ‹å“ªäº›SQLè¶…å‡ºäº†æˆ‘ä»¬çš„æœ€å¤§å¿è€æ—¶é—´å€¼ï¼Œæ¯”å¦‚ä¸€æ¡SQLæ‰§è¡Œè¶…è¿‡5ç§’é’Ÿï¼Œæˆ‘ä»¬å°±ç®—æ…¢SQLï¼Œå¸Œæœ›èƒ½æ”¶é›†è¶…è¿‡5ç§’é’Ÿçš„SQLï¼Œç»“åˆä¹‹å‰explainè¿›è¡Œå…¨é¢åˆ†æ</li></ul><h4 id="æ…¢SQLä¼˜åŒ–"><a href="#æ…¢SQLä¼˜åŒ–" class="headerlink" title="æ…¢SQLä¼˜åŒ–"></a>æ…¢SQLä¼˜åŒ–</h4><p>é’ˆå¯¹æ…¢æŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œä¼˜åŒ–ï¼š</p><ul><li><strong>SQLè¯­å¥ä¼˜åŒ–ï¼šæ£€æŸ¥SQLè¯­å¥æ˜¯å¦å¯ä»¥é€šè¿‡ä¿®æ”¹æŸ¥è¯¢æ¡ä»¶ã€è¿æ¥é¡ºåºã€å­æŸ¥è¯¢ç­‰æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚</strong></li><li><strong>ç´¢å¼•ä¼˜åŒ–ï¼šç¡®ä¿æŸ¥è¯¢ä¸­æ¶‰åŠçš„å­—æ®µéƒ½å·²ç»è¢«æ­£ç¡®ç´¢å¼•ï¼Œå¹¶è€ƒè™‘ä½¿ç”¨å¤åˆç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ç­‰é«˜çº§ç´¢å¼•ç‰¹æ€§ã€‚</strong></li><li><strong>è¡¨ç»“æ„ä¼˜åŒ–ï¼šè€ƒè™‘æ˜¯å¦å¯ä»¥é€šè¿‡æ‹†åˆ†è¡¨ã€åˆå¹¶è¡¨ã€ä¿®æ”¹æ•°æ®ç±»å‹ç­‰æ–¹å¼ä¼˜åŒ–è¡¨ç»“æ„ã€‚</strong></li><li>æŸ¥è¯¢ç¼“å­˜ï¼šåˆ©ç”¨MySQLçš„æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½ï¼Œç¼“å­˜ç»å¸¸æ‰§è¡Œçš„æŸ¥è¯¢ç»“æœï¼Œå‡å°‘æ•°æ®åº“è®¿é—®æ¬¡æ•°ã€‚</li><li>ç¡¬ä»¶å’Œé…ç½®ä¼˜åŒ–ï¼šè€ƒè™‘å¢åŠ å†…å­˜ã€ä½¿ç”¨æ›´å¿«çš„ç£ç›˜ã€è°ƒæ•´MySQLé…ç½®å‚æ•°ç­‰æ–¹å¼æé«˜æ•°æ®åº“æ€§èƒ½ã€‚</li></ul><p>ä¸€èˆ¬æ¥è¯´é—®é¢˜éƒ½ä¼šé›†ä¸­åœ¨ç¬¬ä¸€åˆ°ç¬¬ä¸‰æ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹å¯¹å‰é¢ä¸‰æ¡é—®é¢˜è¿›è¡Œåˆ†æå’Œè§£å†³ã€‚</p><h5 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h5><p>æˆ‘ä»¬é¦–å…ˆä»ä¸šåŠ¡ä¾§æ¥åˆ†æä¸€ä¸‹ï¼Œä¸šåŠ¡ä¾§ä¹¦å†™çš„SQLæ˜¯å¦å­˜åœ¨ä¸€å®šçš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¼˜è´¨çš„SQLï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007842.png" alt="image-20241008105111414"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262007392.png" alt="image-20241008105134406"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262010284.png" alt="image-20241008105155886"></p><h4 id="ä¼˜åŒ–æ­¥éª¤"><a href="#ä¼˜åŒ–æ­¥éª¤" class="headerlink" title="ä¼˜åŒ–æ­¥éª¤"></a>ä¼˜åŒ–æ­¥éª¤</h4><h5 id="1-åˆ†ææŸ¥è¯¢ï¼šEXPLAIN-è¯Šæ–­æŸ¥è¯¢è®¡åˆ’"><a href="#1-åˆ†ææŸ¥è¯¢ï¼šEXPLAIN-è¯Šæ–­æŸ¥è¯¢è®¡åˆ’" class="headerlink" title="1. åˆ†ææŸ¥è¯¢ï¼šEXPLAIN è¯Šæ–­æŸ¥è¯¢è®¡åˆ’"></a>1. <strong>åˆ†ææŸ¥è¯¢ï¼šEXPLAIN è¯Šæ–­æŸ¥è¯¢è®¡åˆ’</strong></h5><p>é¦–å…ˆï¼Œä½¿ç”¨ <code>EXPLAIN</code> æŸ¥çœ‹æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼Œäº†è§£ MySQL ä¼˜åŒ–å™¨å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢ï¼š</p><p><strong>type: range</strong>ï¼šæŸ¥è¯¢æ ¹æ® <code>order_date</code> å’Œ <code>status</code> æ‰«æèŒƒå›´ã€‚</p><p><strong>key: user_id</strong>ï¼šä½¿ç”¨äº† <code>user_id</code> çš„ç´¢å¼•ã€‚</p><p><strong>rows: 100,000</strong>ï¼šæ‰«æå¤§é‡æ•°æ®ï¼Œå¯èƒ½éœ€è¦ä¼˜åŒ–ã€‚</p><h5 id="2-ä¼˜åŒ–ç´¢å¼•ï¼šç»„åˆç´¢å¼•"><a href="#2-ä¼˜åŒ–ç´¢å¼•ï¼šç»„åˆç´¢å¼•" class="headerlink" title="2.ä¼˜åŒ–ç´¢å¼•ï¼šç»„åˆç´¢å¼•"></a>2.<strong>ä¼˜åŒ–ç´¢å¼•ï¼šç»„åˆç´¢å¼•</strong></h5><p>å½“å‰æŸ¥è¯¢ä¸­ï¼Œ<code>user_id</code>ã€<code>status</code> å’Œ <code>order_date</code> æ˜¯è¿‡æ»¤æ¡ä»¶ï¼Œä½†è¿™äº›æ¡ä»¶ä½¿ç”¨äº†å¤šä¸ªç‹¬ç«‹çš„ç´¢å¼•ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºè¿™äº›å­—æ®µåˆ›å»ºä¸€ä¸ª<strong>ç»„åˆç´¢å¼•</strong>æ¥åŠ é€ŸæŸ¥è¯¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line">CREATE INDEX idx_user_status_date ON orders (user_id, status, order_date);</span><br></pre></td></tr></table></figure><p>ç»„åˆç´¢å¼•å¯ä»¥è®© MySQL ä¸€æ¬¡æ€§è¿‡æ»¤æ‰å¤§éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯åˆ†åˆ«åˆ©ç”¨å¤šä¸ªç´¢å¼•ã€‚</p><h5 id="3-è¦†ç›–ç´¢å¼•"><a href="#3-è¦†ç›–ç´¢å¼•" class="headerlink" title="3.è¦†ç›–ç´¢å¼•"></a><strong>3.è¦†ç›–ç´¢å¼•</strong></h5><p>å¦‚æœåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨çš„æ‰€æœ‰å­—æ®µéƒ½èƒ½é€šè¿‡ç´¢å¼•è·å–ï¼Œé‚£ä¹ˆ MySQL å¯ä»¥ç›´æ¥ä»ç´¢å¼•ä¸­è¿”å›æ•°æ®ï¼Œæ— éœ€è®¿é—®æ•°æ®è¡Œã€‚è¿™å°±æ˜¯<strong>è¦†ç›–ç´¢å¼•</strong>çš„æ¦‚å¿µã€‚</p><h5 id="4-WHERE-æ¡ä»¶ä¼˜åŒ–"><a href="#4-WHERE-æ¡ä»¶ä¼˜åŒ–" class="headerlink" title="4.WHERE æ¡ä»¶ä¼˜åŒ–"></a><strong>4.WHERE æ¡ä»¶ä¼˜åŒ–</strong></h5><ul><li><strong>èŒƒå›´æŸ¥è¯¢ (<code>BETWEEN</code>)</strong>ï¼šMySQLåœ¨å¤„ç†<code>BETWEEN</code>æˆ–å…¶ä»–èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œä¼šé™åˆ¶ç´¢å¼•çš„æœ‰æ•ˆæ€§ã€‚ç¡®ä¿èŒƒå›´æŸ¥è¯¢å­—æ®µåœ¨ç´¢å¼•çš„æœ€åä¸€åˆ—ï¼Œé¿å…å½±å“å…¶ä»–æ¡ä»¶çš„ç´¢å¼•ä½¿ç”¨é¡ºåºã€‚</li><li><strong>é¿å…å‡½æ•°æ“ä½œ</strong>ï¼šä¸è¦å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°æˆ–è¡¨è¾¾å¼ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ä¾‹å¦‚ï¼š</li></ul><h5 id="5-ORDER-BY-ä¼˜åŒ–"><a href="#5-ORDER-BY-ä¼˜åŒ–" class="headerlink" title="5.ORDER BY ä¼˜åŒ–"></a><strong>5.ORDER BY ä¼˜åŒ–</strong></h5><ul><li><strong>ç´¢å¼•æ”¯æŒæ’åº</strong>ï¼šæŸ¥è¯¢ä¸­çš„ <code>ORDER BY total_price DESC</code> éœ€è¦ç¡®ä¿åœ¨ç´¢å¼•çš„æœ€åä¸€åˆ—æ˜¯æ’åºåˆ—ã€‚å¦‚æœæŸ¥è¯¢çš„ <code>WHERE</code> æ¡ä»¶å’Œ <code>ORDER BY</code> å¯ä»¥åŒæ—¶ç”±åŒä¸€ä¸ªç´¢å¼•æ”¯æŒï¼ŒMySQL å¯ä»¥é¿å…é¢å¤–çš„æ’åºæ“ä½œã€‚</li></ul><h5 id="6-LIMIT-ä¼˜åŒ–"><a href="#6-LIMIT-ä¼˜åŒ–" class="headerlink" title="6.LIMIT ä¼˜åŒ–"></a><strong>6.LIMIT ä¼˜åŒ–</strong></h5><p>åœ¨æŸ¥è¯¢è¿”å›å¤§æ•°æ®é‡æ—¶ï¼Œ<code>LIMIT</code> æ˜¯éå¸¸æœ‰ç”¨çš„ä¼˜åŒ–æ‰‹æ®µã€‚å‡è®¾ä½ åªéœ€è¦æŸ¥çœ‹å‰ 100 æ¡è®°å½•ï¼Œå¯ä»¥æ·»åŠ  <code>LIMIT</code> æ¥å‡å°‘ MySQL è¿”å›çš„è¡Œæ•°ï¼š</p><h5 id="7-å‡å°‘-SELECT-çš„ä½¿ç”¨"><a href="#7-å‡å°‘-SELECT-çš„ä½¿ç”¨" class="headerlink" title="7.å‡å°‘ SELECT * çš„ä½¿ç”¨"></a><strong>7.å‡å°‘ SELECT * çš„ä½¿ç”¨</strong></h5><p>é¿å…ä½¿ç”¨ <code>SELECT *</code>ï¼Œåªé€‰æ‹©æŸ¥è¯¢éœ€è¦çš„å­—æ®µã€‚è¿™ä¸ä»…å‡å°‘äº†ç½‘ç»œä¼ è¾“é‡ï¼Œä¹Ÿä½¿å¾— MySQL å¯ä»¥æ›´å¿«å¤„ç†æŸ¥è¯¢ã€‚åœ¨æ­¤æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»…æŸ¥è¯¢ <code>order_id</code>ã€<code>user_id</code>ã€<code>total_price</code> å’Œ <code>order_date</code>ï¼Œè€Œä¸æ˜¯è¿”å›æ‰€æœ‰åˆ—ã€‚</p><h3 id="MySQLæ‰§è¡Œé¡ºåº"><a href="#MySQLæ‰§è¡Œé¡ºåº" class="headerlink" title="MySQLæ‰§è¡Œé¡ºåº"></a>MySQLæ‰§è¡Œé¡ºåº</h3><ol><li><strong>FROM</strong>ï¼šé¦–å…ˆç¡®å®šè¦æŸ¥è¯¢çš„è¡¨æˆ–è§†å›¾ï¼Œå¹¶ä»è¿™äº›è¡¨ä¸­è¯»å–æ•°æ®ã€‚å¦‚æœæœ‰ <code>JOIN</code>ï¼Œè¿™ä¸ªé˜¶æ®µä¹Ÿä¼šå¤„ç†è¡¨è¿æ¥ã€‚</li><li><strong>ON</strong>ï¼šå¦‚æœå­˜åœ¨è¿æ¥æ¡ä»¶ï¼Œåœ¨ <code>JOIN</code> çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆåŸºäº <code>ON</code> æ¡ä»¶è¿›è¡Œè¡¨ä¹‹é—´çš„è¿æ¥æ“ä½œã€‚</li><li><strong>JOIN</strong>ï¼šæ ¹æ®è¡¨çš„è¿æ¥ç±»å‹ï¼ˆå¦‚ INNER JOINã€LEFT JOINï¼‰è¿›è¡Œæ•°æ®çš„è¿æ¥ã€‚</li><li><strong>WHERE</strong>ï¼šå¯¹å·²ç»è¿æ¥çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œåªä¿ç•™æ»¡è¶³ <code>WHERE</code> æ¡ä»¶çš„è®°å½•ã€‚</li><li><strong>GROUP BY</strong>ï¼šå¯¹ <code>WHERE</code> è¿‡æ»¤åçš„æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚</li><li><strong>HAVING</strong>ï¼šå¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œè¿‡æ»¤ï¼Œç±»ä¼¼äº <code>WHERE</code>ï¼Œä½†å®ƒä½œç”¨äºåˆ†ç»„åçš„ç»“æœã€‚</li><li><strong>SELECT</strong>ï¼šç¡®å®šè¦è¿”å›çš„åˆ—å’Œè®¡ç®—çš„è¡¨è¾¾å¼ã€‚æ‰§è¡Œæ—¶æ­¤æ­¥éª¤ä¹Ÿä¼šå¯¹åˆ—è¿›è¡ŒæŠ•å½±ã€‚</li><li><strong>DISTINCT</strong>ï¼šåœ¨ <code>SELECT</code> çš„åŸºç¡€ä¸Šè¿›è¡Œå»é‡æ“ä½œã€‚</li><li><strong>ORDER BY</strong>ï¼šå¯¹æœ€ç»ˆçš„ç»“æœé›†è¿›è¡Œæ’åºã€‚</li><li><strong>LIMIT &#x2F; OFFSET</strong>ï¼šé™åˆ¶è¿”å›çš„è¡Œæ•°æˆ–ä»ç‰¹å®šè¡Œå¼€å§‹è¿”å›æ•°æ®ã€‚</li></ol><h3 id="ä¸ºä»€ä¹ˆè¯´MySQLè¡Œæ•°è¶…è¿‡äº†2000Wè¡Œåæ•ˆç‡å°±ä¸å¥½äº†å‘¢"><a href="#ä¸ºä»€ä¹ˆè¯´MySQLè¡Œæ•°è¶…è¿‡äº†2000Wè¡Œåæ•ˆç‡å°±ä¸å¥½äº†å‘¢" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´MySQLè¡Œæ•°è¶…è¿‡äº†2000Wè¡Œåæ•ˆç‡å°±ä¸å¥½äº†å‘¢"></a>ä¸ºä»€ä¹ˆè¯´MySQLè¡Œæ•°è¶…è¿‡äº†2000Wè¡Œåæ•ˆç‡å°±ä¸å¥½äº†å‘¢</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262008409.png" alt="image-20241014211833033"></p><h2 id="MySQLé¢è¯•é¢˜"><a href="#MySQLé¢è¯•é¢˜" class="headerlink" title="MySQLé¢è¯•é¢˜"></a>MySQLé¢è¯•é¢˜</h2><h3 id="ç¬¬ä¸€æ¬¡é¢è¯•"><a href="#ç¬¬ä¸€æ¬¡é¢è¯•" class="headerlink" title="ç¬¬ä¸€æ¬¡é¢è¯•"></a>ç¬¬ä¸€æ¬¡é¢è¯•</h3><h4 id="èµ„æ–™æ¥æº"><a href="#èµ„æ–™æ¥æº" class="headerlink" title="èµ„æ–™æ¥æº"></a>èµ„æ–™æ¥æº</h4><ul><li><a href="https://blog.csdn.net/twotwo22222/article/details/129115194?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522DCFAC641-E438-4EE3-ACC8-12BE1118731A%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=DCFAC641-E438-4EE3-ACC8-12BE1118731A&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-129115194-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=MySQL%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187">MySQLå¸¸è§é¢è¯•é¢˜(2024å¹´æœ€æ–°)</a></li></ul><h4 id="Promote"><a href="#Promote" class="headerlink" title="Promote"></a>Promote</h4><blockquote><p>ç°åœ¨å‡è®¾ä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„Javaåç«¯é¢è¯•å®˜ï¼Œç°åœ¨è¯·é—®æˆ‘å¯¹äºä¸‹é¢çš„è¿™ä¸ªå›ç­”æ­£ç¡®å—ï¼Ÿè¯·ä½ ç‰¹åˆ«æ³¨æ„é¢˜ç›®æ˜¯ä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘å›ç­”çš„å¯èƒ½å®Œå…¨ä¸å¯¹ï¼è¯·ä½ ä¸ºæˆ‘æ‰“åˆ†ï¼ˆ10åˆ†åˆ¶ï¼‰ï¼Œå¹¶ä¸”ç»™å‡ºè¿™ä¸ªé¢è¯•é¢˜çš„æ­£ç¡®è¡¥å……ã€‚</p></blockquote><h4 id="1-charå’Œvarcharçš„åŒºåˆ«"><a href="#1-charå’Œvarcharçš„åŒºåˆ«" class="headerlink" title="1.charå’Œvarcharçš„åŒºåˆ«"></a><a href="https://blog.csdn.net/twotwo22222/article/details/129115194?ops_request_misc=%7B%22request_id%22:%22DCFAC641-E438-4EE3-ACC8-12BE1118731A%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=DCFAC641-E438-4EE3-ACC8-12BE1118731A&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-129115194-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=MySQL%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187#1charvarchar_3">1.charå’Œvarcharçš„åŒºåˆ«</a></h4><blockquote><p>æˆ‘ï¼š</p><p>charåœ¨MySQLæ•°æ®ä¸­è¡¨ç¤ºå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå³åªèƒ½ä¿å­˜æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæ²¡æœ‰è¾¾åˆ°æŒ‡å®šé•¿åº¦ï¼Œä¼šè¿›è¡Œè‡ªåŠ¨å¡«å……ï¼Œå¦‚æœè¶…è¿‡ä¼šè‡ªåŠ¨æˆªæ–­è¶…è¿‡éƒ¨åˆ†ï¼›</p><p>varcharè¡¨ç¤ºä¸å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯varcharä¼šè®¾å®šä¸€ä¸ªæœ€å¤§é•¿åº¦ï¼Œæ•°æ®åº“ä¸­ä¿å­˜çš„æœ€é•¿å­—ç¬¦ä¸²ä¸èƒ½è¶…è¿‡è¿™ä¸ªæœ€å¤§é•¿åº¦ï¼Œå¦‚æœè¶…è¿‡ä¼šè‡ªåŠ¨æˆªæ–­è¶…è¿‡éƒ¨åˆ†çš„å­—ç¬¦ã€‚</p></blockquote><blockquote><p>è¡¥å……ï¼š</p><p>æ•´ä½“ä¸Šæ­£ç¡®ã€‚</p><p><strong>å­˜å‚¨æ–¹å¼</strong>ï¼š</p><ul><li><strong><code>CHAR</code></strong>ï¼š<code>CHAR</code> æ˜¯å®šé•¿å­—ç¬¦ä¸²ï¼ŒMySQL ä¼šè‡ªåŠ¨å°†å­˜å‚¨çš„æ•°æ®å¡«å……åˆ°æŒ‡å®šé•¿åº¦ï¼Œæ¯”å¦‚ä½ å®šä¹‰ <code>CHAR(10)</code>ï¼Œæ— è®ºä½ å­˜å‚¨çš„æ˜¯ <code>5</code> ä¸ªå­—ç¬¦è¿˜æ˜¯ <code>8</code> ä¸ªå­—ç¬¦ï¼ŒMySQL éƒ½ä¼šå¡«å……ç©ºæ ¼ï¼Œä½¿å…¶æ€»é•¿åº¦è¾¾åˆ° <code>10</code>ã€‚è¿™äº›ç©ºæ ¼åœ¨æ£€ç´¢æ•°æ®æ—¶ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</li><li><strong><code>VARCHAR</code></strong>ï¼š<code>VARCHAR</code> æ˜¯å˜é•¿å­—ç¬¦ä¸²ï¼Œå­˜å‚¨çš„æ•°æ®é•¿åº¦æ˜¯å®é™…çš„å­—ç¬¦æ•°åŠ ä¸Šç”¨äºè®°å½•é•¿åº¦çš„é¢å¤–å­—èŠ‚æ•°ã€‚å¯¹äº <code>VARCHAR</code>ï¼ŒMySQL ä¸ä¼šè¿›è¡Œå¡«å……ï¼Œå› æ­¤æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´è¾ƒä¸ºç´§å‡‘ã€‚</li></ul><p><strong>ç©ºé—´æ•ˆç‡</strong>ï¼š</p><ul><li><strong><code>CHAR</code></strong>ï¼šç”±äºæ˜¯å®šé•¿ï¼Œå³ä½¿å­˜å‚¨çš„æ•°æ®è¾ƒçŸ­ï¼Œä¾ç„¶ä¼šå ç”¨å®Œæ•´çš„å®šä¹‰ç©ºé—´ã€‚å› æ­¤ï¼Œå¯¹äºè¾ƒçŸ­çš„å­—ç¬¦ä¸²æˆ–é•¿åº¦å›ºå®šçš„æ•°æ®ä½¿ç”¨ <code>CHAR</code> å¯èƒ½ä¼šæµªè´¹ç©ºé—´ã€‚</li><li><strong><code>VARCHAR</code></strong>ï¼š<code>VARCHAR</code> æ˜¯å˜é•¿çš„ï¼Œå®ƒä»…æ ¹æ®å®é™…å­˜å‚¨çš„æ•°æ®åˆ†é…ç©ºé—´ï¼Œæ›´åŠ èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</li></ul><p><strong>æ€§èƒ½</strong>ï¼š</p><ul><li><strong><code>CHAR</code></strong>ï¼šç”±äºæ˜¯å›ºå®šé•¿åº¦ï¼Œæ•°æ®çš„æ£€ç´¢å’Œæ¯”è¾ƒé€Ÿåº¦ä¼šæ¯” <code>VARCHAR</code> ç¨å¿«ä¸€äº›ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç»å¸¸å˜åŒ–çš„çŸ­æ•°æ®ï¼Œæ¯”å¦‚çŠ¶æ€ç ã€å›ºå®šé•¿åº¦çš„æ ‡è¯†ç¬¦ç­‰ï¼Œ<code>CHAR</code> çš„è¡¨ç°ä¼šæ›´å¥½ã€‚</li><li><strong><code>VARCHAR</code></strong>ï¼šå› ä¸ºæ˜¯å˜é•¿å­—ç¬¦ä¸²ï¼Œæ¯æ¬¡å¤„ç†æ•°æ®æ—¶ï¼ŒMySQL éœ€è¦è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¿™å¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚å¯¹äºè¾ƒé•¿çš„æ–‡æœ¬ï¼Œ<code>VARCHAR</code> æ›´çµæ´»ï¼Œä½†åœ¨æ€§èƒ½ä¸Šå¯èƒ½ä¸å¦‚ <code>CHAR</code>ã€‚</li></ul><p><strong>æœ€å¤§é•¿åº¦é™åˆ¶</strong>ï¼š</p><ul><li><strong><code>CHAR</code></strong>ï¼šæœ€å¤§é•¿åº¦ä¸º 255 å­—èŠ‚ã€‚</li><li><strong><code>VARCHAR</code></strong>ï¼šæ ¹æ®å­—ç¬¦é›†çš„ä¸åŒï¼Œ<code>VARCHAR</code> æœ€å¤šå¯ä»¥å­˜å‚¨ 65,535 å­—èŠ‚çš„æ•°æ®ã€‚ä¸è¿‡ï¼Œæœ€å¤§é•¿åº¦è¿˜å—é™äºè¡Œçš„æœ€å¤§é•¿åº¦ï¼ˆ65535 å­—èŠ‚ï¼‰ï¼Œå¹¶ä¸” <code>VARCHAR</code> è¿˜ä¼šå ç”¨ 1 æˆ– 2 å­—èŠ‚æ¥å­˜å‚¨å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</li></ul></blockquote><h4 id="2-æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"><a href="#2-æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼" class="headerlink" title="2.æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"></a><a href="https://blog.csdn.net/twotwo22222/article/details/129115194?ops_request_misc=%7B%22request_id%22:%22DCFAC641-E438-4EE3-ACC8-12BE1118731A%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=DCFAC641-E438-4EE3-ACC8-12BE1118731A&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-129115194-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=MySQL%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187#2_8">2.æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼</a></h4><blockquote><p>åˆ†åˆ«ä¸ºç¬¬ä¸€èŒƒå¼ã€ç¬¬äºŒèŒƒå¼å’Œç¬¬ä¸‰èŒƒå¼ï¼›</p><p>ç¬¬ä¸€èŒƒå¼æŒ‡çš„æ˜¯è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯å†åˆ†çš„ï¼›</p><p>ç¬¬äºŒèŒƒå¼æŒ‡çš„æ˜¯åœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šæ¶ˆé™¤äº†éä¸»å±æ€§å¯¹ç çš„éƒ¨åˆ†ä¾èµ–ï¼›</p><p>ç¬¬ä¸‰èŒƒå¼åœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šæ¶ˆé™¤äº†éä¸»å±æ€§å¯¹ç çš„ä¼ é€’å‡½æ•°ä¾èµ–ï¼›</p></blockquote><blockquote><h3 id="è¯„åˆ†ï¼š7-10"><a href="#è¯„åˆ†ï¼š7-10" class="headerlink" title="è¯„åˆ†ï¼š7&#x2F;10"></a>è¯„åˆ†ï¼š7&#x2F;10</h3><h3 id="éœ€è¦è¡¥å……çš„å†…å®¹ï¼š"><a href="#éœ€è¦è¡¥å……çš„å†…å®¹ï¼š" class="headerlink" title="éœ€è¦è¡¥å……çš„å†…å®¹ï¼š"></a>éœ€è¦è¡¥å……çš„å†…å®¹ï¼š</h3><ol><li><strong>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰</strong>ï¼š<ul><li>ä½ æåˆ°â€œæ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯å†åˆ†çš„â€ï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼Œä½†å¯ä»¥æ›´è¯¦ç»†è¯´æ˜ã€‚ä¾‹å¦‚ï¼Œè¡¨ä¸­æ¯ä¸ªå­—æ®µåº”åŒ…å«åŸå­å€¼ï¼ˆä¸å¯åˆ†å‰²çš„æœ€å°å•ä½ï¼‰ï¼Œç¡®ä¿æ²¡æœ‰é‡å¤ç»„æˆ–å¤šå€¼åˆ—ã€‚</li><li>ç¤ºä¾‹ï¼šä¸€ä¸ªç”µè¯å­—æ®µä¸èƒ½åŒæ—¶åŒ…å«å¤šä¸ªç”µè¯å·ç ã€‚</li></ul></li><li><strong>ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰</strong>ï¼š<ul><li>ä½ æåˆ°çš„â€œæ¶ˆé™¤éä¸»å±æ€§å¯¹ç çš„éƒ¨åˆ†ä¾èµ–â€æ˜¯å‡†ç¡®çš„ï¼Œä½†å¯ä»¥è§£é‡Šâ€œç â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå¹¶å…·ä½“è¯´æ˜â€œéƒ¨åˆ†ä¾èµ–â€ã€‚</li><li>è¿›ä¸€æ­¥è§£é‡Šï¼šå¦‚æœä¸€ä¸ªè¡¨æœ‰å¤åˆä¸»é”®ï¼Œé‚£ä¹ˆæ‰€æœ‰éä¸»å±æ€§å¿…é¡»å®Œå…¨ä¾èµ–äºæ•´ä¸ªä¸»é”®ï¼Œè€Œä¸èƒ½ä»…ä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚</li><li>ç¤ºä¾‹ï¼šå¦‚æœä¸€ä¸ªå­¦ç”Ÿé€‰è¯¾è¡¨ç”¨â€œå­¦ç”ŸIDâ€å’Œâ€œè¯¾ç¨‹IDâ€ä½œä¸ºå¤åˆä¸»é”®ï¼Œè¯¾ç¨‹åç§°ä¸èƒ½ä»…ä¾èµ–äºâ€œè¯¾ç¨‹IDâ€ï¼Œå¦åˆ™å°±è¿åäº†ç¬¬äºŒèŒƒå¼ã€‚</li></ul></li><li><strong>ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰</strong>ï¼š<ul><li>ä½ æåˆ°çš„â€œæ¶ˆé™¤éä¸»å±æ€§å¯¹ç çš„ä¼ é€’å‡½æ•°ä¾èµ–â€æ˜¯æ­£ç¡®çš„ã€‚å»ºè®®è¡¥å……è¯´æ˜ä¼ é€’ä¾èµ–çš„æ¦‚å¿µï¼Œå³å¦‚æœå±æ€§ A ä¾èµ–äºå±æ€§ Bï¼Œå±æ€§ B åˆä¾èµ–äºä¸»é”®ï¼Œé‚£ä¹ˆ A åº”è¯¥ç›´æ¥ä¾èµ–äºä¸»é”®è€Œéé€šè¿‡ Bã€‚</li><li>ç¤ºä¾‹ï¼šå­¦ç”Ÿè¡¨ä¸­ï¼Œå¦‚æœâ€œç­çº§IDâ€ä¾èµ–äºâ€œå­¦ç”ŸIDâ€ï¼Œè€Œâ€œç­çº§åç§°â€ä¾èµ–äºâ€œç­çº§IDâ€ï¼Œè¿™å°±æ„æˆäº†ä¼ é€’ä¾èµ–ï¼Œåº”å°†ç­çº§ä¿¡æ¯æ‹†åˆ†åˆ°å•ç‹¬çš„è¡¨ä¸­ã€‚</li></ul></li></ol></blockquote><h4 id="3-ä½ äº†è§£sqlçš„æ‰§è¡Œé¡ºåºå—ï¼Ÿ"><a href="#3-ä½ äº†è§£sqlçš„æ‰§è¡Œé¡ºåºå—ï¼Ÿ" class="headerlink" title="3.ä½ äº†è§£sqlçš„æ‰§è¡Œé¡ºåºå—ï¼Ÿ"></a><a href="https://blog.csdn.net/twotwo22222/article/details/129115194?ops_request_misc=%7B%22request_id%22:%22DCFAC641-E438-4EE3-ACC8-12BE1118731A%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=DCFAC641-E438-4EE3-ACC8-12BE1118731A&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-129115194-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=MySQL%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187#3sql_13">3.ä½ äº†è§£sqlçš„æ‰§è¡Œé¡ºåºå—ï¼Ÿ</a></h4><blockquote><p>æ˜¯çš„ï¼Œæ¯”è¾ƒäº†è§£ã€‚</p><p>å°±æ¯”å¦‚ä¸€ä¸ªæŸ¥è¯¢è¯­å¥æ¥è¯´ï¼Œå®ƒä¼šå…ˆæ ¹æ®fromæ¥æ‰¾åˆ°å¯¹åº”çš„è¡¨ï¼Œç„¶åæ ¹æ®whereå¾—åˆ°å¯¹åº”æŸ¥è¯¢åˆ°çš„æ•°æ®ï¼Œå¦‚æœå­˜åœ¨group byï¼Œåˆ™ä¼šæ ¹æ®å…·ä½“çš„å†…å®¹è¿›è¡Œåˆ†ç»„ï¼Œç„¶åå¦‚æœå­˜åœ¨havingï¼Œåˆ™ä¼šæ ¹æ®havingçš„è¦æ±‚å¾—åˆ°åˆ†ç»„ä¹‹åçš„ç»“æœï¼›</p><p>ä¹‹åå°±æ˜¯æ ¹æ®limitæ¥æˆªå–å¾—åˆ°çš„ç»“æœèŒƒå›´ï¼Œç„¶åæ ¹æ®selectæ¥è¿”å›å…¶éœ€è¦æŸ¥è¯¢å¯¹åº”çš„åˆ—çš„å€¼ã€‚</p></blockquote><blockquote><h3 id="è¯„åˆ†ï¼š6-10"><a href="#è¯„åˆ†ï¼š6-10" class="headerlink" title="è¯„åˆ†ï¼š6&#x2F;10"></a>è¯„åˆ†ï¼š6&#x2F;10</h3><h3 id="é—®é¢˜ä¸æ”¹è¿›å»ºè®®ï¼š"><a href="#é—®é¢˜ä¸æ”¹è¿›å»ºè®®ï¼š" class="headerlink" title="é—®é¢˜ä¸æ”¹è¿›å»ºè®®ï¼š"></a>é—®é¢˜ä¸æ”¹è¿›å»ºè®®ï¼š</h3><ol><li><strong>æ‰§è¡Œé¡ºåºä¸å‡†ç¡®</strong>ï¼š<ul><li>ä½ çš„å›ç­”æåˆ°äº†æ‰§è¡Œæ­¥éª¤ä¸­çš„ <code>FROM</code>ã€<code>WHERE</code>ã€<code>GROUP BY</code>ã€<code>HAVING</code>ã€<code>LIMIT</code> å’Œ <code>SELECT</code>ï¼Œä½†å®é™…çš„SQLæ‰§è¡Œé¡ºåºä¸å†™æ³•çš„é¡ºåºæ˜¯ä¸åŒçš„ã€‚</li><li>ä½ æåˆ° <code>LIMIT</code> å‡ºç°åœ¨ <code>HAVING</code> ä¹‹åï¼Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œ<code>LIMIT</code> æ˜¯åœ¨ <code>ORDER BY</code> åæ‰§è¡Œã€‚</li></ul></li><li><strong>æ¼æ‰äº† <code>JOIN</code> å’Œ <code>ORDER BY</code></strong>ï¼š<ul><li>ä½ çš„å›ç­”æ²¡æœ‰æåŠ <code>JOIN</code> å’Œ <code>ORDER BY</code>ï¼Œè¿™äº›æ­¥éª¤åœ¨SQLæŸ¥è¯¢ä¸­ä¹Ÿéå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤æ‚æŸ¥è¯¢ä¸­ã€‚</li></ul></li></ol><h3 id="è¡¥å……æ­£ç¡®çš„SQLæ‰§è¡Œé¡ºåºï¼š"><a href="#è¡¥å……æ­£ç¡®çš„SQLæ‰§è¡Œé¡ºåºï¼š" class="headerlink" title="è¡¥å……æ­£ç¡®çš„SQLæ‰§è¡Œé¡ºåºï¼š"></a>è¡¥å……æ­£ç¡®çš„SQLæ‰§è¡Œé¡ºåºï¼š</h3><p>SQL æŸ¥è¯¢çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼ˆä¸ç¼–å†™é¡ºåºä¸åŒï¼‰ï¼š</p><ol><li><strong>FROM</strong>ï¼šé¦–å…ˆç¡®å®šè¦æŸ¥è¯¢çš„è¡¨æˆ–è§†å›¾ï¼Œå¹¶ä»è¿™äº›è¡¨ä¸­è¯»å–æ•°æ®ã€‚å¦‚æœæœ‰ <code>JOIN</code>ï¼Œè¿™ä¸ªé˜¶æ®µä¹Ÿä¼šå¤„ç†è¡¨è¿æ¥ã€‚</li><li><strong>ON</strong>ï¼šå¦‚æœå­˜åœ¨è¿æ¥æ¡ä»¶ï¼Œåœ¨ <code>JOIN</code> çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆåŸºäº <code>ON</code> æ¡ä»¶è¿›è¡Œè¡¨ä¹‹é—´çš„è¿æ¥æ“ä½œã€‚</li><li><strong>JOIN</strong>ï¼šæ ¹æ®è¡¨çš„è¿æ¥ç±»å‹ï¼ˆå¦‚ INNER JOINã€LEFT JOINï¼‰è¿›è¡Œæ•°æ®çš„è¿æ¥ã€‚</li><li><strong>WHERE</strong>ï¼šå¯¹å·²ç»è¿æ¥çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œåªä¿ç•™æ»¡è¶³ <code>WHERE</code> æ¡ä»¶çš„è®°å½•ã€‚</li><li><strong>GROUP BY</strong>ï¼šå¯¹ <code>WHERE</code> è¿‡æ»¤åçš„æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚</li><li><strong>HAVING</strong>ï¼šå¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œè¿‡æ»¤ï¼Œç±»ä¼¼äº <code>WHERE</code>ï¼Œä½†å®ƒä½œç”¨äºåˆ†ç»„åçš„ç»“æœã€‚</li><li><strong>SELECT</strong>ï¼šç¡®å®šè¦è¿”å›çš„åˆ—å’Œè®¡ç®—çš„è¡¨è¾¾å¼ã€‚æ‰§è¡Œæ—¶æ­¤æ­¥éª¤ä¹Ÿä¼šå¯¹åˆ—è¿›è¡ŒæŠ•å½±ã€‚</li><li><strong>DISTINCT</strong>ï¼šåœ¨ <code>SELECT</code> çš„åŸºç¡€ä¸Šè¿›è¡Œå»é‡æ“ä½œã€‚</li><li><strong>ORDER BY</strong>ï¼šå¯¹æœ€ç»ˆçš„ç»“æœé›†è¿›è¡Œæ’åºã€‚</li><li><strong>LIMIT &#x2F; OFFSET</strong>ï¼šé™åˆ¶è¿”å›çš„è¡Œæ•°æˆ–ä»ç‰¹å®šè¡Œå¼€å§‹è¿”å›æ•°æ®ã€‚</li></ol><h3 id="æ­£ç¡®çš„ä¾‹å­ï¼š"><a href="#æ­£ç¡®çš„ä¾‹å­ï¼š" class="headerlink" title="æ­£ç¡®çš„ä¾‹å­ï¼š"></a>æ­£ç¡®çš„ä¾‹å­ï¼š</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlå¤åˆ¶ä»£ç SELECT DISTINCT name, AVG(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE department = &#x27;IT&#x27;</span><br><span class="line">GROUP BY name</span><br><span class="line">HAVING AVG(salary) &gt; 5000</span><br><span class="line">ORDER BY AVG(salary) DESC</span><br><span class="line">LIMIT 10;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œé¡ºåºï¼š</p><ol><li><code>FROM employees</code></li><li><code>WHERE department = &#39;IT&#39;</code></li><li><code>GROUP BY name</code></li><li><code>HAVING AVG(salary) &gt; 5000</code></li><li><code>SELECT DISTINCT name, AVG(salary)</code></li><li><code>ORDER BY AVG(salary) DESC</code></li><li><code>LIMIT 10</code></li></ol></blockquote><h4 id="4-ç´¢å¼•æ˜¯ä»€ä¹ˆ"><a href="#4-ç´¢å¼•æ˜¯ä»€ä¹ˆ" class="headerlink" title="4.ç´¢å¼•æ˜¯ä»€ä¹ˆ"></a><a href="https://blog.csdn.net/twotwo22222/article/details/129115194?ops_request_misc=%7B%22request_id%22:%22DCFAC641-E438-4EE3-ACC8-12BE1118731A%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=DCFAC641-E438-4EE3-ACC8-12BE1118731A&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-129115194-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=MySQL%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187#4_33">4.ç´¢å¼•æ˜¯ä»€ä¹ˆ</a></h4><blockquote><p>æˆ‘ä¸å¤ªæ¸…æ¥šä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Œæˆ‘å¤§æ¦‚æƒ³ç´¢å¼•åœ¨MySQLæ•°æ®ä¸­æ ¹æ®å…¶ç´¢å¼•å€¼å¯ä»¥å¿«é€Ÿçš„è¿›è¡Œæ£€ç´¢ï¼Œç´¢å¼•åº”è¯¥ä¸ºæ•´å‹ï¼Œå¦‚æœè¯¥å­—æ®µæ˜¯ä¸ªç´¢å¼•ï¼Œæ•°æ®åº“åˆ™ä¼šä¸ºç´¢å¼•è¿›è¡Œå¤„ç†ï¼Œåç»­å¦‚æœè¿›è¡ŒæŸ¥è¯¢è¯¥å­—æ®µï¼Œä¼šæ›´å¿«ã€‚</p></blockquote><blockquote><h3 id="è¯„åˆ†ï¼š4-10"><a href="#è¯„åˆ†ï¼š4-10" class="headerlink" title="è¯„åˆ†ï¼š4&#x2F;10"></a>è¯„åˆ†ï¼š4&#x2F;10</h3><h3 id="é—®é¢˜ä¸æ”¹è¿›å»ºè®®ï¼š-1"><a href="#é—®é¢˜ä¸æ”¹è¿›å»ºè®®ï¼š-1" class="headerlink" title="é—®é¢˜ä¸æ”¹è¿›å»ºè®®ï¼š"></a>é—®é¢˜ä¸æ”¹è¿›å»ºè®®ï¼š</h3><ol><li><strong>ç´¢å¼•ä¸å±€é™äºæ•´å‹</strong>ï¼š<ul><li>ä½ æåˆ°â€œç´¢å¼•åº”è¯¥ä¸ºæ•´å‹â€ï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚ç´¢å¼•å¯ä»¥å»ºç«‹åœ¨ä¸åŒçš„æ•°æ®ç±»å‹ä¸Šï¼Œä¸ä»…é™äºæ•´å‹ï¼Œè¿˜åŒ…æ‹¬å­—ç¬¦ä¸²ã€æ—¥æœŸç­‰ç±»å‹ã€‚</li></ul></li><li><strong>ç´¢å¼•çš„å®ç°ä¸æ•°æ®ç»“æ„</strong>ï¼š<ul><li>ç´¢å¼•çš„æœ¬è´¨æ˜¯ä¸ºæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œæ•°æ®åº“å†…éƒ¨é€šå¸¸é€šè¿‡ç‰¹å®šçš„æ•°æ®ç»“æ„ï¼ˆå¦‚ B+æ ‘ æˆ– å“ˆå¸Œè¡¨ï¼‰æ¥å®ç°ç´¢å¼•ã€‚</li><li>MySQL çš„ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸»è¦ä½¿ç”¨ B+æ ‘ä½œä¸ºé»˜è®¤çš„ç´¢å¼•ç»“æ„ï¼Œä½ å¯ä»¥åœ¨å›ç­”ä¸­æåŠè¿™ä¸€ç‚¹ï¼Œä»¥å±•ç¤ºæ›´æ·±çš„ç†è§£ã€‚</li></ul></li><li><strong>ç´¢å¼•å¹¶ä¸æ˜¯æ€»ä¼šæé«˜æ€§èƒ½</strong>ï¼š<ul><li>è™½ç„¶ç´¢å¼•å¯ä»¥åŠ é€ŸæŸ¥è¯¢ï¼Œä½†å®ƒä¹Ÿæœ‰ä»£ä»·ï¼Œä¾‹å¦‚æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œæ—¶ï¼Œç´¢å¼•ä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„ç»´æŠ¤å¼€é”€ã€‚è¿‡å¤šæˆ–ä¸åˆç†çš„ç´¢å¼•å¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚</li></ul></li></ol><h3 id="è¡¥å……æ­£ç¡®çš„ç­”æ¡ˆï¼š"><a href="#è¡¥å……æ­£ç¡®çš„ç­”æ¡ˆï¼š" class="headerlink" title="è¡¥å……æ­£ç¡®çš„ç­”æ¡ˆï¼š"></a>è¡¥å……æ­£ç¡®çš„ç­”æ¡ˆï¼š</h3><h4 id="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h4><p>ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­ä¸€ç§ç”¨äº<strong>æé«˜æ•°æ®æŸ¥è¯¢æ•ˆç‡çš„æœºåˆ¶</strong>ã€‚å®ƒå¯ä»¥ç±»æ¯”ä¸ºä¹¦æœ¬ä¸­çš„ç›®å½•ï¼Œé€šè¿‡ç´¢å¼•ï¼Œä½ å¯ä»¥å¿«é€Ÿå®šä½åˆ°æ•°æ®çš„ä½ç½®ï¼Œè€Œä¸ç”¨éå†æ•´å¼ è¡¨ã€‚å¸¸è§çš„ç´¢å¼•ç±»å‹æœ‰ï¼š</p><ol><li><strong>â‘ æ™®é€šç´¢å¼•ï¼š</strong> åŸºæœ¬ç´¢å¼•ç±»å‹ï¼Œå…è®¸å®šä¹‰ç´¢å¼•çš„å­—æ®µä¸ºç©ºå€¼å’Œé‡å¤å€¼ã€‚</li><li><strong>â‘¡å”¯ä¸€ç´¢å¼•ï¼š</strong> ç´¢å¼•çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸å®šä¹‰ç´¢å¼•çš„å­—æ®µä¸ºç©ºå€¼ã€‚</li><li><strong>â‘¢ä¸»é”®ç´¢å¼•ï¼š</strong> ç´¢å¼•çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä¸å¯ä»¥ä¸ºç©ºã€‚</li><li><strong>â‘£å¤åˆç´¢å¼•ï¼š</strong> å¤šä¸ªå­—æ®µåŠ ç´¢å¼•ï¼Œéµå®ˆæœ€å·¦åŒ¹é…è§„åˆ™ã€‚</li><li><strong>â‘¤å…¨å±€ç´¢å¼•ï¼š</strong> åªæœ‰åœ¨ MyISAM å¼•æ“ä¸Šæ‰èƒ½ä½¿ç”¨ã€‚</li></ol><h3 id="ç´¢å¼•çš„ä¼˜ç‚¹ï¼š"><a href="#ç´¢å¼•çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="ç´¢å¼•çš„ä¼˜ç‚¹ï¼š"></a>ç´¢å¼•çš„ä¼˜ç‚¹ï¼š</h3><ul><li>æé«˜ <code>SELECT</code> æŸ¥è¯¢çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠåˆ° <code>WHERE</code>ã€<code>ORDER BY</code> å’Œ <code>JOIN</code> æ“ä½œæ—¶ã€‚</li></ul><h3 id="ç´¢å¼•çš„ç¼ºç‚¹ï¼š"><a href="#ç´¢å¼•çš„ç¼ºç‚¹ï¼š" class="headerlink" title="ç´¢å¼•çš„ç¼ºç‚¹ï¼š"></a>ç´¢å¼•çš„ç¼ºç‚¹ï¼š</h3><ul><li>ä¼šå¢åŠ æ•°æ®æ’å…¥ã€æ›´æ–°ã€åˆ é™¤çš„æ—¶é—´å¼€é”€ï¼Œå› ä¸ºç´¢å¼•éœ€è¦åœ¨è¿™äº›æ“ä½œæ—¶è¿›è¡Œç»´æŠ¤å’Œæ›´æ–°ã€‚</li><li>å ç”¨é¢å¤–çš„å­˜å‚¨ç©ºé—´ã€‚</li><li>ç´¢å¼•ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥ä¼šå ç”¨ç©ºé—´ã€‚</li><li>é™ä½æ›´æ–°çš„é€Ÿåº¦ï¼Œå› ä¸ºä¸å…‰è¦æ›´æ–°æ•°æ®ï¼Œè¿˜è¦æ›´æ–°ç´¢å¼•ã€‚</li></ul></blockquote><h4 id="7-ç´¢å¼•æ€ä¹ˆè®¾è®¡-ä¼˜åŒ–"><a href="#7-ç´¢å¼•æ€ä¹ˆè®¾è®¡-ä¼˜åŒ–" class="headerlink" title="7.ç´¢å¼•æ€ä¹ˆè®¾è®¡(ä¼˜åŒ–)"></a><a href="https://blog.csdn.net/twotwo22222/article/details/129115194?ops_request_misc=%7B%22request_id%22:%22DCFAC641-E438-4EE3-ACC8-12BE1118731A%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=DCFAC641-E438-4EE3-ACC8-12BE1118731A&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-129115194-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=MySQL%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187#7_51">7.ç´¢å¼•æ€ä¹ˆè®¾è®¡(ä¼˜åŒ–)</a></h4><blockquote><p>å¯¹äºè¡¨ä¸­æŸäº›ç»å¸¸éœ€è¦ä¿®æ”¹çš„å­—æ®µæ¥è¯´ä¸åº”è®¾ç½®ç´¢å¼•ï¼Œå› ä¸ºç»å¸¸çš„æ›´æ–°ä¼šå¯¼è‡´å…¶æ•°æ®åº“æ•ˆç‡é™ä½ï¼›</p><p>ç´¢å¼•åº”è¯¥è®¾ç½®åœ¨é‚£äº›è¯»æ“ä½œå¾ˆå¤šçš„è¡¨ä¸­çš„ä¸å¸¸æ›´æ–°çš„å­—æ®µä¸Šã€‚</p></blockquote><blockquote><ol><li><ul><li><p>ä½ çš„å›ç­”æåˆ°äº†ç´¢å¼•è®¾è®¡ä¸­çš„ä¸€äº›åŸºæœ¬åŸåˆ™ï¼Œå°¤å…¶æ˜¯å…³äºè¯»å†™æ“ä½œé¢‘ç¹ç¨‹åº¦å¯¹ç´¢å¼•çš„å½±å“ï¼Œè¿™éƒ¨åˆ†æ˜¯æ­£ç¡®çš„ï¼Œä½†å†…å®¹ç•¥æ˜¾ç®€å•ã€‚ä¸‹é¢æˆ‘ä¼šä¸ºä½ æ‰“åˆ†å¹¶ç»™å‡ºè¿›ä¸€æ­¥çš„è¡¥å……å»ºè®®ã€‚</p><h3 id="è¯„åˆ†ï¼š7-10-1"><a href="#è¯„åˆ†ï¼š7-10-1" class="headerlink" title="è¯„åˆ†ï¼š7&#x2F;10"></a>è¯„åˆ†ï¼š7&#x2F;10</h3><h3 id="æ”¹è¿›å»ºè®®ï¼š"><a href="#æ”¹è¿›å»ºè®®ï¼š" class="headerlink" title="æ”¹è¿›å»ºè®®ï¼š"></a>æ”¹è¿›å»ºè®®ï¼š</h3><ol><li><p><strong>ç´¢å¼•çš„åˆ›å»ºä¸ä»…å–å†³äºè¯»å†™é¢‘ç‡</strong>ï¼š</p><ul><li>è™½ç„¶ä½ æåˆ°é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸åº”è¯¥åˆ›å»ºç´¢å¼•æ˜¯æ­£ç¡®çš„ï¼Œä½†ç´¢å¼•çš„è®¾è®¡è¿˜éœ€è¦è€ƒè™‘æŸ¥è¯¢æ¨¡å¼ã€è¡¨çš„å¤§å°ã€ç´¢å¼•ç±»å‹ç­‰å› ç´ ã€‚</li></ul></li><li><p><strong>å¤šåˆ—ç´¢å¼•ä¸å•åˆ—ç´¢å¼•çš„é€‰æ‹©</strong>ï¼š</p><ul><li>åœ¨ç´¢å¼•è®¾è®¡ä¸­ï¼Œç»å¸¸éœ€è¦è€ƒè™‘æ˜¯å¦ä½¿ç”¨å¤šåˆ—ç»„åˆç´¢å¼•ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠå¤šä¸ªæŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œåˆç†è®¾è®¡å¤šåˆ—ç´¢å¼•å¯ä»¥é¿å…å…¨è¡¨æ‰«æï¼Œæé«˜æ€§èƒ½ã€‚</li></ul></li><li><p><strong>è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰</strong>ï¼š</p><ul><li>å½“æŸ¥è¯¢ä¸­çš„æ‰€æœ‰å­—æ®µéƒ½è¢«åŒ…å«åœ¨ç´¢å¼•ä¸­æ—¶ï¼ŒMySQL å¯ä»¥åªé€šè¿‡æ‰«æç´¢å¼•æ¥å®ŒæˆæŸ¥è¯¢ï¼Œè€Œä¸éœ€è¦è®¿é—®æ•°æ®è¡¨ã€‚è¿™ä¸ªæ¦‚å¿µåœ¨ç´¢å¼•ä¼˜åŒ–ä¸­éå¸¸é‡è¦ã€‚</li></ul></li><li><p><strong>ç´¢å¼•å‰ç¼€ï¼ˆPrefix Indexï¼‰</strong>ï¼š</p><ul><li>å¯¹äºé•¿æ–‡æœ¬æˆ–å­—ç¬¦ä¸²å­—æ®µï¼Œå¯ä»¥åªå¯¹å‰å‡ ä½è¿›è¡Œç´¢å¼•ï¼Œè¿™æ ·æ—¢å¯ä»¥èŠ‚çœç©ºé—´åˆèƒ½å¤Ÿæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul></li></ol><h3 id="æ­£ç¡®çš„è¡¥å……å›ç­”ï¼š"><a href="#æ­£ç¡®çš„è¡¥å……å›ç­”ï¼š" class="headerlink" title="æ­£ç¡®çš„è¡¥å……å›ç­”ï¼š"></a>æ­£ç¡®çš„è¡¥å……å›ç­”ï¼š</h3><h4 id="ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼š"><a href="#ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼š" class="headerlink" title="ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼š"></a>ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼š</h4><ol><li><p><strong>é€‰æ‹©æ€§é«˜çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•</strong>ï¼š</p><ul><li>ç´¢å¼•åº”è¯¥åˆ›å»ºåœ¨é€‰æ‹©æ€§é«˜çš„åˆ—ä¸Šï¼Œæ‰€è°“é€‰æ‹©æ€§æ˜¯æŒ‡åˆ—ä¸­å”¯ä¸€å€¼çš„æ¯”ä¾‹ã€‚é€‰æ‹©æ€§è¶Šé«˜ï¼Œç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ï¼Œå› ä¸ºå®ƒèƒ½æ›´å¿«ç¼©å°æŸ¥è¯¢èŒƒå›´ã€‚</li><li>ä¾‹å¦‚ï¼Œå¯¹æŸä¸ªå”¯ä¸€æ€§é«˜çš„å­—æ®µï¼ˆå¦‚ç”¨æˆ·IDï¼‰åˆ›å»ºç´¢å¼•èƒ½å¤Ÿå¤§å¹…æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul></li><li><p><strong>é¿å…å¯¹é¢‘ç¹æ›´æ–°çš„å­—æ®µåˆ›å»ºç´¢å¼•</strong>ï¼š</p><ul><li>ä½ çš„å›ç­”æ­£ç¡®åœ°æŒ‡å‡ºï¼Œé¢‘ç¹æ›´æ–°çš„å­—æ®µä¸åº”åˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºæ¯æ¬¡æ›´æ–°éƒ½éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œå½±å“å†™æ“ä½œçš„æ•ˆç‡ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨å¤åˆç´¢å¼•ï¼ˆMulti-column Indexï¼‰</strong>ï¼š</p><ul><li>å¯¹å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„æƒ…å†µï¼Œå¯ä»¥åˆ›å»ºå¤åˆç´¢å¼•ï¼Œè€Œä¸æ˜¯å¤šä¸ªå•åˆ—ç´¢å¼•ã€‚æ¯”å¦‚å¯¹æŸ¥è¯¢ <code>WHERE name = &#39;John&#39; AND age = 30</code>ï¼Œå¯ä»¥åˆ›å»º <code>(name, age)</code> çš„å¤åˆç´¢å¼•ã€‚</li><li>æ³¨æ„ç´¢å¼•çš„é¡ºåºï¼ŒMySQL ä½¿ç”¨æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œæ„å‘³ç€ç´¢å¼•é¡ºåºå¾ˆé‡è¦ï¼Œåº”è¯¥å°†æŸ¥è¯¢ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åœ¨ç´¢å¼•çš„æœ€å‰é¢ã€‚</li></ul></li><li><p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼š</p><ul><li>å°½é‡è®¾è®¡â€œè¦†ç›–ç´¢å¼•â€ï¼Œå³æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰å­—æ®µéƒ½åœ¨ç´¢å¼•ä¸­ï¼ŒMySQL å°±ä¸éœ€è¦å»æŸ¥è¯¢æ•°æ®è¡¨ï¼Œä»è€Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age_salary <span class="keyword">ON</span> employees(name, age, salary);</span><br></pre></td></tr></table></figure>å¦‚æœä½ çš„æŸ¥è¯¢æ˜¯ <code>SELECT name, age, salary FROM employees WHERE name = &#39;John&#39;</code>, MySQL å¯ä»¥åªé€šè¿‡ç´¢å¼•æŸ¥è¯¢ï¼Œä¸éœ€è¦è®¿é—®åŸå§‹æ•°æ®è¡¨ã€‚</li></ul></li><li><p><strong>å‰ç¼€ç´¢å¼•</strong>ï¼š</p><ul><li>å¯¹äºè¾ƒé•¿çš„æ–‡æœ¬å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨å‰ç¼€ç´¢å¼•æ¥èŠ‚çœç©ºé—´ã€‚ä¾‹å¦‚ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_email <span class="keyword">ON</span> users(email(<span class="number">10</span>));</span><br></pre></td></tr></table></figure>è¿™ç§åšæ³•å¯ä»¥åœ¨åªæŸ¥è¯¢ç”µå­é‚®ä»¶å‰10ä¸ªå­—ç¬¦æ—¶ä»ç„¶ä¿æŒè¾ƒå¥½çš„æ€§èƒ½ã€‚</li></ul></li><li><p><strong>é¿å…å¯¹ä½é€‰æ‹©æ€§å­—æ®µåˆ›å»ºç´¢å¼•</strong>ï¼š</p><ul><li>åƒ <code>gender</code> è¿™ç§ä½é€‰æ‹©æ€§çš„å­—æ®µï¼Œé€‰æ‹©åªæœ‰å‡ ä¸ªå€¼ï¼ˆå¦‚â€™ç”·â€™å’Œâ€™å¥³â€™ï¼‰çš„åˆ—ï¼Œä¸é€‚åˆåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºå®ƒæ— æ³•æœ‰æ•ˆè¿‡æ»¤å¤§é‡è®°å½•ã€‚</li></ul></li></ol><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><ul><li>ä½ çš„å›ç­”åŒ…å«äº†åŸºç¡€åŸåˆ™ï¼Œä½†å¯ä»¥é€šè¿‡æ›´æ·±çš„ç´¢å¼•è®¾è®¡ç­–ç•¥æ¥ä¼˜åŒ–å›ç­”ï¼Œç‰¹åˆ«æ˜¯å¤åˆç´¢å¼•ã€è¦†ç›–ç´¢å¼•ç­‰é«˜çº§æ¦‚å¿µã€‚</li></ul></li></ul></li></ol></blockquote><blockquote><ol><li>â‘ é€‰æ‹©å”¯ä¸€æ€§ç´¢å¼•ï¼šå€¼æ˜¯å”¯ä¸€çš„ï¼ŒæŸ¥è¯¢çš„æ›´å¿«ã€‚</li><li>â‘¡ç»å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåŠ ç´¢å¼•ã€‚</li><li>â‘¢ä¸ºç»å¸¸éœ€è¦æ’åºã€åˆ†ç»„å’Œè”åˆæ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•ï¼šorder byã€group byã€union(è”åˆ)ã€distinct(å»é‡)ç­‰ã€‚</li><li>â‘£é™åˆ¶ç´¢å¼•ä¸ªæ•°ï¼šç´¢å¼•æ•°é‡å¤šï¼Œéœ€è¦çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤šï¼Œæ›´æ–°è¡¨æ—¶ï¼Œå¯¹ç´¢å¼•çš„é‡æ„å’Œæ›´æ–°å°±å¾ˆè´¹åŠ²ã€‚</li><li>â‘¤è¡¨æ•°æ®å°‘çš„ä¸å»ºè®®ä½¿ç”¨ç´¢å¼•(ç™¾ä¸‡çº§ä»¥å†…)ï¼šæ•°æ®è¿‡å°‘ï¼Œæœ‰å¯èƒ½æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œæ¯”éå†ç´¢å¼•çš„é€Ÿåº¦éƒ½å¿«ã€‚</li><li>â‘¥åˆ é™¤ä¸å¸¸ç”¨å’Œä¸å†ä½¿ç”¨çš„ç´¢å¼•ã€‚</li><li>â‘¦ç”¨ç±»å‹å°çš„ç±»å‹åšç´¢å¼•ï¼šæ¯”å¦‚ï¼šintå’ŒBIGINTèƒ½ç”¨intå°±ä½¿ç”¨intã€‚å› ä¸ºç±»å‹å°ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«å’Œç´¢å¼•å ç”¨çš„ç©ºé—´æ›´å°‘ã€‚</li><li>â‘§ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œè¦æ˜¯å­—ç¬¦ä¸²è¶Šé•¿ï¼Œé‚£ä¹ˆç´¢å¼•å çš„ç©ºé—´è¶Šå¤§ï¼Œå¹¶ä¸”æ¯”è¾ƒèµ·æ¥å°±æ—¶é—´å°±è¶Šé•¿ã€‚</li></ol></blockquote><h4 id="8-æ€ä¹ˆé¿å…ç´¢å¼•å¤±æ•ˆ-ä¹Ÿå±äºsqlä¼˜åŒ–çš„ä¸€ç§"><a href="#8-æ€ä¹ˆé¿å…ç´¢å¼•å¤±æ•ˆ-ä¹Ÿå±äºsqlä¼˜åŒ–çš„ä¸€ç§" class="headerlink" title="8.æ€ä¹ˆé¿å…ç´¢å¼•å¤±æ•ˆ(ä¹Ÿå±äºsqlä¼˜åŒ–çš„ä¸€ç§)"></a><a href="https://blog.csdn.net/twotwo22222/article/details/129115194?ops_request_misc=%7B%22request_id%22:%22DCFAC641-E438-4EE3-ACC8-12BE1118731A%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=DCFAC641-E438-4EE3-ACC8-12BE1118731A&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-129115194-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=MySQL%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187#8sql_62">8.æ€ä¹ˆé¿å…ç´¢å¼•å¤±æ•ˆ(ä¹Ÿå±äºsqlä¼˜åŒ–çš„ä¸€ç§)</a></h4><blockquote><p>æ²¡äº†è§£è¿‡</p></blockquote><blockquote><p>ä½ çš„å›ç­”æ²¡æœ‰å±•ç°å‡ºå¯¹ç´¢å¼•å¤±æ•ˆçš„ç†è§£ï¼Œè¿™åœ¨æŠ€æœ¯é¢è¯•ä¸­æ˜¯ä¸ªå‡åˆ†é¡¹ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ å·²ç»æœ‰ä¸€å®šçš„å·¥ä½œç»éªŒã€‚é¿å…ç´¢å¼•å¤±æ•ˆæ˜¯SQLä¼˜åŒ–çš„ä¸€ä¸ªå…³é”®ç‚¹ï¼Œæ·±å…¥ç†è§£è¿™ä¸ªé—®é¢˜å¹¶æä¾›æ¸…æ™°çš„è§£é‡Šä¼šå±•ç°å‡ºä½ å¯¹æ•°æ®åº“ä¼˜åŒ–çš„æŒæ¡ç¨‹åº¦ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šä¸ºä½ æ‰“åˆ†å¹¶ç»™å‡ºæ­£ç¡®çš„ç­”æ¡ˆè¡¥å……ã€‚</p><h3 id="è¯„åˆ†ï¼š3-10"><a href="#è¯„åˆ†ï¼š3-10" class="headerlink" title="è¯„åˆ†ï¼š3&#x2F;10"></a>è¯„åˆ†ï¼š3&#x2F;10</h3><h3 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h3><ol><li><p><strong>å›ç­”è¿‡äºç®€å•</strong>ï¼š</p><ul><li>ç›´æ¥å›ç­”â€œæ²¡äº†è§£è¿‡â€è™½ç„¶è¯šå®ï¼Œä½†ä¹Ÿä¼šç»™é¢è¯•å®˜ç•™ä¸‹ä½ ç¼ºä¹åŸºç¡€çŸ¥è¯†çš„å°è±¡ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®åº“ä¼˜åŒ–æ–¹é¢ã€‚</li></ul></li><li><p><strong>ç¼ºä¹æ¢ç´¢æ€§æ€ç»´</strong>ï¼š</p><ul><li>åœ¨é¢è¯•ä¸­ï¼Œå³ä½¿ä½ ä¸å®Œå…¨æŒæ¡æŸä¸ªé—®é¢˜ï¼Œå±•ç¤ºå‡ºå¯¹è¿™ä¸ªé¢†åŸŸçš„ç†è§£å’Œæ€è€ƒè¿‡ç¨‹ä¼šç»™ä½ åŠ åˆ†ã€‚</li></ul></li></ol><h3 id="è¡¥å……çš„æ­£ç¡®å›ç­”ï¼š"><a href="#è¡¥å……çš„æ­£ç¡®å›ç­”ï¼š" class="headerlink" title="è¡¥å……çš„æ­£ç¡®å›ç­”ï¼š"></a>è¡¥å……çš„æ­£ç¡®å›ç­”ï¼š</h3><h4 id="å¦‚ä½•é¿å…ç´¢å¼•å¤±æ•ˆï¼Ÿ"><a href="#å¦‚ä½•é¿å…ç´¢å¼•å¤±æ•ˆï¼Ÿ" class="headerlink" title="å¦‚ä½•é¿å…ç´¢å¼•å¤±æ•ˆï¼Ÿ"></a>å¦‚ä½•é¿å…ç´¢å¼•å¤±æ•ˆï¼Ÿ</h4><p>ç´¢å¼•å¤±æ•ˆæ„å‘³ç€æ•°æ®åº“åœ¨æŸ¥è¯¢æ—¶æ²¡æœ‰ä½¿ç”¨å¯ç”¨çš„ç´¢å¼•ï¼Œä»è€Œå¯¼è‡´å…¨è¡¨æ‰«æï¼Œé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚é¿å…ç´¢å¼•å¤±æ•ˆæ˜¯SQLä¼˜åŒ–çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ï¼Œä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„é¿å…ç´¢å¼•å¤±æ•ˆçš„æ–¹æ³•ï¼š</p><ol><li><p><strong>é¿å…åœ¨ <code>WHERE</code> å­å¥ä¸­çš„ç´¢å¼•åˆ—è¿›è¡Œå‡½æ•°æˆ–è¡¨è¾¾å¼æ“ä½œ</strong>ï¼š</p><ul><li>å½“ä½ å¯¹ç´¢å¼•åˆ—è¿›è¡Œå‡½æ•°æ“ä½œï¼ˆä¾‹å¦‚ <code>WHERE UPPER(name) = &#39;JOHN&#39;</code>ï¼‰ï¼Œç´¢å¼•ä¼šå¤±æ•ˆï¼Œå› ä¸ºMySQLä¸èƒ½ç›´æ¥ä½¿ç”¨ç´¢å¼•æ¥è¿‡æ»¤æ•°æ®ã€‚</li><li>æ­£ç¡®åšæ³•ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>é¿å…åœ¨ <code>WHERE</code> å­å¥ä¸­ä½¿ç”¨éšå¼ç±»å‹è½¬æ¢</strong>ï¼š</p><ul><li>å¦‚æœç´¢å¼•åˆ—æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½†ä½ åœ¨æŸ¥è¯¢æ—¶ä½¿ç”¨äº†æ•´æ•°æˆ–å…¶ä»–æ•°æ®ç±»å‹ï¼ŒMySQL ä¼šè¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>é”™è¯¯ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> phone_number <span class="operator">=</span> <span class="number">1234567890</span>;  <span class="comment">-- phone_number æ˜¯å­—ç¬¦ä¸²ç±»å‹</span></span><br></pre></td></tr></table></figure></li><li>æ­£ç¡®åšæ³•ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> phone_number <span class="operator">=</span> <span class="string">&#x27;1234567890&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong><code>LIKE</code> æŸ¥è¯¢æ—¶é¿å…ä»¥ <code>%</code> å¼€å¤´</strong>ï¼š</p><ul><li>åœ¨ä½¿ç”¨ <code>LIKE</code> æŸ¥è¯¢æ—¶ï¼Œå¦‚æœé€šé…ç¬¦ <code>%</code> å‡ºç°åœ¨å¼€å¤´ï¼Œç´¢å¼•ä¼šå¤±æ•ˆï¼Œå› ä¸ºMySQLæ— æ³•ç¡®å®šåŒ¹é…çš„èµ·å§‹ä½ç½®ã€‚</li><li>é”™è¯¯ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%John&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li>æ­£ç¡®åšæ³•ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;John%&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä½¿ç”¨å¤åˆç´¢å¼•æ—¶éµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™</strong>ï¼š</p><ul><li>å¦‚æœä½ åœ¨å¤åˆç´¢å¼•ä¸­æŸ¥è¯¢æ—¶æ²¡æœ‰ä»ç¬¬ä¸€ä¸ªç´¢å¼•åˆ—å¼€å§‹ä½¿ç”¨ï¼Œç´¢å¼•ä¼šå¤±æ•ˆã€‚</li><li>å‡è®¾ä½ æœ‰ <code>(name, age)</code> çš„å¤åˆç´¢å¼•ï¼Œä»¥ä¸‹æŸ¥è¯¢ä¼šå¤±æ•ˆï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">30</span>;  <span class="comment">-- ç´¢å¼•å¤±æ•ˆ</span></span><br></pre></td></tr></table></figure></li><li>æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">30</span>;  <span class="comment">-- ç´¢å¼•æœ‰æ•ˆ</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>é¿å…ä½¿ç”¨ <code>OR</code> å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>OR</code> æ—¶ï¼Œé™¤é <code>OR</code> ä¸¤è¾¹çš„æ¡ä»¶å­—æ®µéƒ½æœ‰ç´¢å¼•ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>é”™è¯¯ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">30</span>;  <span class="comment">-- ç´¢å¼•å¤±æ•ˆ</span></span><br></pre></td></tr></table></figure></li><li>æ­£ç¡®åšæ³•æ˜¯ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> (name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">30</span>);  <span class="comment">-- ä½¿ç”¨ç´¢å¼•</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>é¿å…ä½¿ç”¨è¿‡å¤šçš„ç´¢å¼•</strong>ï¼š</p><ul><li>ç´¢å¼•è™½ç„¶èƒ½æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†ç»´æŠ¤ç´¢å¼•ä¹Ÿä¼šå¢åŠ å†™æ“ä½œçš„å¼€é”€ã€‚å¦‚æœä¸€ä¸ªè¡¨çš„æ›´æ–°é¢‘ç‡å¾ˆé«˜ï¼Œç´¢å¼•å¤ªå¤šåè€Œä¼šæ‹–æ…¢å†™å…¥é€Ÿåº¦ã€‚å› æ­¤ï¼Œéœ€è¦åˆç†æƒè¡¡ç´¢å¼•çš„æ•°é‡ã€‚</li></ul></li></ol><h3 id="æ€»ç»“ï¼š-1"><a href="#æ€»ç»“ï¼š-1" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>ä¸ºäº†é¿å…ç´¢å¼•å¤±æ•ˆï¼Œåº”è¯¥é¿å…å¯¹ç´¢å¼•åˆ—åšä¸å¿…è¦çš„æ“ä½œï¼Œå¹¶ä¸”è¦éµå¾ªç´¢å¼•çš„è®¾è®¡è§„åˆ™ï¼ˆå¦‚æœ€å·¦å‰ç¼€æ³•åˆ™ï¼‰ã€‚æŒæ¡è¿™äº›æŠ€å·§ä¸ä»…èƒ½æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œè¿˜èƒ½å¸®åŠ©ä½ åœ¨æ•°æ®åº“ä¼˜åŒ–æ–¹é¢å±•ç¤ºå‡ºæ›´é«˜çš„æ°´å¹³ã€‚</p></blockquote><blockquote><ol><li>â‘ æŸåˆ—ä½¿ç”¨èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€likeã€between and)æ—¶, å³è¾¹çš„æ‰€æœ‰åˆ—ç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆã€‚</li><li>â‘¡ä¸è¦å¯¹ç´¢å¼•å­—æ®µè¿›è¡Œè¿ç®—ã€‚</li><li>â‘¢åœ¨whereå­å¥ä¸­ä¸è¦ä½¿ç”¨ ORã€!&#x3D;ã€&lt;&gt;å’Œå¯¹å€¼nullçš„åˆ¤æ–­ã€‚</li><li>â‘£é¿å…ä½¿ç”¨â€™%â€™å¼€å¤´çš„likeçš„æ¨¡ç³ŠæŸ¥è¯¢ã€‚</li><li>â‘¤å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ï¼Œé€ æˆç´¢å¼•å¤±æ•ˆã€‚</li></ol></blockquote><h4 id="9-ç´¢å¼•çš„æ•°æ®ç±»å‹"><a href="#9-ç´¢å¼•çš„æ•°æ®ç±»å‹" class="headerlink" title="9.ç´¢å¼•çš„æ•°æ®ç±»å‹"></a><a href="https://blog.csdn.net/twotwo22222/article/details/129115194?ops_request_misc=%7B%22request_id%22:%22DCFAC641-E438-4EE3-ACC8-12BE1118731A%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=DCFAC641-E438-4EE3-ACC8-12BE1118731A&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-129115194-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=MySQL%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187#9_69">9.ç´¢å¼•çš„æ•°æ®ç±»å‹</a></h4><blockquote><p>ç´¢å¼•çš„æ•°æ®ç±»å‹æœ‰ï¼šæ•´å‹ã€å­—ç¬¦ä¸²ç±»å‹ã€æ—¥æœŸç±»å‹ã€å¸ƒå°”å‹ã€‚</p></blockquote><blockquote><p>ä½ çš„å›ç­”è™½ç„¶æåˆ°äº†ä¸€äº›å¸¸è§çš„å­—æ®µç±»å‹ï¼Œä½†å®é™…é—®é¢˜æ˜¯å…³äºâ€œç´¢å¼•çš„æ•°æ®ç±»å‹â€ï¼Œè€Œä¸æ˜¯â€œç´¢å¼•æ‰€ä½¿ç”¨çš„å­—æ®µç±»å‹â€ã€‚åœ¨MySQLä¸­ï¼Œç´¢å¼•æœ¬èº«å¹¶æ²¡æœ‰â€œæ•°æ®ç±»å‹â€ï¼Œè€Œæ˜¯åŸºäºå­—æ®µçš„ç±»å‹æ¥åˆ›å»ºçš„ã€‚å› æ­¤ï¼Œä½ çš„å›ç­”å¹¶æœªå‡†ç¡®å›ç­”é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å¯¹ä½ å›ç­”çš„è¯„åˆ†å’Œæ­£ç¡®çš„è§£é‡Šã€‚</p><h3 id="è¯„åˆ†ï¼š4-10-1"><a href="#è¯„åˆ†ï¼š4-10-1" class="headerlink" title="è¯„åˆ†ï¼š4&#x2F;10"></a>è¯„åˆ†ï¼š4&#x2F;10</h3><h3 id="è¯„åˆ†è¯´æ˜ï¼š"><a href="#è¯„åˆ†è¯´æ˜ï¼š" class="headerlink" title="è¯„åˆ†è¯´æ˜ï¼š"></a>è¯„åˆ†è¯´æ˜ï¼š</h3><ol><li><strong>æ­£ç¡®æ€§</strong>ï¼šä½ æåˆ°çš„å­—æ®µç±»å‹ï¼ˆæ•´å‹ã€å­—ç¬¦ä¸²ç±»å‹ã€æ—¥æœŸç±»å‹ã€å¸ƒå°”å‹ï¼‰ç¡®å®æ˜¯å¸¸è§çš„å­—æ®µç±»å‹ï¼Œå¯ä»¥ç”¨äºç´¢å¼•ã€‚ä½†æ˜¯ï¼Œç´¢å¼•çš„â€œæ•°æ®ç±»å‹â€è¿™ä¸€é—®é¢˜æ²¡æœ‰è¢«æ­£ç¡®å›ç­”ã€‚</li><li><strong>ç›¸å…³æ€§</strong>ï¼šè™½ç„¶æåˆ°çš„å­—æ®µç±»å‹å’Œç´¢å¼•ç›¸å…³ï¼Œä½†å¹¶ä¸ç›´æ¥å›ç­”ç´¢å¼•çš„ç±»å‹æˆ–å¦‚ä½•æ ¹æ®å­—æ®µç±»å‹è®¾è®¡ç´¢å¼•ã€‚</li></ol><h3 id="æ­£ç¡®ç­”æ¡ˆè¡¥å……ï¼š"><a href="#æ­£ç¡®ç­”æ¡ˆè¡¥å……ï¼š" class="headerlink" title="æ­£ç¡®ç­”æ¡ˆè¡¥å……ï¼š"></a>æ­£ç¡®ç­”æ¡ˆè¡¥å……ï¼š</h3><h4 id="MySQLä¸­ç´¢å¼•çš„ç±»å‹ï¼š"><a href="#MySQLä¸­ç´¢å¼•çš„ç±»å‹ï¼š" class="headerlink" title="MySQLä¸­ç´¢å¼•çš„ç±»å‹ï¼š"></a>MySQLä¸­ç´¢å¼•çš„ç±»å‹ï¼š</h4><p>åœ¨MySQLä¸­ï¼Œç´¢å¼•æ²¡æœ‰â€œæ•°æ®ç±»å‹â€ï¼Œè€Œæ˜¯æ ¹æ®å­—æ®µçš„æ•°æ®ç±»å‹æ¥åˆ›å»ºçš„ã€‚ä¸è¿‡ï¼ŒMySQLæ”¯æŒä»¥ä¸‹å‡ ç§ä¸»è¦çš„ç´¢å¼•ç±»å‹ï¼š</p><ol><li><p><strong>B-Tree ç´¢å¼•</strong>ï¼š</p><ul><li><strong>æè¿°</strong>ï¼šè¿™æ˜¯æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç±»å‹çš„æŸ¥è¯¢ï¼Œç‰¹åˆ«æ˜¯èŒƒå›´æŸ¥è¯¢ã€‚</li><li><strong>é€‚ç”¨æ•°æ®ç±»å‹</strong>ï¼šæ•´å‹ã€å­—ç¬¦ä¸²ç±»å‹ã€æ—¥æœŸç±»å‹ç­‰ã€‚</li><li><strong>å®ç°</strong>ï¼šé€šè¿‡B-Treeï¼ˆå¹³è¡¡æ ‘ï¼‰ç»“æ„æ¥å­˜å‚¨ç´¢å¼•ã€‚</li></ul></li><li><p><strong>å“ˆå¸Œç´¢å¼•</strong>ï¼š</p><ul><li><strong>æè¿°</strong>ï¼šå“ˆå¸Œç´¢å¼•é€‚ç”¨äºç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼ˆ&#x3D;ï¼‰ï¼Œä½†ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚</li><li><strong>é€‚ç”¨æ•°æ®ç±»å‹</strong>ï¼šæ•´å‹ã€å­—ç¬¦ä¸²ç±»å‹ç­‰ã€‚</li><li><strong>å®ç°</strong>ï¼šä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨ç´¢å¼•ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šInnoDBå­˜å‚¨å¼•æ“åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå¦‚Memoryå¼•æ“çš„è¡¨ï¼‰æ”¯æŒå“ˆå¸Œç´¢å¼•ã€‚</li></ul></li><li><p><strong>å…¨æ–‡ç´¢å¼•ï¼ˆFull-Text Indexï¼‰</strong>ï¼š</p><ul><li><strong>æè¿°</strong>ï¼šç”¨äºå…¨æ–‡æœç´¢ï¼Œé€‚ç”¨äºæ–‡æœ¬æ•°æ®ã€‚</li><li><strong>é€‚ç”¨æ•°æ®ç±»å‹</strong>ï¼šé€šå¸¸ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼ˆå¦‚ <code>TEXT</code>ã€<code>VARCHAR</code>ï¼‰ã€‚</li><li><strong>å®ç°</strong>ï¼šé€šè¿‡å€’æ’ç´¢å¼•æ¥åŠ é€Ÿå…¨æ–‡æœç´¢æŸ¥è¯¢ã€‚</li></ul></li><li><p><strong>ç©ºé—´ç´¢å¼•ï¼ˆSpatial Indexï¼‰</strong>ï¼š</p><ul><li><strong>æè¿°</strong>ï¼šç”¨äºç©ºé—´æ•°æ®ï¼ˆå¦‚åœ°ç†ä¿¡æ¯ç³»ç»Ÿä¸­çš„åœ°ç†æ•°æ®ï¼‰ã€‚</li><li><strong>é€‚ç”¨æ•°æ®ç±»å‹</strong>ï¼šç©ºé—´æ•°æ®ç±»å‹ï¼ˆå¦‚ <code>GEOMETRY</code>ã€<code>POINT</code>ï¼‰ã€‚</li><li><strong>å®ç°</strong>ï¼šä½¿ç”¨R-Treeï¼ˆçŸ©å½¢æ ‘ï¼‰æ¥å­˜å‚¨ç´¢å¼•ã€‚</li></ul></li><li><p><strong>å‰ç¼€ç´¢å¼•</strong>ï¼š</p><ul><li><strong>æè¿°</strong>ï¼šå¯¹äºé•¿å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥ç´¢å¼•å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼ˆå‰ç¼€ï¼‰ï¼Œä»è€Œå‡å°‘ç´¢å¼•çš„å¤§å°ã€‚</li><li><strong>é€‚ç”¨æ•°æ®ç±»å‹</strong>ï¼šå­—ç¬¦ä¸²ç±»å‹ï¼ˆå¦‚ <code>VARCHAR</code>ï¼‰ã€‚</li><li><strong>å®ç°</strong>ï¼šä»…å¯¹å­—æ®µçš„å‰å‡ ä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼•ã€‚</li></ul></li></ol><h4 id="å…¶ä»–æ³¨æ„äº‹é¡¹ï¼š"><a href="#å…¶ä»–æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="å…¶ä»–æ³¨æ„äº‹é¡¹ï¼š"></a>å…¶ä»–æ³¨æ„äº‹é¡¹ï¼š</h4><ul><li><strong>å”¯ä¸€ç´¢å¼•ï¼ˆUnique Indexï¼‰</strong>ï¼šç¡®ä¿ç´¢å¼•åˆ—çš„å€¼å”¯ä¸€ã€‚</li><li><strong>å¤åˆç´¢å¼•ï¼ˆComposite Indexï¼‰</strong>ï¼šç´¢å¼•å¤šä¸ªåˆ—ï¼Œä¼˜åŒ–å¤šä¸ªåˆ—è”åˆæŸ¥è¯¢çš„æ€§èƒ½ã€‚</li></ul><h3 id="æ€»ç»“ï¼š-2"><a href="#æ€»ç»“ï¼š-2" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>ç†è§£ç´¢å¼•çš„ç±»å‹å’Œå¦‚ä½•æ ¹æ®å­—æ®µçš„æ•°æ®ç±»å‹é€‰æ‹©åˆé€‚çš„ç´¢å¼•ç±»å‹ï¼Œæ˜¯æ•°æ®åº“è®¾è®¡å’Œä¼˜åŒ–çš„é‡è¦éƒ¨åˆ†ã€‚ç¡®ä¿å›ç­”ä¸­æ˜ç¡®åŒºåˆ†ç´¢å¼•çš„ç±»å‹ä¸å­—æ®µçš„ç±»å‹ï¼Œä»¥ä¾¿åœ¨é¢è¯•ä¸­æä¾›å‡†ç¡®å’Œç›¸å…³çš„ä¿¡æ¯ã€‚</p></blockquote><blockquote><ul><li><strong>Hashï¼š</strong> æŸ¥è¯¢æ—¶è°ƒç”¨Hashå‡½æ•°è·å¾—åœ°å€ï¼Œå›è¡¨æŸ¥è¯¢å®é™…æ•°æ®ã€‚(InnoDBå’ŒMylSAMä¸æ”¯æŒï¼ŒMemoryæ”¯æŒ)ã€‚</li><li><strong>B+æ ‘ï¼š</strong> æ¯æ¬¡ä»æ ¹èŠ‚ç‚¹å‡ºå‘å»æŸ¥è¯¢ï¼Œç„¶åå¾—åˆ°åœ°å€ï¼Œå›è¡¨æŸ¥è¯¢å®é™…æ•°æ®ã€‚</li></ul></blockquote><h4 id="10-ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨æ ‘ç»“æ„"><a href="#10-ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨æ ‘ç»“æ„" class="headerlink" title="10.ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨æ ‘ç»“æ„"></a>10.ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨æ ‘ç»“æ„</h4><blockquote><p>å› ä¸ºæ ‘çš„ç»“æ„å¯ä»¥å¿«é€Ÿçš„æŠŠé—®é¢˜åˆ†è§£ï¼Œå¯ä»¥éå¸¸æœ‰æ•ˆçš„åŠ å¿«æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</p><p>æ ‘çš„ç»“æ„å¯ä»¥æŠŠä¸€ä¸ªå¤§é—®é¢˜åˆ†è€Œæ²»ä¹‹ï¼Œæå¤§çš„é™ä½äº†å¤æ‚åº¦ã€‚</p></blockquote><blockquote><p>ä½ çš„å›ç­”å¯¹â€œä¸ºä»€ä¹ˆç´¢å¼•ä½¿ç”¨æ ‘ç»“æ„â€è¿™ä¸€é—®é¢˜ç»™å‡ºäº†ä¸€äº›åŸºæœ¬çš„ç†ç”±ï¼Œä½†æ²¡æœ‰æ·±å…¥è¯´æ˜æ ‘ç»“æ„çš„å…·ä½“ä¼˜åŠ¿ä»¥åŠä¸ºä½•å®ƒç‰¹åˆ«é€‚ç”¨äºæ•°æ®åº“ç´¢å¼•ã€‚ä»¥ä¸‹æ˜¯å¯¹ä½ å›ç­”çš„è¯„åˆ†åŠè¯¦ç»†è¡¥å……ã€‚</p><h3 id="è¯„åˆ†ï¼š5-10"><a href="#è¯„åˆ†ï¼š5-10" class="headerlink" title="è¯„åˆ†ï¼š5&#x2F;10"></a>è¯„åˆ†ï¼š5&#x2F;10</h3><h3 id="è¯„åˆ†è¯´æ˜ï¼š-1"><a href="#è¯„åˆ†è¯´æ˜ï¼š-1" class="headerlink" title="è¯„åˆ†è¯´æ˜ï¼š"></a>è¯„åˆ†è¯´æ˜ï¼š</h3><ol><li><strong>æ­£ç¡®æ€§</strong>ï¼šä½ çš„å›ç­”åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºæ ‘ç»“æ„ç¡®å®æœ‰åŠ©äºæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†å›ç­”è¿‡äºç¬¼ç»Ÿï¼Œæœªèƒ½è¯¦ç»†é˜è¿°æ ‘ç»“æ„çš„å…·ä½“ä¼˜åŠ¿ã€‚</li><li><strong>è¯¦ç»†ç¨‹åº¦</strong>ï¼šæœªæ¶‰åŠæ ‘ç»“æ„çš„å…·ä½“ç±»å‹ï¼ˆå¦‚B-Treeï¼‰çš„ç»†èŠ‚å’Œå®ƒä»¬å¦‚ä½•æ”¹å–„ç´¢å¼•æ€§èƒ½ã€‚</li></ol><h3 id="æ­£ç¡®ç­”æ¡ˆè¡¥å……ï¼š-1"><a href="#æ­£ç¡®ç­”æ¡ˆè¡¥å……ï¼š-1" class="headerlink" title="æ­£ç¡®ç­”æ¡ˆè¡¥å……ï¼š"></a>æ­£ç¡®ç­”æ¡ˆè¡¥å……ï¼š</h3><h4 id="ä¸ºä»€ä¹ˆç´¢å¼•ä½¿ç”¨æ ‘ç»“æ„"><a href="#ä¸ºä»€ä¹ˆç´¢å¼•ä½¿ç”¨æ ‘ç»“æ„" class="headerlink" title="ä¸ºä»€ä¹ˆç´¢å¼•ä½¿ç”¨æ ‘ç»“æ„"></a>ä¸ºä»€ä¹ˆç´¢å¼•ä½¿ç”¨æ ‘ç»“æ„</h4><ol><li><p><strong>é«˜æ•ˆçš„æŸ¥æ‰¾æ€§èƒ½</strong>ï¼š</p><ul><li><strong>B-Treeï¼ˆå¹³è¡¡æ ‘ï¼‰</strong>ï¼šåœ¨MySQLä¸­ï¼Œæœ€å¸¸ç”¨çš„ç´¢å¼•ç»“æ„æ˜¯B-Treeï¼ˆå¹³è¡¡æ ‘ï¼‰ã€‚B-Treeèƒ½å¤Ÿä¿æŒæ•°æ®çš„æœ‰åºæ€§ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œä½¿å¾—æŸ¥æ‰¾æ“ä½œçš„å¤æ‚åº¦ä¿æŒåœ¨å¯¹æ•°çº§åˆ«O(log N)ã€‚è¿™ç§ç»“æ„æ”¯æŒé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢å’Œæ’åºæ“ä½œã€‚</li><li><strong>R-Treeï¼ˆçŸ©å½¢æ ‘ï¼‰</strong>ï¼šç”¨äºç©ºé—´æ•°æ®ï¼ˆå¦‚åœ°ç†ä¿¡æ¯ç³»ç»Ÿä¸­çš„æ•°æ®ï¼‰ã€‚R-Treeæ”¯æŒé«˜æ•ˆçš„å¤šç»´èŒƒå›´æŸ¥è¯¢ï¼Œéå¸¸é€‚åˆå¤„ç†ç©ºé—´æ•°æ®ã€‚</li></ul></li><li><p><strong>åˆ†å±‚ç»“æ„</strong>ï¼š</p><ul><li>æ ‘ç»“æ„çš„åˆ†å±‚ç‰¹æ€§ä½¿å¾—æŸ¥è¯¢èƒ½å¤Ÿé€šè¿‡é€å±‚è®¿é—®æ¥å‡å°‘éœ€è¦æ£€æŸ¥çš„æ•°æ®é‡ã€‚ä¾‹å¦‚ï¼Œåœ¨B-Treeä¸­ï¼Œæ¯ä¸€å±‚éƒ½å°†æ•°æ®åˆ†å‰²æˆæ›´å°çš„å­é›†ï¼Œä»è€Œå¿«é€Ÿç¼©å°æœç´¢èŒƒå›´ã€‚</li></ul></li><li><p><strong>åŠ¨æ€å¹³è¡¡</strong>ï¼š</p><ul><li><strong>è‡ªå¹³è¡¡</strong>ï¼šB-Treeæ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„æ ‘ç»“æ„ï¼Œç¡®ä¿æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€æ·±åº¦ï¼Œä»è€Œä½¿å¾—æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¿æŒåœ¨O(log N)ã€‚</li><li><strong>æ’å…¥å’Œåˆ é™¤</strong>ï¼šæ ‘ç»“æ„æ”¯æŒé«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼ŒåŒæ—¶ä¿æŒæ ‘çš„å¹³è¡¡ï¼Œä»è€Œä¸ä¼šæ˜¾è‘—é™ä½æŸ¥è¯¢æ€§èƒ½ã€‚</li></ul></li><li><p><strong>å‡å°‘ç£ç›˜I&#x2F;O</strong>ï¼š</p><ul><li><strong>ç´¢å¼•é¡µå’ŒèŠ‚ç‚¹</strong>ï¼šæ ‘ç»“æ„çš„ç´¢å¼•é€šå¸¸åˆ†ä¸ºå¤šä¸ªé¡µæˆ–èŠ‚ç‚¹ï¼Œè¿™æ ·å¯ä»¥å°†å¤§é‡æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªé¡µä¸­ï¼Œè€Œä¸æ˜¯åœ¨ä¸€ä¸ªå¤§å—ä¸­å­˜å‚¨ã€‚è¿™ç§è®¾è®¡å‡å°‘äº†ç£ç›˜I&#x2F;Oï¼Œå› ä¸ºæŸ¥è¯¢æ—¶åªéœ€è¦è®¿é—®å°‘é‡çš„é¡µæˆ–èŠ‚ç‚¹ã€‚</li><li><strong>ç¼“å­˜æ•ˆç‡</strong>ï¼šæ ‘ç»“æ„èƒ½åˆ©ç”¨ç¼“å­˜ï¼Œå‡å°‘ç£ç›˜è®¿é—®æ¬¡æ•°ï¼Œä»è€Œæé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</li></ul></li><li><p><strong>æ”¯æŒå¤šç§æ“ä½œ</strong>ï¼š</p><ul><li><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼šæ ‘ç»“æ„ç‰¹åˆ«é€‚åˆèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚æ‰¾å‡ºä»‹äºä¸¤ä¸ªå€¼ä¹‹é—´çš„æ‰€æœ‰è®°å½•ï¼‰ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°èµ·å§‹å€¼å’Œç»“æŸå€¼ä¹‹é—´çš„æ•°æ®ã€‚</li><li><strong>æ’åºå’Œèšåˆ</strong>ï¼šæ ‘ç»“æ„æ”¯æŒé«˜æ•ˆçš„æ’åºæ“ä½œï¼Œå› ä¸ºæ•°æ®å·²ç»æŒ‰é¡ºåºå­˜å‚¨ã€‚</li></ul></li></ol><h3 id="æ€»ç»“ï¼š-3"><a href="#æ€»ç»“ï¼š-3" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>æ ‘ç»“æ„ï¼ˆå°¤å…¶æ˜¯B-Treeï¼‰å› å…¶é«˜æ•ˆçš„æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤å’ŒèŒƒå›´æŸ¥è¯¢æ“ä½œï¼Œæˆä¸ºæ•°æ®åº“ç´¢å¼•çš„ä¸»è¦é€‰æ‹©ã€‚æ ‘çš„å±‚çº§ç»“æ„å’Œè‡ªå¹³è¡¡ç‰¹æ€§èƒ½å¤Ÿæœ‰æ•ˆæé«˜æ•°æ®è®¿é—®çš„æ•ˆç‡ï¼ŒåŒæ—¶å‡å°‘ç£ç›˜I&#x2F;Oï¼Œæé«˜æ•´ä½“æ€§èƒ½ã€‚ç†è§£è¿™äº›ç»†èŠ‚å¯ä»¥å¸®åŠ©ä½ åœ¨é¢è¯•ä¸­æä¾›æ›´æ·±å…¥çš„å›ç­”ã€‚</p></blockquote><blockquote><p>å› ä¸ºå¯ä»¥åŠ å¿«æŸ¥è¯¢æ•ˆç‡ï¼Œè€Œä¸”å¯ä»¥ä¿æŒæœ‰åºã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>62 åŠ å¯†ç®—æ³•</title>
      <link href="/2025/02/26/62%20%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"/>
      <url>/2025/02/26/62%20%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="62-åŠ å¯†ç®—æ³•"><a href="#62-åŠ å¯†ç®—æ³•" class="headerlink" title="62 åŠ å¯†ç®—æ³•"></a>62 åŠ å¯†ç®—æ³•</h1><p>ä¸‰ç§åŠ å¯†ç®—æ³•åˆ†ç±»ï¼š</p><ul><li>å¯¹ç§°åŠ å¯†ï¼šå¯†é’¥åªæœ‰ä¸€ä¸ªï¼Œè§£å¯†ã€è§£å¯†éƒ½æ˜¯è¿™ä¸ªå¯†ç ï¼ŒåŠ è§£å¯†é€Ÿåº¦å¿«ï¼Œå…¸å‹çš„å¯¹ç§°åŠ å¯†æœ‰<strong>DES</strong>ã€<strong>AES</strong>ã€<strong>RC4</strong>ç­‰</li><li>éå¯¹ç§°åŠ å¯†ï¼šå¯†é’¥æˆå¯¹å‡ºç°ï¼Œåˆ†åˆ«ä¸ºå…¬é’¥å’Œ<a href="https://so.csdn.net/so/search?q=%E7%A7%81%E9%92%A5&spm=1001.2101.3001.7020">ç§é’¥</a>ï¼Œä»å…¬é’¥æ— æ³•æ¨çŸ¥ç§é’¥ï¼Œåä¹‹ï¼Œä»ç§é’¥ä¹Ÿæ— æ³•æ¨çŸ¥å…¬é’¥ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼Œå…¬é’¥åŠ å¯†éœ€è¦ç§é’¥è§£å¯†ï¼Œåä¹‹ï¼Œç§é’¥åŠ å¯†éœ€è¦å…¬é’¥è§£å¯†ã€‚éå¯¹ç§°åŠ å¯†é€Ÿåº¦è¾ƒæ…¢ï¼Œå…¸å‹çš„éå¯¹ç§°ç®—æ³•æœ‰ï¼š<strong>RSA,DSA,DSS</strong>.</li><li>Hashç®—æ³•ï¼šè¿™æ˜¯ä¸€ç§ä¸å¯é€†çš„ç®—æ³•ï¼Œå®ƒå¸¸ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</li></ul><p>é’ˆå¯¹æ‹¥æœ‰å¯†é’¥çš„æ•°é‡æ¥åˆ†ç±»ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹æ‹¥æœ‰ä¸€æ ·çš„å¯†é’¥ï¼Œç”¨è¿™ä¸ªå¯†é’¥è¿›è¡ŒåŠ å¯†è§£å¯†çš„è¯å°±æ˜¯å¯¹ç§°åŠ å¯†ã€‚å¦‚æœæ‹¥æœ‰ä¸¤ä¸ªå¯†é’¥çš„è¯ï¼Œåˆ†ä¸ºç§é’¥å’Œå…¬é’¥</p><h2 id="æ‘˜è¦ç®—æ³•"><a href="#æ‘˜è¦ç®—æ³•" class="headerlink" title="æ‘˜è¦ç®—æ³•"></a>æ‘˜è¦ç®—æ³•</h2><p>æ‘˜è¦ç®—æ³•æ˜¯ä¸€ç±»ç”¨äºç”Ÿæˆå›ºå®šé•¿åº¦çš„æ‘˜è¦æˆ–å“ˆå¸Œå€¼çš„ç®—æ³•ï¼Œå…¶æ ¸å¿ƒç›®çš„æ˜¯å°†ä»»æ„é•¿åº¦çš„æ•°æ®é€šè¿‡è®¡ç®—è½¬åŒ–ä¸ºä¸€ä¸ªç®€çŸ­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆæ‘˜è¦ï¼‰ã€‚æ‘˜è¦ç®—æ³•çš„ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š</p><ol><li><strong>å›ºå®šé•¿åº¦è¾“å‡º</strong>ï¼šæ— è®ºè¾“å…¥æ•°æ®çš„é•¿åº¦å¤šé•¿ï¼Œæ‘˜è¦ç®—æ³•éƒ½ä¼šè¾“å‡ºå›ºå®šé•¿åº¦çš„å“ˆå¸Œå€¼ï¼Œä¾‹å¦‚MD5ç”Ÿæˆ128ä½çš„å“ˆå¸Œå€¼ï¼ŒSHA-256ç”Ÿæˆ256ä½çš„å“ˆå¸Œå€¼ã€‚</li><li><strong>é«˜æ•ˆæ€§</strong>ï¼šæ‘˜è¦ç®—æ³•çš„è®¡ç®—é€Ÿåº¦é€šå¸¸å¾ˆå¿«ï¼Œå³ä½¿é¢å¯¹å¤§è§„æ¨¡æ•°æ®ï¼Œç”Ÿæˆå“ˆå¸Œå€¼çš„è¿‡ç¨‹ä¹Ÿååˆ†é«˜æ•ˆã€‚</li><li><strong>ä¸å¯é€†æ€§</strong>ï¼šæ‘˜è¦ç®—æ³•æ˜¯å•å‘çš„ï¼Œæ— æ³•ä»å“ˆå¸Œå€¼é€†å‘æ¨å¯¼å‡ºåŸå§‹æ•°æ®ã€‚è¿™ä½¿å¾—æ‘˜è¦ç®—æ³•åœ¨å¯†ç å­¦ä¸­å¸¸ç”¨äºæ•°æ®çš„å®Œæ•´æ€§æ ¡éªŒå’Œæ•°å­—ç­¾åã€‚</li><li><strong>æŠ—ç¢°æ’æ€§</strong>ï¼šå¥½çš„æ‘˜è¦ç®—æ³•åº”è¯¥å¾ˆéš¾æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„è¾“å…¥æ•°æ®äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œè¿™ç§ç‰¹æ€§ç§°ä¸ºæŠ—ç¢°æ’æ€§ã€‚å¸¸è§çš„æ‘˜è¦ç®—æ³•åŒ…æ‹¬MD5ã€SHA-1ã€SHA-256ç­‰ã€‚</li></ol><p><strong>æ‘˜è¦ç®—æ³•ç®€å•çš„æ¥è¯´å°±æ˜¯æ— è®ºè¾“å…¥å¤šé•¿éƒ½ä¼šå°†è¾“å…¥åŠ å¯†æˆæŒ‡å®šé•¿åº¦çš„å“ˆå¸Œå€¼ã€‚</strong></p><h3 id="MD5åŠ å¯†"><a href="#MD5åŠ å¯†" class="headerlink" title="MD5åŠ å¯†"></a>MD5åŠ å¯†</h3><p>å‡†ç¡®æ¥è®²ï¼Œ<strong>MD5ä¸æ˜¯ä¸€ç§åŠ å¯†ç®—æ³•</strong>ï¼Œè€Œæ˜¯ä¸€ç§<strong>æ‘˜è¦ç®—æ³•</strong>ï¼ŒMD5èƒ½å°†æ˜æ–‡è¾“å‡ºä¸º128bitsçš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ª<strong>å­—ç¬¦ä¸²æ˜¯æ— æ³•å†è¢«è½¬æ¢æˆæ˜æ–‡çš„</strong>ã€‚æ‰€ä»¥è¯´å¦‚æœä½¿ç”¨äº†MD5åŠ å¯†ä¹‹åçš„å­—ç¬¦ä¸²æ˜¯æ— æ³•é€šè¿‡å¯†æ–‡å¾—åˆ°å…¶åŸæ¥çš„æ˜æ–‡çš„ã€‚è¿™ç§æ‘˜è¦ç®—æ³•ä¸€èˆ¬ç”¨äºæ•°å­—ç­¾åã€å¯†ç å‚¨å­˜å’Œæ•°æ®å®Œæ•´æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MD5</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆMD5</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encode</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] result = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            md.update(str.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            result = md.digest();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parseByte2HexStr(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†äºŒè¿›åˆ¶è½¬æ¢æˆåå…­è¿›åˆ¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> buf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">parseByte2HexStr</span><span class="params">(<span class="type">byte</span> buf[])</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buf.length; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> Integer.toHexString(buf[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">            <span class="keyword">if</span> (hex.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                hex = <span class="string">&#x27;0&#x27;</span> + hex;</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(hex.toUpperCase());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        MD5 md5=<span class="keyword">new</span> <span class="title class_">MD5</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;æµ‹è¯•test&quot;</span>;</span><br><span class="line">        System.out.println(md5.encode(content));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="SHA1ç®—æ³•"><a href="#SHA1ç®—æ³•" class="headerlink" title="SHA1ç®—æ³•"></a>SHA1ç®—æ³•</h3><p>SHA1ä¹Ÿæ˜¯å’ŒMD5ç±»ä¼¼çš„<strong>ä¿¡æ¯æ‘˜è¦ç®—æ³•</strong>ï¼Œä½†æ˜¯å®ƒæ¯”MD5æ›´åŠ å®‰å…¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SHA1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encode</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;SHA-1&quot;</span>);</span><br><span class="line">            md.update(str.getBytes(<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">            <span class="type">byte</span>[] digest = md.digest();</span><br><span class="line">            <span class="keyword">return</span> byteToHexString(digest);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">byteToHexString</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(Hex.encodeHex(bytes));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SHA1</span> <span class="variable">sha1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SHA1</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;æµ‹è¯•test&quot;</span>;</span><br><span class="line">        System.out.println(sha1.encode(content));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h2><h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><p>AESä»£è¡¨<strong>Advanced Encryption Standard</strong>ï¼Œå³é«˜çº§åŠ å¯†æ ‡å‡†ã€‚AESæ˜¯å¾ˆå¸¸è§çš„<strong>å¯¹ç§°åŠ å¯†ç®—æ³•</strong>ï¼Œæ‰€è°“å¯¹ç§°åŠ å¯†ï¼Œå°±æ˜¯<strong>é€šè¿‡å¯†é’¥åŠ å¯†åå¯ä»¥å†é€šè¿‡å¯†é’¥è§£å¯†</strong>ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å¯†é’¥ååˆ†é‡è¦ï¼Œå¦‚æœå¯†é’¥ä¸¢å¤±ï¼Œå°±æœ‰ä¿¡æ¯æ³„æ¼çš„é£é™©ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AES</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä¼ å…¥çš„æ˜æ–‡è½¬æ¢ä¸ºå¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pwd</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encode</span><span class="params">(String str,String pwd)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] result = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">KeyGenerator</span> <span class="variable">kgen</span> <span class="operator">=</span> KeyGenerator.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            <span class="type">SecureRandom</span> <span class="variable">random</span> <span class="operator">=</span> SecureRandom.getInstance(<span class="string">&quot;SHA1PRNG&quot;</span>);</span><br><span class="line">            random.setSeed(pwd.getBytes());</span><br><span class="line">            kgen.init(<span class="number">128</span>, random);</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> kgen.generateKey();</span><br><span class="line">            <span class="type">byte</span>[] enCodeFormat = secretKey.getEncoded();</span><br><span class="line">            <span class="type">SecretKeySpec</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(enCodeFormat, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºå¯†ç å™¨</span></span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">            cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line">            <span class="type">byte</span>[] byteContent = str.getBytes();</span><br><span class="line">            result = cipher.doFinal(byteContent);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> parseByte2HexStr(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä¼ å…¥çš„å¯†æ–‡è½¬æ¢ä¸ºæ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pwd</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decode</span><span class="params">(String str,String pwd)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] result = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] content = parseHexStr2Byte(str);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">KeyGenerator</span> <span class="variable">kgen</span> <span class="operator">=</span> KeyGenerator.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            <span class="type">SecureRandom</span> <span class="variable">random</span> <span class="operator">=</span> SecureRandom.getInstance(<span class="string">&quot;SHA1PRNG&quot;</span>);</span><br><span class="line">            random.setSeed(pwd.getBytes());</span><br><span class="line">            kgen.init(<span class="number">128</span>, random);</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> kgen.generateKey();</span><br><span class="line">            <span class="type">byte</span>[] enCodeFormat = secretKey.getEncoded();</span><br><span class="line">            <span class="type">SecretKeySpec</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(enCodeFormat, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºå¯†ç å™¨</span></span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">            cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">            result = cipher.doFinal(content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†äºŒè¿›åˆ¶è½¬æ¢æˆåå…­è¿›åˆ¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> buf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">parseByte2HexStr</span><span class="params">(<span class="type">byte</span> buf[])</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buf.length; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> Integer.toHexString(buf[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">            <span class="keyword">if</span> (hex.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                hex = <span class="string">&#x27;0&#x27;</span> + hex;</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(hex.toUpperCase());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†åå…­è¿›åˆ¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hexStr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] parseHexStr2Byte(String hexStr) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hexStr.length() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] result = <span class="keyword">new</span> <span class="title class_">byte</span>[hexStr.length() / <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; hexStr.length() / <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> Integer.parseInt(hexStr.substring(i * <span class="number">2</span>, i * <span class="number">2</span> + <span class="number">1</span>), <span class="number">16</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> Integer.parseInt(hexStr.substring(i * <span class="number">2</span> + <span class="number">1</span>, i * <span class="number">2</span> + <span class="number">2</span>), <span class="number">16</span>);</span><br><span class="line">            result[i] = (<span class="type">byte</span>) (high * <span class="number">16</span> + low);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AES</span> <span class="variable">aes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AES</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;æµ‹è¯•åŠ å¯†&quot;</span>;</span><br><span class="line">        <span class="comment">// AESçš„å¯†é’¥é•¿åº¦æœ€å¥½æ˜¯16ä½(ä¸æ˜¯å¿…é¡»)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;javayznbjavayznb&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ å¯†å‰ï¼š&quot;</span> + content);</span><br><span class="line">      <span class="type">String</span> <span class="variable">encodeResultStr</span> <span class="operator">=</span> aes.encode(content,pwd);</span><br><span class="line">      System.out.println(<span class="string">&quot;åŠ å¯†åï¼š&quot;</span> + encodeResultStr);</span><br><span class="line">      <span class="comment">// è§£å¯†</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">decodeResultStr</span> <span class="operator">=</span> aes.decode(encodeResultStr,pwd);</span><br><span class="line">      System.out.println(<span class="string">&quot;è§£å¯†åï¼š&quot;</span> + decodeResultStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h3><p>DESä¹Ÿæ˜¯ä¸€ç§<strong>å¯¹ç§°åŠ å¯†ç®—æ³•</strong>ï¼Œä½†æ˜¯åœ¨å®‰å…¨æ€§ã€æ•ˆç‡å’Œçµæ´»æ€§ä¸Šæ¯”AESç•¥å·®ï¼Œä½†æ˜¯ä¹Ÿèƒ½ä¿è¯å®‰å…¨ï¼ŒDESä¹Ÿéœ€è¦é€šè¿‡å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œé€šè¿‡å¯†é’¥è¿›è¡Œè§£å¯†ï¼Œå› æ­¤å¯†é’¥å¾ˆé‡è¦ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DES</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä¼ å…¥çš„æ˜æ–‡è½¬æ¢ä¸ºå¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pwd</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encode</span><span class="params">(String str,String pwd)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] result = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DESKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DESKeySpec</span>(pwd.getBytes());</span><br><span class="line">            <span class="type">SecretKeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> SecretKeyFactory.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">key</span> <span class="operator">=</span> keyFactory.generateSecret(keySpec);</span><br><span class="line"></span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">            cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line">            <span class="type">byte</span>[] byteContent = str.getBytes();</span><br><span class="line">            result = cipher.doFinal(byteContent);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> parseByte2HexStr(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä¼ å…¥çš„å¯†æ–‡è½¬æ¢ä¸ºæ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pwd</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decode</span><span class="params">(String str,String pwd)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] result = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] content = parseHexStr2Byte(str);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DESKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DESKeySpec</span>(pwd.getBytes());</span><br><span class="line">            <span class="type">SecretKeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> SecretKeyFactory.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">key</span> <span class="operator">=</span> keyFactory.generateSecret(keySpec);</span><br><span class="line"></span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">            cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">            result = cipher.doFinal(content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†äºŒè¿›åˆ¶è½¬æ¢æˆåå…­è¿›åˆ¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> buf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">parseByte2HexStr</span><span class="params">(<span class="type">byte</span> buf[])</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buf.length; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> Integer.toHexString(buf[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">            <span class="keyword">if</span> (hex.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                hex = <span class="string">&#x27;0&#x27;</span> + hex;</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(hex.toUpperCase());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†åå…­è¿›åˆ¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hexStr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] parseHexStr2Byte(String hexStr) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hexStr.length() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] result = <span class="keyword">new</span> <span class="title class_">byte</span>[hexStr.length() / <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; hexStr.length() / <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> Integer.parseInt(hexStr.substring(i * <span class="number">2</span>, i * <span class="number">2</span> + <span class="number">1</span>), <span class="number">16</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> Integer.parseInt(hexStr.substring(i * <span class="number">2</span> + <span class="number">1</span>, i * <span class="number">2</span> + <span class="number">2</span>), <span class="number">16</span>);</span><br><span class="line">            result[i] = (<span class="type">byte</span>) (high * <span class="number">16</span> + low);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DES</span> <span class="variable">des</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DES</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;æµ‹è¯•test&quot;</span>;</span><br><span class="line">        <span class="comment">// DESçš„å¯†é’¥é•¿åº¦å¿…é¡»æ˜¯8ä½(å°äº8ä½åˆ™ä¼šæŠ¥é”™ï¼Œ8ä½ä¹‹åå¯¹åŠ å¯†ç»“æœä¸ä¼šäº§ç”Ÿå½±å“)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;javayznb&quot;</span>;</span><br><span class="line">        <span class="comment">// åŠ å¯†</span></span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ å¯†å‰ï¼š&quot;</span> + content);</span><br><span class="line">        <span class="type">String</span> <span class="variable">encodeResultStr</span> <span class="operator">=</span> des.encode(content,pwd);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ å¯†åï¼š&quot;</span> + encodeResultStr);</span><br><span class="line">        <span class="comment">//è§£å¯†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">decodeResultStr</span> <span class="operator">=</span> des.decode(encodeResultStr,pwd);</span><br><span class="line">        System.out.println(<span class="string">&quot;è§£å¯†åï¼š&quot;</span> + decodeResultStr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h2><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p>RSAæ˜¯ç›®å‰æœ€å…·å½±å“åŠ›çš„å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºåŠ å¯†å’ŒéªŒç­¾ã€‚æ”¯ä»˜å®æ”¯ä»˜å¯¹æ¥æ—¶ç”¨çš„åŠ å¯†æ–¹å¼å°±æ˜¯RSAã€‚åœ¨RSAä¸­ï¼Œå­˜åœ¨ä¸€å¯¹å¯†é’¥ï¼Œåˆ†åˆ«ç§°ä¸ºå…¬é’¥å’Œç§é’¥ï¼Œé€šè¿‡ç§é’¥ç”±ä¸ªäººä¿å­˜ï¼Œå…¬é’¥å¯èƒ½å¤šäººæŒæœ‰ã€‚</p><p>RSAçš„ä¸»è¦åº”ç”¨åœºæ™¯å°±æ˜¯åŠ å¯†å’ŒéªŒç­¾ï¼ŒåŠ å¯†å°±ä¸ç”¨è¯´äº†ï¼ŒéªŒç­¾æ˜¯æŒ‡é€šè¿‡ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åï¼Œä½¿å¾—æ¶ˆæ¯æ— æ³•ç¯¡æ”¹å’Œä¼ªé€ ã€‚</p><p>åŠ å¯†æ–¹å¼ï¼šBä¼ åŠ å¯†æ•°æ®ç»™A</p><p>1ã€Aç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œç§é’¥è‡ªå·±ä¿ç•™ï¼Œå…¬é’¥ä»»ä½•äººå¯ä»¥è·å–ã€‚</p><p>2ã€Bæ‹¿åˆ°å…¬é’¥ï¼Œå°†æ•°æ®é€šè¿‡å…¬é’¥åŠ å¯†</p><p>3ã€Aæ”¶åˆ°å¯†æ–‡ï¼Œé€šè¿‡ç§é’¥è§£å¯†ã€‚</p><p>éªŒç­¾æ–¹å¼ï¼šAä¼ æ¶ˆæ¯ç»™B</p><p>1ã€Aç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œç§é’¥è‡ªå·±ä¿ç•™ï¼Œå…¬é’¥ä»»ä½•äººå¯ä»¥è·å–ã€‚</p><p>2ã€Aä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯åŠ ç­¾ï¼Œå¹¶å°†åŠ ç­¾åçš„æ¶ˆæ¯ä¼ ç»™Bã€‚</p><p>3ã€Bé€šè¿‡å…¬é’¥éªŒç­¾ï¼Œå¦‚æœè¿”å›æ˜¯trueåˆ™è¯´æ˜æ¶ˆæ¯æ˜¯Aå‘è¿‡æ¥çš„ä¸”æœªè¢«ç¯¡æ”¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRSA</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * RSAæœ€å¤§åŠ å¯†æ˜æ–‡å¤§å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_ENCRYPT_BLOCK</span> <span class="operator">=</span> <span class="number">117</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * RSAæœ€å¤§è§£å¯†å¯†æ–‡å¤§å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_DECRYPT_BLOCK</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†é’¥å¯¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¯†é’¥å¯¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> KeyPair <span class="title function_">getKeyPair</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">KeyPairGenerator</span> <span class="variable">generator</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        generator.initialize(<span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">return</span> generator.generateKeyPair();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç§é’¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey ç§é’¥å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PrivateKey <span class="title function_">getPrivateKey</span><span class="params">(String privateKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] decodedKey = Base64.decodeBase64(privateKey.getBytes());</span><br><span class="line">        <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(decodedKey);</span><br><span class="line">        <span class="keyword">return</span> keyFactory.generatePrivate(keySpec);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å…¬é’¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey å…¬é’¥å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PublicKey <span class="title function_">getPublicKey</span><span class="params">(String publicKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] decodedKey = Base64.decodeBase64(publicKey.getBytes());</span><br><span class="line">        <span class="type">X509EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(decodedKey);</span><br><span class="line">        <span class="keyword">return</span> keyFactory.generatePublic(keySpec);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * RSAåŠ å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data å¾…åŠ å¯†æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey å…¬é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encrypt</span><span class="params">(String data, PublicKey publicKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, publicKey);</span><br><span class="line">        <span class="type">int</span> <span class="variable">inputLen</span> <span class="operator">=</span> data.getBytes().length;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] cache;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// å¯¹æ•°æ®åˆ†æ®µåŠ å¯†</span></span><br><span class="line">        <span class="keyword">while</span> (inputLen - offset &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputLen - offset &gt; MAX_ENCRYPT_BLOCK) &#123;</span><br><span class="line">                cache = cipher.doFinal(data.getBytes(), offset, MAX_ENCRYPT_BLOCK);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cache = cipher.doFinal(data.getBytes(), offset, inputLen - offset);</span><br><span class="line">            &#125;</span><br><span class="line">            out.write(cache, <span class="number">0</span>, cache.length);</span><br><span class="line">            i++;</span><br><span class="line">            offset = i * MAX_ENCRYPT_BLOCK;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] encryptedData = out.toByteArray();</span><br><span class="line">        out.close();</span><br><span class="line">        <span class="comment">// è·å–åŠ å¯†å†…å®¹ä½¿ç”¨base64è¿›è¡Œç¼–ç ,å¹¶ä»¥UTF-8ä¸ºæ ‡å‡†è½¬åŒ–æˆå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="comment">// åŠ å¯†åçš„å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.encodeBase64String(encryptedData));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * RSAè§£å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data å¾…è§£å¯†æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey ç§é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decrypt</span><span class="params">(String data, PrivateKey privateKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">        <span class="type">byte</span>[] dataBytes = Base64.decodeBase64(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">inputLen</span> <span class="operator">=</span> dataBytes.length;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] cache;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// å¯¹æ•°æ®åˆ†æ®µè§£å¯†</span></span><br><span class="line">        <span class="keyword">while</span> (inputLen - offset &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputLen - offset &gt; MAX_DECRYPT_BLOCK) &#123;</span><br><span class="line">                cache = cipher.doFinal(dataBytes, offset, MAX_DECRYPT_BLOCK);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cache = cipher.doFinal(dataBytes, offset, inputLen - offset);</span><br><span class="line">            &#125;</span><br><span class="line">            out.write(cache, <span class="number">0</span>, cache.length);</span><br><span class="line">            i++;</span><br><span class="line">            offset = i * MAX_DECRYPT_BLOCK;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] decryptedData = out.toByteArray();</span><br><span class="line">        out.close();</span><br><span class="line">        <span class="comment">// è§£å¯†åçš„å†…å®¹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(decryptedData, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç­¾å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data å¾…ç­¾åæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey ç§é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç­¾å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">sign</span><span class="params">(String data, PrivateKey privateKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] keyBytes = privateKey.getEncoded();</span><br><span class="line">        <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(keyBytes);</span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">key</span> <span class="operator">=</span> keyFactory.generatePrivate(keySpec);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;MD5withRSA&quot;</span>);</span><br><span class="line">        signature.initSign(key);</span><br><span class="line">        signature.update(data.getBytes());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.encodeBase64(signature.sign()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒç­¾</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> srcData åŸå§‹å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey å…¬é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sign ç­¾å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦éªŒç­¾é€šè¿‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(String srcData, PublicKey publicKey, String sign)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] keyBytes = publicKey.getEncoded();</span><br><span class="line">        <span class="type">X509EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(keyBytes);</span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="type">PublicKey</span> <span class="variable">key</span> <span class="operator">=</span> keyFactory.generatePublic(keySpec);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;MD5withRSA&quot;</span>);</span><br><span class="line">        signature.initVerify(key);</span><br><span class="line">        signature.update(srcData.getBytes());</span><br><span class="line">        <span class="keyword">return</span> signature.verify(Base64.decodeBase64(sign.getBytes()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line">            <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> getKeyPair();</span><br><span class="line">            <span class="type">String</span> <span class="variable">privateKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.encodeBase64(keyPair.getPrivate().getEncoded()));</span><br><span class="line">            <span class="type">String</span> <span class="variable">publicKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.encodeBase64(keyPair.getPublic().getEncoded()));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§é’¥:&quot;</span> + privateKey);</span><br><span class="line">            System.out.println(<span class="string">&quot;å…¬é’¥:&quot;</span> + publicKey);</span><br><span class="line">            <span class="comment">// RSAåŠ å¯†</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;å¾…åŠ å¯†çš„æ–‡å­—å†…å®¹&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">encryptData</span> <span class="operator">=</span> encrypt(data, getPublicKey(publicKey));</span><br><span class="line">            System.out.println(<span class="string">&quot;åŠ å¯†åå†…å®¹:&quot;</span> + encryptData);</span><br><span class="line">            <span class="comment">// RSAè§£å¯†</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">decryptData</span> <span class="operator">=</span> decrypt(encryptData, getPrivateKey(privateKey));</span><br><span class="line">            System.out.println(<span class="string">&quot;è§£å¯†åå†…å®¹:&quot;</span> + decryptData);</span><br><span class="line">            <span class="comment">// RSAç­¾å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sign</span> <span class="operator">=</span> sign(data, getPrivateKey(privateKey));</span><br><span class="line">            System.out.println(<span class="string">&quot;åŠ ç­¾åï¼š&quot;</span>+sign);</span><br><span class="line">            <span class="comment">// RSAéªŒç­¾</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> verify(data, getPublicKey(publicKey), sign);</span><br><span class="line">            System.out.print(<span class="string">&quot;éªŒç­¾ç»“æœ:&quot;</span> + result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.print(<span class="string">&quot;åŠ è§£å¯†å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç­¾å</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262012537.png" alt="image-20240926220841354"></p><p>ç­¾åçš„ä½œç”¨å°±æ˜¯éªŒè¯ä¼ è¾“çš„æ¶ˆæ¯æ˜¯å¦è¢«äººä¿®æ”¹è¿‡äº†ã€‚</p><h2 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h2><p>Base64æ˜¯ä¸€ç§äºŒè¿›åˆ¶åˆ°æ–‡æœ¬çš„ç¼–ç æ–¹å¼ã€‚å¦‚æœè¦æ›´å…·ä½“ä¸€ç‚¹çš„è¯ï¼Œå¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ç§å°† byteæ•°ç»„ç¼–ç ä¸ºå­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œè€Œä¸”ç¼–ç å‡ºçš„å­—ç¬¦ä¸²åªåŒ…å«ASCIIåŸºç¡€å­—ç¬¦ã€‚</p><p>ä¾‹å¦‚å­—ç¬¦ä¸²ShuSheng007å¯¹åº”çš„Base64ä¸ºU2h1U2hlbmcwMDc&#x3D;ã€‚å…¶ä¸­é‚£ä¸ª&#x3D;æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯å¡«å……ç¬¦ï¼Œä¸€ä¼šå†è¯´ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯Base64ä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œå…¶ä»…ä»…æ˜¯ä¸€ç§ç¼–ç æ–¹å¼ï¼Œç®—æ³•ä¹Ÿæ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥ä¸èƒ½ä¾èµ–å®ƒè¿›è¡ŒåŠ å¯†ã€‚</p><h3 id="ä¸ºä»€ä¹ˆå«Base64ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå«Base64ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå«Base64ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå«Base64ï¼Ÿ</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262012038.png" alt="image-20240926222712149"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262012879.png" alt="image-20240926222721935"></p><p><strong>Base64å°±æ˜¯ä¸ºäº†è§£å†³å„ç³»ç»Ÿä»¥åŠä¼ è¾“åè®®ä¸­äºŒè¿›åˆ¶ä¸å…¼å®¹çš„é—®é¢˜è€Œç”Ÿçš„</strong></p>]]></content>
      
      
      <categories>
          
          <category> åŠ å¯†ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯†ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>65 åˆ‡é¢AOP</title>
      <link href="/2025/02/26/65%20%E5%88%87%E9%9D%A2AOP/"/>
      <url>/2025/02/26/65%20%E5%88%87%E9%9D%A2AOP/</url>
      
        <content type="html"><![CDATA[<h1 id="65-åˆ‡é¢AOP"><a href="#65-åˆ‡é¢AOP" class="headerlink" title="65 åˆ‡é¢AOP"></a>65 åˆ‡é¢AOP</h1><h2 id="åˆ‡é¢åŸºç¡€æ¦‚å¿µ"><a href="#åˆ‡é¢åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åˆ‡é¢åŸºç¡€æ¦‚å¿µ"></a>åˆ‡é¢åŸºç¡€æ¦‚å¿µ</h2><ul><li>AOPï¼šAspect Oriented Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚æ˜¯é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼ï¼ˆaspectjï¼‰æˆ–è€…<strong>è¿è¡ŒæœŸåŠ¨æ€ä»£ç†</strong>ï¼ˆSpringï¼‰å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„æŠ€æœ¯ã€‚</li></ul><blockquote><p>é¢è¯•é—®é¢˜ï¼š<br>Springçš„ä¸¤å¤§æ ¸å¿ƒæ˜¯ä»€ä¹ˆï¼šIoCå’ŒAOP<br>åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨<br>IoCï¼šæ§åˆ¶åè½¬ï¼Œç›®çš„ç”¨äºè§£è€¦ï¼Œåº•å±‚ä½¿ç”¨çš„æŠ€æœ¯æ˜¯åå°„+å·¥å‚æ¨¡å¼<br>AOPï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç›®çš„æ˜¯åœ¨ä¸ä¿®æ”¹ç›®æ ‡å¯¹è±¡æºç çš„æƒ…å†µä¸‹ï¼Œè¿›è¡ŒåŠŸèƒ½å¢å¼ºï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯åŠ¨æ€ä»£ç†æŠ€æœ¯</p></blockquote><ul><li>AOPä½œç”¨ï¼šä¸ä¿®æ”¹æºç çš„æƒ…å†µä¸‹ï¼Œè¿›è¡ŒåŠŸèƒ½å¢å¼ºï¼Œé€šè¿‡åŠ¨æ€ä»£ç†å®ç°çš„ï¼›</li><li>AOPçš„åº•å±‚æ˜¯é€šè¿‡<strong>åŠ¨æ€ä»£ç†</strong>å®ç°çš„ã€‚åœ¨è¿è¡ŒæœŸé—´ï¼Œé€šè¿‡ä»£ç†æŠ€æœ¯åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡æ–¹æ³•æ‰§è¡Œæ—¶è¿›è¡ŒåŠŸèƒ½çš„å¢å¼ºä»‹å…¥ï¼Œå†å»è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œä»è€Œå®ŒæˆåŠŸèƒ½å¢å¼ºã€‚</li></ul><blockquote><ul><li>å¸¸ç”¨çš„åŠ¨æ€ä»£ç†æŠ€æœ¯æœ‰ï¼š<ul><li>JDKçš„åŠ¨æ€ä»£ç†ï¼šåŸºäºæ¥å£å®ç°çš„</li><li>cglibçš„åŠ¨æ€ä»£ç†ï¼šåŸºäºå­ç±»å®ç°çš„</li></ul></li><li>Springçš„AOPé‡‡ç”¨äº†å“ªç§ä»£ç†æ–¹å¼ï¼Ÿ<ul><li>å¦‚æœç›®æ ‡å¯¹è±¡æœ‰æ¥å£ï¼Œå°±é‡‡ç”¨JDKçš„åŠ¨æ€ä»£ç†æŠ€æœ¯</li><li>å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰æ¥å£ï¼Œå°±é‡‡ç”¨cglibæŠ€æœ¯</li></ul></li></ul></blockquote><ul><li><p>AOPç›¸å…³æ¦‚å¿µ</p><ul><li><p>ç›®æ ‡å¯¹è±¡(Target)ï¼šè¦ä»£ç†çš„&#x2F;è¦å¢å¼ºçš„ç›®æ ‡å¯¹è±¡ã€‚</p></li><li><p>ä»£ç†å¯¹è±¡(Proxy)ï¼šç›®æ ‡å¯¹è±¡è¢«AOPç»‡å…¥å¢å¼ºåï¼Œå°±å¾—åˆ°ä¸€ä¸ªä»£ç†å¯¹è±¡</p></li><li><p>è¿æ¥ç‚¹(JoinPoint)ï¼šèƒ½å¤Ÿè¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œåœ¨Springé‡ŒæŒ‡çš„æ˜¯æ–¹æ³•ã€‚èƒ½å¢å¼ºçš„æ–¹æ³•</p></li><li><p>åˆ‡å…¥ç‚¹(PointCut)ï¼šè¦å¯¹å“ªäº›è¿æ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰ã€‚è¦å¢å¼ºçš„æ–¹æ³•</p></li><li><p>é€šçŸ¥&#x2F;å¢å¼º(Advice)ï¼šæ‹¦æˆªåˆ°è¿æ¥ç‚¹ä¹‹åè¦åšçš„äº‹æƒ…ã€‚å¦‚ä½•å¢å¼ºï¼Œé¢å¤–æ·»åŠ ä¸Šå»çš„åŠŸèƒ½å’Œèƒ½åŠ›</p></li><li><p>åˆ‡é¢(Aspect)ï¼šæ˜¯åˆ‡å…¥ç‚¹å’Œé€šçŸ¥çš„ç»“åˆã€‚ å‘Šè¯‰Springçš„AOPï¼šè¦å¯¹å“ªä¸ªæ–¹æ³•ï¼Œåšä»€ä¹ˆæ ·çš„å¢å¼º</p></li><li><p>ç»‡å…¥(Weaving)ï¼šæŠŠå¢å¼º&#x2F;é€šçŸ¥ åº”ç”¨åˆ° ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºä»£ç†å¯¹è±¡çš„è¿‡ç¨‹</p></li></ul></li></ul><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262014138.png" alt="image-20241009192332682" style="zoom: 25%;" /><ul><li>AOPé€šçŸ¥ç±»å‹<ul><li>@Before å‰ç½®é€šçŸ¥ é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰æ‰§è¡Œ</li><li>@After åç½®é€šçŸ¥ é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•ä¹‹åæ‰§è¡Œ</li><li>@Around ç¯ç»•é€šçŸ¥ å¯ä»¥åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰å’Œä¹‹åæ‰§è¡Œï¼Œå¯ä»¥æ›´æ”¹æ–¹æ³•æ‰§è¡Œä¹‹åçš„ç»“æœï¼Œè‡ªä¸»æ€§æœ€å¤§ï¼Œéœ€è¦æŒæ¡</li><li>@AfterReturning é€šçŸ¥æ–¹æ³•å°†åœ¨ç›®æ ‡æ–¹æ³•æ­£å¸¸ç»“æŸä¹‹åæ‰§è¡Œ</li><li>@AfterThrowing é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•çˆ†å‡ºå¼‚å¸¸ä¹‹åæ‰§è¡Œ</li></ul></li></ul><h2 id="åˆ‡é¢å¤±æ•ˆ"><a href="#åˆ‡é¢å¤±æ•ˆ" class="headerlink" title="åˆ‡é¢å¤±æ•ˆ"></a>åˆ‡é¢å¤±æ•ˆ</h2><p>é€šè¿‡ä¸Šé¢çš„è®¤è¯†æˆ‘ä»¬äº†è§£åˆ°AOPæ˜¯åŸºäºåŠ¨æ€ä»£ç†æ¥å®ç°çš„ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆä»£ç†å¯¹è±¡æ¥è¾¾åˆ°å¯¹ç›®æ ‡å¯¹è±¡ç›¸å…³æ–¹æ³•å¢å¼ºçš„ç›®çš„ã€‚ä½†æ˜¯ä¼šæœ‰ä¸€äº›æƒ…å†µå¯¼è‡´AOPå¤±æ•ˆã€‚æ‰€ä»¥ä¸ºäº†AOPèƒ½å¤Ÿæ­£å¸¸è°ƒç”¨ï¼Œå°±å¾—éœ€è¦é€šè¿‡ä»£ç†å¯¹è±¡è¿›è¡Œè°ƒç”¨ã€‚</p><h3 id="éSpringç®¡ç†çš„å¯¹è±¡"><a href="#éSpringç®¡ç†çš„å¯¹è±¡" class="headerlink" title="éSpringç®¡ç†çš„å¯¹è±¡"></a>éSpringç®¡ç†çš„å¯¹è±¡</h3><p>Springçš„AOPåªèƒ½æ‹¦æˆªç”±Springå®¹å™¨ç®¡ç†çš„Beanå¯¹è±¡ã€‚å¦‚æœæ‚¨ä½¿ç”¨äº†éå—Springç®¡ç†çš„å¯¹è±¡ï¼Œåˆ™AOPå°†æ— æ³•å¯¹å…¶è¿›è¡Œæ‹¦æˆª</p><h3 id="åŒä¸€ä¸ªBeanå†…éƒ¨æ–¹æ³•è°ƒç”¨"><a href="#åŒä¸€ä¸ªBeanå†…éƒ¨æ–¹æ³•è°ƒç”¨" class="headerlink" title="åŒä¸€ä¸ªBeanå†…éƒ¨æ–¹æ³•è°ƒç”¨"></a>åŒä¸€ä¸ªBeanå†…éƒ¨æ–¹æ³•è°ƒç”¨</h3><p>å¦‚æœä¸€ä¸ªBeanå†…éƒ¨çš„æ–¹æ³•ç›´æ¥è°ƒç”¨åŒä¸€ä¸ªBeanå†…éƒ¨çš„å¦ä¸€ä¸ªæ–¹æ³•ï¼ŒAOPå°†æ— æ³•æ‹¦æˆªè¿™ä¸ªå†…éƒ¨æ–¹æ³•è°ƒç”¨ã€‚å› ä¸ºAOPæ˜¯åŸºäºä»£ç†çš„ï¼Œåªæœ‰é€šè¿‡ä»£ç†å¯¹è±¡æ‰èƒ½è§¦å‘AOPæ‹¦æˆªã€‚</p><p>è¿™æ˜¯å› ä¸º AOP æ— æ³•æ‹¦æˆª <code>method2()</code> çš„ç›´æ¥è°ƒç”¨ï¼Œè€Œåªèƒ½æ‹¦æˆªé€šè¿‡ä»£ç†å¯¹è±¡è§¦å‘çš„æ–¹æ³•è°ƒç”¨ã€‚</p><h3 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•"></a><a href="https://so.csdn.net/so/search?q=%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95&spm=1001.2101.3001.7020">é™æ€æ–¹æ³•</a></h3><p>Springçš„AOPåªèƒ½æ‹¦æˆªéé™æ€æ–¹æ³•ã€‚å¦‚æœæ‚¨å°è¯•æ‹¦æˆªé™æ€æ–¹æ³•ï¼ŒAOPå°†æ— æ³•ç”Ÿæ•ˆã€‚</p><h3 id="finalæ–¹æ³•"><a href="#finalæ–¹æ³•" class="headerlink" title="finalæ–¹æ³•"></a>finalæ–¹æ³•</h3><p>AOPæ— æ³•æ‹¦æˆªfinalæ–¹æ³•ã€‚finalæ–¹æ³•æ˜¯ä¸å¯é‡å†™çš„ï¼Œå› æ­¤AOPæ— æ³•ç”Ÿæˆä»£ç†å¯¹è±¡æ¥æ‹¦æˆªè¿™äº›æ–¹æ³•ã€‚</p><p>ç›´æ¥åœ¨å¯¹è±¡å†…éƒ¨è°ƒç”¨æ–¹æ³•ï¼šå¦‚æœæ‚¨ç›´æ¥åœ¨å¯¹è±¡å†…éƒ¨è°ƒç”¨æ–¹æ³•è€Œä¸é€šè¿‡ä»£ç†å¯¹è±¡ï¼ŒAOPå°†æ— æ³•æ‹¦æˆªã€‚å› æ­¤ï¼Œå»ºè®®å§‹ç»ˆé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•ä»¥ç¡®ä¿AOPçš„ç”Ÿæ•ˆã€‚</p><h3 id="å¼‚æ­¥æ–¹æ³•"><a href="#å¼‚æ­¥æ–¹æ³•" class="headerlink" title="å¼‚æ­¥æ–¹æ³•"></a><a href="https://so.csdn.net/so/search?q=%E5%BC%82%E6%AD%A5%E6%96%B9%E6%B3%95&spm=1001.2101.3001.7020">å¼‚æ­¥æ–¹æ³•</a></h3><p>å¯¹äºä½¿ç”¨Springçš„å¼‚æ­¥ç‰¹æ€§ï¼ˆå¦‚@Asyncæ³¨è§£ï¼‰çš„æ–¹æ³•ï¼ŒAOPæ‹¦æˆªå™¨å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚è¿™æ˜¯å› ä¸ºå¼‚æ­¥æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æˆ–ä½¿ç”¨çº¿ç¨‹æ± ï¼ŒAOPæ‹¦æˆªå™¨æ— æ³•è·Ÿè¸ªåˆ°è¿™äº›æ–°çº¿ç¨‹ä¸­çš„æ–¹æ³•è°ƒç”¨ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šå¯¼è‡´AOPå¤±æ•ˆï¼š</strong></p><ul><li>éSpringç®¡ç†çš„å¯¹è±¡</li><li>ç§æœ‰æ–¹æ³•è°ƒç”¨</li><li>é™æ€æ–¹æ³•è°ƒç”¨</li><li>finalæ–¹æ³•è°ƒç”¨</li><li>ç±»å†…éƒ¨è‡ªè°ƒç”¨</li><li>å†…éƒ¨ç±»æ–¹æ³•è°ƒç”¨</li><li>å¼‚æ­¥æ–¹æ³•</li></ul><h2 id="åˆ‡é¢åº”ç”¨"><a href="#åˆ‡é¢åº”ç”¨" class="headerlink" title="åˆ‡é¢åº”ç”¨"></a>åˆ‡é¢åº”ç”¨</h2><p>ä¸ºäº†æ›´å¥½å¯¹AOPçš„ä½¿ç”¨æœ‰æ›´æ·±çš„äº†è§£ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ä¸‹é¢è¿™ä¸ªåœºæ™¯è¿›è¡Œå®ç°ï¼š</p><blockquote><p>ç°åœ¨åœ¨é¡¹ç›®ä¸­æœ‰ä¸€äº›æ¥å£éœ€è¦è¿›è¡Œæƒé™æ ¡éªŒï¼Œå³æŸäº›ç”¨æˆ·æ˜¯æ— æƒè®¿é—®è¿™ä¸ªæ¥å£çš„ï¼Œå¦‚æœæ— æƒé™åº”è¿›è¡Œæ‹¦æˆªã€‚åŒæ—¶è¿™ä¸ªæ¥å£å¾ˆé‡è¦ï¼Œåº”è¯¥é¿å…æŸäº›äººå‘˜è¿›è¡Œæ¶æ„çš„åˆ·æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œé˜²åˆ·ã€‚å¯¹æŸäº›æ¶æ„åˆ·çš„IPè¿›è¡Œå°ç¦ï¼Œå¹¶è¿›è¡Œé™æµï¼Œè¯·ä½ åŸºäºAOPæ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p></blockquote><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><p>é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆå°±éœ€è¦å†™ä¸€ä¸ªæ³¨è§£ï¼Œæ¥æ ‡è¯†è¿™ç§éœ€è¦è¿›è¡Œå¤„ç†çš„æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.PARAMETER)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CheckPermission &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä»‹ç»ä¸€ä¸‹å…ƒæ³¨è§£çš„æ¦‚å¿µ</p><h4 id="Retention"><a href="#Retention" class="headerlink" title="@Retention"></a>@Retention</h4><p><strong>ä¸­æ–‡ç¿»è¯‘ä¸ºä¿ç•™çš„æ„æ€ï¼Œæ ‡æ˜è‡ªå®šä¹‰æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸã€‚</strong></p><p>ä»ç¼–å†™Javaä»£ç åˆ°è¿è¡Œä¸»è¦å‘¨æœŸä¸ºæºæ–‡ä»¶â†’ Classæ–‡ä»¶ â†’ è¿è¡Œæ—¶æ•°æ®ï¼Œ@Retentionåˆ™æ ‡æ³¨äº†è‡ªå®šä¹‰æ³¨è§£çš„ä¿¡æ¯è¦ä¿ç•™åˆ°å“ªä¸ªé˜¶æ®µï¼Œåˆ†åˆ«å¯¹åº”çš„valueå–å€¼ä¸ºSOURCE â†’CLASSâ†’RUNTIMEã€‚</p><ol><li>SOURCE æºä»£ç javaæ–‡ä»¶ï¼Œç”Ÿæˆçš„classæ–‡ä»¶ä¸­å°±æ²¡æœ‰è¯¥ä¿¡æ¯äº†</li><li>CLASS classæ–‡ä»¶ä¸­ä¼šä¿ç•™æ³¨è§£ï¼Œä½†æ˜¯jvmåŠ è½½è¿è¡Œæ—¶å°±æ²¡æœ‰äº†</li><li>RUNTIME è¿è¡Œæ—¶ï¼Œå¦‚æœæƒ³ä½¿ç”¨åå°„è·å–æ³¨è§£ä¿¡æ¯ï¼Œåˆ™éœ€è¦ä½¿ç”¨RUNTIMEï¼Œåå°„æ˜¯åœ¨è¿è¡Œé˜¶æ®µè¿›è¡Œåå°„çš„</li><li>ç¤ºä¾‹ï¼šå½“RentionPolicyå–å€¼ä¸ºSOURCEæ—¶ï¼ŒClassæ–‡ä»¶ä¸­ä¸ä¼šä¿ç•™æ³¨è§£ä¿¡æ¯ï¼Œè€Œå–å€¼ä¸ºCLASSæ—¶ï¼ŒClassåç¼–è¯‘æ–‡ä»¶ä¸­åˆ™ä¿ç•™äº†æ³¨è§£çš„ä¿¡æ¯</li></ol><blockquote><ol><li>Sourceï¼šä¸€ä¸ªæœ€ç®€å•çš„ç”¨æ³•ï¼Œå°±æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ä¾‹å¦‚@ThreadSafeï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªç±»æ—¶çº¿ç¨‹å®‰å…¨çš„ï¼Œå°±å’Œæ³¨é‡Šçš„ä½œç”¨ä¸€æ ·ï¼Œä¸è¿‡æ›´å¼•äººæ³¨ç›®ç½¢äº†ã€‚</li><li>Classï¼šè¿™ä¸ªæœ‰å•¥ç”¨å‘¢ï¼Ÿä¸ªäººè§‰å¾—ä¸»è¦æ˜¯èµ·åˆ°æ ‡è®°ä½œç”¨ï¼Œè¿˜æ²¡æœ‰åšå®éªŒï¼Œä¾‹å¦‚æ ‡è®°ä¸€ä¸ª@Proxyï¼ŒJVMåŠ è½½æ—¶å°±ä¼šç”Ÿæˆå¯¹åº”çš„ä»£ç†ç±»ã€‚</li><li>Runtimeï¼šåå°„å®åœ¨è¿è¡Œé˜¶æ®µæ‰§è¡Œçš„ï¼Œé‚£ä¹ˆåªæœ‰Runtimeçš„ç”Ÿå‘½å‘¨æœŸæ‰ä¼šä¿ç•™åˆ°è¿è¡Œé˜¶æ®µï¼Œæ‰èƒ½è¢«åå°„è¯»å–ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ã€‚</li></ol></blockquote><h4 id="Target"><a href="#Target" class="headerlink" title="@Target"></a>@Target</h4><p>ä¸­æ–‡ç¿»è¯‘ä¸º<strong>ç›®æ ‡</strong>ï¼Œæè¿°è‡ªå®šä¹‰æ³¨è§£çš„ä½¿ç”¨èŒƒå›´ï¼Œå…è®¸è‡ªå®šä¹‰æ³¨è§£æ ‡æ³¨åœ¨å“ªäº›Javaå…ƒç´ ä¸Š(ç±»ã€æ–¹æ³•ã€å±æ€§ã€å±€éƒ¨å±æ€§ã€å‚æ•°â€¦)</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262014633.png" alt="image-20241009183033698"></p><h3 id="åˆ‡é¢"><a href="#åˆ‡é¢" class="headerlink" title="åˆ‡é¢"></a>åˆ‡é¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> SecurityAspect</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> æƒé™æ ¡éªŒ é™æµ é˜²åˆ· AOPåˆ‡é¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-10-09</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨äºè®°å½•æ¯ä¸ªIPçš„è¯·æ±‚æ—¶é—´æˆ³ï¼Œç”¨äºé™æµ</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;Long&gt;&gt; requestTimestamps = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨äºå°ç¦IPçš„åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; bannedIps = ConcurrentHashMap.newKeySet();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æµé˜ˆå€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_REQUESTS</span> <span class="operator">=</span> <span class="number">10</span>;  <span class="comment">// æœ€å¤šå…è®¸çš„è¯·æ±‚æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">TIME_WINDOW_MS</span> <span class="operator">=</span> <span class="number">10</span> * <span class="number">1000</span>; <span class="comment">// æ—¶é—´çª—å£ï¼Œ10ç§’</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡å…¥ç‚¹ æŒ‡å®šè¢«æ³¨è§£CheckPermissionæ ‡è®°çš„å°±æ˜¯è¿æ¥ç‚¹</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.fang.screw.communal.annotation.CheckPermission)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkPermission</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> å¯¹è¿æ¥ç‚¹è¿›è¡Œä¸šåŠ¡æ‰©å±• è¿›è¡Œé‰´æƒ é™æµ é˜²åˆ·ç­‰æ“ä½œ</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> proceedingJoinPoint</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> Object &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/9</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Around(&quot;checkPermission()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doPermissionCheck</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line">        <span class="type">String</span> <span class="variable">ipAddress</span> <span class="operator">=</span> request.getRemoteAddr();</span><br><span class="line">        <span class="type">UserPO</span> <span class="variable">userPO</span> <span class="operator">=</span> CurrentUserHolder.getUser();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥IPæ˜¯å¦è¢«å°ç¦</span></span><br><span class="line">        <span class="keyword">if</span> (bannedIps.contains(ipAddress)) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.failed(<span class="string">&quot;è¯¥IPå·²è¢«å°ç¦ï¼Œè¯·ç¨åå†è¯•ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éè¶…çº§ç®¡ç†å‘˜ä¸å¯ä»¥è®¿é—®è¯¥æ¥å£</span></span><br><span class="line">        <span class="keyword">if</span> (userPO.getUserType() != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.failed(<span class="string">&quot;æ— è®¿é—®æƒé™ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é™æµæœºåˆ¶</span></span><br><span class="line">        <span class="keyword">if</span> (isRequestTooFrequent(ipAddress)) &#123;</span><br><span class="line">            bannedIps.add(ipAddress);  <span class="comment">// å°ç¦è¯¥IP</span></span><br><span class="line">            log.warn(<span class="string">&quot;IP &#123;&#125; è¢«å°ç¦ï¼Œå› çŸ­æ—¶é—´å†…è¿‡å¤šè¯·æ±‚&quot;</span>, ipAddress);</span><br><span class="line">            <span class="keyword">return</span> R.failed(<span class="string">&quot;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> proceedingJoinPoint.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> åˆ¤æ–­è¯·æ±‚æ˜¯å¦è¿‡äºé¢‘ç¹</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ipAddress</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> boolean &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/9</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isRequestTooFrequent</span><span class="params">(String ipAddress)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        requestTimestamps.putIfAbsent(ipAddress, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        List&lt;Long&gt; timestamps = requestTimestamps.get(ipAddress);</span><br><span class="line"></span><br><span class="line">        timestamps.add(currentTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¸…ç†è¶…è¿‡æ—¶é—´çª—å£çš„è¯·æ±‚</span></span><br><span class="line">        timestamps.removeIf(timestamp -&gt; currentTime - timestamp &gt; TIME_WINDOW_MS);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> timestamps.size() &gt; MAX_REQUESTS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰åˆ‡ç‚¹</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.example.service.BankService.transfer(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transferPointcut</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Before é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;transferPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logBeforeTransfer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[Before] Starting transfer...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Around é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Around(&quot;transferPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logAroundTransfer</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[Around] Before proceeding with transfer...&quot;</span>);</span><br><span class="line">        Object result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">            System.out.println(<span class="string">&quot;[Around] Transfer completed successfully.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[Around] Exception during transfer: &quot;</span> + throwable.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> throwable;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// After é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@After(&quot;transferPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logAfterTransfer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[After] Transfer process finished.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æƒé™æ³¨è§£çš„ä½¿ç”¨"><a href="#æƒé™æ³¨è§£çš„ä½¿ç”¨" class="headerlink" title="æƒé™æ³¨è§£çš„ä½¿ç”¨"></a>æƒé™æ³¨è§£çš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span> æŸ¥è¯¢åˆ†ç±»æ–‡ç« List</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> PoetryResult&lt;Map&lt;Integer,List&lt;ArticleVO&gt;&gt;&gt; &#125;</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Date</span> 2024/9/22</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@CheckPermission</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getListSortArticle&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Map&lt;Integer, List&lt;ArticleVO&gt;&gt;&gt; <span class="title function_">getListSortArticle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> articleService.getListSortArticle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>69 é¢è¯•é—®é¢˜</title>
      <link href="/2025/02/26/69%20%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/"/>
      <url>/2025/02/26/69%20%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="69-é¢è¯•é—®é¢˜"><a href="#69-é¢è¯•é—®é¢˜" class="headerlink" title="69 é¢è¯•é—®é¢˜"></a>69 é¢è¯•é—®é¢˜</h1><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262020131.png" alt="image-20241013163238468"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262020815.png" alt="image-20241013163413830"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262020173.png" alt="image-20241013163845516"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262020735.png" alt="image-20241013164727417"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262020350.png" alt="image-20241020165340083"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262020380.png" alt="image-20241020165411519"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262021408.png" alt="image-20241020165501557"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262021328.png" alt="image-20241020165559021"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262021368.png" alt="image-20241020165701542"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262021633.png" alt="image-20241020165816955"></p><h2 id="2024å¹´10æœˆ14æ—¥é¢è¯•é¢˜"><a href="#2024å¹´10æœˆ14æ—¥é¢è¯•é¢˜" class="headerlink" title="2024å¹´10æœˆ14æ—¥é¢è¯•é¢˜"></a>2024å¹´10æœˆ14æ—¥é¢è¯•é¢˜</h2><h3 id="B-Treeä¸B-Treeçš„åŒºåˆ«ï¼ˆæ•°æ®ç»“æ„ï¼‰"><a href="#B-Treeä¸B-Treeçš„åŒºåˆ«ï¼ˆæ•°æ®ç»“æ„ï¼‰" class="headerlink" title="B -Treeä¸B+ Treeçš„åŒºåˆ«ï¼ˆæ•°æ®ç»“æ„ï¼‰"></a>B -Treeä¸B+ Treeçš„åŒºåˆ«ï¼ˆæ•°æ®ç»“æ„ï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262021135.png" alt="image-20241014151830648"></p><p><img src="/assets/image-20241014151844417.png" alt="image-20241014151844417"></p><h3 id="åˆ†å¸ƒå¼é”ï¼ˆåˆ†å¸ƒå¼ï¼‰"><a href="#åˆ†å¸ƒå¼é”ï¼ˆåˆ†å¸ƒå¼ï¼‰" class="headerlink" title="åˆ†å¸ƒå¼é”ï¼ˆåˆ†å¸ƒå¼ï¼‰"></a>åˆ†å¸ƒå¼é”ï¼ˆåˆ†å¸ƒå¼ï¼‰</h3><h3 id="MVCCï¼ˆæ•°æ®åº“ï¼‰"><a href="#MVCCï¼ˆæ•°æ®åº“ï¼‰" class="headerlink" title="MVCCï¼ˆæ•°æ®åº“ï¼‰"></a>MVCCï¼ˆæ•°æ®åº“ï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262021154.png" alt="image-20241014164927491"></p><h3 id="ç´¢å¼•å¤±æ•ˆï¼ˆæ•°æ®åº“ï¼‰"><a href="#ç´¢å¼•å¤±æ•ˆï¼ˆæ•°æ®åº“ï¼‰" class="headerlink" title="ç´¢å¼•å¤±æ•ˆï¼ˆæ•°æ®åº“ï¼‰"></a>ç´¢å¼•å¤±æ•ˆï¼ˆæ•°æ®åº“ï¼‰</h3><p>order byå¦‚ä½•å¤„ç†get</p><h3 id="æ…¢SQLä¼˜åŒ–ï¼ˆæ•°æ®åº“ï¼‰"><a href="#æ…¢SQLä¼˜åŒ–ï¼ˆæ•°æ®åº“ï¼‰" class="headerlink" title="æ…¢SQLä¼˜åŒ–ï¼ˆæ•°æ®åº“ï¼‰"></a>æ…¢SQLä¼˜åŒ–ï¼ˆæ•°æ®åº“ï¼‰</h3><p>ok</p><h3 id="åŠ¨æ€ä»£ç†ï¼ˆJavaï¼‰"><a href="#åŠ¨æ€ä»£ç†ï¼ˆJavaï¼‰" class="headerlink" title="åŠ¨æ€ä»£ç†ï¼ˆJavaï¼‰"></a>åŠ¨æ€ä»£ç†ï¼ˆJavaï¼‰</h3><p>JDK å’Œ CGLIB</p><h3 id="AOPå¤±æ•ˆåœºæ™¯ï¼ˆJavaï¼‰"><a href="#AOPå¤±æ•ˆåœºæ™¯ï¼ˆJavaï¼‰" class="headerlink" title="AOPå¤±æ•ˆåœºæ™¯ï¼ˆJavaï¼‰"></a>AOPå¤±æ•ˆåœºæ™¯ï¼ˆJavaï¼‰</h3><p><a href="https://blog.csdn.net/qq_62262918/article/details/135614540?ops_request_misc=%257B%2522request%255Fid%2522%253A%252235042DD7-DC5B-491B-8161-92EDA30973EE%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=35042DD7-DC5B-491B-8161-92EDA30973EE&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-135614540-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=AOP%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF%EF%BC%88Java%EF%BC%89&spm=1018.2226.3001.4187">Springçš„AOPå¤±æ•ˆåœºæ™¯è¯¦è§£</a></p><h3 id="ä¸ºä»€ä¹ˆMySQL-2000Wæ•°æ®ä¼šå¯¼è‡´æ€§èƒ½ä¸å¥½ï¼Œ2000wæ˜¯å¦‚ä½•è®¡ç®—å‡ºæ¥çš„å‘¢ï¼ˆæ•°æ®åº“ï¼‰"><a href="#ä¸ºä»€ä¹ˆMySQL-2000Wæ•°æ®ä¼šå¯¼è‡´æ€§èƒ½ä¸å¥½ï¼Œ2000wæ˜¯å¦‚ä½•è®¡ç®—å‡ºæ¥çš„å‘¢ï¼ˆæ•°æ®åº“ï¼‰" class="headerlink" title="ä¸ºä»€ä¹ˆMySQL 2000Wæ•°æ®ä¼šå¯¼è‡´æ€§èƒ½ä¸å¥½ï¼Œ2000wæ˜¯å¦‚ä½•è®¡ç®—å‡ºæ¥çš„å‘¢ï¼ˆæ•°æ®åº“ï¼‰"></a>ä¸ºä»€ä¹ˆMySQL 2000Wæ•°æ®ä¼šå¯¼è‡´æ€§èƒ½ä¸å¥½ï¼Œ2000wæ˜¯å¦‚ä½•è®¡ç®—å‡ºæ¥çš„å‘¢ï¼ˆæ•°æ®åº“ï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262021660.png" alt="image-20241014211802773"></p><h3 id="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆæ•°æ®åº“ï¼‰"><a href="#ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆæ•°æ®åº“ï¼‰" class="headerlink" title="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆæ•°æ®åº“ï¼‰"></a>ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆæ•°æ®åº“ï¼‰</h3><p>ok</p><h3 id="å¤šè¡¨è”åˆæŸ¥è¯¢æ—¶å¤§è¡¨joinå°è¡¨è¿˜æ˜¯å…¶å®ƒï¼ˆæ•°æ®åº“ï¼‰"><a href="#å¤šè¡¨è”åˆæŸ¥è¯¢æ—¶å¤§è¡¨joinå°è¡¨è¿˜æ˜¯å…¶å®ƒï¼ˆæ•°æ®åº“ï¼‰" class="headerlink" title="å¤šè¡¨è”åˆæŸ¥è¯¢æ—¶å¤§è¡¨joinå°è¡¨è¿˜æ˜¯å…¶å®ƒï¼ˆæ•°æ®åº“ï¼‰"></a>å¤šè¡¨è”åˆæŸ¥è¯¢æ—¶å¤§è¡¨joinå°è¡¨è¿˜æ˜¯å…¶å®ƒï¼ˆæ•°æ®åº“ï¼‰</h3><p><strong>é©±åŠ¨è¡¨ä¸è¢«é©±åŠ¨è¡¨</strong>ï¼šåœ¨JOINæ“ä½œä¸­ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªé©±åŠ¨è¡¨ï¼ˆå¤–å±‚è¡¨ï¼‰å’Œä¸€ä¸ªè¢«é©±åŠ¨è¡¨ï¼ˆå†…å±‚è¡¨ï¼‰ã€‚æ•°æ®åº“ä¼šä»é©±åŠ¨è¡¨å¼€å§‹æ‰«æï¼Œç„¶åæ ¹æ®JOINæ¡ä»¶åœ¨è¢«é©±åŠ¨è¡¨ä¸­æŸ¥æ‰¾åŒ¹é…çš„è®°å½•ã€‚</p><p><strong>ä¼˜å…ˆé€‰æ‹©å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨</strong>ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<strong>å°†å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨</strong>ï¼Œå¯ä»¥å‡å°‘æ‰«ææ¬¡æ•°å’Œå†…å­˜å ç”¨ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p><p>å›ç­”é”™è¯¯ä¸»è¦æ˜¯å¯¹SQLçš„æ‰§è¡Œæµç¨‹ä¸æ¸…æ¥šï¼Œå®ƒä¼šå…ˆFromï¼Œç„¶åJOIN è¿˜æ²¡åˆ°whereå‘¢ã€‚</p><p><strong>æ‰§è¡Œæ–¹å¼</strong>ï¼šå¯¹äºåµŒå¥—å¾ªç¯JOINï¼Œæ•°æ®åº“ä¼šå¯¹é©±åŠ¨è¡¨çš„æ¯ä¸€è¡Œï¼Œå»è¢«é©±åŠ¨è¡¨ä¸­æŸ¥æ‰¾åŒ¹é…çš„è¡Œã€‚</p><h3 id="äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ï¼ˆSpringï¼‰"><a href="#äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ï¼ˆSpringï¼‰" class="headerlink" title="äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ï¼ˆSpringï¼‰"></a>äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ï¼ˆSpringï¼‰</h3><p>ok</p><h3 id="Springäº‹åŠ¡ï¼ˆSpringï¼‰"><a href="#Springäº‹åŠ¡ï¼ˆSpringï¼‰" class="headerlink" title="Springäº‹åŠ¡ï¼ˆSpringï¼‰"></a>Springäº‹åŠ¡ï¼ˆSpringï¼‰</h3><p>ok</p><h3 id="æ•°æ®åº“ä¸­çš„æ—¥å¿—-Redo-logï¼ˆæ•°æ®åº“ï¼‰"><a href="#æ•°æ®åº“ä¸­çš„æ—¥å¿—-Redo-logï¼ˆæ•°æ®åº“ï¼‰" class="headerlink" title="æ•°æ®åº“ä¸­çš„æ—¥å¿— Redo logï¼ˆæ•°æ®åº“ï¼‰"></a>æ•°æ®åº“ä¸­çš„æ—¥å¿— Redo logï¼ˆæ•°æ®åº“ï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262021802.png" alt="image-20241014164927491"></p><h3 id="Springä¸­è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°ï¼ˆSpringï¼‰"><a href="#Springä¸­è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°ï¼ˆSpringï¼‰" class="headerlink" title="Springä¸­è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°ï¼ˆSpringï¼‰"></a>Springä¸­è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°ï¼ˆSpringï¼‰</h3>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>70 SpringBoot</title>
      <link href="/2025/02/26/70%20SpringBoot/"/>
      <url>/2025/02/26/70%20SpringBoot/</url>
      
        <content type="html"><![CDATA[<h1 id="70-SpringBoot"><a href="#70-SpringBoot" class="headerlink" title="70 SpringBoot"></a>70 SpringBoot</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://blog.csdn.net/twotwo22222/article/details/129260502?ops_request_misc=%257B%2522request%255Fid%2522%253A%25226608BE09-AE6D-4022-B438-12C181F2B760%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=6608BE09-AE6D-4022-B438-12C181F2B760&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-129260502-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=SpringBoot%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187">springBootå¸¸è§é¢è¯•é¢˜(2024æœ€æ–°)</a></li></ul><h2 id="è°ˆè°ˆä½ å¯¹SpringBootçš„ç†è§£"><a href="#è°ˆè°ˆä½ å¯¹SpringBootçš„ç†è§£" class="headerlink" title="è°ˆè°ˆä½ å¯¹SpringBootçš„ç†è§£"></a>è°ˆè°ˆä½ å¯¹SpringBootçš„ç†è§£</h2><p>SpringBootæ˜¯åœ¨Springçš„åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–Springå¼€å‘ç¹å¤šçš„é…ç½®ï¼Œå…¶é‡‡ç”¨çº¦å®šå¤§äºé…ç½®çš„ç†å¿µå¼€å‘äº†è®©å¼€å‘äººå‘˜å¿«é€Ÿå¼€å‘çš„æ¡†æ¶ã€‚è®©å¼€å‘äººå‘˜èƒ½å¤Ÿä»ç¹å¤šçš„é…ç½®ä¸­è§£æ”¾å‡ºæ¥ï¼Œæ›´å¤šçš„å…³æ³¨ä¸šåŠ¡ã€‚</p><h3 id="ä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨SpringBoot"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨SpringBoot" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨SpringBoot"></a>ä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨SpringBoot</h3><p>åœ¨å‰é¢æˆ‘ä»¬å¯¹SpringBootç†è§£ä¹‹åï¼Œè¿™ä¸ªé—®é¢˜å¾ˆå¥½å›ç­”ã€‚SpringBootç®€åŒ–äº†å¼€å‘äººå‘˜ç¹å¤šçš„é…ç½®ï¼Œå¼€å‘æ•ˆç‡å¤§å¹…åº¦æå‡ã€‚è§£å†³Mavenç‰ˆæœ¬ä¾èµ–ï¼Œå†…ç½®çš„Tomcatä¸éœ€è¦å…¶å®ƒå¤–ç½®çš„Tomcatã€‚</p><h2 id="Spring-Bootå¸¸ç”¨æ³¨è§£"><a href="#Spring-Bootå¸¸ç”¨æ³¨è§£" class="headerlink" title="Spring Bootå¸¸ç”¨æ³¨è§£"></a>Spring Bootå¸¸ç”¨æ³¨è§£</h2><ul><li>@SpringBootApplicationï¼š SpringBootConfigurationé…ç½®ç±»ã€componentScanæ‰«æåŒ…ã€EnableAutoConfigurationå¯¼å…¥å…¶ä»–é…ç½®ç±»</li><li>@RestControllerï¼š @ResponseBodyå’Œ@Controllerçš„ä½œç”¨ã€‚</li><li>@Component,@Service,@Controller,@Repositoryï¼š å°†ç±»æ³¨å…¥å®¹å™¨ã€‚</li><li>@GetMappingã€@PostMappingã€@PutMappingã€@DeleteMappingï¼š æ˜ å°„è¯·æ±‚ï¼Œåªèƒ½æ¥æ”¶çš„å¯¹åº”çš„è¯·æ±‚ã€‚</li><li>@AutoWiredï¼š æŒ‰ç…§ç±»å‹åŒ¹é…æ³¨å…¥ã€‚</li><li>@Qualifierï¼š å’ŒAutoWiredè”åˆä½¿ç”¨ï¼Œåœ¨æŒ‰ç…§ç±»å‹åŒ¹é…çš„åŸºç¡€ä¸Šï¼Œåœ¨æŒ‰ç…§åç§°åŒ¹é…ã€‚</li><li>@Resourceï¼š æŒ‰ç…§åç§°åŒ¹é…ä¾èµ–æ³¨å…¥ã€‚</li><li>@Beanï¼š ç”¨äºå°†æ–¹æ³•è¿”å›å€¼å¯¹è±¡æ”¾å…¥å®¹å™¨ã€‚</li><li>@RequestParamï¼š è·å–æŸ¥è¯¢å‚æ•°ã€‚å³url?name&#x3D;è¿™ç§å½¢å¼</li><li>@RequestBodyï¼š è¯¥æ³¨è§£ç”¨äºè·å–è¯·æ±‚ä½“æ•°æ®ï¼ˆbodyï¼‰,getæ²¡æœ‰è¯·æ±‚ä½“ï¼Œæ•…è€Œä¸€èˆ¬ç”¨äºpostè¯·æ±‚ã€‚@PathVariableï¼š è·å–è·¯å¾„å‚æ•°ã€‚å³url&#x2F;{id}è¿™ç§å½¢å¼ã€‚</li><li>@Valueï¼š å°†å¤–éƒ¨çš„å€¼åŠ¨æ€æ³¨å…¥åˆ° Bean ä¸­ã€‚<ul><li>@Value(â€œ${}â€)ï¼šå¯ä»¥è·å–é…ç½®æ–‡ä»¶çš„å€¼ã€‚</li><li>@Value(â€œ#{}â€)ï¼šè¡¨ç¤ºSpEl(Spring Expression Languageæ˜¯Springè¡¨è¾¾å¼è¯­è¨€ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œæ•°æ®ã€‚)è¡¨è¾¾å¼é€šå¸¸ç”¨æ¥è·å– bean çš„å±æ€§ï¼Œæˆ–è€…è°ƒç”¨ bean çš„æŸä¸ªæ–¹æ³•ã€‚</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>68 Netty</title>
      <link href="/2025/02/26/68%20Netty/"/>
      <url>/2025/02/26/68%20Netty/</url>
      
        <content type="html"><![CDATA[<h1 id="68-Netty"><a href="#68-Netty" class="headerlink" title="68 Netty"></a>68 Netty</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/qq_35190492/article/details/113174359?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522D07BDB48-FAA2-4E6E-86E3-A8188987EE2B%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=D07BDB48-FAA2-4E6E-86E3-A8188987EE2B&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-113174359-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=Netty&spm=1018.2226.3001.4187">ã€ç¡¬æ ¸ã€‘è‚äº†ä¸€æœˆçš„NettyçŸ¥è¯†ç‚¹</a></li><li></li></ol><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p><strong>Netty æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶</strong>ï¼Œç®€åŒ–äº† Java ç½‘ç»œç¼–ç¨‹ï¼Œé€‚ç”¨äºæ„å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</p><p>Netty æ˜¯åŸºäº Java NIO çš„å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œä½¿ç”¨ Netty å¯ä»¥å¿«é€Ÿå¼€å‘ç½‘ç»œåº”ç”¨ï¼ŒNetty æä¾›äº†é«˜å±‚æ¬¡çš„æŠ½è±¡æ¥ç®€åŒ– TCP å’Œ UDP æœåŠ¡å™¨çš„ç¼–ç¨‹ï¼Œä½†æ˜¯ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨åº•å±‚çš„ APIã€‚</p><p>Nettyæ˜¯ä¸€ä¸ªéé˜»å¡çš„IOå®¢æˆ·ç«¯æœåŠ¡å™¨æ¡†æ¶</p><p>é˜»å¡ï¼ˆBlockï¼‰ä¸éé˜»å¡ï¼ˆNon-Blockï¼‰</p><ul><li><p>é˜»å¡å’Œéé˜»å¡æ˜¯è¿›ç¨‹åœ¨è®¿é—®æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®æ˜¯å¦å‡†å¤‡å°±ç»ªçš„ä¸€ç§å¤„ç†æ–¹å¼ï¼Œå½“æ•°æ®æ²¡æœ‰å‡†å¤‡çš„æ—¶å€™ã€‚</p></li><li><p>é˜»å¡ï¼šå¾€å¾€éœ€è¦ç­‰å¾…ç¼“å†²åŒºä¸­çš„æ•°æ®å‡†å¤‡å¥½è¿‡åæ‰å¤„ç†å…¶ä»–çš„äº‹æƒ…ï¼Œå¦åˆ™ä¸€ç›´ç­‰å¾…åœ¨é‚£é‡Œã€‚</p></li><li><p>éé˜»å¡:å½“æˆ‘ä»¬çš„è¿›ç¨‹è®¿é—®æˆ‘ä»¬çš„æ•°æ®ç¼“å†²åŒºçš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å‡†å¤‡å¥½åˆ™ç›´æ¥è¿”å›ï¼Œä¸ä¼šç­‰å¾…ã€‚å¦‚æœæ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œä¹Ÿç›´æ¥è¿”å›ã€‚</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262018372.png" alt="image-20241010184412267"></p><ul><li><strong>Feign</strong> æ˜¯ä¸€ä¸ªç”¨äºè°ƒç”¨ RESTful API çš„åŒæ­¥æ¡†æ¶ï¼Œè°ƒç”¨æ–¹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ¥æ”¶åˆ°å“åº”ã€‚åœ¨æ¶ˆæ¯é˜Ÿåˆ—çš„åœºæ™¯ä¸­ï¼Œç”Ÿäº§è€…é€šå¸¸éœ€è¦éé˜»å¡åœ°å‘é€æ¶ˆæ¯ï¼Œä»¥æé«˜æ€§èƒ½å’Œååé‡ã€‚</li></ul><h3 id="Netty-æ ¸å¿ƒç»„ä»¶"><a href="#Netty-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="Netty æ ¸å¿ƒç»„ä»¶"></a>Netty æ ¸å¿ƒç»„ä»¶</h3><h4 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h4><p> Channelæ˜¯ Java NIO çš„ä¸€ä¸ªåŸºæœ¬æ„é€ ã€‚<strong>å¯ä»¥çœ‹ä½œæ˜¯ä¼ å…¥æˆ–ä¼ å‡ºæ•°æ®çš„è½½ä½“</strong>ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥è¢«æ‰“å¼€æˆ–å…³é—­ï¼Œè¿æ¥æˆ–è€…æ–­å¼€è¿æ¥ã€‚</p><h4 id="EventLoop-ä¸-EventLoopGroup"><a href="#EventLoop-ä¸-EventLoopGroup" class="headerlink" title="EventLoop ä¸ EventLoopGroup"></a>EventLoop ä¸ EventLoopGroup</h4><p> EventLoop å®šä¹‰äº†Nettyçš„æ ¸å¿ƒæŠ½è±¡ï¼Œç”¨æ¥å¤„ç†è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸä¸­æ‰€å‘ç”Ÿçš„äº‹ä»¶ï¼Œåœ¨å†…éƒ¨ï¼Œå°†ä¼šä¸ºæ¯<strong>ä¸ªChannelåˆ†é…ä¸€ä¸ªEventLoop</strong>ã€‚</p><p> EventLoopGroup æ˜¯ä¸€ä¸ª EventLoop æ± ï¼ŒåŒ…å«å¾ˆå¤šçš„ EventLoopã€‚</p><p> Netty ä¸ºæ¯ä¸ª Channel åˆ†é…äº†ä¸€ä¸ª EventLoopï¼Œç”¨äºå¤„ç†ç”¨æˆ·è¿æ¥è¯·æ±‚ã€å¯¹ç”¨æˆ·è¯·æ±‚çš„å¤„ç†ç­‰æ‰€æœ‰äº‹ä»¶ã€‚<strong>EventLoop æœ¬èº«åªæ˜¯ä¸€ä¸ªçº¿ç¨‹é©±åŠ¨ï¼Œåœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…åªä¼šç»‘å®šä¸€ä¸ªçº¿ç¨‹ï¼Œè®©è¯¥çº¿ç¨‹å¤„ç†ä¸€ä¸ª Channel çš„æ‰€æœ‰ IO äº‹ä»¶ã€‚</strong></p><p> ä¸€ä¸ª Channel ä¸€æ—¦ä¸ä¸€ä¸ª EventLoop ç›¸ç»‘å®šï¼Œé‚£ä¹ˆåœ¨ Channel çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…æ˜¯ä¸èƒ½æ”¹å˜çš„ã€‚ä¸€ä¸ª EventLoop å¯ä»¥ä¸å¤šä¸ª Channel ç»‘å®šã€‚å³ Channel ä¸ EventLoop çš„å…³ç³»æ˜¯ n:1ï¼Œè€Œ EventLoop ä¸çº¿ç¨‹çš„å…³ç³»æ˜¯ 1:1ã€‚</p><h4 id="ServerBootstrap-ä¸-Bootstrap"><a href="#ServerBootstrap-ä¸-Bootstrap" class="headerlink" title="ServerBootstrap ä¸ Bootstrap"></a>ServerBootstrap ä¸ Bootstrap</h4><p> Bootstarp å’Œ ServerBootstrap è¢«ç§°ä¸ºå¼•å¯¼ç±»ï¼ŒæŒ‡å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œé…ç½®ï¼Œå¹¶ä½¿ä»–è¿è¡Œèµ·æ¥çš„è¿‡ç¨‹ã€‚Nettyå¤„ç†å¼•å¯¼çš„æ–¹å¼æ˜¯ä½¿ä½ çš„åº”ç”¨ç¨‹åºå’Œç½‘ç»œå±‚ç›¸éš”ç¦»ã€‚</p><p> Bootstrap æ˜¯å®¢æˆ·ç«¯çš„å¼•å¯¼ç±»ï¼ŒBootstrap åœ¨è°ƒç”¨ bind()ï¼ˆè¿æ¥UDPï¼‰å’Œ connect()ï¼ˆè¿æ¥TCPï¼‰æ–¹æ³•æ—¶ï¼Œä¼šæ–°åˆ›å»ºä¸€ä¸ª Channelï¼Œä»…åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ã€æ²¡æœ‰çˆ¶ Channel çš„ Channel æ¥å®ç°æ‰€æœ‰çš„ç½‘ç»œäº¤æ¢ã€‚</p><p> <strong>ServerBootstrap æ˜¯æœåŠ¡ç«¯çš„å¼•å¯¼ç±»ï¼ŒServerBootstarp åœ¨è°ƒç”¨ bind() æ–¹æ³•æ—¶ä¼šåˆ›å»ºä¸€ä¸ª ServerChannel æ¥æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¹¶ä¸”è¯¥ ServerChannel ç®¡ç†äº†å¤šä¸ªå­ Channel ç”¨äºåŒå®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡ã€‚</strong></p><h4 id="ChannelHandler-ä¸-ChannelPipeline"><a href="#ChannelHandler-ä¸-ChannelPipeline" class="headerlink" title="ChannelHandler ä¸ ChannelPipeline"></a>ChannelHandler ä¸ ChannelPipeline</h4><p> ChannelHandler æ˜¯å¯¹ Channel ä¸­æ•°æ®çš„å¤„ç†å™¨ï¼Œè¿™äº›å¤„ç†å™¨å¯ä»¥æ˜¯ç³»ç»Ÿæœ¬èº«å®šä¹‰å¥½çš„ç¼–è§£ç å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ã€‚è¿™äº›å¤„ç†å™¨ä¼šè¢«ç»Ÿä¸€æ·»åŠ åˆ°ä¸€ä¸ª ChannelPipeline çš„å¯¹è±¡ä¸­ï¼Œç„¶åæŒ‰ç…§æ·»åŠ çš„é¡ºåºå¯¹ Channel ä¸­çš„æ•°æ®è¿›è¡Œä¾æ¬¡å¤„ç†ã€‚</p><h4 id="ChannelFuture"><a href="#ChannelFuture" class="headerlink" title="ChannelFuture"></a>ChannelFuture</h4><p> Netty ä¸­æ‰€æœ‰çš„ I&#x2F;O æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå³æ“ä½œä¸ä¼šç«‹å³å¾—åˆ°è¿”å›ç»“æœï¼Œæ‰€ä»¥ Netty ä¸­å®šä¹‰äº†ä¸€ä¸ª ChannelFuture å¯¹è±¡ä½œä¸ºè¿™ä¸ªå¼‚æ­¥æ“ä½œçš„â€œä»£è¨€äººâ€ï¼Œè¡¨ç¤ºå¼‚æ­¥æ“ä½œæœ¬èº«ã€‚å¦‚æœæƒ³è·å–åˆ°è¯¥å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼ï¼Œå¯ä»¥é€šè¿‡è¯¥å¼‚æ­¥æ“ä½œå¯¹è±¡çš„addListener() æ–¹æ³•ä¸ºè¯¥å¼‚æ­¥æ“ä½œæ·»åŠ ç›‘ NIO ç½‘ç»œç¼–ç¨‹æ¡†æ¶ Netty å¬å™¨ï¼Œä¸ºå…¶æ³¨å†Œå›è°ƒï¼šå½“ç»“æœå‡ºæ¥åé©¬ä¸Šè°ƒç”¨æ‰§è¡Œã€‚</p><p> Netty çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹éƒ½æ˜¯å»ºç«‹åœ¨ Future ä¸å›è°ƒæ¦‚å¿µä¹‹ä¸Šçš„ã€‚</p><h3 id="å¿ƒè·³"><a href="#å¿ƒè·³" class="headerlink" title="å¿ƒè·³"></a>å¿ƒè·³</h3><p>å› ä¸º Netty å»ºç«‹çš„æ˜¯<strong>é•¿è¿æ¥</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ä¸åœ¨ Client çš„ä»£ç ä¸­æ‰‹åŠ¨ <code>channel.close();</code> é‚£è¯¥è¿æ¥å°±ä¼šä¸€ç›´ä¿æŒç€ï¼Œç›´åˆ°å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ä¸€æ–¹å…³é—­ã€‚</p><p>ä¹Ÿä¸æ˜¯è¯´é•¿è¿æ¥å®ƒå°±ä¸å¥½ï¼Œä½†å¤§å®¶æƒ³æƒ³ï¼Œæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½ä¸€ç›´å ç€ä¸€ä¸ªè¿æ¥ï¼Œå³ä½¿å®ƒåé¢å·²ç»ç”¨ä¸åˆ°æœåŠ¡å™¨äº†ï¼Œè€ŒæœåŠ¡å™¨èƒ½æ‰¿å—çš„è¿æ¥æ•°æ˜¯æœ‰é™çš„ï¼Œåé¢å†æ¥äº†çœŸæ­£æœ‰éœ€æ±‚çš„ç”¨æˆ·ï¼Œå®ƒä¹Ÿè¿›ä¸æ¥äº†ï¼Œè€Œä¸”é•¿æ—¶é—´çš„é«˜å¹¶å‘ä¹Ÿå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®•æœºã€‚</p><p>æ‰€ä»¥ï¼Œæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ï¼Œå¦‚æœæˆ‘ä¸€æ®µæ—¶é—´ç”¨ä¸åˆ°æœåŠ¡å™¨ï¼Œå°±æŠŠè¿™ä¸ªè¿æ¥ç»™å…³æ‰ï¼Ÿç­”ï¼šå¿ƒè·³æœºåˆ¶ã€‚æ‰€è°“å¿ƒè·³ï¼Œå³åœ¨ TCP é•¿è¿æ¥ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®šæœŸå‘é€çš„ä¸€ç§ç‰¹æ®Šçš„æ•°æ®åŒ…ï¼ˆæ¯”å¦‚æ¶ˆæ¯å†…å®¹æ˜¯æŸç§è¦æ±‚æ ¼å¼ã€å†…å®¹ï¼‰ï¼Œé€šçŸ¥å¯¹æ–¹è‡ªå·±è¿˜åœ¨çº¿ï¼Œä»¥ç¡®ä¿ TCP è¿æ¥çš„æœ‰æ•ˆæ€§ã€‚</p><p>åœ¨ Netty ä¸­ï¼Œå®ç°å¿ƒè·³æœºåˆ¶çš„å…³é”®æ˜¯ IdleStateHandlerï¼ˆç©ºé—²çŠ¶æ€å¤„ç†å™¨ï¼‰ï¼Œå®ƒçš„ä½œç”¨è·Ÿåå­—ä¸€æ ·ï¼Œæ˜¯ç”¨æ¥ç›‘æµ‹è¿æ¥çš„ç©ºé—²æƒ…å†µã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å¿ƒè·³æƒ…å†µï¼Œæ¥å®ç°å…·ä½“çš„å¤„ç†é€»è¾‘ï¼Œæ¯”å¦‚è¯´æ–­å¼€è¿æ¥ã€é‡æ–°è¿æ¥ç­‰ç­‰ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Netty æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<strong>å¼‚æ­¥äº‹ä»¶é©±åŠ¨</strong>çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œå¹¿æ³›ç”¨äºå¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå¦‚åè®®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚ç®€å•æ¥è¯´è¿™ä¸ªæ¡†æ¶æ˜¯åŸºäº<strong>å¼‚æ­¥äº‹ä»¶é©±åŠ¨</strong>çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œè¿™é‡Œæœ€é‡è¦çš„ä¸€ä¸ªç‚¹æ˜¯äº‹ä»¶é©±åŠ¨ã€‚</p><p>ä½•ä¸ºäº‹ä»¶é©±åŠ¨å‘¢ï¼Ÿäº‹ä»¶é©±åŠ¨å°±æ˜¯æŒ‡å®ƒçš„æœåŠ¡é€»è¾‘éƒ½æ˜¯é’ˆå¯¹å‘ç”Ÿçš„äº‹ä»¶æ¥è§¦å‘çš„ï¼Œä¸€æ—¦æŸä¸ªäº‹ä»¶å‘ç”Ÿäº†ï¼Œå°±ä¼šè§¦å‘è¯¥æ—¶é—´çš„å¤„ç†é€»è¾‘ã€‚æ¯”å¦‚å»ºç«‹è¿æ¥ã€æ•°æ®è¯»å–ã€æ•°æ®å†™å…¥ç­‰ç­‰æƒ…å†µã€‚</p><p>è¯¥åº”ç”¨æ¡†æ¶æ€»ä½“æ¥è¯´å°±æ˜¯ä¸ºäº†ä¸¤ä¸ªæœåŠ¡ç›´æ¥è¿›è¡Œé€šä¿¡ï¼Œåªä¸è¿‡è¿™ä¸ªæ˜¯å¼‚æ­¥é€šä¿¡ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰é‚£æ ·çš„åŒæ­¥é€šä¿¡ï¼Œå®ƒæ˜¯éé˜»å¡çš„ï¼Œå…·æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚é‚£ä¹ˆè¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé€šä¿¡çš„ç§°ä¸º<strong>é€šé“</strong>ï¼ˆ<strong>Channel</strong>ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªé€šé“æ¥å®ç°åŒæ–¹ä¹‹é—´çš„é€šä¿¡ã€‚è¿™äº›éƒ½æ˜¯åº”ç”¨å±‚é¢çš„ï¼Œå¯¹äºä¼ è¾“å±‚æ¥è¯´ï¼Œå…·ä½“ä½¿ç”¨çš„æ˜¯TCPåè®®è¿˜æ˜¯UDPåè®®éƒ½åšäº†é€‚é…ã€‚</p><p><strong>ChannelHandler</strong> æ˜¯å¤„ç†ç‰¹å®šäº‹ä»¶å’Œæ•°æ®çš„ç»„ä»¶ã€‚ä½ å¯ä»¥å®šä¹‰è‡ªå·±çš„ ChannelHandlerï¼Œé‡å†™æ–¹æ³•æ¥å¤„ç†æ•°æ®çš„ç¼–è§£ç ã€è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚è¿™ä¸ªå¯ä»¥çœ‹æˆé€šé“ä¸Šçš„ç®¡ç†äººå‘˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é€šé“çš„ä¸¤å¤´ç¼–å†™çš„è‡ªå®šä¹‰çš„å…¥ç«™å’Œå‡ºç«™é€»è¾‘ã€‚</p><p>åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œæ•°æ®é€šå¸¸éœ€è¦è¿›è¡Œ<strong>ç¼–ç å’Œè§£ç </strong>ã€‚åœ¨ Netty ä¸­ï¼Œç¼–è§£ç çš„è¿‡ç¨‹é€šè¿‡ <code>ChannelHandler</code> çš„å®ç°æ¥å®Œæˆã€‚Netty æä¾›äº† <code>MessageToByteEncoder</code> å’Œ <code>ByteToMessageDecoder</code> ç­‰æŠ½è±¡ç±»ï¼Œç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ã€‚</p><p><strong>ChannelPipeline</strong> æ˜¯ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼Œå®ƒå…è®¸å¼€å‘è€…å°†å¤šä¸ª ChannelHandler ç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ª<strong>å¤„ç†é“¾</strong>ã€‚å½“æ•°æ®åœ¨ Channel ä¸­æµåŠ¨æ—¶ï¼Œå®ƒä¼šä¾æ¬¡ç»è¿‡é“¾ä¸­çš„æ¯ä¸ªå¤„ç†å™¨ã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ•°æ®çš„å¤„ç†è¿‡ç¨‹å¯ä»¥çµæ´»é…ç½®ï¼Œæ”¯æŒä¸åŒçš„åè®®å’Œä¸šåŠ¡é€»è¾‘ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyServerHandlerInitializer</span> <span class="keyword">extends</span> <span class="title class_">ChannelInitializer</span>&lt;Channel&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(Channel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ch.pipeline()</span><br><span class="line">                <span class="comment">//ç©ºé—²æ£€æµ‹</span></span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ServerIdleStateHandler</span>())</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32FrameDecoder</span>())</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufDecoder</span>(MessageBase.Message.getDefaultInstance()))</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32LengthFieldPrepender</span>())</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufEncoder</span>())</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">NettyServerHandler</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯ä¸€ä¸ªChannelPipelineã€‚</p><p><strong>Reactoræ¨¡å‹</strong>æ˜¯Nettyé‡‡ç”¨çš„çº¿ç¨‹æ¨¡å‹ï¼Œä¸‹é¢æ˜¯å…¶ä¸€ä¸ªå›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262019297.png" alt="image-20241011195241906"></p><p>Netty çš„çº¿ç¨‹æ¨¡å‹åŸºäº <strong>Reactor</strong> æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ç‰¹åˆ«é€‚åˆäºå¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚<strong>Reactor æ¨¡å¼çš„åŸºæœ¬æ€è·¯æ˜¯å°† I&#x2F;O æ“ä½œä¸ä¸šåŠ¡é€»è¾‘å¤„ç†åˆ†ç¦»ï¼Œå°† I&#x2F;O äº‹ä»¶çš„å¤„ç†å’Œä¸šåŠ¡é€»è¾‘å¤„ç†åˆ†é…ç»™ä¸åŒçš„çº¿ç¨‹</strong>ã€‚</p><p><strong>äº‹ä»¶å¾ªç¯</strong>: æ¯ä¸ª EventLoop ä¼šä¸æ–­åœ°å¾ªç¯å¤„ç†äº‹ä»¶ï¼ŒåŒ…æ‹¬è¿æ¥äº‹ä»¶ã€è¯»äº‹ä»¶å’Œå†™äº‹ä»¶ã€‚EventLoop è´Ÿè´£ä»æ“ä½œç³»ç»Ÿè·å–å¯è¯»æˆ–å¯å†™çš„ Channelï¼Œå¹¶å°†è¿™äº›äº‹ä»¶åˆ†å‘ç»™å¯¹åº”çš„ ChannelHandler è¿›è¡Œå¤„ç†ã€‚</p><p>Nettyçš„å¤„ç†æ¶æ„å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262019692.png" alt="image-20241011195650688"></p><p>Nettyä¸»è¦åœ¨Reactorçš„ä¸»ä»æ¨¡å‹ä¸Šè¿›è¡Œäº†ä¸€äº›æ”¹è¿›åå¾—åˆ°äº†ç›®å‰Nettyä½¿ç”¨çš„Reactoræ¨¡å‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262019433.png" alt="image-20241011195844135"></p><h3 id="Nettyå·¥ä½œåŸç†"><a href="#Nettyå·¥ä½œåŸç†" class="headerlink" title="Nettyå·¥ä½œåŸç†"></a>Nettyå·¥ä½œåŸç†</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/weixin_40909461/article/details/138355959?ops_request_misc=%257B%2522request%255Fid%2522%253A%25221B4F5303-2934-4300-B3BE-9463B4F2B8F5%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=1B4F5303-2934-4300-B3BE-9463B4F2B8F5&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-138355959-null-null.142%5Ev100%5Epc_search_result_base2&utm_term=Netty%E6%9E%B6%E6%9E%84&spm=1018.2226.3001.4187">ã€Nettyç³»åˆ—ã€‘Nettyé«˜æ€§èƒ½æ¶æ„è®¾è®¡ä»¥åŠå…‰é€Ÿå…¥é—¨</a></p><p>ä¸€å›¾è§çœŸçŸ¥</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262019540.png" alt="image-20241011200020959"></p><p>Netty æŠ½è±¡å‡ºäº†ä¸¤ç»„çº¿ç¨‹æ± BossGroupå’ŒWorkerGroupï¼Œ<strong>å…¶ä¸­BossGroupä¸“é—¨è´Ÿè´£æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</strong>ï¼Œ<strong>WorkerGroupä¸“é—¨è´Ÿè´£ç½‘ç»œçš„è¯»å†™</strong>ã€‚BossGroupå’ŒWorkerGroupçš„ç±»å‹éƒ½æ˜¯NioEventLoopGroupã€‚NioEventLoopGroupç›¸å½“äºä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»„ï¼Œè¿™ä¸ªç»„ç§å«æœ‰å¤šä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªNioEventLoopã€‚NioEeventLoopè¡¨ç¤ºä¸€ä¸ªä¸æ–­å¾ªç¯æ‰§è¡Œå¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ï¼Œå¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å«æœ‰å¤šä¸ªNioEventLoopï¼Œæ¯ä¸ªNioEventLoopéƒ½æœ‰ä¸€ä¸ªSelectorï¼Œç”¨äºç›‘å¬ç»‘å®šåœ¨å…¶ä¸Šçš„socketçš„ç½‘ç»œé€šè®¯ã€‚</p><p><strong>EventLoop å’Œ EventLoopGroup</strong>ï¼š<code>EventLoop</code> æ˜¯ Netty çš„äº‹ä»¶å¾ªç¯ï¼Œå®ƒå¤„ç† Channel ä¸Šçš„æ‰€æœ‰äº‹ä»¶ï¼ŒåŒ…æ‹¬ I&#x2F;O äº‹ä»¶ã€ä»»åŠ¡è°ƒåº¦ç­‰ã€‚æ¯ä¸ª <code>EventLoop</code> è´Ÿè´£å¤„ç†ä¸€ä¸ªæˆ–å¤šä¸ª <code>Channel</code>ï¼Œç¡®ä¿åŒä¸€ä¸ª <code>Channel</code> çš„æ‰€æœ‰ I&#x2F;O æ“ä½œéƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚<code>EventLoopGroup</code> æ˜¯ <code>EventLoop</code> çš„é›†åˆï¼Œé€šå¸¸åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><strong>BossGroup</strong>ï¼šè´Ÿè´£å¤„ç†æ–°çš„è¿æ¥è¯·æ±‚ã€‚</li><li><strong>WorkerGroup</strong>ï¼šè´Ÿè´£å¤„ç†å·²ç»å»ºç«‹çš„è¿æ¥çš„ I&#x2F;O æ“ä½œã€‚</li></ul><p><strong>Bootstrap&#x2F;ServerBootstrap</strong>ï¼šç”¨äºå¯åŠ¨ Netty åº”ç”¨ç¨‹åºçš„è¾…åŠ©ç±»ã€‚<code>Bootstrap</code> ç”¨äºå®¢æˆ·ç«¯ï¼Œ<code>ServerBootstrap</code> ç”¨äºæœåŠ¡å™¨ã€‚å®ƒä»¬ç®€åŒ–äº†é…ç½®å’Œåˆå§‹åŒ–è¿‡ç¨‹ã€‚</p><h2 id="SpringBooté›†æˆNetty"><a href="#SpringBooté›†æˆNetty" class="headerlink" title="SpringBooté›†æˆNetty"></a>SpringBooté›†æˆNetty</h2><p>å‚è€ƒèµ„æ–™</p><ul><li><a href="https://cloud.tencent.com/developer/article/1620776">Springboot 2.0 +protobuf + Netty å®æˆ˜(é™„æºç )</a></li><li><a href="https://blog.csdn.net/li371518473/article/details/136572133">Spring Bootä¸Nettyçš„å®Œç¾ç»“åˆï¼šæ‰“é€ é«˜æ€§èƒ½ç½‘ç»œé€šä¿¡</a></li></ul><h3 id="protobufåè®®æ ¼å¼"><a href="#protobufåè®®æ ¼å¼" class="headerlink" title="protobufåè®®æ ¼å¼"></a>protobufåè®®æ ¼å¼</h3><p>åœ¨æ•´åˆä½¿ç”¨ Netty çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Google çš„protobufå®šä¹‰æ¶ˆæ¯æ ¼å¼ï¼Œä¸‹é¢æ¥ç®€å•ä»‹ç»ä¸‹ protobufã€‚</p><p>äº†è§£ä¸€ä¸ªæ–°çš„äº‹ç‰©ï¼Œæˆ‘ä»¬ä»è¿™å‡ ä¸ªæ–¹é¢å¿«é€Ÿçš„äº†è§£ï¼š</p><ul><li>å®ƒæ˜¯ä»€ä¹ˆï¼ŸProtobufæ˜¯ä¸€ä¸ªæ•°æ®æ ¼å¼ï¼Œä¸“ä¸šæœ¯è¯­ä¸ºï¼šä¸€ç§ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼›</li><li>å®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿé€šå¸¸ç”¨äºç»“æ„åŒ–æ•°æ®çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼›</li><li>å®ƒç›¸æ¯”è¾ƒä¹‹å‰å­˜åœ¨çš„æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿå®ƒç›¸å¯¹äºJSONæ¥è¯´ï¼Œæ€§èƒ½æ›´å¥½ï¼Œæ”¯æŒè·¨è¯­è¨€ï¼ˆå› ä¸ºå®ƒæœ€åæ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„æ•°æ®ç¼–ç ï¼‰</li></ul><p>é€šè¿‡ä¸Šé¢ä¸‰ä¸ªé—®é¢˜å°±å¯ä»¥å¯¹Protobufæœ‰ä¸€ä¸ªåˆæ­¥æ¸…æ™°çš„äº†è§£ã€‚</p><h3 id="å¼•å…¥Nettyä¾èµ–"><a href="#å¼•å…¥Nettyä¾èµ–" class="headerlink" title="å¼•å…¥Nettyä¾èµ–"></a>å¼•å…¥Nettyä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.netty/netty-all --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.112.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="NettyæœåŠ¡ç«¯"><a href="#NettyæœåŠ¡ç«¯" class="headerlink" title="NettyæœåŠ¡ç«¯"></a>NettyæœåŠ¡ç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * boss çº¿ç¨‹ç»„ç”¨äºå¤„ç†è¿æ¥å·¥ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">EventLoopGroup</span> <span class="variable">boss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**åœ¨</span></span><br><span class="line"><span class="comment">     * work çº¿ç¨‹ç»„ç”¨äºæ•°æ®å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">EventLoopGroup</span> <span class="variable">work</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Value(&quot;$&#123;netty.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">54021</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// @PostConstruct æ˜¯ä¸€ä¸ªç”¨äº Java EE å’Œ Spring æ¡†æ¶ä¸­çš„æ³¨è§£ï¼Œæ ‡è®°åœ¨ä¸€ä¸ªæ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•å°†åœ¨ä¾èµ–æ³¨å…¥å®Œæˆåè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</span></span><br><span class="line">    <span class="comment">// å®ƒé€šå¸¸ç”¨äºè¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œä¾‹å¦‚è®¾ç½®é»˜è®¤å€¼ã€æ‰§è¡Œå¯åŠ¨æ—¶çš„é€»è¾‘ã€æˆ–è€…è¿›è¡Œèµ„æºçš„å‡†å¤‡ã€‚</span></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> å¯åŠ¨Netty Server</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span>  &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/10</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">        serverBootstrap.group(boss,work)</span><br><span class="line">                <span class="comment">// æŒ‡å®šChannel</span></span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                <span class="comment">//ä½¿ç”¨æŒ‡å®šçš„ç«¯å£è®¾ç½®å¥—æ¥å­—åœ°å€</span></span><br><span class="line">                .localAddress(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(port))</span><br><span class="line">                <span class="comment">// æ–¹æ³•è®¾ç½®äº† Socket é€‰é¡¹ SO_BACKLOGï¼Œå®ƒæŒ‡å®šäº†åœ¨è¿æ¥é˜Ÿåˆ—ä¸­å¯ä»¥æ’é˜Ÿçš„æœ€å¤§è¿æ¥æ•°ã€‚å½“æœåŠ¡å™¨æ­£åœ¨å¤„ç†ç°æœ‰è¿æ¥æ—¶ï¼Œ</span></span><br><span class="line">                <span class="comment">// æ–°çš„è¿æ¥è¯·æ±‚ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°å½“å‰è¿æ¥å¤„ç†å®Œæˆã€‚1024 æ˜¯é˜Ÿåˆ—çš„é•¿åº¦ï¼Œè¿™ä¸ªå€¼å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚</span></span><br><span class="line">                .option(ChannelOption.SO_BACKLOG,<span class="number">1024</span>)</span><br><span class="line">                <span class="comment">// è®¾ç½® SO_KEEPALIVE é€‰é¡¹ä¸º trueï¼Œè¿™æ„å‘³ç€åœ¨ TCP è¿æ¥ä¸Šå¯ç”¨ TCP ä¿æ´»æœºåˆ¶ã€‚</span></span><br><span class="line">                <span class="comment">// å¦‚æœè¿æ¥é—²ç½®æ—¶é—´è¿‡é•¿ï¼Œç³»ç»Ÿä¼šå‘é€ä¿æ´»æ¢æµ‹åŒ…ï¼Œä»¥ä¿æŒè¿æ¥çš„æ´»è·ƒçŠ¶æ€ã€‚</span></span><br><span class="line">                .childOption(ChannelOption.SO_KEEPALIVE,<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// è®¾ç½® TCP_NODELAY é€‰é¡¹ä¸º trueï¼Œå¯ç”¨ Nagle ç®—æ³•ã€‚</span></span><br><span class="line">                <span class="comment">// è¿™ä¼šåœ¨å‘é€å°æ•°æ®åŒ…æ—¶ç¦ç”¨å»¶è¿Ÿï¼Œä»è€Œå‡å°‘æ•°æ®åŒ…çš„å‘é€å»¶è¿Ÿï¼Œæé«˜å®æ—¶æ€§ã€‚</span></span><br><span class="line">                .childOption(ChannelOption.TCP_NODELAY,<span class="literal">true</span>)</span><br><span class="line">                .childHandler(<span class="keyword">new</span> <span class="title class_">NettyServerHandlerInitializer</span>());</span><br><span class="line">        <span class="type">ChannelFuture</span> <span class="variable">future</span> <span class="operator">=</span> serverBootstrap.bind().sync();</span><br><span class="line">        <span class="keyword">if</span> (future.isSuccess())&#123;</span><br><span class="line">            log.info(<span class="string">&quot;Netty Server Running&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        boss.shutdownGracefully().sync();</span><br><span class="line">        work.shutdownGracefully().sync();</span><br><span class="line">        log.info(<span class="string">&quot;Netty Server Stop&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyServerHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> MessageBase.Message) &#123;</span><br><span class="line">            <span class="comment">// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è½¬æ¢ä¸º Protobuf æ¶ˆæ¯</span></span><br><span class="line">            MessageBase.<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> (MessageBase.Message) msg;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¤„ç†æ¶ˆæ¯ï¼ˆä¾‹å¦‚ï¼Œæ‰“å°æ¶ˆæ¯å†…å®¹ï¼‰</span></span><br><span class="line">            log.info(<span class="string">&quot;Received message:&quot;</span>);</span><br><span class="line">            log.info(message.toString());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¯é€‰ï¼šæ ¹æ®æ¥æ”¶åˆ°çš„æ¶ˆæ¯å‘é€å“åº”</span></span><br><span class="line">            MessageBase.<span class="type">Message</span> <span class="variable">response</span> <span class="operator">=</span> MessageBase.Message.newBuilder()</span><br><span class="line">                    .setRequestId(message.getRequestId())</span><br><span class="line">                    .setCmd(MessageBase.Message.CommandType.ACK)</span><br><span class="line">                    .build();</span><br><span class="line">            ctx.writeAndFlush(response); <span class="comment">// å‘é€å“åº”</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸æ˜¯é¢„æœŸçš„ç±»å‹ï¼Œå¯ä»¥é€‰æ‹©å¿½ç•¥æˆ–è€…æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            System.err.println(<span class="string">&quot;Received an unknown message type: &quot;</span> + msg.getClass().getName());</span><br><span class="line">            ctx.fireChannelRead(msg); <span class="comment">// ç»§ç»­å‘ä¸‹ä¼ é€’</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†å¼‚å¸¸</span></span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close(); <span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyServerHandlerInitializer</span> <span class="keyword">extends</span> <span class="title class_">ChannelInitializer</span>&lt;Channel&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(Channel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ch.pipeline()</span><br><span class="line">                <span class="comment">//ç©ºé—²æ£€æµ‹</span></span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ServerIdleStateHandler</span>())</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32FrameDecoder</span>())</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufDecoder</span>(MessageBase.Message.getDefaultInstance()))</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32LengthFieldPrepender</span>())</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufEncoder</span>())</span><br><span class="line">                .addLast(<span class="keyword">new</span> <span class="title class_">NettyServerHandler</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerIdleStateHandler</span> <span class="keyword">extends</span> <span class="title class_">IdleStateHandler</span> &#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">times</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®ç©ºé—²æ£€æµ‹æ—¶é—´ä¸º 30s</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">READER_IDLE_TIME</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServerIdleStateHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(READER_IDLE_TIME, READER_IDLE_TIME, READER_IDLE_TIME, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelIdle</span><span class="params">(ChannelHandlerContext ctx, IdleStateEvent evt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;&#123;&#125; ç§’å†…æ²¡æœ‰è¯»å–åˆ°æ•°æ®,å…³é—­è¿æ¥&quot;</span>, READER_IDLE_TIME);</span><br><span class="line"></span><br><span class="line">        System.out.println(ctx.channel().remoteAddress() + <span class="string">&quot;å‘ç”Ÿè¶…æ—¶äº‹ä»¶--&quot;</span> + evt);</span><br><span class="line"></span><br><span class="line">        ctx.channel().close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Nettyå®¢æˆ·ç«¯"><a href="#Nettyå®¢æˆ·ç«¯" class="headerlink" title="Nettyå®¢æˆ·ç«¯"></a>Nettyå®¢æˆ·ç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EventLoopGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">54021</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SocketChannel socketChannel;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> Nettyå®¢æˆ·ç«¯å¯åŠ¨å‡½æ•° è°ƒç”¨Startå¯ä»¥å¯åŠ¨å¯¹NettyæœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/10/11</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>();</span><br><span class="line">        bootstrap.group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .remoteAddress(host, port)</span><br><span class="line">                .option(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">                .option(ChannelOption.TCP_NODELAY, <span class="literal">true</span>)</span><br><span class="line">                .handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                        ch.pipeline()</span><br><span class="line">                                <span class="comment">// ç©ºé—²æ£€æµ‹</span></span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">60</span>, <span class="number">60</span>, <span class="number">60</span>)) <span class="comment">// 60ç§’å†™ç©ºé—²ï¼Œ30ç§’è¯»ç©ºé—²</span></span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">HeartbeatHandler</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32FrameDecoder</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufDecoder</span>(MessageBase.Message.getDefaultInstance()))</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufVarint32LengthFieldPrepender</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">ProtobufEncoder</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">NettyClientHandler</span>())</span><br><span class="line">                        ; <span class="comment">// è‡ªå®šä¹‰å¤„ç†å™¨</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="type">ChannelFuture</span> <span class="variable">future</span> <span class="operator">=</span> bootstrap.connect();</span><br><span class="line">        <span class="comment">//å®¢æˆ·ç«¯æ–­çº¿é‡è¿é€»è¾‘</span></span><br><span class="line">        future.addListener((ChannelFutureListener) future1 -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (future1.isSuccess()) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;è¿æ¥NettyæœåŠ¡ç«¯æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;è¿æ¥å¤±è´¥ï¼Œè¿›è¡Œæ–­çº¿é‡è¿&quot;</span>);</span><br><span class="line">                future1.channel().eventLoop().schedule(<span class="built_in">this</span>::start, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        socketChannel = (SocketChannel) future.channel();</span><br><span class="line"></span><br><span class="line">        sendMessageThread.setSocketChannel(socketChannel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="protoæ–‡ä»¶"><a href="#protoæ–‡ä»¶" class="headerlink" title="protoæ–‡ä»¶"></a>protoæ–‡ä»¶</h3><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//protobufè¯­æ³•æœ‰ proto2å’Œproto3ä¸¤ç§ï¼Œè¿™é‡ŒæŒ‡å®š proto3</span></span><br><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"><span class="comment">// æ–‡ä»¶é€‰é¡¹</span></span><br><span class="line"><span class="keyword">option</span> java_package = <span class="string">&quot;com.fang.screw.client.protocol&quot;</span>;</span><br><span class="line"><span class="keyword">option</span> java_outer_classname = <span class="string">&quot;MessageBase&quot;</span>;</span><br><span class="line"><span class="comment">// æ¶ˆæ¯æ¨¡å‹å®šä¹‰</span></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Message</span> &#123;</span><br><span class="line">  <span class="type">string</span> requestId = <span class="number">1</span>;</span><br><span class="line">  CommandType cmd = <span class="number">2</span>;</span><br><span class="line">  <span class="type">string</span> content = <span class="number">3</span>;</span><br><span class="line">  <span class="type">int32</span> retryCount = <span class="number">4</span>;</span><br><span class="line">  <span class="type">string</span> urlPath = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">enum </span><span class="title class_">CommandType</span> &#123;</span><br><span class="line">    NORMAL = <span class="number">0</span>; <span class="comment">//å¸¸è§„ä¸šåŠ¡æ¶ˆæ¯</span></span><br><span class="line">    HEARTBEAT_REQUEST = <span class="number">1</span>; <span class="comment">//å®¢æˆ·ç«¯å¿ƒè·³æ¶ˆæ¯</span></span><br><span class="line">    HEARTBEAT_RESPONSE = <span class="number">2</span>; <span class="comment">//æœåŠ¡ç«¯å¿ƒè·³æ¶ˆæ¯</span></span><br><span class="line">    ACK = <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éœ€è¦æŠŠProtobufæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œå…·ä½“å¦‚ä½•æ“ä½œè¯·æŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚</p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><h3 id="å®¢æˆ·ç«¯çš„å¿ƒè·³åŒ…æ— æ³•ä¼ ç»™æœåŠ¡ç«¯ï¼Œä½†æ˜¯è‡ªè¡Œçš„æ¶ˆæ¯å¯ä»¥å‘é€åˆ°æœåŠ¡ç«¯"><a href="#å®¢æˆ·ç«¯çš„å¿ƒè·³åŒ…æ— æ³•ä¼ ç»™æœåŠ¡ç«¯ï¼Œä½†æ˜¯è‡ªè¡Œçš„æ¶ˆæ¯å¯ä»¥å‘é€åˆ°æœåŠ¡ç«¯" class="headerlink" title="å®¢æˆ·ç«¯çš„å¿ƒè·³åŒ…æ— æ³•ä¼ ç»™æœåŠ¡ç«¯ï¼Œä½†æ˜¯è‡ªè¡Œçš„æ¶ˆæ¯å¯ä»¥å‘é€åˆ°æœåŠ¡ç«¯"></a>å®¢æˆ·ç«¯çš„å¿ƒè·³åŒ…æ— æ³•ä¼ ç»™æœåŠ¡ç«¯ï¼Œä½†æ˜¯è‡ªè¡Œçš„æ¶ˆæ¯å¯ä»¥å‘é€åˆ°æœåŠ¡ç«¯</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ul><li>å®¢æˆ·ç«¯çš„å¿ƒè·³é…ç½®é”™è¯¯ï¼Œå¯¼è‡´å¿ƒè·³æ²¡æœ‰è§¦å‘ï¼›</li></ul><p>å¿ƒè·³æ²¡é—®é¢˜ï¼Œèƒ½å¤Ÿè§¦å‘ï¼Œä½†æ˜¯æ¶ˆæ¯å‘ä¸å‡ºå»äº†ï¼›</p><ul><li>é¡¹ç›®ç»“æ„å­˜åœ¨é—®é¢˜ï¼Œå¯¼è‡´å®¢æˆ·ç«¯çš„å¿ƒè·³å‘é€æ¶ˆæ¯å­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼›</li></ul><p>æš‚æ—¶æ²¡æ‰¾åˆ°æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œç›®å‰å†³å®šå–æ¶ˆå¿ƒè·³ï¼Œåœ¨åˆ°è¾¾ä¸€å®šçš„ç©ºé—²æ—¶é—´åå°±ä¼šå…³é—­è¿™ä¸ªè¿æ¥ï¼Œå½“å®¢æˆ·ç«¯æ”¶åˆ°äº†æ¶ˆæ¯åå°±ä¼šæ‰“å¼€é“¾æ¥ï¼Œç„¶åå‘é€æ¶ˆæ¯ã€‚</p><p>- </p><h2 id="é¢è¯•é—®é¢˜"><a href="#é¢è¯•é—®é¢˜" class="headerlink" title="é¢è¯•é—®é¢˜"></a>é¢è¯•é—®é¢˜</h2><blockquote><p>ä»¥ä¸‹æ˜¯æ¶µç›–æ•´ä¸ªNettyçŸ¥è¯†ç‚¹çš„é¢è¯•é¢˜ï¼Œéš¾åº¦å¾ªåºæ¸è¿›ï¼Œå…±æœ‰20ä¸ªé—®é¢˜ï¼š</p><h3 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h3><ol><li>ä»€ä¹ˆæ˜¯Nettyï¼Œå®ƒä¸»è¦è§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ</li><li>è¯·ç®€è¿°Nettyçš„å·¥ä½œæµç¨‹ã€‚</li><li>Nettyçš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿå®ƒä»¬å„è‡ªçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ä»€ä¹ˆæ˜¯Channelï¼ŒChannelHandlerå’ŒChannelPipelineï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</li><li>Nettyä¸­NIOæ¨¡å‹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</li><li>è§£é‡Šä»€ä¹ˆæ˜¯EventLoopä»¥åŠå®ƒçš„ä½œç”¨ã€‚</li><li>è¯·æè¿°ä¸€ä¸‹Nettyçš„å¼‚æ­¥å¤„ç†æ¨¡å‹å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ã€‚</li></ol><h3 id="é«˜çº§åº”ç”¨"><a href="#é«˜çº§åº”ç”¨" class="headerlink" title="é«˜çº§åº”ç”¨"></a>é«˜çº§åº”ç”¨</h3><ol><li>Nettyä¸­å¦‚ä½•å®ç°TCPè¿æ¥çš„ç®¡ç†ï¼Ÿå¦‚ä½•å¤„ç†é•¿è¿æ¥ï¼Ÿ</li><li>å¦‚ä½•åœ¨Nettyä¸­å®ç°å¿ƒè·³æœºåˆ¶ï¼Ÿå¿ƒè·³æœºåˆ¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>è¯·æè¿°ä¸€ä¸‹Nettyçš„ç¼–è§£ç å™¨ï¼ˆCodecï¼‰ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</li><li>Nettyä¸­å¦‚ä½•å®ç°SSL&#x2F;TLSåŠ å¯†ï¼Ÿ</li><li>åœ¨Nettyä¸­ï¼Œå¦‚ä½•å¤„ç†å¼‚å¸¸å¹¶ç¡®ä¿ç¨‹åºçš„å¥å£®æ€§ï¼Ÿ</li><li>Nettyå¦‚ä½•æ”¯æŒè‡ªå®šä¹‰åè®®çš„ç¼–è§£ç ï¼Ÿ</li><li>Nettyçš„çº¿ç¨‹æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿå¦‚ä½•ä¼˜åŒ–çº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Ÿ</li></ol><h3 id="æ€§èƒ½ä¸ä¼˜åŒ–"><a href="#æ€§èƒ½ä¸ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¸ä¼˜åŒ–"></a>æ€§èƒ½ä¸ä¼˜åŒ–</h3><ol><li>å¦‚ä½•åœ¨Nettyä¸­å®ç°é«˜å¹¶å‘çš„å¤„ç†ï¼Ÿæœ‰å“ªäº›ä¼˜åŒ–æªæ–½ï¼Ÿ</li><li>Nettyä¸­çš„å†…å­˜ç®¡ç†æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Ÿå¦‚ä½•ä¼˜åŒ–å†…å­˜çš„ä½¿ç”¨ï¼Ÿ</li><li>Nettyçš„é›¶æ‹·è´æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Œå®ƒæ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„ï¼Ÿ</li><li>å¦‚ä½•åœ¨Nettyä¸­å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ &#x2F;ä¸‹è½½ï¼Ÿå¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ</li><li>ä½ å¦‚ä½•è§£å†³Nettyä¸­çš„TCPç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜ï¼Ÿ</li><li>Nettyçš„è´Ÿè½½å‡è¡¡æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå¦‚ä½•ä¿è¯é«˜å¯ç”¨æ€§ï¼Ÿ</li></ol><p>è¿™äº›é—®é¢˜æ¶‰åŠåˆ°Nettyçš„åŸºç¡€ä½¿ç”¨ã€æ¶æ„åŸç†ã€é«˜çº§ç‰¹æ€§ã€æ€§èƒ½ä¼˜åŒ–ç­‰å„ä¸ªæ–¹é¢ï¼Œé€‚ç”¨äºä¸åŒéš¾åº¦å±‚æ¬¡çš„é¢è¯•ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Netty </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Netty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>74-01 Python</title>
      <link href="/2025/02/26/74-01%20Python/"/>
      <url>/2025/02/26/74-01%20Python/</url>
      
        <content type="html"><![CDATA[<h1 id="74-01-Python"><a href="#74-01-Python" class="headerlink" title="74-01 Python"></a>74-01 Python</h1><p>ç»“åˆä½ å¯¹Javaçš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œæˆ‘ä¼šè¯¦ç»†ä»‹ç»Pythonä¸­çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰è¯­æ³•ï¼Œå¹¶ä¸Javaè¿›è¡Œå¯¹æ¯”ã€‚Pythonå’ŒJavaçš„OOPæ¦‚å¿µç›¸ä¼¼ï¼Œä½†è¯­æ³•å’Œä¸€äº›å®ç°ç»†èŠ‚æœ‰æ‰€ä¸åŒã€‚</p><h2 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h2><h3 id="1-ç±»ä¸å¯¹è±¡"><a href="#1-ç±»ä¸å¯¹è±¡" class="headerlink" title="1. ç±»ä¸å¯¹è±¡"></a>1. ç±»ä¸å¯¹è±¡</h3><h4 id="Javaï¼š"><a href="#Javaï¼š" class="headerlink" title="Javaï¼š"></a>Javaï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    Person(String name, <span class="type">int</span> age) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">greet</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, my name is &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>);</span><br><span class="line">        person.greet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Pythonï¼š"><a href="#Pythonï¼š" class="headerlink" title="Pythonï¼š"></a>Pythonï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Hello, my name is <span class="subst">&#123;self.name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå¯¹è±¡å¹¶è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">person = Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>)</span><br><span class="line">person.greet()</span><br></pre></td></tr></table></figure><p><strong>å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>ç±»å®šä¹‰</strong>ï¼šPythonä½¿ç”¨<code>class</code>å…³é”®å­—å®šä¹‰ç±»ï¼Œç±»ä¼¼äºJavaã€‚</li><li><strong>æ„é€ æ–¹æ³•</strong>ï¼šPythonç”¨<code>__init__</code>æ–¹æ³•å®ç°æ„é€ å‡½æ•°ï¼Œè€ŒJavaä½¿ç”¨ä¸ç±»åç›¸åŒçš„æ–¹æ³•ã€‚</li><li><strong>selfå…³é”®å­—</strong>ï¼šPythonä¸­çš„<code>self</code>ç±»ä¼¼äºJavaä¸­çš„<code>this</code>ï¼Œè¡¨ç¤ºç±»çš„å®ä¾‹ã€‚</li><li><strong>æ–¹æ³•å®šä¹‰</strong>ï¼šPythonçš„æ–¹æ³•å¿…é¡»æ˜¾å¼åŒ…å«<code>self</code>ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºè®¿é—®å®ä¾‹å˜é‡ï¼›Javaåˆ™éšå¼ä¼ é€’<code>this</code>ã€‚</li></ul><h3 id="2-ç»§æ‰¿"><a href="#2-ç»§æ‰¿" class="headerlink" title="2. ç»§æ‰¿"></a>2. ç»§æ‰¿</h3><h4 id="Javaï¼š-1"><a href="#Javaï¼š-1" class="headerlink" title="Javaï¼š"></a>Javaï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sound</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Animal makes a sound&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sound</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Dog barks&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Pythonï¼š-1"><a href="#Pythonï¼š-1" class="headerlink" title="Pythonï¼š"></a>Pythonï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Animal makes a sound&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Dog barks&quot;</span>)</span><br></pre></td></tr></table></figure><p><strong>å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>ç»§æ‰¿æ–¹å¼</strong>ï¼šPythonçš„ç»§æ‰¿ç±»ä¼¼äºJavaï¼Œç›´æ¥åœ¨ç±»ååæ‹¬å·ä¸­å£°æ˜çˆ¶ç±»ã€‚</li><li><strong>æ–¹æ³•é‡å†™</strong>ï¼šJavaä½¿ç”¨<code>@Override</code>æ³¨è§£è¡¨ç¤ºé‡å†™æ–¹æ³•ï¼Œè€ŒPythonä¸éœ€è¦ç‰¹æ®Šæ ‡æ³¨ï¼Œç›´æ¥å®šä¹‰åŒåæ–¹æ³•å³å¯ã€‚</li></ul><h3 id="3-å¤šç»§æ‰¿"><a href="#3-å¤šç»§æ‰¿" class="headerlink" title="3. å¤šç»§æ‰¿"></a>3. å¤šç»§æ‰¿</h3><h4 id="Javaï¼š-2"><a href="#Javaï¼š-2" class="headerlink" title="Javaï¼š"></a>Javaï¼š</h4><p>Javaä¸æ”¯æŒç±»çš„å¤šç»§æ‰¿ï¼Œä½†å¯ä»¥é€šè¿‡æ¥å£å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> <span class="keyword">implements</span> <span class="title class_">A</span>, B &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Method A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Method B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Pythonï¼š-2"><a href="#Pythonï¼š-2" class="headerlink" title="Pythonï¼š"></a>Pythonï¼š</h4><p>Pythonæ”¯æŒç±»çš„å¤šç»§æ‰¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">method_a</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Method A&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">method_b</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Method B&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(A, B):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">c = C()</span><br><span class="line">c.method_a()</span><br><span class="line">c.method_b()</span><br></pre></td></tr></table></figure><p><strong>å¯¹æ¯”</strong>ï¼š</p><ul><li>Pythonå…è®¸ç±»å¤šç»§æ‰¿ï¼Œè€ŒJavaé€šè¿‡æ¥å£å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚</li></ul><h3 id="4-å°è£…ä¸è®¿é—®æ§åˆ¶"><a href="#4-å°è£…ä¸è®¿é—®æ§åˆ¶" class="headerlink" title="4. å°è£…ä¸è®¿é—®æ§åˆ¶"></a>4. å°è£…ä¸è®¿é—®æ§åˆ¶</h3><h4 id="Javaï¼š-3"><a href="#Javaï¼š-3" class="headerlink" title="Javaï¼š"></a>Javaï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Pythonï¼š-3"><a href="#Pythonï¼š-3" class="headerlink" title="Pythonï¼š"></a>Pythonï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__name = name  <span class="comment"># åŒä¸‹åˆ’çº¿è¡¨ç¤ºç§æœ‰å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_name</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__name = name</span><br></pre></td></tr></table></figure><p><strong>å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>è®¿é—®æ§åˆ¶</strong>ï¼šJavaä½¿ç”¨<code>private</code>ã€<code>protected</code>å’Œ<code>public</code>æ¥æ§åˆ¶è®¿é—®æƒé™ï¼›Pythonä½¿ç”¨åŒä¸‹åˆ’çº¿å‰ç¼€ï¼ˆå¦‚<code>__name</code>ï¼‰æ¥è¡¨ç¤ºç§æœ‰å˜é‡ï¼Œä½†å®é™…ä¸Šåªæ˜¯åç§°é‡æ•´ï¼ˆname manglingï¼‰æœºåˆ¶ï¼Œä¸æ˜¯çœŸæ­£çš„ç§æœ‰ã€‚</li><li><strong>getterå’Œsetter</strong>ï¼šPythonå¯ä»¥é€šè¿‡å®šä¹‰æ–¹æ³•å®ç°ç±»ä¼¼Javaçš„getterå’Œsetterï¼Œæˆ–è€…ä½¿ç”¨<code>@property</code>è£…é¥°å™¨ã€‚</li></ul><h3 id="5-å¤šæ€"><a href="#5-å¤šæ€" class="headerlink" title="5. å¤šæ€"></a>5. å¤šæ€</h3><p>å¤šæ€çš„æ¦‚å¿µåœ¨Javaå’ŒPythonä¸­åŸºæœ¬ç›¸åŒï¼Œéƒ½æ˜¯æŒ‡ä¸åŒå¯¹è±¡å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è°ƒç”¨å…¶ç‰¹å®šçš„è¡Œä¸ºã€‚</p><h4 id="Javaï¼š-4"><a href="#Javaï¼š-4" class="headerlink" title="Javaï¼š"></a>Javaï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sound</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Animal sound&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sound</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Dog barks&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">        a.sound();  <span class="comment">// è¾“å‡ºï¼šDog barks</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Pythonï¼š-4"><a href="#Pythonï¼š-4" class="headerlink" title="Pythonï¼š"></a>Pythonï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Animal sound&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Dog barks&quot;</span>)</span><br><span class="line"></span><br><span class="line">a = Dog()</span><br><span class="line">a.sound()  <span class="comment"># è¾“å‡ºï¼šDog barks</span></span><br></pre></td></tr></table></figure><p><strong>å¯¹æ¯”</strong>ï¼š</p><ul><li>Pythonçš„å¤šæ€å®ç°ä¸Javaéå¸¸ç›¸ä¼¼ï¼Œé€šè¿‡å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•å®ç°ã€‚</li></ul><h3 id="6-é™æ€æ–¹æ³•å’Œç±»æ–¹æ³•"><a href="#6-é™æ€æ–¹æ³•å’Œç±»æ–¹æ³•" class="headerlink" title="6. é™æ€æ–¹æ³•å’Œç±»æ–¹æ³•"></a>6. é™æ€æ–¹æ³•å’Œç±»æ–¹æ³•</h3><h4 id="Javaï¼š-5"><a href="#Javaï¼š-5" class="headerlink" title="Javaï¼š"></a>Javaï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Utility</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Static method in Java&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Pythonï¼š-5"><a href="#Pythonï¼š-5" class="headerlink" title="Pythonï¼š"></a>Pythonï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Utility</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">print_message</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Static method in Python&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨é™æ€æ–¹æ³•</span></span><br><span class="line">Utility.print_message()</span><br></pre></td></tr></table></figure><p><strong>å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>é™æ€æ–¹æ³•</strong>ï¼šJavaä½¿ç”¨<code>static</code>å…³é”®å­—å£°æ˜é™æ€æ–¹æ³•ï¼ŒPythonä½¿ç”¨<code>@staticmethod</code>è£…é¥°å™¨å®ç°ã€‚</li></ul><p>Pythonè¿˜æ”¯æŒ<code>@classmethod</code>ï¼Œç”¨äºæ“ä½œç±»çº§åˆ«çš„æ•°æ®ï¼Œç±»ä¼¼Javaä¸­çš„é™æ€æ–¹æ³•ï¼Œä½†ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>cls</code>ï¼Œè¡¨ç¤ºç±»æœ¬èº«ã€‚</p><h3 id="7-æŠ½è±¡ç±»ä¸æ¥å£"><a href="#7-æŠ½è±¡ç±»ä¸æ¥å£" class="headerlink" title="7. æŠ½è±¡ç±»ä¸æ¥å£"></a>7. æŠ½è±¡ç±»ä¸æ¥å£</h3><h4 id="Javaï¼š-6"><a href="#Javaï¼š-6" class="headerlink" title="Javaï¼š"></a>Javaï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">sound</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sound</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Dog barks&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Pythonï¼š-6"><a href="#Pythonï¼š-6" class="headerlink" title="Pythonï¼š"></a>Pythonï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Dog barks&quot;</span>)</span><br></pre></td></tr></table></figure><p><strong>å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>æŠ½è±¡ç±»</strong>ï¼šPythoné€šè¿‡<code>abc</code>æ¨¡å—å®ç°æŠ½è±¡ç±»ï¼Œä½¿ç”¨<code>@abstractmethod</code>è£…é¥°å™¨æ¥å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼Œç±»ä¼¼Javaçš„<code>abstract</code>å…³é”®å­—ã€‚</li></ul><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>åœ¨Pythonä¸­ï¼Œæ•°æ®ç»“æ„æ˜¯å¤„ç†å’Œå­˜å‚¨æ•°æ®çš„åŸºç¡€å·¥å…·ã€‚Pythonæä¾›äº†å¤šç§å†…ç½®çš„æ•°æ®ç»“æ„ï¼Œæ¶µç›–äº†ä»åŸºæœ¬ç±»å‹åˆ°å¤æ‚ç±»å‹çš„å„ç§åœºæ™¯éœ€æ±‚ã€‚åŸºäºæˆ‘å¯¹Pythonçš„ç†è§£ï¼Œä»¥ä¸‹æ˜¯å¯¹ä¸»è¦æ•°æ®ç»“æ„çš„è¯¦ç»†ä»‹ç»ï¼š</p><h3 id="1-åˆ—è¡¨ï¼ˆListï¼‰"><a href="#1-åˆ—è¡¨ï¼ˆListï¼‰" class="headerlink" title="1. åˆ—è¡¨ï¼ˆListï¼‰"></a>1. åˆ—è¡¨ï¼ˆListï¼‰</h3><p>Pythonçš„<code>list</code>æ˜¯åŠ¨æ€æ•°ç»„ï¼Œç±»ä¼¼äºJavaä¸­çš„<code>ArrayList</code>ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å…ƒç´ ï¼Œå¹¶ä¸”å¤§å°å¯å˜ã€‚</p><h4 id="åŸºæœ¬æ“ä½œï¼š"><a href="#åŸºæœ¬æ“ä½œï¼š" class="headerlink" title="åŸºæœ¬æ“ä½œï¼š"></a>åŸºæœ¬æ“ä½œï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºåˆ—è¡¨</span></span><br><span class="line">fruits = [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;cherry&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å…ƒç´ </span></span><br><span class="line">fruits.append(<span class="string">&quot;orange&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’å…¥å…ƒç´ </span></span><br><span class="line">fruits.insert(<span class="number">1</span>, <span class="string">&quot;kiwi&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å…ƒç´ </span></span><br><span class="line">fruits.remove(<span class="string">&quot;banana&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç´¢å¼•è®¿é—®å’Œåˆ‡ç‰‡</span></span><br><span class="line">first_fruit = fruits[<span class="number">0</span>]</span><br><span class="line">sublist = fruits[<span class="number">1</span>:<span class="number">3</span>]  <span class="comment"># åˆ‡ç‰‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†</span></span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> fruits:</span><br><span class="line">    <span class="built_in">print</span>(fruit)</span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>æœ‰åº</strong>ï¼šå…ƒç´ æŒ‰ç…§æ’å…¥é¡ºåºå­˜å‚¨ï¼Œæ”¯æŒç´¢å¼•è®¿é—®ã€‚</li><li><strong>åŠ¨æ€å¤§å°</strong>ï¼šæ”¯æŒåŠ¨æ€æ·»åŠ ã€åˆ é™¤å…ƒç´ ã€‚</li><li><strong>æ”¯æŒå¤šç§ç±»å‹</strong>ï¼šå¯ä»¥å­˜å‚¨ä¸åŒç±»å‹çš„å…ƒç´ åœ¨åŒä¸€åˆ—è¡¨ä¸­ã€‚</li></ul><h3 id="2-å…ƒç»„ï¼ˆTupleï¼‰"><a href="#2-å…ƒç»„ï¼ˆTupleï¼‰" class="headerlink" title="2. å…ƒç»„ï¼ˆTupleï¼‰"></a>2. å…ƒç»„ï¼ˆTupleï¼‰</h3><p><code>tuple</code>ç±»ä¼¼äº<code>list</code>ï¼Œä½†<strong>ä¸å¯å˜</strong>ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦åˆ›å»ºï¼Œå…ƒç´ å°±ä¸èƒ½ä¿®æ”¹ã€‚</p><h4 id="åŸºæœ¬æ“ä½œï¼š-1"><a href="#åŸºæœ¬æ“ä½œï¼š-1" class="headerlink" title="åŸºæœ¬æ“ä½œï¼š"></a>åŸºæœ¬æ“ä½œï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå…ƒç»„</span></span><br><span class="line">coordinates = (<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®å…ƒç´ </span></span><br><span class="line">x = coordinates[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ƒç»„ä¸å¯å˜ï¼Œä½†å¯ä»¥åµŒå¥—åˆ—è¡¨ç­‰å¯å˜å¯¹è±¡</span></span><br><span class="line">nested_tuple = (<span class="number">10</span>, [<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">nested_tuple[<span class="number">1</span>].append(<span class="number">3</span>)  <span class="comment"># å¯ä»¥ä¿®æ”¹å†…éƒ¨åˆ—è¡¨</span></span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š-1"><a href="#ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>ä¸å¯å˜</strong>ï¼šæé«˜äº†å®‰å…¨æ€§ï¼Œé€‚åˆå­˜å‚¨å›ºå®šæ•°æ®ã€‚</li><li><strong>æ€§èƒ½ä¼˜è¶Š</strong>ï¼šç”±äºä¸å¯å˜ï¼Œå…ƒç»„æ“ä½œæ¯”åˆ—è¡¨æ›´å¿«ã€‚</li></ul><h3 id="3-å­—å…¸ï¼ˆDictionaryï¼‰"><a href="#3-å­—å…¸ï¼ˆDictionaryï¼‰" class="headerlink" title="3. å­—å…¸ï¼ˆDictionaryï¼‰"></a>3. å­—å…¸ï¼ˆDictionaryï¼‰</h3><p>Pythonçš„<code>dict</code>ç±»ä¼¼äºJavaä¸­çš„<code>HashMap</code>ï¼Œå­˜å‚¨é”®å€¼å¯¹ï¼Œæä¾›äº†å¿«é€Ÿçš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œã€‚</p><h4 id="åŸºæœ¬æ“ä½œï¼š-2"><a href="#åŸºæœ¬æ“ä½œï¼š-2" class="headerlink" title="åŸºæœ¬æ“ä½œï¼š"></a>åŸºæœ¬æ“ä½œï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå­—å…¸</span></span><br><span class="line">person = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æˆ–æ›´æ–°é”®å€¼å¯¹</span></span><br><span class="line">person[<span class="string">&quot;city&quot;</span>] = <span class="string">&quot;New York&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®å…ƒç´ </span></span><br><span class="line">name = person[<span class="string">&quot;name&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†é”®å€¼å¯¹</span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> person.items():</span><br><span class="line">    <span class="built_in">print</span>(key, value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤é”®å€¼å¯¹</span></span><br><span class="line"><span class="keyword">del</span> person[<span class="string">&quot;age&quot;</span>]</span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š-2"><a href="#ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>æ— åºï¼ˆPython 3.6ä¹‹å‰ï¼‰</strong>ï¼šPython 3.7åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå­—å…¸ä¿æŒæ’å…¥é¡ºåºã€‚</li><li><strong>é”®å”¯ä¸€</strong>ï¼šæ¯ä¸ªé”®åœ¨å­—å…¸ä¸­å”¯ä¸€ï¼Œå€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚</li></ul><h3 id="4-é›†åˆï¼ˆSetï¼‰"><a href="#4-é›†åˆï¼ˆSetï¼‰" class="headerlink" title="4. é›†åˆï¼ˆSetï¼‰"></a>4. é›†åˆï¼ˆSetï¼‰</h3><p><code>set</code>ç±»ä¼¼äºJavaä¸­çš„<code>HashSet</code>ï¼Œç”¨äºå­˜å‚¨<strong>ä¸é‡å¤</strong>çš„å…ƒç´ ï¼Œæ”¯æŒæ•°å­¦é›†åˆè¿ç®—ã€‚</p><h4 id="åŸºæœ¬æ“ä½œï¼š-3"><a href="#åŸºæœ¬æ“ä½œï¼š-3" class="headerlink" title="åŸºæœ¬æ“ä½œï¼š"></a>åŸºæœ¬æ“ä½œï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé›†åˆ</span></span><br><span class="line">unique_numbers = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å…ƒç´ </span></span><br><span class="line">unique_numbers.add(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å…ƒç´ </span></span><br><span class="line">unique_numbers.remove(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†åˆè¿ç®—</span></span><br><span class="line">set1 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">set2 = &#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">union_set = set1.union(set2)  <span class="comment"># å¹¶é›†</span></span><br><span class="line">intersection_set = set1.intersection(set2)  <span class="comment"># äº¤é›†</span></span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š-3"><a href="#ç‰¹ç‚¹ï¼š-3" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>æ— åº</strong>ï¼šé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å›ºå®šé¡ºåºã€‚</li><li><strong>ä¸é‡å¤</strong>ï¼šé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å”¯ä¸€çš„ã€‚</li><li><strong>é«˜æ•ˆæŸ¥æ‰¾</strong>ï¼šé›†åˆçš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚</li></ul><h3 id="5-é˜Ÿåˆ—ï¼ˆQueueï¼‰"><a href="#5-é˜Ÿåˆ—ï¼ˆQueueï¼‰" class="headerlink" title="5. é˜Ÿåˆ—ï¼ˆQueueï¼‰"></a>5. é˜Ÿåˆ—ï¼ˆQueueï¼‰</h3><p>Pythonæä¾›<code>collections.deque</code>ä½œä¸ºåŒç«¯é˜Ÿåˆ—ï¼ˆdequeï¼‰ï¼Œå¯ä»¥åœ¨ä¸¤ç«¯é«˜æ•ˆåœ°æ·»åŠ å’Œåˆ é™¤å…ƒç´ ã€‚ç±»ä¼¼äºJavaä¸­çš„<code>LinkedList</code>å®ç°çš„é˜Ÿåˆ—ã€‚</p><h4 id="åŸºæœ¬æ“ä½œï¼š-4"><a href="#åŸºæœ¬æ“ä½œï¼š-4" class="headerlink" title="åŸºæœ¬æ“ä½œï¼š"></a>åŸºæœ¬æ“ä½œï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">queue = deque([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜Ÿï¼ˆå°¾éƒ¨æ·»åŠ ï¼‰</span></span><br><span class="line">queue.append(<span class="string">&quot;d&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡ºé˜Ÿï¼ˆå¤´éƒ¨ç§»é™¤ï¼‰</span></span><br><span class="line">queue.popleft()</span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š-4"><a href="#ç‰¹ç‚¹ï¼š-4" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>åŒç«¯é˜Ÿåˆ—</strong>ï¼šå¯ä»¥ä»ä¸¤ç«¯é«˜æ•ˆåœ°æ·»åŠ å’Œåˆ é™¤å…ƒç´ ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<code>deque</code>çš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œé€‚åˆå¤šçº¿ç¨‹åœºæ™¯ã€‚</li></ul><h3 id="6-æ ˆï¼ˆStackï¼‰"><a href="#6-æ ˆï¼ˆStackï¼‰" class="headerlink" title="6. æ ˆï¼ˆStackï¼‰"></a>6. æ ˆï¼ˆStackï¼‰</h3><p>Pythonæ²¡æœ‰ä¸“é—¨çš„æ ˆç»“æ„ï¼Œä½†å¯ä»¥ä½¿ç”¨<code>list</code>æ¨¡æ‹Ÿï¼Œæˆ–è€…ä½¿ç”¨<code>collections.deque</code>å®ç°æ›´é«˜æ•ˆçš„æ ˆæ“ä½œã€‚</p><h4 id="ä½¿ç”¨listä½œä¸ºæ ˆï¼š"><a href="#ä½¿ç”¨listä½œä¸ºæ ˆï¼š" class="headerlink" title="ä½¿ç”¨listä½œä¸ºæ ˆï¼š"></a>ä½¿ç”¨<code>list</code>ä½œä¸ºæ ˆï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">stack = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‹æ ˆ</span></span><br><span class="line">stack.append(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡ºæ ˆ</span></span><br><span class="line">stack.pop()</span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š-5"><a href="#ç‰¹ç‚¹ï¼š-5" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰</strong>ï¼šæ ˆçš„æ“ä½œéµå¾ªåè¿›å…ˆå‡ºåŸåˆ™ã€‚</li></ul><h3 id="7-ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriority-Queueï¼‰"><a href="#7-ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriority-Queueï¼‰" class="headerlink" title="7. ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriority Queueï¼‰"></a>7. ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriority Queueï¼‰</h3><p>Pythonæä¾›<code>heapq</code>æ¨¡å—æ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œåº•å±‚åŸºäºå †ç»“æ„ã€‚</p><h4 id="åŸºæœ¬æ“ä½œï¼š-5"><a href="#åŸºæœ¬æ“ä½œï¼š-5" class="headerlink" title="åŸºæœ¬æ“ä½œï¼š"></a>åŸºæœ¬æ“ä½œï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¼˜å…ˆé˜Ÿåˆ—</span></span><br><span class="line">pq = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å…ƒç´ </span></span><br><span class="line">heapq.heappush(pq, <span class="number">3</span>)</span><br><span class="line">heapq.heappush(pq, <span class="number">1</span>)</span><br><span class="line">heapq.heappush(pq, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼¹å‡ºæœ€å°å…ƒç´ </span></span><br><span class="line">smallest = heapq.heappop(pq)  <span class="comment"># è¿”å›1</span></span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š-6"><a href="#ç‰¹ç‚¹ï¼š-6" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>æœ€å°å †</strong>ï¼š<code>heapq</code>é»˜è®¤å®ç°æœ€å°å †ï¼Œ<code>heappop</code>è¿”å›æœ€å°å…ƒç´ ã€‚</li><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šæ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)ã€‚</li></ul><h3 id="8-å­—ç¬¦ä¸²ï¼ˆStringï¼‰"><a href="#8-å­—ç¬¦ä¸²ï¼ˆStringï¼‰" class="headerlink" title="8. å­—ç¬¦ä¸²ï¼ˆStringï¼‰"></a>8. å­—ç¬¦ä¸²ï¼ˆStringï¼‰</h3><p>Pythonä¸­çš„<code>str</code>æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œç±»ä¼¼äºJavaçš„<code>String</code>ï¼Œç”¨äºå­˜å‚¨å­—ç¬¦åºåˆ—ã€‚</p><h4 id="åŸºæœ¬æ“ä½œï¼š-6"><a href="#åŸºæœ¬æ“ä½œï¼š-6" class="headerlink" title="åŸºæœ¬æ“ä½œï¼š"></a>åŸºæœ¬æ“ä½œï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å­—ç¬¦ä¸²åˆ›å»º</span></span><br><span class="line">text = <span class="string">&quot;Hello, World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²æ‹¼æ¥</span></span><br><span class="line">new_text = text + <span class="string">&quot;!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²åˆ‡ç‰‡</span></span><br><span class="line">subtext = text[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾å­å­—ç¬¦ä¸²</span></span><br><span class="line">index = text.find(<span class="string">&quot;World&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²éå†</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> text:</span><br><span class="line">    <span class="built_in">print</span>(char)</span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š-7"><a href="#ç‰¹ç‚¹ï¼š-7" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>ä¸å¯å˜</strong>ï¼šå­—ç¬¦ä¸²ä¸€æ—¦åˆ›å»ºï¼Œæ— æ³•ä¿®æ”¹ã€‚</li><li><strong>ä¸°å¯Œçš„æ“ä½œæ–¹æ³•</strong>ï¼šPythonæä¾›äº†å¤§é‡å­—ç¬¦ä¸²æ“ä½œæ–¹æ³•ï¼Œå¦‚<code>split()</code>ã€<code>join()</code>ã€<code>replace()</code>ç­‰ã€‚</li></ul><h3 id="9-å†»ç»“é›†åˆï¼ˆFrozensetï¼‰"><a href="#9-å†»ç»“é›†åˆï¼ˆFrozensetï¼‰" class="headerlink" title="9. å†»ç»“é›†åˆï¼ˆFrozensetï¼‰"></a>9. å†»ç»“é›†åˆï¼ˆFrozensetï¼‰</h3><p><code>frozenset</code>æ˜¯ä¸å¯å˜çš„é›†åˆï¼Œç±»ä¼¼äº<code>set</code>ï¼Œä½†å…ƒç´ ä¸å¯å˜ï¼Œé€‚åˆç”¨äºä½œä¸ºå­—å…¸çš„é”®æˆ–å…¶ä»–éœ€è¦ä¸å¯å˜æ€§çš„åœºæ™¯ã€‚</p><h4 id="åŸºæœ¬æ“ä½œï¼š-7"><a href="#åŸºæœ¬æ“ä½œï¼š-7" class="headerlink" title="åŸºæœ¬æ“ä½œï¼š"></a>åŸºæœ¬æ“ä½œï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå†»ç»“é›†åˆ</span></span><br><span class="line">frozen = <span class="built_in">frozenset</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†åˆè¿ç®—</span></span><br><span class="line">frozen.union(&#123;<span class="number">4</span>, <span class="number">5</span>&#125;)  <span class="comment"># å¹¶é›†</span></span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š-8"><a href="#ç‰¹ç‚¹ï¼š-8" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>ä¸å¯å˜</strong>ï¼šåˆ›å»ºåä¸å¯ä¿®æ”¹ã€‚</li></ul><h3 id="10-å­—èŠ‚ï¼ˆBytesï¼‰"><a href="#10-å­—èŠ‚ï¼ˆBytesï¼‰" class="headerlink" title="10. å­—èŠ‚ï¼ˆBytesï¼‰"></a>10. å­—èŠ‚ï¼ˆBytesï¼‰</h3><p><code>bytes</code>ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œç±»ä¼¼äºJavaä¸­çš„<code>byte[]</code>ã€‚</p><h4 id="åŸºæœ¬æ“ä½œï¼š-8"><a href="#åŸºæœ¬æ“ä½œï¼š-8" class="headerlink" title="åŸºæœ¬æ“ä½œï¼š"></a>åŸºæœ¬æ“ä½œï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå­—èŠ‚</span></span><br><span class="line">data = <span class="string">b&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®å­—èŠ‚</span></span><br><span class="line">first_byte = data[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢å­—ç¬¦ä¸²ä¸ºå­—èŠ‚</span></span><br><span class="line">encoded = <span class="string">&quot;hello&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢å­—èŠ‚ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">decoded = encoded.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="ç‰¹ç‚¹ï¼š-9"><a href="#ç‰¹ç‚¹ï¼š-9" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>ä¸å¯å˜</strong>ï¼š<code>bytes</code>å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚</li><li><strong>ç”¨äºäºŒè¿›åˆ¶æ•°æ®å¤„ç†</strong>ï¼šå¸¸ç”¨äºç½‘ç»œé€šä¿¡ã€æ–‡ä»¶I&#x2F;Oç­‰åœºæ™¯ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>74-02 Flask</title>
      <link href="/2025/02/26/74-02%20Flask/"/>
      <url>/2025/02/26/74-02%20Flask/</url>
      
        <content type="html"><![CDATA[<h1 id="74-02-Flask"><a href="#74-02-Flask" class="headerlink" title="74-02 Flask"></a>74-02 Flask</h1><h2 id="åˆæ­¥ä½¿ç”¨Demo"><a href="#åˆæ­¥ä½¿ç”¨Demo" class="headerlink" title="åˆæ­¥ä½¿ç”¨Demo"></a>åˆæ­¥ä½¿ç”¨Demo</h2><p>ä¸ºäº†å®ç°ä¸€ä¸ªç±»ä¼¼äº CSDN çš„ç®€å•ç½‘ç«™ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Flask æ„å»ºä¸€ä¸ªåŸºæœ¬çš„åšå®¢ç³»ç»Ÿï¼Œå…·å¤‡æ–‡ç« å±•ç¤ºã€åˆ›å»ºã€ç¼–è¾‘å’Œåˆ é™¤åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯è¿™ä¸ª Demo çš„ç®€è¦ç›®å½•ç»“æ„ã€æ ¸å¿ƒä»£ç å’Œæ“ä½œæ­¥éª¤ã€‚</p><h3 id="1-ç›®å½•ç»“æ„"><a href="#1-ç›®å½•ç»“æ„" class="headerlink" title="1. ç›®å½•ç»“æ„"></a>1. ç›®å½•ç»“æ„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">csdn_flask_demo/</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ app.py                  <span class="comment"># ä¸»åº”ç”¨æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ config.py               <span class="comment"># é…ç½®æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ requirements.txt        <span class="comment"># é¡¹ç›®ä¾èµ–</span></span><br><span class="line">â”œâ”€â”€ templates/              <span class="comment"># å­˜æ”¾HTMLæ¨¡æ¿</span></span><br><span class="line">â”‚   â”œâ”€â”€ base.html           <span class="comment"># åŸºæœ¬å¸ƒå±€æ¨¡æ¿</span></span><br><span class="line">â”‚   â”œâ”€â”€ index.html          <span class="comment"># é¦–é¡µï¼Œå±•ç¤ºæ‰€æœ‰æ–‡ç« </span></span><br><span class="line">â”‚   â”œâ”€â”€ create_article.html <span class="comment"># åˆ›å»ºæ–°æ–‡ç« é¡µé¢</span></span><br><span class="line">â”‚   â””â”€â”€ article.html        <span class="comment"># æ–‡ç« è¯¦æƒ…é¡µ</span></span><br><span class="line">â”œâ”€â”€ static/                 <span class="comment"># é™æ€æ–‡ä»¶ï¼ˆå¦‚CSS, JS, å›¾ç‰‡ç­‰ï¼‰</span></span><br><span class="line">â”‚   â””â”€â”€ style.css           <span class="comment"># ç®€å•çš„CSSæ ·å¼</span></span><br><span class="line">â””â”€â”€ models.py               <span class="comment"># æ•°æ®åº“æ¨¡å‹</span></span><br></pre></td></tr></table></figure><h3 id="2-æ ¸å¿ƒä»£ç "><a href="#2-æ ¸å¿ƒä»£ç " class="headerlink" title="2. æ ¸å¿ƒä»£ç "></a>2. æ ¸å¿ƒä»£ç </h3><h4 id="app-py-ä¸»åº”ç”¨æ–‡ä»¶"><a href="#app-py-ä¸»åº”ç”¨æ–‡ä»¶" class="headerlink" title="app.py (ä¸»åº”ç”¨æ–‡ä»¶)"></a><code>app.py</code> (ä¸»åº”ç”¨æ–‡ä»¶)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect, url_for, flash</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> db, Article</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(<span class="string">&#x27;config&#x27;</span>)</span><br><span class="line"></span><br><span class="line">db.init_app(app)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    articles = Article.query.<span class="built_in">all</span>()  <span class="comment"># è·å–æ‰€æœ‰æ–‡ç« </span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, articles=articles)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/article/&lt;int:id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">article</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    article = Article.query.get_or_404(<span class="built_in">id</span>)  <span class="comment"># è·å–æŒ‡å®šIDçš„æ–‡ç« </span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;article.html&#x27;</span>, article=article)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/create&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_article</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        title = request.form[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">        content = request.form[<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> title <span class="keyword">and</span> content:</span><br><span class="line">            new_article = Article(title=title, content=content)</span><br><span class="line">            db.session.add(new_article)</span><br><span class="line">            db.session.commit()</span><br><span class="line">            flash(<span class="string">&#x27;Article created successfully!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&#x27;Title and Content are required.&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;create_article.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h4 id="models-py-æ•°æ®åº“æ¨¡å‹"><a href="#models-py-æ•°æ®åº“æ¨¡å‹" class="headerlink" title="models.py (æ•°æ®åº“æ¨¡å‹)"></a><code>models.py</code> (æ•°æ®åº“æ¨¡å‹)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">db = SQLAlchemy()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span>(db.Model):</span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    title = db.Column(db.String(<span class="number">100</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    content = db.Column(db.Text, nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;&lt;Article <span class="subst">&#123;self.title&#125;</span>&gt;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="config-py-é…ç½®æ–‡ä»¶"><a href="#config-py-é…ç½®æ–‡ä»¶" class="headerlink" title="config.py (é…ç½®æ–‡ä»¶)"></a><code>config.py</code> (é…ç½®æ–‡ä»¶)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">basedir = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line"></span><br><span class="line">SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;sqlite:///&#x27;</span> + os.path.join(basedir, <span class="string">&#x27;app.db&#x27;</span>)</span><br><span class="line">SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">False</span></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;your_secret_key&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="templates-base-html-åŸºæœ¬å¸ƒå±€æ¨¡æ¿"><a href="#templates-base-html-åŸºæœ¬å¸ƒå±€æ¨¡æ¿" class="headerlink" title="templates/base.html (åŸºæœ¬å¸ƒå±€æ¨¡æ¿)"></a><code>templates/base.html</code> (åŸºæœ¬å¸ƒå±€æ¨¡æ¿)</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Simple CSDN Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;style.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Simple CSDN<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;index&#x27;) &#125;&#125;&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;create_article&#x27;) &#125;&#125;&quot;</span>&gt;</span>Create New Article<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        &#123;% block content %&#125;&#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="templates-index-html-ä¸»é¡µæ¨¡æ¿"><a href="#templates-index-html-ä¸»é¡µæ¨¡æ¿" class="headerlink" title="templates/index.html (ä¸»é¡µæ¨¡æ¿)"></a><code>templates/index.html</code> (ä¸»é¡µæ¨¡æ¿)</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Articles<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for article in articles %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;article&#x27;, id=article.id) &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; article.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><h4 id="templates-article-html-æ–‡ç« è¯¦æƒ…é¡µæ¨¡æ¿"><a href="#templates-article-html-æ–‡ç« è¯¦æƒ…é¡µæ¨¡æ¿" class="headerlink" title="templates/article.html (æ–‡ç« è¯¦æƒ…é¡µæ¨¡æ¿)"></a><code>templates/article.html</code> (æ–‡ç« è¯¦æƒ…é¡µæ¨¡æ¿)</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; article.title &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; article.content &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;index&#x27;) &#125;&#125;&quot;</span>&gt;</span>Back to Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><h4 id="templates-create-article-html-åˆ›å»ºæ–‡ç« é¡µæ¨¡æ¿"><a href="#templates-create-article-html-åˆ›å»ºæ–‡ç« é¡µæ¨¡æ¿" class="headerlink" title="templates/create_article.html (åˆ›å»ºæ–‡ç« é¡µæ¨¡æ¿)"></a><code>templates/create_article.html</code> (åˆ›å»ºæ–‡ç« é¡µæ¨¡æ¿)</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Create a New Article<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Title:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;content&quot;</span>&gt;</span>Content:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;10&quot;</span> <span class="attr">required</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Create<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><h4 id="static-style-css-ç®€å•çš„CSSæ ·å¼"><a href="#static-style-css-ç®€å•çš„CSSæ ·å¼" class="headerlink" title="static/style.css (ç®€å•çš„CSSæ ·å¼)"></a><code>static/style.css</code> (ç®€å•çš„CSSæ ·å¼)</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Arial, sans-serif;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">header</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">nav</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="requirements-txt-é¡¹ç›®ä¾èµ–"><a href="#requirements-txt-é¡¹ç›®ä¾èµ–" class="headerlink" title="requirements.txt (é¡¹ç›®ä¾èµ–)"></a><code>requirements.txt</code> (é¡¹ç›®ä¾èµ–)</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flask==2.0.1</span><br><span class="line">Flask-SQLAlchemy==2.5.1</span><br></pre></td></tr></table></figure><h3 id="3-æ“ä½œæ­¥éª¤"><a href="#3-æ“ä½œæ­¥éª¤" class="headerlink" title="3. æ“ä½œæ­¥éª¤"></a>3. æ“ä½œæ­¥éª¤</h3><h4 id="1-å®‰è£…ä¾èµ–"><a href="#1-å®‰è£…ä¾èµ–" class="headerlink" title="1. å®‰è£…ä¾èµ–"></a>1. å®‰è£…ä¾èµ–</h4><p>åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…é¡¹ç›®ä¾èµ–ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv venv</span><br><span class="line"><span class="built_in">source</span> venv/bin/activate  <span class="comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (Windows ç”¨æˆ·æ‰§è¡Œ venv\Scripts\activate)</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><h4 id="2-åˆå§‹åŒ–æ•°æ®åº“"><a href="#2-åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="2. åˆå§‹åŒ–æ•°æ®åº“"></a>2. åˆå§‹åŒ–æ•°æ®åº“</h4><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–æ•°æ®åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">&gt;&gt;&gt; from app import db</span><br><span class="line">&gt;&gt;&gt; db.create_all()</span><br></pre></td></tr></table></figure><p>è¿™ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <code>app.db</code> æ–‡ä»¶ã€‚</p><h4 id="3-è¿è¡Œåº”ç”¨"><a href="#3-è¿è¡Œåº”ç”¨" class="headerlink" title="3. è¿è¡Œåº”ç”¨"></a>3. è¿è¡Œåº”ç”¨</h4><p>å¯åŠ¨ Flask åº”ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python app.py</span><br></pre></td></tr></table></figure><p>åº”ç”¨å°†åœ¨ <code>http://127.0.0.1:5000/</code> ä¸Šè¿è¡Œï¼Œä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¯¥åœ°å€æŸ¥çœ‹æ•ˆæœã€‚</p><h4 id="4-åŠŸèƒ½æµ‹è¯•"><a href="#4-åŠŸèƒ½æµ‹è¯•" class="headerlink" title="4. åŠŸèƒ½æµ‹è¯•"></a>4. åŠŸèƒ½æµ‹è¯•</h4><ul><li>é¦–é¡µå°†åˆ—å‡ºæ‰€æœ‰æ–‡ç« ã€‚</li><li>ä½ å¯ä»¥ç‚¹å‡»åˆ›å»ºæ–°æ–‡ç« ï¼Œå¡«å†™æ ‡é¢˜å’Œå†…å®¹åä¿å­˜ã€‚</li><li>ç‚¹å‡»æ–‡ç« æ ‡é¢˜å¯ä»¥æŸ¥çœ‹æ–‡ç« è¯¦æƒ…ã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸ªç®€å•çš„ Flask Demo å±•ç¤ºäº†å¦‚ä½•æ„å»ºä¸€ä¸ªç±»ä¼¼ CSDN çš„åšå®¢ç½‘ç«™ã€‚ä½ å¯ä»¥åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ‰©å±•åŠŸèƒ½ï¼Œæ¯”å¦‚ç”¨æˆ·æ³¨å†Œã€è¯„è®ºç³»ç»Ÿã€æ–‡ç« åˆ†ç±»ç­‰ã€‚ä¸ CSDN ç±»ä¼¼ï¼Œä½ å¯ä»¥é€æ­¥æ„å»ºå‡ºä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åšå®¢å¹³å°ã€‚</p><h2 id="Flaskè¯·æ±‚æ–¹å¼-è¯·æ±‚å‚æ•°è·å–"><a href="#Flaskè¯·æ±‚æ–¹å¼-è¯·æ±‚å‚æ•°è·å–" class="headerlink" title="Flaskè¯·æ±‚æ–¹å¼&amp;è¯·æ±‚å‚æ•°è·å–"></a>Flaskè¯·æ±‚æ–¹å¼&amp;è¯·æ±‚å‚æ•°è·å–</h2><h3 id="Getè¯·æ±‚"><a href="#Getè¯·æ±‚" class="headerlink" title="Getè¯·æ±‚"></a>Getè¯·æ±‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@testHttpMethodApi_bp.route(<span class="params"><span class="string">&quot;/testMethodApi&quot;</span>,methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_blueprint</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    password = request.args.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> name <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;name and password are null&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;get test blueprint&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Postè¯·æ±‚"><a href="#Postè¯·æ±‚" class="headerlink" title="Postè¯·æ±‚"></a>Postè¯·æ±‚</h3><h4 id="å‚æ•°ç±»å‹ä¸ºform-data"><a href="#å‚æ•°ç±»å‹ä¸ºform-data" class="headerlink" title="å‚æ•°ç±»å‹ä¸ºform-data"></a>å‚æ•°ç±»å‹ä¸ºform-data</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262023322.png" alt="image-20241022140839643"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@testHttpMethodApi_bp.route(<span class="params"><span class="string">&quot;/testPostMethod&quot;</span>,methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">post_example</span>():</span><br><span class="line">    name = request.form.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    password = request.form.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> name <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;name and password are null&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;get test blueprint&quot;</span></span><br></pre></td></tr></table></figure><h4 id="å‚æ•°ç±»å‹ä¸ºJSON"><a href="#å‚æ•°ç±»å‹ä¸ºJSON" class="headerlink" title="å‚æ•°ç±»å‹ä¸ºJSON"></a>å‚æ•°ç±»å‹ä¸ºJSON</h4><p>è‡ªåŠ¨è£…é…JSONæ ¼å¼æ•°æ®å¹¶è½¬åŒ–æˆç›®æ ‡å¯¹è±¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è£…é¥°å™¨æ¥è‡ªåŠ¨è½¬æ¢ JSON æ•°æ®ä¸ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json_to_object</span>(<span class="params">cls</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">f</span>):</span><br><span class="line"><span class="meta">        @wraps(<span class="params">f</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            data = request.get_json()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;No JSON data provided&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># å°† JSON æ•°æ®æ˜ å°„ä¸ºç±»å¯¹è±¡</span></span><br><span class="line">                obj = cls(**data)</span><br><span class="line">            <span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)&#125;), <span class="number">400</span></span><br><span class="line">            <span class="comment"># å°†å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¢«è£…é¥°çš„å‡½æ•°</span></span><br><span class="line">            <span class="keyword">return</span> f(obj, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@testHttpMethodApi_bp.route(<span class="params"><span class="string">&quot;/testPostMethod&quot;</span>,methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="meta">@json_to_object(<span class="params">User</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">post_example</span>(<span class="params">user</span>):</span><br><span class="line">    <span class="comment"># è¡¨å•æ•°æ®è¯»å–</span></span><br><span class="line">    name = request.form.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    password = request.form.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(user.__repr__())</span><br><span class="line"></span><br><span class="line">    string = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> name <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">        string = <span class="string">&quot;name and password are null&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        string = <span class="string">&quot;user is null&quot;</span></span><br><span class="line">    <span class="keyword">return</span> string</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªç®€å•çš„ User ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.password = password</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;User(name=<span class="subst">&#123;self.name&#125;</span>, password=<span class="subst">&#123;self.password&#125;</span>)&quot;</span></span><br></pre></td></tr></table></figure><h3 id="PUTè¯·æ±‚"><a href="#PUTè¯·æ±‚" class="headerlink" title="PUTè¯·æ±‚"></a>PUTè¯·æ±‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PUT è¯·æ±‚: ä» JSON æ•°æ®ä¸­è·å–å‚æ•°</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/put-example&#x27;</span>, methods=[<span class="string">&#x27;PUT&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">put_example</span>():</span><br><span class="line">    <span class="comment"># è·å– JSON æ ¼å¼çš„æ•°æ®</span></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    name = data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    age = data.get(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">        <span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: name,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: age</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h3 id="DELETEè¯·æ±‚"><a href="#DELETEè¯·æ±‚" class="headerlink" title="DELETEè¯·æ±‚"></a>DELETEè¯·æ±‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DELETE è¯·æ±‚: ä»æŸ¥è¯¢å‚æ•°ä¸­è·å–è¦åˆ é™¤çš„èµ„æºæ ‡è¯†</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/delete-example&#x27;</span>, methods=[<span class="string">&#x27;DELETE&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_example</span>():</span><br><span class="line">    <span class="comment"># è·å– URL ä¸­çš„æŸ¥è¯¢å‚æ•°ï¼Œè¡¨ç¤ºè¦åˆ é™¤çš„èµ„æº</span></span><br><span class="line">    resource_id = request.args.get(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">        <span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;deleted_resource_id&#x27;</span>: resource_id</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Flask-MySQLæ•°æ®åº“äº¤äº’"><a href="#Flask-MySQLæ•°æ®åº“äº¤äº’" class="headerlink" title="Flask MySQLæ•°æ®åº“äº¤äº’"></a>Flask MySQLæ•°æ®åº“äº¤äº’</h2><p>åœ¨ Flask ä¸­ä¸æ•°æ®åº“äº¤äº’çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œå¸¸è§çš„å·¥å…·åŒ…åŒ…æ‹¬ <strong>SQLAlchemy</strong> å’Œ <strong>Flask-SQLAlchemy</strong>ã€‚è¿™ä¸¤ä¸ªå·¥å…·åŒ…éƒ½æä¾›äº†ä¸æ•°æ®åº“çš„ä¾¿æ·äº¤äº’æ–¹å¼ï¼Œç±»ä¼¼äº Java ä¸­çš„ MyBatisã€‚ä¸‹é¢ï¼Œæˆ‘å°†é€šè¿‡ä¸€ä¸ªè¯¦ç»†çš„ä¾‹å­ä»‹ç»å¦‚ä½•ä½¿ç”¨ <strong>Flask-SQLAlchemy</strong> æ¥å®ç°æ•°æ®åº“æ“ä½œã€‚</p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySQLConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="comment"># æ›¿æ¢ä¸ºä½ çš„æ•°æ®åº“ä¿¡æ¯</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;mysql+pymysql://root:123456@localhost:3306/screw_it_development_biz&#x27;</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">False</span>  <span class="comment"># å…³é—­ä¿®æ”¹è¿½è¸ª</span></span><br></pre></td></tr></table></figure><h3 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">db = SQLAlchemy()  <span class="comment"># å®ä¾‹åŒ– SQLAlchemy</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªç®€å•çš„ User ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model):</span><br><span class="line"></span><br><span class="line">    __tablename__ = <span class="string">&#x27;user&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    username = db.Column(db.String(<span class="number">20</span>), unique=<span class="literal">True</span>, nullable=<span class="literal">False</span>)</span><br><span class="line">    password = db.Column(db.String(<span class="number">120</span>), unique=<span class="literal">True</span>, nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.password = password</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;User(name=<span class="subst">&#123;self.username&#125;</span>, password=<span class="subst">&#123;self.password&#125;</span>)&quot;</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@testHttpMethodApi_bp.route(<span class="params"><span class="string">&quot;/testMySQLConnection/&lt;int:user_id&gt;&quot;</span>,methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="comment"># @json_to_object(User)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_mysql_connection</span>(<span class="params">user_id</span>):</span><br><span class="line"></span><br><span class="line">    user = User.query.get_or_404(user_id)</span><br><span class="line"></span><br><span class="line">    db.session.commit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> user.__repr__()</span><br></pre></td></tr></table></figure><h3 id="åŠ è½½é…ç½®"><a href="#åŠ è½½é…ç½®" class="headerlink" title="åŠ è½½é…ç½®"></a>åŠ è½½é…ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect, url_for</span><br><span class="line"><span class="keyword">from</span> testHttpMethodApi <span class="keyword">import</span> testHttpMethodApi_bp</span><br><span class="line"><span class="keyword">from</span> config.DbConfig <span class="keyword">import</span> MySQLConfig</span><br><span class="line"><span class="keyword">from</span> entry <span class="keyword">import</span> db</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½é…ç½®</span></span><br><span class="line">app.config.from_object(MySQLConfig)</span><br><span class="line">db.init_app(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å†Œè“å›¾</span></span><br><span class="line">app.register_blueprint(testHttpMethodApi_bp, url_prefix=<span class="string">&#x27;/testHttpMethodApi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;fangYaoHui using flask&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è“å›¾-ç±»ä¼¼äºJavaå¤šä¸ªController"><a href="#è“å›¾-ç±»ä¼¼äºJavaå¤šä¸ªController" class="headerlink" title="è“å›¾-ç±»ä¼¼äºJavaå¤šä¸ªController"></a>è“å›¾-ç±»ä¼¼äºJavaå¤šä¸ªController</h2><p>åœ¨ Flask ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡**è“å›¾ï¼ˆBlueprintsï¼‰<strong>çš„æ–¹å¼ï¼Œå°†è·¯ç”±åˆ†å‰²åˆ°ä¸åŒçš„æ¨¡å—ä¸­ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°ç»„ç»‡ä»£ç ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ çš„åº”ç”¨è§„æ¨¡è¾ƒå¤§æ—¶ã€‚è¿™ä¸ Java çš„ SpringBoot ä¸­çš„</strong>æ§åˆ¶å™¨ï¼ˆControllerï¼‰**æ¨¡å—åŒ–è®¾è®¡ç±»ä¼¼ï¼Œèƒ½å¤Ÿä½¿ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ã€‚</p><h3 id="1-è°ƒæ•´åçš„ç›®å½•ç»“æ„"><a href="#1-è°ƒæ•´åçš„ç›®å½•ç»“æ„" class="headerlink" title="1. è°ƒæ•´åçš„ç›®å½•ç»“æ„"></a>1. è°ƒæ•´åçš„ç›®å½•ç»“æ„</h3><p>æˆ‘ä»¬å°†è·¯ç”±æ‹†åˆ†ä¸ºä¸åŒçš„æ¨¡å—ï¼Œæ¯”å¦‚ï¼šæ–‡ç« æ¨¡å—ã€ç”¨æˆ·æ¨¡å—ç­‰ã€‚è°ƒæ•´åçš„é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">csdn_flask_demo/</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ app.py                  <span class="comment"># ä¸»åº”ç”¨æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ config.py               <span class="comment"># é…ç½®æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ requirements.txt        <span class="comment"># é¡¹ç›®ä¾èµ–</span></span><br><span class="line">â”œâ”€â”€ templates/              <span class="comment"># å­˜æ”¾HTMLæ¨¡æ¿</span></span><br><span class="line">â”‚   â”œâ”€â”€ base.html           <span class="comment"># åŸºæœ¬å¸ƒå±€æ¨¡æ¿</span></span><br><span class="line">â”‚   â”œâ”€â”€ index.html          <span class="comment"># é¦–é¡µï¼Œå±•ç¤ºæ‰€æœ‰æ–‡ç« </span></span><br><span class="line">â”‚   â”œâ”€â”€ create_article.html <span class="comment"># åˆ›å»ºæ–°æ–‡ç« é¡µé¢</span></span><br><span class="line">â”‚   â””â”€â”€ article.html        <span class="comment"># æ–‡ç« è¯¦æƒ…é¡µ</span></span><br><span class="line">â”œâ”€â”€ static/                 <span class="comment"># é™æ€æ–‡ä»¶ï¼ˆå¦‚CSS, JS, å›¾ç‰‡ç­‰ï¼‰</span></span><br><span class="line">â”‚   â””â”€â”€ style.css           <span class="comment"># ç®€å•çš„CSSæ ·å¼</span></span><br><span class="line">â”œâ”€â”€ models.py               <span class="comment"># æ•°æ®åº“æ¨¡å‹</span></span><br><span class="line">â”œâ”€â”€ article/                <span class="comment"># æ–‡ç« æ¨¡å—ç›®å½•</span></span><br><span class="line">â”‚   â”œâ”€â”€ __init__.py         <span class="comment"># æ–‡ç« è“å›¾å®šä¹‰</span></span><br><span class="line">â”‚   â””â”€â”€ routes.py           <span class="comment"># æ–‡ç« ç›¸å…³çš„è·¯ç”±å®šä¹‰</span></span><br><span class="line">â””â”€â”€ user/                   <span class="comment"># ç”¨æˆ·æ¨¡å—ç›®å½•ï¼ˆç¤ºä¾‹ï¼‰</span></span><br><span class="line">    â”œâ”€â”€ __init__.py         <span class="comment"># ç”¨æˆ·è“å›¾å®šä¹‰</span></span><br><span class="line">    â””â”€â”€ routes.py           <span class="comment"># ç”¨æˆ·ç›¸å…³çš„è·¯ç”±å®šä¹‰</span></span><br></pre></td></tr></table></figure><h3 id="2-æ ¸å¿ƒä»£ç -1"><a href="#2-æ ¸å¿ƒä»£ç -1" class="headerlink" title="2. æ ¸å¿ƒä»£ç "></a>2. æ ¸å¿ƒä»£ç </h3><h4 id="app-py-ä¸»åº”ç”¨æ–‡ä»¶-1"><a href="#app-py-ä¸»åº”ç”¨æ–‡ä»¶-1" class="headerlink" title="app.py (ä¸»åº”ç”¨æ–‡ä»¶)"></a><code>app.py</code> (ä¸»åº”ç”¨æ–‡ä»¶)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> article.routes <span class="keyword">import</span> article_bp  <span class="comment"># å¯¼å…¥æ–‡ç« è“å›¾</span></span><br><span class="line"><span class="keyword">from</span> user.routes <span class="keyword">import</span> user_bp        <span class="comment"># å¯¼å…¥ç”¨æˆ·è“å›¾</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(<span class="string">&#x27;config&#x27;</span>)</span><br><span class="line"></span><br><span class="line">db.init_app(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å†Œè“å›¾</span></span><br><span class="line">app.register_blueprint(article_bp, url_prefix=<span class="string">&#x27;/articles&#x27;</span>)  <span class="comment"># æ‰€æœ‰æ–‡ç« ç›¸å…³çš„è·¯ç”±å‰åŠ  /articles å‰ç¼€</span></span><br><span class="line">app.register_blueprint(user_bp, url_prefix=<span class="string">&#x27;/users&#x27;</span>)        <span class="comment"># æ‰€æœ‰ç”¨æˆ·ç›¸å…³çš„è·¯ç”±å‰åŠ  /users å‰ç¼€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h4 id="article-init-py-æ–‡ç« æ¨¡å—çš„è“å›¾å®šä¹‰"><a href="#article-init-py-æ–‡ç« æ¨¡å—çš„è“å›¾å®šä¹‰" class="headerlink" title="article/__init__.py (æ–‡ç« æ¨¡å—çš„è“å›¾å®šä¹‰)"></a><code>article/__init__.py</code> (æ–‡ç« æ¨¡å—çš„è“å›¾å®šä¹‰)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸º &#x27;article&#x27; çš„è“å›¾</span></span><br><span class="line">article_bp = Blueprint(<span class="string">&#x27;article&#x27;</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> routes  <span class="comment"># å¯¼å…¥æ–‡ç« æ¨¡å—çš„è·¯ç”±å®šä¹‰</span></span><br></pre></td></tr></table></figure><h4 id="article-routes-py-æ–‡ç« æ¨¡å—çš„è·¯ç”±å®šä¹‰"><a href="#article-routes-py-æ–‡ç« æ¨¡å—çš„è·¯ç”±å®šä¹‰" class="headerlink" title="article/routes.py (æ–‡ç« æ¨¡å—çš„è·¯ç”±å®šä¹‰)"></a><code>article/routes.py</code> (æ–‡ç« æ¨¡å—çš„è·¯ç”±å®šä¹‰)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template, request, redirect, url_for, flash</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> db, Article</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> article_bp</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ–‡ç« ç›¸å…³çš„è·¯ç”±</span></span><br><span class="line"><span class="meta">@article_bp.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    articles = Article.query.<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, articles=articles)</span><br><span class="line"></span><br><span class="line"><span class="meta">@article_bp.route(<span class="params"><span class="string">&#x27;/&lt;int:id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">article</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    article = Article.query.get_or_404(<span class="built_in">id</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;article.html&#x27;</span>, article=article)</span><br><span class="line"></span><br><span class="line"><span class="meta">@article_bp.route(<span class="params"><span class="string">&#x27;/create&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_article</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        title = request.form[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">        content = request.form[<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> title <span class="keyword">and</span> content:</span><br><span class="line">            new_article = Article(title=title, content=content)</span><br><span class="line">            db.session.add(new_article)</span><br><span class="line">            db.session.commit()</span><br><span class="line">            flash(<span class="string">&#x27;Article created successfully!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;article.index&#x27;</span>))  <span class="comment"># ä½¿ç”¨è“å›¾åæ¥ç”Ÿæˆ URL</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&#x27;Title and Content are required.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;create_article.html&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="user-init-py-ç”¨æˆ·æ¨¡å—çš„è“å›¾å®šä¹‰"><a href="#user-init-py-ç”¨æˆ·æ¨¡å—çš„è“å›¾å®šä¹‰" class="headerlink" title="user/__init__.py (ç”¨æˆ·æ¨¡å—çš„è“å›¾å®šä¹‰)"></a><code>user/__init__.py</code> (ç”¨æˆ·æ¨¡å—çš„è“å›¾å®šä¹‰)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸º &#x27;user&#x27; çš„è“å›¾</span></span><br><span class="line">user_bp = Blueprint(<span class="string">&#x27;user&#x27;</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> routes  <span class="comment"># å¯¼å…¥ç”¨æˆ·æ¨¡å—çš„è·¯ç”±å®šä¹‰</span></span><br></pre></td></tr></table></figure><h4 id="user-routes-py-ç”¨æˆ·æ¨¡å—çš„è·¯ç”±å®šä¹‰"><a href="#user-routes-py-ç”¨æˆ·æ¨¡å—çš„è·¯ç”±å®šä¹‰" class="headerlink" title="user/routes.py (ç”¨æˆ·æ¨¡å—çš„è·¯ç”±å®šä¹‰)"></a><code>user/routes.py</code> (ç”¨æˆ·æ¨¡å—çš„è·¯ç”±å®šä¹‰)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template, redirect, url_for, flash</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> user_bp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šç”¨æˆ·ç™»å½•è·¯ç”±</span></span><br><span class="line"><span class="meta">@user_bp.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># å‡è®¾è¿™é‡Œå¤„ç†ç™»å½•é€»è¾‘</span></span><br><span class="line">        flash(<span class="string">&#x27;User logged in successfully!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user.profile&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šç”¨æˆ·ä¸ªäººèµ„æ–™é¡µé¢</span></span><br><span class="line"><span class="meta">@user_bp.route(<span class="params"><span class="string">&#x27;/profile&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;profile.html&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="3-è°ƒæ•´åçš„-config-py-å’Œ-models-py"><a href="#3-è°ƒæ•´åçš„-config-py-å’Œ-models-py" class="headerlink" title="3. è°ƒæ•´åçš„ config.py å’Œ models.py"></a>3. è°ƒæ•´åçš„ <code>config.py</code> å’Œ <code>models.py</code></h3><p>è¿™ä¸¤ä¸ªæ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œå¯ä»¥ç»§ç»­ä¿æŒä¹‹å‰çš„å†…å®¹ã€‚</p><h3 id="4-æ“ä½œæ­¥éª¤"><a href="#4-æ“ä½œæ­¥éª¤" class="headerlink" title="4. æ“ä½œæ­¥éª¤"></a>4. æ“ä½œæ­¥éª¤</h3><h4 id="1-å®‰è£…ä¾èµ–-1"><a href="#1-å®‰è£…ä¾èµ–-1" class="headerlink" title="1. å®‰è£…ä¾èµ–"></a>1. å®‰è£…ä¾èµ–</h4><p>ä¸ä¹‹å‰ç›¸åŒï¼Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv venv</span><br><span class="line"><span class="built_in">source</span> venv/bin/activate  <span class="comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (Windows ç”¨æˆ·æ‰§è¡Œ venv\Scripts\activate)</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><h4 id="2-åˆå§‹åŒ–æ•°æ®åº“-1"><a href="#2-åˆå§‹åŒ–æ•°æ®åº“-1" class="headerlink" title="2. åˆå§‹åŒ–æ•°æ®åº“"></a>2. åˆå§‹åŒ–æ•°æ®åº“</h4><p>ä½¿ç”¨ Flask Shell åˆå§‹åŒ–æ•°æ®åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">&gt;&gt;&gt; from app import db</span><br><span class="line">&gt;&gt;&gt; db.create_all()</span><br></pre></td></tr></table></figure><h4 id="3-è¿è¡Œåº”ç”¨-1"><a href="#3-è¿è¡Œåº”ç”¨-1" class="headerlink" title="3. è¿è¡Œåº”ç”¨"></a>3. è¿è¡Œåº”ç”¨</h4><p>å¯åŠ¨ Flask åº”ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python app.py</span><br></pre></td></tr></table></figure><p>åº”ç”¨å°†åœ¨ <code>http://127.0.0.1:5000/</code> ä¸Šè¿è¡Œã€‚</p><h3 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h3><p>é€šè¿‡ä½¿ç”¨ Flask çš„è“å›¾ï¼ˆBlueprintï¼‰ï¼Œæˆ‘ä»¬å°†ä¸åŒçš„è·¯ç”±æ¨¡å—åŒ–å¤„ç†ï¼Œç±»ä¼¼äº SpringBoot ä¸­çš„æ§åˆ¶å™¨æ¨¡å—åŒ–è®¾è®¡ã€‚è¿™æ ·åšä¸ä»…ä½¿ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ï¼Œè¿˜ä¸ºåæœŸæ‰©å±•åº”ç”¨åŠŸèƒ½æä¾›äº†æ–¹ä¾¿ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸ºç½‘ç«™æ·»åŠ æ–°çš„æ¨¡å—ï¼Œå¦‚ç”¨æˆ·ç®¡ç†ã€è¯„è®ºç³»ç»Ÿç­‰ï¼Œä¿æŒæ¯ä¸ªæ¨¡å—ç‹¬ç«‹å¼€å‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-01 æ•°æ®ç»“æ„</title>
      <link href="/2025/02/26/75-01%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2025/02/26/75-01%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="75-01-æ•°æ®ç»“æ„"><a href="#75-01-æ•°æ®ç»“æ„" class="headerlink" title="75-01 æ•°æ®ç»“æ„"></a>75-01 æ•°æ®ç»“æ„</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://oi-wiki.org/dp/tree/">æ ‘å½¢ DP</a></li><li></li><li></li></ul><h2 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h2><h3 id="äºŒå‰æŸ¥æ‰¾æ ‘"><a href="#äºŒå‰æŸ¥æ‰¾æ ‘" class="headerlink" title="äºŒå‰æŸ¥æ‰¾æ ‘"></a>äºŒå‰æŸ¥æ‰¾æ ‘</h3><p>äºŒå‰æ ‘å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼šå·¦å­æ ‘çš„é”®å€¼å°äºæ ¹çš„é”®å€¼ï¼Œå³å­æ ‘çš„é”®å€¼å¤§äºæ ¹çš„é”®å€¼ã€‚ </p><p>å¦‚æœæ ¹èŠ‚ç‚¹é€‰çš„ä¸å¥½ä¼šå¯¼è‡´äºŒå‰æ ‘è¿‡æ·±ã€‚</p><h3 id="å¹³è¡¡äºŒå‰æ ‘"><a href="#å¹³è¡¡äºŒå‰æ ‘" class="headerlink" title="å¹³è¡¡äºŒå‰æ ‘"></a>å¹³è¡¡äºŒå‰æ ‘</h3><p>å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVLæ ‘ï¼‰åœ¨ç¬¦åˆäºŒå‰æŸ¥æ‰¾æ ‘çš„æ¡ä»¶ä¸‹ï¼Œè¿˜æ»¡è¶³<strong>ä»»ä½•èŠ‚ç‚¹çš„ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦æœ€å¤§å·®ä¸º1</strong>ã€‚ä¸‹é¢çš„ä¸¤å¼ å›¾ç‰‡ï¼Œå·¦è¾¹æ˜¯AVLæ ‘ï¼Œå®ƒçš„ä»»ä½•èŠ‚ç‚¹çš„ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®&lt;&#x3D;1ï¼›å³è¾¹çš„ä¸æ˜¯AVLæ ‘ï¼Œå…¶æ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘é«˜åº¦ä¸º3ï¼Œè€Œå³å­æ ‘é«˜åº¦ä¸º1ï¼›</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262024067.png" alt="image-20241014153843893"></p><p>é‚£ä¹ˆè¿™é‡Œå°±ä¼šæ¶‰åŠåˆ°ä¸€äº›å¤æ‚çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘å¯¹è¿™ä¸ªæ ‘è¿›è¡Œå¢åˆ æ”¹æŸ¥ä¹‹åï¼Œå¯¼è‡´äº†è¿™ä¸ªæ ‘ä¸å¹³è¡¡äº†è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262024699.png" alt="image-20241014154528103"> </p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262024981.png" alt="image-20241014154546934"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262024974.png" alt="image-20241014155236494"></p><p>è®°ä½RLå’ŒLRçš„æ—‹è½¬å³å¯ï¼ŒRLè¡¨ç¤ºæ ¹èŠ‚ç‚¹çš„å³è¾¹èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹æ¯”è¾ƒé«˜ï¼Œè¿™æ˜¯åå°±åº”è¯¥ï¼Œå³è¾¹èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹åšå³è¾¹æ ¹èŠ‚ç‚¹ï¼Œåœ¨æŠŠæ ¹èŠ‚ç‚¹æ›¿æ¢æˆè¯¥èŠ‚ç‚¹ï¼Œå…¶å®å°±æ˜¯é€‰æ ¹èŠ‚ç‚¹ã€‚</p><p>RLè¡¨ç¤ºé€‰çš„å“ªä¸ªæ˜¯æ ¹èŠ‚ç‚¹ã€‚</p><h3 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h3><p>é¦–å…ˆ,ä¸€ä¸ªMé˜¶çš„Bæ ‘çš„å®šä¹‰ä¸º:</p><ol><li><strong>æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰Mä¸ªå­èŠ‚ç‚¹ï¼›</strong></li><li>æ¯ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ï¼ˆé™¤æ ¹èŠ‚ç‚¹ï¼‰è‡³å°‘æœ‰ceil(M&#x2F;2)ä¸ªå­èŠ‚ç‚¹ï¼›</li><li>å¦‚æœæ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè‡³å°‘æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼›</li><li>æœ‰kä¸ªå­èŠ‚ç‚¹çš„éå¶å­èŠ‚ç‚¹æ‹¥æœ‰k-1ä¸ªé”®ï¼Œé”®æŒ‰ç…§å‡åºæ’åˆ—ï¼›</li><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹åœ¨åŒä¸€å±‚ï¼›</li></ol><p>B-Treeä¹Ÿç§°ä¸ºå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œçœ‹å›¾è¯´è¯ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262024165.png" alt="image-20241014152905749"></p><p><strong>B-Treeæ˜¯ä¸ºç£ç›˜ç­‰å¤–å­˜å‚¨è®¾å¤‡è®¾è®¡çš„ä¸€ç§å¹³è¡¡æŸ¥æ‰¾æ ‘ã€‚å› æ­¤åœ¨è®²B-Treeä¹‹å‰å…ˆäº†è§£ä¸‹ç£ç›˜çš„ç›¸å…³çŸ¥è¯†ã€‚</strong></p><p><strong>B-Treeç›¸æ¯”è¾ƒå¹³è¡¡äºŒå‰æ ‘å°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨çš„æ•°æ®å˜å¤šäº†ï¼Œä¸ºä»€ä¹ˆå˜å¤šï¼Œè¿™æ˜¯ä¸ºäº†é€‚åº”ç³»ç»Ÿæ¯æ¬¡ä»ç£ç›˜ä¸­è¯»å–æ•°æ®éƒ½æ˜¯ä»¥å—ä¸ºåŸºæœ¬å•ä½è¯»å–ï¼Œå¦‚æœè¿™ä¸€ä¸ªå—éƒ½æ˜¯è¿™ä¸ªèŠ‚ç‚¹æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆçš„é¿å…äº†ç³»ç»ŸIOæ“ä½œæ¬¡æ•°ï¼Œè¿™æ•ˆç‡ä¸å°±ä¸Šæ¥äº†å—ã€‚</strong></p><blockquote><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿè¿™éƒ½æ˜¯æœ‰åŸå› çš„ï¼ŒMySQLä½œä¸ºç¡¬ç›˜å­˜å‚¨æ•°æ®åº“ï¼Œé€‰ç”¨B+Treeä½œä¸ºå…¶æ•°æ®ç»“æ„éå¸¸é€‚åˆã€‚</p><p>ç³»ç»Ÿä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜æ—¶æ˜¯ä»¥**ç£ç›˜å—ï¼ˆblockï¼‰**ä¸ºåŸºæœ¬å•ä½çš„ï¼Œä½äºåŒä¸€ä¸ªç£ç›˜å—ä¸­çš„æ•°æ®ä¼šè¢«ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼Œè€Œä¸æ˜¯éœ€è¦ä»€ä¹ˆå–ä»€ä¹ˆã€‚</p><p>ç”±äºB+TreeèŠ‚ç‚¹å®¹é‡å¤§ï¼Œæ¯æ¬¡è¯»å–æ—¶åŠ è½½åˆ°å†…å­˜ä¸­çš„æ•°æ®ä¹Ÿæ›´å¤šï¼Œå‡å°‘äº†ç¡¬ç›˜çš„<strong>I&#x2F;Oæ“ä½œæ¬¡æ•°</strong>ã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“ä¸­æœ‰é¡µï¼ˆPageï¼‰çš„æ¦‚å¿µï¼Œé¡µæ˜¯å…¶ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ã€‚InnoDBå­˜å‚¨å¼•æ“ä¸­é»˜è®¤æ¯ä¸ªé¡µçš„å¤§å°ä¸º16KBï¼Œå¯é€šè¿‡å‚æ•°innodb_page_sizeå°†é¡µçš„å¤§å°è®¾ç½®ä¸º4Kã€8Kã€16Kï¼Œåœ¨<a href="http://lib.csdn.net/base/mysql">MySQL</a>ä¸­å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é¡µçš„å¤§å°ã€‚</p></blockquote><h3 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h3><p>B+Treeæ˜¯åœ¨B-TreeåŸºç¡€ä¸Šçš„ä¸€ç§ä¼˜åŒ–ï¼Œä½¿å…¶æ›´é€‚åˆå®ç°å¤–å­˜å‚¨ç´¢å¼•ç»“æ„ï¼ŒInnoDBå­˜å‚¨å¼•æ“å°±æ˜¯ç”¨B+Treeå®ç°å…¶ç´¢å¼•ç»“æ„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262024757.png" alt="image-20241014161223591"></p><p>B+Treeç›¸å¯¹äºB-Treeæœ‰å‡ ç‚¹ä¸åŒï¼š</p><ol><li>éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ä¿¡æ¯ã€‚</li><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹ä¹‹é—´éƒ½æœ‰ä¸€ä¸ªé“¾æŒ‡é’ˆã€‚</li><li>æ•°æ®è®°å½•éƒ½å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚</li></ol><p>InnoDBå­˜å‚¨å¼•æ“ä¸­é¡µçš„å¤§å°ä¸º16KBï¼Œä¸€èˆ¬è¡¨çš„ä¸»é”®ç±»å‹ä¸ºINTï¼ˆå ç”¨4ä¸ªå­—èŠ‚ï¼‰æˆ–BIGINTï¼ˆå ç”¨8ä¸ªå­—èŠ‚ï¼‰ï¼ŒæŒ‡é’ˆç±»å‹ä¹Ÿä¸€èˆ¬ä¸º4æˆ–8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡µï¼ˆB+Treeä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ä¸­å¤§æ¦‚å­˜å‚¨16KB&#x2F;(8B+8B)&#x3D;1Kä¸ªé”®å€¼ï¼ˆå› ä¸ºæ˜¯ä¼°å€¼ï¼Œä¸ºæ–¹ä¾¿è®¡ç®—ï¼Œè¿™é‡Œçš„Kå–å€¼ä¸ºã€–10ã€—^3ï¼‰^ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ·±åº¦ä¸º3çš„B+Treeç´¢å¼•å¯ä»¥ç»´æŠ¤10^3  10^3 * 10^3 &#x3D; 10äº¿ æ¡è®°å½•ã€‚</p><p>å®é™…æƒ…å†µä¸­æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸èƒ½å¡«å……æ»¡ï¼Œå› æ­¤åœ¨æ•°æ®åº“ä¸­ï¼ŒB+Treeçš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨2-4å±‚ã€‚<a href="http://lib.csdn.net/base/mysql">mysql</a>çš„InnoDBå­˜å‚¨å¼•æ“åœ¨è®¾è®¡æ—¶æ˜¯å°†æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶æœ€å¤šåªéœ€è¦1~3æ¬¡ç£ç›˜I&#x2F;Oæ“ä½œã€‚</p><p><strong>æ•°æ®åº“ä¸­çš„B+Treeç´¢å¼•å¯ä»¥åˆ†ä¸ºèšé›†ç´¢å¼•ï¼ˆclustered indexï¼‰å’Œè¾…åŠ©ç´¢å¼•ï¼ˆsecondary indexï¼‰</strong>ã€‚ä¸Šé¢çš„B+Treeç¤ºä¾‹å›¾åœ¨æ•°æ®åº“ä¸­çš„å®ç°å³ä¸ºèšé›†ç´¢å¼•ï¼Œèšé›†ç´¢å¼•çš„B+Treeä¸­çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æ•´å¼ è¡¨çš„è¡Œè®°å½•æ•°æ®ã€‚è¾…åŠ©ç´¢å¼•ä¸èšé›†ç´¢å¼•çš„åŒºåˆ«åœ¨äºè¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å¹¶ä¸åŒ…å«è¡Œè®°å½•çš„å…¨éƒ¨æ•°æ®ï¼Œè€Œæ˜¯å­˜å‚¨ç›¸åº”è¡Œæ•°æ®çš„èšé›†ç´¢å¼•é”®ï¼Œå³ä¸»é”®ã€‚å½“é€šè¿‡è¾…åŠ©ç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šéå†è¾…åŠ©ç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®åœ¨èšé›†ç´¢å¼•ä¸­æ‰¾åˆ°å®Œæ•´çš„è¡Œè®°å½•æ•°æ®ã€‚</p><h3 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h3><p>çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆçš„æŸ¥æ‰¾æ ‘ã€‚å®ƒæ˜¯ç”± Rudolf Bayer äº1978å¹´å‘æ˜ï¼Œåœ¨å½“æ—¶è¢«ç§°ä¸ºå¹³è¡¡äºŒå‰ B æ ‘(symmetric binary B-trees)ã€‚åæ¥ï¼Œåœ¨1978å¹´è¢« Leo J. Guibas å’Œ Robert Sedgewick ä¿®æ”¹ä¸ºå¦‚ä»Šçš„çº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘å…·æœ‰è‰¯å¥½çš„æ•ˆç‡ï¼Œå®ƒå¯åœ¨ O(logN) æ—¶é—´å†…å®ŒæˆæŸ¥æ‰¾ã€å¢åŠ ã€åˆ é™¤ç­‰æ“ä½œã€‚</p><p>å®ƒæ˜¯å…·å¤‡äº†æŸäº›ç‰¹æ€§çš„äºŒå‰æœç´¢æ ‘ï¼Œèƒ½è§£å†³éå¹³è¡¡æ ‘é—®é¢˜ï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ç§æ¥è¿‘å¹³è¡¡çš„äºŒå‰æ ‘ï¼ˆè¯´å®ƒæ˜¯æ¥è¿‘å¹³è¡¡å› ä¸ºå®ƒå¹¶æ²¡æœ‰åƒAVLæ ‘çš„å¹³è¡¡å› å­çš„æ¦‚å¿µï¼Œå®ƒåªæ˜¯é ç€æ»¡è¶³çº¢é»‘èŠ‚ç‚¹çš„5æ¡æ€§è´¨æ¥ç»´æŒä¸€ç§æ¥è¿‘å¹³è¡¡çš„ç»“æ„ï¼Œè¿›è€Œæå‡æ•´ä½“çš„æ€§èƒ½ï¼Œå¹¶æ²¡æœ‰ä¸¥æ ¼çš„å¡å®šæŸä¸ªå¹³è¡¡å› å­æ¥ç»´æŒç»å¯¹å¹³è¡¡ï¼‰</p><p>å³çº¢é»‘æ ‘åœ¨å¹³è¡¡äºŒå‰æ ‘çš„åŸºç¡€ä¸Šç‰ºç‰²ä¸€äº›æ ‡å‡†æ¥æé«˜å…¶è¿è¡Œæ•ˆç‡ã€‚</p><p>é¦–å…ˆï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ä¸ªäºŒå‰æœç´¢æ ‘ï¼Œå®ƒåœ¨æ¯ä¸ªèŠ‚ç‚¹å¢åŠ äº†ä¸€ä¸ªå­˜å‚¨ä½è®°å½•èŠ‚ç‚¹çš„é¢œè‰²ï¼Œå¯ä»¥æ˜¯RED,ä¹Ÿå¯ä»¥æ˜¯BLACKï¼›é€šè¿‡ä»»æ„ä¸€æ¡ä»æ ¹åˆ°å¶å­ç®€å•è·¯å¾„ä¸Šé¢œè‰²çš„çº¦æŸï¼Œçº¢é»‘æ ‘ä¿è¯æœ€é•¿è·¯å¾„ä¸è¶…è¿‡æœ€çŸ­è·¯å¾„çš„äºŒå€ï¼Œå› è€Œè¿‘ä¼¼å¹³è¡¡ï¼ˆæœ€çŸ­è·¯å¾„å°±æ˜¯å…¨é»‘èŠ‚ç‚¹ï¼Œæœ€é•¿è·¯å¾„å°±æ˜¯ä¸€ä¸ªçº¢èŠ‚ç‚¹ä¸€ä¸ªé»‘èŠ‚ç‚¹ï¼Œå½“ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸Šé»‘è‰²èŠ‚ç‚¹ç›¸åŒæ—¶ï¼Œæœ€é•¿è·¯å¾„åˆšå¥½æ˜¯æœ€çŸ­è·¯å¾„çš„ä¸¤å€ï¼‰ã€‚å®ƒåŒæ—¶æ»¡è¶³ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²</li><li>æ ¹æ˜¯é»‘è‰²</li><li>å¶å­èŠ‚ç‚¹ï¼ˆå¤–éƒ¨èŠ‚ç‚¹ï¼Œç©ºèŠ‚ç‚¹ï¼‰éƒ½æ˜¯é»‘è‰²ï¼Œè¿™é‡Œçš„å¶å­èŠ‚ç‚¹æŒ‡çš„æ˜¯æœ€åº•å±‚çš„ç©ºèŠ‚ç‚¹ï¼ˆå¤–éƒ¨èŠ‚ç‚¹ï¼‰ï¼Œä¸‹å›¾ä¸­çš„é‚£äº›nullèŠ‚ç‚¹æ‰æ˜¯å¶å­èŠ‚ç‚¹ï¼ŒnullèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹åœ¨çº¢é»‘æ ‘é‡Œä¸å°†å…¶çœ‹ä½œå¶å­èŠ‚ç‚¹</li><li>çº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²<ul><li>çº¢è‰²èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²</li><li>ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ 2 ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹</li></ul></li><li>ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262024442.png" alt="image-20241014164412042"></p><p>AVLæ˜¯é å¹³è¡¡å› å­æ¥ä¿æŒå¹³è¡¡çš„ï¼Œæ¯”å¦‚å¹³è¡¡å› å­ä¸º1ï¼Œé‚£ä¹ˆå·¦å³å­æ ‘çš„é«˜åº¦å·®å°±ä¸èƒ½è¶…è¿‡1ï¼Œæ˜¯ä¸€ç§å¼ºå¹³è¡¡ã€‚</p><p>å¯¹äºçº¢é»‘æ ‘è€Œè¨€ï¼Œä¸ºä½•é‚£5æ¡æ€§è´¨ï¼Œå°±èƒ½ä¿è¯çº¢é»‘æ ‘æ˜¯å¹³è¡¡çš„ï¼Ÿ</p><ul><li>å› ä¸ºé‚£5æ¡æ€§è´¨ï¼Œå¯ä»¥ä¿è¯çº¢é»‘æ ‘ç­‰ä»·äº4é˜¶Bæ ‘</li></ul><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><p><a href="https://blog.csdn.net/m0_63033419/article/details/127524644">æ’åºç®—æ³• â€”â€” å¸Œå°”æ’åºï¼ˆå›¾æ–‡è¶…è¯¦ç»†ï¼‰</a></p></li><li><p><a href="https://www.runoob.com/w3cnote/ten-sorting-algorithm.html">åå¤§ç»å…¸æ’åºç®—æ³•</a></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502281826324.png" alt="img"></p><h2 id="KMPç®—æ³•"><a href="#KMPç®—æ³•" class="headerlink" title="KMPç®—æ³•"></a>KMPç®—æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">getNext</span><span class="params">(<span class="type">char</span>* s,<span class="type">int</span> len)</span>&#123;</span><br><span class="line">    next[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//k = next[0]</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; len)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i] == s[k])&#123;</span><br><span class="line">            next[i++] = ++k; <span class="comment">//next[j+1] = k+1;</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(k &gt; <span class="number">0</span>)k = next[k-<span class="number">1</span>]; <span class="comment">//k = next[k-1]</span></span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                next[i++] = k; <span class="comment">//next[j+1] = 0 å›æº¯åˆ°å¤´äº†ï¼Œæ‰¾ä¸åˆ°ç›¸åŒå‰ç¼€ï¼Œåˆ™æœ€å¤§ç›¸åŒå‰åç¼€é•¿åº¦=0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-02 æ“ä½œç³»ç»Ÿ</title>
      <link href="/2025/02/26/75-02%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
      <url>/2025/02/26/75-02%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="75-02-æ“ä½œç³»ç»Ÿ"><a href="#75-02-æ“ä½œç³»ç»Ÿ" class="headerlink" title="75-02 æ“ä½œç³»ç»Ÿ"></a>75-02 æ“ä½œç³»ç»Ÿ</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ“ä½œç³»ç»Ÿåœ¨æœ¬ç§‘çš„è¯¾ç¨‹ä¸­å°±æœ‰è¿‡å­¦ä¹ ï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºæ—¶é—´è¾ƒé•¿äº†å¯¼è‡´ç›¸å…³çš„è®°å¿†å¹¶ä¸æ˜¯å¾ˆæ·±åˆ»ï¼ŒåŒæ—¶å¦ä¸€æ–¹é¢æ˜¯å› ä¸ºåœ¨å¤§å­¦ä¸­å­¦çš„æ“ä½œç³»ç»Ÿä»…ä»…åªæ˜¯ä¸ºäº†åº”ä»˜è€ƒè¯•ï¼Œå¯¼è‡´å¯¹å…¶å¹¶ä¸æ˜¯çœŸæ­£çš„ç†è§£äº†ã€‚æ‰€ä»¥åœ¨è¿™é‡Œå†æ¬¡å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œç³»ç»Ÿæ€§çš„æ¢³ç†å’Œå­¦ä¹ ã€‚</p><p>æ“ä½œç³»ç»Ÿç®€å•çš„æ¥è¯´å°±æ˜¯å¯¹è®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†ï¼Œç±»ä¼¼ä¸€ä¸ªç®¡å®¶ï¼Œå®ƒè´Ÿè´£ç®¡ç†ä½ çš„è®¡ç®—æœºèµ„æºï¼Œæ¯”å¦‚ï¼šä½ çš„å†…å­˜ã€ä½ çš„å¤–å­˜ã€ä½ çš„CPUã€ä½ çš„GPUç­‰ç­‰ï¼Œä½ æ‰€æœ‰çš„è®¡ç®—æœºèµ„æºéƒ½ä¼šç”±æ“ä½œç³»ç»Ÿè¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ã€‚</p><p>é‚£ä¹ˆæ“ä½œç³»ç»ŸæŒ‰ç…§åŠŸèƒ½æ¨¡å—æ¥åˆ†å°±å¯ä»¥åˆ†ä¸ºï¼šå†…å­˜ç®¡ç†æ¨¡å—ã€æ–‡ä»¶ï¼ˆæ–‡ä»¶éƒ½æ˜¯ä¿å­˜åœ¨å¤–å­˜çš„å˜›ï¼‰ç®¡ç†æ¨¡å—ã€è¿›ç¨‹ï¼ˆè¿›ç¨‹éƒ½æ˜¯ç”±CPUè¿è¡Œçš„å˜›ï¼‰ç®¡ç†æ¨¡å—ã€è®¾å¤‡ç®¡ç†å’Œç½‘ç»œç³»ç»Ÿç­‰äº”å¤§æ¨¡å—ã€‚å…¶ä¸­å†…å­˜ã€æ–‡ä»¶å’Œè¿›ç¨‹ç®¡ç†æœ€ä¸ºé‡è¦ã€‚ä¸‹é¢æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„å»äº†è§£è¿™ä¸ªæ“ä½œç³»ç»Ÿã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091255107.png" alt="image-20250309125546036"></p><h2 id="ç¡¬ä»¶ç»“æ„"><a href="#ç¡¬ä»¶ç»“æ„" class="headerlink" title="ç¡¬ä»¶ç»“æ„"></a>ç¡¬ä»¶ç»“æ„</h2><h3 id="CPUæ¶æ„å›¾"><a href="#CPUæ¶æ„å›¾" class="headerlink" title="CPUæ¶æ„å›¾"></a>CPUæ¶æ„å›¾</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262026720.png" alt="image-20241021170702988"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ª CPU é‡Œé€šå¸¸ä¼šæœ‰å¤šä¸ª CPU æ ¸å¿ƒï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­çš„ 1 å·å’Œ 2 å· CPU æ ¸å¿ƒï¼Œå¹¶ä¸”æ¯ä¸ª CPU æ ¸å¿ƒéƒ½æœ‰è‡ªå·±çš„ L1 Cache å’Œ L2 Cacheï¼Œè€Œ L1 Cache é€šå¸¸åˆ†ä¸º dCacheï¼ˆæ•°æ®ç¼“å­˜ï¼‰ å’Œ iCacheï¼ˆæŒ‡ä»¤ç¼“å­˜ï¼‰ï¼ŒL3 Cache åˆ™æ˜¯å¤šä¸ªæ ¸å¿ƒå…±äº«çš„ï¼Œè¿™å°±æ˜¯ CPU å…¸å‹çš„ç¼“å­˜å±‚æ¬¡ã€‚</p><p>CPU ä»å†…å­˜ä¸­è¯»å–æ•°æ®åˆ° Cache çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚è¯»å–ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—çš„æ–¹å¼æ¥è¯»å–æ•°æ®çš„ï¼Œè¿™ä¸€å—ä¸€å—çš„æ•°æ®è¢«ç§°ä¸º CPU Cache  Lineï¼ˆç¼“å­˜å—ï¼‰ï¼Œæ‰€ä»¥ CPU Cache  Line æ˜¯ CPU ä»å†…å­˜è¯»å–æ•°æ®åˆ° Cache çš„å•ä½ã€‚</p><h3 id="ä¼ªå…±äº«"><a href="#ä¼ªå…±äº«" class="headerlink" title="ä¼ªå…±äº«"></a>ä¼ªå…±äº«</h3><p><a href="https://xiaolincoding.com/os/1_hardware/how_cpu_deal_task.html#%E5%88%86%E6%9E%90%E4%BC%AA%E5%85%B1%E4%BA%AB%E7%9A%84%E9%97%AE%E9%A2%98">https://xiaolincoding.com/os/1_hardware/how_cpu_deal_task.html#%E5%88%86%E6%9E%90%E4%BC%AA%E5%85%B1%E4%BA%AB%E7%9A%84%E9%97%AE%E9%A2%98</a></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262027147.png" alt="image-20241021171922569"></p><h3 id="è°ƒåº¦å™¨"><a href="#è°ƒåº¦å™¨" class="headerlink" title="è°ƒåº¦å™¨"></a>è°ƒåº¦å™¨</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262026319.png" alt="image-20241021172929186"></p><h3 id="ä¸­æ–­"><a href="#ä¸­æ–­" class="headerlink" title="ä¸­æ–­"></a>ä¸­æ–­</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262026953.png" alt="image-20241021174117845"></p><p>é‚£ Linux ç³»ç»Ÿ<strong>ä¸ºäº†è§£å†³ä¸­æ–­å¤„ç†ç¨‹åºæ‰§è¡Œè¿‡é•¿å’Œä¸­æ–­ä¸¢å¤±çš„é—®é¢˜ï¼Œå°†ä¸­æ–­è¿‡ç¨‹åˆ†æˆäº†ä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ã€Œä¸ŠåŠéƒ¨å’Œä¸‹åŠéƒ¨åˆ†ã€</strong>ã€‚</p><h3 id="CPUç¼“å­˜ä¸€è‡´æ€§"><a href="#CPUç¼“å­˜ä¸€è‡´æ€§" class="headerlink" title="CPUç¼“å­˜ä¸€è‡´æ€§"></a>CPUç¼“å­˜ä¸€è‡´æ€§</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262026758.png" alt="image-20241022205653149"></p><p>è¿™æ˜¯ç›®å‰CPUçš„æ¶æ„å›¾ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹CPUæ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚</p><p>ç›®å‰çš„CPUå…·æœ‰å¤šä¸ªæ ¸å¿ƒï¼Œå‡è®¾è¿™ä¸ªCPUå…·æœ‰ä¸¤ä¸ªæ ¸å¿ƒï¼Œç°åœ¨è¿™ä¸¤ä¸ªæ ¸å¿ƒåˆ†åˆ«è¿è¡Œç€ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹ä¼šæŠŠè¯¥çº¿ç¨‹ç›®å‰éœ€è¦ç”¨åˆ°çš„æ•°æ®ä»å†…å­˜ä¸­åŠ è½½åˆ°CPU Cacheä¸­ï¼Œå‡è®¾ç°åœ¨ä¸¤ä¸ªçº¿ç¨‹éƒ½å¯¹å˜é‡aè¿›è¡Œæ“ä½œï¼Œéƒ½å¯¹å…¶æ‰§è¡Œa++,ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œåï¼Œå†™å…¥CPU Cacheä¸­ï¼Œç„¶åå†™ä¼šåˆ°å†…å­˜ä¸­ï¼Œæ­¤æ—¶çš„aä¼šæ˜¯2ï¼Œä¸å®é™…çš„3ä¸ç¬¦åˆã€‚</p><p>å¯¹äºCPU Cacheä¸­çš„æ•°æ®ä»€ä¹ˆæ—¶å€™å†™å›åˆ°å†…å­˜ä¸­å‘¢ï¼Ÿç°åœ¨æœ‰ä¸¤ç§æ–¹æ³•ï¼šå†™ç›´è¾¾å’Œå†™å›ã€‚</p><h4 id="å†™ç›´è¾¾"><a href="#å†™ç›´è¾¾" class="headerlink" title="å†™ç›´è¾¾"></a>å†™ç›´è¾¾</h4><p>å¾ˆç®€å•å¦‚æœCPUè¿›è¡Œä¿®æ”¹äº†ï¼Œç›´æ¥æŠŠä¿®æ”¹çš„å€¼å†™åˆ°CPU Cacheå’Œå†…å­˜ä¸­ã€‚</p><h4 id="å†™å›"><a href="#å†™å›" class="headerlink" title="å†™å›"></a>å†™å›</h4><p>æ—¢ç„¶å†™ç›´è¾¾ç”±äºæ¯æ¬¡å†™æ“ä½œéƒ½ä¼šæŠŠæ•°æ®å†™å›åˆ°å†…å­˜ï¼Œâ½½å¯¼è‡´å½±å“æ€§èƒ½ï¼Œäºæ˜¯ä¸ºäº†è¦å‡å°‘æ•°æ® å†™å›å†…å­˜çš„é¢‘ç‡ï¼Œå°±å‡ºç°äº†å†™å›ï¼ˆWrite Backï¼‰çš„â½…æ³•ã€‚ åœ¨å†™å›æœºåˆ¶ä¸­ï¼Œå½“å‘â½£å†™æ“ä½œæ—¶ï¼Œæ–°çš„æ•°æ®ä»…ä»…è¢«å†™â¼Š Cache Block â¾¥ï¼Œåªæœ‰å½“ä¿®æ”¹è¿‡çš„ Cache Blockã€Œè¢«æ›¿æ¢ã€æ—¶æ‰éœ€è¦å†™åˆ°å†…å­˜ä¸­ï¼Œå‡å°‘äº†æ•°æ®å†™å›å†…å­˜çš„é¢‘ç‡ï¼Œè¿™æ ·ä¾¿å¯ä»¥æ â¾¼ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><p>å¯ä»¥å‘ç°å†™å›è¿™ä¸ªâ½…æ³•ï¼Œåœ¨æŠŠæ•°æ®å†™â¼Šåˆ° Cache çš„æ—¶å€™ï¼Œåªæœ‰åœ¨ç¼“å­˜ä¸å‘½ä¸­ï¼ŒåŒæ—¶æ•°æ®å¯¹åº” çš„ Cache ä¸­çš„ Cache Block ä¸ºè„æ ‡è®°çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šå°†æ•°æ®å†™åˆ°å†…å­˜ä¸­ï¼Œâ½½åœ¨ç¼“å­˜å‘½ä¸­çš„æƒ… å†µä¸‹ï¼Œåˆ™åœ¨å†™â¼Šå Cache åï¼Œåªéœ€æŠŠè¯¥æ•°æ®å¯¹åº”çš„ Cache Block æ ‡è®°ä¸ºè„å³å¯ï¼Œâ½½ä¸â½¤å†™åˆ° å†…å­˜â¾¥</p><p>å›åˆ°åŸæ¥çš„é—®é¢˜ä¸Šï¼Œå¦‚ä½•è§£å†³CPUç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜å‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼šå†™ä¼ æ’­å’Œäº‹åŠ¡ä¸²è¡ŒåŒ–ã€‚</p><p>å†™ä¼ æ’­å°±æ˜¯å†™äº†ä¹‹åå‘Šè¯‰æ‰€æœ‰CPUæ ¸å¿ƒï¼Œè¯¥Cacheå€¼è¢«ä¿®æ”¹äº†ã€‚</p><p>ä½†æ˜¯å¦‚ä½•åªæ˜¯è¿›è¡Œå†™ä¼ æ’­çš„è¯ï¼Œä¼šå¯¼è‡´å…¶å®ƒCPUæ ¸å¿ƒæ”¶åˆ°çš„ä¿®æ”¹é¡ºåºå‡ºç°é—®é¢˜ï¼Œå°±å¯¼è‡´CPUæ ¸å¿ƒè¿›è¡Œé”™è¯¯çš„å¤„ç†ã€‚</p><p>é‚£ä¹ˆäº‹åŠ¡ä¸²è¡ŒåŒ–å°±æ˜¯ä¸ºäº†è§£å†³é¡ºåºä¸ä¸€è‡´çš„é—®é¢˜ã€‚é‚£ä¹ˆè¦å®ç°äº‹åŠ¡çš„ä¸²è¡ŒåŒ–å°±éœ€è¦æ»¡è¶³ä¸¤ç‚¹ï¼š</p><ol><li>CPUæ ¸å¿ƒå¯¹äºCacheä¸­æ•°æ®çš„æ“ä½œï¼Œéœ€è¦åŒæ­¥ç»™å…¶å®ƒCPUæ ¸å¿ƒï¼›</li><li>ç¡®ä¿åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªCPUæ ¸å¿ƒè¿›è¡Œä¿®æ”¹ï¼Œé‚£å°±æ˜¯å¼•å…¥äº†â€œé”â€çš„æ¦‚å¿µï¼Œé‚£ä¹ˆå¯¹äºCPUæ ¸å¿ƒä¸­æ‹¥æœ‰ç›¸åŒæ•°æ®çš„Cacheå°±ä¼šç»™å®ƒåŠ å…¥é”ï¼Œå¯¹äºCPUæ ¸å¿ƒåªæœ‰æ‹¿åˆ°äº†é”æ‰èƒ½è¿›è¡Œæ•°æ®ä¿®æ”¹ã€‚</li></ol><p>å†™ä¼ æ’­çš„å®ç°æ–¹å¼å°±æ˜¯æ€»çº¿å—…æ¢ï¼ŒCPU éœ€è¦æ¯æ—¶æ¯åˆ»ç›‘å¬æ€»çº¿ä¸Šçš„â¼€åˆ‡æ´»åŠ¨ï¼Œä½†æ˜¯ä¸ç®¡åˆ«çš„ æ ¸â¼¼çš„ Cache æ˜¯å¦ç¼“å­˜ç›¸åŒçš„æ•°æ®ï¼Œéƒ½éœ€è¦å‘å‡ºâ¼€ä¸ªâ¼´æ’­äº‹ä»¶ï¼Œè¿™â½†ç–‘ä¼šåŠ é‡æ€»çº¿çš„è´Ÿè½½ã€‚</p><p>äº‹åŠ¡çš„ä¸²è¡ŒåŒ–çš„å®ç°æ–¹å¼æ˜¯ä¸€ä¸ªåŸºäºæ€»çº¿å—…æ¢çš„åè®®ï¼Œè¿™ä¸ªåè®®å°±æ˜¯MESIï¼ŒMESIåè®®å°±æ˜¯ï¼š</p><ul><li>Modified å·²ä¿®æ”¹ï¼›</li><li>Exclusive ç‹¬å ï¼›</li><li>Shared å…±äº«ï¼›</li><li>Invalidated å¤±æ•ˆï¼›</li></ul><ol><li>å½“ A å· CPU æ ¸â¼¼ä»å†…å­˜è¯»å–å˜é‡ i çš„å€¼ï¼Œæ•°æ®è¢«ç¼“å­˜åœ¨ A å· CPU æ ¸â¼¼â¾ƒâ¼°çš„ Cache â¾¥ â¾¯ï¼Œæ­¤æ—¶å…¶ä»– CPU æ ¸â¼¼çš„ Cache æ²¡æœ‰ç¼“å­˜è¯¥æ•°æ®ï¼Œäºæ˜¯æ ‡è®° Cache Line çŠ¶æ€ä¸ºã€Œç‹¬ å ã€ï¼Œæ­¤æ—¶å…¶ Cache ä¸­çš„æ•°æ®ä¸å†…å­˜æ˜¯â¼€è‡´çš„ï¼› </li><li>ç„¶å B å· CPU æ ¸â¼¼ä¹Ÿä»å†…å­˜è¯»å–äº†å˜é‡ i çš„å€¼ï¼Œæ­¤æ—¶ä¼šå‘é€æ¶ˆæ¯ç»™å…¶ä»– CPU æ ¸â¼¼ï¼Œç”± äº A å· CPU æ ¸â¼¼å·²ç»ç¼“å­˜äº†è¯¥æ•°æ®ï¼Œæ‰€ä»¥ä¼šæŠŠæ•°æ®è¿”å›ç»™ B å· CPU æ ¸â¼¼ã€‚åœ¨è¿™ä¸ªæ—¶ å€™ï¼Œ A å’Œ B æ ¸â¼¼ç¼“å­˜äº†ç›¸åŒçš„æ•°æ®ï¼ŒCache Line çš„çŠ¶æ€å°±ä¼šå˜æˆã€Œå…±äº«ã€ï¼Œå¹¶ä¸”å…¶ Cache ä¸­çš„æ•°æ®ä¸å†…å­˜ä¹Ÿæ˜¯â¼€è‡´çš„ï¼› </li><li>å½“ A å· CPU æ ¸â¼¼è¦ä¿®æ”¹ Cache ä¸­ i å˜é‡çš„å€¼ï¼Œå‘ç°æ•°æ®å¯¹åº”çš„ Cache Line çš„çŠ¶æ€æ˜¯å…±äº«çŠ¶æ€ï¼Œåˆ™è¦å‘æ‰€æœ‰çš„å…¶ä»– CPU æ ¸â¼¼â¼´æ’­â¼€ä¸ªè¯·æ±‚ï¼Œè¦æ±‚å…ˆæŠŠå…¶ä»–æ ¸â¼¼çš„ Cache ä¸­å¯¹ åº”çš„ Cache Line æ ‡è®°ä¸ºã€Œâ½†æ•ˆã€çŠ¶æ€ï¼Œç„¶å A å· CPU æ ¸â¼¼æ‰æ›´æ–° Cache â¾¥â¾¯çš„æ•°æ®ï¼Œ åŒæ—¶æ ‡è®° Cache Line ä¸ºã€Œå·²ä¿®æ”¹ã€çŠ¶æ€ï¼Œæ­¤æ—¶ Cache ä¸­çš„æ•°æ®å°±ä¸å†…å­˜ä¸â¼€è‡´äº†ã€‚</li><li>å¦‚æœ A å· CPU æ ¸â¼¼ã€Œç»§ç»­ã€ä¿®æ”¹ Cache ä¸­ i å˜é‡çš„å€¼ï¼Œç”±äºæ­¤æ—¶çš„ Cache Line æ˜¯ã€Œå·² ä¿®æ”¹ã€çŠ¶æ€ï¼Œå› æ­¤ä¸éœ€è¦ç»™å…¶ä»– CPU æ ¸â¼¼å‘é€æ¶ˆæ¯ï¼Œç›´æ¥æ›´æ–°æ•°æ®å³å¯ã€‚ </li><li>å¦‚æœ A å· CPU æ ¸â¼¼çš„ Cache â¾¥çš„ i å˜é‡å¯¹åº”çš„ Cache Line è¦è¢«ã€Œæ›¿æ¢ã€ï¼Œå‘ç°  Cache Line çŠ¶æ€æ˜¯ã€Œå·²ä¿®æ”¹ã€çŠ¶æ€ï¼Œå°±ä¼šåœ¨æ›¿æ¢å‰å…ˆæŠŠæ•°æ®åŒæ­¥åˆ°å†…å­˜ã€‚</li></ol><h2 id="æ“ä½œç³»ç»Ÿç»“æ„"><a href="#æ“ä½œç³»ç»Ÿç»“æ„" class="headerlink" title="æ“ä½œç³»ç»Ÿç»“æ„"></a>æ“ä½œç³»ç»Ÿç»“æ„</h2><h3 id="å†…æ ¸"><a href="#å†…æ ¸" class="headerlink" title="å†…æ ¸"></a>å†…æ ¸</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262026129.png" alt="image-20241021175358520"></p><h2 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h2><h3 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262026631.png" alt="image-20241021180128082"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262026240.png" alt="image-20241021180247774"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091315974.png" alt="image-20250309131529917"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091320671.png" alt="image-20250309132030595"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091335265.png" alt="image-20250309133517202"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091349281.png" alt="image-20250309134932226"></p><h3 id="å†…å­˜åˆ†æ®µ"><a href="#å†…å­˜åˆ†æ®µ" class="headerlink" title="å†…å­˜åˆ†æ®µ"></a>å†…å­˜åˆ†æ®µ</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262026581.png" alt="image-20241021181307680"></p><p>ç¨‹åºæ˜¯ç”±è‹¥â¼²ä¸ªé€»è¾‘åˆ†æ®µç»„æˆçš„ï¼Œå¦‚å¯ç”±ä»£ç åˆ†æ®µã€æ•°æ®åˆ†æ®µã€æ ˆæ®µã€å †æ®µç»„æˆã€‚ä¸åŒçš„æ®µ æ˜¯æœ‰ä¸åŒçš„å±æ€§çš„ï¼Œæ‰€ä»¥å°±â½¤åˆ†æ®µï¼ˆSegmentationï¼‰çš„å½¢å¼æŠŠè¿™äº›æ®µåˆ†ç¦»å‡ºæ¥ã€‚</p><p>æ“ä½œç³»ç»Ÿä¼šæŠŠä¸€ä¸ªç¨‹åºåˆ†ä¸ºå‡ æ®µï¼Œä»£ç æ®µã€æ•°æ®æ®µã€æ ˆæ®µå’Œå †æ®µã€‚</p><p>åœ¨è™šæ‹Ÿåœ°å€ä¸­ä¼šä¿å­˜è¯¥åœ°å€çš„æ‰€å±çš„æ®µå·ï¼Œåœ¨æ®µå†…åç§»é‡æ˜¯å¤šå°‘ã€‚é€šè¿‡æ®µå·å¯ä»¥æ‰¾åˆ°è¯¥æ®µè¡¨ï¼Œé€šè¿‡æ®µè¡¨å¾—åˆ°è¯¥æ®µçš„èµ·å§‹åœ°å€ï¼Œé€šè¿‡è™šæ‹Ÿåœ°å€çš„æ®µå†…åç§»é‡æ—¢å¯ä»¥å¾—åˆ°è™šæ‹Ÿåœ°å€å¯¹åº”çš„ç‰©ç†å†…å­˜åœ°å€ã€‚</p><ul><li><strong>å¤–éƒ¨ç¢ç‰‡é—®é¢˜</strong></li></ul><p>è™½ç„¶åˆ†æ®µæä¾›äº†çµæ´»çš„å†…å­˜ç®¡ç†ï¼Œä½†ç”±äºä¸åŒæ®µçš„å¤§å°å’Œç”Ÿå‘½å‘¨æœŸå„ä¸ç›¸åŒï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå†…å­˜ä¸­ä¼šå‡ºç°æœªä½¿ç”¨çš„å°ç¢ç‰‡ã€‚è¿™äº›ç¢ç‰‡æ— æ³•è¢«æœ‰æ•ˆåˆ©ç”¨ï¼Œä»è€Œå¯¼è‡´å†…å­˜æµªè´¹ï¼Œç§°ä¸ºâ€œå¤–éƒ¨ç¢ç‰‡â€ã€‚</p><p><strong>ä¾‹å­</strong>ï¼šå‡è®¾æœ‰3ä¸ªæ®µåˆ†åˆ«ä¸ºAã€Bã€Cï¼Œå®ƒä»¬åˆ†é…åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚ä½†å¦‚æœBæ®µè¢«é‡Šæ”¾äº†ï¼Œè¿™å°±ä¼šåœ¨Aå’ŒCä¹‹é—´ç•™ä¸‹ä¸€ä¸ªæœªä½¿ç”¨çš„å°ç©ºé—´ï¼Œè¿™ä¸ªç©ºé—´å¯èƒ½ä¸è¶³ä»¥å®¹çº³æ–°æ®µï¼Œå¯¼è‡´æ–°çš„å¤§æ®µæ— æ³•åˆ†é…ã€‚</p><ul><li><strong>åœ°å€è½¬æ¢å¤æ‚</strong></li></ul><p>æ¯ä¸ªå†…å­˜æ®µéƒ½æœ‰è‡ªå·±çš„åŸºåœ°å€å’Œå¤§å°ï¼Œæ“ä½œç³»ç»Ÿåœ¨è®¿é—®å†…å­˜æ—¶éœ€è¦é€šè¿‡æ®µè¡¨æ¥æŸ¥æ‰¾æ®µçš„èµ·å§‹åœ°å€ï¼Œç„¶åå†åŠ ä¸Šæ®µå†…åç§»é‡æ‰èƒ½å¾—åˆ°ç‰©ç†åœ°å€ã€‚è¿™å¢åŠ äº†åœ°å€è½¬æ¢çš„å¤æ‚æ€§å’Œç®¡ç†å¼€é”€ã€‚</p><p><strong>ä¾‹å­</strong>ï¼šæ¯æ¬¡è®¿é—®å†…å­˜æ—¶ï¼ŒCPUéœ€è¦æŸ¥æ‰¾æ®µè¡¨ä»¥ç¡®å®šæ®µçš„åŸºåœ°å€ï¼Œè¿™ä¼šä½¿å†…å­˜è®¿é—®å˜å¾—æ¯”ç›´æ¥ä½¿ç”¨ç‰©ç†åœ°å€æ…¢ã€‚</p><ul><li><strong>ä¸é€‚åˆç°ä»£å¤§å†…å­˜æ¨¡å‹</strong></li></ul><p>éšç€ç¨‹åºå¤æ‚æ€§å’Œå†…å­˜éœ€æ±‚çš„å¢åŠ ï¼Œåˆ†æ®µæœºåˆ¶æ— æ³•å¾ˆå¥½åœ°å¤„ç†å¤§è§„æ¨¡çš„å†…å­˜éœ€æ±‚ã€‚ç°ä»£ç¨‹åºé€šå¸¸éœ€è¦è®¿é—®å¤§å—çš„è¿ç»­å†…å­˜ï¼Œè€Œåˆ†æ®µæä¾›çš„é€»è¾‘æ®µæ— æ³•æ»¡è¶³è¿™ä¸€éœ€æ±‚ã€‚</p><p><strong>ä¾‹å­</strong>ï¼šæŸäº›ç°ä»£åº”ç”¨ç¨‹åºï¼ˆå¦‚å¤§å‹æ•°æ®åº“æˆ–æœºå™¨å­¦ä¹ æ¨¡å‹ï¼‰éœ€è¦å·¨å¤§çš„å†…å­˜ç©ºé—´ï¼Œè€Œåˆ†æ®µæœºåˆ¶çš„åˆ’åˆ†æ–¹å¼åœ¨å¤„ç†å¤§è§„æ¨¡è¿ç»­å†…å­˜æ—¶æ•ˆç‡ä¸é«˜ï¼Œæ— æ³•ä¸åˆ†é¡µæœºåˆ¶ä¸€æ ·çµæ´»åœ°åˆ†é…å†…å­˜ã€‚</p><h3 id="å†…å­˜åˆ†é¡µ"><a href="#å†…å­˜åˆ†é¡µ" class="headerlink" title="å†…å­˜åˆ†é¡µ"></a>å†…å­˜åˆ†é¡µ</h3><p>åˆ†æ®µçš„å¥½å¤„å°±æ˜¯èƒ½äº§â½£è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯ä¼šå‡ºç°å†…å­˜ç¢â½šå’Œå†…å­˜äº¤æ¢çš„ç©ºé—´å¤ªâ¼¤çš„é—® é¢˜ã€‚ è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œé‚£ä¹ˆå°±è¦æƒ³å‡ºèƒ½å°‘å‡ºç°â¼€äº›å†…å­˜ç¢â½šçš„åŠæ³•ã€‚å¦å¤–ï¼Œå½“éœ€è¦è¿›â¾å†…å­˜äº¤æ¢ çš„æ—¶å€™ï¼Œè®©éœ€è¦äº¤æ¢å†™â¼Šæˆ–è€…ä»ç£ç›˜è£…è½½çš„æ•°æ®æ›´å°‘â¼€ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³é—®é¢˜äº†ã€‚è¿™ä¸ªåŠ æ³•ï¼Œä¹Ÿå°±æ˜¯å†…å­˜åˆ†â»šï¼ˆPagingï¼‰ã€‚</p><p>åˆ†â»šæ˜¯æŠŠæ•´ä¸ªè™šæ‹Ÿå’Œç‰©ç†å†…å­˜ç©ºé—´åˆ‡æˆâ¼€æ®µæ®µå›ºå®šå°ºâ¼¨çš„â¼¤â¼©ã€‚è¿™æ ·â¼€ä¸ªè¿ç»­å¹¶ä¸”å°ºâ¼¨å›ºå®š çš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬å«â»šï¼ˆPageï¼‰ã€‚åœ¨ Linux ä¸‹ï¼Œæ¯â¼€â»šçš„â¼¤â¼©ä¸º 4KB ã€‚</p><p>åˆ†é¡µç›¸å¯¹äºåˆ†æ®µæ¥è¯´å°±æ˜¯æŠŠä¸€é¡µçš„ç©ºé—´å¿«é€Ÿç¼©å°ï¼Œä¹‹å‰çš„ä¸€æ®µä¼šå¾ˆå¤§æ¯”å¦‚100MBç­‰ç­‰ï¼Œç°åœ¨ä¸€é¡µ4KBï¼ˆLinuxæ“ä½œç³»ç»Ÿä¸Šï¼‰ï¼Œè¿™æ ·è®¡ç®—å¯¹å†…å­˜è¿›è¡Œå›æ”¶ï¼Œå‘ç”Ÿå†…å­˜ç¢ç‰‡çš„ç©ºé—´ä¼šå¾ˆå°‘ï¼Œç›¸å¯¹æ¥è¯´å°±å¯ä»¥è®¤ä¸ºæ— å†…å­˜ç¢ç‰‡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262026462.png" alt="image-20241021192013811"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262027319.png" alt="image-20241021192113626"></p><p>ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜å°±æ˜¯ç©ºé—´é—®é¢˜ã€‚</p><p>å› ä¸ºæ“ä½œç³»ç»Ÿæ˜¯å¯ä»¥åŒæ—¶è¿â¾â¾®å¸¸å¤šçš„è¿›ç¨‹çš„ï¼Œé‚£è¿™ä¸å°±æ„å‘³ç€â»šè¡¨ä¼šâ¾®å¸¸çš„åºâ¼¤ã€‚ åœ¨ 32 ä½çš„ç¯å¢ƒä¸‹ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´å…±æœ‰ 4GBï¼Œå‡è®¾â¼€ä¸ªâ»šçš„â¼¤â¼©æ˜¯ 4KBï¼ˆ2^12ï¼‰ï¼Œé‚£ä¹ˆå°±éœ€ è¦â¼¤çº¦ 100 ä¸‡ ï¼ˆ2^20ï¼‰ ä¸ªâ»šï¼Œæ¯ä¸ªã€Œâ»šè¡¨é¡¹ã€éœ€è¦ 4 ä¸ªå­—èŠ‚â¼¤â¼©æ¥å­˜å‚¨ï¼Œé‚£ä¹ˆæ•´ä¸ª 4GB ç©º é—´çš„æ˜ å°„å°±éœ€è¦æœ‰ 4MB çš„å†…å­˜æ¥å­˜å‚¨â»šè¡¨ã€‚ è¿™ 4MB â¼¤â¼©çš„â»šè¡¨ï¼Œçœ‹èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆâ¼¤ã€‚ä½†æ˜¯è¦çŸ¥é“æ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯æœ‰â¾ƒâ¼°çš„è™šæ‹Ÿåœ°å€ç©ºé—´ çš„ï¼Œä¹Ÿå°±è¯´éƒ½æœ‰â¾ƒâ¼°çš„â»šè¡¨ã€‚ é‚£ä¹ˆï¼Œ 100 ä¸ªè¿›ç¨‹çš„è¯ï¼Œå°±éœ€è¦ 400MB çš„å†…å­˜æ¥å­˜å‚¨â»šè¡¨ï¼Œè¿™æ˜¯â¾®å¸¸â¼¤çš„å†…å­˜äº†ï¼Œæ›´åˆ«è¯´ 64 ä½çš„ç¯å¢ƒäº†ã€‚</p><p>é‚£ä¹ˆé¡µè¡¨å­˜å‚¨çš„ç¼ºç‚¹ä¹Ÿå‡ºæ¥äº†å°±æ˜¯åœ¨å¤šè¿›ç¨‹ç¯å¢ƒä¸‹ï¼Œé¡µè¡¨å æ®çš„ç©ºé—´è¿‡å¤§ã€‚</p><h3 id="å¤šçº§é¡µè¡¨"><a href="#å¤šçº§é¡µè¡¨" class="headerlink" title="å¤šçº§é¡µè¡¨"></a>å¤šçº§é¡µè¡¨</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262027664.png" alt="image-20241021194336762"></p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œåˆ†äº†â¼†çº§è¡¨ï¼Œæ˜ å°„ 4GB åœ°å€ç©ºé—´å°±éœ€è¦ 4KBï¼ˆâ¼€çº§â»šè¡¨ï¼‰+ 4MBï¼ˆâ¼† çº§â»šè¡¨ï¼‰çš„å†…å­˜ï¼Œè¿™æ ·å â½¤ç©ºé—´ä¸æ˜¯æ›´â¼¤äº†å—ï¼Ÿ</p><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ 4GB çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œâ½½æ˜¾ç„¶å¯¹äºâ¼¤å¤šæ•°ç¨‹åºæ¥è¯´ï¼Œå…¶ä½¿â½¤åˆ°çš„ç©ºé—´è¿œæœªè¾¾åˆ° 4GBï¼Œå› ä¸ºä¼šå­˜åœ¨éƒ¨åˆ†å¯¹åº”çš„â»šè¡¨é¡¹éƒ½æ˜¯ç©ºçš„ï¼Œæ ¹æœ¬æ²¡æœ‰åˆ†é…ï¼Œå¯¹äºå·²åˆ†é…çš„â»šè¡¨é¡¹ï¼Œå¦‚æœ å­˜åœ¨æœ€è¿‘â¼€å®šæ—¶é—´æœªè®¿é—®çš„â»šè¡¨ï¼Œåœ¨ç‰©ç†å†…å­˜ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†â»šâ¾¯æ¢å‡ºåˆ°ç¡¬ ç›˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šå â½¤ç‰©ç†å†…å­˜ã€‚ å¦‚æœä½¿â½¤äº†â¼†çº§åˆ†â»šï¼Œâ¼€çº§â»šè¡¨å°±å¯ä»¥è¦†ç›–æ•´ä¸ª 4GB è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä½†å¦‚æœæŸä¸ªâ¼€çº§â»šè¡¨çš„ â»šè¡¨é¡¹æ²¡æœ‰è¢«â½¤åˆ°ï¼Œä¹Ÿå°±ä¸éœ€è¦åˆ›å»ºè¿™ä¸ªâ»šè¡¨é¡¹å¯¹åº”çš„â¼†çº§â»šè¡¨äº†ï¼Œå³å¯ä»¥åœ¨éœ€è¦æ—¶æ‰åˆ›å»º â¼†çº§â»šè¡¨ã€‚åšä¸ªç®€å•çš„è®¡ç®—ï¼Œå‡è®¾åªæœ‰ 20% çš„â¼€çº§â»šè¡¨é¡¹è¢«â½¤åˆ°äº†ï¼Œé‚£ä¹ˆâ»šè¡¨å â½¤çš„å†…å­˜ç©º é—´å°±åªæœ‰ 4KBï¼ˆâ¼€çº§â»šè¡¨ï¼‰ + 20% * 4MBï¼ˆâ¼†çº§â»šè¡¨ï¼‰&#x3D; 0.804MB ï¼Œè¿™å¯¹â½å•çº§â»šè¡¨çš„ 4MB æ˜¯ä¸æ˜¯â¼€ä¸ªå·¨â¼¤çš„èŠ‚çº¦ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262027756.png" alt="image-20241021194453588"></p><h3 id="æ®µé¡µå¼å†…å­˜ç®¡ç†"><a href="#æ®µé¡µå¼å†…å­˜ç®¡ç†" class="headerlink" title="æ®µé¡µå¼å†…å­˜ç®¡ç†"></a>æ®µé¡µå¼å†…å­˜ç®¡ç†</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028587.png" alt="image-20241021195336021"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028529.png" alt="image-20241021195411259"></p><p>æ®µâ»šå¼åœ°å€å˜æ¢ä¸­è¦å¾—åˆ°ç‰©ç†åœ°å€é¡»ç»è¿‡ä¸‰æ¬¡å†…å­˜è®¿é—®ï¼š</p><ul><li>ç¬¬â¼€æ¬¡è®¿é—®æ®µè¡¨ï¼Œå¾—åˆ°â»šè¡¨èµ·å§‹åœ°å€ï¼› </li><li>ç¬¬â¼†æ¬¡è®¿é—®â»šè¡¨ï¼Œå¾—åˆ°ç‰©ç†â»šå·ï¼› </li><li>ç¬¬ä¸‰æ¬¡å°†ç‰©ç†â»šå·ä¸â»šå†…ä½ç§»ç»„åˆï¼Œå¾—åˆ°ç‰©ç†åœ°å€ã€‚</li></ul><p>å¯â½¤è½¯ã€ç¡¬ä»¶ç›¸ç»“åˆçš„â½…æ³•å®ç°æ®µâ»šå¼åœ°å€å˜æ¢ï¼Œè¿™æ ·è™½ç„¶å¢åŠ äº†ç¡¬ä»¶æˆæœ¬å’Œç³»ç»Ÿå¼€é”€ï¼Œä½† æâ¾¼äº†å†…å­˜çš„åˆ©â½¤ç‡ã€‚</p><h3 id="Linuxå†…å­˜ç®¡ç†"><a href="#Linuxå†…å­˜ç®¡ç†" class="headerlink" title="Linuxå†…å­˜ç®¡ç†"></a>Linuxå†…å­˜ç®¡ç†</h3><p>Linux å†…å­˜ä¸»è¦é‡‡â½¤çš„æ˜¯â»šå¼å†…å­˜ç®¡ç†ï¼Œä½†åŒæ—¶ä¹Ÿä¸å¯é¿å…åœ°æ¶‰åŠäº†æ®µæœºåˆ¶ã€‚Linux ç³»ç»Ÿä¸­çš„æ¯ä¸ªæ®µéƒ½æ˜¯ä» 0 åœ°å€å¼€å§‹çš„æ•´ä¸ª 4GB è™šæ‹Ÿç©ºé—´ï¼ˆ32 ä½ç¯å¢ƒä¸‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰€ æœ‰çš„æ®µçš„èµ·å§‹åœ°å€éƒ½æ˜¯â¼€æ ·çš„ã€‚è¿™æ„å‘³ç€ï¼ŒLinux ç³»ç»Ÿä¸­çš„ä»£ç ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿæœ¬èº«çš„ä»£ç å’Œ åº”â½¤ç¨‹åºä»£ç ï¼Œæ‰€â¾¯å¯¹çš„åœ°å€ç©ºé—´éƒ½æ˜¯çº¿æ€§åœ°å€ç©ºé—´ï¼ˆè™šæ‹Ÿåœ°å€ï¼‰ï¼Œè¿™ç§åšæ³•ç›¸å½“äºå±è”½äº† å¤„ç†å™¨ä¸­çš„é€»è¾‘åœ°å€æ¦‚å¿µï¼Œæ®µåªè¢«â½¤äºè®¿é—®æ§åˆ¶å’Œå†…å­˜ä¿æŠ¤ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028510.png" alt="image-20241021195934657"></p><p>å†æ¥è¯´è¯´ï¼Œå†…æ ¸ç©ºé—´ä¸â½¤æˆ·ç©ºé—´çš„åŒºåˆ«ï¼š è¿›ç¨‹åœ¨â½¤æˆ·æ€æ—¶ï¼Œåªèƒ½è®¿é—®â½¤æˆ·ç©ºé—´å†…å­˜ï¼› åªæœ‰è¿›â¼Šå†…æ ¸æ€åï¼Œæ‰å¯ä»¥è®¿é—®å†…æ ¸ç©ºé—´çš„å†…å­˜ï¼› è™½ç„¶æ¯ä¸ªè¿›ç¨‹éƒ½å„â¾ƒæœ‰ç‹¬â½´çš„è™šæ‹Ÿå†…å­˜ï¼Œä½†æ˜¯æ¯ä¸ªè™šæ‹Ÿå†…å­˜ä¸­çš„å†…æ ¸åœ°å€ï¼Œå…¶å®å…³è”çš„éƒ½æ˜¯ ç›¸åŒçš„ç‰©ç†å†…å­˜ã€‚è¿™æ ·ï¼Œè¿›ç¨‹åˆ‡æ¢åˆ°å†…æ ¸æ€åï¼Œå°±å¯ä»¥å¾ˆâ½…ä¾¿åœ°è®¿é—®å†…æ ¸ç©ºé—´å†…å­˜ã€‚</p><h3 id="å†™æ—¶å¤åˆ¶copy-on-write"><a href="#å†™æ—¶å¤åˆ¶copy-on-write" class="headerlink" title="å†™æ—¶å¤åˆ¶copy on write"></a>å†™æ—¶å¤åˆ¶copy on write</h3><p>ä¸»è¿›ç¨‹åœ¨æ‰§è¡Œ fork çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠä¸»è¿›ç¨‹çš„ã€Œé¡µè¡¨ã€å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ï¼Œè¿™ä¸ªé¡µè¡¨è®°å½•ç€è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€æ˜ å°„å…³ç³»ï¼Œè€Œä¸ä¼šå¤åˆ¶ç‰©ç†å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤è€…çš„è™šæ‹Ÿç©ºé—´ä¸åŒï¼Œä½†å…¶å¯¹åº”çš„ç‰©ç†ç©ºé—´æ˜¯åŒä¸€ä¸ªã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091718247.png" alt="image-20250309171842180"></p><p>è¿™æ ·ä¸€æ¥ï¼Œå­è¿›ç¨‹å°±å…±äº«äº†çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜æ•°æ®äº†ï¼Œè¿™æ ·èƒ½å¤ŸèŠ‚çº¦ç‰©ç†å†…å­˜èµ„æºï¼Œé¡µè¡¨å¯¹åº”çš„é¡µè¡¨é¡¹çš„å±æ€§ä¼šæ ‡è®°è¯¥ç‰©ç†å†…å­˜çš„æƒé™ä¸ºåªè¯»ã€‚è¿™æ˜¯ä¸ºäº†åœ¨æ— è®ºæ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹éœ€è¦ä¿®æ”¹çš„æ—¶å€™ï¼Œè§¦å‘<strong>å†™ä¿æŠ¤ä¸­æ–­</strong>ï¼Œå› ä¸ºç°åœ¨çš„é¡µè¡¨æƒé™ä¸ºåªå¯è¯»ã€‚</p><p>å…¶æœ¬è´¨å°±æ˜¯éœ€è¦å¤åˆ¶ä¸€ä¸ªçˆ¶è¿›ç¨‹é‡Œçš„å†…å®¹ï¼Œä½†æ˜¯ç›®å‰åªæ˜¯å¤åˆ¶äº†ä¸€ä»½é¡µè¡¨ï¼Œä½†æ˜¯å…¶æ‰€ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªç‰©ç†åœ°å€ï¼Œå½“ä¸€ä¸ªéœ€è¦ä¿®æ”¹æ—¶ï¼Œå°±éœ€è¦é‡æ–°è®¾ç½®å†…å­˜è¯»å†™æƒé™ã€‚åœ¨å†™ä¿æŠ¤ä¸­æ–­å¤„ç†å‡½æ•°ä¸­ä¼šå¯¹ç‰©ç†åœ°å€è¿›è¡Œå¤åˆ¶ï¼Œç„¶ååœ¨å¯¹åº”çš„é¡µè¡¨é‡æ–°è®¾ç½®æ˜ å°„å…³ç³»ï¼Œç„¶åå°†çˆ¶å­è¿›ç¨‹çš„å†…å­˜è¯»å†™æƒé™è®¾ç½®ä¸ºå¯è¯»å†™ï¼Œæœ€åæ‰ä¼šå¯¹å†…å­˜è¿›è¡Œå†™æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ºå†™æ—¶å¤åˆ¶ã€‚</p><p>å†™æ—¶å¤åˆ¶é¡¾åæ€ä¹‰ï¼Œåœ¨å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šå»å¤åˆ¶ç‰©ç†å†…å­˜ï¼Œè¿™æ ·æ˜¯ä¸ºäº†é˜²æ­¢ fork åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œç”±äºç‰©ç†å†…å­˜æ•°æ®çš„å¤åˆ¶æ—¶é—´è¿‡é•¿è€Œå¯¼è‡´çˆ¶è¿›ç¨‹é•¿æ—¶é—´é˜»å¡çš„é—®é¢˜ã€‚</p><h3 id="brk-mmap"><a href="#brk-mmap" class="headerlink" title="brk &amp; mmap"></a>brk &amp; mmap</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091730591.png" alt="image-20250309173057525"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091731790.png" alt="image-20250309173109735"></p><h3 id="æ“ä½œç³»ç»Ÿå†…å­˜ä¸è¶³çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ"><a href="#æ“ä½œç³»ç»Ÿå†…å­˜ä¸è¶³çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ" class="headerlink" title="æ“ä½œç³»ç»Ÿå†…å­˜ä¸è¶³çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ"></a>æ“ä½œç³»ç»Ÿå†…å­˜ä¸è¶³çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ</h3><p>åœ¨ä¸€ä¸ªè¿›ç¨‹åˆ†é…å†…å­˜çš„æ—¶å€™æ˜¯åˆ†é…çš„è™šæ‹Ÿå†…å­˜ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ†é…ç‰©ç†å†…å­˜ï¼Œåœ¨åˆ†é…å¥½è™šæ‹Ÿå†…å­˜ä¹‹åï¼Œå½“ä½¿ç”¨åˆ°è¿™ä¸ªè™šæ‹Ÿå†…å­˜çš„æ—¶å€™ï¼Œä¼šå»é¡µè¡¨ä¸ŠæŸ¥è¯¢è¯¥è™šæ‹Ÿå†…å­˜æ‰€å¯¹åº”çš„ç‰©ç†å†…å­˜ï¼Œå¦‚æœåœ¨è¯¥é¡µè¡¨å¹¶æ²¡æœ‰è¯¥æ˜ å°„å…³ç³»çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡ŒåŠ è½½è¯¥é¡µï¼Œè¿™æ—¶å€™æ‰ä¼šå‘ç”Ÿæ“ä½œç³»ç»Ÿå†…å­˜ä¸è¶³ã€‚</p><p>å½“æ“ä½œç³»ç»Ÿå‘ç°ç›®å‰çš„å†…å­˜å¹¶ä¸è¶³ä»¥æ”¯æŒè¯¥é¡µçš„åŠ è½½ï¼Œå°±ä¼šæ ¹æ®é¡µé¢ç½®æ¢ç®—æ³•ï¼Œé€‰æ‹©ä¸€ä¸ªé¡µé¢å°†å…¶äº¤æ¢åˆ°swapç¡¬ç›˜ä¸­ï¼Œè…¾å‡ºç©ºé—´ç»™æ–°çš„é¡µé¢ã€‚</p><p>åŒæ—¶å†…æ ¸ä¹Ÿä¼šåŒæ­¥è¿›è¡Œå†…å­˜å›æ”¶çš„å·¥ä½œï¼Œå†…æ ¸ä¸­å›æ”¶çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ol><li>åå°å†…å­˜å›æ”¶ï¼šåå°å†…å­˜å›æ”¶å˜›ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸ä¼šé˜»å¡è¿›ç¨‹çš„æ‰§è¡Œï¼Œä¼šå”¤é†’kswapdå†…æ ¸çº¿ç¨‹è¿›è¡Œå¼‚æ­¥çš„å›æ”¶ï¼›</li><li>ç›´æ¥å†…å­˜å›æ”¶ï¼šå½“åå°å†…å­˜å›æ”¶çš„é€Ÿåº¦è·Ÿä¸ä¸Šè¿›ç¨‹å†…å­˜çš„ç”³è¯·é€Ÿåº¦çš„è¯ï¼Œå°±ä¼šç›´æ¥ä½¿ç”¨ç›´æ¥å†…å­˜å›æ”¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œä¼šé˜»å¡è¿›ç¨‹çš„æ‰§è¡Œã€‚</li></ol><p>ä½†æ˜¯å¦‚æœswapå’Œå†…å­˜å›æ”¶ä¹Ÿæ— æ³•æ»¡è¶³è¿›è¡Œçš„å†…å­˜ç”³è¯·çš„è¯ï¼Œå°±ä¼šé€‰æ‹©è§¦å‘OOMæœºåˆ¶ï¼ŒOOM Killer æœºåˆ¶ä¼šæ ¹æ®ç®—æ³•é€‰æ‹©ä¸€ä¸ªå ç”¨ç‰©ç†å†…å­˜è¾ƒé«˜çš„è¿›ç¨‹ï¼Œç„¶åå°†å…¶æ€æ­»ï¼Œä»¥ä¾¿é‡Šæ”¾å†…å­˜èµ„æºï¼Œå¦‚æœç‰©ç†å†…å­˜ä¾ç„¶ä¸è¶³ï¼ŒOOM Killer ä¼šç»§ç»­æ€æ­»å ç”¨ç‰©ç†å†…å­˜è¾ƒé«˜çš„è¿›ç¨‹ï¼Œç›´åˆ°é‡Šæ”¾è¶³å¤Ÿçš„å†…å­˜ä½ç½®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091745702.png" alt="image-20250309174534630"></p><p>ä¸»è¦æœ‰ä¸¤ç±»å†…å­˜å¯ä»¥è¢«å›æ”¶ï¼Œè€Œä¸”å®ƒä»¬çš„å›æ”¶æ–¹å¼ä¹Ÿä¸åŒã€‚</p><ul><li>æ–‡ä»¶é¡µï¼ˆFile-backed Pageï¼‰ï¼šå†…æ ¸ç¼“å­˜çš„ç£ç›˜æ•°æ®ï¼ˆBufferï¼‰å’Œå†…æ ¸ç¼“å­˜çš„æ–‡ä»¶æ•°æ®ï¼ˆCacheï¼‰éƒ½å«ä½œæ–‡ä»¶é¡µã€‚å¤§éƒ¨åˆ†æ–‡ä»¶é¡µï¼Œéƒ½å¯ä»¥ç›´æ¥é‡Šæ”¾å†…å­˜ï¼Œä»¥åæœ‰éœ€è¦æ—¶ï¼Œå†ä»ç£ç›˜é‡æ–°è¯»å–å°±å¯ä»¥äº†ã€‚è€Œé‚£äº›è¢«åº”ç”¨ç¨‹åºä¿®æ”¹è¿‡ï¼Œå¹¶ä¸”æš‚æ—¶è¿˜æ²¡å†™å…¥ç£ç›˜çš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯è„é¡µï¼‰ï¼Œå°±å¾—å…ˆå†™å…¥ç£ç›˜ï¼Œç„¶åæ‰èƒ½è¿›è¡Œå†…å­˜é‡Šæ”¾ã€‚æ‰€ä»¥ï¼Œå›æ”¶å¹²å‡€é¡µçš„æ–¹å¼æ˜¯ç›´æ¥é‡Šæ”¾å†…å­˜ï¼Œå›æ”¶è„é¡µçš„æ–¹å¼æ˜¯å…ˆå†™å›ç£ç›˜åå†é‡Šæ”¾å†…å­˜ã€‚</li><li>åŒ¿åé¡µï¼ˆAnonymous Pageï¼‰ï¼šè¿™éƒ¨åˆ†å†…å­˜æ²¡æœ‰å®é™…è½½ä½“ï¼Œä¸åƒæ–‡ä»¶ç¼“å­˜æœ‰ç¡¬ç›˜æ–‡ä»¶è¿™æ ·ä¸€ä¸ªè½½ä½“ï¼Œæ¯”å¦‚å †ã€æ ˆæ•°æ®ç­‰ã€‚è¿™éƒ¨åˆ†å†…å­˜å¾ˆå¯èƒ½è¿˜è¦å†æ¬¡è¢«è®¿é—®ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥é‡Šæ”¾å†…å­˜ï¼Œå®ƒä»¬å›æ”¶çš„æ–¹å¼æ˜¯é€šè¿‡ Linux çš„ Swap æœºåˆ¶ï¼ŒSwap ä¼šæŠŠä¸å¸¸è®¿é—®çš„å†…å­˜å…ˆå†™åˆ°ç£ç›˜ä¸­ï¼Œç„¶åé‡Šæ”¾è¿™äº›å†…å­˜ï¼Œç»™å…¶ä»–æ›´éœ€è¦çš„è¿›ç¨‹ä½¿ç”¨ã€‚å†æ¬¡è®¿é—®è¿™äº›å†…å­˜æ—¶ï¼Œé‡æ–°ä»ç£ç›˜è¯»å…¥å†…å­˜å°±å¯ä»¥äº†ã€‚</li></ul><p> æ–‡ä»¶é¡µå’ŒåŒ¿åé¡µçš„å›æ”¶éƒ½æ˜¯åŸºäº LRU ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯ä¼˜å…ˆå›æ”¶ä¸å¸¸è®¿é—®çš„å†…å­˜ã€‚LRU å›æ”¶ç®—æ³•ï¼Œå®é™…ä¸Šç»´æŠ¤ç€ active å’Œ inactive ä¸¤ä¸ªåŒå‘é“¾è¡¨ï¼Œå…¶ä¸­ï¼š </p><ul><li>active_list æ´»è·ƒå†…å­˜é¡µé“¾è¡¨ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯æœ€è¿‘è¢«è®¿é—®è¿‡ï¼ˆæ´»è·ƒï¼‰çš„å†…å­˜é¡µï¼› </li><li>inactive_list ä¸æ´»è·ƒå†…å­˜é¡µé“¾è¡¨ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯å¾ˆå°‘è¢«è®¿é—®ï¼ˆéæ´»è·ƒï¼‰çš„å†…å­˜é¡µï¼›</li></ul><p> è¶Šæ¥è¿‘é“¾è¡¨å°¾éƒ¨ï¼Œå°±è¡¨ç¤ºå†…å­˜é¡µè¶Šä¸å¸¸è®¿é—®ã€‚è¿™æ ·ï¼Œåœ¨å›æ”¶å†…å­˜æ—¶ï¼Œç³»ç»Ÿå°±å¯ä»¥æ ¹æ®æ´»è·ƒç¨‹åº¦ï¼Œä¼˜å…ˆå›æ”¶ä¸æ´»è·ƒçš„å†…å­˜ã€‚</p><h3 id="é¡µé¢ç½®æ¢ç®—æ³•"><a href="#é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="é¡µé¢ç½®æ¢ç®—æ³•"></a>é¡µé¢ç½®æ¢ç®—æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091750775.png" alt="image-20250309175026733"></p><ul><li>æœ€ä½³é¡µé¢ç®—æ³•ï¼šé€‰æ‹©ä¹‹åé•¿æ—¶é—´ä¸ä¼šå†ä½¿ç”¨çš„é¡µé¢è¿›è¡Œç½®æ¢ï¼›</li><li>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç½®æ¢ç®—æ³•ï¼šé€‰æ‹©ä¸Šä¸€æ¬¡ä½¿ç”¨æ—¶é—´æœ€è¿œçš„é¡µé¢è¿›è¡Œç½®æ¢ï¼›</li><li>å…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³•ï¼šé€‰æ‹©åŠ å…¥è¿™ä¸ªé¡µè¡¨æ—¶é—´æœ€é•¿çš„é¡µé¢è¿›è¡Œç½®æ¢ï¼›</li><li>æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•ï¼šå¦‚æœå®ƒçš„è®¿é—®ä½ä½æ˜¯ 0 å°±æ·˜æ±°è¯¥é¡µé¢ï¼Œå¹¶æŠŠæ–°çš„é¡µé¢æ’å…¥è¿™ä¸ªä½ç½®ï¼Œç„¶åæŠŠè¡¨é’ˆå‰ç§»ä¸€ä¸ªä½ç½®ï¼› â€¢ å¦‚æœè®¿é—®ä½æ˜¯ 1 å°±æ¸…é™¤è®¿é—®ä½ï¼Œå¹¶æŠŠè¡¨é’ˆå‰ç§»ä¸€ä¸ªä½ç½®ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°æ‰¾åˆ°äº†ä¸€ä¸ªè®¿é—®ä½ä¸º 0 çš„é¡µé¢ä¸ºæ­¢ï¼›<img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503091758951.png" alt="image-20250309175732230"></li><li>æœ€ä¸å¸¸ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼šé€‰æ‹©ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„é¡µé¢è¿›è¡Œç½®æ¢ï¼›</li></ul><h2 id="ä¸­æ–­-1"><a href="#ä¸­æ–­-1" class="headerlink" title="ä¸­æ–­"></a>ä¸­æ–­</h2><h3 id="ä»€ä¹ˆæ˜¯ä¸­æ–­"><a href="#ä»€ä¹ˆæ˜¯ä¸­æ–­" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸­æ–­"></a>ä»€ä¹ˆæ˜¯ä¸­æ–­</h3><p>ä¸­æ–­æ—¶æŒ‡åœ¨æ“ä½œç³»ç»Ÿæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œåœä¸‹æ‰‹ä¸­çš„äº‹æƒ…æ¥å¤„ç†å…¶å®ƒçš„äº‹æƒ…ï¼Œåœä¸‹æ¥ä¸æ˜¯å› ä¸ºæ—¶é—´ç‰‡ä½¿ç”¨å®Œè€Œå¯¼è‡´çš„åˆ‡æ¢ï¼Œè€Œæ˜¯ä¸å¾—ä¸å¤„ç†ï¼Œå¤„ç†å®Œä¹‹åè¿˜éœ€è¦å›æ¥æ¥ç€å¤„ç†ä¸‹é¢çš„äº‹æƒ…ã€‚</p><p>ä¸­æ–­ä¸€èˆ¬åˆ†ä¸ºå¤–éƒ¨ä¸­æ–­å’Œå†…éƒ¨ä¸­æ–­ã€‚</p><p>å¤–éƒ¨ä¸­æ–­ï¼š</p><ol><li>å¯å±è”½ä¸­æ–­ï¼šè¿™ç±»ä¸­æ–­å¯¹äºå¤„ç†æ—¶æœºæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œæ˜¯ä¸€äº›ä¸ä¼šå½±å“ç³»ç»Ÿè¿è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚æ‰“å°æœºï¼Œç½‘å¡ç­‰ï¼Œç”šè‡³éƒ½å¯ä»¥ä¸ç”¨è¿›è¡Œå¤„ç†ã€‚å…¶é€šè¿‡<strong>INTRçº¿</strong>å‘CPUè¯·æ±‚ä¸­æ–­ï¼›</li><li>ä¸å¯å±è”½ä¸­æ–­ï¼šé€šè¿‡<strong>NMIçº¿</strong>å‘CPUè¯·æ±‚çš„ä¸­æ–­ï¼Œå¦‚ç”µæºæ‰ç”µï¼Œç¡¬ä»¶çº¿è·¯æ•…éšœç­‰ã€‚è¿™é‡Œä¸å¯å±è”½çš„æ„æ€ä¸æ˜¯ä¸å¯ä»¥å±è”½ï¼Œä¸å»ºè®®å±è”½ï¼Œè€Œæ˜¯é—®é¢˜å¤ªå¤§ï¼Œå±è”½ä¸äº†ï¼Œä¸èƒ½å±è”½çš„æ„æ€ã€‚æ³¨ï¼šINTRå’ŒNMIéƒ½æ˜¯CPUçš„å¼•è„šï¼›</li></ol><p>å†…éƒ¨ä¸­æ–­ä¸€èˆ¬åˆ†ä¸ºé™·é˜±ã€æ•…éšœå’Œç»ˆæ­¢ã€‚</p><ol><li><p>é™·é˜±ï¼š<strong>æ˜¯ä¸€ç§æœ‰æ„çš„ï¼Œé¢„å…ˆå®‰æ’çš„å¼‚å¸¸äº‹ä»¶</strong>ï¼Œä¸€èˆ¬æ˜¯åœ¨ç¼–å†™ç¨‹åºæ—¶æ•…æ„è®¾ä¸‹çš„é™·é˜±æŒ‡ä»¤ï¼Œè€Œåæ‰§è¡Œåˆ°é™·é˜±æŒ‡ä»¤åï¼ŒCPUå°†ä¼šè°ƒç”¨ç‰¹å®šç¨‹åºè¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œ<strong>å¤„ç†ç»“æŸåè¿”å›åˆ°é™·é˜±æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤</strong>ã€‚å¦‚<strong>ç³»ç»Ÿè°ƒç”¨ï¼Œç¨‹åºè°ƒè¯•åŠŸèƒ½</strong>ç­‰ã€‚å¦‚printfå‡½æ•°ï¼Œæœ€åº•å±‚çš„å®ç°ä¸­ä¼šæœ‰ä¸€æ¡int 0x80æŒ‡ä»¤ï¼Œè¿™å°±æ˜¯ä¸€æ¡é™·é˜±æŒ‡ä»¤ï¼Œä½¿ç”¨0x80å·ä¸­æ–­è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚</p><blockquote><p>0x80 å·ä¸­æ–­æ˜¯ <strong>Linux æ—©æœŸç³»ç»Ÿè°ƒç”¨ï¼ˆsyscallï¼‰çš„å…¥å£</strong>ï¼Œç”¨äºç”¨æˆ·æ€ç¨‹åºå‘å†…æ ¸è¯·æ±‚æœåŠ¡ã€‚</p></blockquote></li><li><p>æ•…éšœï¼šæ•…éšœæ˜¯åœ¨å¼•èµ·æ•…éšœçš„æŒ‡ä»¤è¢«æ‰§è¡Œï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œç»“æŸæ—¶ï¼ŒCPUæ£€æµ‹åˆ°çš„ä¸€ç±»çš„æ„å¤–äº‹ä»¶ã€‚å‡ºé”™æ—¶äº¤ç”±æ•…éšœå¤„ç†ç¨‹åºå¤„ç†ï¼Œ**å¦‚æœèƒ½å¤„ç†ä¿®æ­£è¿™ä¸ªé”™è¯¯ï¼Œå°±å°†æ§åˆ¶è¿”å›åˆ°å¼•èµ·æ•…éšœçš„æŒ‡ä»¤å³CPUé‡æ–°æ‰§è¿™æ¡æŒ‡ä»¤ã€‚å¦‚æœä¸èƒ½å¤„ç†å°±æŠ¥é”™ã€‚**å¸¸è§çš„æ•…éšœä¸ºç¼ºé¡µï¼Œå½“CPUå¼•ç”¨çš„è™šæ‹Ÿåœ°å€å¯¹åº”çš„ç‰©ç†é¡µä¸å­˜åœ¨æ—¶å°±ä¼šå‘ç”Ÿæ•…éšœã€‚ç¼ºé¡µå¼‚å¸¸æ˜¯èƒ½å¤Ÿä¿®æ­£çš„ï¼Œæœ‰ç€ä¸“é—¨çš„ç¼ºé¡µå¤„ç†ç¨‹åºï¼Œå®ƒä¼šå°†ç¼ºå¤±çš„ç‰©ç†é¡µä»ç£ç›˜ä¸­é‡æ–°è°ƒè¿›ä¸»å­˜ã€‚è€Œåå†æ¬¡æ‰§è¡Œå¼•èµ·æ•…éšœçš„æŒ‡ä»¤æ—¶ä¾¿èƒ½å¤Ÿé¡ºåˆ©æ‰§è¡Œäº†ã€‚</p></li><li><p>ç»ˆæ­¢ï¼šæ‰§è¡ŒæŒ‡ä»¤çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†è‡´å‘½é”™è¯¯ï¼Œä¸å¯ä¿®å¤ï¼Œç¨‹åºæ— æ³•ç»§ç»­è¿è¡Œï¼Œåªèƒ½ç»ˆæ­¢ï¼Œé€šå¸¸ä¼šæ˜¯ä¸€äº›ç¡¬ä»¶çš„é”™è¯¯ã€‚**ç»ˆæ­¢å¤„ç†ç¨‹åºä¸ä¼šå°†æ§åˆ¶è¿”å›ç»™åŸç¨‹åºï¼Œè€Œæ˜¯ç›´æ¥ç»ˆæ­¢åŸç¨‹åºã€‚</p></li></ol><h2 id="ç½‘ç»œIO"><a href="#ç½‘ç»œIO" class="headerlink" title="ç½‘ç»œIO"></a>ç½‘ç»œIO</h2><h3 id="å‰è¨€-1"><a href="#å‰è¨€-1" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>é¦–å…ˆæ˜¯æ€ä¹ˆå»ç†è§£è¿™ä¸ªIOï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸‰ä¸ªè§’åº¦å»è®¤è¯†è¿™ä¸ªIOã€‚</p><p>é¦–å…ˆæ˜¯ä»ç›´è§‚ä¸Šæ¥çœ‹ï¼Œè¿™å¯¹åº”åœ¨æˆ‘ä»¬ç°å®ä¸­ç”µè„‘çš„æ˜¾ç¤ºå™¨ï¼Œé”®ç›˜é¼ æ ‡ç­‰ä¸»æœºå¤–è®¾ï¼Œæˆ‘ä»¬é€šè¿‡é”®ç›˜å’Œé¼ æ ‡ç»™è®¡ç®—æœºè¾“å…¥å‘½ä»¤ï¼Œè®¡ç®—æœºé€šè¿‡æ˜¾ç¤ºå™¨æ¥è¾“å‡ºç»“æœï¼Œè¿™å°±æ˜¯ç›´è§‚ä¸Šä¸Šçš„è¾“å…¥è¾“å‡ºã€‚</p><p>å…¶æ¬¡æˆ‘ä»¬ä»è®¡ç®—æœºç»“æ„ä¸Šæ¥çœ‹ã€‚åœ¨å®é™…æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯´çš„IOå…¶æœ¬è´¨éƒ½æ˜¯è®¡ç®—æœºå±‚é¢ä¸Šçš„IOï¼ŒIOæ˜¯è¾“å…¥è¾“å‡ºæµï¼Œä»»ä½•ä»CPUæˆ–è€…å†…å­˜æµå…¥ORæµå‡ºçš„æ•°æ®éƒ½æ˜¯IOæµã€‚æ¯”å¦‚æˆ‘ä»¬ä»ç¡¬ç›˜ä¸­åŠ è½½æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œè¿™å°±æ˜¯è¾“å…¥æµï¼Œæˆ‘ä»¬æŠŠå†…å­˜ä¸­çš„æ•°æ®åŠ è½½åˆ°ç¡¬ç›˜ä¸­ï¼Œè¿™å°±æ˜¯è¾“å‡ºæµã€‚</p><p>æœ€åæˆ‘ä»¬ä»ç¼–ç¨‹å±‚é¢ä¸Šæ¥çœ‹ã€‚æ­¤æ—¶IOçš„ä¸»ä½“åº”è¯¥æ˜¯ç¨‹åºçš„è¿è¡Œæ€ä¹Ÿå°±æ˜¯è¿›ç¨‹ï¼Œç‰¹åˆ«å¼ºè°ƒæˆ‘ä»¬çš„ç¨‹åºå…¶å®å¹¶ä¸å­˜åœ¨å®è´¨çš„IOè¿‡ç¨‹ï¼ŒçœŸæ­£çš„IOè¿‡ç¨‹å…¶å®æ˜¯æ“ä½œç³»ç»Ÿçš„äº‹æƒ…ã€‚åœ¨è¿™ä¸ªå±‚é¢ä¸Šåªæ¶‰åŠåˆ°ä¸¤ä¸ªæ¦‚å¿µï¼šIOè°ƒç”¨å’ŒIOæ‰§è¡Œã€‚ä¸éš¾çŒœåˆ°çš„æ˜¯ï¼Œè¿›ç¨‹é€šè¿‡IOè°ƒç”¨æ“ä½œç³»ç»Ÿè¿›è¡ŒIOæ‰§è¡Œã€‚IOè°ƒç”¨çš„ç›®çš„å°±æ˜¯å°†è¿›ç¨‹å†…éƒ¨çš„æ•°æ®è¿ç§»åˆ°å¤–éƒ¨å³è¾“å‡ºï¼Œå°†è¿›ç¨‹å¤–é¢çš„æ•°æ®è¿ç§»åˆ°æ•°æ®å†…éƒ¨å³è¾“å…¥ã€‚è¿™é‡Œçš„å¤–éƒ¨æ•°æ®ä¸€èˆ¬ä¸ºç¡¬ç›˜å†…æ•°æ®æˆ–è€…Socketçš„ç½‘ç»œæ•°æ®ç­‰ã€‚</p><p>å¦‚æœä»åº”ç”¨å±‚é¢æ¥çœ‹çš„è¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹IOè¾“å…¥å’Œè¾“å‡ºã€‚</p><ol><li>IOè¾“å…¥ï¼šé€šè¿‡ç½‘å¡è·å–åˆ°ç½‘ç»œæ•°æ®åŒ…ï¼Œç„¶åç½‘å¡é€šè¿‡DMAï¼ˆç›´æ¥å†…å­˜è®¿é—®ï¼‰æŠ€æœ¯ï¼Œå°†è¯¥æ•°æ®ç›´æ¥è¿ç§»åˆ°å†…æ ¸å†…å­˜ç¼“å†²åŒºï¼Œè¿™æ ·å°±æ— éœ€CPUçš„å‚ä¸ï¼Œæé«˜äº†æ•ˆç‡ã€‚å†…æ ¸å°†æ•°æ®ä»å†…æ ¸å†…å­˜ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºï¼ˆä¹Ÿå°±æ˜¯è¿›ç¨‹å†…å­˜ç©ºé—´ä¸­ï¼‰ï¼›</li><li>IOè¾“å‡ºï¼šåè¿‡æ¥ã€‚</li></ol><p><strong>éé˜»å¡ I&#x2F;O + å¤šè·¯å¤ç”¨</strong> æ˜¯è§£å†³é«˜å¹¶å‘ä¸‹çº¿ç¨‹å¼€é”€é—®é¢˜çš„æ ¸å¿ƒæ–¹æ¡ˆï¼Œ<strong>æœ¬èº«ä¸ä¼šå¯¼è‡´ CPU ç©ºè½¬</strong>ã€‚</p><p><strong>æµç¨‹å›¾è§£</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç½‘ç»œæ•°æ® â†’ ç½‘å¡ç¼“å†²åŒº â†’ï¼ˆDMAæ‹·è´ï¼‰â†’ å†…æ ¸ç©ºé—´ç¼“å†²åŒº â†’ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰â†’ ç”¨æˆ·ç©ºé—´ç¼“å†²åŒº â†’ è¿›ç¨‹å¤„ç†</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111504159.png" alt="image-20250311150431111"></p><h3 id="é˜»å¡å’Œéé˜»å¡IO"><a href="#é˜»å¡å’Œéé˜»å¡IO" class="headerlink" title="é˜»å¡å’Œéé˜»å¡IO"></a>é˜»å¡å’Œéé˜»å¡IO</h3><p>é˜»å¡å’Œéé˜»å¡å¼ºè°ƒçš„æ˜¯è¿›ç¨‹å¯¹äºæ“ä½œç³»ç»ŸIOæ˜¯å¦å¤„äºå°±ç»ªçŠ¶æ€çš„å¤„ç†æ–¹å¼ã€‚</p><p>ä¸Šé¢å·²ç»è¯´è¿‡ï¼Œåº”ç”¨ç¨‹åºçš„IOå®é™…æ˜¯åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼ŒIOè°ƒç”¨å’ŒIOæ‰§è¡Œã€‚IOè°ƒç”¨æ˜¯ç”±è¿›ç¨‹å‘èµ·ï¼ŒIOæ‰§è¡Œæ˜¯æ“ä½œç³»ç»Ÿçš„å·¥ä½œã€‚æ“ä½œç³»ç»Ÿçš„IOæƒ…å†µå†³å®šäº†è¿›ç¨‹IOè°ƒç”¨æ˜¯å¦èƒ½å¤Ÿå¾—åˆ°ç«‹å³å“åº”ã€‚å¦‚è¿›ç¨‹å‘èµ·äº†è¯»å–æ•°æ®çš„IOè°ƒç”¨ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦å°†å¤–éƒ¨æ•°æ®æ‹·è´åˆ°è¿›ç¨‹ç¼“å†²åŒºï¼Œåœ¨æœ‰æ•°æ®æ‹·è´åˆ°è¿›ç¨‹ç¼“å†²åŒºå‰ï¼Œè¿›ç¨‹ç¼“å†²åŒºå¤„äºä¸å¯è¯»çŠ¶æ€ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ“ä½œç³»ç»ŸIOæœªå°±ç»ªã€‚</p><p>è¿›ç¨‹çš„IOè°ƒç”¨æ˜¯å¦èƒ½å¾—åˆ°ç«‹å³æ‰§è¡Œæ˜¯éœ€è¦æ“ä½œç³»ç»ŸIOå¤„äºå°±ç»ªçŠ¶æ€çš„ï¼Œå¯¹äºè¯»å–æ•°æ®çš„æ“ä½œï¼Œå¦‚æœæ“ä½œç³»ç»ŸIOå¤„äºæœªå°±ç»ªçŠ¶æ€ï¼Œå½“å‰è¿›ç¨‹æˆ–çº¿ç¨‹å¦‚æœä¸€ç›´ç­‰å¾…ç›´åˆ°å…¶å°±ç»ªï¼Œè¯¥ç§IOæ–¹å¼ä¸ºé˜»å¡IOã€‚å¦‚æœè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶ä¸ä¸€ç›´ç­‰å¾…å…¶å°±ç»ªï¼Œè€Œæ˜¯å¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼Œè¿™ç§æ–¹å¼ä¸ºéé˜»å¡IOã€‚æ‰€ä»¥å¯¹äºéé˜»å¡IOï¼Œæˆ‘ä»¬ç¼–ç¨‹æ—¶éœ€è¦ç»å¸¸å»è½®è¯¢å°±ç»ªçŠ¶æ€ã€‚</p><p>å¦‚æœæ˜¯ä¼ ç»Ÿçš„é˜»å¡IOï¼Œé‚£ä¹ˆå¯¹åº”æ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šç”Ÿæˆä¸€ä¸ªçº¿ç¨‹å»ç­‰å¾…IOå°±è¡Œï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œèµ„æºæ¶ˆè€—å·¨å¤§ã€‚</p><p>ä½†æ˜¯å¦‚æœæ˜¯éé˜»å¡IOçš„è¯ï¼Œé‚£ä¹ˆå¦‚æœè¯¥çº¿ç¨‹éœ€è¦ç­‰å¾…IOå°±ç»ªçš„è¯ï¼Œä¸ä¼šä¸€ç›´åœç•™ç­‰å¾…IOå°±ç»ªï¼Œä¸”ä¹Ÿä¸ä¼šå¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚ç­‰å¾…IOå°±ç»ªéƒ½ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹å»ç­‰å¾…ã€‚å®ƒä¼šæ ¹æ®ä¸åŒçš„å®ç°ï¼Œä¸€èˆ¬ä½¿ç”¨å•çº¿ç¨‹æˆ–è€…IOå¤šè·¯å¤ç”¨çš„å½¢å¼å‡å°‘çº¿ç¨‹å»è½®è¯¢ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜æ˜¾çš„å‘å‹ï¼Œéé˜»å¡IOä¼šå¯¼è‡´CPUç©ºè½¬ï¼Œä¸€ç›´è½®è¯¢ï¼Œå¯¼è‡´èµ„æºçš„æµªè´¹ã€‚</p><h3 id="åŒæ­¥å’Œå¼‚æ­¥IO"><a href="#åŒæ­¥å’Œå¼‚æ­¥IO" class="headerlink" title="åŒæ­¥å’Œå¼‚æ­¥IO"></a>åŒæ­¥å’Œå¼‚æ­¥IO</h3><p>æˆ‘ä»¬ç»å¸¸ä¼šè°ˆåŠåŒæ­¥IOå’Œå¼‚æ­¥IOã€‚åŒæ­¥å’Œå¼‚æ­¥æè¿°çš„æ˜¯é’ˆå¯¹å½“å‰æ‰§è¡Œçº¿ç¨‹ã€æˆ–è¿›ç¨‹è€Œè¨€ï¼Œå‘èµ·IOè°ƒç”¨åï¼Œå½“å‰çº¿ç¨‹æˆ–è¿›ç¨‹æ˜¯å¦æŒ‚èµ·ç­‰å¾…æ“ä½œç³»ç»Ÿçš„IOæ‰§è¡Œå®Œæˆã€‚</p><p>æˆ‘ä»¬è¯´ä¸€ä¸ªIOæ‰§è¡Œæ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæ„æ€æ˜¯ç¨‹åºå‘èµ·IOè°ƒç”¨ï¼Œå½“å‰çº¿ç¨‹æˆ–è¿›ç¨‹éœ€è¦ç­‰å¾…æ“ä½œç³»ç»Ÿå®ŒæˆIOå·¥ä½œå¹¶å‘ŠçŸ¥è¿›ç¨‹å·²ç»å®Œæˆï¼Œçº¿ç¨‹æˆ–è¿›ç¨‹æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œå…¶ä»–æ—¢å®šæŒ‡ä»¤ã€‚</p><p>å¦‚æœè¯´ä¸€ä¸ªIOæ‰§è¡Œæ˜¯å¼‚æ­¥çš„ï¼Œæ„æ€æ˜¯è¯¥åŠ¨ä½œæ˜¯ç”±å½“å‰çº¿ç¨‹æˆ–è¿›ç¨‹è¯·æ±‚å‘èµ·ï¼Œä¸”å½“å‰çº¿ç¨‹æˆ–è¿›ç¨‹ä¸å¿…ç­‰å¾…æ“ä½œç³»ç»ŸIOçš„æ‰§è¡Œå®Œæ¯•ï¼Œå¯ç›´æ¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œå…¶ä»–æ—¢å®šæŒ‡ä»¤ã€‚æ“ä½œç³»ç»Ÿå®ŒæˆIOåï¼Œå½“å‰çº¿ç¨‹æˆ–è¿›ç¨‹ä¼šå¾—åˆ°æ“ä½œç³»ç»Ÿçš„é€šçŸ¥ã€‚</p><p>ä»¥ä¸€ä¸ªè¯»å–æ•°æ®çš„IOæ“ä½œè€Œè¨€ï¼Œåœ¨æ“ä½œç³»ç»Ÿå°†å¤–éƒ¨æ•°æ®å†™å…¥è¿›ç¨‹ç¼“å†²åŒºè¿™ä¸ªæœŸé—´ï¼Œè¿›ç¨‹æˆ–çº¿ç¨‹æŒ‚èµ·ç­‰å¾…æ“ä½œç³»ç»ŸIOæ‰§è¡Œå®Œæˆçš„è¯ï¼Œè¿™ç§IOæ‰§è¡Œç­–ç•¥å°±ä¸ºåŒæ­¥ï¼Œå¦‚æœè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶ä¸æŒ‚èµ·è€Œæ˜¯ç»§ç»­å·¥ä½œï¼Œè¿™ç§IOæ‰§è¡Œç­–ç•¥ä¾¿ä¸ºå¼‚æ­¥ã€‚</p><h3 id="éé˜»å¡IOä¸å¼‚æ­¥IO"><a href="#éé˜»å¡IOä¸å¼‚æ­¥IO" class="headerlink" title="éé˜»å¡IOä¸å¼‚æ­¥IO"></a>éé˜»å¡IOä¸å¼‚æ­¥IO</h3><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“äº†éé˜»å¡IOä¸å¼‚æ­¥IOåˆ†åˆ«æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯éé˜»å¡IOä¸å¼‚æ­¥IOæœ‰ä»€ä¹ˆå…·ä½“çš„åŒºåˆ«å‘¢ï¼Ÿ</p><p>éé˜»å¡IOåœ¨ç­‰å¾…IOå°±ç»ªçš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠ¥å‡ºé”™è¯¯ä»è€Œå¯ä»¥ä»è¿™ä¸ªç­‰å¾…ä¸­æŠ½å‡ºèº«ï¼Œä½†æ˜¯åç»­è¿˜æ˜¯éœ€è¦ä¸æ–­çš„å»è½®è¯¢IOæ˜¯å¦å‡†å¤‡å°±ç»ªã€‚å¼‚æ­¥IOåœ¨è¿™é‡Œéƒ½æ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«å°±åœ¨åé¢è¿™é‡Œã€‚ä¸€æ—¦IOå‡†å¤‡å°±ç»ªäº†ï¼Œéé˜»å¡IOè½®è¯¢åˆ°äº†ï¼ˆè¿™é‡Œå°±ä¸æ˜¯å®æ—¶æ€§çš„ï¼‰ï¼Œå°±ä¼šé…åˆæ“ä½œç³»ç»ŸæŠŠéœ€è¦çš„æ•°æ®å¤åˆ¶åˆ°è¿›ç¨‹ç¼“å†²åŒºä¸­ã€‚ä½†æ˜¯å¼‚æ­¥IOçš„æœ¬è´¨å°±åœ¨è¿™é‡Œï¼Œå®ƒä¸éœ€è¦ä¸€ç›´è½®è¯¢ï¼Œè€Œæ˜¯æ“ä½œç³»ç»Ÿä¼šé€šçŸ¥è¿›ç¨‹IOå·²ç»å‡†å¤‡å°±ç»ªï¼Œä¸”ä¸éœ€è¦é…åˆæ“ä½œç³»ç»Ÿå°†æ•°æ®å¤åˆ¶åˆ°è¿›ç¨‹ç¼“å†²åŒºä¸­ï¼Œè¿™å°±æ˜¯å¼‚æ­¥IOä¸éé˜»å¡IOçš„æœ¬è´¨åŒºåˆ«ã€‚</p><p>å…¶å®éé˜»å¡IOæ˜¯åŒæ­¥éé˜»å¡IOã€‚</p><h3 id="å…³é”®åŒºåˆ«ï¼šæ•°æ®æ‹·è´é˜¶æ®µ"><a href="#å…³é”®åŒºåˆ«ï¼šæ•°æ®æ‹·è´é˜¶æ®µ" class="headerlink" title="å…³é”®åŒºåˆ«ï¼šæ•°æ®æ‹·è´é˜¶æ®µ"></a><strong>å…³é”®åŒºåˆ«ï¼šæ•°æ®æ‹·è´é˜¶æ®µ</strong></h3><table><thead><tr><th align="center"><strong>é˜¶æ®µ</strong></th><th align="center"><strong>éé˜»å¡IO</strong></th><th align="center"><strong>å¼‚æ­¥IO</strong></th></tr></thead><tbody><tr><td align="center"><strong>æ•°æ®åˆ°è¾¾ç½‘å¡</strong></td><td align="center">å†…æ ¸å°†æ•°æ®æ‹·è´åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒº</td><td align="center">å†…æ ¸å°†æ•°æ®æ‹·è´åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒº</td></tr><tr><td align="center"><strong>æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</strong></td><td align="center"><strong>è¿›ç¨‹è°ƒç”¨<code>recv()</code>ä¸»åŠ¨æ‹·è´</strong></td><td align="center"><strong>å†…æ ¸è‡ªåŠ¨å®Œæˆæ‹·è´</strong></td></tr><tr><td align="center"><strong>è¿›ç¨‹å‚ä¸åº¦</strong></td><td align="center">åŒæ­¥æ“ä½œï¼ˆè¿›ç¨‹éœ€ä¸»åŠ¨å¤„ç†ï¼‰</td><td align="center">å¼‚æ­¥æ“ä½œï¼ˆè¿›ç¨‹æ— éœ€å‚ä¸æ‹·è´ï¼‰</td></tr></tbody></table><h3 id="ä½ äº†è§£è¿‡å“ªäº›ioæ¨¡å‹ï¼Ÿ"><a href="#ä½ äº†è§£è¿‡å“ªäº›ioæ¨¡å‹ï¼Ÿ" class="headerlink" title="ä½ äº†è§£è¿‡å“ªäº›ioæ¨¡å‹ï¼Ÿ"></a>ä½ äº†è§£è¿‡å“ªäº›ioæ¨¡å‹ï¼Ÿ</h3><ul><li><strong>é˜»å¡I&#x2F;Oæ¨¡å‹</strong>ï¼šåº”ç”¨ç¨‹åºå‘èµ·I&#x2F;Oæ“ä½œåä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ“ä½œå®Œæˆæ‰è¿”å›ç»“æœã€‚é€‚ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚</li><li><strong>éé˜»å¡I&#x2F;Oæ¨¡å‹</strong>ï¼šåº”ç”¨ç¨‹åºå‘èµ·I&#x2F;Oæ“ä½œåç«‹å³è¿”å›ï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œä½†éœ€è¦ä¸æ–­è½®è¯¢æˆ–è€…ä½¿ç”¨select&#x2F;poll&#x2F;epollç­‰ç³»ç»Ÿè°ƒç”¨æ¥æ£€æŸ¥I&#x2F;Oæ“ä½œæ˜¯å¦å®Œæˆã€‚é€‚åˆäºéœ€è¦è¿›è¡Œå¤šè·¯å¤ç”¨çš„åœºæ™¯ï¼Œä¾‹å¦‚éœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªsocketè¿æ¥çš„æœåŠ¡å™¨ç¨‹åºã€‚</li><li><strong>I&#x2F;Oå¤ç”¨æ¨¡å‹</strong>ï¼šé€šè¿‡selectã€pollã€epollç­‰ç³»ç»Ÿè°ƒç”¨ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åŒæ—¶ç­‰å¾…å¤šä¸ªI&#x2F;Oæ“ä½œï¼Œå½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªI&#x2F;Oæ“ä½œå‡†å¤‡å°±ç»ªæ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šè¢«é€šçŸ¥ã€‚é€‚åˆäºéœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªI&#x2F;Oæ“ä½œçš„åœºæ™¯ï¼Œæ¯”å¦‚é«˜å¹¶å‘çš„æœåŠ¡ç«¯ç¨‹åºã€‚ </li><li><strong>ä¿¡å·é©±åŠ¨I&#x2F;Oæ¨¡å‹</strong>ï¼šåº”ç”¨ç¨‹åºå‘èµ·I&#x2F;Oæ“ä½œåï¼Œå¯ä»¥ç»§ç»­åšå…¶ä»–äº‹æƒ…ï¼Œå½“I&#x2F;Oæ“ä½œå®Œæˆæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘åº”ç”¨ç¨‹åºå‘é€ä¿¡å·æ¥é€šçŸ¥å…¶å®Œæˆã€‚é€‚åˆäºéœ€è¦å¼‚æ­¥I&#x2F;Oé€šçŸ¥çš„åœºæ™¯ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ã€‚</li><li><strong>å¼‚æ­¥I&#x2F;Oæ¨¡å‹</strong>ï¼šåº”ç”¨ç¨‹åºå‘èµ·I&#x2F;Oæ“ä½œåå¯ä»¥ç«‹å³åšå…¶ä»–äº‹æƒ…ï¼Œå½“I&#x2F;Oæ“ä½œå®Œæˆæ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šå¾—åˆ°é€šçŸ¥ã€‚å¼‚æ­¥I&#x2F;Oæ¨¡å‹ç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®ŒæˆI&#x2F;Oæ“ä½œï¼Œåº”ç”¨ç¨‹åºåªéœ€ç­‰å¾…é€šçŸ¥å³å¯ã€‚é€‚åˆäºéœ€è¦å¤§é‡å¹¶å‘è¿æ¥å’Œé«˜æ€§èƒ½çš„åœºæ™¯ï¼Œèƒ½å¤Ÿå‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿæ•ˆç‡ã€‚</li></ul><h3 id="IOæŒ‡çš„å“ªäº›èµ„æº"><a href="#IOæŒ‡çš„å“ªäº›èµ„æº" class="headerlink" title="IOæŒ‡çš„å“ªäº›èµ„æº"></a>IOæŒ‡çš„å“ªäº›èµ„æº</h3><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œ<strong>I&#x2F;Oï¼ˆè¾“å…¥&#x2F;è¾“å‡ºï¼‰</strong> æ˜¯æŒ‡<strong>è®¡ç®—æœºå’Œå¤–éƒ¨è®¾å¤‡ä¹‹é—´çš„æ•°æ®äº¤æ¢</strong>ï¼Œä¸ä»…ä»…æ˜¯ç½‘ç»œ I&#x2F;Oï¼Œè¿˜åŒ…æ‹¬ç£ç›˜ I&#x2F;Oã€ç»ˆç«¯ I&#x2F;O ç­‰ã€‚</p><h3 id="é˜»å¡IOçš„æƒ…å†µä¸‹ï¼Œé˜»å¡çš„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#é˜»å¡IOçš„æƒ…å†µä¸‹ï¼Œé˜»å¡çš„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="é˜»å¡IOçš„æƒ…å†µä¸‹ï¼Œé˜»å¡çš„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>é˜»å¡IOçš„æƒ…å†µä¸‹ï¼Œé˜»å¡çš„æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>åœ¨ <strong>é˜»å¡ I&#x2F;O</strong> çš„æƒ…å†µä¸‹ï¼š</p><ul><li><strong>è¯¥çº¿ç¨‹ï¼ˆè¿›ç¨‹ï¼‰</strong> ä¼šè¿›å…¥ <strong>â€œç¡çœ â€çŠ¶æ€ï¼ˆBlockedï¼‰</strong>ï¼Œç›´åˆ°æ•°æ®åˆ°è¾¾ã€‚</li><li><strong>CPU èµ„æºä¸ä¼šè¢«æµªè´¹</strong>ï¼Œè€Œæ˜¯è¢«æ“ä½œç³»ç»Ÿè°ƒåº¦ç»™å…¶ä»–å¯è¿è¡Œçš„ä»»åŠ¡ã€‚</li><li><strong>ä½†è¯¥çº¿ç¨‹è‡ªå·±æ— æ³•æ‰§è¡Œåç»­ä»»åŠ¡</strong>ï¼Œå®ƒåªèƒ½ç­‰å¾… <code>recv()</code> è¿”å›æ•°æ®åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</li></ul><h3 id="æœåŠ¡å™¨å¤„ç†å¹¶å‘è¯·æ±‚æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"><a href="#æœåŠ¡å™¨å¤„ç†å¹¶å‘è¯·æ±‚æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="æœåŠ¡å™¨å¤„ç†å¹¶å‘è¯·æ±‚æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"></a>æœåŠ¡å™¨å¤„ç†å¹¶å‘è¯·æ±‚æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</h3><ul><li><strong>å•çº¿ç¨‹webæœåŠ¡å™¨æ–¹å¼</strong>ï¼šwebæœåŠ¡å™¨ä¸€æ¬¡å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œç»“æŸåè¯»å–å¹¶å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œæ€§èƒ½æ¯”è¾ƒä½ï¼Œä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚ </li><li><strong>å¤šè¿›ç¨‹&#x2F;å¤šçº¿ç¨‹webæœåŠ¡å™¨</strong>ï¼šwebæœåŠ¡å™¨ç”Ÿæˆå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶è¡Œå¤„ç†å¤šä¸ªç”¨æˆ·è¯·æ±‚ï¼Œè¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥æŒ‰éœ€æˆ–äº‹å…ˆç”Ÿæˆã€‚æœ‰çš„webæœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸ºæ¯ä¸ªç”¨æˆ·è¯·æ±‚ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æˆ–çº¿ç¨‹æ¥è¿›è¡Œå“åº”ï¼Œä¸è¿‡ï¼Œä¸€æ—¦å¹¶å‘è¯·æ±‚æ•°é‡è¾¾åˆ°æˆåƒä¸Šä¸‡æ—¶ï¼Œå¤šä¸ªåŒæ—¶è¿è¡Œçš„è¿›ç¨‹æˆ–çº¿ç¨‹å°†ä¼šæ¶ˆè€—å¤§é‡çš„ç³»ç»Ÿèµ„æºã€‚ï¼ˆå³æ¯ä¸ªè¿›ç¨‹åªèƒ½å“åº”ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”ä¸€ä¸ªè¿›ç¨‹å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼‰</li><li><strong>I&#x2F;Oå¤šè·¯å¤ç”¨webæœåŠ¡å™¨</strong>ï¼šwebæœåŠ¡å™¨å¯ä»¥<strong>I&#x2F;Oå¤šè·¯å¤ç”¨</strong>ï¼Œè¾¾åˆ°åªç”¨ä¸€ä¸ªçº¿ç¨‹å°±èƒ½ç›‘å¬å’Œå¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„ i&#x2F;o äº‹ä»¶ã€‚</li><li><strong>å¤šè·¯å¤ç”¨å¤šçº¿ç¨‹webæœåŠ¡å™¨</strong>ï¼šå°†å¤šè¿›ç¨‹å’Œå¤šè·¯å¤ç”¨çš„åŠŸèƒ½ç»“åˆèµ·æ¥å½¢æˆçš„webæœåŠ¡å™¨æ¶æ„ï¼Œå…¶é¿å…äº†è®©ä¸€ä¸ªè¿›ç¨‹æœåŠ¡äºè¿‡å¤šçš„ç”¨æˆ·è¯·æ±‚ï¼Œå¹¶èƒ½å……åˆ†åˆ©ç”¨å¤šCPUä¸»æœºæ‰€æä¾›çš„è®¡ç®—èƒ½åŠ›ã€‚ï¼ˆè¿™ç§æ¶æ„å¯ä»¥ç†è§£ä¸ºæœ‰å¤šä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸”ä¸€ä¸ªè¿›ç¨‹åˆç”Ÿæˆå¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼‰</li></ul><h3 id="è®²ä¸€è®²IOå¤šè·¯å¤ç”¨"><a href="#è®²ä¸€è®²IOå¤šè·¯å¤ç”¨" class="headerlink" title="è®²ä¸€è®²IOå¤šè·¯å¤ç”¨"></a>è®²ä¸€è®²IOå¤šè·¯å¤ç”¨</h3><p>é€šè¿‡ä¸Šé¢äº†è§£çš„éé˜»å¡IOï¼Œä¹Ÿå°±æ˜¯NIOï¼Œå®ƒå¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚ä¸ä¼šéƒ½å»ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹å»ä¸€ç›´é˜»å¡ç­‰å¾…IOå°±ç»ªã€‚ä¸ºäº†é¿å…è¿™ä¸ªçº¿ç¨‹è¿‡å¤šå¯¼è‡´çš„èµ„æºæ¶ˆè€—ï¼Œå¯ä»¥é‡‡ç”¨IOå¤šè·¯å¤ç”¨æŠ€æœ¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>IOå¤šè·¯å¤ç”¨æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæ‰€æœ‰çš„è¯·æ±‚éƒ½åªè¦ä¸€ä¸ªçº¿ç¨‹æ¥è½®è¯¢IOæ˜¯å¦å°±ç»ªï¼Œç”¨ä¸“ä¸šçš„è¯æ¥è¯´å°±æ˜¯ï¼š<strong>I&#x2F;O å¤šè·¯å¤ç”¨</strong> ä½¿å¾—ç¨‹åºèƒ½ <strong>åŒæ—¶ç›‘å¬ å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦</strong>ï¼Œèƒ½å¤Ÿæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>é‚£ä¹ˆIOå¤šè·¯å¤ç”¨æŠ€æœ¯æœ‰å“ªäº›å‘¢ï¼Ÿ</p><p>ç¬¬ä¸€ç§ï¼Œé€šè¿‡Selectæˆ–è€…pollã€‚<img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503110019687.png" alt="image-20250311001933526"></p><p>ç¬¬äºŒç§é€šè¿‡epoll<img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503110020292.png" alt="image-20250311002004154"></p><h4 id="Select-Poll"><a href="#Select-Poll" class="headerlink" title="Select&#x2F;Poll"></a>Select&#x2F;Poll</h4><p>é¦–å…ˆè¦æ„é€ ä¸€ä¸ªå…³äº <strong>æ–‡ä»¶æè¿°ç¬¦</strong>çš„ åˆ—è¡¨ï¼Œå°†è¦ ç›‘å¬çš„ <strong>æ–‡ä»¶æè¿°ç¬¦</strong> æ·»åŠ  åˆ°è¯¥åˆ—è¡¨ä¸­ã€‚</p><p>è°ƒç”¨ä¸€ä¸ª <strong>ç³»ç»Ÿå‡½æ•°</strong>ï¼Œç›‘å¬ è¯¥åˆ—è¡¨ä¸­çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç›´åˆ°è¿™äº›æè¿°ç¬¦ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿›è¡Œ I&#x2F;Oæ“ä½œ æ—¶ï¼Œè¯¥å‡½æ•°æ‰è¿”å›ã€‚</p><ul><li>a. è¿™ä¸ªå‡½æ•°æ˜¯ é˜»å¡</li><li>b. å‡½æ•°å¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ£€æµ‹çš„æ“ä½œæ˜¯ ç”± å†…æ ¸ å®Œæˆçš„</li></ul><p>åœ¨è¿”å›æ—¶ï¼Œå®ƒä¼šå‘Šè¯‰è¿›ç¨‹æœ‰ å¤šå°‘ï¼ˆå“ªäº›ï¼‰æè¿°ç¬¦ è¦è¿›è¡Œ I&#x2F;Oæ“ä½œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111505644.png" alt="image-20250311150512581"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503110032730.png" alt="image-20250311003240641"></p><p>select å®ç°å¤šè·¯å¤ç”¨çš„æ–¹å¼æ˜¯ï¼Œå°†å·²è¿æ¥çš„ Socket éƒ½æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œç„¶åè°ƒç”¨ select å‡½æ•°å°†æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´åˆ°å†…æ ¸é‡Œï¼Œè®©å†…æ ¸æ¥æ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œäº‹ä»¶äº§ç”Ÿï¼Œæ£€æŸ¥çš„æ–¹å¼å¾ˆç²—æš´ï¼Œå°±æ˜¯é€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦é›†åˆçš„æ–¹å¼ï¼Œå½“æ£€æŸ¥åˆ°æœ‰äº‹ä»¶äº§ç”Ÿåï¼Œå°†æ­¤ Socket æ ‡è®°ä¸ºå¯è¯»æˆ–å¯å†™ï¼Œ æ¥ç€å†æŠŠæ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´å›ç”¨æˆ·æ€é‡Œï¼Œç„¶åç”¨æˆ·æ€è¿˜éœ€è¦å†é€šè¿‡éå†çš„æ–¹æ³•æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„ Socketï¼Œç„¶åå†å¯¹å…¶å¤„ç†ã€‚ </p><p>æ‰€ä»¥ï¼Œå¯¹äº select è¿™ç§æ–¹å¼ï¼Œéœ€è¦è¿›è¡Œ 2 æ¬¡ã€Œéå†ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œä¸€æ¬¡æ˜¯åœ¨å†…æ ¸æ€é‡Œï¼Œä¸€ä¸ªæ¬¡æ˜¯åœ¨ç”¨æˆ·æ€é‡Œ ï¼Œè€Œä¸”è¿˜ä¼šå‘ç”Ÿ 2 æ¬¡ã€Œæ‹·è´ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå…ˆä»ç”¨æˆ·ç©ºé—´ä¼ å…¥å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸ä¿®æ”¹åï¼Œå†ä¼ å‡ºåˆ°ç”¨æˆ·ç©ºé—´ä¸­</p><p>æ¥å¯¹Selectä¸Pollåšä¸€ä¸ªå°æ€»ç»“ï¼ŒSelectæ˜¯éé˜»å¡IOä¸­ç”¨åˆ°çš„IOå¤šè·¯å¤ç”¨çš„æŠ€æœ¯å®ç°ã€‚Selectä¼šå°†Socketè¿æ¥æ”¾ç½®åœ¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆä¸­ï¼Œç„¶åä¼šæ‹·è´åˆ°å†…æ ¸ä¸­ï¼Œå¹¶ä¼šè¿›è¡Œç›‘å¬ï¼Œç›‘å¬çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œå†…æ ¸ä¼šç›‘æ§è¿™ä¸ªæ–‡ä»¶æè¿°é›†åˆï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œç„¶åå°†è¯¥Socketæ ‡è®°ä¸ºå¯è¯»æˆ–è€…å¯å†™ï¼Œç„¶åå†…æ ¸ä¼šæŠŠè¯¥æ–‡ä»¶æè¿°é›†åˆæ‹·è´åˆ°ç”¨æˆ·æ€é‡Œï¼Œç„¶åç”¨æˆ·æ€ä¹Ÿå°±æ˜¯è¿›ç¨‹éœ€è¦å†æ¬¡éå†è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼ŒæŸ¥çœ‹é‡Œé¢æ˜¯å¦æœ‰å¯è¯»æˆ–è€…å¯å†™çš„Socketï¼Œç„¶åå†å¯¹å…¶å¤„ç†ã€‚</p><p>Selecté‡‡ç”¨çš„æ˜¯BitMapï¼Œè¿™æ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦çš„ï¼Œç”¨æ¥è¡¨è¿°æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œç´¢å¼•å…¶æ”¯æŒçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ä¹Ÿæ˜¯æœ‰é™çš„ï¼ˆå› ä¸ºé‡‡ç”¨å›ºå®šçš„BitMapå˜›ï¼‰ï¼Œå…¶é»˜è®¤æœ€å¤§å€¼æ˜¯1024ä¸ªã€‚</p><p>ä½†æ˜¯Pollä¸åœ¨ä½¿ç”¨BitMapæ¥å­˜å‚¨æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œé€‰æ‹©äº†é‡‡ç”¨åŠ¨æ€æ•°ç»„æ¥è¿›è¡Œä¿å­˜ï¼Œä»¥é“¾è¡¨çš„å½¢å¼ã€‚</p><p>ä½†æ˜¯ poll å’Œ select å¹¶æ²¡æœ‰å¤ªå¤§çš„æœ¬è´¨åŒºåˆ«ï¼Œéƒ½æ˜¯ä½¿ç”¨ã€Œçº¿æ€§ç»“æ„ã€å­˜å‚¨è¿›ç¨‹å…³æ³¨çš„ Socket é›†åˆï¼Œå› æ­¤éƒ½éœ€è¦éå†æ–‡ä»¶æè¿°ç¬¦é›†åˆæ¥æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„ Socketï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œè€Œä¸”ä¹Ÿéœ€è¦åœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´æ‹·è´æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œè¿™ç§æ–¹å¼éšç€å¹¶å‘æ•°ä¸Šæ¥ï¼Œæ€§èƒ½çš„æŸè€—ä¼šå‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚</p><h4 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h4><p>æˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹ä¸Šé¢ä¸­Selectå’ŒPollæŠ€æœ¯çš„ç¼ºç‚¹ï¼Œé¦–å…ˆå°±æ˜¯éœ€è¦è¿›è¡Œä¸¤æ¬¡ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ‹·è´ï¼Œä¸”éœ€è¦å¯¹æ–‡ä»¶æè¿°ç¬¦é›†åˆè¿›è¡Œä¸¤æ¬¡éå†ï¼Œå¹¶ä¸é«˜æ•ˆï¼Œæ‰€ä»¥epolléœ€è¦å¯¹æ­¤è¿›è¡Œä¼˜åŒ–ã€‚</p><p>é¦–å…ˆå¯¹éå†æ¥è¿›è¡Œä¼˜åŒ–ï¼ŒPollé‡‡ç”¨çš„æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæ˜¯ä»¥é“¾è¡¨çš„å½¢å¼å®ç°çš„ï¼Œéå†çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œepollåˆ™æ‰ç”¨çº¢é»‘æ ‘ä½œä¸ºå…¶æ–‡ä»¶æè¿°ç¬¦é›†åˆçš„æ•°æ®ç»“æ„ï¼Œå…¶æ—¶é—´å¤æ‚åº¦O(log n)ã€‚</p><p>å…¶æ¬¡é’ˆå¯¹ä¸¤æ¬¡æ‹·è´è¿›è¡Œä¼˜åŒ–ï¼ŒSelectéœ€è¦è¿›è¡Œä¸¤æ¬¡æ‹·è´ï¼Œè€Œepollé‡‡ç”¨mmapæ˜ å°„ä¹Ÿå°±æ˜¯å…±äº«å†…å­˜åœ¨å†…æ ¸å’Œç”¨æˆ·æ€ä¹‹é—´è¿›è¡Œä¼ é€’æ—¶é—´ï¼Œé¿å…çš„æ•°æ®æ‹·è´ã€‚</p><p>æœ€åé’ˆå¯¹æ¯æ¬¡éƒ½éœ€è¦éå†æ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆè¿›è¡Œä¼˜åŒ–ï¼Œepollé‡‡ç”¨äº‹å‡é©±åŠ¨ä¸­çš„å›è°ƒæœºåˆ¶ï¼Œå†…æ ¸é€šè¿‡å›è°ƒå‡½æ•°å°†å°±ç»ªçš„fdåŠ å…¥å°±ç»ªé˜Ÿåˆ—ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111445811.png" alt="image-20250311144541745"></p><p>ä¼˜åŒ–ä¹‹åï¼Œè¿˜æœ‰å¯¹å…¶ä»–çš„è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚è§¦å‘æ¨¡å¼çš„ä¼˜åŒ–ã€‚</p><ul><li>è¾¹ç¼˜è§¦å‘ï¼šä½¿ç”¨è¾¹ç¼˜è§¦å‘æ¨¡å¼æ—¶ï¼Œå½“è¢«ç›‘æ§çš„ Socket æè¿°ç¬¦ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒæœåŠ¡å™¨ç«¯åªä¼šä» epoll_wait ä¸­è‹é†’ä¸€æ¬¡ï¼Œå³ä½¿è¿›ç¨‹æ²¡æœ‰è°ƒç”¨ read å‡½æ•°ä»å†…æ ¸è¯»å–æ•°æ®ï¼Œä¹Ÿä¾ç„¶åªè‹é†’ä¸€æ¬¡ï¼Œå› æ­¤æˆ‘ä»¬ç¨‹åºè¦ä¿è¯ä¸€æ¬¡æ€§å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®è¯»å–å®Œï¼›</li><li>æ°´å¹³è§¦å‘ï¼šä½¿ç”¨æ°´å¹³è§¦å‘æ¨¡å¼æ—¶ï¼Œå½“è¢«ç›‘æ§çš„ Socket ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¸æ–­åœ°ä» epoll_wait ä¸­è‹é†’ï¼Œç›´åˆ°å†…æ ¸ç¼“å†²åŒºæ•°æ®è¢« read å‡½æ•°è¯»å®Œæ‰ç»“æŸï¼Œç›®çš„æ˜¯å‘Šè¯‰æˆ‘ä»¬æœ‰æ•°æ®éœ€è¦è¯»å–ï¼›</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œä½ çš„å¿«é€’è¢«æ”¾åˆ°äº†ä¸€ä¸ªå¿«é€’ç®±é‡Œï¼Œå¦‚æœå¿«é€’ç®±åªä¼šé€šè¿‡çŸ­ä¿¡é€šçŸ¥ä½ ä¸€æ¬¡ï¼Œå³ä½¿ä½ ä¸€ç›´æ²¡æœ‰å»å–ï¼Œå®ƒä¹Ÿä¸ä¼šå†å‘é€ç¬¬äºŒæ¡çŸ­ä¿¡æé†’ä½ ï¼Œè¿™ä¸ªæ–¹å¼å°±æ˜¯è¾¹ç¼˜è§¦å‘ï¼›å¦‚æœå¿«é€’ç®±å‘ç°ä½ çš„å¿«é€’æ²¡æœ‰è¢«å–å‡ºï¼Œå®ƒå°±ä¼šä¸åœåœ°å‘çŸ­ä¿¡é€šçŸ¥ä½ ï¼Œç›´åˆ°ä½ å–å‡ºäº†å¿«é€’ï¼Œå®ƒæ‰æ¶ˆåœï¼Œè¿™ä¸ªå°±æ˜¯æ°´å¹³è§¦å‘çš„æ–¹å¼ã€‚</p><h3 id="Redisï¼ŒNginxï¼ŒNetty-æ˜¯ä¾èµ–ä»€ä¹ˆåšçš„è¿™ä¹ˆé«˜æ€§èƒ½ï¼Ÿ"><a href="#Redisï¼ŒNginxï¼ŒNetty-æ˜¯ä¾èµ–ä»€ä¹ˆåšçš„è¿™ä¹ˆé«˜æ€§èƒ½ï¼Ÿ" class="headerlink" title="Redisï¼ŒNginxï¼ŒNetty æ˜¯ä¾èµ–ä»€ä¹ˆåšçš„è¿™ä¹ˆé«˜æ€§èƒ½ï¼Ÿ"></a>Redisï¼ŒNginxï¼ŒNetty æ˜¯ä¾èµ–ä»€ä¹ˆåšçš„è¿™ä¹ˆé«˜æ€§èƒ½ï¼Ÿ</h3><h3 id="é›¶æ‹·è´"><a href="#é›¶æ‹·è´" class="headerlink" title="é›¶æ‹·è´"></a>é›¶æ‹·è´</h3><p>ä¼ ç»Ÿ IO çš„å·¥ä½œæ–¹å¼ï¼Œä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼Œç„¶åå†é€šè¿‡ç½‘å¡å‘å¤–å‘é€ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ 4 ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 4 æ¬¡æ•°æ®æ‹·è´ï¼Œå…¶ä¸­ 2 æ¬¡æ•°æ®æ‹·è´å‘ç”Ÿåœ¨å†…å­˜é‡Œçš„ç¼“å†²åŒºå’Œå¯¹åº”çš„ç¡¬ä»¶è®¾å¤‡ä¹‹é—´ï¼Œè¿™ä¸ªæ˜¯ç”± DMA å®Œæˆï¼Œå¦å¤– 2 æ¬¡åˆ™å‘ç”Ÿåœ¨å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´ï¼Œè¿™ä¸ªæ•°æ®æ¬ç§»å·¥ä½œæ˜¯ç”± CPU å®Œæˆçš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111552497.png" alt="image-20250311155254426"></p><p>ä¸ºäº†æé«˜æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½ï¼Œäºæ˜¯å°±å‡ºç°äº†é›¶æ‹·è´æŠ€æœ¯ï¼Œå®ƒé€šè¿‡ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼ˆsendfile æ–¹æ³•ï¼‰åˆå¹¶äº†ç£ç›˜è¯»å–ä¸ç½‘ç»œå‘é€ä¸¤ä¸ªæ“ä½œï¼Œé™ä½äº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ã€‚å¦å¤–ï¼Œæ‹·è´æ•°æ®éƒ½æ˜¯å‘ç”Ÿåœ¨å†…æ ¸ä¸­çš„ï¼Œå¤©ç„¶å°±é™ä½äº†æ•°æ®æ‹·è´çš„æ¬¡æ•°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111553092.png" alt="image-20250311155357028"></p><p>é›¶æ‹·è´æŠ€æœ¯çš„æ–‡ä»¶ä¼ è¾“æ–¹å¼ç›¸æ¯”ä¼ ç»Ÿæ–‡ä»¶ä¼ è¾“çš„æ–¹å¼ï¼Œå‡å°‘äº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´æ¬¡æ•°ï¼Œåªéœ€è¦ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´æ¬¡æ•°ï¼Œå°±å¯ä»¥å®Œæˆæ–‡ä»¶çš„ä¼ è¾“ï¼Œè€Œä¸” 2 æ¬¡çš„æ•°æ®æ‹·è´è¿‡ç¨‹ï¼Œéƒ½ä¸éœ€è¦é€šè¿‡ CPUï¼Œ2 æ¬¡éƒ½æ˜¯ç”± DMA æ¥æ¬è¿ã€‚ </p><p>æ€»ä½“æ¥çœ‹ï¼Œé›¶æ‹·è´æŠ€æœ¯å¯ä»¥æŠŠæ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½æé«˜è‡³å°‘ä¸€å€ä»¥ä¸Šã€‚</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/weixin_43412762/article/details/136436746?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522ebcc7c6f13bb7a0a8cfee25f609a1bda%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=ebcc7c6f13bb7a0a8cfee25f609a1bda&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-136436746-null-null.142%5Ev102%5Epc_search_result_base6&utm_term=IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8&spm=1018.2226.3001.4187">Linuxç½‘ç»œç¼–ç¨‹â€”â€” IOå¤šè·¯å¤ç”¨</a></li></ol><h2 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h2><h2 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h2><h3 id="å‰è¨€-2"><a href="#å‰è¨€-2" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨Linuxä¸­ï¼Œâ€**ä¸€åˆ‡çš†æ–‡ä»¶â€ï¼ˆEverything is a fileï¼‰**æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œç”¨äºæè¿°Linuxæ“ä½œç³»ç»Ÿä¸­æ‰€æœ‰èµ„æºå’Œè®¾å¤‡éƒ½ä»¥æ–‡ä»¶çš„å½¢å¼è¿›è¡Œè®¿é—®å’Œå¤„ç†ã€‚</p><p>  è¿™ä¸ªæ¦‚å¿µå¯ä»¥ç†è§£ä¸ºï¼Œæ— è®ºæ˜¯ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ã€ç½‘å¡ã€è®¾å¤‡ã€è¿›ç¨‹ç­‰ï¼Œéƒ½è¢«æŠ½è±¡ä¸ºæ–‡ä»¶çš„å½¢å¼å­˜åœ¨ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œé€šè¿‡æ–‡ä»¶ç³»ç»Ÿï¼ˆFile Systemï¼‰æ¥ç®¡ç†å’Œè®¿é—®è¿™äº›èµ„æºã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œâ€<strong>ä¸€åˆ‡çš†æ–‡ä»¶</strong>â€œå¯ä»¥è¢«è§£é‡Šä¸ºï¼š</p><p>æ–‡ä»¶ï¼šåœ¨Linuxä¸­ï¼Œæ™®é€šçš„æ–‡ä»¶å°±æ˜¯æˆ‘ä»¬å¸¸è§çš„æ–‡æœ¬æ–‡ä»¶ã€äºŒè¿›åˆ¶æ–‡ä»¶ç­‰ã€‚å®ƒä»¬è¢«ç»„ç»‡æˆä¸€ä¸ªå±‚æ¬¡ç»“æ„çš„ç›®å½•æ ‘ï¼Œé€šè¿‡è·¯å¾„æ¥å®šä½å’Œè®¿é—®ã€‚</p><p>ç›®å½•ï¼šç›®å½•ä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†å…¶ä»–æ–‡ä»¶å’Œç›®å½•çš„ä¿¡æ¯ã€‚é€šè¿‡ç›®å½•ï¼Œå¯ä»¥ç»„ç»‡å’Œç®¡ç†æ–‡ä»¶çš„å±‚æ¬¡ç»“æ„ã€‚</p><p>è®¾å¤‡æ–‡ä»¶ï¼šLinuxå°†ç¡¬ä»¶è®¾å¤‡ï¼ˆå¦‚ç£ç›˜ã€ç½‘ç»œæ¥å£ç­‰ï¼‰å’Œè™šæ‹Ÿè®¾å¤‡ï¼ˆä¾‹å¦‚æ‰“å°æœºï¼Œè¾“å…¥è®¾å¤‡ï¼‰éƒ½çœ‹ä½œæ˜¯æ–‡ä»¶æ¥å¤„ç†ã€‚é€šè¿‡è®¾å¤‡æ–‡ä»¶ï¼Œå¯ä»¥è¯»å–å’Œå†™å…¥è®¾å¤‡çš„æ•°æ®ã€‚</p><p>è¿›ç¨‹ï¼šåœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹éƒ½æœ‰ä¸ä¹‹å…³è”çš„æ–‡ä»¶ã€‚é€šè¿‡è¯»å–å’Œå†™å…¥ç›¸åº”çš„æ–‡ä»¶ï¼Œå¯ä»¥ä¸è¿›ç¨‹è¿›è¡Œé€šä¿¡å’Œäº¤äº’ã€‚<br> é€šè¿‡å°†æ‰€æœ‰èµ„æºéƒ½æŠ½è±¡ä¸ºæ–‡ä»¶ï¼ŒLinuxæä¾›äº†ä¸€å¥—ç»Ÿä¸€çš„æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„å‘½ä»¤å’Œå·¥å…·æ¥è®¿é—®å’Œç®¡ç†ä¸åŒçš„èµ„æºã€‚è¿™ç§ç»Ÿä¸€æ€§ä½¿å¾—Linuxæ“ä½œç³»ç»Ÿæ›´åŠ çµæ´»å’Œå¼ºå¤§ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿äº†å¼€å‘è€…å’Œç³»ç»Ÿç®¡ç†å‘˜è¿›è¡Œå„ç§æ“ä½œå’Œé…ç½®ã€‚</p><h3 id="æ–‡ä»¶æè¿°ç¬¦"><a href="#æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦"></a>æ–‡ä»¶æè¿°ç¬¦</h3><p> æˆ‘ä»¬çŸ¥é“åœ¨Linuxç³»ç»Ÿä¸­ä¸€åˆ‡çš†å¯ä»¥çœ‹æˆæ˜¯æ–‡ä»¶ï¼Œæ–‡ä»¶åˆå¯åˆ†ä¸ºï¼šæ™®é€šæ–‡ä»¶ã€ç›®å½•æ–‡ä»¶ã€é“¾æ¥æ–‡ä»¶å’Œè®¾å¤‡æ–‡ä»¶ã€‚åœ¨æ“ä½œè¿™äº›æ‰€è°“çš„æ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ¯æ“ä½œä¸€æ¬¡å°±æ‰¾ä¸€æ¬¡åå­—ï¼Œè¿™ä¼šè€—è´¹å¤§é‡çš„æ—¶é—´å’Œæ•ˆç‡ã€‚æ‰€ä»¥Linuxä¸­è§„å®šæ¯ä¸€ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªç´¢å¼•ï¼Œè¿™æ ·è¦æ“ä½œæ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥æ‰¾åˆ°ç´¢å¼•å°±å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503111422384.png" alt="image-20250311142208300"></p><h3 id="å‚è€ƒèµ„æ–™-1"><a href="#å‚è€ƒèµ„æ–™-1" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/weixin_67596609/article/details/132224088?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522bfe0372d288f78048a0094d5cb5494c4%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=bfe0372d288f78048a0094d5cb5494c4&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-132224088-null-null.142%5Ev102%5Epc_search_result_base6&utm_term=%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6&spm=1018.2226.3001.4187">ã€Linuxä»å…¥é—¨åˆ°ç²¾é€šã€‘æ–‡ä»¶æè¿°ç¬¦è¯¦è§£</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-04 Javaè®¾è®¡æ¨¡å¼</title>
      <link href="/2025/02/26/75-04%20Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/02/26/75-04%20Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="75-04-Javaè®¾è®¡æ¨¡å¼"><a href="#75-04-Javaè®¾è®¡æ¨¡å¼" class="headerlink" title="75-04 Javaè®¾è®¡æ¨¡å¼"></a>75-04 Javaè®¾è®¡æ¨¡å¼</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/zhangerqing/article/details/8194653">Javaä¹‹ç¾[ä»èœé¸Ÿåˆ°é«˜æ‰‹æ¼”å˜]ä¹‹è®¾è®¡æ¨¡å¼</a></li><li></li></ol><h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><p>æ€»ä½“æ¥è¯´è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><p>åˆ›å»ºå‹æ¨¡å¼ï¼Œå…±äº”ç§ï¼š<strong>å·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚</strong></p><p>ç»“æ„å‹æ¨¡å¼ï¼Œå…±ä¸ƒç§ï¼š<strong>é€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼</strong>ã€‚</p><p>è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…±åä¸€ç§ï¼š<strong>ç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼</strong>ã€‚</p><p>å…¶å®è¿˜æœ‰ä¸¤ç±»ï¼šå¹¶å‘å‹æ¨¡å¼å’Œçº¿ç¨‹æ± æ¨¡å¼ã€‚ç”¨ä¸€ä¸ªå›¾ç‰‡æ¥æ•´ä½“æè¿°ä¸€ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262032667.jpeg" alt="img"></p><h2 id="åˆ›é€ å‹æ¨¡å¼"><a href="#åˆ›é€ å‹æ¨¡å¼" class="headerlink" title="åˆ›é€ å‹æ¨¡å¼"></a>åˆ›é€ å‹æ¨¡å¼</h2><h3 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h3><h4 id="æ™®é€šå·¥å‚æ¨¡å¼"><a href="#æ™®é€šå·¥å‚æ¨¡å¼" class="headerlink" title="æ™®é€šå·¥å‚æ¨¡å¼"></a>æ™®é€šå·¥å‚æ¨¡å¼</h4><p>å»ºç«‹ä¸€ä¸ªå·¥å‚ç±»ï¼Œè¯¥ç±»ä¼šå¯¹å®ç°äº†æŸä¸€æ¥å£çš„ç±»è¿›è¡Œå®ä¾‹åŒ–ã€‚ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªå·¥å…·ç±»æ—¶ï¼Œä¼ å…¥éœ€è¦åˆ›å»ºç±»çš„ç±»å‹ï¼Œç„¶åå·¥å‚ç±»åˆ›å»ºè¿›è¡Œè¿”å›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262032935.png" alt="img"></p><p>ä»¥è¿™ä¸ªä¸ºä¾‹ï¼Œæ¥å£Senderçš„ä¸¤ä¸ªå®ç°ç±»Mail and Smså®ç°äº†æ¥å£å®šä¹‰çš„æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ¥å£çš„å·¥å‚ç±»ä¸­ä¼šè¿™æ ·å†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendFactory</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produce</span><span class="params">(String type)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;mail&quot;</span>.equals(type)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MailSender</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;sms&quot;</span>.equals(type)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsSender</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;è¯·è¾“å…¥æ­£ç¡®çš„ç±»å‹!&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¥å‚ç±»ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryTest</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">SendFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendFactory</span>();</span><br><span class="line"><span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> factory.produce(<span class="string">&quot;sms&quot;</span>);</span><br><span class="line">sender.Send();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æˆ‘ä»¬è®¤çœŸæ€è€ƒä¸€ä¸‹è¿™ä¸ªå·¥å‚ï¼Œå¦‚æœä¼ å…¥çš„æ•°æ®å‚æ•°å‡ºç°é—®é¢˜ï¼Œåˆ™è¿™ä¸ªå·¥å‚å°±ä¸èƒ½æˆåŠŸåˆ›å»ºå‡ºæ­£å¸¸çš„å®ç°ç±»ã€‚</strong></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<strong>å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼</strong>å‡ºç°äº†ã€‚</p><h3 id="å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼"></a>å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>ä¸ºäº†è§£å†³æ™®é€šå·¥å‚å‡ºç°çš„é—®é¢˜ï¼Œå¤šä¸ªå·¥å‚å®ç°ç±»çš„è§£å†³æ–¹æ³•ä¸ºï¼š<strong>ä¸ºåŸæ¥çš„æ™®é€šå·¥å‚å®ç°ç±»æ·»åŠ æ¥å£å®ç°ç±»çš„å®ä¾‹åŒ–æ–¹æ³•</strong>ï¼Œä½¿ç”¨è€…åªéœ€è¦è°ƒç”¨è¯¥å·¥å‚æä¾›çš„æŸä¸ªç±»çš„å®ä¾‹åŒ–æ–¹æ³•è¿›è¡Œåˆ›å»ºå³å¯ï¼Œè¿™æ ·å°±ä¸å¯èƒ½å‡ºç°ä¼ å…¥å‚æ•°å‡ºé”™ç­‰é—®é¢˜ã€‚</p><p>SendFactoryç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendFactory</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produceMail</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MailSender</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produceSms</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsSender</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¥å‚ä½¿ç”¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryTest</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">SendFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendFactory</span>();</span><br><span class="line"><span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> factory.produceMail();</span><br><span class="line">sender.Send();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼"></a>é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>å›é¡¾ä¸€ä¸‹ä¸Šæ–‡çš„å¤šä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå¦‚æœä½¿ç”¨è€…éœ€è¦ä½¿ç”¨è¿™ä¸ªå·¥å‚æ—¶ï¼Œå°±éœ€è¦åˆ›å»ºä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨çš„åœ°æ–¹è¿‡å¤šï¼Œå°±ä¼šå­˜åœ¨å¤§é‡é‡å¤çš„å·¥å‚å¯¹è±¡ï¼Œæ¶ˆè€—äº†å†…å­˜ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªå·¥å‚æ–¹æ³•å®šä¹‰æˆé™æ€å·¥å‚æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262032540.jpg" alt="img_v3_02c8_ad246c57-4ec6-4d0a-9d25-05cabe9293cg"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendFactory</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Sender <span class="title function_">produceMail</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MailSender</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Sender <span class="title function_">produceSms</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsSender</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryTest</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> SendFactory.produceMail();</span><br><span class="line">sender.Send();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ä½“æ¥è¯´ï¼Œå·¥å‚æ¨¡å¼é€‚åˆï¼šå‡¡æ˜¯å‡ºç°äº†<strong>å¤§é‡çš„äº§å“éœ€è¦åˆ›å»º</strong>ï¼Œå¹¶ä¸”å…·æœ‰å…±åŒçš„æ¥å£æ—¶ï¼Œå¯ä»¥é€šè¿‡å·¥å‚æ–¹æ³•æ¨¡å¼è¿›è¡Œåˆ›å»ºã€‚åœ¨ä»¥ä¸Šçš„ä¸‰ç§æ¨¡å¼ä¸­ï¼Œç¬¬ä¸€ç§å¦‚æœä¼ å…¥çš„å­—ç¬¦ä¸²æœ‰è¯¯ï¼Œä¸èƒ½æ­£ç¡®åˆ›å»ºå¯¹è±¡ï¼Œç¬¬ä¸‰ç§ç›¸å¯¹äºç¬¬äºŒç§ï¼Œä¸éœ€è¦å®ä¾‹åŒ–å·¥å‚ç±»ï¼Œæ‰€ä»¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<strong>æˆ‘ä»¬ä¼šé€‰ç”¨ç¬¬ä¸‰ç§â€”â€”é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚</strong></p><h3 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h3><p>åœ¨ä¸Šæ–‡ä¸­çš„é™æ€å·¥å‚æ¨¡å¼ä¸­ï¼Œå¦‚æœåˆè¦æ–°å¢ä¸€ä¸ªç±»æ¥å®ç°è¿™ä¸ªå‘é€è¡Œä¸ºæ—¶ï¼Œå°±éœ€è¦åœ¨åŸæ¥çš„ä»£ç ä¸Šï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯å·¥å‚ç±»ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•åˆ›å»ºè¿™ä¸ªæ–°çš„è¡Œä¸ºç±»ã€‚ä½†æ˜¯è¿™ä¸ªåœ¨åŸæ¥çš„ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹çš„æ“ä½œæˆ‘ä»¬åº”å½“å°½é‡é¿å…ï¼Œè¿™æ˜¯å› ä¸ºä¿®æ”¹æ—¶å¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œä»è€Œé€ æˆä¸å¿…è¦çš„éº»çƒ¦ã€‚</p><p>æ‰€ä»¥æŠ½è±¡å·¥å‚æ¨¡å¼å°±æ˜¯ä¸ºäº†åœ¨éœ€è¦æ–°å¢æ—¶ä¸éœ€è¦åœ¨åŸæœ‰çš„ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œè€Œæ˜¯ç›´æ¥æ–°å¢ä¸€äº›ä¸œè¥¿æ¥è¾¾åˆ°æ•ˆæœã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262032517.jpg" alt="img_v3_02c8_ad246c57-4ec6-4d0a-9d25-05cabe9293cg"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Send</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailSender</span> <span class="keyword">implements</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Send</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;this is mailsender!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsSender</span> <span class="keyword">implements</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Send</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;this is sms sender!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Provider</span> &#123;</span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produce</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMailFactory</span> <span class="keyword">implements</span> <span class="title class_">Provider</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produce</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MailSender</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendSmsFactory</span> <span class="keyword">implements</span> <span class="title class_">Provider</span>&#123;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Sender <span class="title function_">produce</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsSender</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">Provider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendMailFactory</span>();</span><br><span class="line"><span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> provider.produce();</span><br><span class="line">sender.Send();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ªæ¨¡å¼çš„å¥½å¤„å°±æ˜¯ï¼Œå¦‚æœä½ ç°åœ¨æƒ³å¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼šå‘åŠæ—¶ä¿¡æ¯ï¼Œåˆ™åªéœ€åšä¸€ä¸ªå®ç°ç±»ï¼Œå®ç°Senderæ¥å£ï¼ŒåŒæ—¶åšä¸€ä¸ªå·¥å‚ç±»ï¼Œå®ç°Provideræ¥å£ï¼Œå°±OKäº†ï¼Œ<strong>æ— éœ€å»æ”¹åŠ¨ç°æˆçš„ä»£ç ã€‚è¿™æ ·åšï¼Œæ‹“å±•æ€§è¾ƒå¥½ï¼</strong></p><h3 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h3><p>å•ä¾‹å¯¹è±¡ï¼ˆSingletonï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚åœ¨Javaåº”ç”¨ä¸­ï¼Œå•ä¾‹å¯¹è±¡èƒ½ä¿è¯åœ¨ä¸€ä¸ªJVMä¸­ï¼Œ<strong>è¯¥å¯¹è±¡åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨</strong>ã€‚è¿™æ ·çš„æ¨¡å¼æœ‰å‡ ä¸ªå¥½å¤„ï¼š</p><p>1ã€æŸäº›ç±»åˆ›å»ºæ¯”è¾ƒé¢‘ç¹ï¼Œå¯¹äºä¸€äº›å¤§å‹çš„å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ç¬”å¾ˆå¤§çš„ç³»ç»Ÿå¼€é”€ã€‚</p><p>2ã€çœå»äº†newæ“ä½œç¬¦ï¼Œ<strong>é™ä½äº†ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é¢‘ç‡ï¼Œå‡è½»GCå‹åŠ›</strong>ã€‚</p><p>3ã€æœ‰äº›ç±»å¦‚äº¤æ˜“æ‰€çš„æ ¸å¿ƒäº¤æ˜“å¼•æ“ï¼Œæ§åˆ¶ç€äº¤æ˜“æµç¨‹ï¼Œå¦‚æœè¯¥ç±»å¯ä»¥åˆ›å»ºå¤šä¸ªçš„è¯ï¼Œç³»ç»Ÿå®Œå…¨ä¹±äº†ã€‚ï¼ˆæ¯”å¦‚ä¸€ä¸ªå†›é˜Ÿå‡ºç°äº†å¤šä¸ªå¸ä»¤å‘˜åŒæ—¶æŒ‡æŒ¥ï¼Œè‚¯å®šä¼šä¹±æˆä¸€å›¢ï¼‰ï¼Œæ‰€ä»¥åªæœ‰ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œæ‰èƒ½ä¿è¯æ ¸å¿ƒäº¤æ˜“æœåŠ¡å™¨ç‹¬ç«‹æ§åˆ¶æ•´ä¸ªæµç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* æŒæœ‰ç§æœ‰é™æ€å®ä¾‹ï¼Œé˜²æ­¢è¢«å¼•ç”¨ï¼Œæ­¤å¤„èµ‹å€¼ä¸ºnullï¼Œç›®çš„æ˜¯å®ç°å»¶è¿ŸåŠ è½½ */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢è¢«å®ä¾‹åŒ– */</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* é™æ€å·¥ç¨‹æ–¹æ³•ï¼Œåˆ›å»ºå®ä¾‹ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* å¦‚æœè¯¥å¯¹è±¡è¢«ç”¨äºåºåˆ—åŒ–ï¼Œå¯ä»¥ä¿è¯å¯¹è±¡åœ¨åºåˆ—åŒ–å‰åä¿æŒä¸€è‡´ */</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™ä¸ªå•ä¾‹ç±»è™½ç„¶å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†éœ€æ±‚ï¼Œä½†æ˜¯å¦‚æœèº«å¤„äºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå°±ä¼šå‡ºç°åˆ›å»ºå¤šä¸ªå®ä¾‹çš„æƒ…å†µï¼Œè¿™å°±ä¸¥é‡è¿èƒŒäº†å•ä¾‹æ¨¡å¼çš„åˆè¡·ã€‚</p><blockquote><p><strong>ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰</strong>ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ <code>getInstance()</code> æ–¹æ³•å¹¶ä¸” <code>instance</code> å˜é‡å½“å‰ä¸º <code>null</code> æ—¶ï¼Œä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥ <code>if (instance == null)</code> ä»£ç å—ã€‚</p><p><strong>å¤šä¸ªå®ä¾‹åˆ›å»º</strong>ï¼šç”±äºå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿›å…¥ <code>if</code> å—ï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Singleton</code> å®ä¾‹ã€‚è¿™ä¼šå¯¼è‡´åˆ›å»ºå¤šä¸ª <code>Singleton</code> å®ä¾‹ï¼Œä»è€Œç ´åå•ä¾‹æ¨¡å¼çš„è®¾è®¡æ„å›¾ã€‚</p></blockquote><h4 id="æ–¹æ³•åŠ é”"><a href="#æ–¹æ³•åŠ é”" class="headerlink" title="æ–¹æ³•åŠ é”"></a>æ–¹æ³•åŠ é”</h4><p>é‚£ä¹ˆå°±å¯ä»¥ç»™ç±»çš„æ–¹æ³•æ·»åŠ Synchronizedå…³é”®å­—ï¼Œç»™è¿™ä¸ªæ–¹æ³•åŠ ä¸Šé”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>synchronizedåŠ åœ¨æ–¹æ³•ä¸Šï¼Œåˆ™æ˜¯ç»™è¿™ä¸ªå¯¹è±¡ä¸Šé”ï¼Œè¿™é‡Œæ˜¯é™æ€æ–¹æ³•ï¼Œé‚£å°±æ˜¯ç»™è¿™ä¸ªç±»ä¸Šé”ã€‚å®é™…æƒ…å†µæ˜¯ï¼Œåªæœ‰åœ¨åˆå§‹åˆ›å»ºè¯¥å•ä¾‹ç±»çš„æ—¶å€™éœ€è¦ä¸Šé”ï¼Œå…¶ä»–æ—¶å€™ä¸éœ€è¦ä¸Šé”ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰å¯ä»¥æ”¹è¿›çš„ç©ºé—´ã€‚</p><h4 id="åŒé‡æ£€æŸ¥é”å®š"><a href="#åŒé‡æ£€æŸ¥é”å®š" class="headerlink" title="åŒé‡æ£€æŸ¥é”å®š"></a>åŒé‡æ£€æŸ¥é”å®š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p>a&gt;Aã€Bçº¿ç¨‹åŒæ—¶è¿›å…¥äº†ç¬¬ä¸€ä¸ªifåˆ¤æ–­</p></li><li><p>b&gt;Aé¦–å…ˆè¿›å…¥synchronizedå—ï¼Œç”±äºinstanceä¸ºnullï¼Œæ‰€ä»¥å®ƒæ‰§è¡Œinstance &#x3D; new Singleton();</p></li><li><p>c&gt;ç”±äºJVMå†…éƒ¨çš„ä¼˜åŒ–æœºåˆ¶ï¼ŒJVMå…ˆç”»å‡ºäº†ä¸€äº›åˆ†é…ç»™Singletonå®ä¾‹çš„ç©ºç™½å†…å­˜ï¼Œå¹¶èµ‹å€¼ç»™instanceæˆå‘˜ï¼ˆæ³¨æ„æ­¤æ—¶JVMæ²¡æœ‰å¼€å§‹åˆå§‹åŒ–è¿™ä¸ªå®ä¾‹ï¼‰ï¼Œç„¶åAç¦»å¼€äº†synchronizedå—ã€‚</p></li><li><p>d&gt;Bè¿›å…¥synchronizedå—ï¼Œç”±äºinstanceæ­¤æ—¶ä¸æ˜¯nullï¼Œå› æ­¤å®ƒé©¬ä¸Šç¦»å¼€äº†synchronizedå—å¹¶å°†ç»“æœè¿”å›ç»™è°ƒç”¨è¯¥æ–¹æ³•çš„ç¨‹åºã€‚</p></li><li><p>e&gt;æ­¤æ—¶Bçº¿ç¨‹æ‰“ç®—ä½¿ç”¨Singletonå®ä¾‹ï¼Œå´å‘ç°å®ƒæ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œäºæ˜¯é”™è¯¯å‘ç”Ÿäº†ã€‚</p></li></ol><p>æ‰€ä»¥ç¨‹åºè¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿé”™è¯¯ï¼Œå…¶å®ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹æ˜¯å¾ˆå¤æ‚çš„ï¼Œä»è¿™ç‚¹æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œå°¤å…¶æ˜¯åœ¨å†™å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„ç¨‹åºæ›´æœ‰éš¾åº¦ï¼Œæœ‰æŒ‘æˆ˜æ€§ã€‚æˆ‘ä»¬å¯¹è¯¥ç¨‹åºåšè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p><h4 id="é™æ€å†…éƒ¨ç±»"><a href="#é™æ€å†…éƒ¨ç±»" class="headerlink" title="é™æ€å†…éƒ¨ç±»"></a>é™æ€å†…éƒ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œ<strong>é™æ€ç±»ä¸èƒ½å®ç°æ¥å£ã€‚ï¼ˆä»ç±»çš„è§’åº¦è¯´æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯é‚£æ ·å°±ç ´åäº†é™æ€äº†ã€‚å› ä¸ºæ¥å£ä¸­ä¸å…è®¸æœ‰staticä¿®é¥°çš„æ–¹æ³•ï¼Œæ‰€ä»¥å³ä½¿å®ç°äº†ä¹Ÿæ˜¯éé™æ€çš„ï¼‰</strong></p><p>å…¶æ¬¡ï¼Œå•ä¾‹å¯ä»¥è¢«å»¶è¿Ÿåˆå§‹åŒ–ï¼Œé™æ€ç±»ä¸€èˆ¬åœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ˜¯åˆå§‹åŒ–ã€‚ä¹‹æ‰€ä»¥å»¶è¿ŸåŠ è½½ï¼Œæ˜¯å› ä¸ºæœ‰äº›ç±»æ¯”è¾ƒåºå¤§ï¼Œæ‰€ä»¥å»¶è¿ŸåŠ è½½æœ‰åŠ©äºæå‡æ€§èƒ½ã€‚</p><p>å†æ¬¡ï¼Œå•ä¾‹ç±»å¯ä»¥è¢«ç»§æ‰¿ï¼Œä»–çš„æ–¹æ³•å¯ä»¥è¢«è¦†å†™ã€‚ä½†æ˜¯é™æ€ç±»å†…éƒ¨æ–¹æ³•éƒ½æ˜¯staticï¼Œæ— æ³•è¢«è¦†å†™ã€‚</p><p>æœ€åä¸€ç‚¹ï¼Œå•ä¾‹ç±»æ¯”è¾ƒçµæ´»ï¼Œæ¯•ç«Ÿä»å®ç°ä¸Šåªæ˜¯ä¸€ä¸ªæ™®é€šçš„Javaç±»ï¼Œåªè¦æ»¡è¶³å•ä¾‹çš„åŸºæœ¬éœ€æ±‚ï¼Œä½ å¯ä»¥åœ¨é‡Œé¢éšå¿ƒæ‰€æ¬²çš„å®ç°ä¸€äº›å…¶å®ƒåŠŸèƒ½ï¼Œä½†æ˜¯é™æ€ç±»ä¸è¡Œã€‚ä»ä¸Šé¢è¿™äº›æ¦‚æ‹¬ä¸­ï¼ŒåŸºæœ¬å¯ä»¥çœ‹å‡ºäºŒè€…çš„åŒºåˆ«ï¼Œä½†æ˜¯ï¼Œä»å¦ä¸€æ–¹é¢è®²ï¼Œæˆ‘ä»¬ä¸Šé¢æœ€åå®ç°çš„é‚£ä¸ªå•ä¾‹æ¨¡å¼ï¼Œå†…éƒ¨å°±æ˜¯ç”¨ä¸€ä¸ªé™æ€ç±»æ¥å®ç°çš„ï¼Œæ‰€ä»¥ï¼ŒäºŒè€…æœ‰å¾ˆå¤§çš„å…³è”ï¼Œåªæ˜¯æˆ‘ä»¬è€ƒè™‘é—®é¢˜çš„å±‚é¢ä¸åŒç½¢äº†ã€‚ä¸¤ç§æ€æƒ³çš„ç»“åˆï¼Œæ‰èƒ½é€ å°±å‡ºå®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œå°±åƒHashMapé‡‡ç”¨æ•°ç»„+é“¾è¡¨æ¥å®ç°ä¸€æ ·ï¼Œå…¶å®ç”Ÿæ´»ä¸­å¾ˆå¤šäº‹æƒ…éƒ½æ˜¯è¿™æ ·ï¼Œå•ç”¨ä¸åŒçš„æ–¹æ³•æ¥å¤„ç†é—®é¢˜ï¼Œæ€»æ˜¯æœ‰ä¼˜ç‚¹ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œæœ€å®Œç¾çš„æ–¹æ³•æ˜¯ï¼Œç»“åˆå„ä¸ªæ–¹æ³•çš„ä¼˜ç‚¹ï¼Œæ‰èƒ½æœ€å¥½çš„è§£å†³é—®é¢˜ï¼</p><h4 id="ä¸ºä»€ä¹ˆè¿™ç ´åäº†é™æ€ç‰¹æ€§"><a href="#ä¸ºä»€ä¹ˆè¿™ç ´åäº†é™æ€ç‰¹æ€§" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™ç ´åäº†é™æ€ç‰¹æ€§"></a>ä¸ºä»€ä¹ˆè¿™ç ´åäº†é™æ€ç‰¹æ€§</h4><p>åœ¨Javaä¸­ï¼Œâ€é™æ€ç±»â€ä¸€èˆ¬æ˜¯æŒ‡é™æ€å†…éƒ¨ç±»ï¼ˆStatic Nested Classï¼‰ï¼Œè€Œä¸æ˜¯é¡¶çº§ç±»ï¼Œå› ä¸ºJavaä¸æ”¯æŒé¡¶çº§ç±»ä½¿ç”¨<code>static</code>ä¿®é¥°ã€‚é™æ€å†…éƒ¨ç±»æ˜¯å¯ä»¥å®ç°æ¥å£çš„ï¼Œä½†å®ƒå®ç°æ¥å£ä¸­çš„æ–¹æ³•å°†æ˜¯å®ä¾‹æ–¹æ³•è€Œä¸æ˜¯é™æ€æ–¹æ³•ã€‚</p><p>è¿™ä¸ªè§‚ç‚¹çš„æ ¸å¿ƒæ˜¯ï¼šæ¥å£ä¸­çš„æ–¹æ³•ä¸èƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œæ‰€æœ‰æ¥å£ä¸­çš„æ–¹æ³•éƒ½æ˜¯å®ä¾‹æ–¹æ³•ã€‚å› æ­¤ï¼Œå³ä½¿é™æ€å†…éƒ¨ç±»å®ç°äº†æ¥å£ï¼Œå®ƒå®ç°çš„æ–¹æ³•ä¹Ÿæ˜¯éé™æ€çš„ï¼Œè¿™å°±ç ´åäº†é™æ€ç±»çš„çº¯ç²¹é™æ€ç‰¹æ€§ã€‚</p><p>å¦‚æœå¸Œæœ›æ‰€æœ‰æ–¹æ³•éƒ½èƒ½é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼ˆå³é™æ€æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆå®ç°æ¥å£ä¼šç ´åè¿™ä¸€ç‚¹ï¼Œå› ä¸ºæ¥å£çš„æ–¹æ³•ä¸èƒ½æ˜¯é™æ€çš„ã€‚é™æ€å†…éƒ¨ç±»åœ¨å®ç°æ¥å£æ—¶ï¼Œå¿…é¡»å®ç°æ¥å£çš„å®ä¾‹æ–¹æ³•ï¼Œè¿™æ„å‘³ç€éœ€è¦åˆ›å»ºç±»çš„å®ä¾‹æ¥è°ƒç”¨è¿™äº›æ–¹æ³•</p><h3 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h3><p>å·¥å‚ç±»æ¨¡å¼æä¾›çš„æ˜¯åˆ›å»ºå•ä¸ªç±»çš„æ¨¡å¼ï¼Œè€Œå»ºé€ è€…æ¨¡å¼åˆ™æ˜¯å°†å„ç§äº§å“é›†ä¸­èµ·æ¥è¿›è¡Œç®¡ç†ï¼Œç”¨æ¥åˆ›å»ºå¤åˆå¯¹è±¡ï¼Œæ‰€è°“å¤åˆå¯¹è±¡å°±æ˜¯æŒ‡æŸä¸ªç±»å…·æœ‰ä¸åŒçš„å±æ€§ï¼Œå…¶å®å»ºé€ è€…æ¨¡å¼å°±æ˜¯å‰é¢æŠ½è±¡å·¥å‚æ¨¡å¼å’Œæœ€åçš„Testç»“åˆèµ·æ¥å¾—åˆ°çš„ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ï¼š</p><p>è¿˜å’Œå‰é¢ä¸€æ ·ï¼Œä¸€ä¸ªSenderæ¥å£ï¼Œä¸¤ä¸ªå®ç°ç±»MailSenderå’ŒSmsSenderã€‚æœ€åï¼Œå»ºé€ è€…ç±»å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;Sender&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Sender&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produceMailSender</span><span class="params">(<span class="type">int</span> count)</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;count; i++)&#123;</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="title class_">MailSender</span>());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produceSmsSender</span><span class="params">(<span class="type">int</span> count)</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;count; i++)&#123;</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="title class_">SmsSender</span>());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Builder</span>();</span><br><span class="line">builder.produceMailSender(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™ç‚¹çœ‹å‡ºï¼Œå»ºé€ è€…æ¨¡å¼å°†å¾ˆå¤šåŠŸèƒ½é›†æˆåˆ°ä¸€ä¸ªç±»é‡Œï¼Œè¿™ä¸ªç±»å¯ä»¥åˆ›é€ å‡ºæ¯”è¾ƒå¤æ‚çš„ä¸œè¥¿ã€‚æ‰€ä»¥ä¸å·¥ç¨‹æ¨¡å¼çš„åŒºåˆ«å°±æ˜¯ï¼šå·¥å‚æ¨¡å¼å…³æ³¨çš„æ˜¯åˆ›å»ºå•ä¸ªäº§å“ï¼Œè€Œå»ºé€ è€…æ¨¡å¼åˆ™å…³æ³¨åˆ›å»ºç¬¦åˆå¯¹è±¡ï¼Œå¤šä¸ªéƒ¨åˆ†ã€‚å› æ­¤ï¼Œæ˜¯é€‰æ‹©å·¥å‚æ¨¡å¼è¿˜æ˜¯å»ºé€ è€…æ¨¡å¼ï¼Œä¾å®é™…æƒ…å†µè€Œå®šã€‚</p><h3 id="åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰"><a href="#åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰" class="headerlink" title="åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰"></a>åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰</h3><p>åŸå‹æ¨¡å¼è™½ç„¶æ˜¯åˆ›å»ºå‹çš„æ¨¡å¼ï¼Œä½†æ˜¯ä¸å·¥ç¨‹æ¨¡å¼æ²¡æœ‰å…³ç³»ï¼Œä»åå­—å³å¯çœ‹å‡ºï¼Œè¯¥æ¨¡å¼çš„æ€æƒ³å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œå¯¹å…¶è¿›è¡Œå¤åˆ¶ã€å…‹éš†ï¼Œäº§ç”Ÿä¸€ä¸ªå’ŒåŸå¯¹è±¡ç±»ä¼¼çš„æ–°å¯¹è±¡ã€‚æœ¬å°ç»“ä¼šé€šè¿‡å¯¹è±¡çš„å¤åˆ¶ï¼Œè¿›è¡Œè®²è§£ã€‚åœ¨Javaä¸­ï¼Œå¤åˆ¶å¯¹è±¡æ˜¯é€šè¿‡clone()å®ç°çš„ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªåŸå‹ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Prototype</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line"><span class="type">Prototype</span> <span class="variable">proto</span> <span class="operator">=</span> (Prototype) <span class="built_in">super</span>.clone();</span><br><span class="line"><span class="keyword">return</span> proto;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•ï¼Œä¸€ä¸ªåŸå‹ç±»ï¼Œåªéœ€è¦å®ç°Cloneableæ¥å£ï¼Œè¦†å†™cloneæ–¹æ³•ï¼Œæ­¤å¤„cloneæ–¹æ³•å¯ä»¥æ”¹æˆä»»æ„çš„åç§°ï¼Œå› ä¸ºCloneableæ¥å£æ˜¯ä¸ªç©ºæ¥å£ï¼Œä½ å¯ä»¥ä»»æ„å®šä¹‰å®ç°ç±»çš„æ–¹æ³•åï¼Œå¦‚cloneAæˆ–è€…cloneBï¼Œå› ä¸ºæ­¤å¤„çš„é‡ç‚¹æ˜¯super.clone()è¿™å¥è¯ï¼Œsuper.clone()è°ƒç”¨çš„æ˜¯Objectçš„clone()æ–¹æ³•ï¼Œè€Œåœ¨Objectç±»ä¸­ï¼Œclone()æ˜¯nativeçš„ï¼Œå…·ä½“æ€ä¹ˆå®ç°ï¼Œæˆ‘ä¼šåœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå…³äºè§£è¯»Javaä¸­æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ï¼Œæ­¤å¤„ä¸å†æ·±ç©¶ã€‚åœ¨è¿™å„¿ï¼Œæˆ‘å°†ç»“åˆå¯¹è±¡çš„æµ…å¤åˆ¶å’Œæ·±å¤åˆ¶æ¥è¯´ä¸€ä¸‹ï¼Œé¦–å…ˆéœ€è¦äº†è§£å¯¹è±¡æ·±ã€æµ…å¤åˆ¶çš„æ¦‚å¿µï¼š</p><p>æµ…å¤åˆ¶ï¼šå°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œè€Œå¼•ç”¨ç±»å‹ï¼ŒæŒ‡å‘çš„è¿˜æ˜¯åŸå¯¹è±¡æ‰€æŒ‡å‘çš„ã€‚</p><p>æ·±å¤åˆ¶ï¼šå°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åï¼Œä¸è®ºæ˜¯åŸºæœ¬æ•°æ®ç±»å‹è¿˜æœ‰å¼•ç”¨ç±»å‹ï¼Œéƒ½æ˜¯é‡æ–°åˆ›å»ºçš„ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ·±å¤åˆ¶è¿›è¡Œäº†å®Œå…¨å½»åº•çš„å¤åˆ¶ï¼Œè€Œæµ…å¤åˆ¶ä¸å½»åº•ã€‚</p><h2 id="ç»“æ„å‹æ¨¡å¼"><a href="#ç»“æ„å‹æ¨¡å¼" class="headerlink" title="ç»“æ„å‹æ¨¡å¼"></a>ç»“æ„å‹æ¨¡å¼</h2><p>ç»“æ„å‹æ¨¡å¼ï¼Œå…±ä¸ƒç§ï¼š<strong>é€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼</strong>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-03 è®¡ç®—æœºç½‘ç»œ</title>
      <link href="/2025/02/26/75-03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
      <url>/2025/02/26/75-03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="75-03-è®¡ç®—æœºç½‘ç»œ"><a href="#75-03-è®¡ç®—æœºç½‘ç»œ" class="headerlink" title="75-03 è®¡ç®—æœºç½‘ç»œ"></a>75-03 è®¡ç®—æœºç½‘ç»œ</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/CoderTnT/article/details/123316939?ops_request_misc=&request_id=&biz_id=102&utm_term=%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20%E8%AF%B7%E6%B1%82&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-123316939.142%5Ev100%5Epc_search_result_base1&spm=1018.2226.3001.4187">è®¡ç®—æœºç½‘ç»œ(è¯·æ±‚åŒ…çš„ä¼ é€’è¿‡ç¨‹)</a></li><li><a href="https://blog.csdn.net/qq_46101869/article/details/118108697?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171979828316800186550577%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171979828316800186550577&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-118108697-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C&spm=1018.2226.3001.4187">è®¡ç®—æœºç½‘ç»œçŸ¥è¯†æ±‡æ€»ï¼ˆè¶…è¯¦ç»†æ•´ç†ï¼‰</a></li><li><a href="https://blog.csdn.net/HinsCoder/article/details/131352138?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171979828316800186550577%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171979828316800186550577&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-5-131352138-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C&spm=1018.2226.3001.4187">ã€è®¡ç®—æœºç½‘ç»œè¯¦è§£ã€‘â€”â€”çŸ¥è¯†ç‚¹å¤ä¹ ï¼ˆæœŸæœ«ä¸æŒ‚ç§‘ç‰ˆï¼‰</a></li></ol><h2 id="ä½“ç³»ç»“æ„"><a href="#ä½“ç³»ç»“æ„" class="headerlink" title="ä½“ç³»ç»“æ„"></a>ä½“ç³»ç»“æ„</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028664.png" alt="img"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­ä¼šç”¨æµè§ˆå™¨è®¿é—®å„ç§é¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµè§ˆå™¨çš„çª—å£è¾“å…¥å¯¹åº”çš„URLï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028028.png" alt="image-20240701113950870"></p><p>å¦‚æœæˆ‘ä»¬å›è½¦å°±ä¼šè¿›å…¥åˆ°å¯¹åº”çš„URLçš„é¡µé¢çª—å£ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028273.png" alt="image-20240701114024663"></p><p>é‚£ä¹ˆåœ¨è¿™ä¸ªçš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨ä»¥åŠè®¡ç®—æœºç½‘ç»œåšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿç°åœ¨æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„è¿›è¡Œåˆ†ææ¥ä»‹ç»ã€‚</p><h2 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h2><h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>å½“æˆ‘ä»¬åœ¨è¿™ä¸ªè¾“å…¥æ¡†ä¸­è¾“å…¥äº†ç½‘å€ï¼Œç„¶åå›è½¦ä¹‹åï¼Œæµè§ˆå™¨é¦–å…ˆè¦å¯¹è¿™ä¸ªåœ°å€è¿›è¡Œè§£æï¼Œç„¶åå‘é€ç»™WebæœåŠ¡å™¨è¿›è¡Œè¯·æ±‚ä¿¡æ¯ã€‚è®©æˆ‘ä»¬é¦–å…ˆæ¥åˆ†æä¸€ä¸‹è¿™ä¸ªURLçš„æ„æˆï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028841.png" alt="img"></p><p>æµè§ˆå™¨ä¼šå¼€å§‹è§£æè¿™ä¸ªURLç¡®å®šWebæœåŠ¡å™¨å’Œæ–‡ä»¶åï¼Œå¹¶æŠŠè¯·æ±‚ä¿¡æ¯è¿›è¡Œå°è£…ï¼Œå°è£…å¥½ä¹‹åä¼šè¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼Œå®ƒéœ€è¦çŸ¥é“è¿™ä¸ªWebæœåŠ¡å™¨åœ¨å“ªï¼Ÿä»¥åŠè°èƒ½å¸®ä»–ä¼ é€ã€‚</p><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>æˆ‘ä»¬ä¸Šé¢çŸ¥é“äº†è¿™ä¸ªè¯·æ±‚çš„WebæœåŠ¡å™¨çš„URLï¼Œæˆ‘ä»¬çŸ¥é“äº†ç½‘å€ï¼ˆåŸŸåï¼‰ï¼Œä½†æ˜¯åœ¨äº’è”ç½‘çš„ä¸–ç•Œé‡Œä¸èƒ½æ ¹æ®åŸŸåæ¥æ‰¾åˆ°è¿™ä¸ªæœåŠ¡å™¨ï¼Œå°±å¥½åƒæ— æ³•æ ¹æ®åç§°æ¥æ‰¾åˆ°è¿™ä¸ªäººæ‰€åœ¨çš„åœ°å€ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ˜ å°„ï¼Œè¿™ä¸ªæ˜ å°„éœ€è¦è®°å½•ä¸‹å½“å‰åç§°ï¼ˆåŸŸåï¼‰æ‰€å¯¹åº”çš„åœ°å€ï¼ˆIPåœ°å€ï¼‰ï¼Œæ‹¥æœ‰è¿™ä¸ªæ˜ å°„è¡¨çš„æœåŠ¡å™¨æˆ‘ä»¬ç§°ä¸ºDNSæœåŠ¡å™¨ã€‚</p><p>åœ¨è¿™ä¸ªDNSæœåŠ¡å™¨ä¸­ï¼Œå®ƒä¼šæ ¹æ®åŸŸåæ¥è§£æè·å¾—è¯¥åŸŸåçš„IPåœ°å€ã€‚</p><p>ç°åœ¨æˆ‘ä»¬è¾“å…¥äº†<a href="http://www.baidu.comï¼Œè¿™é‡Œæœ‰ä¸‰å±‚çº§ã€‚æœ€é«˜çº§æ˜¯è°å‘¢ï¼Ÿæ˜¯comï¼Œè¦ç‰¹åˆ«æ³¨æ„åœ¨è¿™é‡Œï¼Œåœ¨å¤–å›½äººçš„ä¹ æƒ¯ä¸­ï¼Œä»å·¦åˆ°å³çš„æ˜¯ä»å°åˆ°å¤§çš„å…³ç³»ã€‚">www.baidu.comï¼Œè¿™é‡Œæœ‰ä¸‰å±‚çº§ã€‚æœ€é«˜çº§æ˜¯è°å‘¢ï¼Ÿæ˜¯comï¼Œè¦ç‰¹åˆ«æ³¨æ„åœ¨è¿™é‡Œï¼Œåœ¨å¤–å›½äººçš„ä¹ æƒ¯ä¸­ï¼Œä»å·¦åˆ°å³çš„æ˜¯ä»å°åˆ°å¤§çš„å…³ç³»ã€‚</a></p><p>æ ¹åŸŸæ˜¯åœ¨æœ€é¡¶å±‚ï¼Œå®ƒçš„ä¸‹ä¸€å±‚å°±æ˜¯ com é¡¶çº§åŸŸï¼Œå†ä¸‹é¢æ˜¯baidu.comã€‚</p><p>æ‰€ä»¥åŸŸåçš„å±‚çº§å…³ç³»ç±»ä¼¼ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼š</p><ul><li>æ ¹ DNS æœåŠ¡å™¨</li><li>é¡¶çº§åŸŸ DNS æœåŠ¡å™¨ï¼ˆcomï¼‰</li><li>æƒå¨ DNS æœåŠ¡å™¨baidu.comã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028493.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">å®¢æˆ·ç«¯é¦–å…ˆä¼šå‘å‡ºä¸€ä¸ª DNS è¯·æ±‚ï¼Œé—® http://www.server.com çš„ IP æ˜¯å•¥ï¼Œå¹¶å‘ç»™æœ¬åœ° DNS æœåŠ¡å™¨ï¼ˆä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯çš„ TCP/IP è®¾ç½®ä¸­å¡«å†™çš„ DNS æœåŠ¡å™¨åœ°å€ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">æœ¬åœ°åŸŸåæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œå¦‚æœç¼“å­˜é‡Œçš„è¡¨æ ¼èƒ½æ‰¾åˆ° http://www.server.comï¼Œåˆ™å®ƒç›´æ¥è¿”å› IP åœ°å€ã€‚å¦‚æœæ²¡æœ‰ï¼Œæœ¬åœ° DNS ä¼šå»é—®å®ƒçš„æ ¹åŸŸåæœåŠ¡å™¨ï¼šâ€œè€å¤§ï¼Œ èƒ½å‘Šè¯‰æˆ‘ http://www.server.com çš„ IP åœ°å€å—ï¼Ÿâ€ æ ¹åŸŸåæœåŠ¡å™¨æ˜¯æœ€é«˜å±‚æ¬¡çš„ï¼Œå®ƒä¸ç›´æ¥ç”¨äºåŸŸåè§£æï¼Œä½†èƒ½æŒ‡æ˜ä¸€æ¡é“è·¯ã€‚</span><br><span class="line"></span><br><span class="line">æ ¹ DNS æ”¶åˆ°æ¥è‡ªæœ¬åœ° DNS çš„è¯·æ±‚åï¼Œå‘ç°åç½®æ˜¯ .comï¼Œè¯´ï¼šâ€œhttp://www.server.com è¿™ä¸ªåŸŸåå½’ .com åŒºåŸŸç®¡ç†â€ï¼Œæˆ‘ç»™ä½  .com é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ç»™ä½ ï¼Œä½ å»é—®é—®å®ƒå§ã€‚â€</span><br><span class="line"></span><br><span class="line">æœ¬åœ° DNS æ”¶åˆ°é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€åï¼Œå‘èµ·è¯·æ±‚é—®â€œè€äºŒï¼Œ ä½ èƒ½å‘Šè¯‰æˆ‘ http://www.server.com çš„ IP åœ°å€å—ï¼Ÿâ€</span><br><span class="line"></span><br><span class="line">é¡¶çº§åŸŸåæœåŠ¡å™¨è¯´ï¼šâ€œæˆ‘ç»™ä½ è´Ÿè´£ http://www.server.com åŒºåŸŸçš„æƒå¨ DNS æœåŠ¡å™¨çš„åœ°å€ï¼Œä½ å»é—®å®ƒåº”è¯¥èƒ½é—®åˆ°â€ã€‚</span><br><span class="line"></span><br><span class="line">æœ¬åœ° DNS äºæ˜¯è½¬å‘é—®æƒå¨ DNS æœåŠ¡å™¨ï¼šâ€œè€ä¸‰ï¼Œhttp://www.server.comå¯¹åº”çš„IPæ˜¯å•¥å‘€ï¼Ÿâ€ http://server.comçš„æƒå¨ DNS æœåŠ¡å™¨ï¼Œå®ƒæ˜¯åŸŸåè§£æç»“æœçš„åŸå‡ºå¤„ã€‚ä¸ºå•¥å«æƒå¨å‘¢ï¼Ÿå°±æ˜¯æˆ‘çš„åŸŸåæˆ‘åšä¸»ã€‚</span><br><span class="line"></span><br><span class="line">æƒå¨ DNS æœåŠ¡å™¨æŸ¥è¯¢åå°†å¯¹åº”çš„ IP åœ°å€ X.X.X.X å‘Šè¯‰æœ¬åœ° DNSã€‚</span><br><span class="line"></span><br><span class="line">æœ¬åœ° DNS å†å°† IP åœ°å€è¿”å›å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å’Œç›®æ ‡å»ºç«‹è¿æ¥ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028326.png" alt="img"></p><p>åœ¨DNSè·å¾—æŒ‡å®šåŸŸåçš„IPåœ°å€æ—¶ï¼Œä¼šæœ‰ä¸¤ç§æ–¹å¼ã€‚</p><ol><li><p><strong>é€’å½’æŸ¥è¯¢</strong>ï¼šå½“æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡çš„åŸŸåæœåŠ¡å™¨ä¸çŸ¥è¢«æŸ¥è¯¢åŸŸåçš„IPåœ°å€æ—¶ï¼Œè¯¥åŸŸåæœåŠ¡å™¨å°±ä»¥DNSå®¢æˆ·çš„èº«ä»½å‘ä¸‹ä¸€æ­¥åº”æŸ¥è¯¢çš„åŸŸåæœåŠ¡å™¨å‘å‡ºæŸ¥è¯¢è¯·æ±‚ï¼Œå³<strong>æ›¿æœ¬åœ°åŸŸåå­—æœåŠ¡å™¨ç»§ç»­æŸ¥è¯¢</strong>ï¼Œ<strong>è¾ƒå°‘ä½¿ç”¨</strong>ã€‚</p></li><li><p><strong>è¿­ä»£æŸ¥è¯¢</strong>ï¼šå½“æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡çš„åŸŸåæœåŠ¡å™¨ä¸çŸ¥é“è¢«æŸ¥è¯¢åŸŸåçš„IPåœ°å€æ—¶ï¼Œ<strong>å°±æŠŠè‡ªå·±çŸ¥é“çš„ä¸‹ä¸€æ­¥åº”æŸ¥è¯¢çš„åŸŸåæœåŠ¡å™¨IPåœ°å€å‘Šè¯‰æœ¬åœ°åŸŸåå­—æœåŠ¡å™¨ï¼Œç”±æœ¬åœ°åŸŸåå­—æœåŠ¡å™¨ç»§ç»­å‘è¯¥åŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼Œç›´åˆ°å¾—åˆ°æ‰€è¦è§£æçš„åŸŸåçš„IPåœ°å€</strong>ï¼Œæˆ–è€…æŸ¥è¯¢ä¸åˆ°æ‰€è¦è§£æçš„åŸŸåçš„IPåœ°å€ï¼Œ<strong>é€šå¸¸ä½¿ç”¨</strong>ã€‚</p></li></ol><p>é€šè¿‡ä¸Šé¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç»ˆäºè·å¾—äº†è¿™ä¸ªåŸŸåçš„IPåœ°å€ï¼Œä½†æ˜¯è¿™ä¸ªIPåœ°å€è¯¥å‘Šè¯‰è°å‘¢ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨åˆ°å‘¢ï¼Ÿå¦‚æœç”¨åˆ°äº†è¯¥æŠŠè¿™ä¸ªIPåœ°å€æ”¾åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿ</p><h3 id="åº”ç”¨å±‚å¸¸è§åè®®"><a href="#åº”ç”¨å±‚å¸¸è§åè®®" class="headerlink" title="åº”ç”¨å±‚å¸¸è§åè®®"></a>åº”ç”¨å±‚å¸¸è§åè®®</h3><ol><li><p><strong>DNSï¼ˆåŸŸåç³»ç»Ÿï¼‰</strong>ï¼šDNS æ˜¯äº’è”ç½‘ä½¿ç”¨çš„å‘½åç³»ç»Ÿï¼Œç”¨æ¥æŠŠäººä»¬ä½¿ç”¨çš„æœºå™¨åå­—ï¼ˆåŸŸåï¼‰è½¬æ¢ä¸º IP åœ°å€ã€‚åŸŸåæœåŠ¡å™¨åˆ†ä¸ºå››ç§ç±»å‹ï¼šæ ¹åŸŸåæœåŠ¡å™¨ã€é¡¶çº§åŸŸåæœåŠ¡å™¨ã€æœ¬åœ°åŸŸåæœåŠ¡å™¨ã€æƒé™åŸŸåæœåŠ¡å™¨ã€‚</p></li><li><p><strong>FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰</strong>ï¼šFTP æ˜¯ä½¿ç”¨å¾—æœ€å¹¿æ³›çš„æ–‡ä»¶ä¼ é€åè®®ã€‚FTP æä¾›äº¤äº’å¼çš„è®¿é—®ï¼Œå¸¸ç”¨äºå±€åŸŸç½‘çš„æ–‡ä»¶å­˜å‚¨æœåŠ¡å™¨ã€‚</p></li><li><p><strong>Telnetï¼ˆè¿œç¨‹ç»ˆç«¯åè®®ï¼‰</strong>ï¼štelnet æ˜¯ä¸€ä¸ªç®€å•çš„è¿œç¨‹ç»ˆç«¯åè®®ï¼Œç»“åˆç«¯å£ä½¿ç”¨ï¼Œå¸¸ç”¨äºæœåŠ¡æ¢æµ‹ã€‚</p></li><li><p><strong>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ é€åè®®ï¼‰</strong>ï¼šHTTP æ˜¯é¢å‘äº‹åŠ¡çš„åº”ç”¨å±‚åè®®ï¼Œå®ƒæ˜¯äº’è”ç½‘èƒ½å¤Ÿå¯é åœ°äº¤æ¢æ–‡ä»¶çš„é‡è¦åŸºç¡€ã€‚http ä½¿ç”¨é¢å‘è¿æ¥çš„ TCP ä½œä¸ºè¿è¾“å±‚åè®®ï¼Œä¿è¯äº†æ•°æ®çš„å¯é æ€§ã€‚</p></li><li><p><strong>SMTPï¼ˆç”µå­é‚®ä»¶åè®®ï¼‰</strong>ï¼šSMTP æ˜¯ç®€å•é‚®ä»¶ä¼ é€åè®®ã€‚SMTPè§„å®šäº†åœ¨ä¸¤ä¸ªç›¸äº’é€šä¿¡çš„ SMTP è¿›ç¨‹ä¹‹é—´åº”å¦‚ä½•äº¤æ¢ä¿¡æ¯ã€‚SMTPé€šä¿¡åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ï¼šå»ºç«‹è¿æ¥ã€é‚®ä»¶ä¼ é€ã€è¿æ¥é‡Šæ”¾ã€‚</p></li><li><p><strong>POP3ï¼ˆé‚®ä»¶è¯»å–åè®®ï¼‰</strong>ï¼šPOP3ï¼Œå…¨ç§°æ˜¯ Post Office Protocol 3ï¼Œè¯¥åè®®é€šå¸¸è¢«ç”¨æ¥æ¥æ”¶ç”µå­é‚®ä»¶ã€‚</p></li><li><p><strong>SNMPï¼ˆç®€å•ç½‘ç»œç®¡ç†åè®®ï¼‰</strong>ï¼šSNMP åè®®ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼ŒåŒ…æ‹¬ï¼šSNMPæœ¬èº«ã€ç®¡ç†ä¿¡æ¯ç»“æ„ SMI å’Œç®¡ç†ä¿¡æ¯ MIBã€‚SNMP å®šä¹‰äº†ç®¡ç†ç«™å’Œä»£ç†ä¹‹é—´æ‰€äº¤æ¢çš„åˆ†ç»„æ ¼å¼ã€‚SMI å®šä¹‰äº†å‘½åå¯¹è±¡ç±»å‹çš„é€šç”¨è§„åˆ™ï¼Œä»¥åŠæŠŠå¯¹è±¡å’Œå¯¹è±¡çš„å€¼è¿›è¡Œç¼–ç ã€‚MIB åœ¨è¢«ç®¡ç†çš„å®ä½“ä¸­åˆ›å»ºäº†å‘½åå¯¹è±¡ï¼Œå¹¶è§„å®šç±»å‹ã€‚</p></li><li><p><strong>TFTPï¼ˆç®€å•æ–‡ä»¶ä¼ é€åè®®ï¼‰</strong>ï¼šTFTPæ˜¯TCP&#x2F;IPåè®®æ—ä¸­çš„ä¸€ä¸ªç”¨æ¥åœ¨å®¢æˆ·æœºä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œç®€å•æ–‡ä»¶ä¼ è¾“çš„åè®®ï¼Œå®ƒåŸºäºUDPåè®®è€Œå®ç°çš„ï¼Œæä¾›ä¸å¤æ‚ã€å¼€é”€ä¸å¤§çš„æ–‡ä»¶ä¼ è¾“æœåŠ¡ã€‚é»˜è®¤ç«¯å£å·æ˜¯ 69ã€‚</p></li><li><p>å…¶ä»–åº”ç”¨å±‚åè®®ï¼šé™¤äº†ä¸Šé¢ä»‹ç»çš„åè®®å¤–ï¼Œå…¶ä»–åº”ç”¨å±‚åè®®è¿˜æœ‰ DHCPã€Gopher ã€IMAP4ã€IRCã€ NNTPã€ XMPPã€ SIPã€ <strong>SSH</strong>ã€ <strong>RPC</strong>ã€ RTCPã€ RTPã€RTSPã€SDPã€ SOAPã€ GTPã€ STUNã€ NTPã€SSDPã€ BGP ç­‰ã€‚</p></li></ol><h3 id="HTTPçŠ¶æ€ç "><a href="#HTTPçŠ¶æ€ç " class="headerlink" title="HTTPçŠ¶æ€ç "></a>HTTPçŠ¶æ€ç </h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262028142.png" alt="image-20240919183636882"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029684.png" alt="image-20240919184159623"></p><h2 id="åè®®æ ˆ"><a href="#åè®®æ ˆ" class="headerlink" title="åè®®æ ˆ"></a>åè®®æ ˆ</h2><p>ä¸Šé¢HTTPè·å¾—äº†IPåœ°å€ä¹‹åï¼Œæµè§ˆå™¨çš„ä¼ è¾“å·¥ä½œå°±ä¼šäº¤ç»™æœ¬æœºæ“ä½œç³»ç»Ÿçš„åè®®æ ˆä¸­ï¼Œç”±æ“ä½œç³»ç»Ÿçš„åè®®æ ˆæ¥è´Ÿè´£ä¸‹é¢çš„æ•°æ®ä¼ è¾“å·¥ä½œï¼Œå…¶ä¸»è¦è´Ÿè´£çš„å±‚æœ‰ä¼ è¾“å±‚&amp;ç½‘ç»œå±‚ï¼Œä¸‹é¢æ¥å…·ä½“çš„ä»‹ç»ä¸€ä¸‹åè®®æ ˆä¸­çš„ä½œç”¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029699.png" alt="img"></p><h3 id="è¿è¾“å±‚"><a href="#è¿è¾“å±‚" class="headerlink" title="è¿è¾“å±‚"></a>è¿è¾“å±‚</h3><p>åº”ç”¨å±‚æŠŠéœ€è¦ä¼ è¾“çš„æ•°æ®å°è£…å¥½åäº¤ç»™è¿è¾“å±‚è¿›è¡Œå¤„ç†ï¼Œåº”ç”¨å±‚æœ‰å¾ˆå¤šç§åè®®ï¼Œæ¯ç§åè®®å¯¹åº”ä½¿ç”¨è¿è¾“å±‚ä¸åŒçš„åè®®ï¼Œè¿è¾“å±‚çš„ä¸»è¦åè®®æœ‰TCPå’ŒUDPã€‚ä¸‹é¢åˆ—å‡ºä¸€äº›åº”ç”¨å±‚å¸¸ç”¨åè®®å¯¹åº”çš„ä¼ è¾“å±‚çš„åè®®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029414.png" alt="image-20240701182611384"></p><p>è€Œè¿™é‡ŒHTTPåè®®ä½¿ç”¨çš„æ˜¯TCPåè®®ã€‚è¿è¾“å±‚ç¡®å®šå¥½äº†ä½¿ç”¨çš„åè®®ä¹‹åï¼Œå°±ä¼šç»™è¿™ä¸ªæ·»åŠ è¯·æ±‚å¤´åœ¨æ•°æ®åŒ…çš„å‰é¢ã€‚</p><p>å¸¸ç”¨åè®®å¯¹åº”ç«¯å£å·åˆ—è¡¨ï¼š</p><blockquote><ul><li><p><strong>21ç«¯å£ï¼šFTP æ–‡ä»¶ä¼ è¾“æœåŠ¡</strong></p></li><li><p><strong>22ç«¯å£ï¼šSSHåè®®ã€SCPï¼ˆæ–‡ä»¶ä¼ è¾“ï¼‰ã€ç«¯å£å·é‡å®šå‘</strong></p></li><li><p><strong>23&#x2F;tcpç«¯å£ï¼šTELNET ç»ˆç«¯ä»¿çœŸæœåŠ¡</strong></p></li><li><p><strong>25ç«¯å£ï¼šSMTP ç®€å•é‚®ä»¶ä¼ è¾“æœåŠ¡</strong></p></li><li><p><strong>53ç«¯å£ï¼šDNS åŸŸåè§£ææœåŠ¡</strong></p></li><li><p><strong>69&#x2F;udpï¼šTFTP</strong></p></li><li><p><strong>80&#x2F;8080&#x2F;3128&#x2F;8081&#x2F;9098ç«¯å£ï¼šHTTPåè®®ä»£ç†æœåŠ¡å™¨</strong></p></li><li><p><strong>110&#x2F;tcpç«¯å£ï¼šPOP3ï¼ˆE-mailï¼‰</strong></p></li><li><p>119ç«¯å£ï¼šNetwork </p></li><li><p>123ç«¯å£ï¼šNTPï¼ˆç½‘ç»œæ—¶é—´åè®®ï¼‰</p></li><li><p>135ã€137ã€138ã€139ç«¯å£ï¼š å±€åŸŸç½‘ç›¸å…³é»˜è®¤ç«¯å£ï¼Œåº”å…³é—­</p></li><li><p>161ç«¯å£ï¼šSNMPï¼ˆç®€å•ç½‘ç»œç®¡ç†åè®®ï¼‰</p></li><li><p>389ç«¯å£ï¼šLDAPï¼ˆè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼‰ã€ILSï¼ˆå®šä½æœåŠ¡ï¼‰</p></li><li><p>443&#x2F;tcp 443&#x2F;udpï¼šHTTPSæœåŠ¡å™¨</p></li><li><p><strong>465ç«¯å£ï¼šSMTPï¼ˆç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰</strong></p></li><li><p>873ç«¯å£ï¼šrsync</p></li><li><p>1080ç«¯å£ï¼šSOCKSä»£ç†åè®®æœåŠ¡å™¨å¸¸ç”¨ç«¯å£å·ã€QQ</p></li><li><p>1158ç«¯å£ï¼šORACLE EMCTL</p></li><li><p>1433&#x2F;tcp&#x2F;udpç«¯å£ï¼šMS SQL<em>SERVERæ•°æ®åº“serverã€MS SQL</em>SERVERæ•°æ®åº“monitor</p></li><li><p>1521ç«¯å£ï¼šOracle æ•°æ®åº“</p></li><li><p>2100ç«¯å£ï¼šOracle XDB FTPæœåŠ¡</p></li><li><p>3389ç«¯å£ï¼šWIN2003è¿œç¨‹ç™»å½•</p></li><li><p><strong>3306ç«¯å£ï¼šMYSQLæ•°æ®åº“ç«¯å£</strong></p></li><li><p>5432ç«¯å£ï¼špostgresqlæ•°æ®åº“ç«¯å£</p></li><li><p>5601ç«¯å£ï¼škibana</p></li><li><p><strong>6379ç«¯å£ï¼šRedisæ•°æ®åº“ç«¯å£</strong></p></li><li><p><strong>8080ç«¯å£ï¼šTCPæœåŠ¡ç«¯é»˜è®¤ç«¯å£ã€JBOSSã€TOMCATã€Oracle XDBï¼ˆXML æ•°æ®åº“ï¼‰</strong></p></li><li><p>8081ç«¯å£ï¼šSymantec AV&#x2F;Filter for MSE</p></li><li><p><strong>8848ç«¯å£ï¼šNacosæœåŠ¡å™¨çš„ç«¯å£</strong></p></li><li><p>8888ç«¯å£ï¼šNginxæœåŠ¡å™¨çš„ç«¯å£</p></li><li><p>9000ç«¯å£ï¼šphp-fpm</p></li><li><p>9080ç«¯å£ï¼šWebshpereåº”ç”¨ç¨‹åº</p></li><li><p>9090ç«¯å£ï¼šwebshpereç®¡ç†å·¥å…·</p></li><li><p><strong>9200ç«¯å£ï¼šElasticsearchæœåŠ¡å™¨ç«¯å£</strong></p></li><li><p>10050ç«¯å£ï¼šzabbix_server 10050</p></li><li><p>10051ç«¯å£ï¼šzabbix_agent</p></li><li><p>11211ç«¯å£ï¼šmemcacheï¼ˆé«˜é€Ÿç¼“å­˜ç³»ç»Ÿï¼‰</p></li><li><p>27017ç«¯å£ï¼šmongoDBæ•°æ®åº“é»˜è®¤ç«¯å£</p></li><li><p>22122ç«¯å£ï¼šfastdfsæœåŠ¡å™¨é»˜è®¤ç«¯å£</p></li></ul></blockquote><h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><p>TCPæŠ¥æ–‡å¤´ç»“æ„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029316.png" alt="img"></p><p>é¦–å…ˆï¼Œæºç«¯å£å·å’Œç›®æ ‡ç«¯å£å·æ˜¯ä¸å¯å°‘çš„ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸¤ä¸ªç«¯å£å·ï¼Œæ•°æ®å°±ä¸çŸ¥é“åº”è¯¥å‘ç»™å“ªä¸ªåº”ç”¨ã€‚</p><p><strong>ç«¯å£å·çš„ä½œç”¨æ˜¯ä¸ºäº†æ¥å—åˆ°è¯·æ±‚æ—¶ï¼Œæ˜ç¡®è¿™ä¸ªæŠ¥æ–‡åº”è¯¥äº¤ç»™åº”ç”¨å±‚çš„å“ªä¸€ä¸ªåº”ç”¨è¿›è¡Œå¤„ç†ã€‚</strong></p><p>æ¥ä¸‹æ¥æœ‰åŒ…çš„åºå·ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†è§£å†³åŒ…ä¹±åºçš„é—®é¢˜ã€‚</p><p>è¿˜æœ‰åº”è¯¥æœ‰çš„æ˜¯ç¡®è®¤å·ï¼Œç›®çš„æ˜¯ç¡®è®¤å‘å‡ºå»å¯¹æ–¹æ˜¯å¦æœ‰æ”¶åˆ°ã€‚å¦‚æœæ²¡æœ‰æ”¶åˆ°å°±åº”è¯¥é‡æ–°å‘é€ï¼Œç›´åˆ°é€è¾¾ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†è§£å†³ä¸ä¸¢åŒ…çš„é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥è¿˜æœ‰ä¸€äº›çŠ¶æ€ä½ã€‚<strong>ä¾‹å¦‚ SYN æ˜¯å‘èµ·ä¸€ä¸ªè¿æ¥ï¼ŒACK æ˜¯å›å¤ï¼ŒRST æ˜¯é‡æ–°è¿æ¥ï¼ŒFINæ˜¯ç»“æŸè¿æ¥ç­‰</strong>ã€‚TCP æ˜¯é¢å‘è¿æ¥çš„ï¼Œå› è€ŒåŒæ–¹è¦ç»´æŠ¤è¿æ¥çš„çŠ¶æ€ï¼Œè¿™äº›å¸¦çŠ¶æ€ä½çš„åŒ…çš„å‘é€ï¼Œä¼šå¼•èµ·åŒæ–¹çš„çŠ¶æ€å˜æ›´ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å°±æ˜¯çª—å£å¤§å°ã€‚TCP è¦åšæµé‡æ§åˆ¶ï¼Œé€šä¿¡åŒæ–¹å„å£°æ˜ä¸€ä¸ªçª—å£ï¼ˆç¼“å­˜å¤§å°ï¼‰ï¼Œæ ‡è¯†è‡ªå·±å½“å‰èƒ½å¤Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œåˆ«å‘é€çš„å¤ªå¿«ï¼Œæ’‘æ­»æˆ‘ï¼Œä¹Ÿåˆ«å‘çš„å¤ªæ…¢ï¼Œé¥¿æ­»æˆ‘ã€‚</p><p>é™¤äº†åšæµé‡æ§åˆ¶ä»¥å¤–ï¼ŒTCPè¿˜ä¼šåšæ‹¥å¡æ§åˆ¶ï¼Œå¯¹äºçœŸæ­£çš„é€šè·¯å µè½¦ä¸å µè½¦ï¼Œå®ƒæ— èƒ½ä¸ºåŠ›ï¼Œå”¯ä¸€èƒ½åšçš„å°±æ˜¯æ§åˆ¶è‡ªå·±ï¼Œä¹Ÿå³æ§åˆ¶å‘é€çš„é€Ÿåº¦ã€‚ä¸èƒ½æ”¹å˜ä¸–ç•Œï¼Œå°±æ”¹å˜è‡ªå·±å˜›ã€‚</p><p>ä¸ºäº†ä¿è¯TCPçš„å¯é æ€§ï¼Œæ‰€ä»¥TCPä¸¤ä¸ªè¿æ¥æ—¶ä¼šè¿›è¡Œä¸‰æ¬¡æ¡æ‰‹æ¥ä¿è¯è¿æ¥çš„å¯é ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029028.png" alt="img"></p><p>ä¸ºä»€ä¹ˆè¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å‘¢ï¼Ÿä¸Šé¢è¯´åˆ°äº†æ˜¯ä¸ºäº†ä¿è¯TCPçš„å¯é æ€§ï¼Œ<strong>å³æ˜¯ä¸ºäº†ä¿è¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½æœ‰æ¥å—å’Œå‘é€æŠ¥æ–‡çš„èƒ½åŠ›ã€‚</strong></p><p>ä¸€å¼€å§‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¤„äº CLOSED çŠ¶æ€ã€‚å…ˆæ˜¯æœåŠ¡ç«¯ä¸»åŠ¨ç›‘å¬æŸä¸ªç«¯å£ï¼Œå¤„äº LISTEN çŠ¶æ€ã€‚</p><p>ç„¶åå®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¿æ¥ SYNï¼Œä¹‹åå¤„äº SYN-SENT çŠ¶æ€ã€‚</p><p>æœåŠ¡ç«¯æ”¶åˆ°å‘èµ·çš„è¿æ¥ï¼Œè¿”å› SYNï¼Œå¹¶ä¸” ACK å®¢æˆ·ç«¯çš„ SYNï¼Œä¹‹åå¤„äº SYN-RCVD çŠ¶æ€ã€‚</p><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯å‘é€çš„ SYN å’Œ ACK ä¹‹åï¼Œå‘é€ ACK çš„ ACKï¼Œä¹‹åå¤„äº ESTABLISHEDçŠ¶æ€ï¼Œå› ä¸ºå®ƒä¸€å‘ä¸€æ”¶æˆåŠŸäº†ã€‚</p><p>æœåŠ¡ç«¯æ”¶åˆ° ACK çš„ ACK ä¹‹åï¼Œå¤„äº ESTABLISHED çŠ¶æ€ï¼Œå› ä¸ºå®ƒä¹Ÿä¸€å‘ä¸€æ”¶äº†ã€‚</p><p>æ‰€ä»¥ä¸‰æ¬¡æ¡æ‰‹ç›®çš„æ˜¯ä¿è¯åŒæ–¹éƒ½æœ‰å‘é€å’Œæ¥æ”¶çš„èƒ½åŠ›ã€‚</p><h4 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h4><p>UDPçš„è®¾è®¡ç†å¿µå°±æ˜¯ä¸ºäº†å°½å¯èƒ½å¿«çš„å‘é€æŠ¥æ–‡ï¼Œæ‰€ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå¿½ç•¥å…¶å¯é æ€§ã€‚</p><p>UDPçš„å¤´éƒ¨åŒ…å«ä¸€ä¸‹å­—æ®µï¼š</p><ul><li><strong>æºç«¯å£å·</strong>ï¼ˆSource Portï¼‰ï¼šå‘é€æ–¹çš„ç«¯å£å·ã€‚</li><li><strong>ç›®çš„ç«¯å£å·</strong>ï¼ˆDestination Portï¼‰ï¼šæ¥æ”¶æ–¹çš„ç«¯å£å·ã€‚</li><li><strong>é•¿åº¦</strong>ï¼ˆLengthï¼‰ï¼šUDPæŠ¥æ–‡çš„é•¿åº¦ï¼ŒåŒ…æ‹¬å¤´éƒ¨å’Œæ•°æ®éƒ¨åˆ†ã€‚</li><li><strong>æ ¡éªŒå’Œ</strong>ï¼ˆChecksumï¼‰ï¼šç”¨äºæ£€æµ‹æŠ¥æ–‡åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºç°é”™è¯¯ã€‚</li></ul><p>å¯ä»¥çœ‹åˆ°å¹¶åˆæ²¡ä¿è¯å¯é çš„å­—æ®µï¼Œå”¯ä¸€çš„æ ¡éªŒå’Œå­—æ®µä¹Ÿåªæ˜¯ä¸ºäº†ç®€å•æ£€æŸ¥æŠ¥æ–‡åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºç°äº†é”™è¯¯ã€‚</p><h4 id="å¸¸è§ç«¯å£"><a href="#å¸¸è§ç«¯å£" class="headerlink" title="å¸¸è§ç«¯å£"></a>å¸¸è§ç«¯å£</h4><ol><li><strong>HTTP (HyperText Transfer Protocol)</strong> - ç«¯å£ 80ï¼Œç”¨äºç½‘é¡µä¼ è¾“ã€‚</li><li><strong>HTTPS (HTTP over TLS&#x2F;SSL)</strong> - ç«¯å£ 443ï¼Œå®‰å…¨çš„HTTPä¼ è¾“ï¼Œä½¿ç”¨SSL&#x2F;TLSåŠ å¯†ã€‚</li><li><strong>FTP (File Transfer Protocol)</strong> - ç«¯å£ 21ï¼Œç”¨äºæ–‡ä»¶ä¼ è¾“ã€‚</li><li><strong>SSH (Secure Shell)</strong> - ç«¯å£ 22ï¼Œç”¨äºå®‰å…¨è¿œç¨‹ç™»å½•å’Œå…¶ä»–å®‰å…¨ç½‘ç»œæœåŠ¡ã€‚</li><li><strong>Telnet</strong> - ç«¯å£ 23ï¼Œç”¨äºè¿œç¨‹ç™»å½•æœåŠ¡ï¼Œä½†å·²è¢«SSHæ‰€å–ä»£ã€‚</li><li><strong>SMTP (Simple Mail Transfer Protocol)</strong> - ç«¯å£ 25ï¼Œç”¨äºå‘é€ç”µå­é‚®ä»¶ã€‚</li><li><strong>IMAP (Internet Message Access Protocol)</strong> - ç«¯å£ 143ï¼Œç”¨äºæ¥æ”¶ç”µå­é‚®ä»¶ã€‚</li><li><strong>POP3 (Post Office Protocol 3)</strong> - ç«¯å£ 110ï¼Œç”¨äºæ¥æ”¶ç”µå­é‚®ä»¶ã€‚</li><li><strong>DNS (Domain Name System)</strong> - ç«¯å£ 53ï¼Œç”¨äºåŸŸåè§£ææœåŠ¡ã€‚</li><li><strong>LDAP (Lightweight Directory Access Protocol)</strong> - ç«¯å£ 389ï¼Œç”¨äºè®¿é—®å’Œç»´æŠ¤åˆ†å¸ƒå¼ç›®å½•ä¿¡æ¯ã€‚</li><li><strong>SMB (Server Message Block)</strong> - ç«¯å£ 445ï¼Œç”¨äºæ–‡ä»¶å…±äº«å’Œæ‰“å°æœåŠ¡ã€‚</li><li><strong>RPC (Remote Procedure Call)</strong> - ç«¯å£ 135ï¼Œç”¨äºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚</li><li><strong>NTP (Network Time Protocol)</strong> - ç«¯å£ 123ï¼Œç”¨äºåŒæ­¥ç½‘ç»œæ—¶é—´ã€‚</li><li><strong>SNMP (Simple Network Management Protocol)</strong> - ç«¯å£ 161ï¼Œç”¨äºç½‘ç»œç®¡ç†ã€‚</li><li><strong>RDP (Remote Desktop Protocol)</strong> - ç«¯å£ 3389ï¼Œç”¨äºè¿œç¨‹æ¡Œé¢æœåŠ¡ã€‚</li><li><strong>SIP (Session Initiation Protocol)</strong> - ç«¯å£ 5060ï¼Œç”¨äºä¼šè¯åˆå§‹åŒ–åè®®ï¼Œå¸¸ç”¨äºVoIPã€‚</li><li><strong>LDAPS (Secure LDAP)</strong> - ç«¯å£ 636ï¼Œå®‰å…¨çš„LDAPä¼ è¾“ï¼Œä½¿ç”¨SSLåŠ å¯†ã€‚</li><li><strong>MySQL</strong> - ç«¯å£ 3306ï¼Œç”¨äºMySQLæ•°æ®åº“æœåŠ¡ã€‚</li><li><strong>PostgreSQL</strong> - ç«¯å£ 5432ï¼Œç”¨äºPostgreSQLæ•°æ®åº“æœåŠ¡ã€‚</li><li><strong>MongoDB</strong> - ç«¯å£ 27017ï¼Œç”¨äºMongoDBæ•°æ®åº“æœåŠ¡ã€‚</li><li><strong>Redis</strong> - ç«¯å£ 6379ï¼Œç”¨äºRedisæ•°æ®åº“æœåŠ¡ã€‚</li><li><strong>DHCP (Dynamic Host Configuration Protocol)</strong> - ç«¯å£ 67å’Œ68ï¼Œç”¨äºè‡ªåŠ¨åˆ†é…IPåœ°å€ã€‚</li><li><strong>TFTP (Trivial File Transfer Protocol)</strong> - ç«¯å£ 69ï¼Œç”¨äºç®€å•çš„æ–‡ä»¶ä¼ è¾“ã€‚</li><li><strong>HTTP&#x2F;2</strong> - ç«¯å£ 80å’Œ443ï¼Œä½œä¸ºHTTPçš„æ”¹è¿›ç‰ˆï¼Œæ”¯æŒæ›´é«˜æ•ˆçš„ä¼ è¾“ã€‚</li><li><strong>WebSocket</strong> - ç«¯å£ 80å’Œ443ï¼Œæä¾›äº†å…¨åŒå·¥é€šä¿¡æ¸ é“ã€‚</li></ol><h3 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h3><h4 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h4><p>IPæŠ¥æ–‡å¤´éƒ¨ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029566.png" alt="img"></p><ol><li><strong>ç‰ˆæœ¬ï¼ˆVersionï¼‰</strong> - 4ä½å­—æ®µï¼ŒæŒ‡å®šIPåè®®çš„ç‰ˆæœ¬ã€‚IPv4æ˜¯4ï¼ŒIPv6æ˜¯6ã€‚</li><li><strong>é¦–éƒ¨é•¿åº¦ï¼ˆHeader Lengthï¼‰</strong> - 4ä½å­—æ®µï¼ŒæŒ‡ç¤ºIPæŠ¥æ–‡å¤´éƒ¨çš„é•¿åº¦ï¼Œä»¥32ä½å­—ï¼ˆ4å­—èŠ‚ï¼‰ä¸ºå•ä½ã€‚è¿™å…è®¸IPå¤´éƒ¨å¯ä»¥æ‰©å±•ä»¥åŒ…å«é€‰é¡¹ã€‚</li><li><strong>æœåŠ¡ç±»å‹ï¼ˆType of Service, ToSï¼‰</strong> - 8ä½å­—æ®µï¼Œåœ¨IPv4ä¸­ç”¨äºæŒ‡å®šæ•°æ®åŒ…çš„æœåŠ¡è´¨é‡è¦æ±‚ï¼Œå¦‚ä¼˜å…ˆçº§ã€å»¶è¿Ÿã€ååé‡ç­‰ã€‚åœ¨IPv6ä¸­ï¼Œè¿™éƒ¨åˆ†è¢«åˆ†ä¸ºä¸¤ä¸ªå­—æ®µï¼šæµé‡ç±»ï¼ˆTraffic Classï¼‰å’Œæµæ ‡ç­¾ï¼ˆFlow Labelï¼‰ã€‚</li><li><strong>æ€»é•¿åº¦ï¼ˆTotal Lengthï¼‰</strong> - 16ä½å­—æ®µï¼Œè¡¨ç¤ºæ•´ä¸ªIPæ•°æ®åŒ…çš„é•¿åº¦ï¼ŒåŒ…æ‹¬å¤´éƒ¨å’Œæ•°æ®éƒ¨åˆ†ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚</li><li><strong>æ ‡è¯†ï¼ˆIdentificationï¼‰</strong> - 16ä½å­—æ®µï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªIPæ•°æ®åŒ…ã€‚å½“æ•°æ®åŒ…å¤ªå¤§è€Œéœ€è¦åˆ†ç‰‡æ—¶ï¼Œè¿™ä¸ªå­—æ®µå¸®åŠ©æ¥æ”¶ç«¯é‡æ–°ç»„è£…æ•°æ®åŒ…ã€‚</li><li><strong>æ ‡å¿—ï¼ˆFlagsï¼‰</strong> - 3ä½å­—æ®µï¼Œç”¨äºæ§åˆ¶å’ŒæŒ‡ç¤ºåˆ†ç‰‡çš„è¡Œä¸ºã€‚å…¶ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯MFï¼ˆMore Fragmentsï¼‰æ ‡å¿—ï¼Œè¡¨ç¤ºæ˜¯å¦è¿˜æœ‰æ›´å¤šçš„åˆ†ç‰‡ã€‚</li><li><strong>ç‰‡åç§»ï¼ˆFragment Offsetï¼‰</strong> - 13ä½å­—æ®µï¼ŒæŒ‡åˆ†ç‰‡ç›¸å¯¹äºåŸå§‹æ•°æ®åŒ…å¼€å§‹å¤„çš„ä½ç½®ï¼Œä»¥8å­—èŠ‚ä¸ºå•ä½ã€‚</li><li><strong>ç”Ÿå­˜æ—¶é—´ï¼ˆTime to Live, TTLï¼‰</strong> - 8ä½å­—æ®µï¼ŒæŒ‡å®šæ•°æ®åŒ…åœ¨ç½‘ç»œä¸­å¯ä»¥ç»è¿‡çš„æœ€å¤§è·¯ç”±å™¨æ•°ã€‚æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼ŒTTLå‡1ï¼Œå½“TTLä¸º0æ—¶ï¼Œæ•°æ®åŒ…å°†è¢«ä¸¢å¼ƒï¼Œä»¥é˜²æ­¢æ— é™å¾ªç¯ã€‚</li><li><strong>åè®®ï¼ˆProtocolï¼‰</strong> - 8ä½å­—æ®µï¼ŒæŒ‡å®šäº†æ•°æ®åŒ…ä¸­å°è£…çš„ä¸Šå±‚åè®®ç±»å‹ï¼Œå¦‚TCPæ˜¯6ï¼ŒUDPæ˜¯17ã€‚</li><li><strong>å¤´éƒ¨æ ¡éªŒå’Œï¼ˆHeader Checksumï¼‰</strong> - 16ä½å­—æ®µï¼Œç”¨äºæ£€æµ‹å¤´éƒ¨ä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºç°é”™è¯¯ã€‚</li><li><strong>æºIPåœ°å€ï¼ˆSource Addressï¼‰</strong> - 32ä½å­—æ®µï¼ˆIPv4ï¼‰ï¼Œè¡¨ç¤ºæ•°æ®åŒ…å‘é€è€…çš„IPåœ°å€ã€‚</li><li><strong>ç›®çš„IPåœ°å€ï¼ˆDestination Addressï¼‰</strong> - 32ä½å­—æ®µï¼ˆIPv4ï¼‰ï¼Œè¡¨ç¤ºæ•°æ®åŒ…æ¥æ”¶è€…çš„IPåœ°å€ã€‚</li><li><strong>é€‰é¡¹ï¼ˆOptionsï¼‰</strong> - å¯é€‰å­—æ®µï¼Œç”¨äºåŒ…å«é¢å¤–çš„IPåŠŸèƒ½ï¼Œå¦‚å®‰å…¨å’Œæ—¶é—´æˆ³ç­‰ã€‚è¿™ä¸ªå­—æ®µçš„é•¿åº¦ç”±é¦–éƒ¨é•¿åº¦å­—æ®µå†³å®šã€‚</li><li><strong>å¡«å……ï¼ˆPaddingï¼‰</strong> - ç¡®ä¿IPå¤´éƒ¨æ˜¯32ä½å­—çš„å€æ•°ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œç”¨ä»¥å¡«å……ã€‚</li></ol><h2 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h2><h3 id="MAC"><a href="#MAC" class="headerlink" title="MAC"></a>MAC</h3><p>MAC å¤´éƒ¨æ˜¯ä»¥å¤ªç½‘ä½¿ç”¨çš„å¤´éƒ¨ï¼Œå®ƒåŒ…å«äº†æ¥æ”¶æ–¹å’Œå‘é€æ–¹çš„ MAC åœ°å€ç­‰ä¿¡æ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029645.png" alt="img"></p><p>åœ¨ MAC åŒ…å¤´é‡Œéœ€è¦<strong>å‘é€æ–¹ MAC åœ°å€</strong>å’Œ<strong>æ¥æ”¶æ–¹ç›®æ ‡ MAC åœ°å€</strong>ï¼Œç”¨äº<strong>ä¸¤ç‚¹ä¹‹é—´çš„ä¼ è¾“</strong>ã€‚</p><p>ä¸€èˆ¬åœ¨ TCP&#x2F;IP é€šä¿¡é‡Œï¼ŒMAC åŒ…å¤´çš„<strong>åè®®ç±»å‹</strong>åªä½¿ç”¨ï¼š</p><ul><li><code>0800</code> ï¼š IP åè®®</li><li><code>0806</code> ï¼š ARP åè®®ï¼ˆAddress Resolution Protocolï¼‰</li></ul><p>åœ¨ç½‘ç»œå±‚ä¸­æˆ‘ä»¬è·å¾—äº†ç›®æ ‡æœåŠ¡çš„IPåœ°å€ï¼Œä½†æ˜¯åœ¨æ•°æ®é“¾è·¯å±‚æˆ‘ä»¬éœ€è¦æ ¹æ®ç›®æ ‡çš„MACåœ°å€æ¥ä¼ é€æ•°æ®åŒ…ï¼Œå¯æ˜¯æˆ‘ä»¬å¦‚ä½•çŸ¥é“ç›®æ ‡åœ°å€çš„MACåœ°å€å‘¢ï¼Ÿè¿™å°±éœ€è¦ARPåè®®ï¼ˆåœ°å€è§£æåè®®ï¼‰</p><p>å‘é€æ–¹çš„ MAC åœ°å€è·å–å°±æ¯”è¾ƒç®€å•äº†ï¼ŒMAC åœ°å€æ˜¯åœ¨ç½‘å¡ç”Ÿäº§æ—¶å†™å…¥åˆ° ROM é‡Œçš„ï¼Œåªè¦å°†è¿™ä¸ªå€¼è¯»å–å‡ºæ¥å†™å…¥åˆ° MAC å¤´éƒ¨å°±å¯ä»¥äº†ã€‚</p><p>æ¥æ”¶æ–¹çš„ MAC åœ°å€å°±æœ‰ç‚¹å¤æ‚äº†ï¼Œåªè¦å‘Šè¯‰ä»¥å¤ªç½‘å¯¹æ–¹çš„ MAC çš„åœ°å€ï¼Œä»¥å¤ªç½‘å°±ä¼šå¸®æˆ‘ä»¬æŠŠåŒ…å‘é€è¿‡å»ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶è¿™é‡Œåº”è¯¥å¡«å†™å¯¹æ–¹çš„ MAC åœ°å€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029929.png" alt="img"></p><p>ARPåè®®é€šè¿‡åŒä¸€å­ç½‘è¿›è¡Œå¹¿æ’­è·å¾—ç›®æ ‡IPçš„MACçš„åœ°å€ï¼Œä½†æ˜¯å¦‚æœä¸åœ¨åŒä¸€å­ç½‘çš„IPå°±ä¼šè¢«å‘é€åˆ°æœ¬åœ°å­ç½‘çš„é»˜è®¤ç½‘å…³ï¼Œå³è·¯ç”±å™¨çš„æ¥å£åœ°å€ã€‚è¿™ä¸ªåœ°å€é€šå¸¸é€šè¿‡é…ç½®åœ¨ä¸»æœºä¸Šçš„é»˜è®¤ç½‘å…³æ¥æŒ‡å®šã€‚è·¯ç”±å™¨æ ¹æ®å…¶è·¯ç”±è¡¨æ¥å†³å®šå¦‚ä½•å°†æ•°æ®åŒ…è½¬å‘åˆ°ä¸‹ä¸€ä¸ªç½‘ç»œæˆ–æœ€ç»ˆç›®çš„åœ°ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨ç½‘ç»œå±‚è¿›è¡Œã€‚æœ€ç»ˆï¼Œæ•°æ®åŒ…åˆ°è¾¾åŒ…å«ç›®æ ‡IPåœ°å€çš„å­ç½‘ã€‚ä¸€æ—¦æ•°æ®åŒ…åˆ°è¾¾ç›®æ ‡å­ç½‘ï¼Œå°±å¯ä»¥ä½¿ç”¨ARPæ¥è§£æç›®æ ‡IPåœ°å€å¯¹åº”çš„MACåœ°å€ã€‚è¿™æ˜¯å› ä¸ºç°åœ¨ç›®æ ‡IPå’Œå‘èµ·ARPè¯·æ±‚çš„è®¾å¤‡ä½äºåŒä¸€å­ç½‘å†…ã€‚è·å¾—MACåœ°å€åï¼Œæ•°æ®é“¾è·¯å±‚å¯ä»¥æ„å»ºä»¥å¤ªç½‘å¸§ï¼Œå°†æ•°æ®åŒ…ä½œä¸ºæœ‰æ•ˆè½½è·ï¼Œå¹¶å°†æºå’Œç›®çš„MACåœ°å€è®¾ç½®ä¸ºæœ¬åœ°ç½‘ç»œä¸Šçš„ç›¸åº”è®¾å¤‡åœ°å€ã€‚</p><p>æ‰€ä»¥ARPçš„ä½¿ç”¨åœºæ™¯æ˜¯åœ¨åŒä¸€å­ç½‘ï¼Œå¦‚æœä¸æ˜¯åœ¨åŒä¸€å­ç½‘åˆ™ä¸å¯ä»¥ä½¿ç”¨ARPåè®®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029774.png" alt="img"></p><h2 id="ç‰©ç†å±‚"><a href="#ç‰©ç†å±‚" class="headerlink" title="ç‰©ç†å±‚"></a>ç‰©ç†å±‚</h2><p>IP ç”Ÿæˆçš„ç½‘ç»œåŒ…åªæ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ä¸€ä¸²äºŒè¿›åˆ¶æ•°å­—ä¿¡æ¯ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥å‘é€ç»™å¯¹æ–¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°å­—ä¿¡æ¯è½¬æ¢ä¸ºç”µä¿¡å·ï¼Œæ‰èƒ½åœ¨ç½‘çº¿ä¸Šä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„æ•°æ®å‘é€è¿‡ç¨‹ã€‚</p><p>è´Ÿè´£æ‰§è¡Œè¿™ä¸€æ“ä½œçš„æ˜¯ç½‘å¡ï¼Œè¦æ§åˆ¶ç½‘å¡è¿˜éœ€è¦é ç½‘å¡é©±åŠ¨ç¨‹åºã€‚</p><p>ç½‘å¡é©±åŠ¨ä» IP æ¨¡å—è·å–åˆ°åŒ…ä¹‹åï¼Œä¼šå°†å…¶å¤åˆ¶åˆ°ç½‘å¡å†…çš„ç¼“å­˜åŒºä¸­ï¼Œæ¥ç€ä¼šå…¶å¼€å¤´åŠ ä¸ŠæŠ¥å¤´å’Œèµ·å§‹å¸§åˆ†ç•Œç¬¦ï¼Œåœ¨æœ«å°¾åŠ ä¸Šç”¨äºæ£€æµ‹é”™è¯¯çš„å¸§æ ¡éªŒåºåˆ—ã€‚</p><p>æœ€åç½‘å¡ä¼šå°†åŒ…è½¬ä¸ºç”µä¿¡å·ï¼Œé€šè¿‡ç½‘çº¿å‘é€å‡ºå»ã€‚</p><h2 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h2><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹åŒ…æ˜¯å¦‚ä½•é€šè¿‡äº¤æ¢æœºçš„ã€‚äº¤æ¢æœºçš„è®¾è®¡æ˜¯å°†ç½‘ç»œåŒ…<strong>åŸæ ·</strong>è½¬å‘åˆ°ç›®çš„åœ°ã€‚äº¤æ¢æœºå·¥ä½œåœ¨ MAC å±‚ï¼Œä¹Ÿç§°ä¸º<strong>äºŒå±‚ç½‘ç»œè®¾å¤‡</strong>ã€‚</p><p>ä½äºåŒä¸€ä¸ªäº¤æ¢æœºä¸‹çš„å¤„äºåŒä¸€å­ç½‘ã€‚</p><p>é¦–å…ˆï¼Œç”µä¿¡å·åˆ°è¾¾ç½‘çº¿æ¥å£ï¼Œäº¤æ¢æœºé‡Œçš„æ¨¡å—è¿›è¡Œæ¥æ”¶ï¼Œæ¥ä¸‹æ¥äº¤æ¢æœºé‡Œçš„æ¨¡å—å°†ç”µä¿¡å·è½¬æ¢ä¸ºæ•°å­—ä¿¡å·ã€‚</p><p>ç„¶åé€šè¿‡åŒ…æœ«å°¾çš„ FCS æ ¡éªŒé”™è¯¯ï¼Œå¦‚æœæ²¡é—®é¢˜åˆ™æ”¾åˆ°ç¼“å†²åŒºã€‚è¿™éƒ¨åˆ†æ“ä½œåŸºæœ¬å’Œè®¡ç®—æœºçš„ç½‘å¡ç›¸åŒï¼Œä½†äº¤æ¢æœºçš„å·¥ä½œæ–¹å¼å’Œç½‘å¡ä¸åŒã€‚</p><p>è®¡ç®—æœºçš„ç½‘å¡æœ¬èº«å…·æœ‰ MAC åœ°å€ï¼Œå¹¶é€šè¿‡æ ¸å¯¹æ”¶åˆ°çš„åŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€åˆ¤æ–­æ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„ï¼Œå¦‚æœä¸æ˜¯å‘ç»™è‡ªå·±çš„åˆ™ä¸¢å¼ƒï¼›ç›¸å¯¹åœ°ï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸æ ¸å¯¹æ¥æ”¶æ–¹ MAC åœ°å€ï¼Œè€Œæ˜¯ç›´æ¥æ¥æ”¶æ‰€æœ‰çš„åŒ…å¹¶å­˜æ”¾åˆ°ç¼“å†²åŒºä¸­ã€‚å› æ­¤ï¼Œå’Œç½‘å¡ä¸åŒï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸å…·æœ‰ MAC åœ°å€ã€‚</p><p>å°†åŒ…å­˜å…¥ç¼“å†²åŒºåï¼Œæ¥ä¸‹æ¥éœ€è¦æŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªåŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€æ˜¯å¦å·²ç»åœ¨ MAC åœ°å€è¡¨ä¸­æœ‰è®°å½•äº†ã€‚</p><p>äº¤æ¢æœºçš„ MAC åœ°å€è¡¨ä¸»è¦åŒ…å«ä¸¤ä¸ªä¿¡æ¯ï¼š</p><ol><li>ä¸€ä¸ªæ˜¯è®¾å¤‡çš„ MAC åœ°å€ï¼Œ</li><li>å¦ä¸€ä¸ªæ˜¯è¯¥è®¾å¤‡è¿æ¥åœ¨äº¤æ¢æœºçš„å“ªä¸ªç«¯å£ä¸Šã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029917.png" alt="img"></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæ”¶åˆ°çš„åŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€ä¸º 00-02-B3-1C-9C-F9ï¼Œåˆ™ä¸å›¾ä¸­è¡¨ä¸­çš„ç¬¬ 3 è¡ŒåŒ¹é…ï¼Œæ ¹æ®ç«¯å£åˆ—çš„ä¿¡æ¯ï¼Œå¯çŸ¥è¿™ä¸ªåœ°å€ä½äº 3 å·ç«¯å£ä¸Šï¼Œç„¶åå°±å¯ä»¥é€šè¿‡äº¤æ¢ç”µè·¯å°†åŒ…å‘é€åˆ°ç›¸åº”çš„ç«¯å£äº†ã€‚</p><p>æ‰€ä»¥ï¼Œäº¤æ¢æœºæ ¹æ® MAC åœ°å€è¡¨æŸ¥æ‰¾ MAC åœ°å€ï¼Œç„¶åå°†ä¿¡å·å‘é€åˆ°ç›¸åº”çš„ç«¯å£ã€‚</p><p>å¦‚æœMACè¡¨ä¸­æ²¡æœ‰å¯¹åº”IPåœ°å€çš„MACåœ°å€ï¼Œé‚£ä¹ˆäº¤æ¢æœºå°±ä¼šå¹¿æ’­æ‰€æœ‰ç«¯å£ï¼Œå¯»æ‰¾MACåœ°å€ï¼Œå¦‚æœæ‰¾åˆ°äº†å°±ä¼šåŠ å…¥åˆ°MACåœ°å€è¡¨ä¸­ï¼Œå¦‚æœæ²¡æ‰¾åˆ°å°±ä¼šåˆ°è®©å‘é€ç«¯ä¸»æœºåˆ°é»˜è®¤ç½‘å…³å¯»æ‰¾MACåœ°å€ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è·¯ç”±å±‚ä¸æ–­çš„è¿›è¡Œå¯»æ‰¾ï¼ŒçŸ¥é“æ‰¾åˆ°ç›®æ ‡äº¤æ¢æœºï¼Œç„¶åä½¿ç”¨ARPåè®®æ‰¾åˆ°MACåœ°å€ã€‚</p><h2 id="è·¯ç”±å™¨"><a href="#è·¯ç”±å™¨" class="headerlink" title="è·¯ç”±å™¨"></a>è·¯ç”±å™¨</h2><p>ç½‘ç»œåŒ…ç»è¿‡äº¤æ¢æœºä¹‹åï¼Œç°åœ¨åˆ°è¾¾äº†è·¯ç”±å™¨ï¼Œå¹¶åœ¨æ­¤è¢«è½¬å‘åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æˆ–ç›®æ ‡è®¾å¤‡ã€‚</p><p>è¿™ä¸€æ­¥è½¬å‘çš„å·¥ä½œåŸç†å’Œäº¤æ¢æœºç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡æŸ¥è¡¨åˆ¤æ–­åŒ…è½¬å‘çš„ç›®æ ‡ã€‚</p><p>ä¸è¿‡åœ¨å…·ä½“çš„æ“ä½œè¿‡ç¨‹ä¸Šï¼Œè·¯ç”±å™¨å’Œäº¤æ¢æœºæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><p><strong>å› ä¸ºè·¯ç”±å™¨æ˜¯åŸºäº IP è®¾è®¡çš„ï¼Œä¿—ç§°ä¸‰å±‚ç½‘ç»œè®¾å¤‡ï¼Œè·¯ç”±å™¨çš„å„ä¸ªç«¯å£éƒ½å…·æœ‰ MAC åœ°å€å’Œ IP åœ°å€ï¼›</strong></p><p>è€Œäº¤æ¢æœºæ˜¯åŸºäºä»¥å¤ªç½‘è®¾è®¡çš„ï¼Œä¿—ç§°äºŒå±‚ç½‘ç»œè®¾å¤‡ï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸å…·æœ‰ IP åœ°å€ã€‚</p><p>è·¯ç”±å™¨çš„ç«¯å£å…·æœ‰ MAC åœ°å€ï¼Œå› æ­¤å®ƒå°±èƒ½å¤Ÿæˆä¸ºä»¥å¤ªç½‘çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹ï¼›åŒæ—¶è¿˜å…·æœ‰ IP åœ°å€ï¼Œä»è¿™ä¸ªæ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒå’Œè®¡ç®—æœºçš„ç½‘å¡æ˜¯ä¸€æ ·çš„ã€‚</p><p>å½“è½¬å‘åŒ…æ—¶ï¼Œé¦–å…ˆè·¯ç”±å™¨ç«¯å£ä¼šæ¥æ”¶å‘ç»™è‡ªå·±çš„ä»¥å¤ªç½‘åŒ…ï¼Œç„¶å<strong>è·¯ç”±è¡¨</strong>æŸ¥è¯¢è½¬å‘ç›®æ ‡ï¼Œå†ç”±ç›¸åº”çš„ç«¯å£ä½œä¸ºå‘é€æ–¹å°†ä»¥å¤ªç½‘åŒ…å‘é€å‡ºå»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029601.png" alt="img"></p><h2 id="æœåŠ¡å™¨-ä¸-å®¢æˆ·ç«¯"><a href="#æœåŠ¡å™¨-ä¸-å®¢æˆ·ç«¯" class="headerlink" title="æœåŠ¡å™¨ ä¸ å®¢æˆ·ç«¯"></a><strong>æœåŠ¡å™¨ ä¸ å®¢æˆ·ç«¯</strong></h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262029592.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-05 Javaå¤šçº¿ç¨‹</title>
      <link href="/2025/02/26/75-05%20Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
      <url>/2025/02/26/75-05%20Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="75-05-Javaå¤šçº¿ç¨‹"><a href="#75-05-Javaå¤šçº¿ç¨‹" class="headerlink" title="75-05 Javaå¤šçº¿ç¨‹"></a>75-05 Javaå¤šçº¿ç¨‹</h1><h2 id="å¤šçº¿ç¨‹åŸºç¡€"><a href="#å¤šçº¿ç¨‹åŸºç¡€" class="headerlink" title="å¤šçº¿ç¨‹åŸºç¡€"></a>å¤šçº¿ç¨‹åŸºç¡€</h2><h3 id="çº¿ç¨‹-ï¼†-è¿›ç¨‹"><a href="#çº¿ç¨‹-ï¼†-è¿›ç¨‹" class="headerlink" title="çº¿ç¨‹ ï¼† è¿›ç¨‹"></a>çº¿ç¨‹ ï¼† è¿›ç¨‹</h3><p>è¿›ç¨‹ï¼šæ˜¯ç³»ç»Ÿèµ„æºè°ƒåº¦å’Œåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œæ“ä½œç³»ç»Ÿåˆ†é…çš„å†…å­˜ç­‰ä¸€äº›ç³»ç»Ÿèµ„æºéƒ½æ˜¯ç›´æ¥åˆ†é…ç»™è¿›ç¨‹çš„ã€‚</p><p>çº¿ç¨‹ï¼šæ˜¯CPUè°ƒåº¦å’Œåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹ä¸€å®šå±äºä¸€ä¸ªè¿›ç¨‹ï¼Œçº¿ç¨‹ä»è¿›ç¨‹ä¸­è·å–æ‰€éœ€è¦çš„å†…å­˜ç­‰å…¶å®ƒä¸€äº›ç³»ç»Ÿèµ„æºã€‚</p><h3 id="çº¿ç¨‹çš„åˆ›å»º"><a href="#çº¿ç¨‹çš„åˆ›å»º" class="headerlink" title="çº¿ç¨‹çš„åˆ›å»º"></a>çº¿ç¨‹çš„åˆ›å»º</h3><p>é‚£ä¹ˆåœ¨Javaç¨‹åºä¸­çš„ä¸€ä¸ªæœåŠ¡ï¼ˆè¿›ç¨‹ï¼‰ä¸­å¦‚ä½•åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å‘¢ï¼Ÿä¸€èˆ¬æˆ‘ä»¬å…·æœ‰ä¸‰ç§æ–¹å¼ã€‚</p><h4 id="ç»§æ‰¿Threadç±»"><a href="#ç»§æ‰¿Threadç±»" class="headerlink" title="ç»§æ‰¿Threadç±»"></a>ç»§æ‰¿Threadç±»</h4><p>Threadç±»æ˜¯Javaå°è£…å¥½çš„ä¸€ä¸ªä¸“é—¨ç”¨äºå®ç°çº¿ç¨‹çš„ç±»ï¼Œå¦‚æœæˆ‘ä»¬è¿™ä¸ªç±»ç»§æ‰¿äº†Threadç±»ï¼Œé‚£ä¹ˆå°±æ˜¯è¿™ä¸ªç±»çš„å­ç±»ã€‚</p><p>æˆ‘ä»¬é€šè¿‡é‡å†™Threadç±»çš„runæ¥å£æ¥è¾¾åˆ°æ–°å»ºä¸€ä¸ªçº¿ç¨‹çš„ç›®çš„</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033020.png" alt="image-20240926120539753"></p><p>ä½†æ˜¯ç»§æ‰¿çš„æ–¹æ³•å¤§å®¶ç”¨çš„ä¸æ˜¯å¾ˆå¤šï¼Œå› ä¸ºä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€æ¬¡ï¼Œå°±ä¼šå¯¼è‡´å…¶æ‹“å±•æ€§é™ä½ã€‚</p><h4 id="å®ç°Runnableæ¥å£"><a href="#å®ç°Runnableæ¥å£" class="headerlink" title="å®ç°Runnableæ¥å£"></a>å®ç°Runnableæ¥å£</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033511.png" alt="image-20240926120842455"></p><h4 id="å®ç°Callableæ¥å£"><a href="#å®ç°Callableæ¥å£" class="headerlink" title="å®ç°Callableæ¥å£"></a>å®ç°Callableæ¥å£</h4><p>Callableå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> CallableThread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-09-26</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableThread</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> Thread.currentThread().getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨FutureTaskæ¥è°ƒç”¨è¿™ä¸ªçº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> ThreadMain</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-09-26</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;String&gt;(<span class="keyword">new</span> <span class="title class_">CallableThread</span>());</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask,<span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> futureTask.get();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>Callableå’ŒRunnableæ¥å£æœ€ä¸»è¦çš„åŒºåˆ«å°±æ˜¯Callableå¯ä»¥è¿”å›çº¿ç¨‹å€¼ï¼Œè¿™åœ¨å¯¹æ•°æ®åº“çš„ä¸€äº›çº¿ç¨‹æ“ä½œä¸­æœ‰å¾ˆå¤§çš„ç”¨å¤„ã€‚</strong></p><h3 id="æ§åˆ¶çº¿ç¨‹çš„å…¶å®ƒæ–¹æ³•"><a href="#æ§åˆ¶çº¿ç¨‹çš„å…¶å®ƒæ–¹æ³•" class="headerlink" title="æ§åˆ¶çº¿ç¨‹çš„å…¶å®ƒæ–¹æ³•"></a>æ§åˆ¶çº¿ç¨‹çš„å…¶å®ƒæ–¹æ³•</h3><h4 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033258.png" alt="image-20240926124313233"></p><h4 id="join"><a href="#join" class="headerlink" title="join"></a>join</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033904.png" alt="image-20240926124334311"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033855.png" alt="image-20240926124345424"></p><h4 id="setDaemon"><a href="#setDaemon" class="headerlink" title="setDaemon"></a>setDaemon</h4><p><strong>ç‰¹æ€§</strong>ï¼š</p><ul><li>å®ˆæŠ¤çº¿ç¨‹åœ¨åå°è¿è¡Œï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºåº”ç”¨ç¨‹åºæä¾›æœåŠ¡ã€‚</li><li>å½“æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ç»“æŸæ—¶ï¼ŒJVMä¼šè‡ªåŠ¨é€€å‡ºï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šè¢«ç»ˆæ­¢ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033975.png" alt="image-20240926131047374"></p><p><strong>å…¸å‹åº”ç”¨</strong>ï¼š</p><ul><li>å¸¸ç”¨äºæ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡ã€ç›‘æ§ä»»åŠ¡æˆ–æ¸…ç†èµ„æºï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•æˆ–æ•°æ®å¤‡ä»½ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033021.png" alt="image-20240926131254270"></p><h3 id="å…³äºStartçš„ä¸¤ä¸ªå¼•ç”³é—®é¢˜"><a href="#å…³äºStartçš„ä¸¤ä¸ªå¼•ç”³é—®é¢˜" class="headerlink" title="å…³äºStartçš„ä¸¤ä¸ªå¼•ç”³é—®é¢˜"></a>å…³äºStartçš„ä¸¤ä¸ªå¼•ç”³é—®é¢˜</h3><p>åå¤è°ƒâ½¤åŒâ¼€ä¸ªçº¿ç¨‹çš„ start â½…æ³•æ˜¯å¦å¯â¾ï¼Ÿ 2. å‡å¦‚â¼€ä¸ªçº¿ç¨‹æ‰§â¾å®Œæ¯•ï¼ˆæ­¤æ—¶å¤„äº TERMINATED çŠ¶æ€ï¼‰ï¼Œå†æ¬¡è°ƒâ½¤è¿™ä¸ªçº¿ç¨‹çš„ start â½…æ³•æ˜¯å¦å¯â¾ï¼Ÿ</p><p>threadStatus !&#x3D; 0 è¡¨ç¤ºè¿™ä¸ªçº¿ç¨‹å·²ç»è¢«å¯åŠ¨è¿‡æˆ–å·²ç»ç»“æŸäº†ã€‚</p><p>threadStatusè¡¨ç¤ºè¯¥çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯åˆšåˆšåˆ›å»ºæˆåŠŸçš„è¯ï¼Œå…¶çŠ¶æ€å°±æ˜¯0.</p><p>å¦‚æœä¸æ˜¯0æ ¹æ®å…¶å†…éƒ¨Startæºç æ¥çœ‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033549.png" alt="image-20240926135056222"></p><p>å…¶ä¸­å°±ä¼šæŠ¥å‡ºå¼‚å¸¸</p><p> åå¤è°ƒâ½¤åŒâ¼€ä¸ªçº¿ç¨‹çš„ start â½…æ³•æ˜¯å¦å¯â¾ï¼Ÿ </p><p> å‡å¦‚â¼€ä¸ªçº¿ç¨‹æ‰§â¾å®Œæ¯•ï¼ˆæ­¤æ—¶å¤„äº TERMINATED çŠ¶æ€ï¼‰ï¼Œå†æ¬¡è°ƒâ½¤è¿™ä¸ªçº¿ç¨‹çš„ start â½…æ³•æ˜¯å¦å¯â¾ï¼Ÿ </p><p>ç»“åˆä¸Šâ¾¯çš„æºç å¯ä»¥å¾—åˆ°çš„ç­”æ¡ˆæ˜¯ï¼š </p><ol><li>éƒ½ä¸â¾ï¼Œåœ¨è°ƒâ½¤ start ä¹‹åï¼ŒthreadStatus çš„å€¼ä¼šæ”¹å˜ï¼ˆ threadStatus !&#x3D;0 ï¼‰ï¼Œå†æ¬¡è°ƒâ½¤ start â½…æ³•ä¼šæŠ›å‡º IllegalThreadStateException å¼‚å¸¸ã€‚</li><li>threadStatus ä¸º 2 ä»£è¡¨å½“å‰çº¿ç¨‹çŠ¶æ€ä¸º TERMINATEDï¼ˆä¸‹â¾¯ä¼šè®²ï¼‰</li></ol><p><a href="https://coolshell.cn/articles/9606.html">https://coolshell.cn/articles/9606.html</a></p><h3 id="å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜"><a href="#å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜"></a>å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜</h3><h4 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h4><p>åœ¨å•çº¿ç¨‹ä¸‹æ­£å¸¸æ‰§è¡Œçš„ä»£ç å¯èƒ½åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹å¹¶ä¸å®‰å…¨ï¼Œè¿™æ˜¯å› ä¸ºæœ‰äº›ä»£ç ä¸æ˜¯åŸå­æ€§çš„ï¼Œå°±æ˜¯åœ¨æ‰§è¡Œä»£ç çš„æ—¶å€™å¯èƒ½ä¼šæ‰§è¡Œåˆ°ä¸€åŠå†å»æ‰§è¡Œå…¶å®ƒçš„ä»£ç ã€‚</p><p>è¿˜æœ‰å°±æ˜¯å¯è§æ€§é—®é¢˜ï¼Œå°±æ˜¯æˆ‘çº¿ç¨‹Aå¯¹æ•°æ®è¿›è¡Œäº†æ›´æ–°ï¼Œä½†æ˜¯å…¶åªæ˜¯åœ¨çº¿ç¨‹å†…è¿›è¡Œäº†æ›´æ–°ï¼Œå¹¶æ²¡æœ‰å³æ—¶æ›´æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼ŒåŸºäºJVMæ¥è¯´å°±æ˜¯æŒ‡ï¼Œçº¿ç¨‹åªæ˜¯æŠŠæ•°æ®ä¿å­˜åˆ°äº†Javaè™šæ‹Ÿæœºæ ˆä¸­ï¼Œè¿˜æœªæ¥å¾—åŠæŠŠæ•°æ®æ›´æ–°åˆ°å †ä¸Šã€‚è¿™æ ·å°±å¯èƒ½å¯¼è‡´çº¿ç¨‹Bæ¥è¯»å–è¿™ä¸ªæ•°æ®å¹¶ä¸æ˜¯æœ€æ–°çš„ï¼Œè¿™å°±æ˜¯å¯è§æ€§é—®é¢˜ã€‚</p><p>åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ä¹Ÿå¯èƒ½å‡ºç°å¤šçº¿ç¨‹å æœ‰ç„¶åæŠ¢å èµ„æºçš„æƒ…å†µå¯¼è‡´æ­»é”ï¼Œè¿˜å¯èƒ½å­˜åœ¨å¤šçº¿ç¨‹äº’ç›¸ç¤¼è®©å¯¼è‡´æ´»é”é—®é¢˜ä»¥åŠçº¿ç¨‹ä¸€ç›´å¾—ä¸åˆ°è¿è¡Œçš„é¥¥é¥¿é—®é¢˜ã€‚</p><p>åœ¨Javaä¸­çº¿ç¨‹å®‰å…¨é›†åˆå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033525.png" alt="image-20241008111303509"></p><h4 id="æ€§èƒ½é—®é¢˜"><a href="#æ€§èƒ½é—®é¢˜" class="headerlink" title="æ€§èƒ½é—®é¢˜"></a>æ€§èƒ½é—®é¢˜</h4><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œé‚£ä¹ˆåˆ°åº•å®ƒå“ªé‡Œå¯¼è‡´äº†çº¿ç¨‹ä¸å®‰å…¨å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬éœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨åº”è¯¥ä½¿ç”¨å“ªç§Mapå‘¢</p><h2 id="è·å–çº¿ç¨‹æ‰§è¡Œç»“æœ"><a href="#è·å–çº¿ç¨‹æ‰§è¡Œç»“æœ" class="headerlink" title="è·å–çº¿ç¨‹æ‰§è¡Œç»“æœ"></a>è·å–çº¿ç¨‹æ‰§è¡Œç»“æœ</h2><p>é€šè¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œå¯ä»¥çŸ¥é“åˆ›å»ºçº¿ç¨‹æœ‰ä¸‰ç§æ–¹å¼ï¼šç»§æ‰¿Threadç±»ï¼Œå®ç°Runnableæ¥å£ï¼Œå®ç°Callableæ¥å£ã€‚</p><p>ä½†æ˜¯å‰é¢ä¸¤ç§æ˜¯æ— æ³•è·å–çº¿ç¨‹æ‰§è¡Œå¾—åˆ°çš„ç»“æœçš„ï¼Œä½†æ˜¯Callableæ¥å£å¯ä»¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        Callable&lt;String&gt; task = <span class="keyword">new</span> <span class="title class_">Callable</span>&lt;String&gt;()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span> + Thread.currentThread().getName();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Future[] futures = <span class="keyword">new</span> <span class="title class_">Future</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            futures[i] = executorService.submit(task);</span><br><span class="line">            System.out.println(futures[i].get());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line"><span class="comment">//            System.out.println(futures[i].get());</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        executorService.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹çœ‹Futureæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Future</span>&lt;V&gt; &#123;</span><br><span class="line"> <span class="type">boolean</span> <span class="title function_">cancel</span><span class="params">(<span class="type">boolean</span> mayInterruptIfRunning)</span>;</span><br><span class="line"> <span class="type">boolean</span> <span class="title function_">isCancelled</span><span class="params">()</span>;</span><br><span class="line"> <span class="type">boolean</span> <span class="title function_">isDone</span><span class="params">()</span>;</span><br><span class="line"> V <span class="title function_">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException;</span><br><span class="line"> V <span class="title function_">get</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span></span><br><span class="line"> <span class="keyword">throws</span> InterruptedException, ExecutionException,</span><br><span class="line">TimeoutException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ Future æä¾›äº†ä¸‰ç§åŠŸèƒ½ï¼š</p><ul><li><p>1ï¼‰åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆï¼›</p></li><li><p>2ï¼‰èƒ½å¤Ÿä¸­æ–­ä»»åŠ¡ï¼›</p></li><li><p>3ï¼‰èƒ½å¤Ÿè·å–ä»»åŠ¡æ‰§â¾ç»“æœã€‚</p></li></ul><p>å½“éœ€è¦å¼‚æ­¥æ‰§â¾â¼€ä¸ªè®¡ç®—å¹¶åœ¨ç¨åçš„æŸä¸ªæ—¶é—´ç‚¹è·å–å…¶ç»“æœæ—¶ï¼Œå°±å¯ä»¥ä½¿â½¤ FutureTaskã€‚æ¥ä¸ªä¾‹â¼¦ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">futureTask</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    Callable&lt;Integer&gt;[] tasks = <span class="keyword">new</span> <span class="title class_">Callable</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;tasks.length;i++)&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> i;</span><br><span class="line"></span><br><span class="line">        tasks[i] = <span class="keyword">new</span> <span class="title class_">Callable</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(index + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> (index + <span class="number">1</span>) * <span class="number">100</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FutureTask[] futureTasks = <span class="keyword">new</span> <span class="title class_">FutureTask</span>[tasks.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt; tasks.length;i++)&#123;</span><br><span class="line">        futureTasks[i] = <span class="keyword">new</span> <span class="title class_">FutureTask</span>(tasks[i]);</span><br><span class="line">        executorService.submit(futureTasks[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt; tasks.length;i++)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Result of task&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;: &quot;</span> + futureTasks[i].get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    executorService.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Javaçº¿ç¨‹çš„6ç§çŠ¶æ€"><a href="#Javaçº¿ç¨‹çš„6ç§çŠ¶æ€" class="headerlink" title="Javaçº¿ç¨‹çš„6ç§çŠ¶æ€"></a>Javaçº¿ç¨‹çš„6ç§çŠ¶æ€</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ“ä½œç³»ç»Ÿä¸­çš„çº¿ç¨‹çŠ¶æ€è½¬æ¢ã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹è¢«è§†ä¸ºè½»á°çº§çš„è¿›ç¨‹ï¼Œ<strong>æ‰€ä»¥çº¿ç¨‹çŠ¶æ€å…¶å®å’Œè¿›ç¨‹çŠ¶æ€æ˜¯â¼€è‡´çš„</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033819.png" alt="image-20241022191157433"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Thread.State æºç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">State</span> &#123;</span><br><span class="line"> NEW,</span><br><span class="line"> RUNNABLE,</span><br><span class="line"> BLOCKED,</span><br><span class="line"> WAITING,</span><br><span class="line"> TIMED_WAITING,</span><br><span class="line"> TERMINATED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹çœ‹åœ¨JVMä¸­çš„çº¿ç¨‹çš„çŠ¶æ€æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p><h3 id="NEW"><a href="#NEW" class="headerlink" title="NEW"></a>NEW</h3><p>å¤„äº NEW çŠ¶æ€çš„çº¿ç¨‹æ­¤æ—¶å°šæœªå¯åŠ¨ã€‚è¿™â¾¥çš„å°šæœªå¯åŠ¨æŒ‡çš„æ˜¯è¿˜æ²¡è°ƒâ½¤ Thread å®ä¾‹çš„ start() â½…æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033146.png" alt="image-20241022191939527"></p><p>å…³äºstartæœ‰ä¸¤ä¸ªæ¯”è¾ƒç»å…¸çš„é—®é¢˜</p><ol><li>åå¤è°ƒç”¨åŒä¸€ä¸ªç°æˆçš„startæ–¹æ³•æ˜¯å¦å¯è¡Œï¼Ÿ</li><li>å‡å¦‚ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼ˆæ­¤æ—¶å¤„äº TERMINATED çŠ¶æ€ï¼‰ï¼Œå†æ¬¡è°ƒâ½¤è¿™ä¸ªçº¿ç¨‹çš„ start â½… æ³•æ˜¯å¦å¯â¾ï¼Ÿ</li></ol><p><strong>ç­”æ¡ˆæ˜¯éƒ½ä¸è¡Œã€‚</strong></p><p>çœ‹çœ‹startæºç å°±èƒ½çŸ¥é“ç­”æ¡ˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033510.png" alt="image-20241022192227658"></p><p>å¯ä»¥çœ‹åˆ°startçš„æºç ä¸­æœ‰ä¸€ä¸ªThreadStatusè®°å½•ç€è¿™ä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼Œå¦‚æœè¿™ä¸ªçº¿ç¨‹è¢«å¯åŠ¨è¿‡å°±éƒ½ä¸ä¼šä¸º0ï¼Œä¸€æ—¦è¯¥çŠ¶æ€ä¸ä¸º0è€Œåˆå¯åŠ¨äº†startå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><h3 id="RUNNABLE"><a href="#RUNNABLE" class="headerlink" title="RUNNABLE"></a>RUNNABLE</h3><p>è¡¨ç¤ºå½“å‰çº¿ç¨‹æ­£åœ¨è¿â¾ä¸­ã€‚å¤„äº RUNNABLE çŠ¶æ€çš„çº¿ç¨‹åœ¨ Java è™šæ‹Ÿæœºä¸­è¿â¾ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨ ç­‰å¾… CPU åˆ†é…èµ„æºã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒJava çº¿ç¨‹çš„RUNNABLEçŠ¶æ€å…¶å®åŒ…æ‹¬äº†æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„readyå’Œrunningä¸¤ä¸ªçŠ¶æ€ã€‚</p><h3 id="BLOCKED"><a href="#BLOCKED" class="headerlink" title="BLOCKED"></a>BLOCKED</h3><p>é˜»å¡çŠ¶æ€ã€‚å¤„äº BLOCKED çŠ¶æ€çš„çº¿ç¨‹æ­£ç­‰å¾…é”ï¼ˆé”ä¼šåœ¨åâ¾¯ç»†è®²ï¼‰çš„é‡Šæ”¾ä»¥è¿›â¼ŠåŒæ­¥åŒºã€‚ æˆ‘ä»¬â½¤ BLOCKED çŠ¶æ€ä¸¾ä¸ªâ½£æ´»ä¸­çš„ä¾‹â¼¦ï¼š å‡å¦‚ä»Šå¤©ä½ ä¸‹ç­åå‡†å¤‡å»â»å ‚åƒé¥­ã€‚ä½ æ¥åˆ°â»å ‚ä»…æœ‰çš„â¼€ä¸ªçª—â¼ï¼Œå‘ç°å‰â¾¯å·²ç»æœ‰ä¸ªâ¼ˆåœ¨çª—â¼ å‰äº†ï¼Œæ­¤æ—¶ä½ å¿…é¡»å¾—ç­‰å‰â¾¯çš„â¼ˆä»çª—â¼ç¦»å¼€æ‰â¾ã€‚ å‡è®¾ä½ æ˜¯çº¿ç¨‹ t2ï¼Œä½ å‰â¾¯çš„é‚£ä¸ªâ¼ˆæ˜¯çº¿ç¨‹ t1ã€‚æ­¤æ—¶ t1 å æœ‰äº†é”ï¼ˆâ»å ‚å”¯â¼€çš„çª—â¼ï¼‰ï¼Œt2 æ­£åœ¨ ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œæ‰€ä»¥æ­¤æ—¶ t2 å°±å¤„äº BLOCKED çŠ¶æ€ã€‚</p><h3 id="WAITING"><a href="#WAITING" class="headerlink" title="WAITING"></a>WAITING</h3><p>ç­‰å¾…çŠ¶æ€ã€‚å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹å˜æˆ RUNNABLE çŠ¶æ€éœ€è¦å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚</p><h3 id="TIMED-WAITING"><a href="#TIMED-WAITING" class="headerlink" title="TIMED_WAITING"></a>TIMED_WAITING</h3><p>è¶…æ—¶ç­‰å¾…çŠ¶æ€ã€‚çº¿ç¨‹ç­‰å¾…â¼€ä¸ªå…·ä½“çš„æ—¶é—´ï¼Œæ—¶é—´åˆ°åä¼šè¢«â¾ƒåŠ¨å”¤é†’ã€‚</p><h3 id="TERMINATED"><a href="#TERMINATED" class="headerlink" title="TERMINATED"></a>TERMINATED</h3><p>ç»ˆâ½ŒçŠ¶æ€ã€‚æ­¤æ—¶çº¿ç¨‹å·²æ‰§â¾å®Œæ¯•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033201.png" alt="image-20241022193529590"></p><h3 id="çº¿ç¨‹ä¸­æ–­"><a href="#çº¿ç¨‹ä¸­æ–­" class="headerlink" title="çº¿ç¨‹ä¸­æ–­"></a>çº¿ç¨‹ä¸­æ–­</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033884.png" alt="image-20241022194506218"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033249.png" alt="image-20241022194518047"></p><h2 id="çº¿ç¨‹ç»„"><a href="#çº¿ç¨‹ç»„" class="headerlink" title="çº¿ç¨‹ç»„"></a>çº¿ç¨‹ç»„</h2><p>ThreadGroup æ˜¯â¼€ä¸ªæ ‡å‡†çš„å‘ä¸‹å¼•â½¤çš„æ ‘çŠ¶ç»“æ„ï¼Œè¿™æ ·è®¾è®¡å¯ä»¥é˜²â½Œâ€ä¸Šçº§â€çº¿ç¨‹è¢«â€ä¸‹çº§â€çº¿ç¨‹ å¼•â½¤â½½â½†æ³•æœ‰æ•ˆåœ°è¢« GC å›æ”¶ã€‚</p><p>ThreadGroup å’Œ Thread çš„å…³ç³»å°±å¦‚åŒä»–ä»¬çš„å­—â¾¯æ„æ€â¼€æ ·ç®€å•ç²—æš´ï¼Œæ¯ä¸ª Thread å¿…ç„¶å­˜åœ¨ äºâ¼€ä¸ª ThreadGroup ä¸­ï¼ŒThread ä¸èƒ½ç‹¬â½´äº ThreadGroup å­˜åœ¨ã€‚æ‰§â¾ main() â½…æ³•çš„çº¿ç¨‹ åå­—æ˜¯ mainï¼Œå¦‚æœåœ¨ new Thread æ—¶æ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œé‚£ä¹ˆé»˜è®¤å°†â½—çº¿ç¨‹ï¼ˆå½“å‰æ‰§â¾ new Thread çš„çº¿ç¨‹ï¼‰çº¿ç¨‹ç»„è®¾ç½®ä¸ºâ¾ƒâ¼°çš„çº¿ç¨‹ç»„ã€‚</p><p>æ€»ç»“â¼€ä¸‹ï¼Œçº¿ç¨‹ç»„æ˜¯â¼€ä¸ªæ ‘çŠ¶çš„ç»“æ„ï¼Œæ¯ä¸ªçº¿ç¨‹ç»„ä¸‹â¾¯å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹æˆ–è€…çº¿ç¨‹ç»„ã€‚çº¿ç¨‹ç»„å¯ ä»¥èµ·åˆ°ç»Ÿâ¼€æ§åˆ¶çº¿ç¨‹çš„ä¼˜å…ˆçº§å’Œæ£€æŸ¥çº¿ç¨‹æƒé™çš„ä½œâ½¤ã€‚</p><p>çº¿ç¨‹ä¼˜å…ˆçº§å¯ä»¥æŒ‡å®šï¼ŒèŒƒå›´æ˜¯ 1~10ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½â½€æŒ 10 çº§ä¼˜å…ˆçº§çš„åˆ’åˆ† ï¼ˆâ½å¦‚æœ‰äº›æ“ä½œç³»ç»Ÿåªâ½€æŒ 3 çº§åˆ’åˆ†ï¼šä½ã€ä¸­ã€â¾¼ï¼‰ï¼ŒJava åªæ˜¯ç»™æ“ä½œç³»ç»Ÿâ¼€ä¸ªä¼˜å…ˆçº§çš„å‚ è€ƒå€¼ï¼Œçº¿ç¨‹æœ€ç»ˆåœ¨æ“ä½œç³»ç»Ÿä¸­çš„ä¼˜å…ˆçº§è¿˜æ˜¯ç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚ Java é»˜è®¤çš„çº¿ç¨‹ä¼˜å…ˆçº§ä¸º 5ï¼Œçº¿ç¨‹çš„æ‰§â¾é¡ºåºç”±è°ƒåº¦ç¨‹åºæ¥å†³å®šï¼Œçº¿ç¨‹çš„ä¼˜å…ˆçº§ä¼šåœ¨çº¿ç¨‹è¢« è°ƒâ½¤ä¹‹å‰è®¾å®šã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œâ¾¼ä¼˜å…ˆçº§çš„çº¿ç¨‹å°†ä¼šâ½ä½ä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰æ›´â¾¼çš„æ¦‚ç‡å¾—åˆ°æ‰§â¾ã€‚ Thread ç±»çš„ setPriority() â½…æ³•å¯ä»¥â½¤æ¥è®¾å®šçº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚</p><p>Java ä¸­çš„ä¼˜å…ˆçº§ä¸æ˜¯ç‰¹åˆ«çš„å¯é ï¼ŒJava ç¨‹åºä¸­å¯¹çº¿ç¨‹æ‰€è®¾ç½®çš„ä¼˜å…ˆçº§åªæ˜¯ç»™æ“ä½œç³»ç»Ÿâ¼€ä¸ªå»º è®®ï¼Œæ“ä½œç³»ç»Ÿä¸â¼€å®šä¼šé‡‡çº³ã€‚â½½çœŸæ­£çš„è°ƒâ½¤é¡ºåºï¼Œæ˜¯ç”±æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ç®—æ³•æ¥å†³å®šçš„ã€‚</p><p>è¿˜æœ‰â¼€ç§ç‰¹æ®Šçš„çº¿ç¨‹ï¼Œå«åšå®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemonï¼‰ï¼Œå®ˆæŠ¤çº¿ç¨‹é»˜è®¤çš„ä¼˜å…ˆçº§â½è¾ƒä½ã€‚ </p><ul><li><p>å¦‚æœæŸçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œé‚£å¦‚æœæ‰€æœ‰çš„â¾®å®ˆæŠ¤çº¿ç¨‹éƒ½ç»“æŸäº†ï¼Œè¿™ä¸ªå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šâ¾ƒåŠ¨ç»“ æŸã€‚</p></li><li><p>å½“æ‰€æœ‰çš„â¾®å®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¼šâ¾ƒåŠ¨å…³é—­ï¼Œè¿™å°±å…å»äº†è¿˜è¦ç»§ç»­å…³é—­â¼¦çº¿ç¨‹çš„éº» çƒ¦ã€‚ </p></li><li><p>çº¿ç¨‹é»˜è®¤æ˜¯â¾®å®ˆæŠ¤çº¿ç¨‹ï¼Œå¯ä»¥é€šè¿‡ Thread ç±»çš„ setDaemon â½…æ³•æ¥è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</p></li></ul><p><strong>æ‰€ä»¥ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§â¼¤äºçº¿ç¨‹æ‰€åœ¨çº¿ç¨‹ç»„çš„æœ€â¼¤ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹çš„ä¼˜å…ˆçº§å°†ä¼šå¤± æ•ˆï¼Œå–â½½ä»£ä¹‹çš„æ˜¯çº¿ç¨‹ç»„çš„æœ€â¼¤ä¼˜å…ˆçº§ã€‚</strong></p><p>çº¿ç¨‹ç»„çš„ä¼˜å…ˆçº§é™å®šäº†è¿™ä¸ªçº¿ç¨‹ç»„çš„çº¿ç¨‹ä¼˜å…ˆçº§æœ€é«˜ä¸ºå¤šå°‘ã€‚</p><h2 id="è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«"></a>è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033253.png" alt="image-20241022201539163"></p><h2 id="å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜-1"><a href="#å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜-1" class="headerlink" title="å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜"></a>å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033059.png" alt="image-20241022201502239"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033257.png" alt="image-20241022201515442"></p><h2 id="Javaå†…å­˜æ¨¡å‹"><a href="#Javaå†…å­˜æ¨¡å‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹"></a>Javaå†…å­˜æ¨¡å‹</h2><p>Java å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰å®šä¹‰äº† Java ç¨‹åºä¸­çš„å˜é‡ã€çº¿ç¨‹å¦‚ä½•å’Œä¸»å­˜ ä»¥åŠâ¼¯ä½œå†…å­˜è¿›â¾äº¤äº’çš„è§„åˆ™ã€‚å®ƒä¸»è¦æ¶‰åŠåˆ°å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å…±äº«å˜á°å¯â»…æ€§ã€æŒ‡ä»¤á¯¿æ’ç­‰é—® é¢˜ï¼Œæ˜¯ç†è§£å¹¶å‘ç¼–ç¨‹ä¸­çš„å…³é”®æ¦‚å¿µã€‚</p><p>å¹¶å‘ç¼–ç¨‹çš„çº¿ç¨‹ä¹‹é—´å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„ï¼Ÿçº¿ç¨‹ä¹‹é—´æ˜¯ä»¥ä½•ç§æœºåˆ¶æ¥äº¤æ¢ä¿¡æ¯çš„ï¼›</li><li>çº¿ç¨‹ä¹‹é—´æ˜¯å¦‚ä½•è¿›è¡ŒåŒæ­¥çš„ï¼Ÿçº¿ç¨‹ä¹‹é—´æ˜¯ä»¥ä½•ç§æœºåˆ¶æ¥æ§åˆ¶çº¿ç¨‹é—´å‘ç”Ÿçš„å…ˆå¯¹é¡ºåºï¼›</li></ol><p>æœ‰ä¸¤ç§å¹¶å‘æ¨¡å‹å¯ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼š </p><ol><li>æ¶ˆæ¯ä¼ é€’å¹¶å‘æ¨¡å‹</li><li><strong>å…±äº«å†…å­˜å¹¶å‘æ¨¡å‹</strong></li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033988.png" alt="image-20241022202300932"></p><p><strong>Java ä½¿â½¤çš„æ˜¯å…±äº«å†…å­˜å¹¶å‘æ¨¡å‹ã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033514.png" alt="image-20241022202759311"></p><p>å¯¹äºæ¯â¼€ä¸ªçº¿ç¨‹æ¥è¯´ï¼Œæ ˆéƒ½æ˜¯ç§æœ‰çš„ï¼Œâ½½å †æ˜¯å…±æœ‰çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262034348.png" alt="image-20241022203338743"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š </p><ol><li>æ‰€æœ‰çš„å…±äº«å˜á°éƒ½å­˜åœ¨ä¸»å­˜ä¸­ã€‚ </li><li>æ¯ä¸ªçº¿ç¨‹éƒ½ä¿å­˜äº†â¼€ä»½è¯¥çº¿ç¨‹ä½¿â½¤åˆ°çš„å…±äº«å˜á°çš„å‰¯æœ¬ã€‚ </li><li>å¦‚æœçº¿ç¨‹ A ä¸çº¿ç¨‹ B ä¹‹é—´è¦é€šä¿¡çš„è¯ï¼Œå¿…é¡»ç»å†ä¸‹â¾¯ 2 ä¸ªæ­¥éª¤ï¼š <ol><li>çº¿ç¨‹ A å°†æœ¬åœ°å†…å­˜ A ä¸­æ›´æ–°è¿‡çš„å…±äº«å˜á°åˆ·æ–°åˆ°ä¸»å­˜ä¸­å»ã€‚</li><li>çº¿ç¨‹ B åˆ°ä¸»å­˜ä¸­å»è¯»å–çº¿ç¨‹ A ä¹‹å‰å·²ç»æ›´æ–°è¿‡çš„å…±äº«å˜á°ã€‚</li></ol></li></ol><p>æ³¨æ„ï¼Œæ ¹æ® JMM çš„è§„å®šï¼Œçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨â¾ƒâ¼°çš„æœ¬åœ°å†…å­˜ä¸­è¿›â¾ï¼Œä¸èƒ½ ç›´æ¥ä»ä¸»å­˜ä¸­è¯»å–ã€‚</p><h3 id="å†…å­˜å¯è§æ€§"><a href="#å†…å­˜å¯è§æ€§" class="headerlink" title="å†…å­˜å¯è§æ€§"></a>å†…å­˜å¯è§æ€§</h3><p>å› ä¸ºJavaå†…å­˜æ¨¡å‹è§„å®šï¼Œæ‰€æœ‰çº¿ç¨‹å¯¹äºå…±äº«å˜é‡çš„æ‰€æœ‰æ“ä½œå¿…é¡»åœ¨æœ¬åœ°å†…å­˜ä¸­è¿›è¡Œï¼Œå¯¹äºæ“ä½œç³»ç»Ÿä¸­çš„ä¸€äºŒçº§ç¼“å­˜ä¸­è¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆå¦‚æœå¯¹äºåŒä¸€ä¸ªæ•°æ®ï¼Œå°±ä¼šåˆ†åˆ«åŠ è½½åˆ°å„ä¸ªçš„çº¿ç¨‹å†…å­˜ä¸­ã€‚é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¿™ä¸ªå…±äº«å˜é‡è¢«å…¶å®ƒçº¿ç¨‹æ›´æ–°äº†å‘¢ï¼Ÿ</p><p>è¿™é‡Œçš„éƒ¨åˆ†å†…å®¹åœ¨æ“ä½œç³»ç»Ÿä¸­ä¿è¯CPUç¼“å­˜ä¸€è‡´æ€§çš„æ—¶å€™ä¼šä»‹ç»éƒ¨åˆ†å†…å®¹ã€‚</p><p>JMM è¯´ç™½äº†å°±æ˜¯å®šä¹‰äº†ä¸€äº›è§„èŒƒæ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨è¿™äº›è§„èŒƒæ›´æ–¹ä¾¿åœ°å¼€å‘å¤šçº¿ç¨‹ç¨‹åºã€‚å¯¹äº Java å¼€å‘è€…è¯´ï¼Œä½ ä¸éœ€è¦äº†è§£åº•å±‚åŸç†ï¼Œç›´æ¥ä½¿ç”¨å¹¶å‘ç›¸å…³çš„ä¸€äº›å…³é”®å­—å’Œç±»ï¼ˆæ¯”å¦‚ <code>volatile</code>ã€<code>synchronized</code>ã€å„ç§ <code>Lock</code>ï¼‰å³å¯å¼€å‘å‡ºå¹¶å‘å®‰å…¨çš„ç¨‹åºã€‚</p><p>å¯è§æ€§ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ“ä½œç›¸åŒæ•°æ®æ—¶å¯ä»¥ä¿è¯ä»»ä½•ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªæ•°æ®ä¿®æ”¹å…¶å®ƒçº¿ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚</p><h3 id="å†…å­˜åŸå­æ€§"><a href="#å†…å­˜åŸå­æ€§" class="headerlink" title="å†…å­˜åŸå­æ€§"></a>å†…å­˜åŸå­æ€§</h3><p>åŸå­æ€§ç®€å•æ¥è¯´å°±æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ“ä½œåŒä¸€æ•°æ®æ—¶ä¿è¯åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è¿›è¡Œæ“ä½œï¼Œå³ä¿è¯äº’æ–¥ã€‚</p><h2 id="volatile-å…³é”®å­—"><a href="#volatile-å…³é”®å­—" class="headerlink" title="volatile å…³é”®å­—"></a>volatile å…³é”®å­—</h2><p>volatile å¯ä»¥ä¿è¯å¯â»…æ€§ï¼Œä½†ä¸ä¿è¯åŸâ¼¦æ€§ï¼š </p><ul><li>å½“å†™â¼€ä¸ª volatile å˜é‡æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹åœ¨æœ¬åœ°å†…å­˜ä¸­çš„å˜á°å¼ºåˆ¶åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ å»ï¼›</li><li>è¿™ä¸ªå†™æ“ä½œä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹ä¸­çš„ volatile å˜é‡ç¼“å­˜â½†æ•ˆã€‚</li></ul><p>volatileä¼šç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262033162.png" alt="image-20241022215815822"></p><h2 id="synchronizedå…³é”®å­—"><a href="#synchronizedå…³é”®å­—" class="headerlink" title="synchronizedå…³é”®å­—"></a>synchronizedå…³é”®å­—</h2><p>åœ¨ Java ä¸­ï¼Œå…³é”®å­— synchronized å¯ä»¥ä¿è¯åœ¨åŒâ¼€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰â¼€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§â¾æŸä¸ªâ½…æ³• æˆ–è€…æŸä¸ªä»£ç å—(ä¸»è¦æ˜¯å¯¹â½…æ³•æˆ–è€…ä»£ç å—ä¸­å­˜åœ¨å…±äº«æ•°æ®çš„æ“ä½œ)ï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜åº”è¯¥æ³¨æ„åˆ° synchronized çš„å¦å¤–â¼€ä¸ªá¯¿è¦çš„ä½œâ½¤ï¼Œsynchronized å¯ä¿è¯â¼€ä¸ªçº¿ç¨‹çš„å˜åŒ–(ä¸»è¦æ˜¯å…±äº«æ•°æ® çš„å˜åŒ–)è¢«å…¶ä»–çº¿ç¨‹æ‰€çœ‹åˆ°ï¼ˆä¿è¯å¯â»…æ€§ï¼Œå®Œå…¨å¯ä»¥æ›¿ä»£ volatile åŠŸèƒ½ï¼‰ã€‚</p><p>synchronizedä¿è¯äº†å¯è§æ€§å’ŒåŸå­æ€§ã€‚</p><p>synchronized å…³é”®å­—æœ€ä¸»è¦æœ‰ä»¥ä¸‹ 3 ç§åº”â½¤â½…å¼ï¼š </p><ol><li>åŒæ­¥â½…æ³•ï¼Œä¸ºå½“å‰å¯¹è±¡ï¼ˆthisï¼‰åŠ é”ï¼Œè¿›â¼ŠåŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰å¯¹è±¡çš„é”ï¼›</li><li>åŒæ­¥é™æ€â½…æ³•ï¼Œä¸ºå½“å‰ç±»åŠ é”ï¼ˆé”çš„æ˜¯ Class å¯¹è±¡ï¼‰ï¼Œè¿›â¼ŠåŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰ç±»çš„ é”ï¼› </li><li>åŒæ­¥ä»£ç å—ï¼ŒæŒ‡å®šåŠ é”å¯¹è±¡ï¼Œå¯¹ç»™å®šå¯¹è±¡åŠ é”ï¼Œè¿›â¼ŠåŒæ­¥ä»£ç åº“å‰è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ã€‚</li></ol><p>synchronizedå±äºå¯é‡â¼Šé” ä»äº’æ–¥é”çš„è®¾è®¡ä¸Šæ¥è¯´ï¼Œå½“â¼€ä¸ªçº¿ç¨‹è¯•å›¾æ“ä½œâ¼€ä¸ªç”±å…¶ä»–çº¿ç¨‹æŒæœ‰çš„å¯¹è±¡é”çš„ä¸´ç•Œèµ„æºæ—¶ï¼Œå°† ä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œä½†å½“â¼€ä¸ªçº¿ç¨‹å†æ¬¡è¯·æ±‚â¾ƒâ¼°æŒæœ‰å¯¹è±¡é”çš„ä¸´ç•Œèµ„æºæ—¶ï¼Œè¿™ç§æƒ…å†µå±äºá¯¿â¼Š é”ï¼Œè¯·æ±‚å°†ä¼šæˆåŠŸã€‚</p><h2 id="synchronizedçš„å››ç§é”çŠ¶æ€"><a href="#synchronizedçš„å››ç§é”çŠ¶æ€" class="headerlink" title="synchronizedçš„å››ç§é”çŠ¶æ€"></a>synchronizedçš„å››ç§é”çŠ¶æ€</h2><p>â¾¸å…ˆéœ€è¦æ˜ç¡®çš„â¼€ç‚¹æ˜¯ï¼š<strong>Java å¤šçº¿ç¨‹çš„é”éƒ½æ˜¯åŸºäºå¯¹è±¡çš„</strong>ï¼ŒJava ä¸­çš„æ¯â¼€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸º â¼€ä¸ªé”ã€‚ è¿˜æœ‰â¼€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¸¸å¬åˆ°çš„ç±»é”å…¶å®ä¹Ÿæ˜¯å¯¹è±¡é”ï¼Œä¸Šâ¼€èŠ‚æˆ‘ä»¬ä¹Ÿè®²åˆ°äº†ï¼Œåº”è¯¥æœ‰ä¸ å°‘â¼©ä¼™ä¼´æ³¨æ„åˆ°äº†ã€‚ è¿™â¾¥å†å¤šè¯´â¼å¥å§ã€‚Class å¯¹è±¡æ˜¯â¼€ç§ç‰¹æ®Šçš„ Java å¯¹è±¡ï¼Œä»£è¡¨äº†ç¨‹åºä¸­çš„ç±»å’Œæ¥â¼ã€‚Java ä¸­ çš„æ¯ä¸ªç±»å‹ï¼ˆåŒ…æ‹¬ç±»ã€æ¥â¼ã€æ•°ç»„ä»¥åŠåŸºç¡€ç±»å‹ï¼‰åœ¨ JVM ä¸­éƒ½æœ‰â¼€ä¸ªå”¯â¼€çš„ Class å¯¹è±¡ä¸ä¹‹ å¯¹åº”ã€‚è¿™ä¸ª Class å¯¹è±¡è¢«åˆ›å»ºçš„æ—¶æœºæ˜¯åœ¨ JVM åŠ è½½ç±»æ—¶ï¼Œç”± JVM â¾ƒåŠ¨å®Œæˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262034385.png" alt="image-20241022220852493"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262034668.png" alt="image-20241022221130663"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262034290.png" alt="image-20241022221512196"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262034061.png" alt="image-20241022222110158"></p><h3 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262034318.png" alt="image-20241022222025230"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262034144.png" alt="image-20241022222316213"></p><h2 id="åˆ°åº•ä»€ä¹ˆæ˜¯AQSï¼ˆæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰ï¼Ÿ"><a href="#åˆ°åº•ä»€ä¹ˆæ˜¯AQSï¼ˆæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰ï¼Ÿ" class="headerlink" title="åˆ°åº•ä»€ä¹ˆæ˜¯AQSï¼ˆæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰ï¼Ÿ"></a>åˆ°åº•ä»€ä¹ˆæ˜¯AQSï¼ˆæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰ï¼Ÿ</h2>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>L5-å¤§æ¨¡å‹é¢„è®­ç»ƒ-å¹¶è¡Œè®­ç»ƒå’Œæ¡†æ¶</title>
      <link href="/2025/02/26/61%20%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84/"/>
      <url>/2025/02/26/61%20%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="L5-å¤§æ¨¡å‹é¢„è®­ç»ƒ-å¹¶è¡Œè®­ç»ƒå’Œæ¡†æ¶"><a href="#L5-å¤§æ¨¡å‹é¢„è®­ç»ƒ-å¹¶è¡Œè®­ç»ƒå’Œæ¡†æ¶" class="headerlink" title="L5-å¤§æ¨¡å‹é¢„è®­ç»ƒ-å¹¶è¡Œè®­ç»ƒå’Œæ¡†æ¶"></a>L5-å¤§æ¨¡å‹é¢„è®­ç»ƒ-å¹¶è¡Œè®­ç»ƒå’Œæ¡†æ¶</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://docs.swanlab.cn/zh/examples/pretrain_llm.html">ä»é›¶é¢„è®­ç»ƒä¸€ä¸ªè‡ªå·±çš„å¤§æ¨¡å‹</a></li><li>[å¤§è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒ[1]:åŸºæœ¬æ¦‚å¿µåŸç†ã€ç¥ç»ç½‘ç»œçš„è¯­è¨€æ¨¡å‹ã€Transformeræ¨¡å‹åŸç†è¯¦è§£ã€Bertæ¨¡å‹åŸç†ä»‹ç»(<a href="https://cloud.tencent.com/developer/article/2303090">https://cloud.tencent.com/developer/article/2303090</a>)</li></ul><h2 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h2><h3 id="5-3-å¤§æ¨¡å‹é¢„è®­ç»ƒ"><a href="#5-3-å¤§æ¨¡å‹é¢„è®­ç»ƒ" class="headerlink" title="5.3****å¤§æ¨¡å‹é¢„è®­ç»ƒ"></a><strong>5.3****å¤§æ¨¡å‹é¢„è®­ç»ƒ</strong></h3><p>l é¢„è®­ç»ƒæ–¹æ³•</p><p>l é¢„è®­ç»ƒæ•°æ®å‡†å¤‡ä¸æ¸…æ´—</p><p>l Scaling Lawç®€ä»‹</p><p>l äºŒæ¬¡é¢„è®­ç»ƒçš„ç¾éš¾æ€§é—å¿˜</p><p>l äºŒæ¬¡é¢„è®­ç»ƒçš„é€šç”¨æ•°æ®æ··åˆä¸æ•°æ®é…æ¯”</p><h3 id="5-5-å¹¶è¡Œè®­ç»ƒå’Œæ¡†æ¶"><a href="#5-5-å¹¶è¡Œè®­ç»ƒå’Œæ¡†æ¶" class="headerlink" title="5.5****å¹¶è¡Œè®­ç»ƒå’Œæ¡†æ¶"></a><strong>5.5****å¹¶è¡Œè®­ç»ƒå’Œæ¡†æ¶</strong></h3><p>l å¹¶è¡Œè®­ç»ƒèƒŒæ™¯</p><p>l æ•°æ®å¹¶è¡Œ</p><p>l æ¨¡å‹å¹¶è¡Œ+æµæ°´çº¿å¹¶è¡Œ</p><p>l å¼ é‡å¹¶è¡Œ</p><p>l å¤§æ¨¡å‹åˆ†å¸ƒå¼è®­ç»ƒæ¡†æ¶ç®€ä»‹ï¼šDeepSpeed</p><p>l DeepSpeed å®è·µï¼ˆå®é™…æ•ˆæœï¼‰</p><h2 id="å¤§è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒ"><a href="#å¤§è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒ" class="headerlink" title="å¤§è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒ"></a>å¤§è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒ</h2><p>é¢„è®­ç»ƒï¼ˆPre-trainingï¼‰æ˜¯è¯­è¨€æ¨¡å‹å­¦ä¹ çš„åˆå§‹é˜¶æ®µã€‚åœ¨é¢„è®­ç»ƒæœŸé—´ï¼Œæ¨¡å‹ä¼šæ¥è§¦åˆ°å¤§é‡æœªæ ‡è®°çš„æ–‡æœ¬æ•°æ®ï¼Œä¾‹å¦‚ä¹¦ç±ã€æ–‡ç« å’Œç½‘ç«™ã€‚åœ¨å¤§é‡æœªæ ‡è®°æ–‡æœ¬æ•°æ®ä¸Šè®­ç»ƒè¯­è¨€æ¨¡å‹ã€‚æ¯”å¦‚è¯´åœ¨åŒ…å«æ•°ç™¾ä¸‡æœ¬ä¹¦ã€æ–‡ç« å’Œç½‘ç«™çš„æ•°æ®é›†ä¸Šé¢„è®­ç»ƒåƒ GPT-3 è¿™æ ·çš„è¯­è¨€æ¨¡å‹ã€‚é¢„è®­ç»ƒç›®æ ‡æ˜¯æ•è·æ–‡æœ¬è¯­æ–™åº“ä¸­å­˜åœ¨çš„åº•å±‚æ¨¡å¼ã€ç»“æ„å’Œè¯­ä¹‰çŸ¥è¯†ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/ARPOSPF/article/details/131431885">https://blog.csdn.net/ARPOSPF/article/details/131431885</a></p><h3 id="é¢„è®­ç»ƒæ–¹æ³•"><a href="#é¢„è®­ç»ƒæ–¹æ³•" class="headerlink" title="é¢„è®­ç»ƒæ–¹æ³•"></a>é¢„è®­ç»ƒæ–¹æ³•</h3><p><a href="https://cloud.tencent.com/developer/article/2303090">https://cloud.tencent.com/developer/article/2303090</a></p><p>é¢„è®­ç»ƒå±äºè¿ç§»å­¦ä¹ çš„èŒƒç•´ã€‚ç°æœ‰çš„ç¥ç»ç½‘ç»œåœ¨è¿›è¡Œè®­ç»ƒæ—¶ï¼Œä¸€èˆ¬åŸºäºåå‘ä¼ æ’­ï¼ˆBack Propagationï¼ŒBPï¼‰ç®—æ³•ï¼Œå…ˆå¯¹ç½‘ç»œä¸­çš„å‚æ•°è¿›è¡Œéšæœºåˆå§‹åŒ–ï¼Œå†åˆ©ç”¨éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆStochastic Gradient Descentï¼ŒSGDï¼‰ç­‰ä¼˜åŒ–ç®—æ³•ä¸æ–­ä¼˜åŒ–æ¨¡å‹å‚æ•°ã€‚è€Œé¢„è®­ç»ƒçš„æ€æƒ³æ˜¯ï¼Œæ¨¡å‹å‚æ•°ä¸å†æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œè€Œæ˜¯é€šè¿‡ä¸€äº›ä»»åŠ¡è¿›è¡Œé¢„å…ˆè®­ç»ƒï¼Œå¾—åˆ°ä¸€å¥—æ¨¡å‹å‚æ•°ï¼Œç„¶åç”¨è¿™å¥—å‚æ•°å¯¹æ¨¡å‹è¿›è¡Œåˆå§‹åŒ–ï¼Œå†è¿›è¡Œè®­ç»ƒã€‚</p><p>é¢„è®­ç»ƒå°†å¤§é‡ä½æˆæœ¬æ”¶é›†çš„è®­ç»ƒæ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œç»è¿‡æŸç§é¢„è®­ç»ƒçš„æ–¹æ³•å»å­¦ä¹ å…¶ä¸­çš„å…±æ€§ï¼Œç„¶åå°†å…¶ä¸­çš„å…±æ€§ â€œç§»æ¤â€ åˆ°ç‰¹å®šä»»åŠ¡çš„æ¨¡å‹ä¸­ï¼Œå†ä½¿ç”¨ç›¸å…³ç‰¹å®šé¢†åŸŸçš„å°‘é‡æ ‡æ³¨æ•°æ®è¿›è¡Œ â€œå¾®è°ƒâ€ã€‚å› æ­¤ï¼Œæ¨¡å‹åªéœ€è¦ä»â€œå…±æ€§â€ å‡ºå‘ï¼Œå» â€œå­¦ä¹ â€ è¯¥ç‰¹å®šä»»åŠ¡çš„ â€œç‰¹æ®Šâ€ éƒ¨åˆ†ã€‚</p><p>ä¾‹å¦‚ï¼šè®©ä¸€ä¸ªå®Œå…¨ä¸æ‡‚è‹±æ–‡çš„äººå»åšè‹±æ–‡æ³•å¾‹æ–‡ä¹¦çš„å…³é”®è¯æå–çš„å·¥ä½œä¼šå®Œå…¨æ— æ³•è¿›è¡Œï¼Œæˆ–è€…è¯´ä»–éœ€è¦éå¸¸å¤šçš„æ—¶é—´å»å­¦ä¹ ï¼Œå› ä¸ºä»–ç°åœ¨æ ¹æœ¬çœ‹ä¸æ‡‚è‹±æ–‡ã€‚ä½†æ˜¯ï¼Œå¦‚æœè®©ä¸€ä¸ªè‹±è¯­ä¸ºæ¯è¯­ä½†æ²¡æ¥è§¦è¿‡æ­¤ç±»å·¥ä½œçš„äººå»åšè¿™é¡¹ä»»åŠ¡ï¼Œä»–å¯èƒ½åªéœ€è¦ç›¸å¯¹æ¯”è¾ƒçŸ­çš„æ—¶é—´å­¦ä¹ å¦‚ä½•å»æå–æ³•å¾‹æ–‡ä¹¦çš„å…³é”®è¯å°±å¯ä»¥ä¸Šæ‰‹è¿™é¡¹ä»»åŠ¡ã€‚åœ¨è¿™é‡Œï¼Œè‹±æ–‡çŸ¥è¯†å°±å±äº â€œå…±æ€§â€ çš„çŸ¥è¯†ï¼Œè¿™ç±»çŸ¥è¯†ä¸å¿…è¦åªé€šè¿‡è‹±æ–‡æ³•å¾‹æ–‡ä¹¦çš„ç›¸å…³è¯­æ–™è¿›è¡Œå­¦ä¹ ï¼Œè€Œæ˜¯å¯ä»¥é€šè¿‡å¤§é‡è‹±æ–‡è¯­æ–™ï¼Œä¸ç®¡æ˜¯å°è¯´ã€ä¹¦ç±ï¼Œè¿˜æ˜¯è‡ªåª’ä½“ï¼Œéƒ½å¯ä»¥æ˜¯å­¦ä¹ èµ„æ–™çš„æ¥æºã€‚åœ¨è¯¥ä¾‹ä¸­ï¼Œè®©å®Œå…¨ä¸æ‡‚è‹±æ–‡çš„äººå»å®Œæˆè¿™æ ·çš„ä»»åŠ¡ï¼Œè¿™å°±å¯¹åº”äº†ä¼ ç»Ÿçš„ç›´æ¥è®­ç»ƒæ–¹æ³•ï¼Œè€Œå®Œå…¨ä¸æ‡‚è‹±æ–‡çš„äººå¦‚æœåœ¨æ—©æœŸç³»ç»Ÿå­¦ä¹ äº†è‹±æ–‡ï¼Œå†è®©ä»–å»åšåŒæ ·çš„ä»»åŠ¡ï¼Œå°±å¯¹åº”äº† â€œé¢„è®­ç»ƒ + å¾®è°ƒâ€ çš„æ€è·¯ï¼Œç³»ç»Ÿçš„å­¦ä¹ è‹±æ–‡å³ä¸º â€œé¢„è®­ç»ƒâ€ çš„è¿‡ç¨‹ã€‚</p><p>å¤§è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒæ˜¯æŒ‡æ­å»ºä¸€ä¸ªå¤§çš„ç¥ç»ç½‘ç»œæ¨¡å‹å¹¶å–‚å…¥æµ·é‡çš„æ•°æ®ä»¥æŸç§æ–¹æ³•å»è®­ç»ƒè¯­è¨€æ¨¡å‹ã€‚å¤§è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯è®­ç»ƒè¯­è¨€æ¨¡å‹æ‰€ç”¨çš„æ•°æ®é‡å¤Ÿå¤šã€æ¨¡å‹å¤Ÿå¤§ã€‚</p><h4 id="å¤§è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒæ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#å¤§è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒæ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="å¤§è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒæ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>å¤§è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒæ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h4><p>å¤§è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§æ–¹å¼ï¼Œå„æœ‰å…¶ç‰¹ç‚¹ï¼Œé€‚ç”¨äºä¸åŒçš„ä»»åŠ¡ç±»å‹ï¼š</p><h5 id="ï¼ˆ1ï¼‰æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked-Language-Model-MLMï¼‰"><a href="#ï¼ˆ1ï¼‰æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked-Language-Model-MLMï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked Language Model, MLMï¼‰"></a>ï¼ˆ1ï¼‰æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked Language Model, MLMï¼‰</h5><ul><li><strong>æ–¹æ³•</strong>ï¼šåœ¨é¢„è®­ç»ƒæ—¶ï¼Œéšæœºæ©ç›–å¥å­ä¸­çš„ä¸€äº›è¯ï¼Œè®©æ¨¡å‹é¢„æµ‹è¿™äº›è¢«æ©ç›–çš„è¯ã€‚æ­¤æ–¹æ³•ä½¿æ¨¡å‹èƒ½å¤ŸåŒæ—¶å­¦ä¹ ä¸Šä¸‹æ–‡çš„å·¦ã€å³ä¸¤ä¾§ä¿¡æ¯ã€‚</li><li><strong>ä»£è¡¨æ¨¡å‹</strong>ï¼šBERT ç³»åˆ—ï¼ˆå¦‚ BERTã€RoBERTaã€ALBERT ç­‰ï¼‰ä½¿ç”¨æ©ç è¯­è¨€æ¨¡å‹æ–¹æ³•ã€‚</li><li><strong>åº”ç”¨</strong>ï¼šMLM ä½¿æ¨¡å‹é€‚ç”¨äºç†è§£å’Œæ¨ç†ç±»ä»»åŠ¡ï¼Œä¾‹å¦‚æƒ…æ„Ÿåˆ†æã€å¥å­åˆ†ç±»ã€é—®ç­”ç³»ç»Ÿç­‰ã€‚</li></ul><h5 id="ï¼ˆ2ï¼‰å› æœè¯­è¨€æ¨¡å‹ï¼ˆCausal-Language-Model-CLMï¼‰"><a href="#ï¼ˆ2ï¼‰å› æœè¯­è¨€æ¨¡å‹ï¼ˆCausal-Language-Model-CLMï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰å› æœè¯­è¨€æ¨¡å‹ï¼ˆCausal Language Model, CLMï¼‰"></a>ï¼ˆ2ï¼‰å› æœè¯­è¨€æ¨¡å‹ï¼ˆCausal Language Model, CLMï¼‰</h5><ul><li><strong>æ–¹æ³•</strong>ï¼šè¿™ç§æ–¹æ³•åŸºäºè‡ªå›å½’è¯­è¨€æ¨¡å‹åŸç†ï¼Œé€šè¿‡é€è¯é¢„æµ‹ä¸‹ä¸€ä¸ªè¯è¿›è¡Œè®­ç»ƒã€‚CLM ä»…ä¾èµ–å·¦ä¾§çš„ä¸Šä¸‹æ–‡ï¼Œé€‚åˆé¡ºåºç”Ÿæˆä»»åŠ¡ã€‚</li><li><strong>ä»£è¡¨æ¨¡å‹</strong>ï¼šGPT ç³»åˆ—ï¼ˆå¦‚ GPTã€GPT-2ã€GPT-3ï¼‰ä½¿ç”¨å› æœè¯­è¨€æ¨¡å‹è¿›è¡Œé¢„è®­ç»ƒã€‚</li><li><strong>åº”ç”¨</strong>ï¼šCLM ä¸»è¦åº”ç”¨äºæ–‡æœ¬ç”Ÿæˆã€å¯¹è¯ç³»ç»Ÿå’Œå¤šè½®å¯¹è¯åœºæ™¯ï¼Œå¦‚ ChatGPT ç­‰ç”Ÿæˆå¼ä»»åŠ¡ã€‚</li></ul><h5 id="ï¼ˆ3ï¼‰åºåˆ—åˆ°åºåˆ—æ¨¡å‹ï¼ˆSequence-to-Sequence-Model-Seq2Seqï¼‰"><a href="#ï¼ˆ3ï¼‰åºåˆ—åˆ°åºåˆ—æ¨¡å‹ï¼ˆSequence-to-Sequence-Model-Seq2Seqï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰åºåˆ—åˆ°åºåˆ—æ¨¡å‹ï¼ˆSequence-to-Sequence Model, Seq2Seqï¼‰"></a>ï¼ˆ3ï¼‰åºåˆ—åˆ°åºåˆ—æ¨¡å‹ï¼ˆSequence-to-Sequence Model, Seq2Seqï¼‰</h5><ul><li><strong>æ–¹æ³•</strong>ï¼šä½¿ç”¨ç¼–ç å™¨-è§£ç å™¨æ¶æ„ï¼Œè¾“å…¥åºåˆ—é€šè¿‡ç¼–ç å™¨è½¬åŒ–ä¸ºä¸Šä¸‹æ–‡è¡¨ç¤ºï¼Œå†ç”±è§£ç å™¨ç”Ÿæˆè¾“å‡ºåºåˆ—ã€‚Seq2Seq æ¨¡å‹ä¸»è¦é€‚ç”¨äºè¾“å…¥å’Œè¾“å‡ºå­˜åœ¨å¯¹åº”å…³ç³»çš„ä»»åŠ¡ã€‚</li><li><strong>ä»£è¡¨æ¨¡å‹</strong>ï¼šT5ã€BART ç­‰æ¨¡å‹ä½¿ç”¨ Seq2Seq æ¶æ„ï¼Œå°†è¯­è¨€ç†è§£å’Œç”Ÿæˆä»»åŠ¡ç»“åˆã€‚</li><li><strong>åº”ç”¨</strong>ï¼šè¯¥æ–¹æ³•å¹¿æ³›ç”¨äºæœºå™¨ç¿»è¯‘ã€æ–‡æœ¬æ‘˜è¦ã€é—®ç­”ç­‰ä»»åŠ¡ã€‚</li></ul><h5 id="ï¼ˆ4ï¼‰å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMulti-task-Learningï¼‰"><a href="#ï¼ˆ4ï¼‰å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMulti-task-Learningï¼‰" class="headerlink" title="ï¼ˆ4ï¼‰å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMulti-task Learningï¼‰"></a>ï¼ˆ4ï¼‰å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMulti-task Learningï¼‰</h5><ul><li><strong>æ–¹æ³•</strong>ï¼šæ¨¡å‹åŒæ—¶åœ¨å¤šä¸ªè‡ªç›‘ç£ä»»åŠ¡ä¸Šè¿›è¡Œè®­ç»ƒã€‚ä¾‹å¦‚ï¼ŒT5 æ¨¡å‹åœ¨å¤šä»»åŠ¡æ¡†æ¶ä¸‹ä½¿ç”¨â€œå¡«ç©ºå¼â€è®­ç»ƒä»»åŠ¡ï¼Œå°†æ‰€æœ‰ä»»åŠ¡è½¬åŒ–ä¸ºæ–‡æœ¬ç”Ÿæˆé—®é¢˜ã€‚</li><li><strong>ä»£è¡¨æ¨¡å‹</strong>ï¼šT5ã€UnifiedQA ç­‰ã€‚</li><li><strong>åº”ç”¨</strong>ï¼šå¢å¼ºæ¨¡å‹çš„å¤šæ ·æ€§ï¼Œä½¿å…¶èƒ½æ›´å¥½åœ°å¤„ç†è·¨ä»»åŠ¡çš„åœºæ™¯ã€‚</li></ul><hr><h3 id="é¢„è®­ç»ƒæ•°æ®å‡†å¤‡ä¸æ¸…æ´—"><a href="#é¢„è®­ç»ƒæ•°æ®å‡†å¤‡ä¸æ¸…æ´—" class="headerlink" title="é¢„è®­ç»ƒæ•°æ®å‡†å¤‡ä¸æ¸…æ´—"></a>é¢„è®­ç»ƒæ•°æ®å‡†å¤‡ä¸æ¸…æ´—</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.jiqizhixin.com/articles/2019-02-21-15">æ•°æ®æ¸…æ´—&amp;é¢„å¤„ç†å…¥é—¨å®Œæ•´æŒ‡å—</a></p><p><a href="https://blog.csdn.net/2401_85379281/article/details/143053667">æ•°æ®æ¸…æ´—ä¸æ²»ç†ï¼šä¸ºå¤§æ¨¡å‹é¢„è®­ç»ƒæ‰“é€ å®Œç¾æ•°æ®</a></p><p><a href="https://blog.csdn.net/xiaobing259/article/details/138267915#:~:text=%E6%9C%AC%E6%96%87%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%BA%86%E5%A4%A7,%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BD%B1%E5%93%8D%E5%88%86%E6%9E%90%E3%80%82">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-è®­ç»ƒç¯‡6ï¼šå¤§è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒæ•°æ®å‡†å¤‡-é¢„å¤„ç†</a></p><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>æ•°æ®é¢„å¤„ç†æ˜¯å»ºç«‹æœºå™¨å­¦ä¹ æ¨¡å‹çš„ç¬¬ä¸€æ­¥ï¼ˆä¹Ÿå¾ˆå¯èƒ½æ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼‰ï¼Œå¯¹æœ€ç»ˆç»“æœæœ‰å†³å®šæ€§çš„ä½œç”¨ï¼šå¦‚æœä½ çš„æ•°æ®é›†æ²¡æœ‰å®Œæˆæ•°æ®æ¸…æ´—å’Œé¢„å¤„ç†ï¼Œé‚£ä¹ˆä½ çš„æ¨¡å‹å¾ˆå¯èƒ½ä¹Ÿä¸ä¼šæœ‰æ•ˆâ€”â€”å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p><p>äººä»¬é€šå¸¸è®¤ä¸ºï¼Œæ•°æ®é¢„å¤„ç†æ˜¯ä¸€ä¸ªéå¸¸æ¯ç‡¥çš„éƒ¨åˆ†ã€‚ä½†å®ƒå°±æ˜¯ã€Œåšå¥½å‡†å¤‡ã€å’Œã€Œå®Œå…¨æ²¡æœ‰å‡†å¤‡ã€ä¹‹é—´çš„å·®åˆ«ï¼Œä¹Ÿæ˜¯è¡¨ç°ä¸“ä¸šå’Œä¸šä½™ä¹‹é—´çš„å·®åˆ«ã€‚å°±åƒä¸ºåº¦å‡åšå¥½äº‹å…ˆå‡†å¤‡ä¸€æ ·ï¼Œå¦‚æœä½ æå‰å°†è¡Œç¨‹ç»†èŠ‚ç¡®å®šå¥½ï¼Œå°±èƒ½å¤Ÿé¢„é˜²æ—…é€”å˜æˆä¸€åœºå™©æ¢¦ã€‚</p><h4 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h4><p>è®©æˆ‘ä»¬ä»å¯¼å…¥æ•°æ®é¢„å¤„ç†æ‰€éœ€è¦çš„åº“å¼€å§‹å§ã€‚åº“æ˜¯éå¸¸æ£’çš„ä½¿ç”¨å·¥å…·ï¼šå°†è¾“å…¥ä¼ é€’ç»™åº“ï¼Œå®ƒåˆ™å®Œæˆç›¸åº”çš„å·¥ä½œã€‚ä½ å¯ä»¥æ¥è§¦åˆ°éå¸¸å¤šçš„åº“ï¼Œä½†åœ¨ PYTHON ä¸­ï¼Œæœ‰ä¸‰ä¸ªæ˜¯æœ€åŸºç¡€çš„åº“ã€‚ä»»ä½•æ—¶å€™ï¼Œä½ éƒ½å¾ˆå¯èƒ½æœ€ç»ˆè¿˜æ˜¯ä½¿ç”¨åˆ°å®ƒä»¬ã€‚è¿™ä¸‰ä¸ªåœ¨ä½¿ç”¨ PYTHON æ—¶æœ€æµè¡Œçš„åº“å°±æ˜¯ <strong>Numpyã€Matplotlib å’Œ Pandas</strong>ã€‚Numpy æ˜¯æ»¡è¶³æ‰€æœ‰æ•°å­¦è¿ç®—æ‰€éœ€è¦çš„åº“ï¼Œç”±äºä»£ç æ˜¯åŸºäºæ•°å­¦å…¬å¼è¿è¡Œçš„ï¼Œå› æ­¤å°±ä¼šä½¿ç”¨åˆ°å®ƒã€‚Maplotlibï¼ˆå…·ä½“è€Œè¨€ï¼ŒMatplotlib.pyplotï¼‰åˆ™æ˜¯æ»¡è¶³ç»˜å›¾æ‰€éœ€è¦çš„åº“ã€‚Pandas åˆ™æ˜¯æœ€å¥½çš„å¯¼å…¥å¹¶å¤„ç†æ•°æ®é›†çš„ä¸€ä¸ªåº“ã€‚<strong>å¯¹äºæ•°æ®é¢„å¤„ç†è€Œè¨€ï¼ŒPandas å’Œ Numpy åŸºæœ¬æ˜¯å¿…éœ€çš„</strong>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å¯¼å…¥è¿™äº›åº“çš„æ—¶å€™ï¼Œèµ‹äºˆå…¶ç¼©å†™çš„ç§°å‘¼å½¢å¼ï¼Œåœ¨ä¹‹åçš„ä½¿ç”¨ä¸­ï¼Œè¿™å¯ä»¥èŠ‚çœä¸€å®šçš„æ—¶é—´æˆæœ¬ã€‚è¿™ä¸€æ­¥éå¸¸ç®€å•ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼å®ç°ï¼š</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å…¥æ•°æ®é›†</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&#x27;my_data.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå†’å·è¡¨ç¤ºæå–æ•°æ®é›†çš„å…¨éƒ¨è¡Œï¼Œã€Œ:-1ã€åˆ™è¡¨ç¤ºæå–é™¤æœ€åä¸€åˆ—ä»¥å¤–çš„æ‰€æœ‰åˆ—ã€‚æœ€åçš„ã€Œ.valuesã€è¡¨ç¤ºå¸Œæœ›æå–æ‰€æœ‰çš„å€¼ã€‚</span></span><br><span class="line">X = dataset.iloc[:, :-<span class="number">1</span>].values</span><br><span class="line">y = dataset.iloc[:, <span class="number">3</span>].values</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262011200.png" alt="image-20241022154619745"></p><h5 id="å¦‚æœæœ‰ç¼ºå¤±æ•°æ®ä¼šæ€ä¹ˆæ ·ï¼Ÿ"><a href="#å¦‚æœæœ‰ç¼ºå¤±æ•°æ®ä¼šæ€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="å¦‚æœæœ‰ç¼ºå¤±æ•°æ®ä¼šæ€ä¹ˆæ ·ï¼Ÿ"></a><strong>å¦‚æœæœ‰ç¼ºå¤±æ•°æ®ä¼šæ€ä¹ˆæ ·ï¼Ÿ</strong></h5><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬æ€»ä¼šé‡åˆ°æ•°æ®ç¼ºå¤±ã€‚å¯¹æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†å­˜åœ¨ç¼ºå¤±çš„è¡Œç›´æ¥åˆ é™¤ï¼Œä½†è¿™ä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ï¼Œè¿˜å¾ˆå®¹æ˜“å¼•å‘é—®é¢˜ã€‚å› æ­¤éœ€è¦ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ï¼Œç”¨å…¶æ‰€åœ¨åˆ—çš„å‡å€¼æ¥å¡«å……ç¼ºå¤±ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥åˆ©ç”¨ scikit-learn é¢„å¤„ç†æ¨¡å‹ä¸­çš„ inputer ç±»æ¥å¾ˆè½»æ¾åœ°å®ç°ã€‚ï¼ˆå¦‚æœä½ è¿˜ä¸çŸ¥é“ï¼Œé‚£ä¹ˆæˆ‘å¼ºçƒˆå»ºè®®ä½ ææ˜ç™½å®ƒï¼šscikit-learn åŒ…å«éå¸¸æ£’çš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼‰ã€‚åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œä½ å¯èƒ½å¹¶ä¸é€‚åº”è¯¸å¦‚ã€Œæ–¹æ³•ã€ã€ã€Œç±»ã€å’Œã€Œå¯¹è±¡ã€è¿™äº›æœ¯è¯­ã€‚è¿™ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼</p><ul><li>ç±»å°±æ˜¯æˆ‘ä»¬å¸Œæœ›ä¸ºæŸç›®çš„æ‰€å»ºç«‹çš„æ¨¡å‹ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æ­å»ºä¸€ä¸ªæ£šå­ï¼Œé‚£ä¹ˆæ­å»ºè§„åˆ’å°±æ˜¯ä¸€ä¸ªç±»ã€‚</li><li>å¯¹è±¡æ˜¯ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ ¹æ®è§„åˆ’æ‰€æ­å»ºå‡ºæ¥çš„ä¸€ä¸ªæ£šå­å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚åŒä¸€ä¸ªç±»å¯ä»¥æœ‰å¾ˆå¤šå¯¹è±¡ï¼Œå°±åƒå¯ä»¥æ ¹æ®è§„åˆ’æ­å»ºå‡ºå¾ˆå¤šä¸ªæ£šå­ä¸€æ ·ã€‚</li><li>æ–¹æ³•æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡ä¸Šä½¿ç”¨çš„å·¥å…·ï¼Œæˆ–åœ¨å¯¹è±¡ä¸Šå®ç°çš„å‡½æ•°ï¼šä¼ é€’ç»™å®ƒæŸäº›è¾“å…¥ï¼Œå®ƒè¿”å›ä¸€ä¸ªè¾“å‡ºã€‚è¿™å°±åƒï¼Œå½“æˆ‘ä»¬çš„æ£šå­å˜å¾—æœ‰ç‚¹ä¸é€šæ°”çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ã€Œæ‰“å¼€çª—æˆ·ã€è¿™ä¸ªæ–¹æ³•ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> Imputer</span><br><span class="line">imputer = Imputer(missing_values = np.nan, strategy = â€˜meanâ€™, axis = <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">imputer = imputer.fit(X[:, <span class="number">1</span>:<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">X[:, <span class="number">1</span>:<span class="number">3</span>] = imputer.transform(X[:, <span class="number">1</span>:<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> docx2pdf <span class="keyword">import</span> convert</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_</span> docx to_pdf(docx file, pdf file):</span><br><span class="line">    convert(docx file, pdf file)</span><br><span class="line"><span class="comment"># è°ƒç”¨ç¤ºä¾‹</span></span><br><span class="line">docx_file =<span class="string">&#x27;example.docx&#x27;</span><span class="comment"># æ›¿æ¢ä¸ºå®é™…çš„docxæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">pdf_file =<span class="string">&#x27;example.pdf&#x27;</span> <span class="comment">#æ›¿æ¢ä¸ºå®é™…çš„pdfæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">convert_ docx to_pdf(docx file, pdf file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PlL <span class="keyword">import</span> lmage</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convertjpg_to_pdf</span>(<span class="params">jpg_file, pdf_file</span>):</span><br><span class="line">    image = lmage.<span class="built_in">open</span>(jpg_file)</span><br><span class="line">    pdffilepath = pdffile</span><br><span class="line">    image.save(pdffile path,<span class="string">&#x27;PDF&#x27;</span>,resolution=<span class="number">100.0</span>, save <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># è°ƒç”¨ç¤ºä¾‹</span></span><br><span class="line">jpg_file =<span class="string">&#x27;example.jpgâ€™# æ›¿æ¢ä¸ºå®é™…çš„ipgæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="string">pdf_file =&#x27;</span>example.pd<span class="string">f&#x27; # æ›¿æ¢ä¸ºå®é™…çš„pdfæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="string">convertjpg_to_pdf(jpg_file, pdf file)</span></span><br></pre></td></tr></table></figure><h5 id="å¦‚æœåŒ…å«å±æ€§æ•°æ®ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ"><a href="#å¦‚æœåŒ…å«å±æ€§æ•°æ®ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœåŒ…å«å±æ€§æ•°æ®ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ"></a><strong>å¦‚æœåŒ…å«å±æ€§æ•°æ®ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</strong></h5><p>è¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ã€‚æ²¡æœ‰åŠæ³•æ˜ç¡®åœ°è®¡ç®—è¯¸å¦‚çŒ«ã€ç‹—ã€éº‹é¹¿çš„å‡å€¼ã€‚é‚£ä¹ˆå¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥å°†å±æ€§æ•°æ®ç¼–ç ä¸ºæ•°å€¼ï¼ä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨ sklearn.preprocessing æ‰€æä¾›çš„ LabelEncoder ç±»ã€‚ä»ä½ å¸Œæœ›è¿›è¡Œç¼–ç çš„æŸåˆ—æ•°æ®å…¥æ‰‹ï¼Œè°ƒç”¨ label encoder å¹¶æ‹Ÿåˆåœ¨ä½ çš„æ•°æ®ä¸Šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line">labelencoder_X = LabelEncoder()</span><br><span class="line">X[:, <span class="number">0</span>] = labelencoder_X.fit_transform(X[:, <span class="number">0</span>])</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯å°†ç¬¬ä¸€åˆ—ä¸­çš„å±æ€§å˜é‡æ›¿æ¢ä¸ºæ•°å€¼æ‰€éœ€çš„å…¨éƒ¨å·¥ä½œäº†ã€‚ä¾‹å¦‚ï¼Œéº‹é¹¿å°†ç”¨ 0 è¡¨ç¤ºï¼Œç‹—å°†ç”¨ 2 è¡¨ç¤ºï¼ŒçŒ«å°†ç”¨ 3 è¡¨ç¤ºã€‚</p><p>æ ‡æ³¨ä½“ç³»æš—å«ä»¥ä¸‹ä¿¡æ¯ï¼šæ‰€ä½¿ç”¨çš„æ•°å€¼å±‚çº§å…³ç³»å¯èƒ½ä¼šå½±å“æ¨¡å‹ç»“æœï¼š3 æ¯” 0 çš„æ•°å€¼å¤§ï¼Œä½†çŒ«å¹¶ä¸ä¸€å®šæ¯”éº‹é¹¿å¤§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262011893.png" alt="image-20241022155033442"></p><p>æˆ‘ä»¬éœ€è¦åˆ›å»ºå“‘å˜é‡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä¸ºçŒ«åˆ›å»ºä¸€åˆ—æ•°æ®ï¼Œä¸ºéº‹é¹¿åˆ›å»ºä¸€åˆ—æ•°æ®ï¼Œâ€¦â€¦ä»¥æ­¤ç±»æ¨ã€‚ç„¶åï¼Œå°†æ¯ä¸€åˆ—åˆ†åˆ«ä»¥ 0&#x2F;1 å¡«å……ï¼ˆè®¤ä¸º 1&#x3D;Yesï¼Œ0 &#x3D; Noï¼‰ã€‚è¿™è¡¨æ˜ï¼Œå¦‚æœåŸå§‹åˆ—çš„å€¼ä¸ºçŒ«ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨éº‹é¹¿ä¸€åˆ—å¾—åˆ° 0ï¼Œç‹—ä¸€åˆ—å¾—åˆ° 0ï¼ŒçŒ«ä¸€åˆ—å¾—åˆ° 1ã€‚</p><p>çœ‹ä¸Šå»éå¸¸å¤æ‚ã€‚è¾“å…¥ OneHotEncoder å§ï¼</p><p>å¯¼å…¥ç¼–ç å™¨ï¼Œå¹¶åˆ¶å®šå¯¹åº”åˆ—çš„ç´¢å¼•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder</span><br><span class="line">onehotencoder = OneHotEncoder(categorical_features = [<span class="number">0</span>])</span><br><span class="line">X = onehotencoder.fit_transform(X).toarray()</span><br><span class="line">labelencoder_y = LabelEncoder()</span><br><span class="line">y = labelencoder_y.fit_transform(y)</span><br></pre></td></tr></table></figure><h4 id="è®­ç»ƒé›†ä¸æµ‹è¯•é›†çš„åˆ’åˆ†"><a href="#è®­ç»ƒé›†ä¸æµ‹è¯•é›†çš„åˆ’åˆ†" class="headerlink" title="è®­ç»ƒé›†ä¸æµ‹è¯•é›†çš„åˆ’åˆ†"></a><strong>è®­ç»ƒé›†ä¸æµ‹è¯•é›†çš„åˆ’åˆ†</strong></h4><p>ç°åœ¨ï¼Œä½ å¯ä»¥å¼€å§‹å°†æ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†äº†ã€‚è¿™å·²ç»åœ¨ä¹‹å‰çš„å›¾åƒåˆ†ç±»æ•™ç¨‹ä¸€æ–‡ä¸­è®ºè¿°è¿‡äº†ã€‚ä¸è¿‡è®°å¾—ï¼Œä¸€å®šè¦å°†ä½ çš„æ•°æ®åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ°¸è¿œä¸è¦ç”¨æµ‹è¯•é›†æ¥è®­ç»ƒï¼éœ€è¦é¿å…<a href="https://mp.weixin.qq.com/cgi-bin/appmsg?t=media/appmsg_edit&action=edit&type=10&appmsgid=503273714&isMul=1&token=1842803922&lang=zh_CN">è¿‡æ‹Ÿåˆ</a>ï¼ˆå¯ä»¥è®¤ä¸ºï¼Œè¿‡æ‹Ÿåˆå°±åƒåœ¨ä¸€æ¬¡æµ‹éªŒå‰ï¼Œè®°å¿†äº†è®¸å¤šç»†èŠ‚ï¼Œä½†æ²¡æœ‰ç†è§£å…¶ä¸­çš„ä¿¡æ¯ã€‚å¦‚æœåªæ˜¯è®°å¿†ç»†èŠ‚ï¼Œé‚£ä¹ˆå½“ä½ è‡ªå·±åœ¨å®¶å¤ä¹ çŸ¥è¯†å¡ç‰‡æ—¶ï¼Œæ•ˆæœä¼šå¾ˆå¥½ï¼Œä½†åœ¨æ‰€æœ‰ä¼šè€ƒå¯Ÿæ–°ä¿¡æ¯çš„çœŸå®æµ‹éªŒä¸­ï¼Œéƒ½ä¼šä¸åŠæ ¼ã€‚ï¼‰</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†éœ€è¦å­¦ä¹ çš„æ¨¡å‹ã€‚æ¨¡å‹éœ€è¦åœ¨æ•°æ®ä¸Šè®­ç»ƒï¼Œå¹¶åœ¨å¦å¤–çš„æ•°æ®ä¸Šå®Œæˆæµ‹è¯•ã€‚å¯¹è®­ç»ƒé›†çš„è®°å¿†å¹¶ä¸ç­‰äºå­¦ä¹ ã€‚æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šå­¦ä¹ å¾—è¶Šå¥½ï¼Œå°±åº”è¯¥åœ¨æµ‹è¯•é›†ç»™å‡ºæ›´å¥½çš„é¢„æµ‹ç»“æœã€‚è¿‡æ‹Ÿåˆæ°¸è¿œéƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ç»“æœï¼Œå­¦ä¹ æ‰æ˜¯ï¼</p><p>é¦–å…ˆï¼Œå¯¼å…¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.model_selection import train_test_split</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œå¯ä»¥åˆ›å»º X_trainã€X_testã€y_train å’Œ y_test é›†åˆäº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.2, random_state = 0)</span><br></pre></td></tr></table></figure><p>ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯å°†æ•°æ®é›†æŒ‰ 80&#x2F;20 è¿›è¡Œåˆ’åˆ†ï¼Œå…¶ä¸­ 80% çš„æ•°æ®ç”¨ä½œè®­ç»ƒï¼Œ20% çš„æ•°æ®ç”¨ä½œæµ‹è¯•ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä½•æŒ‡å®š test_size ä¸º 0.2 çš„åŸå› ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥ä»»æ„åˆ’åˆ†ã€‚ä½ å¹¶ä¸éœ€è¦è®¾ç½® random_stateï¼Œè¿™é‡Œè®¾ç½®çš„åŸå› æ˜¯ä¸ºäº†å¯ä»¥å®Œå…¨å¤ç°ç»“æœã€‚</p><h4 id="ç‰¹å¾ç¼©æ”¾"><a href="#ç‰¹å¾ç¼©æ”¾" class="headerlink" title="ç‰¹å¾ç¼©æ”¾"></a><strong>ç‰¹å¾ç¼©æ”¾</strong></h4><p>ä»€ä¹ˆæ˜¯ç‰¹å¾ç¼©æ”¾ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ç‰¹å¾ç¼©æ”¾ï¼Ÿ</p><p>çœ‹çœ‹æˆ‘ä»¬çš„æ•°æ®ã€‚æˆ‘ä»¬æœ‰ä¸€åˆ—åŠ¨ç‰©å¹´é¾„ï¼ŒèŒƒå›´æ˜¯ 4~17ï¼Œè¿˜æœ‰ä¸€åˆ—åŠ¨ç‰©ä»·å€¼ï¼ŒèŒƒå›´æ˜¯$48,000-$83,000ã€‚ä»·å€¼ä¸€æ çš„æ•°å€¼ä¸ä»…è¿œå¤§äºå¹´é¾„ä¸€æ ï¼Œè€Œä¸”å®ƒè¿˜åŒ…å«æ›´åŠ å¹¿é˜”çš„æ•°æ®èŒƒå›´ã€‚è¿™è¡¨æ˜ï¼Œæ¬§å¼è·ç¦»å°†å®Œå…¨ç”±ä»·å€¼è¿™ä¸€ç‰¹å¾æ‰€ä¸»å¯¼ï¼Œè€Œå¿½è§†å¹´é¾„æ•°æ®çš„ä¸»å¯¼æ•ˆæœã€‚å¦‚æœæ¬§å¼è·ç¦»åœ¨ç‰¹å®šæœºå™¨å­¦ä¹ æ¨¡å‹ä¸­å¹¶æ²¡æœ‰å…·ä½“ä½œç”¨ä¼šæ€ä¹ˆæ ·ï¼Ÿç¼©æ”¾ç‰¹å¾å°†ä»èƒ½å¤ŸåŠ é€Ÿæ¨¡å‹ï¼Œå› æ­¤ï¼Œä½ å¯ä»¥åœ¨æ•°æ®é¢„å¤„ç†ä¸­ï¼ŒåŠ å…¥ç‰¹å¾ç¼©æ”¾è¿™ä¸€æ­¥ã€‚</p><p>ç‰¹å¾ç¼©æ”¾çš„æ–¹æ³•æœ‰å¾ˆå¤šã€‚ä½†å®ƒä»¬éƒ½æ„å‘³ç€æˆ‘ä»¬å°†æ‰€æœ‰çš„ç‰¹å¾æ”¾åœ¨åŒä¸€é‡çº²ä¸Šï¼Œè¿›è€Œæ²¡æœ‰ä¸€ä¸ªä¼šè¢«å¦ä¸€ä¸ªæ‰€ä¸»å¯¼ã€‚</p><p>å¯¼å…¥ç›¸å…³åº“å¼€å§‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.preprocessing import StandardScaler</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªéœ€è¦ç¼©æ”¾å¯¹è±¡å¹¶è°ƒç”¨ Standard Scaler</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc_X = StandardScaler()</span><br></pre></td></tr></table></figure><p>ç›´æ¥åœ¨æ•°æ®é›†ä¸Šè¿›è¡Œæ‹Ÿåˆä»¥åŠå˜æ¢ã€‚è·å–å¯¹è±¡å¹¶åº”ç”¨æ–¹æ³•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X_train = sc_X.fit_transform(X_train)</span><br><span class="line">X_test = sc_X.transform(X_test)</span><br></pre></td></tr></table></figure><p>ä¸éœ€è¦åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œæ‹Ÿåˆï¼Œåªè¿›è¡Œå˜æ¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc_y = StandardScaler()</span><br><span class="line">y_train = sc_y.fit_transform(y_train)</span><br></pre></td></tr></table></figure><p><strong>å¯¹äºå“‘å˜é‡è€Œè¨€ï¼Œæ˜¯å¦éœ€è¦è¿›è¡Œç¼©æ”¾ï¼Ÿ</strong></p><p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæœ‰äº›äººè®¤ä¸ºéœ€è¦ï¼Œæœ‰äº›åˆ™è®¤ä¸ºä¸éœ€è¦ã€‚è¿™å–å†³äºä½ å¯¹æ¨¡å‹å¯è§£é‡Šæ€§çš„çœ‹é‡è¯šåº¦ã€‚å°†æ‰€æœ‰æ•°æ®ç¼©æ”¾è‡³åŒä¸€é‡çº²å›ºç„¶æœ‰å¥½å¤„ï¼Œä½†ç¼ºç‚¹æ˜¯ï¼Œè¿™ä¸¢å¤±äº†è§£é‡Šæ¯ä¸ªè§‚æµ‹æ ·æœ¬å½’å±äºå“ªä¸ªå˜é‡çš„ä¾¿æ·æ€§ã€‚</p><p>å¯¹äº Y å‘¢ï¼Ÿå¦‚æœå› å˜é‡æ˜¯ 0 å’Œ 1ï¼Œé‚£ä¹ˆå¹¶ä¸éœ€è¦è¿›è¡Œç‰¹å¾ç¼©æ”¾ã€‚è¿™æ˜¯ä¸€ä¸ªå…·æœ‰æ˜ç¡®ç›¸å…³å€¼çš„åˆ†ç±»é—®é¢˜ã€‚ä½†å¦‚æœå…¶å–å€¼èŒƒå›´éå¸¸å¤§ï¼Œé‚£ä¹ˆç­”æ¡ˆæ˜¯ä½ éœ€è¦åšç¼©æ”¾ã€‚</p><p>æ­å–œä½ ï¼Œä½ å·²ç»å®Œæˆäº†æ•°æ®é¢„å¤„ç†çš„å·¥ä½œï¼</p><p>é€šè¿‡å°‘é‡çš„å‡ è¡Œä»£ç ï¼Œä½ å·²ç»é¢†ç•¥äº†æ•°æ®æ¸…æ´—å’Œé¢„å¤„ç†çš„åŸºç¡€ã€‚æ¯«æ— ç–‘é—®ï¼Œåœ¨æ•°æ®é¢„å¤„ç†è¿™ä¸€æ­¥ä¸­ï¼Œä½ å¯ä»¥åŠ å…¥å¾ˆå¤šè‡ªå·±çš„æƒ³æ³•ï¼šä½ å¯èƒ½ä¼šæƒ³å¦‚ä½•å¡«å……ç¼ºå¤±å€¼ã€‚æ€è€ƒæ˜¯å¦ç¼©æ”¾ç‰¹å¾ä»¥åŠå¦‚ä½•ç¼©æ”¾ç‰¹å¾ï¼Ÿæ˜¯å¦å¼•å…¥å“‘å˜é‡ï¼Ÿæ˜¯å¦è¦å¯¹æ•°æ®åšç¼–ç ï¼Ÿæ˜¯å¦ç¼–ç å“‘å˜é‡â€¦â€¦æœ‰éå¸¸å¤šéœ€è¦è€ƒè™‘çš„ç»†èŠ‚ã€‚ç°åœ¨ï¼Œä½ å·²ç»å®Œå…¨äº†è§£äº†è¿™äº›ï¼Œå¯ä»¥äº²è‡ªåŠ¨æ‰‹è¯•è¯•äº†ï¼Œå‡†å¤‡æ•°æ®å§ï¼</p><hr><h3 id="Scaling-Lawç®€ä»‹"><a href="#Scaling-Lawç®€ä»‹" class="headerlink" title="Scaling Lawç®€ä»‹"></a>Scaling Lawç®€ä»‹</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/qq_27590277/article/details/134544174">è§£æå¤§æ¨¡å‹ä¸­çš„Scaling Law</a></p><h4 id="å‰è¨€-1"><a href="#å‰è¨€-1" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>åœ¨å¤§æ¨¡å‹çš„ç ”å‘ä¸­ï¼Œé€šå¸¸ä¼šæœ‰ä¸‹é¢ä¸€äº›éœ€æ±‚ï¼š</p><ul><li>è®¡åˆ’è®­ç»ƒä¸€ä¸ª10Bçš„æ¨¡å‹ï¼Œæƒ³çŸ¥é“è‡³å°‘éœ€è¦å¤šå¤§çš„æ•°æ®ï¼Ÿ</li><li>æ”¶é›†åˆ°äº†1Tçš„æ•°æ®ï¼Œæƒ³çŸ¥é“èƒ½è®­ç»ƒä¸€ä¸ªå¤šå¤§çš„æ¨¡å‹ï¼Ÿ</li><li>è€æ¿å‡†å¤‡1ä¸ªæœˆåå¼€å‘å¸ƒä¼šï¼Œèƒ½ç”¨çš„èµ„æºæ˜¯100å¼ A100ï¼Œé‚£åº”è¯¥ç”¨å¤šå°‘æ•°æ®è®­ä¸€ä¸ªå¤šå¤§æ¨¡å‹æœ€ç»ˆæ•ˆæœæœ€å¥½ï¼Ÿ</li><li>è€æ¿å¯¹ç°åœ¨10Bçš„æ¨¡å‹ä¸æ»¡æ„ï¼Œæƒ³çŸ¥é“æ‰©å¤§åˆ°100Bæ¨¡å‹çš„æ•ˆæœèƒ½æå‡åˆ°å¤šå°‘ï¼Ÿ</li></ul><p>ä»¥ä¸Šè¿™äº›é—®é¢˜éƒ½å¯ä»¥åŸºäºScaling Lawçš„ç†è®ºè¿›è¡Œå›ç­”ã€‚</p><h4 id="æ ¸å¿ƒç»“è®º"><a href="#æ ¸å¿ƒç»“è®º" class="headerlink" title="æ ¸å¿ƒç»“è®º"></a>æ ¸å¿ƒç»“è®º</h4><p>å¤§æ¨¡å‹çš„Scaling Lawæ˜¯<a href="https://so.csdn.net/so/search?q=OpenAI&spm=1001.2101.3001.7020">OpenAI</a>åœ¨2020å¹´æå‡ºçš„æ¦‚å¿µ[1]ï¼Œå…·ä½“å¦‚ä¸‹:</p><ol><li>å¯¹äºDecoder-onlyçš„æ¨¡å‹ï¼Œè®¡ç®—é‡(Flops), æ¨¡å‹å‚æ•°é‡, æ•°æ®å¤§å°(tokenæ•°)ï¼Œä¸‰è€…æ»¡è¶³: ã€‚(æ¨å¯¼è§æœ¬æ–‡æœ€å)</li><li>æ¨¡å‹çš„æœ€ç»ˆæ€§èƒ½**ã€Œä¸»è¦ä¸ã€**è®¡ç®—é‡ï¼Œæ¨¡å‹å‚æ•°é‡å’Œæ•°æ®å¤§å°ä¸‰è€…ç›¸å…³ï¼Œè€Œä¸æ¨¡å‹çš„å…·ä½“ç»“æ„(å±‚æ•°&#x2F;æ·±åº¦&#x2F;å®½åº¦)åŸºæœ¬æ— å…³ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262011907.png" alt="e005326347d9c36bf43da1175adac2ae.png"></p><blockquote><blockquote><p>å›ºå®šæ¨¡å‹çš„æ€»å‚æ•°é‡ï¼Œè°ƒæ•´å±‚æ•°&#x2F;æ·±åº¦&#x2F;å®½åº¦ï¼Œä¸åŒæ¨¡å‹çš„æ€§èƒ½å·®è·å¾ˆå°ï¼Œå¤§éƒ¨åˆ†åœ¨2%ä»¥å†…</p></blockquote></blockquote><p>å°ºåº¦å®šå¾‹ï¼ˆScaling lawsï¼‰æ˜¯ä¸€ç§æè¿°ç³»ç»Ÿéšç€è§„æ¨¡çš„å˜åŒ–è€Œå‘ç”Ÿçš„è§„å¾‹æ€§å˜åŒ–çš„æ•°å­¦è¡¨è¾¾ã€‚è¿™äº›è§„å¾‹é€šå¸¸è¡¨ç°ä¸ºä¸€äº›å¯æµ‹é‡çš„ç‰¹å¾éšç€ç³»ç»Ÿå¤§å°çš„å¢åŠ è€Œå‘ˆç°å‡ºä¸€ç§å›ºå®šçš„æ¯”ä¾‹å…³ç³»ã€‚å°ºåº¦å®šå¾‹åœ¨ä¸åŒå­¦ç§‘é¢†åŸŸä¸­éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ï¼ŒåŒ…æ‹¬ç‰©ç†å­¦ã€ç”Ÿç‰©å­¦ã€ç»æµå­¦ç­‰ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼ŒOpenAIçš„ç ”ç©¶è€…åœ¨2020å¹´å‘ç°ï¼Œå¤§è¯­è¨€æ¨¡å‹ä¹Ÿéµå¾ªç€å°ºåº¦å®šå¾‹[1]ã€‚</p><p>å¤§è¯­è¨€æ¨¡å‹çš„å°ºåº¦å®šå¾‹æè¿°çš„æ˜¯æ¨¡å‹çš„æ€§èƒ½ ğ¿ ï¼Œæ¨¡å‹çš„å‚æ•°é‡å¤§å° ğ‘ ï¼Œè®­ç»ƒæ¨¡å‹çš„æ•°æ®å¤§å° ğ· ä»¥åŠè®­ç»ƒæ¨¡å‹ä½¿ç”¨çš„è®¡ç®—é‡ ğ¶ ä¹‹é—´çš„å…³ç³»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„å°ºåº¦å®šå¾‹é»˜è®¤è¦æ±‚å¤§è¯­è¨€æ¨¡å‹ä½¿ç”¨çš„æ˜¯Transformerçš„è§£ç å™¨ç»“æ„ã€‚</p><p>æ¨¡å‹çš„æ€§èƒ½ ğ¿ æ˜¯æŒ‡æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„äº¤å‰ç†µæŸå¤±ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262011983.png" alt="image-20241022160324756"></p><p>ğ· è¡¨ç¤ºtokenå­—å…¸è¡¨ï¼Œ ğ‘‡ è¡¨ç¤ºæ–‡æœ¬æ ·æœ¬è¢«åˆ’åˆ†ä¸ºtokenåçš„é•¿åº¦ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„æ•°å­¦è¡¨è¾¾è¿›è¡Œäº†ä¸€å®šçš„ç®€åŒ–ï¼Œä»…é’ˆå¯¹å•ä¸ªæ–‡æœ¬æ ·æœ¬ã€‚å®é™…ä¸Šï¼Œæµ‹è¯•é›†ç”±å¤šä¸ªæ–‡æœ¬æ ·æœ¬ç»„æˆã€‚</p><p>æ¨¡å‹çš„å‚æ•°é‡å¤§å° ğ‘ æ˜¯é™¤äº†é™æ€ç¼–ç çŸ©é˜µå’Œä½ç½®ç¼–ç å¤–çš„å‚æ•°ã€‚</p><p>è®­ç»ƒæ•°æ®å¤§å° ğ· æŒ‡çš„æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨çš„tokenæ•°é‡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ ğ· ç­‰äº ğµğ‘† ï¼Œå…¶ä¸­ ğµ ä»£è¡¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ—¶çš„æ‰¹é‡å¤§å°ï¼ˆBatch Sizeï¼‰ï¼Œ ğ‘† è¡¨ç¤ºå‚æ•°è¿­ä»£çš„æ¬¡æ•°ï¼ˆStepï¼‰ã€‚</p><p>è®­ç»ƒæ¨¡å‹ä½¿ç”¨çš„è®¡ç®—é‡ ğ¶ æ˜¯æŒ‡è®­ç»ƒæ¨¡å‹æ—¶ï¼Œä½¿ç”¨çš„æµ®ç‚¹è¿ç®—æ¬¡æ•°ã€‚æ¯è®­ç»ƒä¸€ä¸ªtokenä¼šæ¶‰åŠä¸€æ¬¡å‰å‘ä¼ æ’­ï¼Œä¸€æ¬¡åå‘ä¼ æ’­ï¼Œåœ¨å¤§è¯­è¨€æ¨¡å‹çš„è®­ç»ƒä¸­ï¼Œåå‘ä¼ æ’­çš„æµ®ç‚¹è¿ç®—æ¬¡æ•°çº¦ä¸ºå‰å‘ä¼ æ’­çš„ä¸¤å€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå’Œå‚æ•°é‡å¤§å° ğ‘ ç±»ä¼¼ï¼Œè¿™é‡Œçš„æµ®ç‚¹è¿ç®—æ¬¡æ•°éœ€è¦æ’é™¤æ‰é™æ€ç¼–ç å’Œä½ç½®ç¼–ç ã€‚</p><p>åœ¨ä½¿ç”¨Transformerçš„è§£ç å™¨ç»“æ„è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å…³äº ğ¶,ğ‘,ğ· ä¹‹é—´çš„è¿‘ä¼¼è®¡ç®—å…³ç³»ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262011605.png" alt="image-20241022160443302"></p><p>å…³äºä¸Šè¿°å…¬å¼çš„æ¨å¯¼è¿‡ç¨‹ï¼Œå¯å‚è€ƒè®ºæ–‡â€œScaling Laws for Neural Language Modelsâ€çš„2.1å°èŠ‚ï¼Œåœ¨æ­¤ä¸å†è¯¦è¿°ã€‚å…¬å¼(2)è¡¨æ˜ï¼Œå½“ ğ¶ ã€ ğ‘ ã€ ğ· ä¸‰è€…ä¸­å·²çŸ¥å…¶ä¸­çš„ä¸¤ä¸ªå€¼æ—¶ï¼Œæˆ‘ä»¬å¯åˆ©ç”¨ä¸Šè¿°å…¬å¼ä¼°ç®—å‡ºç¬¬ä¸‰ä¸ªå€¼ã€‚</p><p>å°ºåº¦å®šå¾‹çš„æ ¸å¿ƒç»“è®ºå¯ä»¥ç”¨ä¸‹é¢è¿™å¥è¯ç®€å•æ€»ç»“ï¼š</p><p>å¯¹äºè®¡ç®—é‡ ğ¶ ï¼Œæ¨¡å‹å‚æ•°é‡ ğ‘ å’Œæ•°æ®é›†å¤§å° ğ· ï¼Œå½“ä¸å—å…¶ä»–ä¸¤ä¸ªå› ç´ åˆ¶çº¦æ—¶ï¼Œæ¨¡å‹æ€§èƒ½ ğ¿ ä¸æ¯ä¸ªå› ç´ éƒ½å‘ˆç° å¹‚å¾‹å…³ç³»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262011965.png" alt="image-20241022160536432"></p><hr><h3 id="äºŒæ¬¡é¢„è®­ç»ƒçš„ç¾éš¾æ€§é—å¿˜"><a href="#äºŒæ¬¡é¢„è®­ç»ƒçš„ç¾éš¾æ€§é—å¿˜" class="headerlink" title="äºŒæ¬¡é¢„è®­ç»ƒçš„ç¾éš¾æ€§é—å¿˜"></a>äºŒæ¬¡é¢„è®­ç»ƒçš„ç¾éš¾æ€§é—å¿˜</h3><h4 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h4><p>ç¾éš¾æ€§é—å¿˜ï¼ˆCatastrophic Forgettingï¼‰æŒ‡çš„æ˜¯åœ¨ç¥ç»ç½‘ç»œæ¨¡å‹è¿›è¡Œæ–°çš„å­¦ä¹ ä»»åŠ¡æ—¶ï¼Œå·²ç»å­¦åˆ°çš„æ—§ä»»åŠ¡çŸ¥è¯†è¿…é€Ÿä¸¢å¤±çš„ç°è±¡ã€‚è¿™ä¸€é—®é¢˜åœ¨æ·±åº¦å­¦ä¹ å’Œè¿ç§»å­¦ä¹ ä¸­å°¤å…¶çªå‡ºï¼Œç‰¹åˆ«æ˜¯åœ¨è¿›è¡ŒäºŒæ¬¡é¢„è®­ç»ƒï¼ˆå³åœ¨åŸæœ‰é¢„è®­ç»ƒåŸºç¡€ä¸Šè¿›è¡Œæ–°ä»»åŠ¡çš„è®­ç»ƒæ—¶ï¼‰æ—¶ã€‚</p><h4 id="2-ç†è®ºèƒŒæ™¯"><a href="#2-ç†è®ºèƒŒæ™¯" class="headerlink" title="2. ç†è®ºèƒŒæ™¯"></a>2. ç†è®ºèƒŒæ™¯</h4><p>åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæ¨¡å‹é€šè¿‡ä¸æ–­è°ƒæ•´å…¶æƒé‡æ¥å­¦ä¹ ç‰¹å®šä»»åŠ¡ã€‚å¦‚æœä¸€ä¸ªæ¨¡å‹åœ¨å¤„ç†æ–°çš„æ•°æ®é›†æˆ–ä»»åŠ¡æ—¶è¿›è¡Œè®­ç»ƒï¼Œä¼˜åŒ–è¿‡ç¨‹å¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹å¯¹æ—§ä»»åŠ¡çš„æƒé‡è°ƒæ•´ï¼Œä»è€Œå¯¼è‡´å¯¹ä¹‹å‰ä»»åŠ¡çš„è¡¨ç°æ˜¾è‘—ä¸‹é™ã€‚è¿™ç§ç°è±¡é€šå¸¸å¯ä»¥ç”¨ä»¥ä¸‹ç†è®ºæ¡†æ¶è¿›è¡Œè§£é‡Šï¼š</p><ul><li><p><strong>æƒé‡é‡åˆ†é…</strong>ï¼šå½“æ¨¡å‹å­¦ä¹ æ–°ä»»åŠ¡æ—¶ï¼Œå®ƒçš„æƒé‡æ›´æ–°å¯èƒ½ä¼šæœç€ä¼˜åŒ–æ–°ä»»åŠ¡çš„æ–¹å‘è¿›è¡Œè°ƒæ•´ï¼Œå¯¼è‡´å¯¹æ—§ä»»åŠ¡çš„è¡¨ç¤ºèƒ½åŠ›ä¸‹é™ã€‚</p></li><li><p><strong>å†…å­˜é™åˆ¶</strong>ï¼šç¥ç»ç½‘ç»œçš„å®¹é‡æ˜¯æœ‰é™çš„ï¼Œå½“å‘å…¶æ·»åŠ æ–°çŸ¥è¯†æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶å­˜å‚¨æ—§çŸ¥è¯†çš„èƒ½åŠ›ä¸‹é™ã€‚è¿™å°±ç±»ä¼¼äºäººç±»åœ¨å­¦ä¹ æ–°ä¿¡æ¯æ—¶ï¼Œæ—§ä¿¡æ¯çš„å›å¿†èƒ½åŠ›å‡å¼±ã€‚</p></li><li><p><strong>å†²çª</strong>ï¼šæ–°ä»»åŠ¡çš„æ•°æ®åˆ†å¸ƒå¯èƒ½ä¸æ—§ä»»åŠ¡çš„æ•°æ®åˆ†å¸ƒå­˜åœ¨å·®å¼‚ï¼Œå¯¼è‡´æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¯¹æ—§çŸ¥è¯†äº§ç”Ÿâ€œå†²çªâ€ã€‚</p></li></ul><h4 id="äºŒæ¬¡é¢„è®­ç»ƒçš„èƒŒæ™¯"><a href="#äºŒæ¬¡é¢„è®­ç»ƒçš„èƒŒæ™¯" class="headerlink" title="äºŒæ¬¡é¢„è®­ç»ƒçš„èƒŒæ™¯"></a>äºŒæ¬¡é¢„è®­ç»ƒçš„èƒŒæ™¯</h4><p>åœ¨å¤§è¯­è¨€æ¨¡å‹çš„è®­ç»ƒä¸­ï¼Œæ¨¡å‹é€šå¸¸ç»è¿‡ä¸€æ¬¡é¢„è®­ç»ƒä»¥å­¦ä¹ ä¸€èˆ¬æ€§çš„è¯­è¨€è¡¨ç¤ºï¼Œç„¶åå†è¿›è¡Œé’ˆå¯¹ç‰¹å®šä»»åŠ¡çš„å¾®è°ƒæˆ–äºŒæ¬¡é¢„è®­ç»ƒã€‚è¿™ç§æ–¹æ³•åˆ©ç”¨äº†å¤§é‡æœªæ ‡æ³¨æ•°æ®çš„é¢„è®­ç»ƒè¡¨ç¤ºï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ›´å¿«åœ°é€‚åº”ç‰¹å®šä»»åŠ¡ã€‚ç„¶è€Œï¼ŒäºŒæ¬¡é¢„è®­ç»ƒå¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹é—å¿˜åŸæœ‰é¢„è®­ç»ƒä¸­å­¦åˆ°çš„é€šç”¨è¯­è¨€è¡¨ç¤ºï¼Œä»è€Œå½±å“åç»­ä»»åŠ¡çš„è¡¨ç°ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>ä¸ºäº†è§£å†³ç¾éš¾æ€§é—å¿˜çš„é—®é¢˜ï¼Œç ”ç©¶è€…æå‡ºäº†ä¸€äº›æ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼š</p><h5 id="1-æ­£åˆ™åŒ–æ–¹æ³•"><a href="#1-æ­£åˆ™åŒ–æ–¹æ³•" class="headerlink" title="1. æ­£åˆ™åŒ–æ–¹æ³•"></a>1. æ­£åˆ™åŒ–æ–¹æ³•</h5><ul><li><p><strong>å¼¹æ€§æƒé‡å›ºå®šï¼ˆElastic Weight Consolidation, EWCï¼‰</strong>ï¼š</p><ul><li>é€šè¿‡å¼•å…¥æ­£åˆ™åŒ–é¡¹æ¥çº¦æŸæ¨¡å‹çš„æƒé‡æ›´æ–°ï¼Œä»è€Œä¿æŒæ—§ä»»åŠ¡çš„é‡è¦ç‰¹å¾ã€‚å…·ä½“åšæ³•æ˜¯åœ¨è®­ç»ƒæ–°ä»»åŠ¡æ—¶ï¼Œé€šè¿‡è®¡ç®—é‡è¦æ€§çŸ©é˜µï¼Œé™åˆ¶å¯¹æ—§ä»»åŠ¡é‡è¦å‚æ•°çš„æ”¹å˜ã€‚</li></ul></li><li><p><strong>L2æ­£åˆ™åŒ–</strong>ï¼š</p><ul><li>åœ¨æ–°ä»»åŠ¡çš„æŸå¤±å‡½æ•°ä¸­æ·»åŠ L2æ­£åˆ™åŒ–é¡¹ï¼Œä»¥é¿å…æ¨¡å‹å¯¹æƒé‡çš„å‰§çƒˆæ›´æ–°ï¼Œä»è€Œä¿æŒæ—§ä»»åŠ¡çš„çŸ¥è¯†ã€‚</li></ul></li></ul><h5 id="2-å¢é‡å­¦ä¹ "><a href="#2-å¢é‡å­¦ä¹ " class="headerlink" title="2. å¢é‡å­¦ä¹ "></a>2. å¢é‡å­¦ä¹ </h5><ul><li><p><strong>å¤šä»»åŠ¡å­¦ä¹ </strong>ï¼š</p><ul><li>åŒæ—¶è®­ç»ƒå¤šä¸ªä»»åŠ¡ï¼Œé€šè¿‡å…±äº«ç‰¹å¾å’Œå‚æ•°ï¼Œå‡å°‘ä»»åŠ¡ä¹‹é—´çš„å¹²æ‰°ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿›è¡Œæ–°ä»»åŠ¡çš„è®­ç»ƒæ—¶ï¼Œå¯ä»¥ä¿ç•™æ—§ä»»åŠ¡çš„è®­ç»ƒæ•°æ®ï¼Œä»¥ä¾¿äºæ¨¡å‹åŒæ—¶å­¦ä¹ ã€‚</li></ul></li><li><p><strong>è®°å¿†å¢å¼ºç½‘ç»œ</strong>ï¼š</p><ul><li>ä½¿ç”¨è®°å¿†ç½‘ç»œï¼ˆMemory-Augmented Networksï¼‰æ¥å­˜å‚¨æ—§ä»»åŠ¡çš„çŸ¥è¯†ã€‚æ¨¡å‹åœ¨å­¦ä¹ æ–°ä»»åŠ¡æ—¶ï¼Œå¯ä»¥ä»è®°å¿†ä¸­æå–æ—§ä»»åŠ¡çš„ç›¸å…³ä¿¡æ¯ï¼Œä»è€Œå‡å°‘é—å¿˜ã€‚</li></ul></li></ul><h5 id="3-æ•°æ®å›æ”¾"><a href="#3-æ•°æ®å›æ”¾" class="headerlink" title="3. æ•°æ®å›æ”¾"></a>3. æ•°æ®å›æ”¾</h5><ul><li><p><strong>ç»éªŒå›æ”¾ï¼ˆExperience Replayï¼‰</strong>ï¼š</p><ul><li>åœ¨è®­ç»ƒæ–°ä»»åŠ¡æ—¶ï¼Œå®šæœŸå°†æ—§ä»»åŠ¡çš„æ•°æ®æ ·æœ¬ï¼ˆæˆ–ç”Ÿæˆæ ·æœ¬ï¼‰é‡æ–°å¼•å…¥è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä»¥å¸®åŠ©æ¨¡å‹ä¿æŒå¯¹æ—§çŸ¥è¯†çš„è®°å¿†ã€‚</li></ul></li><li><p><strong>ç”Ÿæˆæ¨¡å‹</strong>ï¼š</p><ul><li>ä½¿ç”¨ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANsï¼‰æˆ–å…¶ä»–ç”Ÿæˆæ¨¡å‹ç”Ÿæˆæ—§ä»»åŠ¡çš„æ ·æœ¬ï¼Œåœ¨è®­ç»ƒæ–°ä»»åŠ¡æ—¶ä¸æ–°æ•°æ®ä¸€èµ·ä½¿ç”¨ï¼Œå¸®åŠ©æ¨¡å‹ä¿æŒæ—§çŸ¥è¯†ã€‚</li></ul></li></ul><h5 id="4-å…ƒå­¦ä¹ "><a href="#4-å…ƒå­¦ä¹ " class="headerlink" title="4. å…ƒå­¦ä¹ "></a>4. å…ƒå­¦ä¹ </h5><ul><li><strong>å…ƒå­¦ä¹ ï¼ˆMeta-Learningï¼‰</strong>ï¼š<ul><li>é€šè¿‡è®­ç»ƒä¸€ä¸ªèƒ½å¤Ÿå¿«é€Ÿé€‚åº”æ–°ä»»åŠ¡çš„æ¨¡å‹ï¼Œå¯ä»¥åœ¨å­¦ä¹ æ–°ä»»åŠ¡æ—¶åˆ©ç”¨æ—§ä»»åŠ¡çš„ä¿¡æ¯ã€‚è¯¥æ–¹æ³•é€šè¿‡ä¼˜åŒ–æ¨¡å‹åœ¨æ–°ä»»åŠ¡ä¸Šçš„å­¦ä¹ é€Ÿåº¦ï¼Œä»è€Œå‡å°‘ç¾éš¾æ€§é—å¿˜çš„é£é™©ã€‚</li></ul></li></ul><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><p>ç¾éš¾æ€§é—å¿˜æ˜¯æ·±åº¦å­¦ä¹ ä¸­çš„ä¸€ä¸ªé‡è¦é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨äºŒæ¬¡é¢„è®­ç»ƒçš„èƒŒæ™¯ä¸‹ã€‚é€šè¿‡ä½¿ç”¨æ­£åˆ™åŒ–æ–¹æ³•ã€å¢é‡å­¦ä¹ ã€æ•°æ®å›æ”¾å’Œå…ƒå­¦ä¹ ç­‰ç­–ç•¥ï¼Œå¯ä»¥æœ‰æ•ˆå‡è½»é—å¿˜ç°è±¡ï¼Œç¡®ä¿æ¨¡å‹åœ¨æ–°ä»»åŠ¡å­¦ä¹ çš„åŒæ—¶ä¿ç•™å¯¹æ—§çŸ¥è¯†çš„ç†è§£ã€‚æœªæ¥çš„ç ”ç©¶å¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢æ›´åŠ æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œä»¥æé«˜æ¨¡å‹åœ¨ä¸æ–­å˜åŒ–çš„ä»»åŠ¡ç¯å¢ƒä¸­çš„é€‚åº”èƒ½åŠ›ã€‚</p><hr><h3 id="äºŒæ¬¡é¢„è®­ç»ƒçš„é€šç”¨æ•°æ®æ··åˆä¸æ•°æ®é…æ¯”"><a href="#äºŒæ¬¡é¢„è®­ç»ƒçš„é€šç”¨æ•°æ®æ··åˆä¸æ•°æ®é…æ¯”" class="headerlink" title="äºŒæ¬¡é¢„è®­ç»ƒçš„é€šç”¨æ•°æ®æ··åˆä¸æ•°æ®é…æ¯”"></a>äºŒæ¬¡é¢„è®­ç»ƒçš„é€šç”¨æ•°æ®æ··åˆä¸æ•°æ®é…æ¯”</h3><p>äºŒæ¬¡é¢„è®­ç»ƒï¼ˆæˆ–ç§°ä¸ºâ€œäºŒæ¬¡è®­ç»ƒâ€ï¼‰æ˜¯æ·±åº¦å­¦ä¹ å’Œè‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå°¤å…¶æ˜¯åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰ä¸­ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯é€šè¿‡åœ¨å·²ç»é¢„è®­ç»ƒçš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥å¢å¼ºæ¨¡å‹çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ç‰¹å®šä»»åŠ¡æˆ–é¢†åŸŸçš„åº”ç”¨ä¸­ã€‚ä»¥ä¸‹æ˜¯äºŒæ¬¡é¢„è®­ç»ƒè¿‡ç¨‹ä¸­é€šç”¨æ•°æ®æ··åˆä¸æ•°æ®é…æ¯”çš„è¯¦ç»†ä»‹ç»ã€‚</p><h4 id="1-é€šç”¨æ•°æ®æ··åˆ"><a href="#1-é€šç”¨æ•°æ®æ··åˆ" class="headerlink" title="1. é€šç”¨æ•°æ®æ··åˆ"></a>1. é€šç”¨æ•°æ®æ··åˆ</h4><p>é€šç”¨æ•°æ®æ··åˆæ˜¯æŒ‡åœ¨äºŒæ¬¡é¢„è®­ç»ƒé˜¶æ®µï¼Œåˆ©ç”¨å¤šç§ç±»å‹çš„æ•°æ®æºè¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œä»¥æå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å’Œé€‚åº”æ€§ã€‚æ•°æ®æºå¯ä»¥åŒ…æ‹¬ï¼š</p><ul><li><p><strong>é¢„è®­ç»ƒæ•°æ®</strong>ï¼šä½¿ç”¨å·²ç»å­˜åœ¨çš„å¤§è§„æ¨¡æ–‡æœ¬æ•°æ®é›†ï¼Œå¦‚Wikipediaã€Common Crawlç­‰ï¼Œè¿™äº›æ•°æ®é€šå¸¸åŒ…å«ä¸°å¯Œçš„è¯­è¨€çŸ¥è¯†å’Œè¯­å¢ƒä¿¡æ¯ã€‚</p></li><li><p><strong>é¢†åŸŸç‰¹å®šæ•°æ®</strong>ï¼šé’ˆå¯¹ç‰¹å®šåº”ç”¨åœºæ™¯æˆ–è¡Œä¸šï¼ˆå¦‚åŒ»å­¦ã€æ³•å¾‹ç­‰ï¼‰çš„æ•°æ®é›†ã€‚è¿™äº›æ•°æ®é€šå¸¸è¾ƒå°ä½†èƒ½æä¾›é’ˆå¯¹æ€§çš„çŸ¥è¯†ï¼Œä½¿æ¨¡å‹æ›´å¥½åœ°é€‚åº”ç‰¹å®šä»»åŠ¡ã€‚</p></li><li><p><strong>å¢å¼ºæ•°æ®</strong>ï¼šé€šè¿‡æ•°æ®å¢å¼ºæŠ€æœ¯ç”Ÿæˆçš„æ–°æ•°æ®ï¼Œæˆ–é€šè¿‡åˆæˆæ–¹æ³•ï¼ˆå¦‚ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼‰äº§ç”Ÿçš„æ ·æœ¬ã€‚è¿™ç§æ•°æ®èƒ½å¸®åŠ©æ¨¡å‹å­¦ä¹ åˆ°æ›´å¹¿æ³›çš„ç‰¹å¾ã€‚</p></li></ul><h5 id="æ•°æ®æ··åˆçš„å¥½å¤„"><a href="#æ•°æ®æ··åˆçš„å¥½å¤„" class="headerlink" title="æ•°æ®æ··åˆçš„å¥½å¤„"></a>æ•°æ®æ··åˆçš„å¥½å¤„</h5><ul><li><p><strong>æé«˜æ³›åŒ–èƒ½åŠ›</strong>ï¼šé€šè¿‡å¼•å…¥å¤šæ ·åŒ–çš„æ•°æ®æºï¼Œæ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°æ›´å…¨é¢çš„ç‰¹å¾ï¼Œæé«˜åœ¨æœªçŸ¥æ•°æ®ä¸Šçš„è¡¨ç°ã€‚</p></li><li><p><strong>å‡å°‘è¿‡æ‹Ÿåˆ</strong>ï¼šå¤šæ ·åŒ–çš„æ•°æ®èƒ½æœ‰æ•ˆç¼“è§£æ¨¡å‹åœ¨ç‰¹å®šæ•°æ®é›†ä¸Šè¿‡æ‹Ÿåˆçš„é£é™©ã€‚</p></li><li><p><strong>ä¼˜åŒ–è¿ç§»å­¦ä¹ æ•ˆæœ</strong>ï¼šæ¨¡å‹å¯ä»¥æ›´å¥½åœ°å°†å­¦åˆ°çš„çŸ¥è¯†åº”ç”¨åˆ°æ–°ä»»åŠ¡ä¸­ï¼Œæå‡è¿ç§»å­¦ä¹ çš„æ•ˆæœã€‚</p></li></ul><h4 id="2-æ•°æ®é…æ¯”"><a href="#2-æ•°æ®é…æ¯”" class="headerlink" title="2. æ•°æ®é…æ¯”"></a>2. æ•°æ®é…æ¯”</h4><p>æ•°æ®é…æ¯”æ˜¯æŒ‡åœ¨è¿›è¡ŒäºŒæ¬¡é¢„è®­ç»ƒæ—¶ï¼Œå„ç±»æ•°æ®çš„æ¯”ä¾‹åˆ†é…ã€‚åˆç†çš„æ•°æ®é…æ¯”æ˜¯ç¡®ä¿æ¨¡å‹æ€§èƒ½çš„é‡è¦å› ç´ ã€‚æ•°æ®é…æ¯”é€šå¸¸è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li><p><strong>é¢„è®­ç»ƒæ•°æ® vs. é¢†åŸŸç‰¹å®šæ•°æ®</strong>ï¼šå¦‚æœé¢†åŸŸç‰¹å®šæ•°æ®ç›¸å¯¹è¾ƒå°ï¼Œå¯ä»¥å¢åŠ é¢„è®­ç»ƒæ•°æ®çš„æ¯”ä¾‹ï¼Œä»¥ç¡®ä¿æ¨¡å‹ä»èƒ½è·å¾—ä¸°å¯Œçš„è¯­è¨€çŸ¥è¯†ã€‚ç›¸åï¼Œå¦‚æœé¢†åŸŸç‰¹å®šæ•°æ®è´¨é‡é«˜ä¸”æ¶µç›–ç›®æ ‡ä»»åŠ¡çš„é‡è¦ç‰¹å¾ï¼Œå¯ä»¥é€‚å½“å¢åŠ è¯¥ç±»æ•°æ®çš„æ¯”é‡ã€‚</p></li><li><p><strong>åŸå§‹æ•°æ® vs. å¢å¼ºæ•°æ®</strong>ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼ŒåŸå§‹æ•°æ®èƒ½æä¾›æ›´çœŸå®çš„æ ·æœ¬ï¼Œè€Œå¢å¼ºæ•°æ®å¯ä»¥æ‰©å±•è®­ç»ƒé›†ã€‚æ•°æ®é…æ¯”çš„é€‰æ‹©ä¾èµ–äºå¢å¼ºæ•°æ®çš„è´¨é‡å’Œå¤šæ ·æ€§ï¼Œå¦‚æœå¢å¼ºæ•°æ®èƒ½æœ‰æ•ˆæå‡æ¨¡å‹æ€§èƒ½ï¼Œå¯ä»¥é€‚å½“å¢åŠ å…¶æ¯”é‡ã€‚</p></li><li><p><strong>æ­£è´Ÿæ ·æœ¬æ¯”ä¾‹</strong>ï¼šåœ¨æŸäº›ç‰¹å®šä»»åŠ¡ä¸­ï¼ˆå¦‚åˆ†ç±»ï¼‰ï¼Œæ­£è´Ÿæ ·æœ¬çš„æ¯”ä¾‹éœ€è¦ä»”ç»†è°ƒæ•´ï¼Œä»¥é¿å…æ¨¡å‹åå‘äºæŸä¸€ç±»ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸å¹³è¡¡æ•°æ®é›†ä¸Šï¼Œå¯èƒ½éœ€è¦å¢åŠ è´Ÿæ ·æœ¬çš„æ¯”ä¾‹ï¼Œä»¥ç¡®ä¿æ¨¡å‹èƒ½å¤Ÿè¯†åˆ«å°‘æ•°ç±»ã€‚</p></li></ul><h5 id="é…æ¯”ç­–ç•¥ç¤ºä¾‹"><a href="#é…æ¯”ç­–ç•¥ç¤ºä¾‹" class="headerlink" title="é…æ¯”ç­–ç•¥ç¤ºä¾‹"></a>é…æ¯”ç­–ç•¥ç¤ºä¾‹</h5><ul><li><p><strong>1:1 é…æ¯”</strong>ï¼šé¢„è®­ç»ƒæ•°æ®å’Œé¢†åŸŸç‰¹å®šæ•°æ®å„å ä¸€åŠï¼Œé€‚ç”¨äºé¢†åŸŸç‰¹å®šæ•°æ®ä¸°å¯Œçš„æƒ…å†µã€‚</p></li><li><p><strong>7:3 é…æ¯”</strong>ï¼šé¢„è®­ç»ƒæ•°æ®å æ¯”é«˜ï¼Œé€‚ç”¨äºé¢†åŸŸç‰¹å®šæ•°æ®ç¨€ç¼ºä½†å¸Œæœ›ä¿æŒæ¨¡å‹é€šç”¨æ€§çš„æƒ…å†µã€‚</p></li><li><p><strong>2:1:1 é…æ¯”</strong>ï¼šåœ¨æœ‰ä¸°å¯ŒåŸå§‹æ•°æ®å’Œå¢å¼ºæ•°æ®çš„æƒ…å†µä¸‹ï¼ŒåŸå§‹æ•°æ®å 2ï¼Œå¢å¼ºæ•°æ®å’Œé¢†åŸŸç‰¹å®šæ•°æ®å„å 1ï¼Œä»¥æ­¤ç¡®ä¿æ¨¡å‹åœ¨æ³›åŒ–èƒ½åŠ›ä¸é¢†åŸŸçŸ¥è¯†ä¹‹é—´è¾¾åˆ°å¹³è¡¡ã€‚</p></li></ul><h4 id="3-ç»“è®º"><a href="#3-ç»“è®º" class="headerlink" title="3. ç»“è®º"></a>3. ç»“è®º</h4><p>é€šç”¨æ•°æ®æ··åˆä¸æ•°æ®é…æ¯”åœ¨äºŒæ¬¡é¢„è®­ç»ƒè¿‡ç¨‹ä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚é€šè¿‡åˆç†çš„æ•°æ®é€‰æ‹©å’Œæ¯”ä¾‹é…ç½®ï¼Œå¯ä»¥æœ‰æ•ˆæå‡æ¨¡å‹çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ç‰¹å®šä»»åŠ¡æˆ–é¢†åŸŸçš„åº”ç”¨æ—¶ã€‚é€‰æ‹©åˆé€‚çš„æ··åˆç­–ç•¥å’Œé…æ¯”éœ€è¦æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯è¿›è¡Œå®éªŒå’Œè°ƒæ•´ï¼Œä»¥è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚</p><hr>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤§æ¨¡å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>73 Redisson</title>
      <link href="/2025/02/26/75-07%20Redisson/"/>
      <url>/2025/02/26/75-07%20Redisson/</url>
      
        <content type="html"><![CDATA[<h1 id="73-Redisson"><a href="#73-Redisson" class="headerlink" title="73 Redisson"></a>73 Redisson</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¦‚æœä½ ä¹‹å‰æ˜¯åœ¨ç”¨ Redis çš„è¯ï¼Œé‚£ä½¿ç”¨ Redisson çš„è¯å°†ä¼šäº‹åŠåŠŸå€ï¼ŒRedisson æä¾›äº†ä½¿ç”¨ Redisçš„æœ€ç®€å•å’Œæœ€ä¾¿æ·çš„æ–¹æ³•ã€‚</p><p>Redissonçš„å®—æ—¨æ˜¯ä¿ƒè¿›ä½¿ç”¨è€…å¯¹ Redis çš„å…³æ³¨åˆ†ç¦»ï¼ˆSeparation of Concernï¼‰ï¼Œä»è€Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿå°†ç²¾åŠ›æ›´é›†ä¸­åœ°æ”¾åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šã€‚</p><p>Redisson æ˜¯ä¸€ä¸ªåœ¨ Redis çš„åŸºç¡€ä¸Šå®ç°çš„ <strong>Java é©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰</strong>ã€‚</p><ul><li><strong>Netty æ¡†æ¶</strong>ï¼šRedissoné‡‡ç”¨äº†åŸºäºNIOçš„Nettyæ¡†æ¶ï¼Œä¸ä»…èƒ½ä½œä¸ºRedisåº•å±‚é©±åŠ¨å®¢æˆ·ç«¯ï¼Œå…·å¤‡æä¾›å¯¹Rediså„ç§ç»„æ€å½¢å¼çš„è¿æ¥åŠŸèƒ½ï¼Œå¯¹Rediså‘½ä»¤èƒ½ä»¥åŒæ­¥å‘é€ã€å¼‚æ­¥å½¢å¼å‘é€ã€å¼‚æ­¥æµå½¢å¼å‘é€æˆ–ç®¡é“å½¢å¼å‘é€çš„åŠŸèƒ½ï¼ŒLUAè„šæœ¬æ‰§è¡Œå¤„ç†ï¼Œä»¥åŠå¤„ç†è¿”å›ç»“æœçš„åŠŸèƒ½</li><li><strong>åŸºç¡€æ•°æ®ç»“æ„</strong>ï¼šå°†åŸç”Ÿçš„Redis Hashï¼ŒListï¼ŒSetï¼ŒStringï¼ŒGeoï¼ŒHyperLogLogç­‰æ•°æ®ç»“æ„å°è£…ä¸ºJavaé‡Œå¤§å®¶æœ€ç†Ÿæ‚‰çš„æ˜ å°„ï¼ˆMapï¼‰ï¼Œåˆ—è¡¨ï¼ˆListï¼‰ï¼Œé›†ï¼ˆSetï¼‰ï¼Œé€šç”¨å¯¹è±¡æ¡¶ï¼ˆObject Bucketï¼‰ï¼Œåœ°ç†ç©ºé—´å¯¹è±¡æ¡¶ï¼ˆGeospatial Bucketï¼‰ï¼ŒåŸºæ•°ä¼°è®¡ç®—æ³•ï¼ˆHyperLogLogï¼‰ç­‰ç»“æ„ï¼Œ</li><li><strong>åˆ†å¸ƒå¼æ•°æ®ç»“æ„</strong>ï¼šè¿™åŸºç¡€ä¸Šè¿˜æä¾›äº†åˆ†å¸ƒå¼çš„å¤šå€¼æ˜ å°„ï¼ˆMultimapï¼‰ï¼Œæœ¬åœ°ç¼“å­˜æ˜ å°„ï¼ˆLocalCachedMapï¼‰ï¼Œæœ‰åºé›†ï¼ˆSortedSetï¼‰ï¼Œè®¡åˆ†æ’åºé›†ï¼ˆScoredSortedSetï¼‰ï¼Œå­—å…¸æ’åºé›†ï¼ˆLexSortedSetï¼‰ï¼Œåˆ—é˜Ÿï¼ˆQueueï¼‰ï¼Œé˜»å¡é˜Ÿåˆ—ï¼ˆBlocking Queueï¼‰ï¼Œæœ‰ç•Œé˜»å¡åˆ—é˜Ÿï¼ˆBounded Blocking Queueï¼‰ï¼ŒåŒç«¯é˜Ÿåˆ—ï¼ˆDequeï¼‰ï¼Œé˜»å¡åŒç«¯åˆ—é˜Ÿï¼ˆBlocking Dequeï¼‰ï¼Œé˜»å¡å…¬å¹³åˆ—é˜Ÿï¼ˆBlocking Fair Queueï¼‰ï¼Œå»¶è¿Ÿåˆ—é˜Ÿï¼ˆDelayed Queueï¼‰ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰ï¼ŒåŸå­æ•´é•¿å½¢ï¼ˆAtomicLongï¼‰ï¼ŒåŸå­åŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆAtomicDoubleï¼‰ï¼ŒBitSetç­‰RedisåŸæœ¬æ²¡æœ‰çš„åˆ†å¸ƒå¼æ•°æ®ç»“æ„ã€‚</li><li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šRedissonè¿˜å®ç°äº†Redisæ–‡æ¡£ä¸­æåˆ°åƒåˆ†å¸ƒå¼é”Lockè¿™æ ·çš„æ›´é«˜é˜¶åº”ç”¨åœºæ™¯ã€‚äº‹å®ä¸ŠRedissonå¹¶æ²¡æœ‰ä¸æ­¢æ­¥äºæ­¤ï¼Œåœ¨åˆ†å¸ƒå¼é”çš„åŸºç¡€ä¸Šè¿˜æä¾›äº†è”é”ï¼ˆMultiLockï¼‰ï¼Œè¯»å†™é”ï¼ˆReadWriteLockï¼‰ï¼Œå…¬å¹³é”ï¼ˆFair Lockï¼‰ï¼Œçº¢é”ï¼ˆRedLockï¼‰ï¼Œä¿¡å·é‡ï¼ˆSemaphoreï¼‰ï¼Œå¯è¿‡æœŸæ€§ä¿¡å·é‡ï¼ˆPermitExpirableSemaphoreï¼‰å’Œé—­é”ï¼ˆCountDownLatchï¼‰è¿™äº›å®é™…å½“ä¸­å¯¹å¤šçº¿ç¨‹é«˜å¹¶å‘åº”ç”¨è‡³å…³é‡è¦çš„åŸºæœ¬éƒ¨ä»¶ã€‚æ­£æ˜¯é€šè¿‡å®ç°åŸºäºRedisçš„é«˜é˜¶åº”ç”¨æ–¹æ¡ˆï¼Œä½¿Redissonæˆä¸ºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„é‡è¦å·¥å…·ã€‚</li></ul><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="ä»€ä¹ˆæ˜¯Redissonï¼Œå®ƒä¸Redisæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Redissonï¼Œå®ƒä¸Redisæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Redissonï¼Œå®ƒä¸Redisæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Redissonï¼Œå®ƒä¸Redisæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><p>æœ‰å‡ ä¸ªå…³é”®è¯ï¼š<strong>åŸºäºRediså¼€å‘çš„å®¢æˆ·ç«¯</strong>ï¼Œ<strong>æ–¹ä¾¿ä¸šåŠ¡äººå‘˜åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹å¼€å‘</strong>ï¼Œ<strong>æä¾›äº†åˆ†å¸ƒå¼æ•°æ®ç»“æ„å’Œå·¥å…·</strong>ï¼Œæ•°æ®åŒæ­¥ï¼Œæ•°æ®å…±äº«ï¼Œæ”¯æŒRedisçš„é«˜å¯ç”¨ã€‚</p><p>ç­”ï¼šRedissonæ˜¯åŸºäºRedisçš„å®¢æˆ·ç«¯ï¼Œå®ƒå¯¹Redisè¿›è¡Œäº†å°è£…ï¼Œæ–¹ä¾¿ä¸šåŠ¡äººå‘˜åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¯¹Redisè¿›è¡Œæ“ä½œï¼Œä¸ºäº†å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ“ä½œï¼Œå®ƒè¿˜æä¾›äº†åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é›†åˆç­‰åˆ†å¸ƒå¼æ•°æ®ç»“æ„å’Œå·¥å…·ï¼Œè¿™äº›éƒ½å¯ä»¥è®©åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æœåŠ¡è¾¾åˆ°æ•°æ®å…±äº«å’Œæ•°æ®åŒæ­¥çš„ç›®çš„ã€‚åŒæ—¶ä¹Ÿæ”¯æŒRedisé›†ç¾¤çš„é«˜å¯ç”¨ï¼ˆå“¨å…µæ¨¡å¼ã€é›†ç¾¤æ¨¡å¼ï¼‰ï¼Œæ–¹ä¾¿ä¸šåŠ¡äººå‘˜å¿«é€Ÿçš„æ„å»ºRedisé›†ç¾¤ï¼Œå¹¶è‡ªåŠ¨çš„è¿›è¡Œè´Ÿè½½å‡è¡¡å’ŒèŠ‚ç‚¹æ•…éšœå¤„ç†ã€‚</p><h3 id="Redissonæä¾›äº†å“ªäº›åŠŸèƒ½ï¼Ÿ"><a href="#Redissonæä¾›äº†å“ªäº›åŠŸèƒ½ï¼Ÿ" class="headerlink" title="Redissonæä¾›äº†å“ªäº›åŠŸèƒ½ï¼Ÿ"></a>Redissonæä¾›äº†å“ªäº›åŠŸèƒ½ï¼Ÿ</h3><p>Redissonå°±æ˜¯ä¸ºäº†åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¸ºæœåŠ¡è¯»å–Redisä¸­çš„æ•°æ®è€Œè®¾ç½®çš„ï¼Œå› ä¸ºåœ¨å¤šä¸ªæœåŠ¡ä¸‹å¯èƒ½ä¼šå‡ºç°æ•°æ®ç«äº‰çš„é—®é¢˜ï¼Œæ‰€ä»¥Redissonæä¾›äº†åˆ†å¸ƒå¼é”çš„æ¦‚å¿µï¼Œè®©åŒä¸€æ—¶åˆ»åŒä¸€ç§æ–¹æ³•åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œæ‰€ä»¥æä¾›çš„ç¬¬ä¸€ä¸ªåŠŸèƒ½æ˜¯åˆ†å¸ƒå¼é”ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿å¼€å‘äººå‘˜å¯¹åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¯¹Redisæ•°æ®è¯»å–ï¼Œæä¾›äº†å¤§é‡çš„åˆ†å¸ƒå¼æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ï¼šRMapï¼ŒRSetç­‰ç­‰ã€‚</p><p>å¦‚æœä½ å…·æœ‰å¤šä¸ªRedisæœåŠ¡å™¨ï¼ŒRedissonè¿˜å¯ä»¥å¸®ä½ è‡ªåŠ¨çš„ç®¡ç†è¿™äº›åˆ†å¸ƒå¼Redisï¼Œå®ƒè‡ªå¸¦äº†è´Ÿè½½å‡è¡¡å’ŒèŠ‚ç‚¹æ•…éšœå¤„ç†ï¼Œå¯ä»¥æ–¹ä¾¿ä¸šåŠ¡äººå‘˜å¿«é€Ÿçš„æ„å»ºRedisé›†ç¾¤ã€‚</p><h3 id="Redissonæ˜¯å¦‚ä½•æ”¯æŒé«˜å¯ç”¨çš„ï¼Ÿ"><a href="#Redissonæ˜¯å¦‚ä½•æ”¯æŒé«˜å¯ç”¨çš„ï¼Ÿ" class="headerlink" title="Redissonæ˜¯å¦‚ä½•æ”¯æŒé«˜å¯ç”¨çš„ï¼Ÿ"></a>Redissonæ˜¯å¦‚ä½•æ”¯æŒé«˜å¯ç”¨çš„ï¼Ÿ</h3><p>é«˜å¯ç”¨æ˜¯é’ˆå¯¹å¤šä¸ªRedisæƒ…å†µä¸‹ï¼Œå¦‚ä½•ä¿è¯RedisæŸä¸ªèŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œæ•´ä¸ªæœåŠ¡ä¾æ—§æ­£å¸¸è¿è¡Œã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°ä¸€äº›å¾ˆå¸¸è§çš„é—®é¢˜ï¼Œå³åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ä¿è¯æ•´ä¸ªé›†ç¾¤çš„é«˜å¯ç”¨ã€‚è€ŒRedissonæ˜¯é‡‡ç”¨çš„ä»€ä¹ˆæ–¹æ³•å‘¢ï¼Ÿ</p><p>åœ¨å¤šä¸ªèŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— ééœ€è¦çŸ¥é“å½“å‰èŠ‚ç‚¹æ˜¯å¦å¯ç”¨ä»¥åŠå½“å‰èŠ‚ç‚¹æ•…éšœä¹‹ååº”è¯¥å°†æœåŠ¡è½¬å‘ç»™å“ªä¸ªèŠ‚ç‚¹ï¼Œå¦‚ä½•ä¿è¯å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¸Šé¢è¿™ä¸‰ä¸ªé—®é¢˜å°±æ˜¯æˆ‘ä»¬é‡ç‚¹éœ€è¦å…³æ³¨çš„é—®é¢˜ï¼Œé‚£æˆ‘ä»¬å¸¦ç€è¿™ä¸‰ä¸ªé—®é¢˜æ¥çœ‹çœ‹Redissonæ˜¯å¦‚ä½•è§£å†³çš„ã€‚</p><h4 id="å“¨å…µæ¨¡å¼"><a href="#å“¨å…µæ¨¡å¼" class="headerlink" title="å“¨å…µæ¨¡å¼"></a>å“¨å…µæ¨¡å¼</h4><p>å“¨å…µç®€å•çš„æ¥è¯´å°±æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡æ—¶åˆ»çš„ç›‘å¬RedisæœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œä¸€æ—¦è¯¥RedisæœåŠ¡ä¸æ­£å¸¸ï¼Œåˆ™éœ€è¦ç«‹å³æ›´æ”¹RedisæœåŠ¡ã€‚</p><p>å“¨å…µæ¨¡å¼é‡‡ç”¨äº†å¤šä¸ªRedisèŠ‚ç‚¹ï¼Œå®ƒä¼šé€‰æ‹©å…¶ä¸­ä¸€ä¸ªä½œä¸ºRedisçš„ä¸»èŠ‚ç‚¹ï¼Œå…¶å®ƒRedisèŠ‚ç‚¹ä¼šä½œä¸ºå­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¤‡èƒã€‚ä¸€æ—¦å“¨å…µå‘ç°è¯¥ä¸»èŠ‚ç‚¹Masterå‘ç”Ÿæ•…éšœï¼Œå“¨å…µå°±ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæ–°çš„Masterï¼Œç„¶åé€šè¿‡å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼å‘ŠçŸ¥å…¶å®ƒå­èŠ‚ç‚¹ä¿®æ”¹é…ç½®ï¼ˆæ–°çš„MasterèŠ‚ç‚¹å˜æ›´ï¼‰ã€‚</p><p>ä½†æ˜¯å“¨å…µå¦‚æœåªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹Ÿæ˜¯å­˜åœ¨æ•´ä¸ªæœåŠ¡å®•æœºçš„å±é™©ï¼Œæ‰€ä»¥å“¨å…µä¹Ÿå¾—å¤šå¤šçš„ï¼Œè¶Šå¤šè¶Šå®‰å…¨ï¼Œé¸¡è›‹ä¸èƒ½æ”¾åœ¨ä¸€ä¸ªç¬¼å­é‡Œå˜›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262036354.png" alt="image-20241016195226854"></p><p>åœ¨è¿™é‡Œè¦æ·±æŒ–çš„ç‚¹å¤ªå¤šäº†ï¼Œæ¯”å¦‚ï¼šå“¨å…µæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå¦‚æœä¸»èŠ‚ç‚¹æ•…éšœï¼Œå“¨å…µæ˜¯å¦‚ä½•é€‰å–æ–°çš„ä¸»èŠ‚ç‚¹ï¼Ÿå“¨å…µé›†ç¾¤æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿå¦‚ä½•ä¿è¯Redisé›†ç¾¤çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿå“¨å…µé€šè¿‡å‘å¸ƒ-è®¢é˜…æ¨¡å‹é€šçŸ¥å…¶å®ƒå­èŠ‚ç‚¹ï¼Œå®ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p><p>åœ¨å¾ˆå¤šæ—¶å€™è¦çŸ¥å…¶ç„¶æ›´è¦çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œä¸‹é¢å°†ä¼šè¯¦ç»†çš„ä»‹ç»ã€‚</p><h5 id="å“¨å…µæ˜¯å¦‚ä½•å®ç°çš„"><a href="#å“¨å…µæ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="å“¨å…µæ˜¯å¦‚ä½•å®ç°çš„"></a>å“¨å…µæ˜¯å¦‚ä½•å®ç°çš„</h5><p>å“¨å…µå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œå“¨å…µé›†ç¾¤å°±æ˜¯ä¸€ç»„è¿›ç¨‹ï¼Œè¿™ç»„è¿›ç¨‹å°±å¹²å‡ ä»¶äº‹ï¼šæ—¶ä¸æ—¶çš„æ£€æŸ¥ä¸€ä¸‹RedisèŠ‚ç‚¹æ˜¯å¦è¿˜æ´»ç€ã€é€‰å–æ–°çš„Redisä¸»èŠ‚ç‚¹ï¼Œé€šçŸ¥å…¶å®ƒå“¨å…µä¸»èŠ‚ç‚¹æ•…éšœå¤§å®¶ä¸€èµ·æ¥é€‰æ–°çš„ä¸»èŠ‚ç‚¹ã€‚</p><p>å“¨å…µæ¯éš”ä¸€å®šæ—¶é—´ä¼šä¸»åŠ¨æ‰§è¡Œå¿ƒè·³æ£€æµ‹ï¼Œä¸€æ—¦ä¸»èŠ‚ç‚¹å“åº”è¶…æ—¶æˆ–æ–­å¼€ï¼Œå“¨å…µå°†å…¶æ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ã€‚å¦‚æœå¤šä¸ªå“¨å…µå…±åŒæ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹æ•…éšœï¼ˆè¾¾åˆ°<code>quorum</code>ï¼‰ï¼Œè¯¥ä¸»èŠ‚ç‚¹å°†è¢«æ ‡è®°ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ï¼Œè¿™ä¼šè§¦å‘æ•…éšœè½¬ç§»ã€‚</p><p>å½“sentinel å“¨å…µèŠ‚ç‚¹å°† master æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿åï¼Œä¼šå‘å…¶ä½™æ‰€æœ‰çš„ sentinel å‘é€sentinel is-master-down-by-addræ¶ˆæ¯ï¼Œè¯¢é—®å…¶ä»–sentinelæ˜¯å¦åŒæ„è¯¥masterä¸‹çº¿ã€‚</p><p>æ¯ä¸ªsentinelæ”¶åˆ°å‘½ä»¤ä¹‹åï¼Œä¼šæ ¹æ®å‘é€è¿‡æ¥çš„ ipå’Œport æ£€æŸ¥è‡ªå·±åˆ¤æ–­çš„ç»“æœï¼Œå›å¤è‡ªå·±æ˜¯å¦è®¤ä¸ºè¯¥masterèŠ‚ç‚¹å·²ç»ä¸‹çº¿äº†ã€‚</p><p>sentinelæ”¶åˆ°å›å¤ä¹‹åï¼Œå¦‚æœåŒæ„masterèŠ‚ç‚¹è¿›å…¥ä¸»è§‚ä¸‹çº¿çš„sentinelæ•°é‡å¤§äºç­‰äºquorumï¼Œåˆ™masterä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼Œå³è®¤ä¸ºè¯¥èŠ‚ç‚¹å·²ç»ä¸å¯ç”¨ã€‚</p><p>è¿™å°±æ˜¯å“¨å…µå•¦ã€‚</p><h5 id="å¦‚æœä¸»èŠ‚ç‚¹æ•…éšœï¼Œå“¨å…µæ˜¯å¦‚ä½•é€‰å–æ–°çš„èŠ‚ç‚¹å‘¢ï¼Ÿ"><a href="#å¦‚æœä¸»èŠ‚ç‚¹æ•…éšœï¼Œå“¨å…µæ˜¯å¦‚ä½•é€‰å–æ–°çš„èŠ‚ç‚¹å‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœä¸»èŠ‚ç‚¹æ•…éšœï¼Œå“¨å…µæ˜¯å¦‚ä½•é€‰å–æ–°çš„èŠ‚ç‚¹å‘¢ï¼Ÿ"></a>å¦‚æœä¸»èŠ‚ç‚¹æ•…éšœï¼Œå“¨å…µæ˜¯å¦‚ä½•é€‰å–æ–°çš„èŠ‚ç‚¹å‘¢ï¼Ÿ</h5><p>ç°åœ¨å“¨å…µæ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹å­˜åœ¨æ•…éšœï¼Œéœ€è¦é©¬ä¸Šè½¬ç§»ä¸»èŠ‚ç‚¹ï¼Œæ¥ä¸‹æ¥è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å“¨å…µç°åœ¨å¾ˆå¤šå‘€ï¼Œè°æ¥ä¸»æŒè¿™ä¸ªé€‰å–æ–°çš„ä¸»èŠ‚ç‚¹ä¸€äº‹å‘¢ï¼Ÿè¿™å¯æ˜¯åœ¨ç¨‹åºä¸–ç•Œï¼Œæ€»è¦æœ‰ä¸€ä¸ªç¨‹åºå»åšè¿™ä»¶äº‹ã€‚åœ¨é€‰å–æ–°çš„ä¸»èŠ‚ç‚¹ä¹‹å‰ï¼Œéœ€è¦å…ˆæŠŠå“¨å…µçš„ä¸´æ—¶è¯äº‹äººç»™é€‰å‡ºæ¥ã€‚æ€ä¹ˆé€‰ï¼Ÿè°å¹²ï¼Ÿ</p><p>è¿™é‡Œå°±åˆåˆåˆåˆæ¥äº†ä¸€ä¸ªé€‰ä¸¾ç®—æ³•ï¼Œç§°ä¸ºRaftç®—æ³•ï¼Œå®ƒå…·ä½“æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p><p>ç®€å•ä¸€å¥è¯ï¼Œè¯¶ï¼Œè°æœ€æ—©å‘ç°è¿™ä¸ªä¸»èŠ‚ç‚¹æ•…éšœï¼Œè°å°±å¹²è¿™ä¸ªè„æ´»ï¼Œè¯ç³™ç†ä¸ç³™ã€‚</p><ol><li>åˆ¤æ–­å®¢è§‚ä¸‹çº¿çš„sentinelèŠ‚ç‚¹å‘å…¶ä»– sentinel èŠ‚ç‚¹å‘é€ SENTINEL is-master-down-by-addr ip port current_epoch runid</li></ol><blockquote><p>æ³¨æ„ï¼šè¿™æ—¶çš„runidæ˜¯è‡ªå·±çš„run idï¼Œæ¯ä¸ªsentinelèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±è¿è¡Œæ—¶id</p></blockquote><ol start="2"><li>ç›®æ ‡sentinelå›å¤æ˜¯å¦åŒæ„masterä¸‹çº¿å¹¶é€‰ä¸¾é¢†å¤´sentinelï¼Œé€‰æ‹©é¢†å¤´sentinelçš„è¿‡ç¨‹ç¬¦åˆå…ˆåˆ°å…ˆå¾—çš„åŸåˆ™ã€‚ä¸¾ä¾‹ï¼šsentinel1åˆ¤æ–­äº†å®¢è§‚ä¸‹çº¿ï¼Œå‘sentinel2å‘é€äº†ç¬¬ä¸€æ­¥ä¸­çš„å‘½ä»¤ï¼Œsentinel2å›å¤äº†sentinel1ï¼Œè¯´é€‰ä½ ä¸ºé¢†å¤´ï¼Œè¿™æ—¶å€™sentinel3ä¹Ÿå‘sentinel2å‘é€ç¬¬ä¸€æ­¥çš„å‘½ä»¤ï¼Œsentinel2ä¼šç›´æ¥æ‹’ç»å›å¤ï¼›</li><li>å½“sentinelå‘ç°é€‰è‡ªå·±çš„èŠ‚ç‚¹ä¸ªæ•°è¶…è¿‡ majority çš„ä¸ªæ•°çš„æ—¶å€™ï¼Œè‡ªå·±å°±æ˜¯é¢†å¤´èŠ‚ç‚¹ï¼›</li><li>å¦‚æœæ²¡æœ‰ä¸€ä¸ªsentinelè¾¾åˆ°äº†majorityçš„æ•°é‡ï¼Œç­‰ä¸€æ®µæ—¶é—´ï¼Œé‡æ–°é€‰ä¸¾ï¼›</li></ol><p>é€‰å®Œå¹²è„æ´»çš„å“¨å…µåï¼Œå°±è¦å¼€å§‹æ¢ä¸»èŠ‚ç‚¹äº†ï¼Œå¦‚ä½•é€‰å–æ–°çš„ä¸»èŠ‚ç‚¹å‘¢ï¼Ÿ</p><p>Redisé›†ç¾¤å¹¶ä¸éœ€è¦ä¿è¯æ•°æ®å¼ºä¸€è‡´æ€§ï¼Œæ‰€ä»¥åªéœ€è¦é€‰å–è·Ÿä¸»èŠ‚ç‚¹æœ€ç›¸ä¼¼çš„å­èŠ‚ç‚¹ä½œä¸ºä¸»èŠ‚ç‚¹å³å¯ï¼Œä¹Ÿå°±æ•°æ®å¤åˆ¶åç§»é‡æœ€å°‘çš„å­èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¼˜å…ˆçº§è¶Šé«˜çš„è¶Šå¯èƒ½è¢«è®¾ä¸ºä¸»èŠ‚ç‚¹ã€‚</p><p>åœ¨é€‰æ‹©çš„æ—¶å€™ä¹Ÿä¼šæŠŠé‚£äº›å¯èƒ½å‡ºç°æ•…éšœçš„å­èŠ‚ç‚¹æ’é™¤å€™é€‰äººä¹‹åˆ—ã€‚</p><p>é€‰å‡ºä¸»èŠ‚ç‚¹ä¹‹åï¼Œå°±éœ€è¦è¿›è¡Œæƒåˆ©äº¤æ¥å’¯ã€‚ä¿®æ”¹é…ç½®äº†ã€‚å‘ŠçŸ¥å…¶å®ƒæ‰€æœ‰å“¨å…µå’Œå­èŠ‚ç‚¹ï¼Œè¿™ä½å°±æ˜¯æˆ‘ä»¬æ–°çš„ä¸»èŠ‚ç‚¹å•¦ï¼Œè¦è¯»å°±è¯»å®ƒï¼Œç›‘æ§å®ƒ</p><h5 id="å¦‚ä½•ä¿è¯Redisé›†ç¾¤çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"><a href="#å¦‚ä½•ä¿è¯Redisé›†ç¾¤çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿è¯Redisé›†ç¾¤çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"></a>å¦‚ä½•ä¿è¯Redisé›†ç¾¤çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</h5><p>Redis å“¨å…µæ¨¡å¼ä¸‹çš„æ•°æ®ä¸€è‡´æ€§ä¸»è¦é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°ï¼š</p><ul><li><strong>ä¸»ä»å¤åˆ¶</strong>ï¼šä»èŠ‚ç‚¹ä»ä¸»èŠ‚ç‚¹å®æ—¶å¤åˆ¶æ•°æ®ã€‚åœ¨ä¸»èŠ‚ç‚¹æ•…éšœå¹¶åˆ‡æ¢åˆ°ä»èŠ‚ç‚¹ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹æ—¶ï¼Œæ‰€æœ‰å†™æ“ä½œå°†ä»æ–°ä¸»èŠ‚ç‚¹å¤„ç†ã€‚</li><li><strong>æ•…éšœè½¬ç§»è¿‡ç¨‹ä¸­çš„æ•°æ®ä¿æŠ¤</strong>ï¼šåœ¨é€‰ä¸¾æ–°ä¸»èŠ‚ç‚¹ä¹‹å‰ï¼Œå“¨å…µä¼šç¡®ä¿æ—§ä¸»èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯å¯é çš„ï¼Œå¹¶ä¸”åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­ç¡®ä¿ä¸ä¼šæœ‰å†™æ“ä½œå¯¹æ—§ä¸»èŠ‚ç‚¹è¿›è¡Œä¿®æ”¹ã€‚</li></ul><h5 id="å“¨å…µé€šè¿‡å‘å¸ƒ-è®¢é˜…æ¨¡å‹é€šçŸ¥å…¶å®ƒå­èŠ‚ç‚¹"><a href="#å“¨å…µé€šè¿‡å‘å¸ƒ-è®¢é˜…æ¨¡å‹é€šçŸ¥å…¶å®ƒå­èŠ‚ç‚¹" class="headerlink" title="å“¨å…µé€šè¿‡å‘å¸ƒ-è®¢é˜…æ¨¡å‹é€šçŸ¥å…¶å®ƒå­èŠ‚ç‚¹"></a>å“¨å…µé€šè¿‡å‘å¸ƒ-è®¢é˜…æ¨¡å‹é€šçŸ¥å…¶å®ƒå­èŠ‚ç‚¹</h5><p>Redis å“¨å…µä½¿ç”¨ <strong>å‘å¸ƒ-è®¢é˜…æ¨¡å‹</strong>ï¼ˆPub&#x2F;Subï¼‰è¿›è¡Œé€šçŸ¥ï¼Œä¸»è¦é€šè¿‡ä»¥ä¸‹æœºåˆ¶ï¼š</p><ul><li><strong>ç›‘æ§çŠ¶æ€å˜åŒ–</strong>ï¼šæ¯ä¸ªå“¨å…µä¼šç›‘æ§ä¸»ä»èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¹¶åœ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶é€šè¿‡å‘å¸ƒ-è®¢é˜…æ¨¡å‹å°†å˜åŒ–ä¿¡æ¯å‘é€ç»™å…¶ä»–å“¨å…µå’Œå®¢æˆ·ç«¯ã€‚</li><li><strong><code>SENTINEL MONITOR</code> å‘½ä»¤</strong>ï¼šå“¨å…µä¼šè®¢é˜…è‡ªå·±ç›‘æ§çš„èŠ‚ç‚¹çŠ¶æ€ã€‚å½“ä¸»èŠ‚ç‚¹çŠ¶æ€å˜åŒ–æ—¶ï¼Œå“¨å…µä¼šå‘å¸ƒç›¸å…³äº‹ä»¶ï¼Œä¾‹å¦‚èŠ‚ç‚¹ä¸‹çº¿ã€æå‡æ–°ä¸»èŠ‚ç‚¹ç­‰ã€‚</li></ul><h4 id="ä¸»ä»å¤åˆ¶æ¨¡å¼ï¼ˆMaster-Slave-Modeï¼‰"><a href="#ä¸»ä»å¤åˆ¶æ¨¡å¼ï¼ˆMaster-Slave-Modeï¼‰" class="headerlink" title="ä¸»ä»å¤åˆ¶æ¨¡å¼ï¼ˆMaster-Slave Modeï¼‰"></a>ä¸»ä»å¤åˆ¶æ¨¡å¼ï¼ˆMaster-Slave Modeï¼‰</h4><p>ä»€ä¹ˆæ˜¯ä¸»ä»èµ‹å€¼æ¨¡å¼ï¼Œçœ‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262036717.png" alt="image-20241016211008999"></p><p>å•Šï¼Œè¿™ä¸æ˜¯å“¨å…µæ¨¡å¼å—ï¼Ÿæ˜¯çš„ï¼ŒæŠŠå“¨å…µå»æ‰ï¼Œè¯¶ï¼Œè¿™å°±æ˜¯ä¸»ä»å¤åˆ¶æ¨¡å¼ã€‚</p><p>åœ¨ä¸»ä»æ¨¡å¼ä¸‹ï¼ˆä¸»ä»æ¨¡å¼å°±æ˜¯æŠŠä¸Šå›¾çš„æ‰€æœ‰å“¨å…µå»æ‰ï¼‰ï¼ŒmasterèŠ‚ç‚¹è´Ÿè´£å†™è¯·æ±‚ï¼Œç„¶åå¼‚æ­¥åŒæ­¥ç»™slaveèŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹è´Ÿè´£å¤„ç†è¯»è¯·æ±‚ã€‚å¦‚æœmasterå®•æœºäº†ï¼Œéœ€è¦æ‰‹åŠ¨å°†ä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿˜è¦åˆ‡æ¢å®¢æˆ·ç«¯çš„è¿æ¥æ•°æ®æºã€‚è¿™å°±æ— æ³•è¾¾åˆ°é«˜å¯ç”¨ï¼Œè€Œé€šè¿‡å“¨å…µæ¨¡å¼å°±å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p><p>è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»å•¦ã€‚</p><h4 id="è´Ÿè½½å‡è¡¡æœºåˆ¶"><a href="#è´Ÿè½½å‡è¡¡æœºåˆ¶" class="headerlink" title="è´Ÿè½½å‡è¡¡æœºåˆ¶"></a>è´Ÿè½½å‡è¡¡æœºåˆ¶</h4><p><strong>è‡ªåŠ¨è·¯ç”±</strong>ï¼š</p><ul><li>Redisson ä¼šæ ¹æ® Redis å“¨å…µæä¾›çš„ä¿¡æ¯è‡ªåŠ¨è·å–é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ï¼ˆåŒ…æ‹¬ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ï¼‰ã€‚å½“å‘èµ·è¯·æ±‚æ—¶ï¼ŒRedisson ä¼šå°†è¯·æ±‚è·¯ç”±åˆ°åˆé€‚çš„ä¸»èŠ‚ç‚¹ï¼ˆå†™æ“ä½œï¼‰æˆ–ä»èŠ‚ç‚¹ï¼ˆè¯»æ“ä½œï¼‰ã€‚</li><li>å¦‚æœä½ é…ç½®äº†å¤šä¸»ä»ç»“æ„ï¼ŒRedisson å¯ä»¥å¹³è¡¡è¯·æ±‚åˆ°ä¸åŒçš„ä»èŠ‚ç‚¹ï¼Œä»è€Œå®ç°è¯»æ“ä½œçš„è´Ÿè½½å‡è¡¡ã€‚</li></ul><p><strong>è½®è¯¢ä¸éšæœºç­–ç•¥</strong>ï¼š</p><ul><li>Redisson å†…ç½®äº†å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¯ä»¥åœ¨å¤šä¸ª Redis èŠ‚ç‚¹ä¹‹é—´åˆ†é…è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨è½®è¯¢æˆ–éšæœºç­–ç•¥å‡åŒ€åˆ†é…è¯·æ±‚ï¼Œä»è€Œæœ‰æ•ˆåˆ©ç”¨å„ä¸ªèŠ‚ç‚¹çš„èµ„æºã€‚</li></ul><h2 id="åˆ†å¸ƒå¼é”ç›¸å…³é—®é¢˜"><a href="#åˆ†å¸ƒå¼é”ç›¸å…³é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼é”ç›¸å…³é—®é¢˜"></a>åˆ†å¸ƒå¼é”ç›¸å…³é—®é¢˜</h2><h3 id="å¦‚ä½•ä½¿ç”¨Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Ÿè¯·ç®€å•æè¿°å®ç°æ­¥éª¤"><a href="#å¦‚ä½•ä½¿ç”¨Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Ÿè¯·ç®€å•æè¿°å®ç°æ­¥éª¤" class="headerlink" title="å¦‚ä½•ä½¿ç”¨Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Ÿè¯·ç®€å•æè¿°å®ç°æ­¥éª¤"></a>å¦‚ä½•ä½¿ç”¨Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Ÿè¯·ç®€å•æè¿°å®ç°æ­¥éª¤</h3><ul><li>æ·»åŠ Redissonä¾èµ–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>é…ç½®Redisson</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">redisson:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">singleServerConfig:</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">&quot;redis://127.0.0.1:6379&quot;</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">&quot;your_password&quot;</span></span><br><span class="line">    <span class="attr">sentinelServersConfig:</span></span><br><span class="line">      <span class="attr">masterName:</span> <span class="string">&quot;mymaster&quot;</span></span><br><span class="line">      <span class="attr">sentinelAddresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;redis://127.0.0.1:26379&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;redis://127.0.0.1:26380&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºRedissonå®¢æˆ·ç«¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.redisson.api.RedissonClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistributedLockService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeTask</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–é”</span></span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;myLock&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åŠ é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å°è¯•åŠ é”ï¼Œæœ€å¤šç­‰å¾… 10 ç§’ï¼Œé”å®šæ—¶é—´ 30 ç§’</span></span><br><span class="line">            <span class="keyword">if</span> (lock.tryLock(<span class="number">10</span>, <span class="number">30</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œéœ€è¦é”å®šçš„æ“ä½œ</span></span><br><span class="line">                    performCriticalTask();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// è§£é”</span></span><br><span class="line">                    lock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// é”æœªè·å–ï¼Œå¤„ç†å¤±è´¥é€»è¾‘</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Unable to acquire lock&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">performCriticalTask</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å…³é”®ä»»åŠ¡ä»£ç </span></span><br><span class="line">        System.out.println(<span class="string">&quot;Performing critical task&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Redisson-æä¾›äº†å“ªå‡ ç§åˆ†å¸ƒå¼é”ï¼Ÿè¿™äº›é”çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿå…¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#Redisson-æä¾›äº†å“ªå‡ ç§åˆ†å¸ƒå¼é”ï¼Ÿè¿™äº›é”çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿå…¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="Redisson æä¾›äº†å“ªå‡ ç§åˆ†å¸ƒå¼é”ï¼Ÿè¿™äº›é”çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿå…¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>Redisson æä¾›äº†å“ªå‡ ç§åˆ†å¸ƒå¼é”ï¼Ÿè¿™äº›é”çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿå…¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><h4 id="Redissonä¸ƒç§é”"><a href="#Redissonä¸ƒç§é”" class="headerlink" title="Redissonä¸ƒç§é”"></a>Redissonä¸ƒç§é”</h4><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/wangshuai6707/article/details/132791507?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_utm_term~default-0-132791507-blog-119827743.235%5Ev43%5Econtrol&spm=1001.2101.3001.4242.1&utm_relevant_index=1">ã€å®è·µç¯‡ã€‘4.3 Redisä¹‹Redisson 7ç§åˆ†å¸ƒå¼é”ä½¿ç”¨æŒ‡å—</a></p><h5 id="ç®€å•é”"><a href="#ç®€å•é”" class="headerlink" title="ç®€å•é”"></a>ç®€å•é”</h5><ul><li>ç®€å•é”æ˜¯æœ€åŸºæœ¬çš„åˆ†å¸ƒå¼é”ï¼Œé€šè¿‡è°ƒç”¨Redissonçš„<code>getLock()</code>æ–¹æ³•æ¥è·å–é”ï¼Œå¹¶ä½¿ç”¨<code>lock()</code>å’Œ<code>unlock()</code>æ–¹æ³•æ¥åŠ é”å’Œè§£é”ã€‚</li><li>ç®€å•é”åœ¨æ€§èƒ½æ–¹é¢è¡¨ç°è‰¯å¥½ï¼Œå¯ä»¥æä¾›è‰¯å¥½çš„å¹¶å‘æ§åˆ¶ã€‚</li><li><strong>æ™®é€šçš„åˆ†å¸ƒå¼é”</strong>ï¼šç”¨äºä¿æŠ¤å…±äº«èµ„æºï¼Œé˜²æ­¢å¹¶å‘æ“ä½œå¼•å‘çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</li><li>é€‚ç”¨äºå¤§å¤šæ•°éœ€è¦æ§åˆ¶å¹¶å‘è®¿é—®çš„åœºæ™¯ï¼Œå¦‚æ•°æ®åº“è®°å½•çš„æ›´æ–°ã€æ–‡ä»¶æ“ä½œç­‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redisson.getLock(<span class="string">&quot;myLock&quot;</span>);</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œéœ€è¦åŠ é”çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="å…¬å¹³é”"><a href="#å…¬å¹³é”" class="headerlink" title="å…¬å¹³é”"></a>å…¬å¹³é”</h5><ul><li>**å…¬å¹³é”æ˜¯æŒ‰ç…§è¯·æ±‚é”çš„é¡ºåºæ¥è·å–é”çš„ï¼Œå…ˆåˆ°å…ˆå¾—ã€‚**é€šè¿‡è°ƒç”¨Redissonçš„<code>getFairLock()</code>æ–¹æ³•æ¥è·å–å…¬å¹³é”ã€‚</li><li>æ€§èƒ½å’Œå…¬å¹³æ€§æ§åˆ¶ï¼šå…¬å¹³é”åœ¨æ€§èƒ½æ–¹é¢ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºéœ€è¦ç»´æŠ¤ä¸€ä¸ªè¯·æ±‚é”çš„é˜Ÿåˆ—æ¥ä¿è¯å…¬å¹³æ€§ã€‚</li></ul><p>å…¬å¹³æŒ‡çš„å°±æ˜¯å¯¹äºå„ä¸ªè¯·æ±‚é”çš„çº¿ç¨‹æ¥è¯´æ˜¯å…¬å¹³çš„ï¼Œæ’é˜Ÿå˜›ï¼Œé‚£å°±æ˜¯å…¬å¹³çš„å˜›ï¼Œå…ˆåˆ°å…ˆå¾—ï¼Œå®¢è§‚å…¬å¹³ã€‚ä¸ä¹‹å¸¦æ¥çš„é—®é¢˜å°±æ˜¯æ€§èƒ½è¾ƒä½äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RLock</span> <span class="variable">fairLock</span> <span class="operator">=</span> redisson.getFairLock(<span class="string">&quot;myFairLock&quot;</span>);</span><br><span class="line">fairLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œéœ€è¦åŠ é”çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    fairLock.unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”"></a>å¯é‡å…¥é”</h5><ul><li>å¯é‡å…¥é”æ˜¯å¯ä»¥è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–çš„é”ã€‚é€šè¿‡è°ƒç”¨Redissonçš„getReentrantLock()æ–¹æ³•æ¥è·å–å¯é‡å…¥é”ã€‚</li><li>æ€§èƒ½å’Œé‡å…¥æ§åˆ¶ï¼šå¯é‡å…¥é”åœ¨æ€§èƒ½æ–¹é¢è¡¨ç°è‰¯å¥½ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è®¡æ•°å™¨æ¥æ§åˆ¶é”çš„é‡å…¥æ¬¡æ•°ã€‚</li><li><strong>éœ€è¦å¯é‡å…¥çš„åˆ†å¸ƒå¼é”</strong>ï¼šåœ¨åŒä¸€çº¿ç¨‹ä¸­å¯ä»¥å¤šæ¬¡è·å–é”ï¼Œé€‚ç”¨äºé€’å½’è°ƒç”¨æˆ–å¤šå±‚æ–¹æ³•è°ƒç”¨çš„æƒ…å†µã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RReentrantLock</span> <span class="variable">reentrantLock</span> <span class="operator">=</span> redisson.getReentrantLock(<span class="string">&quot;myReentrantLock&quot;</span>);</span><br><span class="line">reentrantLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œéœ€è¦åŠ é”çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    reentrantLock.unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®ç°æ–¹å¼ï¼š</p><ul><li>é€šè¿‡åœ¨é”çš„å€¼ä¸­å­˜å‚¨çº¿ç¨‹æ ‡è¯†ç¬¦ï¼ˆå¦‚çº¿ç¨‹ IDï¼‰ï¼Œç¡®ä¿åŒä¸€çº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–é”è€Œä¸å¼•å‘æ­»é”ã€‚</li><li>é”çš„è®¡æ•°å™¨ç”¨äºè·Ÿè¸ªè·å–æ¬¡æ•°ï¼Œåªæœ‰åœ¨é‡Šæ”¾æ¬¡æ•°ç­‰äºè·å–æ¬¡æ•°æ—¶ï¼Œé”æ‰ä¼šçœŸæ­£é‡Šæ”¾ã€‚</li></ul><h5 id="çº¢é”"><a href="#çº¢é”" class="headerlink" title="çº¢é”"></a>çº¢é”</h5><ul><li>çº¢é”æ˜¯åœ¨å¤šä¸ªRediså®ä¾‹ä¸Šè·å–é”çš„ä¸€ç§æœºåˆ¶ï¼Œè¦æ±‚å¤§å¤šæ•°Rediså®ä¾‹æˆåŠŸè·å–é”æ‰ç®—æˆåŠŸã€‚é€šè¿‡è°ƒç”¨Redissonçš„<code>getRedLock()</code>æ–¹æ³•æ¥è·å–çº¢é”ã€‚</li><li>æ€§èƒ½å’Œåˆ†å¸ƒå¼é”æ§åˆ¶ï¼šçº¢é”åœ¨æ€§èƒ½æ–¹é¢ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºéœ€è¦åœ¨å¤šä¸ªRediså®ä¾‹ä¹‹é—´è¿›è¡ŒåŒæ­¥ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RLock</span> <span class="variable">lock1</span> <span class="operator">=</span> redisson.getLock(<span class="string">&quot;lock1&quot;</span>);</span><br><span class="line"><span class="type">RLock</span> <span class="variable">lock2</span> <span class="operator">=</span> redisson.getLock(<span class="string">&quot;lock2&quot;</span>);</span><br><span class="line"><span class="type">RLock</span> <span class="variable">lock3</span> <span class="operator">=</span> redisson.getLock(<span class="string">&quot;lock3&quot;</span>);</span><br><span class="line"><span class="type">RedissonRedLock</span> <span class="variable">redLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedissonRedLock</span>(lock1, lock2, lock3);</span><br><span class="line">redLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œéœ€è¦åŠ é”çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    redLock.unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h5><ul><li>è¯»å†™é”æ˜¯åŒæ—¶æ”¯æŒè¯»æ“ä½œå’Œå†™æ“ä½œçš„é”ã€‚é€šè¿‡è°ƒç”¨Redissonçš„<code>getReadWriteLock()</code>æ–¹æ³•æ¥è·å–è¯»å†™é”ã€‚</li><li>è¯»å†™é”åœ¨è¯»æ“ä½œæ–¹é¢å…è®¸å¹¶å‘è®¿é—®ï¼Œä½†åœ¨å†™æ“ä½œæ–¹é¢åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚</li><li><strong>é«˜å¹¶å‘è¯»åœºæ™¯</strong>ï¼šå½“è¯»æ“ä½œè¿œè¿œå¤§äºå†™æ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯»å†™é”æ¥æé«˜æ€§èƒ½ã€‚</li><li>é€‚ç”¨äºç¼“å­˜ã€åˆ—è¡¨å’Œå…±äº«æ•°æ®çš„åœºæ™¯ï¼Œä¾‹å¦‚è¯»å–é…ç½®æ–‡ä»¶çš„æƒ…å†µã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RReadWriteLock</span> <span class="variable">readWriteLock</span> <span class="operator">=</span> redisson.getReadWriteLock(<span class="string">&quot;myReadWriteLock&quot;</span>);</span><br><span class="line"><span class="type">RLock</span> <span class="variable">readLock</span> <span class="operator">=</span> readWriteLock.readLock();</span><br><span class="line"><span class="type">RLock</span> <span class="variable">writeLock</span> <span class="operator">=</span> readWriteLock.writeLock();</span><br><span class="line">readLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œéœ€è¦è¯»å–çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    readLock.unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">writeLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œéœ€è¦å†™å…¥çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    writeLock.unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="ä¿¡å·é‡"><a href="#ä¿¡å·é‡" class="headerlink" title="ä¿¡å·é‡"></a>ä¿¡å·é‡</h5><ul><li>ä¿¡å·é‡æ˜¯ä¸€ç§ç”¨äºæ§åˆ¶å¹¶å‘è®¿é—®æ•°é‡çš„é”ã€‚é€šè¿‡è°ƒç”¨Redissonçš„<code>getSemaphore()</code>æ–¹æ³•æ¥è·å–ä¿¡å·é‡ã€‚</li><li>ä¿¡å·é‡å¯ä»¥æ§åˆ¶åŒæ—¶è®¿é—®çš„çº¿ç¨‹æ•°é‡ï¼Œä»è€Œæ§åˆ¶å¹¶å‘è®¿é—®ã€‚</li><li><strong>æ§åˆ¶å¹¶å‘è®¿é—®æ•°é‡</strong>ï¼šé€‚ç”¨äºé™åˆ¶è®¿é—®æŸäº›èµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œæ¯”å¦‚é™æµã€‚</li><li>é€‚ç”¨äºè¿æ¥æ± ã€çº¿ç¨‹æ± ç­‰éœ€è¦é™åˆ¶å¹¶å‘æ•°çš„åœºæ™¯ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RSemaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> redisson.getSemaphore(<span class="string">&quot;mySemaphore&quot;</span>);</span><br><span class="line">semaphore.acquire();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œéœ€è¦å¹¶å‘æ§åˆ¶çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    semaphore.release();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é—­é”"><a href="#é—­é”" class="headerlink" title="é—­é”"></a>é—­é”</h5><ul><li>é—­é”æ˜¯ä¸€ç§ç”¨äºç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä»»åŠ¡çš„åŒæ­¥å·¥å…·ã€‚é€šè¿‡è°ƒç”¨Redissonçš„<code>getCountDownLatch()</code>æ–¹æ³•æ¥è·å–é—­é”ã€‚</li><li>é—­é”å¯ä»¥ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä»»åŠ¡åå†ç»§ç»­æ‰§è¡Œã€‚</li><li><strong>ç­‰å¾…å¤šä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡</strong>ï¼šé€‚ç”¨äºéœ€è¦åè°ƒå¤šä¸ªçº¿ç¨‹å®ŒæˆæŸé¡¹ä»»åŠ¡çš„åœºæ™¯ã€‚</li><li>ä¾‹å¦‚ï¼Œä¸»çº¿ç¨‹ç­‰å¾…å¤šä¸ªå­çº¿ç¨‹å®Œæˆåå†ç»§ç»­æ‰§è¡Œã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RCountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> redisson.getCountDownLatch(<span class="string">&quot;myLatch&quot;</span>);</span><br><span class="line">latch.trySetCount(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä»»åŠ¡</span></span><br><span class="line">latch.await();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œéœ€è¦ç­‰å¾…çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h2><h3 id="åŸºç¡€é—®é¢˜"><a href="#åŸºç¡€é—®é¢˜" class="headerlink" title="åŸºç¡€é—®é¢˜"></a>åŸºç¡€é—®é¢˜</h3><ol><li><strong>ä»€ä¹ˆæ˜¯ Redissonï¼Œå®ƒä¸ Redis æœ‰ä½•å…³ç³»ï¼Ÿ</strong><ul><li>è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨æ¥è¯„ä¼°é¢è¯•è€…å¯¹ Redisson åŸºæœ¬æ¦‚å¿µçš„ç†è§£ï¼Œæ˜¯å¦äº†è§£å…¶ä½œä¸º Redis çš„ Java å®¢æˆ·ç«¯æ¡†æ¶çš„è§’è‰²ã€‚</li></ul></li><li><strong>Redisson æä¾›äº†å“ªäº›æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ</strong><ul><li>æœŸæœ›å›ç­”åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é›†åˆã€åˆ†å¸ƒå¼åŒæ­¥å·¥å…·ï¼ˆå¦‚ä¿¡å·é‡ã€æ …æ ï¼‰ã€åˆ†å¸ƒå¼æ‰§è¡Œå™¨ç­‰åŠŸèƒ½ã€‚</li></ul></li><li><strong>Redisson å¦‚ä½•æ”¯æŒé«˜å¯ç”¨æ€§ï¼Ÿ</strong><ul><li>äº†è§£é¢è¯•è€…æ˜¯å¦ç†Ÿæ‚‰ Redisson æ”¯æŒçš„ Redis éƒ¨ç½²æ¨¡å¼ï¼ˆå¦‚å•æœºã€å“¨å…µã€é›†ç¾¤æ¨¡å¼ï¼‰ï¼Œä»¥åŠè‡ªåŠ¨æ•…éšœè½¬ç§»å’Œè´Ÿè½½å‡è¡¡æœºåˆ¶ã€‚</li></ul></li></ol><h3 id="åˆ†å¸ƒå¼é”ç›¸å…³é—®é¢˜-1"><a href="#åˆ†å¸ƒå¼é”ç›¸å…³é—®é¢˜-1" class="headerlink" title="åˆ†å¸ƒå¼é”ç›¸å…³é—®é¢˜"></a>åˆ†å¸ƒå¼é”ç›¸å…³é—®é¢˜</h3><ol><li><strong>å¦‚ä½•ä½¿ç”¨ Redisson å®ç°åˆ†å¸ƒå¼é”ï¼Ÿè¯·ç®€å•æè¿°å®ç°æ­¥éª¤ã€‚</strong><ul><li>è¿™ä¸ªé—®é¢˜è€ƒå¯Ÿé¢è¯•è€…å¯¹ Redisson çš„ä½¿ç”¨å’Œå…·ä½“å®ç°æ­¥éª¤çš„æŒæ¡ã€‚</li></ul></li><li><strong>Redisson æä¾›äº†å“ªå‡ ç§åˆ†å¸ƒå¼é”ï¼Ÿè¿™äº›é”çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</strong><ul><li>æœŸæœ›å›ç­”å¦‚å¯é‡å…¥é”ã€å…¬å¹³é”ã€è¯»å†™é”ç­‰ï¼Œå¹¶è¯´æ˜ä¸åŒé”çš„åº”ç”¨åœºæ™¯ã€‚</li></ul></li><li><strong>å¦‚ä½•å¤„ç† Redisson åˆ†å¸ƒå¼é”çš„è‡ªåŠ¨é‡Šæ”¾é—®é¢˜ï¼Ÿ</strong><ul><li>æƒ³äº†è§£é¢è¯•è€…æ˜¯å¦æ¸…æ¥šé”çš„è¶…æ—¶æœºåˆ¶ï¼Œä»¥åŠå¦‚ä½•é¿å…æ­»é”ã€‚</li></ul></li><li><strong>Redisson çš„ <code>tryLock()</code> æ–¹æ³•å¦‚ä½•å·¥ä½œï¼Ÿä¸ <code>lock()</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong><ul><li>æœŸæœ›é¢è¯•è€…ç†è§£ <code>tryLock()</code> çš„éé˜»å¡è¡Œä¸ºå’Œè¶…æ—¶å¤„ç†ï¼Œä»¥åŠ <code>lock()</code> çš„é˜»å¡è¡Œä¸ºã€‚</li></ul></li></ol><h3 id="åˆ†å¸ƒå¼æ•°æ®ç»“æ„ä¸å¯¹è±¡"><a href="#åˆ†å¸ƒå¼æ•°æ®ç»“æ„ä¸å¯¹è±¡" class="headerlink" title="åˆ†å¸ƒå¼æ•°æ®ç»“æ„ä¸å¯¹è±¡"></a>åˆ†å¸ƒå¼æ•°æ®ç»“æ„ä¸å¯¹è±¡</h3><ol><li><strong>Redisson æ”¯æŒå“ªäº›åˆ†å¸ƒå¼æ•°æ®ç»“æ„ï¼Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨è¿™äº›åˆ†å¸ƒå¼æ•°æ®ç»“æ„ï¼Ÿ</strong><ul><li>é‡ç‚¹è€ƒå¯Ÿé¢è¯•è€…æ˜¯å¦ç†Ÿæ‚‰ <code>RMap</code>ã€<code>RList</code>ã€<code>RSet</code> ç­‰åˆ†å¸ƒå¼é›†åˆï¼ŒåŠå…¶åœ¨å…±äº«ç¼“å­˜ã€ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„åº”ç”¨ã€‚</li></ul></li><li><strong>Redisson æä¾›äº†å“ªäº›åˆ†å¸ƒå¼å¯¹è±¡ï¼Ÿå¦‚ä½•åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å®ç°ä¿¡å·é‡ï¼ˆSemaphoreï¼‰ï¼Ÿ</strong><ul><li>è€ƒå¯Ÿé¢è¯•è€…æ˜¯å¦æ¸…æ¥š Redisson æ”¯æŒçš„å¸¸è§åŒæ­¥å·¥å…·ï¼Œå¦‚ä¿¡å·é‡ã€æ …æ ã€è®¡æ•°å™¨ç­‰ã€‚</li></ul></li><li><strong>åˆ†å¸ƒå¼é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é€šè¿‡ Redisson å®ç°ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—ï¼Ÿ</strong><ul><li>æƒ³äº†è§£é¢è¯•è€…æ˜¯å¦èƒ½å¤Ÿé€šè¿‡ Redisson å®ç°å»¶æ—¶ä»»åŠ¡è°ƒåº¦ï¼Œå¹¶èƒ½æè¿°å‡ºå¸¸è§çš„åº”ç”¨åœºæ™¯ã€‚</li></ul></li></ol><h3 id="é«˜çº§åŠŸèƒ½"><a href="#é«˜çº§åŠŸèƒ½" class="headerlink" title="é«˜çº§åŠŸèƒ½"></a>é«˜çº§åŠŸèƒ½</h3><ol><li><strong>Redisson çš„åˆ†å¸ƒå¼é”å¦‚ä½•ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼Ÿå¦‚æœ Redis èŠ‚ç‚¹æ•…éšœï¼Œé”ä¼šå¤±æ•ˆå—ï¼Ÿ</strong><ul><li>è€ƒå¯Ÿé¢è¯•è€…æ˜¯å¦äº†è§£ Redisson é€šè¿‡ Lua è„šæœ¬å®ç°é”çš„åŸå­æ€§æ“ä½œï¼Œæ˜¯å¦è€ƒè™‘è¿‡Redisçš„æ•…éšœæ¢å¤å’Œé”çš„æŒä¹…åŒ–æœºåˆ¶ã€‚</li></ul></li><li><strong>Redisson å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼é”çš„é‡å…¥é—®é¢˜ï¼Ÿå¦‚ä½•ä¿è¯é”çš„å…¬å¹³æ€§ï¼Ÿ</strong><ul><li>æœŸæœ›é¢è¯•è€…è§£é‡Š Redisson çš„å¯é‡å…¥é”å’Œå…¬å¹³é”æœºåˆ¶ï¼Œäº†è§£å®ƒä»¬èƒŒåçš„å®ç°åŸç†ã€‚</li></ul></li><li><strong>ä½ å¦‚ä½•è§£å†³ Redisson é”çš„è¿‡æœŸæ—¶é—´ä¸å¤Ÿæˆ–è¶…æ—¶çš„é—®é¢˜ï¼Ÿ</strong><ul><li>é¢è¯•è€…åº”äº†è§£é”ç»­å‘½æœºåˆ¶ï¼ˆwatchdogï¼‰ï¼Œå¦‚ä½•åœ¨ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”çš„ TTL æ—¶è‡ªåŠ¨å»¶é•¿é”çš„æŒæœ‰æ—¶é—´ã€‚</li></ul></li></ol><h3 id="å…¶ä»–å®æˆ˜é—®é¢˜"><a href="#å…¶ä»–å®æˆ˜é—®é¢˜" class="headerlink" title="å…¶ä»–å®æˆ˜é—®é¢˜"></a>å…¶ä»–å®æˆ˜é—®é¢˜</h3><ol><li><strong>Redisson å¦‚ä½•åœ¨ SpringBoot é¡¹ç›®ä¸­é›†æˆä½¿ç”¨ï¼Ÿä½ æ˜¯å¦é‡åˆ°è¿‡ Redisson é›†æˆä¸­çš„é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</strong><ul><li>è¿™ä¸ªé—®é¢˜å¯ä»¥è®©é¢è¯•è€…ç»“åˆå®é™…ç»éªŒï¼Œåˆ†äº«å¦‚ä½•é…ç½® Redisson å¹¶è§£å†³å¯èƒ½é‡åˆ°çš„ Redis è¿æ¥ã€é”é‡Šæ”¾ç­‰é—®é¢˜ã€‚</li></ul></li><li><strong>åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•é€šè¿‡ Redisson å®ç°åˆ†å¸ƒå¼é™æµï¼Ÿ</strong><ul><li>æœŸæœ›é¢è¯•è€…èƒ½æè¿°é€šè¿‡ Redisson çš„ä¿¡å·é‡æˆ–é™æµå™¨ï¼ˆRateLimiterï¼‰æ¥é™åˆ¶è¯·æ±‚æ•°é‡çš„è§£å†³æ–¹æ¡ˆã€‚</li></ul></li><li><strong>è¯·ç®€è¿° Redisson åœ¨ Redis é›†ç¾¤æ¨¡å¼ä¸­çš„è¡¨ç°ï¼Œå®ƒå¦‚ä½•å¤„ç†èŠ‚ç‚¹æ•…éšœï¼Ÿ</strong><ul><li>æƒ³äº†è§£é¢è¯•è€…æ˜¯å¦ç†è§£é›†ç¾¤æ¨¡å¼ä¸‹çš„åˆ†å¸ƒå¼é”å¤„ç†ï¼Œä»¥åŠ Redisson å¦‚ä½•è‡ªåŠ¨å¤„ç†èŠ‚ç‚¹å¤±è´¥åçš„é‡æ–°è¿æ¥æˆ–æ•°æ®è¿ç§»ã€‚</li></ul></li></ol><h3 id="åœºæ™¯è®¾è®¡é¢˜"><a href="#åœºæ™¯è®¾è®¡é¢˜" class="headerlink" title="åœºæ™¯è®¾è®¡é¢˜"></a>åœºæ™¯è®¾è®¡é¢˜</h3><ol><li><strong>å‡è®¾ä½ æœ‰ä¸€ä¸ªåº“å­˜ç³»ç»Ÿï¼Œå¤šä¸ªå®ä¾‹å¹¶å‘ä¿®æ”¹åº“å­˜ï¼Œå¦‚ä½•é€šè¿‡ Redisson å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ</strong><ul><li>é€šè¿‡æ­¤é—®é¢˜è¯„ä¼°é¢è¯•è€…åœ¨å®æˆ˜ä¸­å¦‚ä½•åˆ©ç”¨åˆ†å¸ƒå¼é”æ¥ç¡®ä¿åº“å­˜æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ul></li><li><strong>å¦‚ä½•ä½¿ç”¨ Redisson å®ç°åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å™¨ï¼Ÿ</strong><ul><li>é‡ç‚¹è€ƒå¯Ÿé¢è¯•è€…å¯¹ Redisson æä¾›çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å™¨åŠŸèƒ½çš„ç†è§£ï¼Œèƒ½å¦ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯è¿›è¡Œå®ç°ã€‚</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
            <tag> Redisson </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>72 åˆ†å¸ƒå¼é”</title>
      <link href="/2025/02/26/75-06%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
      <url>/2025/02/26/75-06%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h1 id="72-åˆ†å¸ƒå¼é”"><a href="#72-åˆ†å¸ƒå¼é”" class="headerlink" title="72 åˆ†å¸ƒå¼é”"></a>72 åˆ†å¸ƒå¼é”</h1><h2 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”</h2><p>åˆ†å¸ƒå¼é” &#x3D; åˆ†å¸ƒå¼ + é”ã€‚é‚£ä¹ˆåˆ†å¸ƒå¼æ˜¯æŒ‡çš„ä»€ä¹ˆå‘¢ï¼Ÿé”åˆæ˜¯é”çš„è°å‘¢ï¼Ÿåœ¨ä¸šåŠ¡å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°åˆ†å¸ƒå¼åˆ†å¸ƒå¼çš„æ¦‚å¿µï¼Œåˆ†å¸ƒå¼ä¹Ÿå¾ˆç®€å•ï¼Œé€šä¿—çš„æ¥è¯´å°±æ˜¯ä½ å…·æœ‰å¤šä¸ªæœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨ä¸Šè¿è¡Œçš„ç¨‹åºæ˜¯ä¸€æ ·çš„ï¼Œç”¨æˆ·çš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œéƒ½ä¼šå¹³è¡¡çš„åˆ†é…åˆ°éšæœºçš„ä¸€ä¸ªæœåŠ¡å™¨ä¸­è¿›è¡Œå¤„ç†ã€‚é‚£ä¹ˆè¿™æ ·çš„è¯å°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¹¶å‘å†²çªå’Œæ•°æ®ä¸ä¸€è‡´ç­‰é—®é¢˜ã€‚ä¸‹é¢ç»“åˆä¸€ä¸ªç®€å•çš„å°ä¾‹å­æ¥ä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¸ä½¿ç”¨åˆ†å¸ƒå¼é”ä¼šé€ æˆä»€ä¹ˆé—®é¢˜ã€‚</p><blockquote><p>å‡è®¾ä½ è¿è¥ç€ä¸€ä¸ªåœ¨çº¿ç”µå•†å¹³å°ï¼ŒæŸä¸ªå•†å“ï¼ˆå•†å“IDä¸º <code>product123</code>ï¼‰çš„åº“å­˜ä¸º10ä»¶ã€‚å½“ç”¨æˆ·åœ¨ä¸‹å•æ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥åº“å­˜ï¼Œç¡®å®šåº“å­˜æ˜¯å¦å……è¶³ï¼Œç„¶åå‡å°‘åº“å­˜å¹¶ç”Ÿæˆè®¢å•ã€‚ä¸ºäº†åº”å¯¹å¤§é‡å¹¶å‘è¯·æ±‚ï¼Œä½ çš„ç³»ç»Ÿä½¿ç”¨äº†å¤šå°æœåŠ¡å™¨æ¥å¤„ç†è®¢å•è¯·æ±‚ã€‚</p><p><strong>ç”¨æˆ·1</strong>ï¼ˆè¯·æ±‚åœ¨æœåŠ¡å™¨Aä¸Šå¤„ç†ï¼‰å’Œ <strong>ç”¨æˆ·2</strong>ï¼ˆè¯·æ±‚åœ¨æœåŠ¡å™¨Bä¸Šå¤„ç†ï¼‰åŒæ—¶å‘å‡ºè´­ä¹°è¯·æ±‚ã€‚å½“å‰åº“å­˜ï¼š10ä»¶</p><p>æœåŠ¡å™¨Aæ¥æ”¶åˆ°<strong>ç”¨æˆ·1</strong>çš„è¯·æ±‚ï¼Œå¹¶æŸ¥è¯¢æ•°æ®åº“ä¸­çš„åº“å­˜ï¼Œæ­¤æ—¶åº“å­˜ä¸º10ä»¶ã€‚</p><p>æœåŠ¡å™¨Bä¹Ÿæ¥æ”¶åˆ°<strong>ç”¨æˆ·2</strong>çš„è¯·æ±‚ï¼Œå¹¶åŒæ—¶æŸ¥è¯¢æ•°æ®åº“ä¸­çš„åº“å­˜ï¼Œæ­¤æ—¶åº“å­˜ä¹Ÿæ˜¯10ä»¶ã€‚</p><p>æ­¤æ—¶ï¼Œä¸¤ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹éƒ½â€œçœ‹åˆ°â€åº“å­˜ä¸º10ä»¶ã€‚</p><p>æœåŠ¡å™¨Aä¸º<strong>ç”¨æˆ·1</strong>ç”Ÿæˆäº†è®¢å•ï¼Œå¹¶å°†åº“å­˜å‡å°‘1ã€‚åº“å­˜åº”å‡å°‘ä¸º9ä»¶ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼ŒæœåŠ¡å™¨Bä¸º<strong>ç”¨æˆ·2</strong>ç”Ÿæˆäº†è®¢å•ï¼Œå¹¶å°†åº“å­˜ä¹Ÿå‡å°‘1ï¼Œè®¤ä¸ºåº“å­˜ç°åœ¨ä¹Ÿæ˜¯9ä»¶ã€‚</p><ul><li>æœåŠ¡å™¨Aå°†æ–°çš„åº“å­˜9ä»¶æ›´æ–°å›æ•°æ®åº“ã€‚</li><li>æœåŠ¡å™¨Bå°†æ–°çš„åº“å­˜9ä»¶ï¼ˆæ ¹æ®å®ƒçš„è§†è§’ï¼‰æ›´æ–°å›æ•°æ®åº“ã€‚</li></ul><p>æœ€ç»ˆç»“æœï¼šè™½ç„¶ä¸¤ä¸ªç”¨æˆ·ä¸‹å•å¹¶å‡å°‘åº“å­˜ï¼Œä½†ä¸¤å°æœåŠ¡å™¨å¹¶æ²¡æœ‰æ„è¯†åˆ°å¯¹æ–¹çš„æ“ä½œï¼Œå› æ­¤å®ƒä»¬éƒ½è®¤ä¸ºåº“å­˜åº”è¯¥ä»10å‡å°‘åˆ°9ï¼Œè€Œä¸æ˜¯ä»10å‡å°‘åˆ°8ã€‚</p><p>å®é™…å‘ç”Ÿçš„é—®é¢˜æ˜¯ï¼Œ<strong>ä¸¤ä¸ªç”¨æˆ·éƒ½æˆåŠŸè´­ä¹°äº†å•†å“ï¼Œä½†åº“å­˜å®é™…ä¸Šåªå‡å°‘äº†1ä»¶</strong>ï¼Œè€Œä¸æ˜¯2ä»¶ã€‚è¿™å°±æ˜¯<strong>åº“å­˜è¶…å–</strong>çš„ç°è±¡ã€‚</p><p>åº“å­˜æœ€ç»ˆæ˜¾ç¤ºä¸º9ä»¶ï¼Œè€Œå®é™…ä¸Šå®ƒåº”è¯¥æ˜¾ç¤ºä¸º8ä»¶ï¼Œæ„å‘³ç€åº“å­˜è¢«é”™è¯¯åœ°è®°å½•ï¼Œç³»ç»Ÿå…è®¸ç”¨æˆ·è´­ä¹°è¶…è¿‡å®é™…åº“å­˜é‡çš„å•†å“ã€‚</p></blockquote><p>åˆ†å¸ƒå¼é”ä¿è¯äº†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªæœºå™¨çš„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼›</p><h2 id="åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡çš„å“è´¨"><a href="#åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡çš„å“è´¨" class="headerlink" title="åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡çš„å“è´¨"></a>åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡çš„å“è´¨</h2><p>è¯¾æœ¬ä¸Šçš„æ¦‚å¿µç›´æ¥åˆ—å‡ºï¼Œè®©äººçœ‹äº†å¥½ä¼¼æ‡‚äº†åˆå¥½ä¼¼æ²¡æ‡‚ã€‚åˆ†å¸ƒå¼é”ç®€å•çš„æ¥è¯´å°±æ˜¯ä¸ºäº†åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šçš„ç›¸åŒæ–¹æ³•åªèƒ½æœ‰ä¸€ä¸ªåœ¨æŸä¸€æ—¶åˆ»è¿è¡Œå°±æ˜¯äº†ï¼Œæˆ‘ä»¬éœ€è¦é”ä½ä¸€äº›èµ„æºï¼Œè®©å…¶è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œæ— è®ºæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šæ¶‰åŠåˆ°å…­ä¸ªå­—ï¼šé«˜å¯ç”¨é«˜æ€§èƒ½ï¼Œè¿™ä¸ªä¹Ÿä¸ä¾‹å¤–ã€‚è¿™ä¸ªåˆ†å¸ƒå¼é”éœ€è¦ä¿è¯é«˜å¯ç”¨çš„è·å–é”å’Œé‡Šæ”¾é”ï¼Œä¹Ÿéœ€è¦ä¿è¯é«˜æ€§èƒ½çš„è·å–é”å’Œé‡Šæ”¾é”ã€‚åŒæ—¶ä¸ºäº†é¿å…ä¸€äº›æ„å¤–æƒ…å†µå¯¼è‡´æŸçº¿ç¨‹ä¸€ç›´å ç”¨é”ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯åˆ†å¸ƒå¼é”å…·æœ‰è¿‡æœŸæ—¶é—´ï¼Œä»è€Œé¿å…æ­»é”ã€‚</p><ul><li>1ã€åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªæœºå™¨çš„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼›</li><li>2ã€é«˜å¯ç”¨çš„è·å–é”ä¸é‡Šæ”¾é”ï¼›</li><li>3ã€é«˜æ€§èƒ½çš„è·å–é”ä¸é‡Šæ”¾é”ï¼›</li><li>4ã€å…·å¤‡å¯é‡å…¥ç‰¹æ€§ï¼›</li><li>5ã€å…·å¤‡é”å¤±æ•ˆæœºåˆ¶ï¼Œé˜²æ­¢æ­»é”ï¼›</li><li>6ã€å…·å¤‡éé˜»å¡é”ç‰¹æ€§ï¼Œå³æ²¡æœ‰è·å–åˆ°é”å°†ç›´æ¥è¿”å›è·å–é”å¤±è´¥ã€‚</li></ul><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><p>ç›®å‰æˆ‘ä»¬æ¥è§¦åˆ°çš„å¾ˆå¤šå¤§å‹ç½‘ç«™éƒ½æ˜¯åŸºäºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¼€å‘çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç†è®ºè¢«ç§°ä¸ºCAPç†è®ºï¼Œè¿™ä¸ªç†è®ºå‘Šè¯‰æˆ‘ä»¬ï¼Œ**ä»»ä½•ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿéƒ½æ— æ³•åŒæ—¶ä¿è¯ç³»ç»Ÿçš„ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ã€‚**æ‰€ä»¥å¾ˆå¤šåˆ†å¸ƒå¼ç³»ç»Ÿéƒ½æ˜¯é€‰æ‹©ç‰ºç‰²ä¸€å®šçš„å¼ºä¸€è‡´æ€§æ¥å¾—åˆ°é«˜å¯ç”¨å’Œé«˜æ€§èƒ½è¿™ä¸€ç›®æ ‡ï¼Œå®ƒä»¬é€‰æ‹©ç³»ç»Ÿåªè¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§å³å¯ã€‚</p><p>åœ¨å¾ˆå¤šçš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸ºäº†è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§éœ€è¦å¾ˆå¤šçš„æŠ€æœ¯æ”¯æŒï¼Œæ¯”å¦‚ï¼šåˆ†å¸ƒå¼äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”ç­‰ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆè¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼Œåˆ†å¸ƒå¼é”çš„å®ç°ä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªå¤§ç±»ï¼š</p><ol><li>åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”ï¼›</li><li>åŸºäºç¼“å­˜å®ç°åˆ†å¸ƒå¼é”ï¼›</li><li>åŸºäºZooKeeperå®ç°åˆ†å¸ƒå¼é”ï¼›</li></ol><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸€ä»‹ç»ã€‚</p><p>åœ¨ä»‹ç»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»”ç»†æ€è€ƒä¸€ä¸‹é”çš„æ¦‚å¿µï¼Œä»€ä¹ˆæ˜¯é”å‘¢ï¼Ÿé”åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒä¸æ¶‰åŠåˆ°ä¸€ä¸ªå…·ä½“çš„äº‹ç‰©ã€‚ä»»ä½•åªè¦èƒ½ä¿è¯å”¯ä¸€æ€§çš„éƒ½å¯ä»¥ä½œä¸ºé”ï¼Œæˆ‘ä»¬ä»”ç»†æƒ³æƒ³ä»€ä¹ˆèƒ½ä¿è¯å”¯ä¸€æ€§å‘¢ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯æ•°æ®åº“ä¸­çš„IDå’ŒRedisä¸­çš„setnxï¼Œåªè¦æ’å…¥äº†ä¸¤ä¸ªä¸€æ ·çš„å°±ä¼šå¤±è´¥ï¼Œè¿™å°±æ˜¯ç­‰ä»·äºè·å–é”å¤±è´¥äº†ã€‚</p><h3 id="åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”</h3><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±å¾ˆç®€å•äº†ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œè¿™ä¸ªè¡¨å°±æ˜¯ä¸ºäº†åˆ†å¸ƒå¼ç³»ç»Ÿç”¨æ¥è·å–é”çš„ï¼Œæ¯”å¦‚å°±åˆ›å»ºäº†è¿™ä¸ªï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `distributed_lock` (</span><br><span class="line">  `lock_key` VARCHAR(64) NOT NULL PRIMARY KEY,</span><br><span class="line">  `lock_value` VARCHAR(64) NOT NULL,</span><br><span class="line">  `expires_at` TIMESTAMP NOT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªçº¿ç¨‹æƒ³è·å–åˆ°è¿™ä¸ªé”ï¼Œå°±åœ¨è¿™ä¸ªè¡¨ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå…¶ä¸­lock_keyä¸ºè¯¥çº¿ç¨‹éœ€è¦å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œæ“ä½œçš„IDï¼Œæ¯”å¦‚è®¢å•IDç­‰ç­‰</p><p>åœ¨æ¯ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ä¸­ï¼Œå½“éœ€è¦å¯¹æŸä¸ªå…±äº«èµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬ä¼šå°è¯•å‘ <code>distributed_lock</code> è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•ã€‚å¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™è¡¨ç¤ºè·å–äº†é”ï¼Œå¯ä»¥å®‰å…¨åœ°æ‰§è¡Œæ“ä½œã€‚å¦‚æœæ’å…¥å¤±è´¥ï¼Œåˆ™è¯´æ˜é”å·²è¢«å…¶ä»–èŠ‚ç‚¹å ç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `distributed_lock` (`lock_key`, `lock_value`, `expires_at`)</span><br><span class="line">VALUES (&#x27;product_123&#x27;, &#x27;UUID-xxxx&#x27;, DATE_ADD(NOW(), INTERVAL 10 SECOND))</span><br><span class="line">ON DUPLICATE KEY UPDATE</span><br><span class="line">    `lock_value` = IF(`expires_at` &lt; NOW(), &#x27;UUID-xxxx&#x27;, `lock_value`),</span><br><span class="line">    `expires_at` = IF(`expires_at` &lt; NOW(), DATE_ADD(NOW(), INTERVAL 10 SECOND), `expires_at`);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ°äº†è¯„ä»·è¿™ä¸ªæ–¹æ³•çš„ä¼˜åŠ£çš„æ—¶å€™äº†ï¼Œé¦–å…ˆè¿™ä¸ªæ˜¯åŸºäºMySQLçš„ï¼Œé‚£å°±æ˜¯å¤–å­˜ä¸­çš„ï¼Œä¸ç”¨è¯´æ•ˆç‡ä½ï¼Œæ•ˆç‡ä½å¸¦æ¥çš„ç»“æœå°±æ˜¯å¹¶å‘æ€§ä¸é«˜ï¼Œå°±ä¸é€‚åˆé«˜å¹¶å‘çš„æƒ…å†µï¼Œä½†æ˜¯è¯¥æ–¹æ³•æ–¹ä¾¿ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ç”¨ã€‚</p><blockquote><p>åŸºäº MySQL çš„åˆ†å¸ƒå¼é”é€‚åˆé‚£äº›å¹¶å‘é‡ä¸å¤§ã€é”çš„ç²’åº¦è¾ƒç²—çš„åœºæ™¯ï¼Œå¦‚ä»»åŠ¡è°ƒåº¦ã€å®šæ—¶ä»»åŠ¡ç­‰ã€‚å¯¹äºé«˜å¹¶å‘ã€ä½å»¶è¿Ÿè¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨æ›´é«˜æ•ˆçš„åˆ†å¸ƒå¼é”å®ç°ï¼Œå¦‚ Redis æˆ– ZooKeeperã€‚</p><p><strong><code>ON DUPLICATE KEY UPDATE</code></strong>ï¼šè¿™ä¸ªè¯­å¥çš„ä½œç”¨æ˜¯åœ¨æ’å…¥æ–°è®°å½•æ—¶ï¼Œå¦‚æœ <code>lock_key</code> å·²ç»å­˜åœ¨ï¼ˆæ¯”å¦‚å› ä¸ºä¸»é”®æˆ–å”¯ä¸€çº¦æŸå†²çªï¼‰ï¼Œåˆ™ä¸ä¼šé‡æ–°æ’å…¥ï¼Œè€Œæ˜¯æ‰§è¡Œæ›´æ–°æ“ä½œã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœå·²ç»æœ‰äººæŒæœ‰äº†é”ï¼Œè¿™é‡Œä¼šåˆ¤æ–­é”æ˜¯å¦å·²ç»è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸäº†å°±è®©å½“å‰è¯·æ±‚è·å–é”ã€‚</p></blockquote><h3 id="åŸºäºRediså®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºRediså®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºRediså®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºRediså®ç°åˆ†å¸ƒå¼é”</h3><h4 id="åŸºäºsetnxå®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºsetnxå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºsetnxå®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºsetnxå®ç°åˆ†å¸ƒå¼é”</h4><p>set if not exist &#x3D; setnxï¼›</p><ol><li>åŠ é”ï¼šæ‰§è¡Œsetnxï¼Œè‹¥æˆåŠŸå†æ‰§è¡Œexpireæ·»åŠ è¿‡æœŸæ—¶é—´</li><li>è§£é”ï¼šæ‰§è¡Œdeleteå‘½ä»¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SETNX lock_key unique_value</span><br><span class="line">EXPIRE lock_key 10</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé¦–å…ˆå°±æ˜¯è¿™äº‹ä¸¤ä¸ªæ“ä½œï¼Œä¸æ˜¯åŸå­æ€§çš„ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨æ‰§è¡Œ <code>SETNX</code> åå´©æºƒï¼Œ<code>EXPIRE</code> å‘½ä»¤æ— æ³•æ‰§è¡Œï¼Œå¯¼è‡´è¿™ä¸ªé”æ°¸è¿œä¸ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé€ æˆæ­»é”é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥è§£å†³ï¼šset nx ex</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET lock_key unique_value NX EX 10</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯åŸå­æ€§çš„ã€‚</p><p>åŒæ—¶è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªè¿‡æœŸæ—¶é—´çš„é—®é¢˜ï¼Œå°±æ˜¯æˆ‘è·å–åˆ°é”çš„è¿™ä¸ªçº¿ç¨‹ï¼Œæ— æ³•åœ¨è¿‡æœŸæ—¶é—´å†…å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œå¯¼è‡´åˆ«çš„çº¿ç¨‹è·å¾—äº†é”ï¼Œä»è€Œåˆå¯¼è‡´äº†åˆ†å¸ƒå¼é”çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªåŠ¨ç»­æœŸï¼ˆæ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦å®Œæˆäº†ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å®Œæˆå°±è‡ªåŠ¨çš„å»¶é•¿è¿‡æœŸæ—¶é—´ï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨æ›´æˆç†Ÿçš„æ¯”å¦‚redissonï¼Œè¯¥æä¾›äº†æ›´æˆç†Ÿçš„åˆ†å¸ƒå¼é”çš„è®¾è®¡ã€‚</p><h4 id="åŸºäºRedisçš„Luaè„šæœ¬èƒ½åŠ›"><a href="#åŸºäºRedisçš„Luaè„šæœ¬èƒ½åŠ›" class="headerlink" title="åŸºäºRedisçš„Luaè„šæœ¬èƒ½åŠ›"></a>åŸºäºRedisçš„Luaè„šæœ¬èƒ½åŠ›</h4><p>ä½¿ç”¨ <code>SETNX</code> åˆ›å»ºé”æ—¶ï¼Œå¦‚æœé”è¢«å®¢æˆ·ç«¯æˆåŠŸè·å–å¹¶æŒæœ‰ï¼Œå½“å®¢æˆ·ç«¯ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åéœ€è¦æ‰‹åŠ¨é‡Šæ”¾é”ã€‚ç„¶è€Œï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨é‡Šæ”¾é”ä¹‹å‰å´©æºƒæˆ–è€…å‡ºç°äº†é”™è¯¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´é”æœªè¢«æ­£ç¡®é‡Šæ”¾ï¼Œæˆ–è€…å…¶ä»–å®¢æˆ·ç«¯é”™è¯¯åœ°é‡Šæ”¾äº†æœ¬ä¸å±äºå®ƒçš„é”ã€‚</p><p>ä½¿ç”¨ <code>DEL</code> å‘½ä»¤æ¥é‡Šæ”¾é”æ—¶ï¼Œå¿…é¡»ç¡®ä¿åªæœ‰æŒæœ‰é”çš„å®¢æˆ·ç«¯æ‰å¯ä»¥é‡Šæ”¾å®ƒã€‚ä¸ºæ­¤ï¼Œå¯ä»¥å°† <code>unique_value</code> è®¾ç½®ä¸ºå”¯ä¸€å€¼ï¼ˆå¦‚ UUIDï¼‰ï¼Œå¹¶é€šè¿‡ Lua è„šæœ¬ç¡®ä¿åªæœ‰åœ¨æŒæœ‰é”çš„å®¢æˆ·ç«¯æ‰èƒ½åˆ é™¤é”ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if redis.call(&quot;GET&quot;, &quot;lock_key&quot;) == &quot;unique_value&quot; then</span><br><span class="line">    return redis.call(&quot;DEL&quot;, &quot;lock_key&quot;)</span><br><span class="line">else</span><br><span class="line">    return 0</span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="åŸºäºRedissonå®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºRedissonå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºRedissonå®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºRedissonå®ç°åˆ†å¸ƒå¼é”</h4><p>å‚è€ƒèµ„æ–™</p><ul><li><a href="https://blog.csdn.net/asd051377305/article/details/108384490">Redisåˆ†å¸ƒå¼é”-è¿™ä¸€ç¯‡å…¨äº†è§£(Redissionå®ç°åˆ†å¸ƒå¼é”å®Œç¾æ–¹æ¡ˆ)</a></li><li><a href="https://www.cnblogs.com/jackson0714">7å¹´ä¸€çº¿äº’è”ç½‘ç»éªŒï¼Œè¶…çˆ±å›¾è§£åº•å±‚åŸç†ï¼Œå…¨æ ˆä¸€æš</a></li></ul><p>é‡ç‚¹å…³æ³¨è¿™ä¸ªæ–¹å¼å®ç°ï¼Œåœ¨ä»¥åä¼šç»å¸¸ä½¿ç”¨è¿™ä¸ªRedissonæ¥å®ç°åˆ†å¸ƒå¼é”ã€‚</p><h3 id="åŸºäºZookeeperå®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºZookeeperå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºZookeeperå®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºZookeeperå®ç°åˆ†å¸ƒå¼é”</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262035946.png" alt="image-20241015202529403"></p><p>ä¼˜ç‚¹ï¼šä¸å¿…å¤šè¯´ï¼Œå¯ä»¥ä¿è¯é«˜å¯ç”¨ï¼Œæ¯•ç«Ÿæ˜¯ä¸“ä¸šçš„ï¼ŒCuratoræ¡†æ¶å·²åŸç”Ÿæ”¯æŒç³»åˆ—åˆ†å¸ƒå¼é”å‘½ä»¤ï¼Œä½¿ç”¨ç®€å•</p><p>ç¼ºç‚¹ï¼šä¹Ÿä¸å¿…å¤šè¯´ï¼Œæˆæœ¬é«˜ï¼Œéœ€è¦å•ç‹¬ç»´æŠ¤ä¸€å¥—ZKé›†ç¾¤ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-12 CryptGuard</title>
      <link href="/2025/02/26/75-12%20CryptGuard/"/>
      <url>/2025/02/26/75-12%20CryptGuard/</url>
      
        <content type="html"><![CDATA[<h1 id="75-12-CryptGuard"><a href="#75-12-CryptGuard" class="headerlink" title="75-12 CryptGuard"></a>75-12 CryptGuard</h1><h2 id="ä»£ç æ¡ˆä¾‹"><a href="#ä»£ç æ¡ˆä¾‹" class="headerlink" title="ä»£ç æ¡ˆä¾‹"></a>ä»£ç æ¡ˆä¾‹</h2><h3 id="ç¼–å†™è‡ªåŠ¨é…ç½®ç±»"><a href="#ç¼–å†™è‡ªåŠ¨é…ç½®ç±»" class="headerlink" title="ç¼–å†™è‡ªåŠ¨é…ç½®ç±»"></a>ç¼–å†™è‡ªåŠ¨é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.encryption;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;gateway.encryption.enabled&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptionConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean&lt;RequestDecryptFilter&gt; <span class="title function_">requestDecryptFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        FilterRegistrationBean&lt;RequestDecryptFilter&gt; registrationBean = <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;();</span><br><span class="line">        registrationBean.setFilter(<span class="keyword">new</span> <span class="title class_">RequestDecryptFilter</span>());</span><br><span class="line">        registrationBean.addUrlPatterns(<span class="string">&quot;/api/*&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean&lt;ResponseEncryptFilter&gt; <span class="title function_">responseEncryptFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        FilterRegistrationBean&lt;ResponseEncryptFilter&gt; registrationBean = <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;();</span><br><span class="line">        registrationBean.setFilter(<span class="keyword">new</span> <span class="title class_">ResponseEncryptFilter</span>());</span><br><span class="line">        registrationBean.addUrlPatterns(<span class="string">&quot;/api/*&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å“åº”filter"><a href="#å“åº”filter" class="headerlink" title="å“åº”filter"></a>å“åº”filter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.encryption;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/api/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseEncryptFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(javax.servlet.ServletRequest request, javax.servlet.ServletResponse response, FilterChain chain)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpRequest</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line"></span><br><span class="line">        <span class="type">ResponseWrapper</span> <span class="variable">responseWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseWrapper</span>(httpResponse);</span><br><span class="line">        chain.doFilter(request, responseWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> responseWrapper.getResponseContent();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">encryptedResponse</span> <span class="operator">=</span> EncryptUtils.encrypt(responseBody);</span><br><span class="line">            httpResponse.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">            <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> httpResponse.getWriter();</span><br><span class="line">            out.write(encryptedResponse);</span><br><span class="line">            out.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            httpResponse.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, <span class="string">&quot;Encryption error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é”€æ¯é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseWrapper</span> <span class="keyword">extends</span> <span class="title class_">HttpServletResponseWrapper</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> StringBuilder responseContent;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ResponseWrapper</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(response);</span><br><span class="line">            responseContent = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> PrintWriter <span class="title function_">getWriter</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="keyword">new</span> <span class="title class_">StringBuilderWriter</span>(responseContent));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getResponseContent</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> responseContent.toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">StringBuilderWriter</span> <span class="keyword">extends</span> <span class="title class_">java</span>.io.Writer &#123;</span><br><span class="line">            <span class="keyword">private</span> StringBuilder stringBuilder;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">StringBuilderWriter</span><span class="params">(StringBuilder stringBuilder)</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.stringBuilder = stringBuilder;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(<span class="type">char</span>[] cbuf, <span class="type">int</span> off, <span class="type">int</span> len)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                stringBuilder.append(cbuf, off, len);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flush</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚filter"><a href="#è¯·æ±‚filter" class="headerlink" title="è¯·æ±‚filter"></a>è¯·æ±‚filter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.cryptguard.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.cryptguard.util.CryptUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CryptFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">// è§£å¯†è¯·æ±‚å‚æ•°</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="type">URI</span> <span class="variable">originalUri</span> <span class="operator">=</span> request.getURI();</span><br><span class="line">        <span class="type">String</span> <span class="variable">decryptedPath</span> <span class="operator">=</span> CryptUtil.decrypt(originalUri.getPath());</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Original URI: &#123;&#125;, Decrypted Path: &#123;&#125;&quot;</span>, originalUri, decryptedPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£å¯†è¯·æ±‚å‚æ•°</span></span><br><span class="line">        Map&lt;String, String&gt; decryptedQueryParams = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        request.getQueryParams().forEach((key, value) -&gt; &#123;</span><br><span class="line">            decryptedQueryParams.put(CryptUtil.decrypt(key), CryptUtil.decrypt(value.get(<span class="number">0</span>)));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Decrypted Query Params: &#123;&#125;&quot;</span>, decryptedQueryParams);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–°çš„è¯·æ±‚å¯¹è±¡</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">mutatedRequest</span> <span class="operator">=</span> request.mutate()</span><br><span class="line">                .path(decryptedPath)</span><br><span class="line">                .uri(URI.create(decryptedPath)) <span class="comment">// æ–°è§£å¯†è·¯å¾„</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿®æ”¹è¯·æ±‚äº¤æ¢å¯¹è±¡</span></span><br><span class="line">        <span class="type">ServerWebExchange</span> <span class="variable">mutatedExchange</span> <span class="operator">=</span> exchange.mutate()</span><br><span class="line">                .request(mutatedRequest)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤„ç†å“åº”</span></span><br><span class="line">        <span class="keyword">return</span> chain.filter(mutatedExchange).then(Mono.fromRunnable(() -&gt; &#123;</span><br><span class="line">            <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> mutatedExchange.getResponse();</span><br><span class="line">            <span class="comment">// æ¨¡æ‹ŸåŠ å¯†å“åº”å†…å®¹</span></span><br><span class="line">            response.getHeaders().add(<span class="string">&quot;X-Encrypted&quot;</span>, CryptUtil.encrypt(<span class="string">&quot;Response Encrypted&quot;</span>));</span><br><span class="line">            log.info(<span class="string">&quot;Response processed and encrypted.&quot;</span>);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>; <span class="comment">// é«˜ä¼˜å…ˆçº§</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="RequestDecryptFilterä»£ç ä»‹ç»"><a href="#RequestDecryptFilterä»£ç ä»‹ç»" class="headerlink" title="RequestDecryptFilterä»£ç ä»‹ç»"></a>RequestDecryptFilterä»£ç ä»‹ç»</h2><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå¯¹GateWayçš„è¯·æ±‚çš„å‚æ•°å’ŒURLè¿›è¡Œè§£å¯†åå†äº¤ç”±å¯¹åº”çš„æ¥å£è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œæ¶‰åŠåˆ°å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>ç”¨æˆ·å¦‚ä½•é€šè¿‡é…ç½®æ¥æŒ‡å®šçš„URLæ¥è¿›è¡ŒåŠ å¯†ï¼Ÿ</li><li>ç”¨æˆ·éœ€è¦é€šè¿‡é…ç½®æ¥å¯¹è¿™äº›åŠ å¯†è®¾ç½®å¯†é’¥ï¼Œé€šè¿‡è¯»å–é…ç½®æ¥è·å–å¯†é’¥ï¼Œå¦‚æœç”¨æˆ·æ²¡ç”¨è®¾ç½®åˆ™éœ€è¦ä½¿ç”¨é»˜è®¤çš„å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼›</li><li>ç”¨æˆ·ä¸åº”å½“å¯¹éç»“æ„åŒ–çš„æ•°æ®è¿›è¡ŒåŠ å¯†å¤„ç†ï¼ˆåƒå›¾ç‰‡ã€è§†é¢‘ç­‰ç›¸å…³æ•°æ®è¿›è¡ŒåŠ å¯†ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.cryptguard.filter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilterChain;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> RequestDecryptFilter</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> è®¾ç½®è¿‡æ»¤å™¨ä½¿å¾—ç½‘å…³å±‚å¯¹æ‰€æœ‰æŒ‡å®šçš„è¯·æ±‚è¿›è¡Œè§£å¯†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-12-04</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDecryptFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span>,Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;RequestDecryptFilter running&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="type">URI</span> <span class="variable">originalUri</span> <span class="operator">=</span> request.getURI();</span><br><span class="line">        <span class="type">String</span> <span class="variable">decryptedPath</span> <span class="operator">=</span> <span class="string">&quot;/api/crypt/getTest&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">decryptedAuthority</span> <span class="operator">=</span> originalUri.getScheme() + <span class="string">&quot;://&quot;</span> +  originalUri.getAuthority() + <span class="string">&quot;/api/crypt/getTest&quot;</span>;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Original URI: &#123;&#125;, Decrypted Path: &#123;&#125;&quot;</span>, originalUri, decryptedPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–°çš„è¯·æ±‚å¯¹è±¡</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">mutatedRequest</span> <span class="operator">=</span> request.mutate()</span><br><span class="line">                .path(decryptedPath)</span><br><span class="line">                .uri(URI.create(decryptedAuthority)) <span class="comment">// æ–°è§£å¯†è·¯å¾„</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿®æ”¹è¯·æ±‚äº¤æ¢å¯¹è±¡</span></span><br><span class="line">        <span class="type">ServerWebExchange</span> <span class="variable">mutatedExchange</span> <span class="operator">=</span> exchange.mutate()</span><br><span class="line">                .request(mutatedRequest)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chain.filter(mutatedExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Ordered.HIGHEST_PRECEDENCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ResponseEncryptFilterä»£ç ä»‹ç»"><a href="#ResponseEncryptFilterä»£ç ä»‹ç»" class="headerlink" title="ResponseEncryptFilterä»£ç ä»‹ç»"></a>ResponseEncryptFilterä»£ç ä»‹ç»</h2><p>è¯¥ä»£ç é€šè¿‡æ‹¦æˆªæ¥å£çš„å“åº”ï¼Œç„¶åæ‹¼æ¥åœ¨ä¸€èµ·ä»æ–°è§£å¯†ä¹‹åå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™é‡Œæ¶‰åŠåˆ°å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>ä¸ºä»€ä¹ˆåœ¨GateWayä¸­éœ€è¦å°†è¿™äº›å“åº”æ‹¼æ¥ä¹‹åå†è¿›è¡Œè§£å¯†è¿”å›ï¼Ÿ</li><li>æˆ‘è¯¥å¦‚ä½•è®¾ç½®ä¸€ä¸ªæ–°çš„å“åº”ç„¶åè¿›è¡Œè¿”å›ï¼Ÿ</li><li>GateWayä¸­å¯¹è¯·æ±‚å’Œå“åº”çš„æ“ä½œç±»æ˜¯ä»€ä¹ˆï¼Ÿè¿™ä¸é€šå¸¸çš„Webç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ï¼Ÿ</li><li>åœ¨è¿™ä¸ªè¿‡æ»¤å™¨ä¸­è¯¥å¦‚ä½•æŒ‡å®šå¯¹å¯¹åº”çš„æ¥å£å“åº”è¿›è¡ŒåŠ å¯†åè¿”å›ï¼Ÿ</li><li></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.cryptguard.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.micrometer.common.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.buffer.DataBuffer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.buffer.DataBufferFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.buffer.DataBufferUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpResponseDecorator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilterChain;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.cloud.gateway.support.ServerWebExchangeUtils.ORIGINAL_RESPONSE_CONTENT_TYPE_ATTR;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> ResponseEncryptFilter</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> è®¾ç½®è¿‡æ»¤å™¨ä½¿å¾—ç½‘å…³å±‚å¯¹æ‰€æœ‰æŒ‡å®šçš„å“åº”è¿›è¡ŒåŠ å¯†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-12-04</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseEncryptFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®æ‹¦æˆªå™¨ä¼˜å…ˆçº§</span></span><br><span class="line">        <span class="keyword">return</span> Ordered.HIGHEST_PRECEDENCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ResponseEncryptFilter running&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">originalResponse</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         ä»åŸå§‹çš„ ServerHttpResponse å¯¹è±¡ä¸­è·å–ä¸€ä¸ª DataBufferFactory å®ä¾‹ï¼Œæ¥å¤„ç†å“åº”ä½“çš„æ•°æ®ç¼“å†²åŒºã€‚</span></span><br><span class="line"><span class="comment">         bufferFactory: DataBufferFactory æ˜¯ä¸€ä¸ªå·¥å‚æ¥å£ï¼Œç”¨äºåˆ›å»º DataBuffer å¯¹è±¡ã€‚DataBuffer æ˜¯ä¸€ç§è¡¨ç¤ºæ•°æ®ç¼“å†²åŒºçš„å¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment">                        é€šå¸¸ç”¨äºå¤„ç† I/O æ“ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å“åº”ä½“å’Œè¯·æ±‚ä½“çš„æ•°æ®æµæ—¶ã€‚å®ƒæä¾›äº†å¯¹å­—èŠ‚æ•°æ®çš„ä½çº§å¤„ç†èƒ½åŠ›ã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">DataBufferFactory</span> <span class="variable">bufferFactory</span> <span class="operator">=</span> originalResponse.bufferFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè£…é¥°å™¨ä»¥ä¿®æ”¹å“åº”æ•°æ®</span></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ª ServerHttpResponseDecoratorï¼Œç”¨äºè£…é¥°åŸå§‹å“åº”å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨å“åº”å†™å…¥è¿‡ç¨‹ä¸­å¯¹å“åº”ä½“è¿›è¡Œä¿®æ”¹</span></span><br><span class="line">        <span class="comment">// ServerHttpResponseDecorator æ˜¯ä¸€ä¸ªç”¨äºè£…é¥° ServerHttpResponse çš„ç±»ï¼Œå…è®¸ä½ åœ¨å“åº”ä½“å†™å…¥å‰æˆ–å†™å…¥è¿‡ç¨‹ä¸­ä¿®æ”¹å“åº”æ•°æ®ã€‚</span></span><br><span class="line">        <span class="comment">// é€šè¿‡é‡å†™ writeWith æ–¹æ³•ï¼Œå¯ä»¥åœ¨å“åº”ä½“ä¼ è¾“ä¹‹å‰å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå¦‚ä¿®æ”¹ã€åŠ å¯†ã€å‹ç¼©ç­‰æ“ä½œã€‚</span></span><br><span class="line">        <span class="type">ServerHttpResponseDecorator</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerHttpResponseDecorator</span>(originalResponse) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é‡å†™ writeWith æ–¹æ³•ï¼Œå…è®¸å¯¹å“åº”ä½“çš„å†…å®¹è¿›è¡Œä¿®æ”¹</span></span><br><span class="line">            <span class="comment">// åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼ŒSpring Gatewayç›´æ¥å°†æœåŠ¡ç«¯çš„å“åº”ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚è€Œé€šè¿‡é‡å†™writeWithæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€è¯»å–ã€å¤„ç†æˆ–æ›¿æ¢å“åº”å†…å®¹ï¼Œ</span></span><br><span class="line">            <span class="comment">// ç„¶åå†å°†ä¿®æ”¹åçš„å“åº”æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">writeWith</span><span class="params">(Publisher&lt;? extends DataBuffer&gt; body)</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ£€æŸ¥å“åº”çš„çŠ¶æ€ç æ˜¯å¦ä¸º 200 OKï¼Œä¸”å“åº”ä½“æ˜¯ Fluxï¼ˆå¼‚æ­¥æ•°æ®æµï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (Objects.equals(getStatusCode(), HttpStatus.OK) &amp;&amp; body <span class="keyword">instanceof</span> Flux) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// è·å–å“åº”çš„ Content-Type å±æ€§ï¼Œç”¨äºåˆ¤æ–­å“åº”æ˜¯å¦æ˜¯ JSON æˆ–æ–‡æœ¬æ ¼å¼</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">originalResponseContentType</span> <span class="operator">=</span> exchange.getAttribute(ORIGINAL_RESPONSE_CONTENT_TYPE_ATTR);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// å¦‚æœå“åº”çš„ Content-Type ä¸º &quot;application/json&quot; æˆ– &quot;text/plain&quot;ï¼Œåˆ™éœ€è¦å¯¹å“åº”ä½“è¿›è¡Œå¤„ç†</span></span><br><span class="line">                    <span class="keyword">if</span> (StringUtils.isNotBlank(originalResponseContentType)</span><br><span class="line">                            &amp;&amp; (originalResponseContentType.contains(<span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">                            || originalResponseContentType.contains(<span class="string">&quot;text/plain&quot;</span>))) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// å°† body è½¬æ¢ä¸º Flux æ•°æ®æµï¼ŒFlux æ˜¯å“åº”ä½“çš„å¼‚æ­¥æ•°æ®æµ</span></span><br><span class="line">                        Flux&lt;? <span class="keyword">extends</span> <span class="title class_">DataBuffer</span>&gt; fluxBody = Flux.from(body);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// å¯¹å“åº”ä½“è¿›è¡Œä¿®æ”¹ï¼Œè¯»å–åŸå§‹æ•°æ®å¹¶è¿›è¡Œæ‹¼æ¥</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="built_in">super</span>.writeWith(fluxBody.buffer().map(dataBuffers -&gt; &#123;</span><br><span class="line">                            List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// éå†æ‰€æœ‰ DataBufferï¼Œè¯»å–å…¶å†…å®¹ï¼Œå¹¶å°†å†…å®¹åˆå¹¶ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">                            dataBuffers.forEach(dataBuffer -&gt; &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    <span class="comment">// ä» DataBuffer ä¸­è¯»å–å­—èŠ‚å¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">                                    <span class="type">byte</span>[] content = <span class="keyword">new</span> <span class="title class_">byte</span>[dataBuffer.readableByteCount()];</span><br><span class="line">                                    dataBuffer.read(content);</span><br><span class="line">                                    <span class="comment">// é‡Šæ”¾ DataBufferï¼Œé¿å…å†…å­˜æ³„æ¼</span></span><br><span class="line">                                    DataBufferUtils.release(dataBuffer);</span><br><span class="line"></span><br><span class="line">                                    <span class="comment">// å°†å†…å®¹æ·»åŠ åˆ°åˆ—è¡¨ä¸­</span></span><br><span class="line">                                    list.add(<span class="keyword">new</span> <span class="title class_">String</span>(content, StandardCharsets.UTF_8));</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                                    <span class="comment">// é”™è¯¯å¤„ç†ï¼Œæ‰“å°å¼‚å¸¸å †æ ˆ</span></span><br><span class="line">                                    log.error(<span class="string">&quot;è¯»å–å“åº”ä½“å¤±è´¥ï¼š&#123;&#125;&quot;</span>, getStackTraceAsString(e));</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// åˆå¹¶æ‰€æœ‰éƒ¨åˆ†çš„å“åº”ä½“å†…å®¹</span></span><br><span class="line">                            <span class="type">String</span> <span class="variable">responseData</span> <span class="operator">=</span> String.join(<span class="string">&quot;&quot;</span>, list); <span class="comment">// å°†å„éƒ¨åˆ†æ•°æ®æŒ‰ç©ºå­—ç¬¦ä¸²æ‹¼æ¥</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">// ä¿®æ”¹å“åº”ä½“å†…å®¹ï¼Œè¿™é‡Œç›´æ¥å°†å“åº”å†…å®¹æ›¿æ¢ä¸º &quot;fang&quot;</span></span><br><span class="line">                            responseData = <span class="string">&quot;fang&quot;</span>;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// å°†ä¿®æ”¹åçš„å“åº”ä½“è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„å¹¶å°è£…ä¸º DataBuffer</span></span><br><span class="line">                            <span class="type">byte</span>[] modifiedContent = responseData.getBytes(StandardCharsets.UTF_8);</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// æ›´æ–°å“åº”å¤´ä¸­çš„ Content-Length</span></span><br><span class="line">                            originalResponse.getHeaders().setContentLength(modifiedContent.length);</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// ä½¿ç”¨ bufferFactory å°è£…ä¿®æ”¹åçš„å­—èŠ‚æ•°ç»„ä¸º DataBuffer</span></span><br><span class="line">                            <span class="keyword">return</span> bufferFactory.wrap(modifiedContent);</span><br><span class="line">                        &#125;));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¦‚æœå“åº”ä¸ç¬¦åˆå¤„ç†æ¡ä»¶ï¼Œç›´æ¥è¿”å›åŸå§‹å“åº”</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">super</span>.writeWith(body);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é‡å†™ writeAndFlushWith æ–¹æ³•ï¼Œä»¥ä¾¿å¤„ç†æ›´å¤šå¤æ‚çš„å“åº”ä½“å†™å…¥æƒ…å½¢</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">writeAndFlushWith</span><span class="params">(Publisher&lt;? extends Publisher&lt;? extends DataBuffer&gt;&gt; body)</span> &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨ flatMapSequential æ¥å°†å¤šä¸ªæ•°æ®æµåˆå¹¶å¤„ç†</span></span><br><span class="line">                <span class="keyword">return</span> writeWith(Flux.from(body).flatMapSequential(p -&gt; p));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨è£…é¥°åçš„å“åº”æ›¿æ¢åŸå§‹å“åº”</span></span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange.mutate().response(response).build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getStackTraceAsString</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">        <span class="type">StringWriter</span> <span class="variable">sw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>();</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(sw);</span><br><span class="line">        throwable.printStackTrace(pw);</span><br><span class="line">        <span class="keyword">return</span> sw.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•é€šè¿‡é…ç½®çš„æ–¹å¼ä½¿å¾—ç”¨æˆ·å¯¹å¯†é’¥è¿›è¡Œå¯é…ç½®"><a href="#å¦‚ä½•é€šè¿‡é…ç½®çš„æ–¹å¼ä½¿å¾—ç”¨æˆ·å¯¹å¯†é’¥è¿›è¡Œå¯é…ç½®" class="headerlink" title="å¦‚ä½•é€šè¿‡é…ç½®çš„æ–¹å¼ä½¿å¾—ç”¨æˆ·å¯¹å¯†é’¥è¿›è¡Œå¯é…ç½®"></a>å¦‚ä½•é€šè¿‡é…ç½®çš„æ–¹å¼ä½¿å¾—ç”¨æˆ·å¯¹å¯†é’¥è¿›è¡Œå¯é…ç½®</h2><h3 id="Beanä¸-Import"><a href="#Beanä¸-Import" class="headerlink" title="@Beanä¸@Import"></a>@Beanä¸@Import</h3><blockquote><h3 id="è¯¦ç»†ä»‹ç»-Import-æ³¨è§£åŸç†"><a href="#è¯¦ç»†ä»‹ç»-Import-æ³¨è§£åŸç†" class="headerlink" title="è¯¦ç»†ä»‹ç» @Import æ³¨è§£åŸç†"></a>è¯¦ç»†ä»‹ç» <code>@Import</code> æ³¨è§£åŸç†</h3><p>åœ¨ Spring ä¸­ï¼Œ<code>@Import</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ³¨è§£ï¼Œå®ƒå…è®¸ä½ å°†ä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®ç±»ï¼ˆæˆ–å…¶ä»–ç±»å‹çš„ç±»ï¼‰å¼•å…¥åˆ°å½“å‰çš„ Spring é…ç½®ä¸­ã€‚å½“ä¸€ä¸ªç±»è¢« <code>@Import</code> å¼•å…¥æ—¶ï¼Œå®ƒä¼šè¢«å½“ä½œ Spring Bean é…ç½®çš„ä¸€éƒ¨åˆ†è¿›è¡Œå¤„ç†ï¼Œæ‰€æœ‰åœ¨è¯¥ç±»ä¸­å®šä¹‰çš„ <code>@Configuration</code>ã€<code>@Bean</code> ç­‰æ–¹æ³•éƒ½ä¼šè¢«è‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œä¸º Spring Beanã€‚</p><h4 id="1-Import-çš„ä½œç”¨"><a href="#1-Import-çš„ä½œç”¨" class="headerlink" title="1. @Import çš„ä½œç”¨"></a>1. <strong><code>@Import</code> çš„ä½œç”¨</strong></h4><p><code>@Import</code> æ³¨è§£å¯ä»¥ç”¨æ¥å¼•å…¥ä»¥ä¸‹å‡ ç§ç±»å‹çš„ç±»ï¼š</p><ul><li><strong><code>@Configuration</code> ç±»</strong>ï¼šè¿™ç§æ–¹å¼æœ€å¸¸è§ï¼Œé€šå¸¸ç”¨äºå°†å…¶ä»–é…ç½®ç±»æ·»åŠ åˆ°å½“å‰çš„åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ã€‚</li><li><strong><code>@ImportSelector</code> å®ç°ç±»</strong>ï¼šå¦‚æœéœ€è¦åŠ¨æ€é€‰æ‹©è¦å¼•å…¥çš„ç±»ï¼Œå¯ä»¥å®ç° <code>ImportSelector</code> æ¥å£å¹¶è¿”å›éœ€è¦å¼•å…¥çš„ç±»ã€‚</li><li><strong><code>@ImportBeanDefinitionRegistrar</code> å®ç°ç±»</strong>ï¼šè¿™ç§æ–¹å¼å…è®¸åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œæ›´å¤æ‚çš„ Bean å®šä¹‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç›´æ¥é€šè¿‡ <code>BeanDefinition</code> æ³¨å†Œ Beanï¼Œè€Œä¸æ˜¯é€šè¿‡ <code>@Bean</code> æ–¹æ³•ã€‚</li></ul><p>å½“ä½ ä½¿ç”¨ <code>@Import(CryptGuardConfiguration.class)</code> æ—¶ï¼ŒSpring ä¼šè‡ªåŠ¨å¼•å…¥ <code>CryptGuardConfiguration</code> ç±»ï¼Œ<code>CryptGuardConfiguration</code> ç±»ä¸­å£°æ˜çš„ <code>@Configuration</code> å’Œ <code>@Bean</code> ä¼šè¢«æ³¨å†Œåˆ° Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ã€‚</p><h3 id="2-Import-çš„å·¥ä½œæœºåˆ¶"><a href="#2-Import-çš„å·¥ä½œæœºåˆ¶" class="headerlink" title="2. @Import çš„å·¥ä½œæœºåˆ¶"></a>2. <strong><code>@Import</code> çš„å·¥ä½œæœºåˆ¶</strong></h3><ul><li><strong>è‡ªåŠ¨æ‰«æ</strong>ï¼š<code>@Import</code> å¼•å…¥çš„é…ç½®ç±»ä¼šåƒå…¶ä»–é…ç½®ç±»ä¸€æ ·ï¼Œè¿›å…¥ Spring çš„è‡ªåŠ¨é…ç½®æ‰«æè¿‡ç¨‹ä¸­ã€‚Spring ä¼šæŸ¥æ‰¾è¯¥é…ç½®ç±»ä¸­çš„ <code>@Bean</code> æ–¹æ³•å¹¶åˆ›å»ºç›¸åº”çš„ Beanã€‚</li><li><strong>æ— éœ€æ‰‹åŠ¨æ³¨å†Œ Bean</strong>ï¼š<code>@Import</code> ä¼šè‡ªåŠ¨æ³¨å†Œç±»ä¸­çš„æ‰€æœ‰ <code>@Bean</code> å®šä¹‰ã€‚ä½ æ— éœ€æ‰‹åŠ¨å£°æ˜è¿™äº› Beanã€‚</li></ul><h3 id="ç¤ºä¾‹ï¼šä½¿ç”¨-Import-æ³¨è§£"><a href="#ç¤ºä¾‹ï¼šä½¿ç”¨-Import-æ³¨è§£" class="headerlink" title="ç¤ºä¾‹ï¼šä½¿ç”¨ @Import æ³¨è§£"></a>ç¤ºä¾‹ï¼šä½¿ç”¨ <code>@Import</code> æ³¨è§£</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>CryptGuardConfiguration</code> é…ç½®ç±»ï¼Œå®ƒåœ¨ <code>A</code> åŒ…ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AåŒ…ä¸­çš„é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CryptGuardConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CryptGuardProperties <span class="title function_">cryptGuardProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CryptGuardProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RequestDecryptFilter <span class="title function_">requestDecryptFilter</span><span class="params">(CryptGuardProperties cryptGuardProperties)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RequestDecryptFilter</span>(cryptGuardProperties);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª <code>CryptGuardConfig</code> é…ç½®ç±»åœ¨ <code>B</code> åŒ…ä¸­ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>@Import</code> å¼•å…¥ <code>CryptGuardConfiguration</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BåŒ…ä¸­çš„é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(CryptGuardConfiguration.class)</span>  <span class="comment">// å¼•å…¥AåŒ…ä¸­çš„é…ç½®ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CryptGuardConfig</span> &#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥æ·»åŠ å…¶ä»–é…ç½®æˆ–@Beanå®šä¹‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼ŒSpring ä¼šè‡ªåŠ¨åŠ è½½ <code>CryptGuardConfiguration</code> ç±»ä¸­çš„æ‰€æœ‰é…ç½®ï¼ŒåŒ…æ‹¬ <code>@Bean</code> æ–¹æ³•ï¼Œæ³¨å†Œä¸º Spring ä¸Šä¸‹æ–‡ä¸­çš„ Beanã€‚æˆ‘ä»¬æ— éœ€æ‰‹åŠ¨æ·»åŠ  <code>@Bean</code> æ–¹æ³•ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚</p><h3 id="3-æ‰‹åŠ¨å£°æ˜-Bean-ä¸-Import-çš„åŒºåˆ«"><a href="#3-æ‰‹åŠ¨å£°æ˜-Bean-ä¸-Import-çš„åŒºåˆ«" class="headerlink" title="3. æ‰‹åŠ¨å£°æ˜ @Bean ä¸ @Import çš„åŒºåˆ«"></a>3. <strong>æ‰‹åŠ¨å£°æ˜ <code>@Bean</code> ä¸ <code>@Import</code> çš„åŒºåˆ«</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CryptGuardConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CryptGuardConfiguration <span class="title function_">cryptGuardConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;CryptGuardConfiguration Bean init&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CryptGuardConfiguration</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨é€šè¿‡ <code>@Bean</code> å£°æ˜äº† <code>CryptGuardConfiguration</code> Beanã€‚ä¸é€šè¿‡ <code>@Import</code> å¼•å…¥é…ç½®ç±»çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><h4 id="æœ¬è´¨åŒºåˆ«ï¼š"><a href="#æœ¬è´¨åŒºåˆ«ï¼š" class="headerlink" title="æœ¬è´¨åŒºåˆ«ï¼š"></a><strong>æœ¬è´¨åŒºåˆ«</strong>ï¼š</h4><ul><li><p><strong>æ‰‹åŠ¨å£°æ˜ <code>@Bean</code></strong>ï¼šæ‰‹åŠ¨å£°æ˜ <code>@Bean</code> æ–¹æ³•éœ€è¦æ˜ç¡®åœ¨å½“å‰é…ç½®ç±»ä¸­åˆ›å»º <code>CryptGuardConfiguration</code> çš„å®ä¾‹ã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œ<code>cryptGuardConfiguration</code> æ–¹æ³•è¿”å›çš„ <code>CryptGuardConfiguration</code> å®ä¾‹å°†ä½œä¸ºä¸€ä¸ªæ™®é€šçš„ Spring Bean åŠ å…¥åˆ°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼æ²¡æœ‰è‡ªåŠ¨åŠ è½½ <code>CryptGuardConfiguration</code> ä¸­çš„å…¶ä»–é…ç½®ï¼Œå› æ­¤ï¼Œå¦‚æœ <code>CryptGuardConfiguration</code> ç±»ä¸­æœ‰å…¶ä»–çš„ <code>@Bean</code> æ–¹æ³•ï¼Œå®ƒä»¬ä¸ä¼šè¢«è‡ªåŠ¨æ³¨å†Œï¼Œéœ€è¦æ˜¾å¼è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CryptGuardConfiguration <span class="title function_">cryptGuardConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;CryptGuardConfiguration Bean init&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CryptGuardConfiguration</span>();  <span class="comment">// æ‰‹åŠ¨åˆ›å»ºå®ä¾‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>é€šè¿‡ <code>@Import</code> å¼•å…¥é…ç½®ç±»</strong>ï¼šé€šè¿‡ <code>@Import</code> å¼•å…¥é…ç½®ç±»æ—¶ï¼Œ<code>CryptGuardConfiguration</code> ç±»ä¸­çš„æ‰€æœ‰ <code>@Bean</code> æ–¹æ³•éƒ½ä¼šè¢«è‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œä¸º Spring Beanã€‚Spring ä¼šè‡ªåŠ¨åˆ›å»º <code>CryptGuardConfiguration</code> ä¸­å®šä¹‰çš„æ‰€æœ‰ Beanï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºå®ƒä»¬ã€‚è¿™æ˜¯ä¸€ç§æ›´ç®€æ´å’Œæ›´æ¨èçš„æ–¹å¼æ¥å°†å…¶ä»–é…ç½®ç±»çº³å…¥å½“å‰é…ç½®ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(CryptGuardConfiguration.class)</span>  <span class="comment">// è‡ªåŠ¨åŠ è½½é…ç½®ç±»ä¸­çš„@Beanæ–¹æ³•</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="å·¥ä½œåŸç†ä¸Šçš„å·®å¼‚ï¼š"><a href="#å·¥ä½œåŸç†ä¸Šçš„å·®å¼‚ï¼š" class="headerlink" title="å·¥ä½œåŸç†ä¸Šçš„å·®å¼‚ï¼š"></a><strong>å·¥ä½œåŸç†ä¸Šçš„å·®å¼‚</strong>ï¼š</h4><ol><li><p>é€šè¿‡ <code>@Import</code></p><p>ï¼š</p><ul><li><strong>è‡ªåŠ¨æ‰«æ</strong>ï¼š<code>CryptGuardConfiguration</code> ç±»ä¼šè¢«å¼•å…¥ï¼Œæ‰€æœ‰ <code>@Bean</code> æ–¹æ³•ä¼šè‡ªåŠ¨è¢«æ‰«æå’Œæ³¨å†Œã€‚</li><li><strong>è§£è€¦</strong>ï¼š<code>@Import</code> ä½¿å¾— A åŒ…ä¸­çš„é…ç½®å’Œ B åŒ…ä¸­çš„é…ç½®è§£è€¦ã€‚B åŒ…æ— éœ€æ‰‹åŠ¨å£°æ˜ <code>@Bean</code>ï¼ŒSpring ä¼šè‡ªåŠ¨ç®¡ç†æ‰€æœ‰é…ç½®ã€‚</li></ul></li><li><p>æ‰‹åŠ¨å£°æ˜ <code>@Bean</code></p><p>ï¼š</p><ul><li><strong>æ˜¾å¼å®ä¾‹åŒ–</strong>ï¼šåœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»º <code>CryptGuardConfiguration</code> å®ä¾‹ã€‚å¦‚æœ <code>CryptGuardConfiguration</code> ç±»ä¸­åŒ…å«å¤šä¸ª Bean æ–¹æ³•ï¼Œéœ€è¦ç¡®ä¿å®ƒä»¬éƒ½è¢«æ­£ç¡®åœ°æ³¨å†Œã€‚</li><li><strong>ä¸è‡ªåŠ¨æ‰«æ</strong>ï¼šå¦‚æœæ²¡æœ‰é€šè¿‡ <code>@Import</code> å¼•å…¥ <code>CryptGuardConfiguration</code>ï¼Œåˆ™ A åŒ…ä¸­çš„ <code>@Bean</code> æ–¹æ³•ä¸ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚</li></ul></li></ol><h3 id="4-ä½•æ—¶ä½¿ç”¨-Importï¼Œä½•æ—¶ä½¿ç”¨-Bean-æ‰‹åŠ¨å£°æ˜"><a href="#4-ä½•æ—¶ä½¿ç”¨-Importï¼Œä½•æ—¶ä½¿ç”¨-Bean-æ‰‹åŠ¨å£°æ˜" class="headerlink" title="4. ä½•æ—¶ä½¿ç”¨ @Importï¼Œä½•æ—¶ä½¿ç”¨ @Bean æ‰‹åŠ¨å£°æ˜"></a>4. <strong>ä½•æ—¶ä½¿ç”¨ <code>@Import</code>ï¼Œä½•æ—¶ä½¿ç”¨ <code>@Bean</code> æ‰‹åŠ¨å£°æ˜</strong></h3><ul><li><strong>ä½¿ç”¨ <code>@Import</code></strong>ï¼šå½“ä½ å¸Œæœ›åœ¨ä¸€ä¸ªæ¨¡å—ä¸­è‡ªåŠ¨åŠ è½½å¦ä¸€ä¸ªæ¨¡å—çš„é…ç½®ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º Bean çš„å®ä¾‹æ—¶ï¼Œä½¿ç”¨ <code>@Import</code> æ˜¯æœ€ç®€å•å’Œæœ€ç›´æ¥çš„æ–¹å¼ã€‚</li><li><strong>æ‰‹åŠ¨å£°æ˜ <code>@Bean</code></strong>ï¼šå¦‚æœä½ éœ€è¦æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œä¾‹å¦‚å¯¹ <code>@Bean</code> åˆ›å»ºè¿‡ç¨‹è¿›è¡Œè‡ªå®šä¹‰ï¼Œæˆ–è€…ä½ æƒ³æ˜ç¡®åˆ›å»ºä¸€ä¸ª Bean å¹¶æ§åˆ¶å®ƒçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨æ‰‹åŠ¨å£°æ˜çš„æ–¹å¼ã€‚</li></ul><h3 id="5-æ€»ç»“ä¸æ¨è"><a href="#5-æ€»ç»“ä¸æ¨è" class="headerlink" title="5. æ€»ç»“ä¸æ¨è"></a>5. <strong>æ€»ç»“ä¸æ¨è</strong></h3><ul><li><strong>ç®€åŒ–é…ç½®</strong>ï¼šä½¿ç”¨ <code>@Import</code> å¼•å…¥é…ç½®ç±»æ˜¯ Spring ä¸­ä¸€ç§å¸¸è§ä¸”æ¨èçš„åšæ³•ï¼Œå¯ä»¥è‡ªåŠ¨åŠ è½½å’Œæ³¨å†Œæ‰€æœ‰ Beanã€‚</li><li><strong>é¿å…å†—ä½™é…ç½®</strong>ï¼šé€šè¿‡ <code>@Import</code> å¯ä»¥é¿å…åœ¨ B åŒ…ä¸­é‡å¤å£°æ˜ä¸ A åŒ…ç›¸åŒçš„ Bean æ–¹æ³•ï¼Œå‡å°‘äº†å†—ä½™ä»£ç ã€‚</li><li><strong>æ›´çµæ´»çš„æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šä½¿ç”¨ <code>@Import</code> å¯ä»¥ä½¿å¾—åº”ç”¨ç¨‹åºçš„é…ç½®æ›´æ¨¡å—åŒ–ï¼Œå°†ä¸åŒçš„æ¨¡å—é…ç½®ç±»ç‹¬ç«‹ç®¡ç†ï¼Œç„¶åé€šè¿‡ <code>@Import</code> ç»„åˆã€‚</li></ul><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>@Import</code> æ˜¯æ›´ç®€æ´ã€è§£è€¦çš„é€‰æ‹©ï¼Œè€Œæ‰‹åŠ¨å£°æ˜ <code>@Bean</code> æ›´é€‚åˆéœ€è¦è‡ªå®šä¹‰ Bean åˆå§‹åŒ–æˆ–æ›´å¤æ‚çš„æƒ…å†µã€‚</p></blockquote><h3 id="CryptGuardåŒ…"><a href="#CryptGuardåŒ…" class="headerlink" title="CryptGuardåŒ…"></a>CryptGuardåŒ…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.cryptguard.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.cryptguard.filter.RequestDecryptFilter;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> CryptGuardProperties</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-12-14</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;custom.crypt&quot;, name = &quot;enable&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(CryptGuardProperties.class)</span> <span class="comment">// ä½¿ CryptGuardProperties è‡ªåŠ¨ç»‘å®š</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CryptGuardConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CryptGuardProperties cryptGuardProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CryptGuardConfiguration</span><span class="params">(CryptGuardProperties cryptGuardProperties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cryptGuardProperties = cryptGuardProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RequestDecryptFilter <span class="title function_">requestDecryptFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;CryptGuardConfiguration RequestDecryptFilter is running&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;CryptGuardProperties is :&quot;</span> + cryptGuardProperties.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RequestDecryptFilter</span>(cryptGuardProperties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.cryptguard.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> CryptGuardProperties</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-12-14</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;custom.crypt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CryptGuardProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶æ˜¯å¦å¯ç”¨é…ç½®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">enable</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éœ€è¦è¿›è¡ŒåŠ å¯†&amp;è§£å¯†çš„API-URLåˆ—è¡¨å‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; secureUrls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®çš„ç§é’¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">privateKey</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç”¨æˆ·é…ç½®ä½¿ç”¨"><a href="#ç”¨æˆ·é…ç½®ä½¿ç”¨" class="headerlink" title="ç”¨æˆ·é…ç½®ä½¿ç”¨"></a>ç”¨æˆ·é…ç½®ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.gateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.cryptguard.config.CryptGuardConfiguration;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> CryptGuardConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-12-09</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(CryptGuardConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CryptGuardConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CryptGuardæ¨¡å—"><a href="#CryptGuardæ¨¡å—" class="headerlink" title="CryptGuardæ¨¡å—"></a>CryptGuardæ¨¡å—</h2><h3 id="åç§°è®¾è®¡"><a href="#åç§°è®¾è®¡" class="headerlink" title="åç§°è®¾è®¡"></a>åç§°è®¾è®¡</h3><h4 id="æ³¨è§£è®¾è®¡"><a href="#æ³¨è§£è®¾è®¡" class="headerlink" title="æ³¨è§£è®¾è®¡"></a><strong>æ³¨è§£è®¾è®¡</strong></h4><table><thead><tr><th><strong>æ³¨è§£åç§°</strong></th><th><strong>ä½œç”¨æè¿°</strong></th></tr></thead><tbody><tr><td><code>@DecryptController</code></td><td>æ ‡è®°åœ¨ <code>Controller</code> ä¸Šï¼Œè‡ªåŠ¨å¯¹æ‰€æœ‰è¯·æ±‚çš„ <strong>URL</strong> å’Œ&#x2F;æˆ– <strong>å‚æ•°</strong> è¿›è¡Œè§£å¯†ï¼Œå¯é€šè¿‡å±æ€§æŒ‡å®šè§£å¯†èŒƒå›´ã€‚</td></tr><tr><td><code>@EncryptController</code></td><td>æ ‡è®°åœ¨ <code>Controller</code> ä¸Šï¼Œè‡ªåŠ¨å¯¹æ‰€æœ‰è¯·æ±‚çš„å“åº”è¿›è¡ŒåŠ å¯†åè¿”å›ã€‚</td></tr><tr><td><code>@CryptController</code></td><td>æ ‡è®°åœ¨ <code>Controller</code> ä¸Šï¼ŒåŒæ—¶å¯¹æ‰€æœ‰è¯·æ±‚çš„ URLã€å‚æ•°è¿›è¡Œè§£å¯†ï¼Œä¸”å¯¹å“åº”è¿›è¡ŒåŠ å¯†ã€‚</td></tr><tr><td><code>@DecryptRequest</code></td><td>æ ‡è®°åœ¨æ–¹æ³•ä¸Šï¼Œé’ˆå¯¹å½“å‰æ–¹æ³•çš„è¯·æ±‚å‚æ•°å’Œ&#x2F;æˆ– URL è¿›è¡Œè§£å¯†ï¼ˆå¯é€šè¿‡å±æ€§æŒ‡å®šèŒƒå›´ï¼‰ã€‚</td></tr><tr><td><code>@EncryptResponse</code></td><td>æ ‡è®°åœ¨æ–¹æ³•ä¸Šï¼Œå¯¹å½“å‰æ–¹æ³•çš„å“åº”æ•°æ®è¿›è¡ŒåŠ å¯†åè¿”å›ã€‚</td></tr><tr><td><code>@CryptMethod</code></td><td>æ ‡è®°åœ¨æ–¹æ³•ä¸Šï¼ŒåŒæ—¶å¯¹è¯·æ±‚ï¼ˆURL å’Œå‚æ•°ï¼‰è¿›è¡Œè§£å¯†ï¼Œå¯¹å“åº”è¿›è¡ŒåŠ å¯†ã€‚</td></tr></tbody></table><hr><p>æ³¨è§£å¯ä»¥æ ‡è®°åœ¨æ–¹æ³•ORæ–¹æ³•å‚æ•°ä¸Šä¸Šï¼Œ</p><ol><li>è¯¥æ³¨è§£å¯ä»¥å¯¹è¯¥è¯·æ±‚çš„æ‰€æœ‰å‚æ•°åŠ å¯†åå†è§£å¯†åé‡æ–°èµ‹å€¼ï¼›</li><li>è¯¥æ³¨è§£å¯ä»¥å¯¹è¯¥è¯·æ±‚çš„æ¯ä¸ªå­—æ®µè¿›è¡ŒåŠ å¯†åè§£å¯†ï¼›</li><li>è¯¥æ³¨è§£æ”¯æŒå¯¹è¯·æ±‚å‚æ•°ä½“ä¸­çš„éƒ¨åˆ†å­—æ®µè¿›è¡Œè§£å¯†ï¼›</li><li>è¯¥æ³¨è§£æ”¯æŒå¯¹å¤šä¸ªè¯·æ±‚å‚æ•°æŒ‡å®šéƒ¨åˆ†è¿›è¡Œè§£å¯†åå¤„ç†ï¼›</li></ol><p><strong><code>@EncryptTransient</code></strong></p><ul><li><strong>ä½œç”¨èŒƒå›´</strong>: ç±»æˆ–å±æ€§</li><li><strong>ä½œç”¨æè¿°</strong>: ç”¨äºæ ‡è®°å¯¹ç±»çš„æ‰€æœ‰å±æ€§æˆ–å•ä¸ªå±æ€§è¿›è¡ŒåŠ å¯†&#x2F;è§£å¯†ï¼Œä½†è¿™äº›åŠ å¯†&#x2F;è§£å¯†åªä½œç”¨äºæ¥å£ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œä¸æ¶‰åŠæ•°æ®åº“å­˜å‚¨ã€‚</li></ul><p><strong><code>@EncryptPersistent</code></strong></p><ul><li><strong>ä½œç”¨èŒƒå›´</strong>: ç±»æˆ–å±æ€§</li><li><strong>ä½œç”¨æè¿°</strong>: ç”¨äºæ ‡è®°å¯¹ç±»çš„æ‰€æœ‰å±æ€§æˆ–å•ä¸ªå±æ€§è¿›è¡ŒåŠ å¯†åä¿å­˜åˆ°æ•°æ®åº“ï¼Œä»æ•°æ®åº“è¯»å–æ—¶ä¼šè¿›è¡Œè§£å¯†ã€‚</li></ul><h4 id="åˆ‡é¢è®¾è®¡"><a href="#åˆ‡é¢è®¾è®¡" class="headerlink" title="åˆ‡é¢è®¾è®¡"></a><strong>åˆ‡é¢è®¾è®¡</strong></h4><table><thead><tr><th><strong>åˆ‡é¢åç§°</strong></th><th><strong>ä½œç”¨æè¿°</strong></th></tr></thead><tbody><tr><td><code>DecryptControllerAspect</code></td><td>å®ç° <code>@DecryptController</code> çš„é€»è¾‘ï¼Œåœ¨ Controller æ–¹æ³•æ‰§è¡Œå‰æ‹¦æˆªè¯·æ±‚ï¼Œå¯¹ URL å’Œ&#x2F;æˆ–å‚æ•°è¿›è¡Œè§£å¯†ã€‚</td></tr><tr><td><code>EncryptControllerAspect</code></td><td>å®ç° <code>@EncryptController</code> çš„é€»è¾‘ï¼Œåœ¨ Controller æ–¹æ³•æ‰§è¡Œåæ‹¦æˆªå“åº”æ•°æ®ï¼Œå¯¹å“åº”æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚</td></tr><tr><td><code>CryptControllerAspect</code></td><td>å®ç° <code>@CryptController</code> çš„é€»è¾‘ï¼ŒåŒæ—¶æ‰§è¡Œè¯·æ±‚è§£å¯†å’Œå“åº”åŠ å¯†æ“ä½œã€‚</td></tr><tr><td><code>DecryptRequestAspect</code></td><td>å®ç° <code>@DecryptRequest</code> çš„é€»è¾‘ï¼Œæ‹¦æˆªç‰¹å®šæ–¹æ³•çš„è¯·æ±‚ï¼Œå¯¹æŒ‡å®šèŒƒå›´ï¼ˆURL å’Œ&#x2F;æˆ–å‚æ•°ï¼‰è¿›è¡Œè§£å¯†ã€‚</td></tr><tr><td><code>EncryptResponseAspect</code></td><td>å®ç° <code>@EncryptResponse</code> çš„é€»è¾‘ï¼Œæ‹¦æˆªç‰¹å®šæ–¹æ³•çš„å“åº”æ•°æ®ï¼Œå¯¹å“åº”å†…å®¹è¿›è¡ŒåŠ å¯†ã€‚</td></tr><tr><td><code>CryptMethodAspect</code></td><td>å®ç° <code>@CryptMethod</code> çš„é€»è¾‘ï¼ŒåŒæ—¶å¤„ç†è¯·æ±‚çš„è§£å¯†å’Œå“åº”çš„åŠ å¯†ã€‚</td></tr></tbody></table><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><h4 id="JSONåŒ¹é…ä¸ä¸ŠResolved-org-springframework-http-converter-HttpMessageNotReadableException-JSON-parse-error-Cannot-deserialize-value-of-type-java-lang-Long-from-String-â€œAD40FA5492E44B19277FF3370A65CB49â€-not-a-valid-java-lang-Long-value"><a href="#JSONåŒ¹é…ä¸ä¸ŠResolved-org-springframework-http-converter-HttpMessageNotReadableException-JSON-parse-error-Cannot-deserialize-value-of-type-java-lang-Long-from-String-â€œAD40FA5492E44B19277FF3370A65CB49â€-not-a-valid-java-lang-Long-value" class="headerlink" title="JSONåŒ¹é…ä¸ä¸ŠResolved [org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize value of type java.lang.Long from String â€œAD40FA5492E44B19277FF3370A65CB49â€: not a valid java.lang.Long value]"></a>JSONåŒ¹é…ä¸ä¸ŠResolved [org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize value of type <code>java.lang.Long</code> from String â€œAD40FA5492E44B19277FF3370A65CB49â€: not a valid <code>java.lang.Long</code> value]</h4><p>ä¸»è¦æ˜¯JSONåŠ å¯†ä¹‹åçš„éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½†æ˜¯åœ¨æ¥å£å‚æ•°åŒ¹é…æ—¶ï¼Œ@RequestBodyä¼šè‡ªåŠ¨çš„æŠŠè¿™ä¸ªè¿›è¡Œè½¬æ¢ï¼Œä½†æ˜¯å°±ä¼šå‡ºç°æ— æ³•æŠŠå­—ç¬¦ä¸²ç±»å‹åŒ¹é…ä¸Šï¼Œä»è€ŒæŠ¥é”™ã€‚</p><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>æŠŠè¯·æ±‚å‚æ•°çš„ç±»å‹éƒ½æ”¹ä¸ºStringå³å¯ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¸æ˜¯æœ€ä¼˜æ–¹æ³•ã€‚</p><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><p>@RequestBodyåŸç†å›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262039813.png" alt="img"></p><p>ä¸‹é¢ä»£ç å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªæ˜¯å¯¹æ‰€æœ‰çš„JSON2JAVAObjectçš„ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘å¦‚ä½•è¿›è¡ŒåŒºåˆ†æ— éœ€åŠ å¯†è§£å¯†å¤„ç†çš„æ•°æ®ã€‚</p><p>åŠ å¯†è§£å¯†è¿™ä¸ªæ“ä½œåº”è¯¥æ˜¯é’ˆå¯¹äºå®ä½“ç±»çš„ï¼Œè€Œéæ¥å£è¡Œä¸ºï¼Œå¦‚æœè¯¥éœ€è¦è½¬åŒ–çš„å®ä½“ç±»éœ€è¦åŠ å¯†è§£å¯†æ“ä½œï¼Œå°±éœ€è¦ç»™è¯¥å®ä½“ç±»è¿›è¡Œæ“ä½œï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªåµŒå¥—é—®é¢˜ã€‚</p><p>è¿™ä¸ªåŠ å¯†è§£å¯†æ“ä½œæ˜¯æ”¾ç½®åœ¨AOPåˆ‡é¢é€»è¾‘ä¸­è¿›è¡Œå¤„ç†è¿˜æ˜¯æ”¾ç½®åœ¨MappingJackson2HttpMessageConverterå­ç±»é‡å†™çš„Readæ–¹æ³•ä¸­è¿›è¡Œå¤„ç†ï¼Œ</p><ol><li>å¦‚æœæ”¾ç½®åœ¨AOPåˆ‡é¢é€»è¾‘ä¸­è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå¯¹äºReadé‡å†™çš„æ“ä½œéœ€è¦è¿›è¡Œé¿å…åŠ å¯†åçš„ç±»å‹æ˜¯Stringå¯¼è‡´ç±»å‹ä¸åŒ¹é…ï¼Œæ— æ³•æ³¨å…¥åˆ°æŒ‡å®šçš„ç±»å‹å¯¹è±¡ä¸­</li><li>å¦‚æœæ”¾ç½®åœ¨Readæ“ä½œä¸­ï¼ŒReadæ“ä½œä¸­æ˜¯å¦è¿‡äºå†—é•¿ï¼Œä¸”ä¸åŠ å¯†å¤„ç†é€»è¾‘è¿‡äºåˆ†æ•£ï¼Œä¸æ–¹ä¾¿åç»­çš„ç»´æŠ¤æ“ä½œï¼Œè€¦åˆåº¦è¾ƒé«˜ï¼Œä¸”å¦‚æœä¿®æ”¹ä¼šæ³¢åŠåˆ°å½“å‰æœåŠ¡æ‰€æœ‰åŒ…å«@RequestBodyæ³¨è§£çš„æ¥å£ï¼Œè€¦åˆåº¦è¿‡é«˜ï¼›</li></ol><p>æŒ‰ç…§ä¸Šé¢çš„åˆ†æåº”è¯¥æ˜¯é€‰æ‹©1ï¼Œä½†æ˜¯å¦‚ä½•è®©åŠ å¯†åçš„æ•°æ®ç±»å‹é¿å…æ— æ³•æ³¨å…¥å¯¼è‡´çš„é”™è¯¯å‘¢ï¼Ÿè¿™é‡Œä¹Ÿæœ‰å‡ ä¸ªæ–¹æ¡ˆï¼š</p><p>1. </p><ol><li>é€’å½’æ‰¾åˆ°å½“å‰æ‰€éœ€è¦è½¬æ¢çš„ç±»æ˜¯å¦æœ‰éœ€è¦è§£å¯†æ³¨è§£æ ‡å¿—ï¼Œå¦‚æœå­˜åœ¨åˆ™æ¸…é™¤è¯¥JSONä¸­è¿™ä¸ªå¯¹åº”çš„Keyï¼Œç„¶åäº¤ç”±å…¶çˆ¶ç±»è¿›è¡Œè½¬æ¢ï¼›å¦‚æœå½“å‰å®ä½“ç±»æ‰€æœ‰çš„éƒ½éœ€è¦è¿›è¡ŒåŠ å¯†è§£å¯†æ“ä½œï¼Œåˆ™å»é™¤æ‰æ‰€æœ‰çš„Keyï¼›</li><li></li></ol><h2 id="æ•°æ®åº“å­—æ®µåŠ å¯†è§£å¯†"><a href="#æ•°æ®åº“å­—æ®µåŠ å¯†è§£å¯†" class="headerlink" title="æ•°æ®åº“å­—æ®µåŠ å¯†è§£å¯†"></a>æ•°æ®åº“å­—æ®µåŠ å¯†è§£å¯†</h2><blockquote><p>ç°åœ¨å‡è®¾ä½ éå¸¸æ“…é•¿SpringBootå¼€å‘å’ŒMyBatisï¼Œç°åœ¨å‡è®¾ä½ éœ€è¦å®ç°ä¸€ä¸ªéœ€æ±‚ï¼Œè¯¥éœ€æ±‚å°±æ˜¯ä½ éœ€è¦æä¾›ä¸€ä¸ªæ³¨è§£ï¼Œè¯¥æ³¨è§£å¯ä»¥æ ‡è®°åœ¨å®ä½“ç±»çš„ç±»ä¸Šæˆ–è€…å±æ€§ä¸Šã€‚æ ‡è®°åœ¨å±æ€§ä¸Šï¼Œå°±è¡¨ç¤ºå¦‚æœä»æ•°æ®åº“é‡Œè¯»å–è¿™ä¸ªå­—æ®µæ—¶éœ€è¦è§£å¯†åå†å¤„ç†ï¼Œå¦‚æœæ˜¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­åˆ™éœ€è¦åŠ å¯†åå†ä¿å­˜ã€‚æ ‡è®°åœ¨ç±»ä¸Šå°±æ˜¯æ‰€æœ‰çš„å±æ€§éƒ½éœ€è¦è¿›è¡Œæ“ä½œã€‚è¯·ä½ ç»“åˆç°åœ¨å¸‚é¢ä¸Šéå¸¸ä¸“ä¸šçš„åšæ³•ç»™å‡ºä½ çš„ä¸“ä¸šçš„æ–¹æ¡ˆä»‹ç»ï¼Œè¦æ±‚éå¸¸è¯¦ç»†ï¼ŒåŒæ—¶ä½ ä¹Ÿéœ€è¦è€ƒè™‘åˆ°åç»­çš„æ‰©å±•åŠŸèƒ½ï¼Œæ¯”å¦‚å¯¹åŠ å¯†å­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œä»¥åŠå¯¹åŠ å¯†å­—æ®µè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ç­‰ï¼Œè¿™é‡Œæˆ‘åªç»™å‡ºéƒ¨åˆ†æ‰©å±•åŠŸèƒ½ï¼Œä»…ä¾›å‚è€ƒï¼Œè¯·ä½ ä¹Ÿç»™å‡ºå…¶å®ƒå¯èƒ½å­˜åœ¨çš„éœ€æ±‚ã€‚æ³¨æ„æŸäº›å­—æ®µå¯èƒ½éœ€è¦åŠ å¯†æŸäº›ä¸éœ€è¦è¿›è¡ŒåŠ å¯†ï¼Œç„¶åæŸäº›å­—æ®µå¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢æŸäº›ä¸éœ€è¦è€ƒè™‘ã€‚</p></blockquote><p>å®ç°ä¸€ä¸ªæ³¨è§£æ”¯æŒå¯¹å®ä½“ç±»æˆ–å­—æ®µè¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ“ä½œï¼Œå¹¶æ‰©å±•ä»¥æ”¯æŒæŸ¥è¯¢å’Œæ¨¡ç³ŠæŸ¥è¯¢ç­‰åŠŸèƒ½ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä¸“ä¸šæ–¹æ¡ˆã€‚ä»¥ä¸‹ä»éœ€æ±‚åˆ†æã€è®¾è®¡æ€è·¯ã€å…·ä½“å®ç°å’Œæ‰©å±•åŠŸèƒ½ç­‰æ–¹é¢è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚</p><hr><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a><strong>éœ€æ±‚åˆ†æ</strong></h3><ol><li><strong>åŸºç¡€åŠŸèƒ½</strong><ul><li>å®ç°ä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£ï¼Œæ”¯æŒæ ‡æ³¨åœ¨ç±»ä¸Šï¼ˆå…¨ç±»å­—æ®µç”Ÿæ•ˆï¼‰æˆ–å­—æ®µä¸Šï¼ˆå•å­—æ®µç”Ÿæ•ˆï¼‰ã€‚</li><li>æ•°æ®åº“è¯»å–æ—¶ï¼Œå¯¹æ ‡æ³¨å­—æ®µè¿›è¡Œè§£å¯†ã€‚</li><li>æ•°æ®åº“ä¿å­˜æ—¶ï¼Œå¯¹æ ‡æ³¨å­—æ®µè¿›è¡ŒåŠ å¯†ã€‚</li></ul></li><li><strong>æ‰©å±•åŠŸèƒ½</strong><ul><li><strong>æŸ¥è¯¢æ‰©å±•</strong>ï¼šæ”¯æŒå¯¹åŠ å¯†å­—æ®µè¿›è¡Œæ™®é€šæŸ¥è¯¢ã€æ¨¡ç³ŠæŸ¥è¯¢ã€‚</li><li><strong>å­—æ®µæ§åˆ¶</strong>ï¼šæ”¯æŒéƒ¨åˆ†å­—æ®µåŠ å¯†ï¼Œéƒ¨åˆ†å­—æ®µä¸åŠ å¯†ã€‚</li><li><strong>æ”¯æŒå¤šç§åŠ å¯†ç®—æ³•</strong>ï¼šæ”¯æŒé…ç½®åŠ å¯†ç®—æ³•ï¼ˆå¦‚AESã€RSAç­‰ï¼‰ã€‚</li><li><strong>åŠ¨æ€æ§åˆ¶åŠ å¯†&#x2F;è§£å¯†</strong>ï¼šå…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€æ§åˆ¶æŸäº›å­—æ®µæ˜¯å¦å¯ç”¨åŠ å¯†åŠŸèƒ½ã€‚</li></ul></li><li><strong>è®¾è®¡è¦æ±‚</strong><ul><li>é«˜å¯æ‰©å±•æ€§ï¼šæ–¹ä¾¿æœªæ¥æ·»åŠ æ–°åŠŸèƒ½ã€‚</li><li>æ˜“ç”¨æ€§ï¼šå¯¹ä¸šåŠ¡ä»£ç æ”¹åŠ¨å°ã€‚</li><li>é«˜æ€§èƒ½ï¼šå‡å°‘ä¸å¿…è¦çš„å¼€é”€ã€‚</li></ul></li></ol><hr><h3 id="è®¾è®¡æ–¹æ¡ˆ"><a href="#è®¾è®¡æ–¹æ¡ˆ" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆ"></a><strong>è®¾è®¡æ–¹æ¡ˆ</strong></h3><h4 id="1-è‡ªå®šä¹‰æ³¨è§£"><a href="#1-è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="1. è‡ªå®šä¹‰æ³¨è§£"></a><strong>1. è‡ªå®šä¹‰æ³¨è§£</strong></h4><p>åˆ›å»ºæ³¨è§£ <code>@Sensitive</code>ï¼Œå¯ä»¥æ ‡æ³¨åœ¨ç±»æˆ–å­—æ®µä¸Šã€‚<br> æ³¨è§£å¯ä»¥åŒ…å«å¦‚ä¸‹å‚æ•°ï¼š</p><ul><li><strong>strategy</strong>ï¼šæŒ‡å®šåŠ å¯†ç­–ç•¥ï¼Œä¾‹å¦‚AESã€RSAã€‚</li><li><strong>querySupport</strong>ï¼šæ ‡æ³¨è¯¥å­—æ®µæ˜¯å¦æ”¯æŒæŸ¥è¯¢æ‰©å±•ã€‚</li><li><strong>fuzzyQuerySupport</strong>ï¼šæ ‡æ³¨è¯¥å­—æ®µæ˜¯å¦æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Sensitive &#123;</span><br><span class="line">    String <span class="title function_">strategy</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;AES&quot;</span>; <span class="comment">// åŠ å¯†ç®—æ³•ï¼Œé»˜è®¤AES</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">querySupport</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>; <span class="comment">// æ˜¯å¦æ”¯æŒæ™®é€šæŸ¥è¯¢</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">fuzzyQuerySupport</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>; <span class="comment">// æ˜¯å¦æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="2-åŠ è§£å¯†å·¥å…·ç±»"><a href="#2-åŠ è§£å¯†å·¥å…·ç±»" class="headerlink" title="2. åŠ è§£å¯†å·¥å…·ç±»"></a><strong>2. åŠ è§£å¯†å·¥å…·ç±»</strong></h4><p>å°è£…å¸¸ç”¨çš„åŠ å¯†è§£å¯†ç®—æ³•ï¼ˆå¦‚AESï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptionUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">AES_KEY</span> <span class="operator">=</span> <span class="string">&quot;exampleKey123456&quot;</span>; <span class="comment">// ç¤ºä¾‹å¯†é’¥ï¼Œå»ºè®®ä»é…ç½®æ–‡ä»¶åŠ è½½</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encrypt</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">// AESåŠ å¯†å®ç°ï¼Œéœ€æ›¿æ¢ä¸ºæ­£å¼åŠ å¯†é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> Base64.getEncoder().encodeToString(value.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decrypt</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">// AESè§£å¯†å®ç°ï¼Œéœ€æ›¿æ¢ä¸ºæ­£å¼è§£å¯†é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.getDecoder().decode(value), StandardCharsets.UTF_8);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="3-æ•°æ®å¤„ç†é€»è¾‘"><a href="#3-æ•°æ®å¤„ç†é€»è¾‘" class="headerlink" title="3. æ•°æ®å¤„ç†é€»è¾‘"></a><strong>3. æ•°æ®å¤„ç†é€»è¾‘</strong></h4><p>ä½¿ç”¨ <strong>MyBatis æ‹¦æˆªå™¨</strong> å¯¹æ•°æ®è¿›è¡Œæ‹¦æˆªå’Œå¤„ç†ã€‚</p><h5 id="a-è¯»å–æ—¶è§£å¯†"><a href="#a-è¯»å–æ—¶è§£å¯†" class="headerlink" title="a. è¯»å–æ—¶è§£å¯†"></a>a. è¯»å–æ—¶è§£å¯†</h5><p>å®ç° <code>ResultSetHandler</code> çš„æ‹¦æˆªï¼Œå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œè§£å¯†å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(type = ResultSetHandler.class, method = &quot;handleResultSets&quot;, args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DecryptInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> invocation.proceed(); <span class="comment">// è·å–åŸå§‹æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (result <span class="keyword">instanceof</span> List) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Object obj : (List&lt;?&gt;) result) &#123;</span><br><span class="line">                decryptObject(obj); <span class="comment">// å¯¹è±¡è§£å¯†</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            decryptObject(result); <span class="comment">// å•ä¸ªå¯¹è±¡è§£å¯†</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">decryptObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();</span><br><span class="line">        <span class="keyword">if</span> (clazz.isAnnotationPresent(Sensitive.class)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Field field : clazz.getDeclaredFields()) &#123;</span><br><span class="line">                decryptField(obj, field); <span class="comment">// è§£å¯†å­—æ®µ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">decryptField</span><span class="params">(Object obj, Field field)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        <span class="type">Sensitive</span> <span class="variable">sensitive</span> <span class="operator">=</span> field.getAnnotation(Sensitive.class);</span><br><span class="line">        <span class="keyword">if</span> (sensitive != <span class="literal">null</span> || obj.getClass().isAnnotationPresent(Sensitive.class)) &#123;</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">encryptedValue</span> <span class="operator">=</span> (String) field.get(obj);</span><br><span class="line">            field.set(obj, EncryptionUtils.decrypt(encryptedValue));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-ä¿å­˜æ—¶åŠ å¯†"><a href="#b-ä¿å­˜æ—¶åŠ å¯†" class="headerlink" title="b. ä¿å­˜æ—¶åŠ å¯†"></a>b. ä¿å­˜æ—¶åŠ å¯†</h5><p>å®ç° <code>ParameterHandler</code> çš„æ‹¦æˆªï¼Œå¯¹æ•°æ®æ’å…¥æˆ–æ›´æ–°å‰è¿›è¡ŒåŠ å¯†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(type = ParameterHandler.class, method = &quot;setParameters&quot;, args = &#123;PreparedStatement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">ParameterHandler</span> <span class="variable">parameterHandler</span> <span class="operator">=</span> (ParameterHandler) invocation.getTarget();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">parameterObject</span> <span class="operator">=</span> parameterHandler.getParameterObject();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (parameterObject != <span class="literal">null</span>) &#123;</span><br><span class="line">            encryptObject(parameterObject); <span class="comment">// å¯¹è±¡åŠ å¯†</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">encryptObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();</span><br><span class="line">        <span class="keyword">if</span> (clazz.isAnnotationPresent(Sensitive.class)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Field field : clazz.getDeclaredFields()) &#123;</span><br><span class="line">                encryptField(obj, field); <span class="comment">// åŠ å¯†å­—æ®µ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">encryptField</span><span class="params">(Object obj, Field field)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        <span class="type">Sensitive</span> <span class="variable">sensitive</span> <span class="operator">=</span> field.getAnnotation(Sensitive.class);</span><br><span class="line">        <span class="keyword">if</span> (sensitive != <span class="literal">null</span> || obj.getClass().isAnnotationPresent(Sensitive.class)) &#123;</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">plainValue</span> <span class="operator">=</span> (String) field.get(obj);</span><br><span class="line">            field.set(obj, EncryptionUtils.encrypt(plainValue));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="4-æŸ¥è¯¢æ‰©å±•"><a href="#4-æŸ¥è¯¢æ‰©å±•" class="headerlink" title="4. æŸ¥è¯¢æ‰©å±•"></a><strong>4. æŸ¥è¯¢æ‰©å±•</strong></h4><h5 id="a-æ™®é€šæŸ¥è¯¢æ”¯æŒ"><a href="#a-æ™®é€šæŸ¥è¯¢æ”¯æŒ" class="headerlink" title="a. æ™®é€šæŸ¥è¯¢æ”¯æŒ"></a>a. æ™®é€šæŸ¥è¯¢æ”¯æŒ</h5><p>é€šè¿‡æ‹¦æˆªæŸ¥è¯¢æ¡ä»¶ï¼Œåœ¨ <code>WHERE</code> å­å¥ä¸­åŠ å¯†å­—æ®µçš„æŸ¥è¯¢å€¼ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> encrypted_field <span class="operator">=</span> #&#123;<span class="keyword">value</span>&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Java å±‚æ‹¦æˆªï¼š</p><ul><li>å¯¹ <code>value</code> è¿›è¡ŒåŠ å¯†åä¼ é€’åˆ° SQLã€‚</li></ul><h5 id="b-æ¨¡ç³ŠæŸ¥è¯¢æ”¯æŒ"><a href="#b-æ¨¡ç³ŠæŸ¥è¯¢æ”¯æŒ" class="headerlink" title="b. æ¨¡ç³ŠæŸ¥è¯¢æ”¯æŒ"></a>b. æ¨¡ç³ŠæŸ¥è¯¢æ”¯æŒ</h5><p>æ¨¡ç³ŠæŸ¥è¯¢è¾ƒå¤æ‚ï¼Œå¯ä»¥é€šè¿‡åˆ†æ®µåŠ å¯†å®ç°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> encrypted_field <span class="keyword">LIKE</span> CONCAT(<span class="string">&#x27;%&#x27;</span>, #&#123;<span class="keyword">value</span>&#125;, <span class="string">&#x27;%&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å°† <code>value</code> è¿›è¡ŒåŠ å¯†ååŒ¹é…ã€‚</p><hr><h4 id="5-é…ç½®å’Œæ³¨è§£æ‰©å±•"><a href="#5-é…ç½®å’Œæ³¨è§£æ‰©å±•" class="headerlink" title="5. é…ç½®å’Œæ³¨è§£æ‰©å±•"></a><strong>5. é…ç½®å’Œæ³¨è§£æ‰©å±•</strong></h4><ol><li><strong>æ”¯æŒå¤šç§åŠ å¯†ç®—æ³•</strong><ul><li>åœ¨æ³¨è§£ä¸­å¢åŠ é…ç½®å‚æ•° <code>strategy</code>ï¼Œé€šè¿‡å·¥å‚æ¨¡å¼æ”¯æŒå¤šç§åŠ å¯†ç®—æ³•ã€‚</li></ul></li><li><strong>è¿è¡Œæ—¶æ§åˆ¶åŠ å¯†é€»è¾‘</strong><ul><li>ä½¿ç”¨é…ç½®å¼€å…³åŠ¨æ€å†³å®šæ˜¯å¦åŠ å¯†&#x2F;è§£å¯†ã€‚</li></ul></li><li><strong>é’ˆå¯¹ç‰¹å®šå­—æ®µè®¾ç½®ç‰¹æ®Šå¤„ç†</strong><ul><li>ä½¿ç”¨ <code>fuzzyQuerySupport</code> å‚æ•°å®ç°æ¨¡ç³ŠæŸ¥è¯¢ã€‚</li><li>æœªæ¥å¯å¢åŠ æ›´å¤šåŠŸèƒ½ï¼Œå¦‚æ­£åˆ™æŸ¥è¯¢æ”¯æŒç­‰ã€‚</li></ul></li></ol><hr><h4 id="6-ç¤ºä¾‹ä»£ç "><a href="#6-ç¤ºä¾‹ä»£ç " class="headerlink" title="6. ç¤ºä¾‹ä»£ç "></a><strong>6. ç¤ºä¾‹ä»£ç </strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Sensitive(strategy = &quot;AES&quot;, querySupport = true, fuzzyQuerySupport = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Sensitive</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Sensitive(querySupport = true)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><p>é€šè¿‡ç»“åˆæ³¨è§£ã€è‡ªå®šä¹‰åŠ è§£å¯†é€»è¾‘ä»¥åŠ MyBatis æ‹¦æˆªå™¨çš„æœºåˆ¶ï¼Œå¯ä»¥ä¼˜é›…åœ°å®ç°å­—æ®µçš„åŠ å¯†è§£å¯†åŠŸèƒ½ï¼Œå¹¶æ”¯æŒå„ç§æ‰©å±•éœ€æ±‚ã€‚å¯¹äºå¤æ‚æŸ¥è¯¢å’Œç‰¹æ®Šåœºæ™¯ï¼Œå¯ä»¥ç»§ç»­å¢å¼ºæŸ¥è¯¢è§£æé€»è¾‘ï¼Œç¡®ä¿ç³»ç»Ÿçµæ´»æ€§å’Œé«˜æ€§èƒ½ã€‚</p><h2 id="åŠ å¯†å­—æ®µæ¨¡ç³ŠæŸ¥è¯¢"><a href="#åŠ å¯†å­—æ®µæ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="åŠ å¯†å­—æ®µæ¨¡ç³ŠæŸ¥è¯¢"></a>åŠ å¯†å­—æ®µæ¨¡ç³ŠæŸ¥è¯¢</h2><p>å¯¹åŠ å¯†å­—æ®µè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢æ˜¯ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ï¼Œå› ä¸ºåŠ å¯†ä¼šæ”¹å˜åŸå§‹æ˜æ–‡çš„ç»“æ„ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥é€šè¿‡åŠ å¯†åçš„æ•°æ®è¿›è¡Œå¸¸è§„çš„æ¨¡ç³ŠåŒ¹é…ï¼ˆå¦‚<code>LIKE &#39;%keyword%&#39;</code>ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¯è¡Œçš„æ–¹æ¡ˆï¼Œç»“åˆå…¶ä¼˜åŠ£åŠ¿è¿›è¡Œè¯¦ç»†åˆ†æã€‚</p><hr><h3 id="æ–¹æ¡ˆ-1ï¼šåŸºäºå“ˆå¸Œå‰ç¼€åŒ¹é…"><a href="#æ–¹æ¡ˆ-1ï¼šåŸºäºå“ˆå¸Œå‰ç¼€åŒ¹é…" class="headerlink" title="æ–¹æ¡ˆ 1ï¼šåŸºäºå“ˆå¸Œå‰ç¼€åŒ¹é…"></a><strong>æ–¹æ¡ˆ 1ï¼šåŸºäºå“ˆå¸Œå‰ç¼€åŒ¹é…</strong></h3><p><strong>æ€è·¯</strong>ï¼š</p><ol><li>å¯¹éœ€è¦æ¨¡ç³ŠæŸ¥è¯¢çš„å­—æ®µå»ºç«‹ä¸€ä¸ªâ€œå“ˆå¸Œå‰ç¼€ç´¢å¼•â€ã€‚</li><li>å­˜å‚¨æ˜æ–‡å­—æ®µçš„å¤šä¸ªå‰ç¼€çš„å“ˆå¸Œå€¼ï¼ˆæˆ–éƒ¨åˆ†åŠ å¯†å€¼ï¼‰ï¼Œç”¨äºå¿«é€ŸæŸ¥è¯¢ã€‚</li><li>æŸ¥è¯¢æ—¶ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„å…³é”®å­—ç”Ÿæˆç›¸åŒçš„å‰ç¼€å“ˆå¸Œå€¼ï¼ŒåŒ¹é…å­˜å‚¨çš„å‰ç¼€ã€‚</li></ol><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>ä¸æš´éœ²æ˜æ–‡ï¼Œå…·æœ‰è¾ƒé«˜çš„å®‰å…¨æ€§ã€‚</li><li>æ”¯æŒä¸€å®šèŒƒå›´å†…çš„æ¨¡ç³ŠåŒ¹é…ï¼ˆå¦‚ä»¥å…³é”®å­—å¼€å¤´çš„æŸ¥è¯¢ï¼‰ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>ä»…æ”¯æŒ<strong>å‰ç¼€åŒ¹é…</strong>ï¼Œä¸æ”¯æŒä¸­é—´æˆ–åç¼€æ¨¡ç³ŠåŒ¹é…ã€‚</li><li>å­˜å‚¨æˆæœ¬å¢åŠ ï¼Œéœ€è¦é¢å¤–å­˜å‚¨å­—æ®µå‰ç¼€çš„å“ˆå¸Œå€¼ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ å¯†å‰ç¼€ç”Ÿæˆ</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">generateHashPrefixes</span><span class="params">(String text, <span class="type">int</span> prefixLength)</span> &#123;</span><br><span class="line">    List&lt;String&gt; prefixes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= prefixLength &amp;&amp; i &lt;= text.length(); i++) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prefix</span> <span class="operator">=</span> text.substring(<span class="number">0</span>, i);</span><br><span class="line">        prefixes.add(hash(prefix)); <span class="comment">// ä½¿ç”¨å“ˆå¸Œå‡½æ•°ç”Ÿæˆå‰ç¼€å“ˆå¸Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prefixes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ•°æ®åº“ä¸­ä¸ºæ¯ä¸ªå­—æ®µå­˜å‚¨å‰ç¼€å“ˆå¸Œåˆ—è¡¨ï¼ŒæŸ¥è¯¢æ—¶é€šè¿‡å“ˆå¸ŒåŒ¹é…å…³é”®å­—å‰ç¼€ã€‚</p><hr><h3 id="æ–¹æ¡ˆ-2ï¼šåŒæ€åŠ å¯†æˆ–ä¿åºåŠ å¯†ï¼ˆOrder-Preserving-Encryption-OPEï¼‰"><a href="#æ–¹æ¡ˆ-2ï¼šåŒæ€åŠ å¯†æˆ–ä¿åºåŠ å¯†ï¼ˆOrder-Preserving-Encryption-OPEï¼‰" class="headerlink" title="æ–¹æ¡ˆ 2ï¼šåŒæ€åŠ å¯†æˆ–ä¿åºåŠ å¯†ï¼ˆOrder-Preserving Encryption, OPEï¼‰"></a><strong>æ–¹æ¡ˆ 2ï¼šåŒæ€åŠ å¯†æˆ–ä¿åºåŠ å¯†ï¼ˆOrder-Preserving Encryption, OPEï¼‰</strong></h3><p><strong>æ€è·¯</strong>ï¼š<br> ä½¿ç”¨ä¿åºåŠ å¯†ï¼ˆOrder-Preserving Encryptionï¼‰ç®—æ³•ï¼Œå¯¹æ˜æ–‡è¿›è¡ŒåŠ å¯†ï¼ŒåŒæ—¶ä¿ç•™åŠ å¯†æ•°æ®çš„é¡ºåºæ€§ã€‚è¿™æ ·ï¼Œæ•°æ®åº“ä¸­çš„åŠ å¯†å­—æ®µå¯ä»¥å‚ä¸èŒƒå›´æŸ¥è¯¢å’Œæ¨¡ç³ŠæŸ¥è¯¢ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€æ’åºå’Œæ¨¡ç³ŠåŒ¹é…ï¼ˆå¦‚å‰ç¼€åŒ¹é…ã€åç¼€åŒ¹é…ï¼‰ã€‚</li><li>å®‰å…¨æ€§è¾ƒé«˜ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>ä¿åºåŠ å¯†ç®—æ³•å¤æ‚ï¼Œæ€§èƒ½å¯èƒ½è¾ƒä½ã€‚</li><li>å¦‚æœæ”»å‡»è€…æŒæ¡å¤§é‡å¯†æ–‡æ ·æœ¬ï¼Œæœ‰å¯èƒ½æ¨æ–­åŠ å¯†ç®—æ³•çš„æ¨¡å¼ï¼Œå®‰å…¨æ€§æœ‰æ‰€é™ä½ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ol><li><p>å¯¹å­—æ®µé‡‡ç”¨OPEåŠ å¯†å­˜å‚¨ã€‚</p></li><li><p>åœ¨æŸ¥è¯¢æ—¶ï¼Œå¯¹æŸ¥è¯¢å…³é”®å­—åŠ å¯†åå‚ä¸åŒ¹é…ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> encrypted_name <span class="keyword">LIKE</span> <span class="string">&#x27;encrypted_value%&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="æ–¹æ¡ˆ-3ï¼šæœç´¢å¼•æ“æ–¹æ¡ˆï¼ˆæ˜æ–‡ç´¢å¼•ï¼‰"><a href="#æ–¹æ¡ˆ-3ï¼šæœç´¢å¼•æ“æ–¹æ¡ˆï¼ˆæ˜æ–‡ç´¢å¼•ï¼‰" class="headerlink" title="æ–¹æ¡ˆ 3ï¼šæœç´¢å¼•æ“æ–¹æ¡ˆï¼ˆæ˜æ–‡ç´¢å¼•ï¼‰"></a><strong>æ–¹æ¡ˆ 3ï¼šæœç´¢å¼•æ“æ–¹æ¡ˆï¼ˆæ˜æ–‡ç´¢å¼•ï¼‰</strong></h3><p><strong>æ€è·¯</strong>ï¼š<br> å¯¹åŠ å¯†å­—æ®µå­˜å‚¨é¢å¤–çš„æ˜æ–‡ç´¢å¼•ï¼Œä½¿ç”¨å…¨æ–‡æ£€ç´¢æŠ€æœ¯ï¼ˆå¦‚Elasticsearchã€Solrï¼‰å®ç°æ¨¡ç³ŠæŸ¥è¯¢ã€‚</p><ul><li>æ•°æ®åº“ä¸­å­˜å‚¨åŠ å¯†å­—æ®µã€‚</li><li>åœ¨å…¨æ–‡æœç´¢å¼•æ“ä¸­ç»´æŠ¤å­—æ®µçš„æ˜æ–‡å‰¯æœ¬ï¼Œç”¨äºæŸ¥è¯¢ã€‚</li></ul><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ”¯æŒå¤æ‚çš„æŸ¥è¯¢åŠŸèƒ½ï¼ˆå‰ç¼€åŒ¹é…ã€åç¼€åŒ¹é…ã€å…³é”®è¯åŒ¹é…ã€å…¨æ–‡æ£€ç´¢ï¼‰ã€‚</li><li>é«˜æ€§èƒ½ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>æ˜æ–‡å‰¯æœ¬å­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œéœ€è¦åŠ å¼ºè®¿é—®æ§åˆ¶ã€‚</li><li>å®ç°æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦å¼•å…¥å…¨æ–‡æœç´¢å¼•æ“ã€‚</li></ul><p><strong>ç¤ºä¾‹æ¶æ„</strong>ï¼š</p><ol><li>ç”¨æˆ·æ•°æ®åŠ å¯†åå­˜å‚¨åˆ°æ•°æ®åº“ã€‚</li><li>åŒæ­¥ä¸€ä»½æ˜æ–‡åˆ°Elasticsearchï¼Œä¾›æ¨¡ç³ŠæŸ¥è¯¢ä½¿ç”¨ã€‚</li><li>æŸ¥è¯¢ç»“æœè¿”å›åï¼Œä»æ•°æ®åº“ä¸­è§£å¯†å­—æ®µï¼Œç¡®ä¿å®‰å…¨æ€§ã€‚</li></ol><hr><h3 id="æ–¹æ¡ˆ-4ï¼šåˆ†è¯å­˜å‚¨"><a href="#æ–¹æ¡ˆ-4ï¼šåˆ†è¯å­˜å‚¨" class="headerlink" title="æ–¹æ¡ˆ 4ï¼šåˆ†è¯å­˜å‚¨"></a><strong>æ–¹æ¡ˆ 4ï¼šåˆ†è¯å­˜å‚¨</strong></h3><p><strong>æ€è·¯</strong>ï¼š<br> å¯¹éœ€è¦æ¨¡ç³ŠæŸ¥è¯¢çš„å­—æ®µè¿›è¡Œåˆ†è¯å¤„ç†ï¼Œå°†æ‰€æœ‰å¯èƒ½çš„å­ä¸²ä½œä¸ºç‹¬ç«‹è®°å½•å­˜å‚¨åˆ°æ•°æ®åº“ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ— éœ€å¼•å…¥å¤–éƒ¨å·¥å…·ï¼Œå®Œå…¨åœ¨æ•°æ®åº“å±‚å®ç°ã€‚</li><li>æ”¯æŒä»»æ„ä½ç½®çš„æ¨¡ç³ŠæŸ¥è¯¢ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>å­˜å‚¨æˆæœ¬å’ŒæŸ¥è¯¢æˆæœ¬è¾ƒé«˜ã€‚</li><li>ä»…é€‚ç”¨äºç‰¹å®šå­—æ®µï¼Œé€šç”¨æ€§å·®ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ol><li><p>æ˜æ–‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;hello&quot;</span><br></pre></td></tr></table></figure><p>ä¼šè¢«åˆ†è¯å­˜å‚¨ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">he</span><br><span class="line">el</span><br><span class="line">ll</span><br><span class="line">lo</span><br><span class="line">hello</span><br></pre></td></tr></table></figure></li><li><p>æ¨¡ç³ŠæŸ¥è¯¢<code>&quot;ll&quot;</code>æ—¶ï¼Œå¯ä»¥ç›´æ¥åŒ¹é…å¯¹åº”åˆ†è¯è®°å½•ã€‚</p></li></ol><hr><h3 id="æ–¹æ¡ˆ-5ï¼šåŒå±‚åŠ å¯†å’Œéƒ¨åˆ†æ˜æ–‡å­˜å‚¨"><a href="#æ–¹æ¡ˆ-5ï¼šåŒå±‚åŠ å¯†å’Œéƒ¨åˆ†æ˜æ–‡å­˜å‚¨" class="headerlink" title="æ–¹æ¡ˆ 5ï¼šåŒå±‚åŠ å¯†å’Œéƒ¨åˆ†æ˜æ–‡å­˜å‚¨"></a><strong>æ–¹æ¡ˆ 5ï¼šåŒå±‚åŠ å¯†å’Œéƒ¨åˆ†æ˜æ–‡å­˜å‚¨</strong></h3><p><strong>æ€è·¯</strong>ï¼š<br> å°†å­—æ®µæ‹†åˆ†ä¸ºå¯åŠ å¯†éƒ¨åˆ†å’Œæ˜æ–‡ç´¢å¼•éƒ¨åˆ†ï¼Œæ¨¡ç³ŠæŸ¥è¯¢æ—¶ä»…åŒ¹é…æ˜æ–‡éƒ¨åˆ†ï¼Œè¿”å›ç»“æœåå†é€šè¿‡è§£å¯†æ ¡éªŒã€‚</p><ul><li>æ˜æ–‡ç´¢å¼•éƒ¨åˆ†ï¼šå¦‚å­—æ®µçš„å‰nä¸ªå­—ç¬¦æˆ–éƒ¨åˆ†æ‘˜è¦ã€‚</li><li>åŠ å¯†éƒ¨åˆ†ï¼šå®Œæ•´å­—æ®µçš„åŠ å¯†å€¼ã€‚</li></ul><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>éƒ¨åˆ†æ˜æ–‡ç”¨äºæŸ¥è¯¢ï¼Œæå‡æ€§èƒ½ã€‚</li><li>ç»“åˆåŠ å¯†ï¼Œå¢åŠ å®‰å…¨æ€§ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>ä»ç„¶å­˜åœ¨éƒ¨åˆ†æ˜æ–‡æš´éœ²çš„é£é™©ã€‚</li><li>æŸ¥è¯¢éœ€è¦é¢å¤–çš„äºŒæ¬¡éªŒè¯é€»è¾‘ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>æ•°æ®åº“ä¸­å­˜å‚¨ï¼š<ul><li><code>encrypted_full_name</code>ï¼ˆå®Œæ•´åŠ å¯†å€¼ï¼‰</li><li><code>partial_plain_name</code>ï¼ˆå‰ç¼€æ˜æ–‡æˆ–éƒ¨åˆ†æ‘˜è¦ï¼‰</li></ul></li></ul><p>æŸ¥è¯¢æ—¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> partial_plain_name <span class="keyword">LIKE</span> <span class="string">&#x27;%keyword%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›ä¸€æ­¥è§£å¯†å’ŒéªŒè¯<code>encrypted_full_name</code>ã€‚</p><hr><h3 id="æ–¹æ¡ˆå¯¹æ¯”"><a href="#æ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="æ–¹æ¡ˆå¯¹æ¯”"></a><strong>æ–¹æ¡ˆå¯¹æ¯”</strong></h3><table><thead><tr><th><strong>æ–¹æ¡ˆ</strong></th><th><strong>ä¼˜ç‚¹</strong></th><th><strong>ç¼ºç‚¹</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td>å“ˆå¸Œå‰ç¼€åŒ¹é…</td><td>ç®€å•é«˜æ•ˆï¼Œå®‰å…¨æ€§å¥½</td><td>ä»…æ”¯æŒå‰ç¼€åŒ¹é…</td><td>å¸¸è§çš„å‰ç¼€åŒ¹é…éœ€æ±‚</td></tr><tr><td>ä¿åºåŠ å¯†</td><td>æ”¯æŒèŒƒå›´å’Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå®‰å…¨æ€§è¾ƒå¥½</td><td>å®ç°å¤æ‚ï¼Œæ€§èƒ½è¾ƒä½</td><td>éœ€è¦èŒƒå›´æŸ¥è¯¢å’Œæ¨¡ç³ŠåŒ¹é…æ—¶</td></tr><tr><td>æœç´¢å¼•æ“æ–¹æ¡ˆ</td><td>æŸ¥è¯¢åŠŸèƒ½å¼ºå¤§ï¼Œæ€§èƒ½é«˜</td><td>æ˜æ–‡å‰¯æœ¬å­˜åœ¨å®‰å…¨é£é™©</td><td>å¤§è§„æ¨¡æ•°æ®å’Œå¤æ‚æŸ¥è¯¢åœºæ™¯</td></tr><tr><td>åˆ†è¯å­˜å‚¨</td><td>ç®€å•ç›´æ¥ï¼Œæ”¯æŒä»»æ„ä½ç½®æ¨¡ç³ŠæŸ¥è¯¢</td><td>å­˜å‚¨æˆæœ¬é«˜ï¼Œæ€§èƒ½è¾ƒä½</td><td>å°è§„æ¨¡æ•°æ®ï¼Œä¸”å¯¹æ¨¡ç³ŠæŸ¥è¯¢è¦æ±‚é«˜</td></tr><tr><td>åŒå±‚åŠ å¯†å’Œéƒ¨åˆ†æ˜æ–‡å­˜å‚¨</td><td>å¹³è¡¡å®‰å…¨æ€§å’ŒæŸ¥è¯¢åŠŸèƒ½ï¼Œæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢</td><td>éƒ¨åˆ†æ˜æ–‡æš´éœ²é£é™©</td><td>å¯¹åŠ å¯†å­—æ®µéœ€è¦éƒ¨åˆ†åŒ¹é…æŸ¥è¯¢ä¸”å®‰å…¨æ€§è¦æ±‚ä¸è‹›åˆ»</td></tr></tbody></table><hr><h3 id="æ¨èæ–¹æ¡ˆ"><a href="#æ¨èæ–¹æ¡ˆ" class="headerlink" title="æ¨èæ–¹æ¡ˆ"></a><strong>æ¨èæ–¹æ¡ˆ</strong></h3><ul><li><strong>é«˜å®‰å…¨æ€§åœºæ™¯</strong>ï¼šé€‰æ‹©<strong>å“ˆå¸Œå‰ç¼€åŒ¹é…</strong>æˆ–<strong>ä¿åºåŠ å¯†</strong>ï¼Œç¡®ä¿æ•°æ®åŠ å¯†åä¸å¯æ¨æ–­ã€‚</li><li><strong>å¤æ‚æŸ¥è¯¢éœ€æ±‚</strong>ï¼šé€‰æ‹©<strong>æœç´¢å¼•æ“æ–¹æ¡ˆ</strong>ï¼Œä½¿ç”¨å…¨æ–‡ç´¢å¼•å®ç°é«˜æ•ˆæ¨¡ç³ŠåŒ¹é…ã€‚</li><li><strong>èµ„æºæœ‰é™åœºæ™¯</strong>ï¼šé€‰æ‹©<strong>åŒå±‚åŠ å¯†å’Œéƒ¨åˆ†æ˜æ–‡å­˜å‚¨</strong>ï¼Œåœ¨å®‰å…¨æ€§å’Œæ€§èƒ½é—´æŠ˜ä¸­ã€‚</li></ul><p>æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©é€‚åˆçš„æ–¹æ¡ˆï¼Œç¡®ä¿åœ¨æ€§èƒ½ã€åŠŸèƒ½å’Œå®‰å…¨æ€§ä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p><h2 id="æ•°æ®åº“å­—æ®µåŠ å¯†å¯èƒ½ä¼šæ¶‰åŠåˆ°çš„é—®é¢˜"><a href="#æ•°æ®åº“å­—æ®µåŠ å¯†å¯èƒ½ä¼šæ¶‰åŠåˆ°çš„é—®é¢˜" class="headerlink" title="æ•°æ®åº“å­—æ®µåŠ å¯†å¯èƒ½ä¼šæ¶‰åŠåˆ°çš„é—®é¢˜"></a>æ•°æ®åº“å­—æ®µåŠ å¯†å¯èƒ½ä¼šæ¶‰åŠåˆ°çš„é—®é¢˜</h2><p>å¯¹æ•°æ®åº“ä¸­çš„æŸäº›å­—æ®µè¿›è¡ŒåŠ å¯†è™½ç„¶å¯ä»¥å¢å¼ºæ•°æ®å®‰å…¨æ€§ï¼Œä½†ä¹Ÿä¼šå¼•å…¥ä¸€äº›æ½œåœ¨çš„é—®é¢˜å’ŒæŒ‘æˆ˜ã€‚ä»¥ä¸‹æ˜¯å¯èƒ½å­˜åœ¨çš„é—®é¢˜ä»¥åŠç›¸åº”çš„è§£é‡Šï¼š</p><hr><h3 id="1-æŸ¥è¯¢åŠŸèƒ½å—é™"><a href="#1-æŸ¥è¯¢åŠŸèƒ½å—é™" class="headerlink" title="1. æŸ¥è¯¢åŠŸèƒ½å—é™"></a><strong>1. æŸ¥è¯¢åŠŸèƒ½å—é™</strong></h3><p>åŠ å¯†ä¼šæ”¹å˜æ•°æ®çš„åŸå§‹ç»“æ„ï¼Œä½¿å¾—ç›´æ¥åœ¨åŠ å¯†å­—æ®µä¸Šæ‰§è¡Œå¸¸è§„æŸ¥è¯¢å˜å¾—å›°éš¾ï¼š</p><ul><li><strong>æ¨¡ç³ŠæŸ¥è¯¢</strong>ï¼šåŠ å¯†åæ— æ³•ç›´æ¥æ”¯æŒ<code>LIKE &#39;%keyword%&#39;</code>ç­‰æ¨¡ç³ŠåŒ¹é…ã€‚</li><li><strong>æ’åº</strong>ï¼šåŠ å¯†åçš„æ•°æ®æ— æ³•åæ˜ åŸå§‹æ•°æ®çš„é¡ºåºï¼Œæ— æ³•ç›´æ¥è¿›è¡Œæ’åºæ“ä½œã€‚</li><li><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼šå¦‚<code>BETWEEN</code>æˆ–<code>&gt;ã€&lt;</code>ç­‰æ“ä½œï¼Œé€šå¸¸æ— æ³•é€‚ç”¨äºåŠ å¯†æ•°æ®ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>ä½¿ç”¨ä¿åºåŠ å¯†ï¼ˆOrder Preserving Encryption, OPEï¼‰æˆ–åŒæ€åŠ å¯†ï¼ˆHomomorphic Encryptionï¼‰ã€‚</li><li>å»ºç«‹é¢å¤–çš„æ˜æ–‡ç´¢å¼•æˆ–å“ˆå¸Œç´¢å¼•ï¼Œä¾›æŸ¥è¯¢ä½¿ç”¨ã€‚</li></ul><hr><h3 id="2-æ€§èƒ½é—®é¢˜"><a href="#2-æ€§èƒ½é—®é¢˜" class="headerlink" title="2. æ€§èƒ½é—®é¢˜"></a><strong>2. æ€§èƒ½é—®é¢˜</strong></h3><p>åŠ å¯†å’Œè§£å¯†æ“ä½œä¼šå¼•å…¥é¢å¤–çš„è®¡ç®—å¼€é”€ï¼Œç‰¹åˆ«æ˜¯åœ¨ä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li>æ‰¹é‡æ“ä½œï¼ˆå¦‚å¤§æ‰¹é‡æ’å…¥æˆ–æŸ¥è¯¢ï¼‰ã€‚</li><li>åŠ å¯†å­—æ®µå‚ä¸å¤æ‚çš„æ•°æ®åº“è¿ç®—æ—¶ã€‚</li><li>åŠ¨æ€ç”ŸæˆæŸ¥è¯¢æ¡ä»¶å¹¶é€ä¸€è§£å¯†éªŒè¯æ—¶ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>å¯¹æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸­ï¼Œä½¿ç”¨é«˜æ•ˆçš„åŠ å¯†ç®—æ³•ï¼ˆå¦‚AES-256ï¼‰ã€‚</li><li>åœ¨åº”ç”¨å±‚ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘é‡å¤çš„åŠ è§£å¯†æ“ä½œã€‚</li></ul><hr><h3 id="3-æ•°æ®ä¸€è‡´æ€§é—®é¢˜"><a href="#3-æ•°æ®ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="3. æ•°æ®ä¸€è‡´æ€§é—®é¢˜"></a><strong>3. æ•°æ®ä¸€è‡´æ€§é—®é¢˜</strong></h3><p>åŠ å¯†å’Œè§£å¯†å¯èƒ½å¼•å…¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p><ul><li>ä¸åŒç‰ˆæœ¬çš„åŠ å¯†ç®—æ³•æˆ–å¯†é’¥å¯¼è‡´æ•°æ®æ— æ³•æ­£ç¡®è§£å¯†ã€‚</li><li>æ•°æ®è¿ç§»æˆ–å¤‡ä»½è¿‡ç¨‹ä¸­ï¼Œå¯†é’¥æœªæ­£ç¡®åŒæ­¥ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>ä½¿ç”¨ç»Ÿä¸€çš„å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼ˆKMSï¼‰ï¼Œç¡®ä¿å¯†é’¥çš„ä¸€è‡´æ€§å’Œå®‰å…¨æ€§ã€‚</li><li>åœ¨åŠ å¯†å­—æ®µä¸­å­˜å‚¨å…ƒä¿¡æ¯ï¼ˆå¦‚åŠ å¯†ç‰ˆæœ¬å·ï¼‰ï¼Œä»¥ä¾¿å‡çº§åŠ å¯†æ–¹æ¡ˆæ—¶å…¼å®¹æ—§æ•°æ®ã€‚</li></ul><hr><h3 id="4-æ•°æ®åº“ç´¢å¼•å¤±æ•ˆ"><a href="#4-æ•°æ®åº“ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="4. æ•°æ®åº“ç´¢å¼•å¤±æ•ˆ"></a><strong>4. æ•°æ®åº“ç´¢å¼•å¤±æ•ˆ</strong></h3><p>åŠ å¯†ä¼šç ´ååŸå§‹æ•°æ®çš„æ’åºå’Œç›¸ä¼¼æ€§ï¼Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè¿›è€Œå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚ä¾‹å¦‚ï¼š</p><ul><li>B-Treeç´¢å¼•æ— æ³•ç”¨äºåŠ å¯†å­—æ®µã€‚</li><li>å…¨æ–‡ç´¢å¼•æ— æ³•è¯†åˆ«åŠ å¯†åçš„å­—ç¬¦ä¸²ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>å»ºç«‹é¢å¤–çš„æ˜æ–‡ç´¢å¼•å­—æ®µï¼Œä»…ç”¨äºåŠ é€ŸæŸ¥è¯¢ã€‚</li><li>ä½¿ç”¨å“ˆå¸Œç´¢å¼•ï¼Œä½†ä»…é€‚åˆç­‰å€¼æŸ¥è¯¢ã€‚</li></ul><hr><h3 id="5-æ•°æ®é•¿åº¦è†¨èƒ€"><a href="#5-æ•°æ®é•¿åº¦è†¨èƒ€" class="headerlink" title="5. æ•°æ®é•¿åº¦è†¨èƒ€"></a><strong>5. æ•°æ®é•¿åº¦è†¨èƒ€</strong></h3><p>åŠ å¯†åçš„æ•°æ®é€šå¸¸æ¯”åŸå§‹æ•°æ®æ›´é•¿ï¼ˆå¦‚AESåŠ å¯†ä¼šå¼•å…¥å¡«å……å’Œéšæœºå‘é‡ï¼‰ã€‚è¿™å¯èƒ½å¯¼è‡´ï¼š</p><ul><li>æ•°æ®åº“å­˜å‚¨ç©ºé—´å¢åŠ ã€‚</li><li>æ•°æ®è¡¨ä¸­å­—æ®µé•¿åº¦é™åˆ¶çš„é—®é¢˜ï¼ˆå¦‚<code>VARCHAR(255)</code>ä¸è¶³ä»¥å®¹çº³åŠ å¯†åçš„æ•°æ®ï¼‰ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>åˆç†è§„åˆ’å­—æ®µé•¿åº¦ï¼Œé¢„ç•™è¶³å¤Ÿç©ºé—´ï¼ˆå¦‚ä½¿ç”¨<code>TEXT</code>ç±»å‹ï¼‰ã€‚</li><li>ä½¿ç”¨ç´§å‡‘å‹åŠ å¯†æ–¹æ¡ˆï¼Œå‡å°‘åŠ å¯†åæ•°æ®çš„é•¿åº¦è†¨èƒ€ã€‚</li></ul><hr><h3 id="6-å¯†é’¥ç®¡ç†"><a href="#6-å¯†é’¥ç®¡ç†" class="headerlink" title="6. å¯†é’¥ç®¡ç†"></a><strong>6. å¯†é’¥ç®¡ç†</strong></h3><p>å¯†é’¥çš„ç®¡ç†å’Œä¿æŠ¤æ˜¯åŠ å¯†ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå¦‚æœå¯†é’¥æ³„éœ²æˆ–ä¸¢å¤±ï¼Œå¯èƒ½å¯¼è‡´ï¼š</p><ul><li>æ‰€æœ‰åŠ å¯†æ•°æ®å¤±å»å®‰å…¨æ€§ã€‚</li><li>æ•°æ®æ— æ³•è§£å¯†ï¼Œé€ æˆä¸šåŠ¡ä¸­æ–­ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>ä½¿ç”¨ä¸“ä¸šçš„å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚AWS KMSã€Azure Key Vaultï¼‰ã€‚</li><li>å®šæœŸè½®æ¢å¯†é’¥ï¼Œå¹¶å¯¹æ•°æ®é‡æ–°åŠ å¯†ï¼ˆKey Rotationï¼‰ã€‚</li><li>ä¸¥æ ¼é™åˆ¶å¯†é’¥çš„è®¿é—®æƒé™ï¼Œå¹¶å¯ç”¨å¤šå› ç´ è®¤è¯ã€‚</li></ul><hr><h3 id="7-å¤šåº”ç”¨åœºæ™¯çš„å…¼å®¹æ€§"><a href="#7-å¤šåº”ç”¨åœºæ™¯çš„å…¼å®¹æ€§" class="headerlink" title="7. å¤šåº”ç”¨åœºæ™¯çš„å…¼å®¹æ€§"></a><strong>7. å¤šåº”ç”¨åœºæ™¯çš„å…¼å®¹æ€§</strong></h3><p>å½“å¤šä¸ªåº”ç”¨æˆ–æœåŠ¡éœ€è¦è®¿é—®åŠ å¯†å­—æ®µæ—¶ï¼Œå¯èƒ½é¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>å„åº”ç”¨çš„åŠ å¯†ç®—æ³•æˆ–å¯†é’¥ç®¡ç†æ–¹æ¡ˆä¸ä¸€è‡´ã€‚</li><li>åº”ç”¨ä¹‹é—´çš„æ•°æ®äº¤æ¢éœ€è¦é¢å¤–çš„åŠ è§£å¯†å¤„ç†ï¼Œå¢åŠ å¤æ‚æ€§ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>åˆ¶å®šç»Ÿä¸€çš„åŠ å¯†æ ‡å‡†ï¼Œå¹¶åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å…±äº«åŠ è§£å¯†é€»è¾‘ã€‚</li><li>é€šè¿‡ä¸­é—´å±‚ï¼ˆå¦‚APIç½‘å…³ï¼‰å¤„ç†åŠ è§£å¯†é€»è¾‘ï¼Œç®€åŒ–åº”ç”¨ä»£ç ã€‚</li></ul><hr><h3 id="8-å¤‡ä»½ä¸æ¢å¤"><a href="#8-å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="8. å¤‡ä»½ä¸æ¢å¤"></a><strong>8. å¤‡ä»½ä¸æ¢å¤</strong></h3><p>å¯¹åŠ å¯†æ•°æ®è¿›è¡Œå¤‡ä»½å’Œæ¢å¤æ—¶ï¼Œå¯èƒ½å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>å¦‚æœå¤‡ä»½ä¸­åŒ…å«å¯†é’¥ï¼Œå­˜åœ¨æ³„éœ²é£é™©ã€‚</li><li>æ¢å¤åˆ°æ–°ç¯å¢ƒæ—¶ï¼Œå¯èƒ½å› ä¸ºå¯†é’¥ä¸¢å¤±æˆ–ä¸åŒ¹é…ï¼Œå¯¼è‡´æ•°æ®æ— æ³•è§£å¯†ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>ç¡®ä¿å¯†é’¥ä¸å¤‡ä»½æ•°æ®åˆ†å¼€å­˜å‚¨ã€‚</li><li>åœ¨æ¢å¤è¿‡ç¨‹ä¸­ï¼ŒéªŒè¯å¯†é’¥çš„æ­£ç¡®æ€§ï¼Œå¹¶è¿›è¡Œè§£å¯†æµ‹è¯•ã€‚</li></ul><hr><h3 id="9-æ•°æ®è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥å›°éš¾"><a href="#9-æ•°æ®è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥å›°éš¾" class="headerlink" title="9. æ•°æ®è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥å›°éš¾"></a><strong>9. æ•°æ®è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥å›°éš¾</strong></h3><p>åŠ å¯†æ•°æ®é€šå¸¸ä¸å¯è¯»ï¼Œè¿™ä¼šå¢åŠ è°ƒè¯•å’Œæ’æŸ¥é—®é¢˜çš„éš¾åº¦ï¼š</p><ul><li>å¼€å‘äººå‘˜æ— æ³•ç›´æ¥é€šè¿‡æ•°æ®åº“æŸ¥çœ‹åŠ å¯†å­—æ®µå†…å®¹ã€‚</li><li>æ—¥å¿—æˆ–é”™è¯¯ä¿¡æ¯ä¸­æ— æ³•æš´éœ²åŠ å¯†å­—æ®µçš„æ˜æ–‡ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>æä¾›å®‰å…¨çš„è°ƒè¯•å·¥å…·ï¼Œå…è®¸å¼€å‘äººå‘˜åœ¨å—æ§ç¯å¢ƒä¸­è§£å¯†æ•°æ®ã€‚</li><li>é¿å…åœ¨æ—¥å¿—ä¸­è®°å½•åŠ å¯†å­—æ®µå†…å®¹ï¼Œæˆ–ä½¿ç”¨è„±æ•å¤„ç†ã€‚</li></ul><hr><h3 id="10-æ³•è§„åˆè§„æ€§"><a href="#10-æ³•è§„åˆè§„æ€§" class="headerlink" title="10. æ³•è§„åˆè§„æ€§"></a><strong>10. æ³•è§„åˆè§„æ€§</strong></h3><p>åŠ å¯†æ•°æ®å¯èƒ½æ¶‰åŠæ•°æ®éšç§å’Œæ³•è§„åˆè§„æ€§ï¼š</p><ul><li>æŸäº›æ³•è§„ï¼ˆå¦‚GDPRã€HIPAAï¼‰è¦æ±‚æ•°æ®åŠ å¯†ï¼Œä½†åŒæ—¶ä¹Ÿè§„å®šåŠ å¯†æ–¹å¼å’Œå¯†é’¥ä¿æŠ¤çš„æ ‡å‡†ã€‚</li><li>ä¸åˆè§„çš„åŠ å¯†å®ç°å¯èƒ½å¯¼è‡´æ³•å¾‹é£é™©ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>éµå¾ªç›¸å…³æ³•è§„ï¼Œé€‰æ‹©ç¬¦åˆæ ‡å‡†çš„åŠ å¯†ç®—æ³•ï¼ˆå¦‚AESï¼‰ã€‚</li><li>å®šæœŸå®¡æŸ¥åŠ å¯†æ–¹æ¡ˆï¼Œç¡®ä¿æ»¡è¶³æœ€æ–°çš„åˆè§„è¦æ±‚ã€‚</li></ul><hr><h3 id="11-åº”ç”¨å±‚ä¸æ•°æ®åº“å±‚çš„èŒè´£åˆ’åˆ†"><a href="#11-åº”ç”¨å±‚ä¸æ•°æ®åº“å±‚çš„èŒè´£åˆ’åˆ†" class="headerlink" title="11. åº”ç”¨å±‚ä¸æ•°æ®åº“å±‚çš„èŒè´£åˆ’åˆ†"></a><strong>11. åº”ç”¨å±‚ä¸æ•°æ®åº“å±‚çš„èŒè´£åˆ’åˆ†</strong></h3><p>å†³å®šåŠ å¯†é€»è¾‘çš„ä½ç½®å¯èƒ½ä¼šå¼•å‘äº‰è®®ï¼š</p><ul><li>åœ¨åº”ç”¨å±‚åŠ å¯†ï¼šå¯æ§æ€§é«˜ï¼Œä½†æ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦è§£å¯†å­—æ®µã€‚</li><li>åœ¨æ•°æ®åº“å±‚åŠ å¯†ï¼šå‡å°‘å¼€å‘å¤æ‚åº¦ï¼Œä½†å¯èƒ½å¯¹æ€§èƒ½å’ŒåŠŸèƒ½æ”¯æŒæœ‰é™ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>å¯¹æ•æ„Ÿå­—æ®µï¼Œåœ¨åº”ç”¨å±‚åŠ å¯†ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚</li><li>å¯¹æ•´ä½“åŠ å¯†éœ€æ±‚ï¼Œå¯ä½¿ç”¨æ•°æ®åº“åŸç”ŸåŠ å¯†åŠŸèƒ½ï¼ˆå¦‚MySQL TDEï¼‰ã€‚</li></ul><hr><h3 id="12-æ•°æ®è¿ç§»å’Œæ¶æ„è°ƒæ•´çš„å¤æ‚æ€§"><a href="#12-æ•°æ®è¿ç§»å’Œæ¶æ„è°ƒæ•´çš„å¤æ‚æ€§" class="headerlink" title="12. æ•°æ®è¿ç§»å’Œæ¶æ„è°ƒæ•´çš„å¤æ‚æ€§"></a><strong>12. æ•°æ®è¿ç§»å’Œæ¶æ„è°ƒæ•´çš„å¤æ‚æ€§</strong></h3><p>å½“éœ€è¦å¯¹åŠ å¯†æ–¹æ¡ˆè¿›è¡Œå˜æ›´ï¼ˆå¦‚å‡çº§ç®—æ³•ã€æ”¹å˜åŠ å¯†å­—æ®µï¼‰æ—¶ï¼š</p><ul><li>æ•°æ®è¿ç§»éœ€è¦å¤§æ‰¹é‡è§£å¯†å’Œé‡æ–°åŠ å¯†æ“ä½œã€‚</li><li>æ•°æ®è¡¨ç»“æ„å¯èƒ½éœ€è¦è°ƒæ•´ï¼ˆå¦‚å¢åŠ ç‰ˆæœ¬å·å­—æ®µï¼‰ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>è®¾è®¡çµæ´»çš„æ•°æ®æ¶æ„ï¼Œé¢„ç•™åŠ å¯†ç›¸å…³çš„å…ƒä¿¡æ¯ã€‚</li><li>ä½¿ç”¨åˆ†æ‰¹è¿ç§»ç­–ç•¥ï¼Œé€æ­¥åˆ‡æ¢åŠ å¯†æ–¹æ¡ˆã€‚</li></ul><hr><p>é€šè¿‡è¿™äº›é—®é¢˜çš„åˆ†æï¼Œå¯ä»¥çœ‹å‡ºåŠ å¯†å­—æ®µçš„å®æ–½éœ€è¦åœ¨å®‰å…¨æ€§ã€åŠŸèƒ½æ€§å’Œæ€§èƒ½ä¹‹é—´åšå‡ºæƒè¡¡ã€‚è®¾è®¡æ—¶éœ€è¦ç»¼åˆè€ƒè™‘åº”ç”¨åœºæ™¯ã€ä¸šåŠ¡éœ€æ±‚å’Œç³»ç»Ÿçº¦æŸï¼ŒåŒæ—¶åˆ¶å®šæ˜ç¡®çš„ç®¡ç†ç­–ç•¥ï¼Œæ‰èƒ½é«˜æ•ˆè§£å†³å¯èƒ½é¢ä¸´çš„æŒ‘æˆ˜ã€‚</p><h2 id="è‡ªå®šä¹‰æ‰©å±•åŠ å¯†-è§£å¯†ç®—æ³•"><a href="#è‡ªå®šä¹‰æ‰©å±•åŠ å¯†-è§£å¯†ç®—æ³•" class="headerlink" title="è‡ªå®šä¹‰æ‰©å±•åŠ å¯†&amp;è§£å¯†ç®—æ³•"></a>è‡ªå®šä¹‰æ‰©å±•åŠ å¯†&amp;è§£å¯†ç®—æ³•</h2><p>ä¸ºå®ç°ç”¨æˆ·å¯è‡ªå®šä¹‰æ‰©å±•åŠ å¯†ç®—æ³•çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆ <strong>ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰</strong> å’Œ <strong>å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰</strong> è®¾è®¡ä¸€ä¸ªçµæ´»ã€å¯æ‰©å±•çš„åŠ å¯†å·¥å…·åŒ…ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„è®¾è®¡æ–¹æ¡ˆã€‚</p><hr><h3 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a><strong>1. éœ€æ±‚åˆ†æ</strong></h3><ol><li><strong>é»˜è®¤å®ç°</strong>ï¼š<ul><li>æä¾›ä¸€ä¸ªé»˜è®¤çš„åŠ å¯†ç®—æ³•ï¼ˆä¾‹å¦‚ AES + Base64 ç¼–ç ï¼‰ã€‚</li></ul></li><li><strong>è‡ªå®šä¹‰å®ç°</strong>ï¼š<ul><li>ç”¨æˆ·å¯ä»¥æ³¨å†Œè‡ªå·±çš„åŠ å¯†ç®—æ³•ï¼Œå®ç°ç‰¹å®šæ¥å£ï¼Œå¹¶åŠ¨æ€é€‰æ‹©ä½¿ç”¨ã€‚</li></ul></li><li><strong>çµæ´»æ‰©å±•</strong>ï¼š<ul><li>æ˜“äºæ–°å¢åŠ å¯†ç®—æ³•ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½ã€‚</li></ul></li><li><strong>é«˜å†…èšä½è€¦åˆ</strong>ï¼š<ul><li>ä¸»å·¥å…·åŒ…ä¸å…·ä½“åŠ å¯†ç®—æ³•çš„å®ç°è§£è€¦ã€‚</li></ul></li></ol><hr><h3 id="2-ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼"><a href="#2-ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼" class="headerlink" title="2. ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼"></a><strong>2. ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼</strong></h3><ol><li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼š<ul><li>å®šä¹‰ä¸€ä¸ªåŠ å¯†ç­–ç•¥æ¥å£ï¼Œä¸åŒåŠ å¯†ç®—æ³•å®ç°è¯¥æ¥å£ã€‚</li><li>é€šè¿‡åŠ¨æ€é€‰æ‹©åˆé€‚çš„åŠ å¯†ç­–ç•¥å®ç°çµæ´»åˆ‡æ¢ã€‚</li></ul></li><li><strong>å·¥å‚æ¨¡å¼</strong>ï¼š<ul><li>ä½¿ç”¨å·¥å‚æ–¹æ³•ç»Ÿä¸€ç®¡ç†åŠ å¯†ç®—æ³•çš„å®ä¾‹åŒ–ï¼Œæ”¯æŒé»˜è®¤ç­–ç•¥ä¸ç”¨æˆ·è‡ªå®šä¹‰ç­–ç•¥ã€‚</li></ul></li></ol><hr><h3 id="3-è¯¦ç»†è®¾è®¡"><a href="#3-è¯¦ç»†è®¾è®¡" class="headerlink" title="3. è¯¦ç»†è®¾è®¡"></a><strong>3. è¯¦ç»†è®¾è®¡</strong></h3><h4 id="3-1-å®šä¹‰åŠ å¯†ç­–ç•¥æ¥å£"><a href="#3-1-å®šä¹‰åŠ å¯†ç­–ç•¥æ¥å£" class="headerlink" title="3.1 å®šä¹‰åŠ å¯†ç­–ç•¥æ¥å£"></a><strong>3.1 å®šä¹‰åŠ å¯†ç­–ç•¥æ¥å£</strong></h4><p>æ‰€æœ‰åŠ å¯†ç®—æ³•éƒ½éœ€å®ç°æ­¤æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.encryption.strategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ å¯†ç­–ç•¥æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EncryptionStrategy</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ å¯†æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> plainText æ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¯†æ–‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">encrypt</span><span class="params">(String plainText)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£å¯†æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encryptedText å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜æ–‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">decrypt</span><span class="params">(String encryptedText)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="3-2-é»˜è®¤åŠ å¯†ç­–ç•¥"><a href="#3-2-é»˜è®¤åŠ å¯†ç­–ç•¥" class="headerlink" title="3.2 é»˜è®¤åŠ å¯†ç­–ç•¥"></a><strong>3.2 é»˜è®¤åŠ å¯†ç­–ç•¥</strong></h4><p>æä¾›é»˜è®¤çš„ AES + Base64 åŠ å¯†å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.encryption.strategy.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.encryption.strategy.EncryptionStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultEncryptionStrategy</span> <span class="keyword">implements</span> <span class="title class_">EncryptionStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALGORITHM</span> <span class="operator">=</span> <span class="string">&quot;AES&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TRANSFORMATION</span> <span class="operator">=</span> <span class="string">&quot;AES/ECB/PKCS5Padding&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECRET_KEY</span> <span class="operator">=</span> <span class="string">&quot;your-default-key&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String plainText)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(TRANSFORMATION);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(SECRET_KEY.getBytes(), ALGORITHM));</span><br><span class="line">        <span class="type">byte</span>[] encryptedBytes = cipher.doFinal(plainText.getBytes());</span><br><span class="line">        <span class="keyword">return</span> Base64.getEncoder().encodeToString(encryptedBytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decrypt</span><span class="params">(String encryptedText)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(TRANSFORMATION);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(SECRET_KEY.getBytes(), ALGORITHM));</span><br><span class="line">        <span class="type">byte</span>[] decodedBytes = Base64.getDecoder().decode(encryptedText);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(cipher.doFinal(decodedBytes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="3-3-å·¥å‚ç±»"><a href="#3-3-å·¥å‚ç±»" class="headerlink" title="3.3 å·¥å‚ç±»"></a><strong>3.3 å·¥å‚ç±»</strong></h4><p>å·¥å‚è´Ÿè´£æä¾›åˆé€‚çš„åŠ å¯†ç­–ç•¥å®ä¾‹ã€‚æ”¯æŒç”¨æˆ·æ³¨å†Œè‡ªå®šä¹‰ç­–ç•¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.encryption.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.encryption.strategy.EncryptionStrategy;</span><br><span class="line"><span class="keyword">import</span> com.example.encryption.strategy.impl.DefaultEncryptionStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptionStrategyFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, EncryptionStrategy&gt; STRATEGIES = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_STRATEGY</span> <span class="operator">=</span> <span class="string">&quot;default&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å—æ³¨å†Œé»˜è®¤ç­–ç•¥</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        STRATEGIES.put(DEFAULT_STRATEGY, <span class="keyword">new</span> <span class="title class_">DefaultEncryptionStrategy</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–åŠ å¯†ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name ç­–ç•¥åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åŠ å¯†ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EncryptionStrategy <span class="title function_">getStrategy</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> STRATEGIES.getOrDefault(name, STRATEGIES.get(DEFAULT_STRATEGY));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œè‡ªå®šä¹‰åŠ å¯†ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name ç­–ç•¥åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strategy ç­–ç•¥å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">registerStrategy</span><span class="params">(String name, EncryptionStrategy strategy)</span> &#123;</span><br><span class="line">        STRATEGIES.put(name, strategy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="3-4-è‡ªå®šä¹‰åŠ å¯†ç­–ç•¥"><a href="#3-4-è‡ªå®šä¹‰åŠ å¯†ç­–ç•¥" class="headerlink" title="3.4 è‡ªå®šä¹‰åŠ å¯†ç­–ç•¥"></a><strong>3.4 è‡ªå®šä¹‰åŠ å¯†ç­–ç•¥</strong></h4><p>ç”¨æˆ·å¯ä»¥å®ç° <code>EncryptionStrategy</code> æ¥å£æ¥è‡ªå®šä¹‰åŠ å¯†ç®—æ³•ï¼Œä¾‹å¦‚ä½¿ç”¨ RSAã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.encryption.strategy.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.encryption.strategy.EncryptionStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyFactory;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPairGenerator;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.PKCS8EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.X509EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RSAEncryptionStrategy</span> <span class="keyword">implements</span> <span class="title class_">EncryptionStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALGORITHM</span> <span class="operator">=</span> <span class="string">&quot;RSA&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">KEY_SIZE</span> <span class="operator">=</span> <span class="number">2048</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PublicKey publicKey;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PrivateKey privateKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RSAEncryptionStrategy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">KeyPairGenerator</span> <span class="variable">keyGen</span> <span class="operator">=</span> KeyPairGenerator.getInstance(ALGORITHM);</span><br><span class="line">        keyGen.initialize(KEY_SIZE);</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyGen.generateKeyPair();</span><br><span class="line">        <span class="built_in">this</span>.publicKey = keyPair.getPublic();</span><br><span class="line">        <span class="built_in">this</span>.privateKey = keyPair.getPrivate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String plainText)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(ALGORITHM);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, publicKey);</span><br><span class="line">        <span class="type">byte</span>[] encryptedBytes = cipher.doFinal(plainText.getBytes());</span><br><span class="line">        <span class="keyword">return</span> Base64.getEncoder().encodeToString(encryptedBytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decrypt</span><span class="params">(String encryptedText)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(ALGORITHM);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">        <span class="type">byte</span>[] decodedBytes = Base64.getDecoder().decode(encryptedText);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(cipher.doFinal(decodedBytes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="3-5-ä½¿ç”¨ç¤ºä¾‹"><a href="#3-5-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="3.5 ä½¿ç”¨ç¤ºä¾‹"></a><strong>3.5 ä½¿ç”¨ç¤ºä¾‹</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.example.encryption.factory.EncryptionStrategyFactory;</span><br><span class="line"><span class="keyword">import</span> com.example.encryption.strategy.EncryptionStrategy;</span><br><span class="line"><span class="keyword">import</span> com.example.encryption.strategy.impl.RSAEncryptionStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨é»˜è®¤ç­–ç•¥</span></span><br><span class="line">        <span class="type">EncryptionStrategy</span> <span class="variable">defaultStrategy</span> <span class="operator">=</span> EncryptionStrategyFactory.getStrategy(<span class="string">&quot;default&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">encrypted</span> <span class="operator">=</span> defaultStrategy.encrypt(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Default Encrypted: &quot;</span> + encrypted);</span><br><span class="line">        System.out.println(<span class="string">&quot;Default Decrypted: &quot;</span> + defaultStrategy.decrypt(encrypted));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨å†Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰ RSA ç­–ç•¥</span></span><br><span class="line">        <span class="type">EncryptionStrategy</span> <span class="variable">rsaStrategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RSAEncryptionStrategy</span>();</span><br><span class="line">        EncryptionStrategyFactory.registerStrategy(<span class="string">&quot;rsa&quot;</span>, rsaStrategy);</span><br><span class="line"></span><br><span class="line">        <span class="type">EncryptionStrategy</span> <span class="variable">customStrategy</span> <span class="operator">=</span> EncryptionStrategyFactory.getStrategy(<span class="string">&quot;rsa&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">rsaEncrypted</span> <span class="operator">=</span> customStrategy.encrypt(<span class="string">&quot;Hello, RSA!&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;RSA Encrypted: &quot;</span> + rsaEncrypted);</span><br><span class="line">        System.out.println(<span class="string">&quot;RSA Decrypted: &quot;</span> + customStrategy.decrypt(rsaEncrypted));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="4-è®¾è®¡ä¼˜åŠ¿"><a href="#4-è®¾è®¡ä¼˜åŠ¿" class="headerlink" title="4. è®¾è®¡ä¼˜åŠ¿"></a><strong>4. è®¾è®¡ä¼˜åŠ¿</strong></h3><ol><li><strong>çµæ´»æ‰©å±•</strong>ï¼š<ul><li>ç”¨æˆ·å¯ä»¥åŠ¨æ€æ³¨å†Œå¹¶ä½¿ç”¨æ–°çš„åŠ å¯†ç®—æ³•ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ã€‚</li></ul></li><li><strong>é»˜è®¤å›é€€</strong>ï¼š<ul><li>è‹¥æœªæ³¨å†Œè‡ªå®šä¹‰ç­–ç•¥ï¼Œåˆ™ä½¿ç”¨é»˜è®¤ç­–ç•¥ï¼Œä¿è¯åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚</li></ul></li><li><strong>é«˜å†…èšä½è€¦åˆ</strong>ï¼š<ul><li>å·¥å‚å’Œç­–ç•¥æ¨¡å¼å°†åŠ å¯†é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚</li></ul></li><li><strong>åŠ¨æ€é€‰æ‹©</strong>ï¼š<ul><li>æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©ä¸åŒçš„åŠ å¯†ç­–ç•¥ï¼Œæ»¡è¶³å¤šæ ·åŒ–éœ€æ±‚ã€‚</li></ul></li></ol><hr><h3 id="5-æ³¨æ„äº‹é¡¹"><a href="#5-æ³¨æ„äº‹é¡¹" class="headerlink" title="5. æ³¨æ„äº‹é¡¹"></a><strong>5. æ³¨æ„äº‹é¡¹</strong></h3><ol><li><strong>ç§˜é’¥ç®¡ç†</strong>ï¼š<ul><li>å¼ºçƒˆå»ºè®®å°†å¯†é’¥æ‰˜ç®¡åˆ°å®‰å…¨æœåŠ¡ï¼ˆå¦‚ AWS KMS æˆ– Vaultï¼‰ä¸­ï¼Œè€Œéç¡¬ç¼–ç ã€‚</li></ul></li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<ul><li>ç¡®ä¿åŠ å¯†ç­–ç•¥çš„å®ç°æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li></ul></li><li><strong>æ€§èƒ½</strong>ï¼š<ul><li>åŠ å¯†ç®—æ³•çš„æ€§èƒ½å¯èƒ½å› å¤æ‚åº¦è€Œå¼‚ï¼Œåº”æ ¹æ®éœ€æ±‚æƒè¡¡æ€§èƒ½ä¸å®‰å…¨æ€§ã€‚</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-09 MyBatis &amp; MyBatis-Plus</title>
      <link href="/2025/02/26/75-09%20MyBatis%20&amp;%20MyBatis-Plus/"/>
      <url>/2025/02/26/75-09%20MyBatis%20&amp;%20MyBatis-Plus/</url>
      
        <content type="html"><![CDATA[<h1 id="75-09-MyBatis-MyBatis-Plus"><a href="#75-09-MyBatis-MyBatis-Plus" class="headerlink" title="75-09 MyBatis &amp; MyBatis-Plus"></a>75-09 MyBatis &amp; MyBatis-Plus</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://blog.csdn.net/vcj1009784814/article/details/106391982?ops_request_misc=%7B%22request_id%22:%22171634221016800211539617%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171634221016800211539617&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-106391982-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=mybatis&spm=1018.2226.3001.4187">mybatisçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼Œç®€å•å…¨é¢ä¸€å‘å…¥é­‚</a>ï¼›</li><li><a href="https://blog.csdn.net/RenshenLi/article/details/118639091">mybatis+mybatisplusæºç å­¦ä¹ ï¼ˆåäº”ï¼‰æ—¥å¿— statementLog</a></li><li></li></ol><h2 id="MyBatisæºç è§£æ"><a href="#MyBatisæºç è§£æ" class="headerlink" title="MyBatisæºç è§£æ"></a>MyBatisæºç è§£æ</h2><h3 id="å‚è€ƒèµ„æ–™-1"><a href="#å‚è€ƒèµ„æ–™-1" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul><li><a href="https://www.cnblogs.com/lightdb/p/8512392.html">mybatis 3.xæºç æ·±åº¦è§£æä¸æœ€ä½³å®è·µ</a></li><li><a href="https://zhuanlan.zhihu.com/p/269761503">MyBatisæºç é˜…è¯»æŒ‡å—</a></li></ul><h3 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262037529.png" alt="image-20241112203759130"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262037173.png" alt="image-20241112202212227"></p><p><strong>æ¥å£å±‚</strong></p><p>æŒ‡ç”¨äºæ“ä½œæ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥æ¥å£ï¼Œå¦‚SqlSessionä»¥åŠç”¨æˆ·è‡ªå®šä¹‰çš„Mapperæ¥å£ï¼Œéƒ½å±äºæ¥å£å±‚ç»„ä»¶ã€‚é€šå¸¸æˆ‘ä»¬å¯¹MyBatisæºç å­¦ä¹ æ˜¯ä»æ¥å£å±‚å¼€å§‹çš„ï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œè‡³äºåŸå› ä¼šåœ¨å­¦ä¹ è·¯å¾„ä¸­è®²åˆ°ã€‚</p><p><strong>æ•°æ®å¤„ç†å±‚</strong></p><p>SQLæ‰§è¡Œæµç¨‹å®ç°ï¼Œå†…å®¹åŒ…æ‹¬åŠ¨æ€SQLè¯­å¥æ„å»ºã€å‚æ•°æ˜ å°„å¤„ç†ã€ç»“æœæ˜ å°„é›†å¤„ç†ã€‚ä»–æ˜¯æ•´ä¸ªMyBatisæºç çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æˆ‘ä»¬<strong>å­¦ä¹ çš„é‡ç‚¹å’Œéš¾ç‚¹</strong>ã€‚</p><p><strong>æ‰©å±•ä¸æ”¯æ’‘å±‚</strong></p><p>æŒ‡å¯¹ä¸»æµç¨‹åŠŸèƒ½ä¸Šçš„æ‰©å±•ä¸æ”¯æ’‘ã€‚</p><ul><li>æ‰©å±•ï¼šå¯¹ä¸»æµç¨‹ï¼Œåœ¨æ˜“ç”¨æ€§ã€æ€§èƒ½ä¸Šè¿›è¡Œæ‰©å±•ã€‚å¦‚SqlSessionä¸Mappræ¥å£å°±æ˜¯æ˜“ç”¨æ€§æ‰©å±•ã€‚ç¼“å­˜ä¸æ‡’åŠ è½½åˆ™æ˜¯æ‰§è¡Œæ€§èƒ½çš„æ‰©å±•ã€‚</li><li>æ”¯æ’‘ï¼šä¸»ç¨‹æ‰€ä¾èµ–çš„å·¥å…·ï¼Œå¦‚æ•°æ®æºã€åå°„å·¥å…·ã€æ—¥å¿—ç®¡ç†ã€é…ç½®æ„å»ºå™¨ã€è„šæœ¬æ‰§è¡Œå™¨ç­‰<strong>å­¦ä¹ é‡ç‚¹</strong></li></ul><p>æ•°æ®å¤„ç†å±‚æ˜¯MyBatisæ ¸å¿ƒä¸é‡ç‚¹ï¼Œæˆ‘ä»¬å­¦MyBatisæºç å…¶å®å°±æ˜¯å­¦å®ƒï¼Œæå®šå®ƒMyBatisæºç å°±æŒæ¡äº†80%ï¼Œå½“ç„¶å®ƒçš„éš¾åº¦ä¹Ÿæ˜¯æœ€å¤§çš„ã€‚ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæˆ‘æŠŠå®ƒåˆ†æˆäº†æ‰§è¡Œæµç¨‹ä¸æ˜ å°„é…ç½®ä¸¤éƒ¨åˆ†ã€‚</p><ul><li>æ‰§è¡Œæµç¨‹ï¼šä½“ç°SQLæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ¯ä¸ªæ­¥éª¤ã€‚</li><li>æ˜ å°„é…ç½®ï¼šSQLæ‰§è¡Œå‰åçš„åŠ¨æ€SQLè§£æã€å‚æ•°æ˜ å°„ã€ç»“æœé›†æ˜ å°„ã€‚</li></ul><h3 id="å­¦ä¹ ç›®æ ‡åˆ†è§£"><a href="#å­¦ä¹ ç›®æ ‡åˆ†è§£" class="headerlink" title="å­¦ä¹ ç›®æ ‡åˆ†è§£"></a>å­¦ä¹ ç›®æ ‡åˆ†è§£</h3><h4 id="ç¬¬ä¸€ç›®æ ‡-Sqlæ‰§è¡Œæµç¨‹"><a href="#ç¬¬ä¸€ç›®æ ‡-Sqlæ‰§è¡Œæµç¨‹" class="headerlink" title="ç¬¬ä¸€ç›®æ ‡-Sqlæ‰§è¡Œæµç¨‹"></a>ç¬¬ä¸€ç›®æ ‡-<strong>Sqlæ‰§è¡Œæµç¨‹</strong></h4><p>MyBatisæºç å­¦ä¹ çš„ç¬¬ä¸€ä¸ªç›®æ ‡å°±æ˜¯è¦æå®šå››ä¸ªç»„ä»¶æ‰€ç»„æˆçš„Sqlæ‰§è¡Œæµç¨‹ã€‚è¿™ä¸ªå››ä¸ªç»„ä»¶åˆ†åˆ«æ˜¯ï¼Œ<strong>æ‰§è¡Œå™¨(Execute)ã€Sqlå¤„ç†å™¨(StatementHandler)ã€å‚æ•°å¤„ç†å™¨(ParameterHandler)ã€ç»“æœé›†å¤„ç†å™¨(ResultSetHandler)</strong>ã€‚è¿™ä¸ªç›®æ ‡åˆå¯åˆ†è§£æˆ4ä¸ªå°ç›®æ ‡</p><ol><li>ç†è§£å››ä¸ªç»„ä»¶æ‰§è¡Œä¸Šçš„é¡ºåº</li><li>æ¯ä¸ªç»„ä»¶çš„ä½œç”¨åŠæ„ä¹‰</li><li>æŒæ¡Execute çš„ä¸‰ä¸ªå®ç°é€»è¾‘</li><li>æŒæ¡StatementHandlerçš„ä¸‰ä¸ªå®ç°é€»è¾‘</li></ol><p>è¿™ä¸ªç›®æ ‡ä¸æ˜¯æœ€éš¾çš„ï¼Œä½†æ˜¯æœ€è¦çš„ã€‚å¦‚æœæœ‰ä¸€å¤©ä½ æŠŠå­¦çš„MyBatisæºç å¿˜çš„å·®ä¸å¤šäº†ï¼Œä¹Ÿå¸Œæœ›ä½ è¿™ä¸ªæµç¨‹ä¸è¦å¿˜ï¼Œè¿™æ˜¯MySqlæºç çš„ä¸»å¹²å’Œè‚ªè„‰ç»œã€‚é¡ºç€å®ƒå°±å¯ä»¥æŠŠMyBatisçŸ¥è¯†å†æ‹¾å›æ¥ã€‚</p><p>è¯´æ˜ï¼šå…³äºå‚æ•°å¤„ç†ã€ç»“æœé›†å¤„ç†å…¶ä¸»è¦é€»è¾‘ç»†èŠ‚åœ¨äºæ˜ å°„å¤„ç†ï¼Œå¯ä»¥æ”¾åˆ°æ˜ å°„ç¯‡ç« å­¦ä¹ ã€‚</p><h4 id="ç¬¬äºŒç›®æ ‡ï¼šæ˜ å°„é…ç½®"><a href="#ç¬¬äºŒç›®æ ‡ï¼šæ˜ å°„é…ç½®" class="headerlink" title="ç¬¬äºŒç›®æ ‡ï¼šæ˜ å°„é…ç½®"></a><strong>ç¬¬äºŒç›®æ ‡ï¼šæ˜ å°„é…ç½®</strong></h4><p>ç¬¬äºŒä¸ªè¦æå®šçš„ç›®æ ‡ï¼Œå°±æ˜¯SQLæ‰§è¡Œæµç¨‹å½“ä¸­ï¼Œæ‰€éœ€è¦çš„ä¸‰å¤§æ˜ å°„ï¼šåˆ†åˆ«æ˜¯<strong>åŠ¨æ€SQLæ˜ å°„ã€å‚æ•°æ˜ å°„ã€ä»¥åŠç»“æœé›†æ˜ å°„</strong>ã€‚ä¸ä»…è¦ææ¸…æ¥šæ˜ å°„é…ç½®çš„åŠ è½½ä¸è§£æï¼Œæ›´é‡è¦çš„å¼„æ¸…æ¥šæ˜ å°„é€»è¾‘ã€‚</p><ul><li><strong>åŠ è½½è§£æ</strong>ï¼šæŒ‡ç”¨æˆ·é…ç½®çš„XMLè§£ææˆJAVAé…ç½®å¯¹è±¡ã€‚æ¯”å¦‚<Select>â€¦.</Select>å—,æœ€ç»ˆè¦è§£ææˆSqlSourceã€‚æˆ–<resultMap>â€¦</resultMap> è¦è§£ææˆResultMapå¯¹è±¡ã€‚</li><li><strong>æ˜ å°„é€»è¾‘</strong>ï¼šæ¯”å¦‚SqlSourceå¦‚ä½•åŸºäºå‚æ•°ç”Ÿæˆå¯æ‰§è¡ŒSQLï¼ŒResultMapå¦‚ä½•å°†ç»“æœé›†ï¼Œè§£ææˆJAVAå¯¹è±¡ç­‰ã€‚</li></ul><p>è¿™é‡Œé¢æ¶‰åŠå†…å®¹éå¸¸å¤šï¼ŒåŒæ ·å¯ä»¥åˆ’åˆ†æˆä¸€ä¸ªä¸ªå°ç›®æ ‡ï¼š</p><table><thead><tr><th>å°ç›®æ ‡</th><th></th></tr></thead><tbody><tr><td>1</td><td>ç†è§£Sqlæ˜ å°„å£°æ˜(MappedStatement)çš„ä½œç”¨ï¼Œä»¥åŠå®ƒä¸ä¸‰å¤§æ˜ å°„çš„å…³ç³»ã€‚</td></tr><tr><td>2</td><td>æŒæ¡åŠ¨æ€SQL(sqlSource)è§£æè¿‡ç¨‹ï¼ŒåŒ…æ‹¬å…¶è„šæœ¬è¡¨è¾¾ç¤ºçš„æ‰§è¡Œé€»è¾‘</td></tr><tr><td>3</td><td>æŒæ¡MyBatisæ‰€å°è£…çš„æ˜ å°„å·¥å…·åŒ…çš„ä½¿ç”¨</td></tr><tr><td>4</td><td>æŒæ¡å‚æ•°è½¬æ¢è¿‡ç¨‹ï¼Œä»¥åŠæ˜ å°„çš„å°è£…è¿‡ç¨‹</td></tr><tr><td>5</td><td>æŒæ¡ç»“æœé›†æ˜ å°„æ ¸å¿ƒé€»è¾‘ï¼ŒåŒ…æ‹¬å…³è”æ˜ å°„ï¼Œ1å¯¹1ã€1å¯¹å¤šçš„å¤„ç†ã€‚è¿˜æœ‰æ›´å¤æ‚çš„å¾ªç¯ä¾èµ–å¤„ç†</td></tr><tr><td>6</td><td>æŒæ¡å…¨éƒ¨é…ç½®(Confgiuration) çš„æ ¸å¿ƒå®šä½,ä»¥åŠå®ƒçš„åŠ è½½è§£æè¿‡ç¨‹</td></tr></tbody></table><h3 id="æ•°æ®å¤„ç†å±‚"><a href="#æ•°æ®å¤„ç†å±‚" class="headerlink" title="æ•°æ®å¤„ç†å±‚"></a>æ•°æ®å¤„ç†å±‚</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262037613.png" alt="image-20241112202638916"></p><p>è¿™ä¸€å±‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹å°±æ˜¯MyBatisçš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œå¦‚æœæŠŠè¿™éƒ¨åˆ†æ‹¿ä¸‹çš„ï¼ŒMyBatisä»¥åŠæ‹¿ä¸‹ä¸ƒå…«åäº†ã€‚</p><p>MyBatisé‡ç‚¹å°±æ˜¯ä¸Šé¢çš„å››å¤§æ ¸å¿ƒç»„ä»¶ï¼šæ‰§è¡Œå™¨ã€SQLå¤„ç†å™¨ã€å‚æ•°å¤„ç†å™¨å’Œç»“æœé›†å¤„ç†å™¨ã€‚æˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨å…¶ä¸­è¿™å››ä¸ªç»„ä»¶ä»£è¡¨çš„å…·ä½“å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿè¿™å››ä¸ªç»„ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿä»¥åŠä»–ä»¬æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p><p>ä»ä¸Šé¢çš„è¿™ä¸ªå›¾ä¸­æˆ‘ä»¬å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºè¿™å››ä¸ªç»„ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼šæ‰§è¡Œå™¨ã€SQLå¤„ç†å™¨ã€å‚æ•°å¤„ç†å™¨ç„¶åå°±æ˜¯ç»“æœå¤„ç†å™¨ã€‚ä½†æ˜¯è¿™å››ä¸ªç»„ä»¶çš„èŒè´£æ˜¯ä»€ä¹ˆï¼Ÿä»¥åŠå¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>åœ¨è¯¦ç»†çš„ä»‹ç»MyBatisä¸­çš„SQLæ‰§è¡Œæµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹JDBCä¸­çš„SQLæ‰§è¡Œæµç¨‹ï¼š</p><ol><li>æˆ‘ä»¬éœ€è¦ä½¿ç”¨Class.forName()æ–¹æ³•åŠ è½½æ•°æ®åº“é©±åŠ¨ç±»</li><li>è·å–åˆ°è¿æ¥å¯¹è±¡ï¼Œå…¶åº•å±‚çš„å®ç°æ˜¯åŸºäºSocketè¿›è¡Œæ•°æ®åº“è¿æ¥çš„</li><li>æ‰§è¡ŒSQLè¯­å¥ï¼Œæ”¾å›æ‰§è¡Œç»“æœ</li><li>å¤„ç†æ‰§è¡Œç»“æœï¼Œå¹¶ä¸ç»“æœé›†è¿›è¡Œæ˜ å°„ï¼Œç„¶åé‡Šæ”¾èµ„æº</li></ol><h4 id="æ‰§è¡Œå™¨"><a href="#æ‰§è¡Œå™¨" class="headerlink" title="æ‰§è¡Œå™¨"></a>æ‰§è¡Œå™¨</h4><p>Executoræ˜¯MyBatisçš„æ ¸å¿ƒç»„ä»¶ï¼Œç®¡ç†æ•´ä¸ªSQLçš„æ‰§è¡Œæµç¨‹ã€‚å¯ä»¥ç†è§£æˆæ˜¯MyBatisä¸­çš„â€œå¤§ç®¡å®¶â€ï¼Œè´Ÿè´£è°ƒç”¨å…¶ä»–ç»„ä»¶å¹¶ç®¡ç†ç¼“å­˜ã€äº‹åŠ¡ç­‰ã€‚Executoræœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼š</p><ul><li><strong>SimpleExecutor</strong>ï¼šæœ€ç®€å•çš„æ‰§è¡Œå™¨ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„Statementè¿›è¡ŒSQLæ‰§è¡Œã€‚è¿™ç§æ–¹å¼ä¸ä½¿ç”¨ç¼“å­˜ï¼Œé€‚åˆç®€å•çš„æŸ¥è¯¢éœ€æ±‚ã€‚</li><li><strong>ReuseExecutor</strong>ï¼šå¤ç”¨å·²æœ‰çš„Statementå¯¹è±¡ï¼Œé€‚ç”¨äºåŒä¸€è¿æ¥ä¸­åå¤æ‰§è¡Œç›¸ä¼¼SQLçš„åœºæ™¯ï¼Œå‡å°‘Statementçš„åˆ›å»ºæ¬¡æ•°ã€‚</li><li><strong>BatchExecutor</strong>ï¼šæ‰¹å¤„ç†æ‰§è¡Œå™¨ï¼Œå°†å¤šæ¡SQLè¯­å¥ç»„åˆæˆä¸€ä¸ªæ‰¹å¤„ç†ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”ã€‚é€‚ç”¨äºå¤§é‡ç›¸ä¼¼çš„æ’å…¥ã€æ›´æ–°æ“ä½œã€‚</li></ul><p><strong>æµç¨‹ç®€æ</strong>ï¼šExecutorçš„å·¥ä½œæµç¨‹ä»æ¥æ”¶åˆ°SQLè¯·æ±‚å¼€å§‹ï¼Œåˆ°æ•°æ®åº“è·å–ç»“æœå¹¶è¿”å›ç»™è°ƒç”¨æ–¹ç»“æŸã€‚åœ¨æµç¨‹ä¸­ï¼ŒExecutorä¼šé€‰æ‹©å…·ä½“çš„StatementHandlerå»å¤„ç†SQLçš„ç”Ÿæˆå’Œæ‰§è¡Œã€‚</p><p>Executoræ˜¯MyBatisæ ¸å¿ƒï¼Œæ˜¯æ•´ä¸ªSQLæ‰§è¡Œçš„å…¥å£ï¼Œå®ƒè´Ÿè´£ç®¡ç†å’Œåè°ƒå…¶å®ƒç»„ä»¶çš„å·¥ä½œï¼Œå…¶ä¸»è¦æ˜¯å‘èµ·ã€æ‰§è¡ŒSQLè¯­å¥å¹¶åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­è¿›è¡Œå¿…è¦çš„ç®¡ç†ã€ç¼“å­˜å’Œäº‹åŠ¡æ§åˆ¶ã€‚</p><p>æ‰§è¡Œå™¨ä¹Ÿæä¾›äº†ç¼“å­˜æœºåˆ¶ï¼Œå…¶æä¾›äº†ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Œæé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼Œé™ä½äº†å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚</p><ol><li>ä¸€çº§ç¼“å­˜ï¼šé’ˆå¯¹çš„æ˜¯åŒä¸€ä¸ªSqlSessionåœ¨ä¸€å®šæ—¶é—´å†…æ‰§è¡Œç›¸åŒçš„SQLæŸ¥è¯¢æ—¶ä¼šè¢«ç¼“å­˜ï¼Œä»è€Œé¿å…å¤šæ¬¡è®¿é—®æ•°æ®åº“ï¼›</li><li>äºŒçº§ç¼“å­˜ï¼šé’ˆå¯¹çš„æ˜¯mapperå±‚é¢ï¼Œåœ¨ä¸åŒçš„SqlSessionä¸­ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…æ‰§è¡Œç›¸åŒçš„SQLæŸ¥è¯¢ä¼šè¢«ç¼“å­˜ï¼Œä»è€Œé¿å…å¤šæ¬¡è®¿é—®æ•°æ®åº“ã€‚</li></ol><p>åŒæ—¶è¯¥æ‰§è¡Œå™¨ä¹Ÿæä¾›äº†äº‹åŠ¡æ”¯æŒçš„èƒ½åŠ›ï¼Œæ‰§è¡Œå™¨å¯ä»¥æ ¹æ®éœ€æ±‚æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šï¼Œå®ç°äº‹åŠ¡çš„åŸå­æ€§</p><h2 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h2><h3 id="åŠ¨æ€SQL"><a href="#åŠ¨æ€SQL" class="headerlink" title="åŠ¨æ€SQL"></a>åŠ¨æ€SQL</h3><h4 id="if"><a href="#if" class="headerlink" title="if"></a>if</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;find&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM student WHERE age &gt;= 18</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND name like &#x27;%$&#123;name&#125;%&#x27;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="choose"><a href="#choose" class="headerlink" title="choose"></a>choose</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- choose å’Œ when , otherwise æ˜¯é…å¥—æ ‡ç­¾ </span></span><br><span class="line"><span class="comment">ç±»ä¼¼äºjavaä¸­çš„switchï¼Œåªä¼šé€‰ä¸­æ»¡è¶³æ¡ä»¶çš„ä¸€ä¸ª</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findActiveBlogLike&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG WHERE state = â€˜ACTIVEâ€™</span><br><span class="line">  <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">      AND title like #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span><br><span class="line">      AND author_name like #&#123;author.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">      AND featured = 1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>trim</p><h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4><p><code>&lt;where&gt;</code>æ ‡ç­¾åªä¼šåœ¨è‡³å°‘æœ‰ä¸€ä¸ªå­å…ƒç´ è¿”å›äº†SQLè¯­å¥æ—¶ï¼Œæ‰ä¼šå‘SQLè¯­å¥ä¸­æ·»åŠ WHEREï¼Œå¹¶ä¸”å¦‚æœWHEREä¹‹åæ˜¯ä»¥ANDæˆ–ORå¼€å¤´ï¼Œä¼šè‡ªåŠ¨å°†å…¶åˆ æ‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findActiveBlogLike&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;state != null&quot;</span>&gt;</span></span><br><span class="line">         state = #&#123;state&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">        AND title like #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span><br><span class="line">        AND author_name like #&#123;author.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„whereä¹Ÿå¯ä»¥ä½¿ç”¨trimæ¥æ›¿æ¢ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND | OR&quot;</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><p>åœ¨è‡³å°‘æœ‰ä¸€ä¸ªå­å…ƒç´ è¿”å›äº†SQLè¯­å¥æ—¶ï¼Œæ‰ä¼šå‘SQLè¯­å¥ä¸­æ·»åŠ SETï¼Œå¹¶ä¸”å¦‚æœSETä¹‹åæ˜¯ä»¥<code>,</code>å¼€å¤´çš„è¯ï¼Œä¼šè‡ªåŠ¨å°†å…¶åˆ æ‰</p><p><code>&lt;set&gt;</code>æ ‡ç­¾ç›¸å½“äºå¦‚ä¸‹çš„<code>&lt;trim&gt;</code>æ ‡ç­¾:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><p>ç”¨æ¥åšè¿­ä»£æ‹¼æ¥çš„ï¼Œé€šå¸¸ä¼šä¸SQLè¯­å¥ä¸­çš„INæŸ¥è¯¢æ¡ä»¶ç»“åˆä½¿ç”¨ï¼Œæ³¨æ„ï¼Œåˆ°parameterTypeä¸ºListï¼ˆé“¾è¡¨ï¼‰æˆ–è€…Arrayï¼ˆæ•°ç»„ï¼‰ï¼Œåé¢åœ¨å¼•ç”¨æ—¶ï¼Œå‚æ•°åå¿…é¡»ä¸ºlistæˆ–è€…arrayã€‚å¦‚åœ¨foreachæ ‡ç­¾ä¸­ï¼Œcollectionå±æ€§åˆ™ä¸ºéœ€è¦è¿­ä»£çš„é›†åˆï¼Œç”±äºå…¥å‚æ˜¯ä¸ªListï¼Œæ‰€ä»¥å‚æ•°åå¿…é¡»ä¸ºlist.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;batchFind&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM student WHERE id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">          #&#123;item&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h4><p>å¯å°†é‡å¤çš„SQLç‰‡æ®µæå–å‡ºæ¥ï¼Œç„¶ååœ¨éœ€è¦çš„åœ°æ–¹ï¼Œä½¿ç”¨<code>&lt;include&gt;</code>æ ‡ç­¾è¿›è¡Œå¼•ç”¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM user</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;whereClause&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;whereClause&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user != null&quot;</span>&gt;</span></span><br><span class="line">                 AND username like &#x27;%$&#123;user.name&#125;%&#x27;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><p>mybatisçš„åŠ¨æ€SQLéƒ½æ˜¯ç”¨OGNLè¡¨è¾¾å¼è¿›è¡Œè§£æçš„ï¼Œå¦‚æœéœ€è¦åˆ›å»ºOGNLè¡¨è¾¾å¼ä»¥å¤–çš„å˜é‡ï¼Œå¯ä»¥ç”¨bindæ ‡ç­¾.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlogsLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27; + _parameter.getTitle() + &#x27;%&#x27;&quot;</span> /&gt;</span></span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE title LIKE #&#123;pattern&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="MyBatisæ³¨è§£"><a href="#MyBatisæ³¨è§£" class="headerlink" title="MyBatisæ³¨è§£"></a>MyBatisæ³¨è§£</h3><h4 id="Intercepts-Signature"><a href="#Intercepts-Signature" class="headerlink" title="@Intercepts &amp; @Signature"></a><code>@Intercepts</code> &amp; <code>@Signature</code></h4><h5 id="å‚è€ƒèµ„æ–™-2"><a href="#å‚è€ƒèµ„æ–™-2" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h5><ol><li><a href="https://blog.csdn.net/weixin_43505211/article/details/128050083?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522172180231216800182719121%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=172180231216800182719121&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-128050083-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=@Intercepts&spm=1018.2226.3001.4187">Mybatisæ‹¦æˆªå™¨æ³¨è§£@Interceptsä¸@Signatureæ³¨è§£å±æ€§è¯´æ˜</a></li></ol><h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h5><p><code>@Intercepts</code> æ˜¯ MyBatis æä¾›çš„æ³¨è§£ï¼Œç”¨äºå®šä¹‰ MyBatis æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰è¦æ‹¦æˆªçš„æ–¹æ³•ã€‚MyBatis æ‹¦æˆªå™¨æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æœºåˆ¶ï¼Œå…è®¸ä½ åœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ é¢å¤–çš„å¤„ç†é€»è¾‘ï¼Œæ¯”å¦‚<strong>ä¿®æ”¹ SQL è¯­å¥</strong>ã€<strong>è®°å½•æ—¥å¿—</strong>ã€<strong>äº‹åŠ¡å¤„ç†</strong>ç­‰ã€‚</p><p>@Interceptså¯ä»¥æ‹¦æˆªä»¥ä¸‹å››ç§ç±»å‹ï¼š</p><ul><li><strong>Executor sqlçš„å†…éƒ¨æ‰§è¡Œå™¨</strong></li><li><strong>ParameterHandler æ‹¦æˆªå‚æ•°çš„å¤„ç†</strong></li><li><strong>StatementHandler æ‹¦æˆªsqlçš„æ„å»º</strong></li><li><strong>ResultSetHandler æ‹¦æˆªç»“æœçš„å¤„ç†</strong></li></ul><p><code>@Signature</code> æ³¨è§£ç”¨äºå®šä¹‰å…·ä½“çš„æ‹¦æˆªç‚¹ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>typeï¼šå°±æ˜¯æŒ‡å®šæ‹¦æˆªå™¨ç±»å‹ï¼ˆParameterHandler ï¼ŒStatementHandlerï¼ŒResultSetHandler ï¼‰</strong></li><li><strong>methodï¼šæ˜¯æ‹¦æˆªå™¨ç±»å‹ä¸­çš„æ–¹æ³•ï¼Œä¸æ˜¯è‡ªå·±å†™çš„æ–¹æ³•</strong></li><li><strong>argsï¼šæ˜¯methodä¸­æ–¹æ³•çš„å…¥å‚</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262037752.png" alt="img"></p><h3 id="MyBatisæ‹¦æˆªå™¨"><a href="#MyBatisæ‹¦æˆªå™¨" class="headerlink" title="MyBatisæ‹¦æˆªå™¨"></a>MyBatisæ‹¦æˆªå™¨</h3><p>å‚è€ƒèµ„æ–™ </p><ol><li><a href="https://blog.csdn.net/wb1046329430/article/details/111501755">https://blog.csdn.net/wb1046329430/article/details/111501755</a></li></ol><h4 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262037854.png" alt="img"></p><h4 id="æ·»åŠ æ³¨è§£"><a href="#æ·»åŠ æ³¨è§£" class="headerlink" title="æ·»åŠ æ³¨è§£"></a>æ·»åŠ æ³¨è§£</h4><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262037974.png" alt="image-20240728155336513"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(type = Executor.class, method = &quot;query&quot;, args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;),</span></span><br><span class="line"><span class="meta">    @Signature(type = StatementHandler.class, method = &quot;prepare&quot;, args = &#123;Connection.class, Integer.class&#125;),</span></span><br><span class="line"><span class="meta">    @Signature(type = ParameterHandler.class, method = &quot;setParameters&quot;, args = &#123;PreparedStatement.class&#125;),</span></span><br><span class="line"><span class="meta">    @Signature(type = ResultSetHandler.class, method = &quot;handleResultSets&quot;, args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h4><p><code>MyBatis</code>æ‹¦æˆªå™¨é»˜è®¤ä¼šæŒ‰é¡ºåºæ‹¦æˆªä»¥ä¸‹çš„å››ä¸ªæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.executor.Executor  <span class="comment">//æ‹¦æˆªæ‰§è¡Œå™¨æ–¹æ³•</span></span><br><span class="line">org.apache.ibatis.executor.statement.StatementHandler  <span class="comment">//æ‹¦æˆªSQLè¯­æ³•æ„å»ºå¤„ç†</span></span><br><span class="line">org.apache.ibatis.executor.parameter.ParameterHandler  <span class="comment">//æ‹¦æˆªå‚æ•°å¤„ç†</span></span><br><span class="line">org.apache.ibatis.executor.resultset.ResultSetHandler  <span class="comment">//æ‹¦æˆªç»“æœé›†å¤„ç†</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…·ä½“æ˜¯æ‹¦æˆªè¿™å››ä¸ªæ¥å£å¯¹åº”çš„å®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.executor.CachingExecutor</span><br><span class="line">org.apache.ibatis.executor.statement.RoutingStatementHandler</span><br><span class="line">org.apache.ibatis.scripting.defaults.DefaultParameterHandler</span><br><span class="line">org.apache.ibatis.executor.resultset.DefaultResultSetHandler</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="MyBatisè‡ªåŠ¨æ’å…¥æ—¶é—´"><a href="#MyBatisè‡ªåŠ¨æ’å…¥æ—¶é—´" class="headerlink" title="MyBatisè‡ªåŠ¨æ’å…¥æ—¶é—´"></a>MyBatisè‡ªåŠ¨æ’å…¥æ—¶é—´</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.screw.communal.Interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ObjectUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.binding.MapperMethod;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.Executor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.statement.RoutingStatementHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.MappedStatement;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.SqlCommandType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Intercepts;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Invocation;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Signature;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.ResultHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> po.BasePO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> MyBatisSqlInterceptor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> ä¸ºMyBatisæ‰§è¡ŒSQLè‡ªåŠ¨æ’å…¥æŸäº›å…¬å…±æ¡ä»¶ æˆ– è‡ªåŠ¨æ’å…¥å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-07-28</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">//        @Signature(type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">//                method = &quot;query&quot;,</span></span><br><span class="line"><span class="meta">//                args = &#123;Statement.class, ResultHandler.class&#125;),</span></span><br><span class="line"><span class="meta">        @Signature(</span></span><br><span class="line"><span class="meta">                type = Executor.class,</span></span><br><span class="line"><span class="meta">                method = &quot;update&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;MappedStatement.class, Object.class&#125;</span></span><br><span class="line"><span class="meta">        ),</span></span><br><span class="line"><span class="meta">//        @Signature(</span></span><br><span class="line"><span class="meta">//                type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">//                method = &quot;batch&quot;,</span></span><br><span class="line"><span class="meta">//                args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisSqlInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">MappedStatement</span> <span class="variable">mappedStatement</span> <span class="operator">=</span> (MappedStatement) invocation.getArgs()[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// è·å– SQL å‘½ä»¤</span></span><br><span class="line">        <span class="type">SqlCommandType</span> <span class="variable">sqlCommandType</span> <span class="operator">=</span> mappedStatement.getSqlCommandType();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åªåˆ¤æ–­æ–°å¢å’Œä¿®æ”¹</span></span><br><span class="line">        <span class="keyword">if</span> (SqlCommandType.INSERT.equals(sqlCommandType) || SqlCommandType.UPDATE.equals(sqlCommandType)) &#123;</span><br><span class="line">            <span class="comment">// è·å–å‚æ•°</span></span><br><span class="line"><span class="comment">//            Object parameter = invocation.getArgs()[1];</span></span><br><span class="line">            <span class="comment">// è·å–å‚æ•°</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">parameter</span> <span class="operator">=</span> invocation.getArgs()[<span class="number">1</span>];</span><br><span class="line">            setParameter(parameter, sqlCommandType);</span><br><span class="line"><span class="comment">//            //æ‰¹é‡æ“ä½œæ—¶</span></span><br><span class="line"><span class="comment">//            if (parameter instanceof MapperMethod.ParamMap) &#123;</span></span><br><span class="line"><span class="comment">//                MapperMethod.ParamMap map = (MapperMethod.ParamMap) parameter;</span></span><br><span class="line"><span class="comment">//                Object obj = map.get(&quot;list&quot;);</span></span><br><span class="line"><span class="comment">//                List&lt;?&gt; list = (List&lt;?&gt;) obj;</span></span><br><span class="line"><span class="comment">//                if (list != null) &#123;</span></span><br><span class="line"><span class="comment">//                    for (Object o : list) &#123;</span></span><br><span class="line"><span class="comment">//                        setParameter(o, sqlType);</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125; else &#123;</span></span><br><span class="line"><span class="comment">//                setParameter(parameter, sqlType);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParameter</span><span class="params">(Object parameter, SqlCommandType sqlCommandType)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        Class&lt;?&gt; aClass = parameter.getClass();</span><br><span class="line"><span class="comment">//        Field[] declaredFields;</span></span><br><span class="line">        List&lt;Field[]&gt; declaredFields = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// è·å–å½“å‰ç±»å’Œçˆ¶ç±»çš„å±æ€§</span></span><br><span class="line">        <span class="keyword">while</span>(ObjectUtils.isNotEmpty(aClass) &amp;&amp; aClass != Object.class)&#123;</span><br><span class="line">            declaredFields.add(aClass.getDeclaredFields());</span><br><span class="line">            aClass = aClass.getSuperclass();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Field[] fields : declaredFields)&#123;</span><br><span class="line">            <span class="keyword">for</span> (Field field : fields)&#123;</span><br><span class="line">                <span class="type">TableField</span> <span class="variable">annotation</span> <span class="operator">=</span> field.getAnnotation(TableField.class);</span><br><span class="line">                <span class="keyword">if</span> (ObjectUtils.isEmpty(annotation))&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (SqlCommandType.INSERT.equals(sqlCommandType)) &#123; <span class="comment">// insert è¯­å¥æ’å…¥ createBy</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> annotation.value();</span><br><span class="line">                    <span class="keyword">if</span>(StringUtils.equals(value,<span class="string">&quot;create_time&quot;</span>))&#123;</span><br><span class="line">                        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                        field.set(parameter, LocalDateTime.now());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(StringUtils.equals(value,<span class="string">&quot;update_time&quot;</span>))&#123;</span><br><span class="line">                        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                        field.set(parameter, LocalDateTime.now());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (SqlCommandType.UPDATE.equals(sqlCommandType)) &#123; <span class="comment">// update è¯­å¥æ’å…¥ updateTime</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> annotation.value();</span><br><span class="line">                    <span class="keyword">if</span>(StringUtils.equals(value,<span class="string">&quot;update_time&quot;</span>))&#123;</span><br><span class="line">                        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                        field.set(parameter, LocalDateTime.now());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰“å°æ—¥å¿—"><a href="#æ‰“å°æ—¥å¿—" class="headerlink" title="æ‰“å°æ—¥å¿—"></a>æ‰“å°æ—¥å¿—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fang.screw.communal.Interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.cloud.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.reflect.FieldUtils;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.ObjectUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.parameter.ParameterHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.BoundSql;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.ParameterMapping;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.ParameterMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Intercepts;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Invocation;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Signature;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.ResultHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.TypeHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@FileName</span> MybatisSqlInterceptor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> Mybatis-Plus è‡ªå®šä¹‰SQLæ‹¦æˆªå¤„ç†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-07-24</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">        @Signature(type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">                method = &quot;query&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;Statement.class, ResultHandler.class&#125;),</span></span><br><span class="line"><span class="meta">        @Signature(</span></span><br><span class="line"><span class="meta">                type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">                method = &quot;update&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;Statement.class&#125;</span></span><br><span class="line"><span class="meta">        ),</span></span><br><span class="line"><span class="meta">        @Signature(</span></span><br><span class="line"><span class="meta">        type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">        method = &quot;batch&quot;,</span></span><br><span class="line"><span class="meta">        args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisSqlLogInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ä¸€ä¸ªåŒ…å«éœ€è¦æ·»åŠ å•å¼•å·æ‹¬èµ·æ¥çš„å‚æ•°ç±»å‹é›†åˆã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; NEED_BRACKETS =</span><br><span class="line">            Collections.unmodifiableSet(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;String&quot;</span>, <span class="string">&quot;Date&quot;</span>, <span class="string">&quot;Time&quot;</span>, <span class="string">&quot;LocalDate&quot;</span>, <span class="string">&quot;LocalTime&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;LocalDateTime&quot;</span>, <span class="string">&quot;BigDecimal&quot;</span>, <span class="string">&quot;Timestamp&quot;</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * MyBatisçš„é…ç½®å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> invocation.getTarget();</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–è¡Œæ•°ä¸º 1</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">lines</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// é»˜è®¤çŠ¶æ€ä¸º &quot;å¤±è´¥&quot;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> <span class="string">&quot;failed&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡ŒåŸå§‹æ–¹æ³•ï¼Œå¹¶è·å–è¿”å›ç»“æœ</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line">            <span class="comment">// å¦‚æœè¿”å›ç»“æœä¸ºé›†åˆï¼Œåˆ™ç»Ÿè®¡è¡Œæ•°</span></span><br><span class="line">            <span class="keyword">if</span> (proceed <span class="keyword">instanceof</span> Collection&lt;?&gt;) &#123;</span><br><span class="line">                lines = ((List&lt;?&gt;) proceed).size();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰§è¡ŒæˆåŠŸï¼Œå°†çŠ¶æ€è®¾ç½®ä¸º &quot;æˆåŠŸ&quot;</span></span><br><span class="line">            status = <span class="string">&quot;success&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> proceed;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// è®¡ç®— SQL æ‰§è¡Œè€—æ—¶</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">sqlCost</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">            <span class="comment">// è·å– SQL è¯­å¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="built_in">this</span>.getSql(target);</span><br><span class="line">            <span class="comment">// æ‰“å°æ—¥å¿—</span></span><br><span class="line">            log.info(<span class="string">&quot;\u001B[38;5;220mSQL æ‰§è¡Œç»“æœï¼š&#123;&#125;. SQL ä¿¡æ¯ï¼š&#123;&#125;\u001B[0m&quot;</span>, status, sql);</span><br><span class="line">            log.info(<span class="string">&quot;\u001B[38;5;220mè€—æ—¶ï¼š&#123;&#125; mm. Totalï¼š&#123;&#125;\u001B[0m&quot;</span>, sqlCost, lines);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> è·å–å³å°†ä¼šæ‰§è¡Œçš„SQLè¯­å¥ å¹¶æŠŠå‚æ•°æ’å…¥åˆ°SQLè¯­å¥ä¸­</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> target</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> String &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Author</span> yaoHui</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Date</span> 2024/7/24</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getSql</span><span class="params">(Object target)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// è·å– StatementHandler å¯¹è±¡</span></span><br><span class="line">            <span class="type">StatementHandler</span> <span class="variable">statementHandler</span> <span class="operator">=</span> (StatementHandler) target;</span><br><span class="line">            <span class="comment">// è·å– BoundSql å¯¹è±¡</span></span><br><span class="line">            <span class="comment">// BoundSqlå¯¹è±¡ä¸­å¸¦æœ‰å³å°†æ‰§è¡Œçš„SQLè¯­å¥å’ŒSQLå‚æ•°</span></span><br><span class="line">            <span class="type">BoundSql</span> <span class="variable">boundSql</span> <span class="operator">=</span> statementHandler.getBoundSql();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(ObjectUtils.isNull(configuration))&#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">ParameterHandler</span> <span class="variable">parameterHandler</span> <span class="operator">=</span> statementHandler.getParameterHandler();</span><br><span class="line">                <span class="built_in">this</span>.configuration = (Configuration) FieldUtils.readField(parameterHandler, <span class="string">&quot;configuration&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> formatSql(boundSql,configuration);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            log.warn(<span class="string">&quot;è·å– SQL è¯­å¥å¤±è´¥ï¼š&#123;&#125;&quot;</span>, target, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;æ— æ³•è§£æçš„ SQL è¯­å¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">formatSql</span><span class="params">(BoundSql boundSql,Configuration configuration)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> boundSql.getSql();</span><br><span class="line">        <span class="comment">// è·å–å‚æ•°æ˜ å°„åˆ—è¡¨</span></span><br><span class="line">        List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</span><br><span class="line">        <span class="comment">// è·å–å‚æ•°å¯¹è±¡</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">parameterObject</span> <span class="operator">=</span> boundSql.getParameterObject();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(sql) || Objects.isNull(configuration)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å– TypeHandlerRegistry å¯¹è±¡</span></span><br><span class="line">        <span class="type">TypeHandlerRegistry</span> <span class="variable">typeHandlerRegistry</span> <span class="operator">=</span> configuration.getTypeHandlerRegistry();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»é™¤ SQL å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰</span></span><br><span class="line">        sql = sql.replaceAll(<span class="string">&quot;[\n\r ]+&quot;</span>, <span class="string">&quot; &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿‡æ»¤æ‰è¾“å‡ºå‚æ•°çš„å‚æ•°æ˜ å°„</span></span><br><span class="line">        <span class="keyword">if</span> (parameterMappings == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> sql;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        parameterMappings = parameterMappings.stream()</span><br><span class="line">                .filter(it -&gt; it.getMode() != ParameterMode.OUT)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ StringBuilder ä¿å­˜æ ¼å¼åŒ–åçš„ SQL</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(sql);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£æé—®å·å¹¶æ›¿æ¢å‚æ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> result.length(); i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.charAt(i - <span class="number">1</span>) != <span class="string">&#x27;?&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ParameterMapping</span> <span class="variable">parameterMapping</span> <span class="operator">=</span> parameterMappings.get(parameterMappings.size() - <span class="number">1</span>);</span><br><span class="line">            Object value;</span><br><span class="line">            <span class="type">String</span> <span class="variable">propertyName</span> <span class="operator">=</span> parameterMapping.getProperty();</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ç»‘å®šçš„é™„åŠ å‚æ•°ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å±æ€§å</span></span><br><span class="line">            <span class="keyword">if</span> (boundSql.hasAdditionalParameter(propertyName)) &#123;</span><br><span class="line">                value = boundSql.getAdditionalParameter(propertyName);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parameterObject == <span class="literal">null</span>) &#123;</span><br><span class="line">                value = <span class="literal">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123;</span><br><span class="line">                value = parameterObject;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨ MetaObject è·å–å±æ€§å€¼</span></span><br><span class="line">                <span class="type">MetaObject</span> <span class="variable">metaObject</span> <span class="operator">=</span> configuration.newMetaObject(parameterObject);</span><br><span class="line">                value = metaObject.getValue(propertyName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// åˆ¤æ–­å‚æ•°ç±»å‹ï¼Œå¦‚æœæ˜¯éœ€è¦æ·»åŠ æ‹¬å·çš„ç±»å‹ï¼Œåˆ™æ·»åŠ å•å¼•å·</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> value.getClass().getSimpleName();</span><br><span class="line">                <span class="keyword">if</span> (NEED_BRACKETS.contains(type)) &#123;</span><br><span class="line">                    result.replace(i - <span class="number">1</span>, i, <span class="string">&quot;&#x27;&quot;</span> + value + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    result.replace(i - <span class="number">1</span>, i, value.toString());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å‚æ•°å€¼ä¸ºç©ºæ—¶ï¼Œæ›¿æ¢ä¸º &quot;null&quot;</span></span><br><span class="line">                result.replace(i - <span class="number">1</span>, i, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ç§»é™¤å·²å¤„ç†çš„å‚æ•°æ˜ å°„</span></span><br><span class="line">            parameterMappings.remove(parameterMappings.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@Intercepts</code> å’Œ <code>@Signature</code> æ˜¯ MyBatis çš„æ³¨è§£ï¼Œç”¨äºå®šä¹‰æ‹¦æˆªå™¨çš„å…ƒä¿¡æ¯ï¼ŒæŒ‡å®šæ‹¦æˆªçš„ç›®æ ‡ç±»å‹ã€æ–¹æ³•å’Œå‚æ•°åˆ—è¡¨ã€‚è¿™å››ä¸ªæ³¨è§£åˆ†åˆ«æ‹¦æˆª MyBatis æ‰§è¡Œçš„å››ç§æ ¸å¿ƒç»„ä»¶ï¼ˆ<code>Executor</code>ã€<code>StatementHandler</code>ã€<code>ParameterHandler</code> å’Œ <code>ResultSetHandler</code>ï¼‰ï¼Œé€šè¿‡å®ƒä»¬å¯ä»¥åœ¨ä¸åŒé˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚</p><hr><h3 id="1-Intercepts"><a href="#1-Intercepts" class="headerlink" title="1. @Intercepts"></a><strong>1. @Intercepts</strong></h3><p><code>@Intercepts</code> æ˜¯ä¸€ä¸ªå®¹å™¨æ³¨è§£ï¼Œè¡¨ç¤ºä¸€ä¸ªæ‹¦æˆªå™¨å¯ä»¥æ‹¦æˆªå¤šä¸ªæ–¹æ³•ã€‚å®ƒåŒ…å«ä¸€ä¸ª <code>@Signature</code> æ•°ç»„ï¼Œæ¯ä¸ª <code>@Signature</code> æ³¨è§£å®šä¹‰äº†ä¸€ä¸ªæ‹¦æˆªç›®æ ‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(...)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure><h4 id="å…³é”®ç‚¹ï¼š"><a href="#å…³é”®ç‚¹ï¼š" class="headerlink" title="å…³é”®ç‚¹ï¼š"></a>å…³é”®ç‚¹ï¼š</h4><ul><li><strong>ä½œç”¨</strong>ï¼šæ ‡æ³¨åœ¨æ‹¦æˆªå™¨ç±»ä¸Šï¼Œå£°æ˜è¿™ä¸ªç±»æ˜¯ MyBatis çš„ä¸€ä¸ªæ‹¦æˆªå™¨ã€‚</li><li><strong>å‚æ•°</strong>ï¼šåŒ…å«å¤šä¸ª <code>@Signature</code> æ³¨è§£ï¼Œæ¯ä¸ªæ³¨è§£å®šä¹‰äº†ä¸€ä¸ªå…·ä½“çš„æ‹¦æˆªç‚¹ã€‚</li></ul><hr><h3 id="2-Signature"><a href="#2-Signature" class="headerlink" title="2. @Signature"></a><strong>2. @Signature</strong></h3><p><code>@Signature</code> æ˜¯å®šä¹‰æ‹¦æˆªç‚¹çš„æ ¸å¿ƒæ³¨è§£ï¼Œå®ƒæŒ‡å®šäº†ï¼š</p><ol><li><strong>æ‹¦æˆªçš„ç±»å‹ï¼ˆ<code>type</code>ï¼‰</strong><br> æŒ‡å®šè¦æ‹¦æˆªçš„ MyBatis æ ¸å¿ƒç»„ä»¶æ¥å£ï¼Œä¾‹å¦‚ <code>Executor</code>ã€<code>StatementHandler</code> ç­‰ã€‚</li><li><strong>æ‹¦æˆªçš„æ–¹æ³•ï¼ˆ<code>method</code>ï¼‰</strong><br> æŒ‡å®šè¦æ‹¦æˆªçš„æ–¹æ³•åç§°ï¼Œä¾‹å¦‚ <code>query</code>ã€<code>prepare</code> ç­‰ã€‚</li><li><strong>æ‹¦æˆªæ–¹æ³•çš„å‚æ•°ï¼ˆ<code>args</code>ï¼‰</strong><br> æŒ‡å®šæ–¹æ³•å‚æ•°ç±»å‹çš„å®Œæ•´ç­¾åï¼Œç”¨äºç²¾ç¡®å®šä½ç›®æ ‡æ–¹æ³•ã€‚</li></ol><h4 id="è¯­æ³•ç¤ºä¾‹ï¼š"><a href="#è¯­æ³•ç¤ºä¾‹ï¼š" class="headerlink" title="è¯­æ³•ç¤ºä¾‹ï¼š"></a>è¯­æ³•ç¤ºä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Signature(</span></span><br><span class="line"><span class="meta">    type = Executor.class, </span></span><br><span class="line"><span class="meta">    method = &quot;query&quot;, </span></span><br><span class="line"><span class="meta">    args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure><h4 id="è¯¦ç»†è¯´æ˜ï¼š"><a href="#è¯¦ç»†è¯´æ˜ï¼š" class="headerlink" title="è¯¦ç»†è¯´æ˜ï¼š"></a>è¯¦ç»†è¯´æ˜ï¼š</h4><ul><li><code>type</code>ï¼šæŒ‡å®šç›®æ ‡æ¥å£ã€‚</li><li><code>method</code>ï¼šæŒ‡å®šç›®æ ‡æ¥å£çš„æ–¹æ³•åã€‚</li><li><code>args</code>ï¼šæŒ‡å®šæ–¹æ³•çš„å‚æ•°ç±»å‹ï¼ˆæŒ‰é¡ºåºåˆ—å‡ºå®Œæ•´ç±»åï¼‰ã€‚</li></ul><hr><h3 id="å››ä¸ª-Signature-æ³¨è§£çš„è¯¦ç»†ä»‹ç»"><a href="#å››ä¸ª-Signature-æ³¨è§£çš„è¯¦ç»†ä»‹ç»" class="headerlink" title="å››ä¸ª @Signature æ³¨è§£çš„è¯¦ç»†ä»‹ç»"></a><strong>å››ä¸ª @Signature æ³¨è§£çš„è¯¦ç»†ä»‹ç»</strong></h3><h4 id="1-æ‹¦æˆª-Executor-query-æ–¹æ³•"><a href="#1-æ‹¦æˆª-Executor-query-æ–¹æ³•" class="headerlink" title="1. æ‹¦æˆª Executor.query æ–¹æ³•"></a><strong>1. æ‹¦æˆª <code>Executor.query</code> æ–¹æ³•</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Signature(</span></span><br><span class="line"><span class="meta">    type = Executor.class,</span></span><br><span class="line"><span class="meta">    method = &quot;query&quot;,</span></span><br><span class="line"><span class="meta">    args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>ä½œç”¨</strong>ï¼šæ‹¦æˆªæ‰§è¡ŒæŸ¥è¯¢æ“ä½œçš„æ ¸å¿ƒæ–¹æ³•ã€‚</p></li><li><p>ç›®æ ‡æ–¹æ³•</p><p>ï¼š</p><ul><li><code>Executor.query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler)</code></li></ul></li><li><p>å¸¸è§ç”¨é€”</p><p>ï¼š</p><ol><li>ä¿®æ”¹ SQL æŸ¥è¯¢è¯­å¥ã€‚</li><li>æ·»åŠ åŠ¨æ€æŸ¥è¯¢æ¡ä»¶ã€‚</li><li>å®ç°åˆ†é¡µé€»è¾‘ï¼ˆå¦‚è‡ªå®šä¹‰åˆ†é¡µæ’ä»¶ï¼‰ã€‚</li></ol></li></ul><hr><h4 id="2-æ‹¦æˆª-StatementHandler-prepare-æ–¹æ³•"><a href="#2-æ‹¦æˆª-StatementHandler-prepare-æ–¹æ³•" class="headerlink" title="2. æ‹¦æˆª StatementHandler.prepare æ–¹æ³•"></a><strong>2. æ‹¦æˆª <code>StatementHandler.prepare</code> æ–¹æ³•</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Signature(</span></span><br><span class="line"><span class="meta">    type = StatementHandler.class,</span></span><br><span class="line"><span class="meta">    method = &quot;prepare&quot;,</span></span><br><span class="line"><span class="meta">    args = &#123;Connection.class, Integer.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>ä½œç”¨</strong>ï¼šæ‹¦æˆª SQL è¯­å¥çš„é¢„å¤„ç†é˜¶æ®µã€‚</p></li><li><p>ç›®æ ‡æ–¹æ³•</p><p>ï¼š</p><ul><li><code>StatementHandler.prepare(Connection connection, Integer transactionTimeout)</code></li></ul></li><li><p>å¸¸è§ç”¨é€”</p><p>ï¼š</p><ol><li>åŠ¨æ€ä¿®æ”¹ SQLã€‚</li><li>æ‰“å°å®Œæ•´çš„ SQL è¯­å¥ï¼ˆåŒ…æ‹¬å‚æ•°ï¼‰ã€‚</li><li>æ·»åŠ å®¡è®¡æ—¥å¿—è®°å½•ã€‚</li></ol></li></ul><hr><h4 id="3-æ‹¦æˆª-ParameterHandler-setParameters-æ–¹æ³•"><a href="#3-æ‹¦æˆª-ParameterHandler-setParameters-æ–¹æ³•" class="headerlink" title="3. æ‹¦æˆª ParameterHandler.setParameters æ–¹æ³•"></a><strong>3. æ‹¦æˆª <code>ParameterHandler.setParameters</code> æ–¹æ³•</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Signature(</span></span><br><span class="line"><span class="meta">    type = ParameterHandler.class,</span></span><br><span class="line"><span class="meta">    method = &quot;setParameters&quot;,</span></span><br><span class="line"><span class="meta">    args = &#123;PreparedStatement.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>ä½œç”¨</strong>ï¼šæ‹¦æˆªè®¾ç½® SQL å‚æ•°çš„é˜¶æ®µã€‚</p></li><li><p>ç›®æ ‡æ–¹æ³•</p><p>ï¼š</p><ul><li><code>ParameterHandler.setParameters(PreparedStatement ps)</code></li></ul></li><li><p>å¸¸è§ç”¨é€”</p><p>ï¼š</p><ol><li>åŠ¨æ€åŠ å¯†&#x2F;è§£å¯†å­—æ®µå‚æ•°ã€‚</li><li>è‡ªå®šä¹‰å‚æ•°å€¼çš„ç»‘å®šé€»è¾‘ã€‚</li><li>æ£€æŸ¥æˆ–ä¿®æ”¹ç»‘å®šå‚æ•°ã€‚</li></ol></li></ul><hr><h4 id="4-æ‹¦æˆª-ResultSetHandler-handleResultSets-æ–¹æ³•"><a href="#4-æ‹¦æˆª-ResultSetHandler-handleResultSets-æ–¹æ³•" class="headerlink" title="4. æ‹¦æˆª ResultSetHandler.handleResultSets æ–¹æ³•"></a><strong>4. æ‹¦æˆª <code>ResultSetHandler.handleResultSets</code> æ–¹æ³•</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Signature(</span></span><br><span class="line"><span class="meta">    type = ResultSetHandler.class,</span></span><br><span class="line"><span class="meta">    method = &quot;handleResultSets&quot;,</span></span><br><span class="line"><span class="meta">    args = &#123;Statement.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>ä½œç”¨</strong>ï¼šæ‹¦æˆªç»“æœé›†çš„å¤„ç†é˜¶æ®µã€‚</p></li><li><p>ç›®æ ‡æ–¹æ³•</p><p>ï¼š</p><ul><li><code>ResultSetHandler.handleResultSets(Statement stmt)</code></li></ul></li><li><p>å¸¸è§ç”¨é€”</p><p>ï¼š</p><ol><li>å¯¹æŸ¥è¯¢ç»“æœè¿›è¡ŒåŠ å¯†&#x2F;è§£å¯†ã€‚</li><li>è‡ªå®šä¹‰ç»“æœé›†æ˜ å°„é€»è¾‘ã€‚</li><li>è¿‡æ»¤æˆ–è°ƒæ•´æŸ¥è¯¢ç»“æœã€‚</li></ol></li></ul><hr><h3 id="æ‹¦æˆªå™¨çš„å·¥ä½œæœºåˆ¶"><a href="#æ‹¦æˆªå™¨çš„å·¥ä½œæœºåˆ¶" class="headerlink" title="æ‹¦æˆªå™¨çš„å·¥ä½œæœºåˆ¶"></a><strong>æ‹¦æˆªå™¨çš„å·¥ä½œæœºåˆ¶</strong></h3><ol><li><strong>åŠ¨æ€ä»£ç†</strong><br> MyBatis ä½¿ç”¨åŠ¨æ€ä»£ç†æ¨¡å¼ï¼Œå°†æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ <code>Executor</code>ï¼‰åŒ…è£…æˆä»£ç†å¯¹è±¡ã€‚</li><li><strong>æ‰§è¡Œæ‹¦æˆªé€»è¾‘</strong><br> åœ¨æ‹¦æˆªçš„æ–¹æ³•å‰åï¼Œæ‰§è¡Œ <code>Interceptor</code> å®ç°ç±»çš„ <code>intercept</code> æ–¹æ³•ã€‚</li><li><strong>ä¼ é€’è°ƒç”¨é“¾</strong><br> é€šè¿‡ <code>invocation.proceed()</code> è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„åŸå§‹æ–¹æ³•ã€‚</li></ol><hr><h3 id="å®Œæ•´ç¤ºä¾‹"><a href="#å®Œæ•´ç¤ºä¾‹" class="headerlink" title="å®Œæ•´ç¤ºä¾‹"></a><strong>å®Œæ•´ç¤ºä¾‹</strong></h3><h4 id="è‡ªå®šä¹‰æ‹¦æˆªå™¨ç±»ï¼š"><a href="#è‡ªå®šä¹‰æ‹¦æˆªå™¨ç±»ï¼š" class="headerlink" title="è‡ªå®šä¹‰æ‹¦æˆªå™¨ç±»ï¼š"></a>è‡ªå®šä¹‰æ‹¦æˆªå™¨ç±»ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(type = Executor.class, method = &quot;query&quot;, args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;),</span></span><br><span class="line"><span class="meta">    @Signature(type = StatementHandler.class, method = &quot;prepare&quot;, args = &#123;Connection.class, Integer.class&#125;),</span></span><br><span class="line"><span class="meta">    @Signature(type = ParameterHandler.class, method = &quot;setParameters&quot;, args = &#123;PreparedStatement.class&#125;),</span></span><br><span class="line"><span class="meta">    @Signature(type = ResultSetHandler.class, method = &quot;handleResultSets&quot;, args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// åœ¨æ–¹æ³•æ‰§è¡Œå‰åŠ å…¥é€»è¾‘</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Intercepted Method: &quot;</span> + invocation.getMethod().getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨æ–¹æ³•æ‰§è¡ŒååŠ å…¥é€»è¾‘</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Method Execution Completed&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†</span></span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†è‡ªå®šä¹‰é…ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="åº”ç”¨åœºæ™¯æ€»ç»“"><a href="#åº”ç”¨åœºæ™¯æ€»ç»“" class="headerlink" title="åº”ç”¨åœºæ™¯æ€»ç»“"></a><strong>åº”ç”¨åœºæ™¯æ€»ç»“</strong></h3><ul><li><strong><code>Executor.query</code></strong>ï¼šç”¨äºåŠ¨æ€ SQLã€æ—¥å¿—è®°å½•ã€åˆ†é¡µé€»è¾‘å¢å¼ºã€‚</li><li><strong><code>StatementHandler.prepare</code></strong>ï¼šç”¨äºåŠ¨æ€ä¿®æ”¹ SQL è¯­å¥ã€å®¡è®¡ã€‚</li><li><strong><code>ParameterHandler.setParameters</code></strong>ï¼šç”¨äºå‚æ•°åŠ å¯†ã€ç»‘å®šè‡ªå®šä¹‰é€»è¾‘ã€‚</li><li><strong><code>ResultSetHandler.handleResultSets</code></strong>ï¼šç”¨äºç»“æœè§£å¯†ã€æ•°æ®è¿‡æ»¤ã€‚</li></ul><p>é€šè¿‡çµæ´»ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œå¯ä»¥å¯¹ MyBatis çš„è¡Œä¸ºè¿›è¡Œæ·±åº¦å®šåˆ¶ï¼Œä»è€Œå®ç°é«˜çº§åŠŸèƒ½å’Œæ‰©å±•ã€‚</p><hr><h2 id="MyBatis-Plus"><a href="#MyBatis-Plus" class="headerlink" title="MyBatis-Plus"></a>MyBatis-Plus</h2>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>09 Linuxç¯å¢ƒä¸‹æ­å»ºELKï¼ˆElasticsearch+Logstash+Kibanaï¼‰</title>
      <link href="/2025/02/26/75-16%20%E7%A7%8B%E6%8B%9B/"/>
      <url>/2025/02/26/75-16%20%E7%A7%8B%E6%8B%9B/</url>
      
        <content type="html"><![CDATA[<h1 id="75-16-ç§‹æ‹›"><a href="#75-16-ç§‹æ‹›" class="headerlink" title="75-16 ç§‹æ‹›"></a>75-16 ç§‹æ‹›</h1><h2 id="å‰æå‡†å¤‡"><a href="#å‰æå‡†å¤‡" class="headerlink" title="å‰æå‡†å¤‡"></a>å‰æå‡†å¤‡</h2><p>è®¡ç®—æœºåŸºç¡€ï¼ˆ408ï¼‰å¾ˆé‡è¦ï¼Œç”¨å¿ƒå­¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262042593.png" alt="image-20250225123409882"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262042477.png" alt="image-20250225123452426"></p><p>å‡†å¤‡é¢è¯•ä¸­å¯èƒ½æ¶‰åŠåˆ°çš„ä¸ªäººä»‹ç»éƒ¨åˆ†</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262042073.png" alt="image-20250225124158228"></p><h2 id="ç®€å†"><a href="#ç®€å†" class="headerlink" title="ç®€å†"></a>ç®€å†</h2><h3 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h3><h4 id="SIDC"><a href="#SIDC" class="headerlink" title="SIDC"></a>SIDC</h4><h5 id="å³æ—¶é€šè®¯åŠŸèƒ½"><a href="#å³æ—¶é€šè®¯åŠŸèƒ½" class="headerlink" title="å³æ—¶é€šè®¯åŠŸèƒ½"></a>å³æ—¶é€šè®¯åŠŸèƒ½</h5><p>åœ¨SIDCé¡¹ç›®ä¸­æœ‰ä¸€ä¸ªæ¶‰åŠåˆ°å…³äºå³æ—¶é€šä¿¡åŠŸèƒ½çš„æ¨¡å—ï¼Œè¿™éƒ¨åˆ†æ˜¯é€šè¿‡WebSocketæ¥è¿›è¡Œå®ç°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»é—®é¢˜æ¥å¯¹è¿™éƒ¨åˆ†æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹æ¥è¿›è¡Œæ€»ç»“å½’çº³ã€‚</p><blockquote><h3 id="åŸºç¡€é—®é¢˜ï¼ˆç†è§£-WebSocket-åŸºç¡€ï¼‰"><a href="#åŸºç¡€é—®é¢˜ï¼ˆç†è§£-WebSocket-åŸºç¡€ï¼‰" class="headerlink" title="åŸºç¡€é—®é¢˜ï¼ˆç†è§£ WebSocket åŸºç¡€ï¼‰"></a><strong>åŸºç¡€é—®é¢˜ï¼ˆç†è§£ WebSocket åŸºç¡€ï¼‰</strong></h3><ol><li><strong>WebSocket å’Œ HTTP çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨ WebSocket è€Œä¸æ˜¯ HTTPï¼Ÿ</strong></li><li><strong>WebSocket æ˜¯åŸºäº TCP è¿˜æ˜¯ UDP çš„ï¼Ÿå®ƒæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§å’Œå¯é æ€§çš„ï¼Ÿ</strong></li><li><strong>WebSocket çš„æ¡æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿå¦‚ä½•ä» HTTP è¿æ¥å‡çº§åˆ° WebSocket è¿æ¥ï¼Ÿ</strong></li><li><strong>WebSocket è¿æ¥çš„ <code>ping/pong</code> æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong></li></ol><hr><h3 id="ä¸­çº§é—®é¢˜ï¼ˆSpring-WebSocket-åŠå®è·µï¼‰"><a href="#ä¸­çº§é—®é¢˜ï¼ˆSpring-WebSocket-åŠå®è·µï¼‰" class="headerlink" title="ä¸­çº§é—®é¢˜ï¼ˆSpring WebSocket åŠå®è·µï¼‰"></a><strong>ä¸­çº§é—®é¢˜ï¼ˆSpring WebSocket åŠå®è·µï¼‰</strong></h3><ol><li><strong>åœ¨ Spring Boot ä¸­å¦‚ä½•ä½¿ç”¨ <code>@ServerEndpoint</code> å®ç°ä¸€ä¸ªç®€å•çš„ WebSocket æœåŠ¡å™¨ï¼Ÿå¦‚æœè¦ç»™æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Œè¯¥å¦‚ä½•åšï¼Ÿ</strong></li><li><strong>Spring WebSocket å’Œ STOMP åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆå¾ˆå¤šæ—¶å€™ STOMP é€‚ç”¨äº WebSocket ï¼Ÿ</strong></li><li><strong>åœ¨ WebSocket è¿æ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†èº«ä»½è®¤è¯ï¼Ÿå¦‚ä½•ç¡®ä¿åªæœ‰åˆæ³•ç”¨æˆ·å¯ä»¥å»ºç«‹ WebSocket è¿æ¥ï¼Ÿ</strong></li><li><strong>å¦‚æœ WebSocket è¿æ¥æ–­å¼€ï¼Œå¦‚ä½•å®ç°è‡ªåŠ¨é‡è¿ï¼Ÿå‰ç«¯å’Œåç«¯å„è‡ªåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</strong></li></ol><hr><h3 id="é«˜çº§é—®é¢˜ï¼ˆæ¶æ„ã€æ€§èƒ½ä¼˜åŒ–ã€æ‰©å±•æ€§ï¼‰"><a href="#é«˜çº§é—®é¢˜ï¼ˆæ¶æ„ã€æ€§èƒ½ä¼˜åŒ–ã€æ‰©å±•æ€§ï¼‰" class="headerlink" title="é«˜çº§é—®é¢˜ï¼ˆæ¶æ„ã€æ€§èƒ½ä¼˜åŒ–ã€æ‰©å±•æ€§ï¼‰"></a><strong>é«˜çº§é—®é¢˜ï¼ˆæ¶æ„ã€æ€§èƒ½ä¼˜åŒ–ã€æ‰©å±•æ€§ï¼‰</strong></h3><ol><li><strong>åœ¨ WebSocket è¿æ¥è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼ˆå¦‚ 10w ä»¥ä¸Šï¼‰ï¼Œå¦‚ä½•ä¼˜åŒ– WebSocket æœåŠ¡å™¨çš„æ€§èƒ½ï¼Ÿ</strong></li><li><strong>WebSocket é€‚åˆç”¨æ¥åšæ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨å—ï¼Ÿå¦‚æœéœ€è¦å®ç°èŠå¤©è®°å½•æŒä¹…åŒ–ï¼Œè¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ</strong></li><li><strong>åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ç¡®ä¿å¤šä¸ª WebSocket æœåŠ¡å™¨ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ï¼Ÿï¼ˆå¦‚ä½•åœ¨å¤šå®ä¾‹ç¯å¢ƒä¸‹å®ç°å¹¿æ’­å’Œç‚¹å¯¹ç‚¹æ¶ˆæ¯ï¼‰</strong></li><li><strong>å¦‚ä½•å¤„ç† WebSocket æœåŠ¡å™¨çš„é«˜å¯ç”¨é—®é¢˜ï¼Ÿå¦‚æœæŸä¸ªèŠ‚ç‚¹å®•æœºï¼Œå¦‚ä½•è®©ç”¨æˆ·æ— æ„ŸçŸ¥åœ°é‡è¿åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Ÿ</strong></li><li><strong>åœ¨ WebSocket æœåŠ¡å™¨ä¸­ï¼Œå¦‚ä½•é˜²æ­¢ DDoS æ”»å‡»ï¼Ÿæœ‰å“ªäº›å¸¸è§çš„å®‰å…¨é˜²æŠ¤æ‰‹æ®µï¼Ÿ</strong></li></ol><hr><h3 id="åŠ åˆ†é—®é¢˜ï¼ˆå¼€æºå®è·µã€å¤æ‚åœºæ™¯ï¼‰"><a href="#åŠ åˆ†é—®é¢˜ï¼ˆå¼€æºå®è·µã€å¤æ‚åœºæ™¯ï¼‰" class="headerlink" title="åŠ åˆ†é—®é¢˜ï¼ˆå¼€æºå®è·µã€å¤æ‚åœºæ™¯ï¼‰"></a><strong>åŠ åˆ†é—®é¢˜ï¼ˆå¼€æºå®è·µã€å¤æ‚åœºæ™¯ï¼‰</strong></h3><ol><li><strong>å¦‚æœéœ€è¦æ”¯æŒ 100w çº§åˆ«çš„åœ¨çº¿ç”¨æˆ· WebSocket è¿æ¥ï¼Œè¯¥å¦‚ä½•è®¾è®¡æ¶æ„ï¼Ÿï¼ˆRedis + Kafka + è´Ÿè½½å‡è¡¡ç­‰ï¼‰</strong></li><li><strong>ä½ äº†è§£å“ªäº›å¼€æºçš„ WebSocket æ¡†æ¶æˆ–è§£å†³æ–¹æ¡ˆï¼Ÿå®ƒä»¬çš„ä¼˜ç¼ºç‚¹åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></li><li><strong>å¦‚ä½•åœ¨ WebSocket ä¸­å®ç°æ¶ˆæ¯çš„æœ‰åºæ€§ä¿è¯ï¼Ÿå¦‚æœæŸä¸ªæ¶ˆæ¯å»¶è¿Ÿäº†ï¼Œå¦‚ä½•ç¡®ä¿å®ƒä»ç„¶æŒ‰ç…§æ­£ç¡®çš„é¡ºåºè¢«å¤„ç†ï¼Ÿ</strong></li><li><strong>å¦‚ä½•åœ¨ WebSocket ä¸­å®ç°æ¶ˆæ¯çš„ QoSï¼ˆæœåŠ¡è´¨é‡ä¿è¯ï¼‰ï¼Œç¡®ä¿æ¶ˆæ¯ä¸€å®šèƒ½å¤Ÿè¢«é€è¾¾ï¼Ÿ</strong></li></ol></blockquote><h5 id="å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½"><a href="#å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½" class="headerlink" title="å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½"></a>å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½</h5><h6 id="1-å›¾ç‰‡ä»å‰ç«¯åˆ°åç«¯çš„ä¼ è¾“æ–¹å¼"><a href="#1-å›¾ç‰‡ä»å‰ç«¯åˆ°åç«¯çš„ä¼ è¾“æ–¹å¼" class="headerlink" title="1. å›¾ç‰‡ä»å‰ç«¯åˆ°åç«¯çš„ä¼ è¾“æ–¹å¼"></a>1. å›¾ç‰‡ä»å‰ç«¯åˆ°åç«¯çš„ä¼ è¾“æ–¹å¼</h6><h6 id="1-1-å›¾ç‰‡çš„ä¼ è¾“æ ¼å¼"><a href="#1-1-å›¾ç‰‡çš„ä¼ è¾“æ ¼å¼" class="headerlink" title="1.1 å›¾ç‰‡çš„ä¼ è¾“æ ¼å¼"></a>1.1 å›¾ç‰‡çš„ä¼ è¾“æ ¼å¼</h6><p>å‰ç«¯é€šå¸¸é€šè¿‡ <strong>HTTP è¯·æ±‚</strong> å°†å›¾ç‰‡æ•°æ®ä¼ è¾“åˆ°åç«¯ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p><strong>è¡¨å•æäº¤ï¼ˆMultipart Form-Dataï¼‰</strong></p><ul><li>é€‚ç”¨äºæ™®é€šå›¾ç‰‡ä¸Šä¼ ï¼Œå‰ç«¯ä½¿ç”¨ <code>form-data</code> æ–¹å¼ä¼ è¾“ï¼š</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>ä¸Šä¼ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>ä¼ è¾“æ–¹å¼ï¼š<ul><li><code>Content-Type: multipart/form-data</code></li><li>HTTP è¯·æ±‚ä½“ä¸­åŒ…å«äºŒè¿›åˆ¶æ–‡ä»¶æ•°æ®</li><li>æœåŠ¡å™¨å¯ä»¥é€šè¿‡ <code>MultipartFile</code> è·å–æ–‡ä»¶</li></ul></li></ul></li><li><p><strong>Base64 ç¼–ç ä¸Šä¼ </strong></p><ul><li>é€‚ç”¨äºå‰ç«¯å°†å›¾ç‰‡è½¬ä¸º Base64 å­—ç¬¦ä¸²åå†ä¸Šä¼ ï¼š</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> file = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;input[type=file]&#x27;</span>).<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">let</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">reader.<span class="property">onloadend</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;/uploadBase64&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;,</span><br><span class="line">        <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">image</span>: reader.<span class="property">result</span> &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">reader.<span class="title function_">readAsDataURL</span>(file);</span><br></pre></td></tr></table></figure><ul><li>ä¼ è¾“æ–¹å¼ï¼š<ul><li><code>Content-Type: application/json</code></li><li>å›¾ç‰‡è½¬æ¢ä¸º Base64 å­—ç¬¦ä¸²ï¼ˆå¢å¤§ 33% ä½“ç§¯ï¼‰</li><li>é€‚ç”¨äºå°å‹å›¾ç‰‡ï¼Œä½†ä¸æ¨èå¤§æ–‡ä»¶</li></ul></li></ul></li></ol><hr><h6 id="2-å›¾ç‰‡åˆ°è¾¾åç«¯æœåŠ¡å™¨çš„å­˜å‚¨æ–¹å¼"><a href="#2-å›¾ç‰‡åˆ°è¾¾åç«¯æœåŠ¡å™¨çš„å­˜å‚¨æ–¹å¼" class="headerlink" title="2. å›¾ç‰‡åˆ°è¾¾åç«¯æœåŠ¡å™¨çš„å­˜å‚¨æ–¹å¼"></a>2. å›¾ç‰‡åˆ°è¾¾åç«¯æœåŠ¡å™¨çš„å­˜å‚¨æ–¹å¼</h6><h6 id="2-1-MultipartFile-å¤„ç†ï¼ˆMultipart-Form-Dataï¼‰"><a href="#2-1-MultipartFile-å¤„ç†ï¼ˆMultipart-Form-Dataï¼‰" class="headerlink" title="2.1 MultipartFile å¤„ç†ï¼ˆMultipart Form-Dataï¼‰"></a>2.1 <code>MultipartFile</code> å¤„ç†ï¼ˆMultipart Form-Dataï¼‰</h6><p>Spring Boot å¤„ç† <code>multipart/form-data</code> æ–¹å¼çš„æ–‡ä»¶ä¸Šä¼ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">uploadFile</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">    <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;uploads/&quot;</span> + filename);</span><br><span class="line">    Files.copy(file.getInputStream(), path, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;File uploaded successfully&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>file.getInputStream()</code>ï¼šè·å– <strong>æ–‡ä»¶è¾“å…¥æµ</strong></li><li><code>Files.copy(...)</code>ï¼šå°†æ–‡ä»¶å­˜å…¥æœåŠ¡å™¨çš„ <code>uploads/</code> ç›®å½•</li></ul><h6 id="2-2-Base64-è§£ç å­˜å‚¨"><a href="#2-2-Base64-è§£ç å­˜å‚¨" class="headerlink" title="2.2 Base64 è§£ç å­˜å‚¨"></a>2.2 Base64 è§£ç å­˜å‚¨</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/uploadBase64&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">uploadBase64</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; payload)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">base64Image</span> <span class="operator">=</span> payload.get(<span class="string">&quot;image&quot;</span>).split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>]; <span class="comment">// å»æ‰data:image/png;base64,</span></span><br><span class="line">    <span class="type">byte</span>[] imageBytes = Base64.getDecoder().decode(base64Image);</span><br><span class="line">    <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;uploads/image.png&quot;</span>);</span><br><span class="line">    Files.write(path, imageBytes);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;File uploaded successfully&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>Base64.getDecoder().decode()</code>ï¼šè§£ç  Base64 æ•°æ®</li><li><code>Files.write()</code>ï¼šå†™å…¥æ–‡ä»¶</li></ul><h6 id="2-3-å­˜å‚¨ä½ç½®"><a href="#2-3-å­˜å‚¨ä½ç½®" class="headerlink" title="2.3 å­˜å‚¨ä½ç½®"></a>2.3 å­˜å‚¨ä½ç½®</h6><ul><li><strong>æœ¬åœ°ç£ç›˜</strong>ï¼ˆå¦‚ <code>uploads/</code> ç›®å½•ï¼‰</li><li><strong>MinIO &#x2F; OSS</strong>ï¼ˆåç»­ä¸Šä¼ åˆ°å­˜å‚¨æœåŠ¡ï¼‰</li><li><strong>æ•°æ®åº“</strong>ï¼ˆé€šå¸¸ä¸æ¨èï¼Œé€‚ç”¨äºå°å›¾ç‰‡ï¼‰</li></ul><hr><h6 id="3-å›¾ç‰‡ä¸Šä¼ åå­˜å‚¨åˆ°-MinIO"><a href="#3-å›¾ç‰‡ä¸Šä¼ åå­˜å‚¨åˆ°-MinIO" class="headerlink" title="3. å›¾ç‰‡ä¸Šä¼ åå­˜å‚¨åˆ° MinIO"></a>3. å›¾ç‰‡ä¸Šä¼ åå­˜å‚¨åˆ° MinIO</h6><h6 id="3-1-MinIO-ä»‹ç»"><a href="#3-1-MinIO-ä»‹ç»" class="headerlink" title="3.1 MinIO ä»‹ç»"></a>3.1 MinIO ä»‹ç»</h6><ul><li>MinIO æ˜¯å…¼å®¹ <strong>Amazon S3 åè®®</strong> çš„å¯¹è±¡å­˜å‚¨ï¼Œé€‚åˆå­˜å‚¨æµ·é‡å›¾ç‰‡ã€‚</li><li>å›¾ç‰‡ä¸Šä¼ åˆ°åç«¯åï¼Œåç«¯å°†å…¶ä¸Šä¼ è‡³ MinIOã€‚</li></ul><h6 id="3-2-Spring-Boot-è¿æ¥-MinIO"><a href="#3-2-Spring-Boot-è¿æ¥-MinIO" class="headerlink" title="3.2 Spring Boot è¿æ¥ MinIO"></a>3.2 Spring Boot è¿æ¥ MinIO</h6><p><strong>å¼•å…¥ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>MinIO é…ç½®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinioConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MinioClient <span class="title function_">minioClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MinioClient.builder()</span><br><span class="line">            .endpoint(<span class="string">&quot;http://localhost:9000&quot;</span>)</span><br><span class="line">            .credentials(<span class="string">&quot;minioadmin&quot;</span>, <span class="string">&quot;minioadmin&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å›¾ç‰‡ä¸Šä¼ åˆ° MinIO</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MinioClient minioClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">uploadFile</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">bucket</span> <span class="operator">=</span> <span class="string">&quot;images&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> UUID.randomUUID() + <span class="string">&quot;-&quot;</span> + file.getOriginalFilename();</span><br><span class="line">        </span><br><span class="line">        minioClient.putObject(</span><br><span class="line">            PutObjectArgs.builder()</span><br><span class="line">                .bucket(bucket)</span><br><span class="line">                .object(filename)</span><br><span class="line">                .stream(file.getInputStream(), file.getSize(), -<span class="number">1</span>)</span><br><span class="line">                .contentType(file.getContentType())</span><br><span class="line">                .build()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;http://localhost:9000/&quot;</span> + bucket + <span class="string">&quot;/&quot;</span> + filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>minioClient.putObject(...)</code>ï¼šå°†æ–‡ä»¶ä¸Šä¼ åˆ° MinIO</li><li><code>UUID.randomUUID()</code>ï¼šé˜²æ­¢æ–‡ä»¶åé‡å¤</li><li>è¿”å›æ–‡ä»¶è®¿é—® URL</li></ul><h6 id="3-3-æ˜¯å¦åˆ é™¤åç«¯ç¼“å­˜çš„æ–‡ä»¶ï¼Ÿ"><a href="#3-3-æ˜¯å¦åˆ é™¤åç«¯ç¼“å­˜çš„æ–‡ä»¶ï¼Ÿ" class="headerlink" title="3.3 æ˜¯å¦åˆ é™¤åç«¯ç¼“å­˜çš„æ–‡ä»¶ï¼Ÿ"></a>3.3 æ˜¯å¦åˆ é™¤åç«¯ç¼“å­˜çš„æ–‡ä»¶ï¼Ÿ</h6><p>ä¸Šä¼ åˆ° MinIO åï¼Œå¯ä»¥åˆ é™¤æœåŠ¡å™¨ä¸´æ—¶å­˜å‚¨çš„æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Files.deleteIfExists(Paths.get(<span class="string">&quot;uploads/&quot;</span> + filename));</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–ç‚¹</strong></p><ul><li><p><strong>ç›´æ¥æµå¼ä¸Šä¼ åˆ° MinIO</strong>ï¼Œé¿å…å­˜å‚¨åˆ°æœ¬åœ°åå†ä¸Šä¼ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">minioClient.putObject(</span><br><span class="line">    PutObjectArgs.builder()</span><br><span class="line">        .bucket(bucket)</span><br><span class="line">        .object(filename)</span><br><span class="line">        .stream(file.getInputStream(), file.getSize(), -<span class="number">1</span>)</span><br><span class="line">        .contentType(file.getContentType())</span><br><span class="line">        .build()</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li><strong>ä¸å ç”¨æœåŠ¡å™¨ç£ç›˜ç©ºé—´</strong></li><li><strong>æ›´é«˜æ•ˆ</strong></li></ul></li></ul><hr><h6 id="4-éœ€è¦æ³¨æ„çš„ä¼˜åŒ–ç‚¹"><a href="#4-éœ€è¦æ³¨æ„çš„ä¼˜åŒ–ç‚¹" class="headerlink" title="4. éœ€è¦æ³¨æ„çš„ä¼˜åŒ–ç‚¹"></a>4. éœ€è¦æ³¨æ„çš„ä¼˜åŒ–ç‚¹</h6><h6 id="4-1-å¤„ç†å¤§æ–‡ä»¶"><a href="#4-1-å¤„ç†å¤§æ–‡ä»¶" class="headerlink" title="4.1 å¤„ç†å¤§æ–‡ä»¶"></a>4.1 å¤„ç†å¤§æ–‡ä»¶</h6><ul><li><p>é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.servlet.multipart.max-file-size</span>=<span class="string">10MB</span></span><br><span class="line"><span class="attr">spring.servlet.multipart.max-request-size</span>=<span class="string">50MB</span></span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ†ç‰‡ä¸Šä¼ </strong></p><ul><li>å‰ç«¯åˆ‡åˆ†æ–‡ä»¶ï¼Œåç«¯åˆå¹¶æ–‡ä»¶</li><li>MinIO &#x2F; S3 ä¹Ÿæ”¯æŒåˆ†ç‰‡ä¸Šä¼ </li></ul></li></ul><h6 id="4-2-å¹¶å‘æ§åˆ¶"><a href="#4-2-å¹¶å‘æ§åˆ¶" class="headerlink" title="4.2 å¹¶å‘æ§åˆ¶"></a>4.2 å¹¶å‘æ§åˆ¶</h6><ul><li><strong>é™æµ</strong>ï¼šé˜²æ­¢å¤§é‡ç”¨æˆ·åŒæ—¶ä¸Šä¼ ï¼ˆGuava RateLimiterï¼‰</li><li><strong>ç¼“å­˜æ§åˆ¶</strong>ï¼šä¸Šä¼ ååˆ é™¤æœåŠ¡å™¨ä¸´æ—¶æ–‡ä»¶</li></ul><hr><h6 id="5-å¸¸è§é¢è¯•é¢˜"><a href="#5-å¸¸è§é¢è¯•é¢˜" class="headerlink" title="5. å¸¸è§é¢è¯•é¢˜"></a>5. å¸¸è§é¢è¯•é¢˜</h6><table><thead><tr><th>é—®é¢˜</th><th>å…³é”®ç‚¹</th></tr></thead><tbody><tr><td>1. è¯´è¯´ Spring Boot å¦‚ä½•å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼Ÿ</td><td><code>MultipartFile</code>ã€<code>multipart/form-data</code></td></tr><tr><td>2. å¦‚ä½•å°†æ–‡ä»¶ä¸Šä¼ åˆ° MinIOï¼Ÿ</td><td><code>MinioClient.putObject()</code></td></tr><tr><td>3. Base64 å’Œ Multipart ä¸Šä¼ çš„åŒºåˆ«ï¼Ÿ</td><td><code>Base64</code> ä½“ç§¯å¤§ 33%ï¼Œä¸æ¨èå¤§å›¾ç‰‡</td></tr><tr><td>4. å¦‚ä½•é˜²æ­¢ä¸Šä¼ å¤§æ–‡ä»¶å æ»¡æœåŠ¡å™¨ï¼Ÿ</td><td><strong>é™æµ + åˆ†ç‰‡ä¸Šä¼ </strong></td></tr><tr><td>5. å¦‚ä½•ç”Ÿæˆæ–‡ä»¶çš„å”¯ä¸€ URLï¼Ÿ</td><td><strong>UUID + MinIO&#x2F;S3 è®¿é—®è·¯å¾„</strong></td></tr><tr><td>6. æ–‡ä»¶å¦‚ä½•ä¿è¯ç§’ä¼ ï¼Ÿ</td><td><strong>æ–‡ä»¶ MD5 æ£€æŸ¥</strong></td></tr></tbody></table><hr><h6 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h6><ol><li>å‰ç«¯ä¸Šä¼ <ul><li><strong>Multipart Form-Data</strong>ï¼ˆæ¨èï¼‰</li><li><strong>Base64 ä¸Šä¼ </strong>ï¼ˆå°å›¾é€‚ç”¨ï¼‰</li></ul></li><li>åç«¯å­˜å‚¨<ul><li><strong>æœ¬åœ°ç£ç›˜</strong>ï¼ˆä¸´æ—¶å­˜å‚¨ï¼‰</li><li><strong>MinIO &#x2F; S3</strong>ï¼ˆæœ€ç»ˆå­˜å‚¨ï¼‰</li></ul></li><li>ä¼˜åŒ–<ul><li><strong>ç›´æ¥æµå¼ä¸Šä¼ </strong></li><li><strong>é™æµ &amp; åˆ†ç‰‡ä¸Šä¼ </strong></li><li><strong>ä¸Šä¼ ååˆ é™¤ä¸´æ—¶æ–‡ä»¶</strong></li></ul></li><li>é¢è¯•å¸¸è§é—®é¢˜<ul><li><strong>Spring Boot å¦‚ä½•å¤„ç†æ–‡ä»¶</strong></li><li><strong>å¦‚ä½•ä¼˜åŒ–å¤§æ–‡ä»¶ä¸Šä¼ </strong></li><li><strong>å¦‚ä½•ä½¿ç”¨ MinIO</strong></li></ul></li></ol><h3 id="1-WebSocket-å’Œ-HTTP-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨-WebSocket-è€Œä¸æ˜¯-HTTPï¼Ÿ"><a href="#1-WebSocket-å’Œ-HTTP-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨-WebSocket-è€Œä¸æ˜¯-HTTPï¼Ÿ" class="headerlink" title="1. WebSocket å’Œ HTTP çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨ WebSocket è€Œä¸æ˜¯ HTTPï¼Ÿ"></a><strong>1. WebSocket å’Œ HTTP çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨ WebSocket è€Œä¸æ˜¯ HTTPï¼Ÿ</strong></h3><h4 id="ï¼ˆ1ï¼‰åŸºç¡€æ¦‚å¿µ"><a href="#ï¼ˆ1ï¼‰åŸºç¡€æ¦‚å¿µ" class="headerlink" title="ï¼ˆ1ï¼‰åŸºç¡€æ¦‚å¿µ"></a><strong>ï¼ˆ1ï¼‰åŸºç¡€æ¦‚å¿µ</strong></h4><ul><li><strong>HTTP</strong> æ˜¯ <strong>çŸ­è¿æ¥</strong>ï¼ˆè¯·æ±‚-å“åº”æ¨¡å‹ï¼‰ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚åè¿”å›æ•°æ®å¹¶å…³é—­è¿æ¥ã€‚</li><li><strong>WebSocket</strong> æ˜¯ <strong>é•¿è¿æ¥</strong>ï¼ˆåŒå‘é€šä¿¡ï¼‰ï¼Œå»ºç«‹è¿æ¥åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥äº’ç›¸ä¸»åŠ¨å‘é€æ¶ˆæ¯ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½é‡æ–°å»ºç«‹è¿æ¥ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰æ ¸å¿ƒåŒºåˆ«"><a href="#ï¼ˆ2ï¼‰æ ¸å¿ƒåŒºåˆ«" class="headerlink" title="ï¼ˆ2ï¼‰æ ¸å¿ƒåŒºåˆ«"></a><strong>ï¼ˆ2ï¼‰æ ¸å¿ƒåŒºåˆ«</strong></h4><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>HTTP</strong></th><th><strong>WebSocket</strong></th></tr></thead><tbody><tr><td><strong>è¿æ¥æ–¹å¼</strong></td><td>çŸ­è¿æ¥ï¼Œæ¯æ¬¡è¯·æ±‚é‡æ–°å»ºç«‹è¿æ¥</td><td>é•¿è¿æ¥ï¼Œå»ºç«‹åä¿æŒè¿æ¥</td></tr><tr><td><strong>é€šä¿¡æ–¹å‘</strong></td><td>å•å‘ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨å“åº”</td><td>åŒå‘ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½å¯ä»¥ä¸»åŠ¨å‘é€æ¶ˆæ¯</td></tr><tr><td><strong>åè®®</strong></td><td>åŸºäº <strong>è¯·æ±‚-å“åº”</strong> æœºåˆ¶</td><td>åŸºäº <strong>åŒå·¥é€šä¿¡</strong> æœºåˆ¶</td></tr><tr><td><strong>æŠ¥æ–‡æ ¼å¼</strong></td><td><strong>HTTP å¤´éƒ¨ + è´Ÿè½½ï¼ˆæ–‡æœ¬&#x2F;JSON&#x2F;äºŒè¿›åˆ¶ï¼‰</strong></td><td><strong>è½»é‡äºŒè¿›åˆ¶å¸§ï¼ˆå¸§æ ¼å¼ä¼˜åŒ–ï¼‰</strong></td></tr><tr><td><strong>æ•ˆç‡</strong></td><td>æ¯æ¬¡è¯·æ±‚éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥ï¼ˆé«˜å¼€é”€ï¼‰</td><td>è¿æ¥å»ºç«‹åå¯å¤šæ¬¡äº¤äº’ï¼ˆä½å¼€é”€ï¼‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æ™®é€šçš„ç½‘é¡µè¯·æ±‚ã€API è°ƒç”¨</td><td>å³æ—¶èŠå¤©ã€æ¸¸æˆã€è‚¡ç¥¨è¡Œæƒ…ã€æ¨é€é€šçŸ¥</td></tr></tbody></table><h4 id="ï¼ˆ3ï¼‰ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-WebSocketï¼Ÿ"><a href="#ï¼ˆ3ï¼‰ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-WebSocketï¼Ÿ" class="headerlink" title="ï¼ˆ3ï¼‰ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ WebSocketï¼Ÿ"></a><strong>ï¼ˆ3ï¼‰ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ WebSocketï¼Ÿ</strong></h4><ul><li>é€‚ç”¨äºé«˜é¢‘ã€ä½å»¶è¿Ÿçš„å®æ—¶åº”ç”¨<ul><li><strong>å³æ—¶é€šè®¯</strong>ï¼ˆå¦‚èŠå¤©è½¯ä»¶ã€å®¢æœç³»ç»Ÿï¼‰</li><li><strong>å¤šäººåœ¨çº¿æ¸¸æˆ</strong>ï¼ˆå¦‚æ£‹ç‰Œã€MMOï¼‰</li><li><strong>å®æ—¶æ¨é€</strong>ï¼ˆå¦‚å¾®åšçƒ­æœã€å¤©æ°”ã€æ–°é—»æ¨é€ï¼‰</li><li><strong>è‚¡ç¥¨äº¤æ˜“</strong>ï¼ˆå¦‚è¡Œæƒ…æ•°æ®æ¨é€ï¼‰</li><li><strong>åä½œåº”ç”¨</strong>ï¼ˆå¦‚ Google Docs å…±äº«æ–‡æ¡£ç¼–è¾‘ï¼‰</li></ul></li></ul><h4 id="ï¼ˆ4ï¼‰ä¸ºä»€ä¹ˆä¸æ€»æ˜¯ç”¨-WebSocketï¼Ÿ"><a href="#ï¼ˆ4ï¼‰ä¸ºä»€ä¹ˆä¸æ€»æ˜¯ç”¨-WebSocketï¼Ÿ" class="headerlink" title="ï¼ˆ4ï¼‰ä¸ºä»€ä¹ˆä¸æ€»æ˜¯ç”¨ WebSocketï¼Ÿ"></a><strong>ï¼ˆ4ï¼‰ä¸ºä»€ä¹ˆä¸æ€»æ˜¯ç”¨ WebSocketï¼Ÿ</strong></h4><ul><li><strong>WebSocket è¿æ¥éœ€è¦ç»´æŠ¤ä¼šè¯ï¼Œå¯èƒ½å ç”¨æ›´å¤šæœåŠ¡å™¨èµ„æº</strong></li><li><strong>å¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦å®æ—¶åŒå‘é€šä¿¡</strong></li><li><strong>æŸäº›æµè§ˆå™¨æˆ–é˜²ç«å¢™å¯èƒ½ä¸æ”¯æŒ WebSocket</strong></li></ul><h3 id="2-WebSocket-æ˜¯åŸºäº-TCP-è¿˜æ˜¯-UDP-çš„ï¼Ÿå®ƒæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§å’Œå¯é æ€§çš„ï¼Ÿ"><a href="#2-WebSocket-æ˜¯åŸºäº-TCP-è¿˜æ˜¯-UDP-çš„ï¼Ÿå®ƒæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§å’Œå¯é æ€§çš„ï¼Ÿ" class="headerlink" title="2. WebSocket æ˜¯åŸºäº TCP è¿˜æ˜¯ UDP çš„ï¼Ÿå®ƒæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§å’Œå¯é æ€§çš„ï¼Ÿ"></a><strong>2. WebSocket æ˜¯åŸºäº TCP è¿˜æ˜¯ UDP çš„ï¼Ÿå®ƒæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§å’Œå¯é æ€§çš„ï¼Ÿ</strong></h3><h4 id="ï¼ˆ1ï¼‰WebSocket-æ˜¯åŸºäº-TCP-çš„"><a href="#ï¼ˆ1ï¼‰WebSocket-æ˜¯åŸºäº-TCP-çš„" class="headerlink" title="ï¼ˆ1ï¼‰WebSocket æ˜¯åŸºäº TCP çš„"></a><strong>ï¼ˆ1ï¼‰WebSocket æ˜¯åŸºäº TCP çš„</strong></h4><ul><li>WebSocket æœ¬è´¨ä¸Šæ˜¯ <strong>åŸºäº TCP</strong> ä¹‹ä¸Šçš„ä¸€ç§ <strong>åŒå‘é€šä¿¡åè®®</strong>ã€‚</li><li><strong>å®ƒä¸æ˜¯ UDP</strong>ï¼Œæ‰€ä»¥ WebSocket <strong>ä¸èƒ½å¤©ç„¶ä¿è¯ä½å»¶è¿Ÿå’Œä¸¢åŒ…å®¹å¿æ€§</strong>ï¼Œä½†å¯ä»¥é€šè¿‡ <strong>ä¼˜åŒ–æ•°æ®å¸§æ ¼å¼</strong> é™ä½ TCP çš„å¼€é”€ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ï¼Ÿ"><a href="#ï¼ˆ2ï¼‰å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ï¼Ÿ" class="headerlink" title="ï¼ˆ2ï¼‰å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ï¼Ÿ"></a><strong>ï¼ˆ2ï¼‰å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ï¼Ÿ</strong></h4><ul><li><strong>TCP æœ¬èº«æ˜¯æœ‰åºçš„</strong>ï¼ˆé€šè¿‡ <strong>åºåˆ—å· + æ»‘åŠ¨çª—å£ + ACK ç¡®è®¤æœºåˆ¶</strong>ï¼‰ã€‚</li><li>WebSocket ç›´æ¥ <strong>ç»§æ‰¿ TCP çš„æœ‰åºæ€§</strong>ï¼Œæ‰€ä»¥ WebSocket <strong>ä¿è¯äº†æ¶ˆæ¯çš„é¡ºåº</strong>ï¼Œä¸ä¼šä¹±åºã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ"><a href="#ï¼ˆ3ï¼‰å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ" class="headerlink" title="ï¼ˆ3ï¼‰å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ"></a><strong>ï¼ˆ3ï¼‰å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ</strong></h4><ul><li><strong>åŸºäº TCP çš„ä¸‰æ¬¡æ¡æ‰‹ã€è¶…æ—¶é‡ä¼ ã€ACK æœºåˆ¶</strong> ä¿è¯äº†æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</li><li><strong>WebSocket å±‚é¢</strong> è¿˜å¯ä»¥å¢åŠ åº”ç”¨çº§åˆ«çš„ <strong>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆACK ç¡®è®¤ï¼‰</strong>ï¼Œå¦‚æœå®¢æˆ·ç«¯æœªæ”¶åˆ°æ¶ˆæ¯ï¼Œå¯ä»¥è¯·æ±‚æœåŠ¡å™¨é‡æ–°å‘é€ã€‚</li></ul><h3 id="3-WebSocket-çš„æ¡æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿå¦‚ä½•ä»-HTTP-è¿æ¥å‡çº§åˆ°-WebSocket-è¿æ¥ï¼Ÿ"><a href="#3-WebSocket-çš„æ¡æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿå¦‚ä½•ä»-HTTP-è¿æ¥å‡çº§åˆ°-WebSocket-è¿æ¥ï¼Ÿ" class="headerlink" title="3. WebSocket çš„æ¡æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿå¦‚ä½•ä» HTTP è¿æ¥å‡çº§åˆ° WebSocket è¿æ¥ï¼Ÿ"></a><strong>3. WebSocket çš„æ¡æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿå¦‚ä½•ä» HTTP è¿æ¥å‡çº§åˆ° WebSocket è¿æ¥ï¼Ÿ</strong></h3><h4 id="ï¼ˆ1ï¼‰WebSocket-è¿æ¥æ˜¯å¦‚ä½•å»ºç«‹çš„ï¼Ÿ"><a href="#ï¼ˆ1ï¼‰WebSocket-è¿æ¥æ˜¯å¦‚ä½•å»ºç«‹çš„ï¼Ÿ" class="headerlink" title="ï¼ˆ1ï¼‰WebSocket è¿æ¥æ˜¯å¦‚ä½•å»ºç«‹çš„ï¼Ÿ"></a><strong>ï¼ˆ1ï¼‰WebSocket è¿æ¥æ˜¯å¦‚ä½•å»ºç«‹çš„ï¼Ÿ</strong></h4><p>WebSocket <strong>éœ€è¦å…ˆé€šè¿‡ HTTP è¯·æ±‚</strong> è¿›è¡Œ <strong>åè®®å‡çº§</strong>ï¼Œç„¶åå˜æˆ WebSocket è¿æ¥ï¼š</p><ol><li><p><strong>å®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚ï¼ˆå¸¦ Upgrade å¤´éƒ¨ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /chat HTTP/1.1</span><br><span class="line">Host: example.com</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==</span><br><span class="line">Sec-WebSocket-Version: 13</span><br></pre></td></tr></table></figure><ul><li><code>Upgrade: websocket</code> â†’ å‘Šè¯‰æœåŠ¡å™¨è¦å‡çº§ WebSocket è¿æ¥ã€‚</li><li><code>Connection: Upgrade</code> â†’ è®© HTTP è¿æ¥å˜æˆ WebSocketã€‚</li><li><code>Sec-WebSocket-Key</code> â†’ ç”¨äºæ ¡éªŒï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</li></ul></li><li><p><strong>æœåŠ¡å™¨è¿”å› WebSocket æ¡æ‰‹å“åº”</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 101 Switching Protocols</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=</span><br></pre></td></tr></table></figure><ul><li><code>101 Switching Protocols</code> â†’ è¡¨ç¤ºåè®®å‡çº§æˆåŠŸã€‚</li><li><code>Sec-WebSocket-Accept</code> â†’ æœåŠ¡å™¨è®¡ç®— <code>Sec-WebSocket-Key</code> å¹¶è¿”å›ï¼Œä¿è¯å®‰å…¨æ€§ã€‚</li></ul></li><li><p><strong>æ¡æ‰‹å®Œæˆåï¼ŒHTTP è¿æ¥å‡çº§ä¸º WebSocket è¿æ¥</strong></p><ul><li>ä¹‹å <strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥è‡ªç”±å‘é€ WebSocket å¸§</strong>ï¼Œä¸éœ€è¦ HTTP å¤´éƒ¨ã€‚</li></ul></li></ol><h4 id="ï¼ˆ2ï¼‰WebSocket-åè®®ä¸ºä»€ä¹ˆè¦å…ˆç»è¿‡-HTTP-è¿›è¡Œæ¡æ‰‹ï¼Ÿ"><a href="#ï¼ˆ2ï¼‰WebSocket-åè®®ä¸ºä»€ä¹ˆè¦å…ˆç»è¿‡-HTTP-è¿›è¡Œæ¡æ‰‹ï¼Ÿ" class="headerlink" title="ï¼ˆ2ï¼‰WebSocket åè®®ä¸ºä»€ä¹ˆè¦å…ˆç»è¿‡ HTTP è¿›è¡Œæ¡æ‰‹ï¼Ÿ"></a><strong>ï¼ˆ2ï¼‰WebSocket åè®®ä¸ºä»€ä¹ˆè¦å…ˆç»è¿‡ HTTP è¿›è¡Œæ¡æ‰‹ï¼Ÿ</strong></h4><ul><li><strong>å…¼å®¹æ€§</strong>ï¼šåœ¨ WebSocket è¯ç”Ÿå‰ï¼Œæµè§ˆå™¨ä¸»è¦æ”¯æŒ HTTPï¼ŒHTTP æ¡æ‰‹å¯ä»¥å…¼å®¹ <strong>ç°æœ‰çš„ä»£ç†å’ŒæœåŠ¡å™¨</strong>ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šSec-WebSocket-Key é˜²æ­¢ <strong>ä¸­é—´äººæ”»å‡»</strong>ï¼Œç¡®ä¿è¿æ¥æ˜¯åˆæ³•çš„ WebSocket è¿æ¥ã€‚</li><li><strong>æ–¹ä¾¿è´Ÿè½½å‡è¡¡</strong>ï¼šå¾ˆå¤š Web æœåŠ¡å™¨ï¼ˆå¦‚ Nginxï¼‰å¯ä»¥é€šè¿‡ HTTP ä»£ç† WebSocketã€‚</li></ul><h3 id="4-WebSocket-è¿æ¥çš„-ping-pong-æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ"><a href="#4-WebSocket-è¿æ¥çš„-ping-pong-æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ" class="headerlink" title="4. WebSocket è¿æ¥çš„ ping/pong æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ"></a><strong>4. WebSocket è¿æ¥çš„ <code>ping/pong</code> æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong></h3><h4 id="ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯-ping-pong-æœºåˆ¶ï¼Ÿ"><a href="#ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯-ping-pong-æœºåˆ¶ï¼Ÿ" class="headerlink" title="ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯ ping/pong æœºåˆ¶ï¼Ÿ"></a><strong>ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯ <code>ping/pong</code> æœºåˆ¶ï¼Ÿ</strong></h4><p>WebSocket å®šä¹‰äº†ä¸€ä¸ª <strong>å¿ƒè·³æœºåˆ¶</strong>ï¼ˆ<code>ping</code> &#x2F; <code>pong</code>ï¼‰ï¼Œç”¨äº <strong>æ£€æµ‹ WebSocket è¿æ¥æ˜¯å¦å­˜æ´»</strong>ã€‚</p><ul><li><strong>æœåŠ¡å™¨å¯ä»¥å‘é€ <code>ping</code></strong>ï¼Œå®¢æˆ·ç«¯å¿…é¡»åœ¨ <strong>è§„å®šæ—¶é—´å†…å›å¤ <code>pong</code></strong>ã€‚</li><li><strong>å¦‚æœå®¢æˆ·ç«¯ä¸å›å¤ <code>pong</code>ï¼ŒæœåŠ¡å™¨å°±ä¼šå…³é—­è¿æ¥</strong>ï¼Œé˜²æ­¢æ­»è¿æ¥å ç”¨èµ„æºã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆéœ€è¦-ping-pongï¼Ÿ"><a href="#ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆéœ€è¦-ping-pongï¼Ÿ" class="headerlink" title="ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ ping/pongï¼Ÿ"></a><strong>ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ <code>ping/pong</code>ï¼Ÿ</strong></h4><ol><li><strong>æ£€æµ‹ WebSocket è¿æ¥æ˜¯å¦ä»ç„¶å­˜æ´»</strong><ul><li>WebSocket æ˜¯ <strong>é•¿è¿æ¥</strong>ï¼Œå¦‚æœå®¢æˆ·ç«¯æ„å¤–æ–­çº¿ï¼ˆå¦‚ç½‘ç»œä¸­æ–­ã€æµè§ˆå™¨å´©æºƒï¼‰ï¼ŒæœåŠ¡å™¨ <strong>æ— æ³•ä¸»åŠ¨æ„ŸçŸ¥</strong>ï¼Œéœ€è¦ <code>ping/pong</code> ç¡®è®¤è¿æ¥çŠ¶æ€ã€‚</li></ul></li><li><strong>é˜²æ­¢ TCP è¿æ¥è¢«ä¸­é—´è®¾å¤‡ï¼ˆé˜²ç«å¢™ã€NATï¼‰å…³é—­</strong><ul><li>å¦‚æœ <strong>WebSocket é•¿æ—¶é—´æ²¡æœ‰æ•°æ®ä¼ è¾“</strong>ï¼Œé˜²ç«å¢™å¯èƒ½ä¼š <strong>è‡ªåŠ¨æ–­å¼€ TCP è¿æ¥</strong>ï¼Œ<code>ping/pong</code> æœºåˆ¶å¯ä»¥ <strong>ä¿æŒè¿æ¥å­˜æ´»</strong>ã€‚</li></ul></li><li><strong>å‡å°‘æ— æ•ˆçš„ WebSocket è¿æ¥</strong><ul><li>æœåŠ¡å™¨å¯ä»¥å®šæœŸ <code>ping</code>ï¼Œå¦‚æœå‘ç°å®¢æˆ·ç«¯æ²¡æœ‰å“åº” <code>pong</code>ï¼Œå°±ä¸»åŠ¨å…³é—­ WebSocketï¼Œå‡å°‘æœåŠ¡å™¨èµ„æºå ç”¨ã€‚</li></ul></li></ol><h4 id="ï¼ˆ3ï¼‰ç¤ºä¾‹"><a href="#ï¼ˆ3ï¼‰ç¤ºä¾‹" class="headerlink" title="ï¼ˆ3ï¼‰ç¤ºä¾‹"></a><strong>ï¼ˆ3ï¼‰ç¤ºä¾‹</strong></h4><p>å‡è®¾ <strong>æœåŠ¡å™¨æ¯ 30 ç§’å‘é€ä¸€æ¬¡ <code>ping</code></strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;type&quot;: &quot;ping&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <strong>å®¢æˆ·ç«¯æ­£å¸¸</strong>ï¼Œå°±å›å¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;type&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœåŠ¡å™¨ <strong>3 æ¬¡æ²¡æœ‰æ”¶åˆ° <code>pong</code></strong>ï¼Œåˆ™å…³é—­è¿æ¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;type&quot;: &quot;close&quot;,</span><br><span class="line">    &quot;reason&quot;: &quot;timeout&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-åœ¨-Spring-Boot-ä¸­å¦‚ä½•ä½¿ç”¨-ServerEndpoint-å®ç°ä¸€ä¸ªç®€å•çš„-WebSocket-æœåŠ¡å™¨ï¼Ÿå¦‚æœè¦ç»™æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Œè¯¥å¦‚ä½•åšï¼Ÿ"><a href="#1-åœ¨-Spring-Boot-ä¸­å¦‚ä½•ä½¿ç”¨-ServerEndpoint-å®ç°ä¸€ä¸ªç®€å•çš„-WebSocket-æœåŠ¡å™¨ï¼Ÿå¦‚æœè¦ç»™æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Œè¯¥å¦‚ä½•åšï¼Ÿ" class="headerlink" title="1. åœ¨ Spring Boot ä¸­å¦‚ä½•ä½¿ç”¨ @ServerEndpoint å®ç°ä¸€ä¸ªç®€å•çš„ WebSocket æœåŠ¡å™¨ï¼Ÿå¦‚æœè¦ç»™æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Œè¯¥å¦‚ä½•åšï¼Ÿ"></a><strong>1. åœ¨ Spring Boot ä¸­å¦‚ä½•ä½¿ç”¨ <code>@ServerEndpoint</code> å®ç°ä¸€ä¸ªç®€å•çš„ WebSocket æœåŠ¡å™¨ï¼Ÿå¦‚æœè¦ç»™æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Œè¯¥å¦‚ä½•åšï¼Ÿ</strong></h3><h4 id="ï¼ˆ1ï¼‰ä½¿ç”¨-ServerEndpoint-åˆ›å»º-WebSocket-æœåŠ¡å™¨"><a href="#ï¼ˆ1ï¼‰ä½¿ç”¨-ServerEndpoint-åˆ›å»º-WebSocket-æœåŠ¡å™¨" class="headerlink" title="ï¼ˆ1ï¼‰ä½¿ç”¨ @ServerEndpoint åˆ›å»º WebSocket æœåŠ¡å™¨"></a><strong>ï¼ˆ1ï¼‰ä½¿ç”¨ <code>@ServerEndpoint</code> åˆ›å»º WebSocket æœåŠ¡å™¨</strong></h4><p>åœ¨ Spring Boot ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>javax.websocket</code> æä¾›çš„ <code>@ServerEndpoint</code> æ³¨è§£æ¥åˆ›å»º WebSocket æœåŠ¡å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.PathParam;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/chat/&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatServer</span> &#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨æ‰€æœ‰è¿æ¥çš„ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Session&gt; clients = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;userId&quot;)</span> String userId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">        clients.put(userId, session);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ· &quot;</span> + userId + <span class="string">&quot; è¿æ¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message, Session session)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°ç”¨æˆ· &quot;</span> + userId + <span class="string">&quot; æ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(Session session)</span> &#123;</span><br><span class="line">        clients.remove(userId);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ· &quot;</span> + userId + <span class="string">&quot; æ–­å¼€è¿æ¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Session session, Throwable error)</span> &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;ç”¨æˆ· &quot;</span> + userId + <span class="string">&quot; å‘ç”Ÿé”™è¯¯ï¼š&quot;</span> + error.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String userId, String message)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> clients.get(userId);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="literal">null</span> &amp;&amp; session.isOpen()) &#123;</span><br><span class="line">            session.getBasicRemote().sendText(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰å¦‚ä½•ç»™æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Ÿ"><a href="#ï¼ˆ2ï¼‰å¦‚ä½•ç»™æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Ÿ" class="headerlink" title="ï¼ˆ2ï¼‰å¦‚ä½•ç»™æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Ÿ"></a><strong>ï¼ˆ2ï¼‰å¦‚ä½•ç»™æŒ‡å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Ÿ</strong></h4><p>ä¸Šé¢çš„ <code>sendMessage(String userId, String message)</code> æ–¹æ³•å¯ä»¥ <strong>ä¸»åŠ¨å‘æŸä¸ªç”¨æˆ·æ¨é€æ¶ˆæ¯</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ChatServer.sendMessage(<span class="string">&quot;1001&quot;</span>, <span class="string">&quot;ä½ å¥½ï¼Œç”¨æˆ·1001ï¼&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ3ï¼‰å¦‚ä½•æ³¨å†Œ-WebSocket-æœåŠ¡å™¨ï¼Ÿ"><a href="#ï¼ˆ3ï¼‰å¦‚ä½•æ³¨å†Œ-WebSocket-æœåŠ¡å™¨ï¼Ÿ" class="headerlink" title="ï¼ˆ3ï¼‰å¦‚ä½•æ³¨å†Œ WebSocket æœåŠ¡å™¨ï¼Ÿ"></a><strong>ï¼ˆ3ï¼‰å¦‚ä½•æ³¨å†Œ WebSocket æœåŠ¡å™¨ï¼Ÿ</strong></h4><p>åœ¨ Spring Boot ä¸­ï¼Œéœ€è¦ä½¿ç”¨ <strong><code>@Bean</code></strong> å°† WebSocket æœåŠ¡å™¨æ³¨å†Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpointConfig;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerContainer;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.DeploymentException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> DeploymentException &#123;</span><br><span class="line">        <span class="type">ServerContainer</span> <span class="variable">serverContainer</span> <span class="operator">=</span> (ServerContainer) ServletContext.class</span><br><span class="line">                .getMethod(<span class="string">&quot;getAttribute&quot;</span>, String.class)</span><br><span class="line">                .invoke(<span class="literal">null</span>, <span class="string">&quot;javax.websocket.server.ServerContainer&quot;</span>);</span><br><span class="line">        serverContainer.addEndpoint(ServerEndpointConfig.Builder</span><br><span class="line">                .create(ChatServer.class, <span class="string">&quot;/chat/&#123;userId&#125;&quot;</span>)</span><br><span class="line">                .build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-Spring-WebSocket-å’Œ-STOMP-åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆå¾ˆå¤šæ—¶å€™-STOMP-é€‚ç”¨äº-WebSocketï¼Ÿ"><a href="#2-Spring-WebSocket-å’Œ-STOMP-åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆå¾ˆå¤šæ—¶å€™-STOMP-é€‚ç”¨äº-WebSocketï¼Ÿ" class="headerlink" title="2. Spring WebSocket å’Œ STOMP åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆå¾ˆå¤šæ—¶å€™ STOMP é€‚ç”¨äº WebSocketï¼Ÿ"></a><strong>2. Spring WebSocket å’Œ STOMP åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆå¾ˆå¤šæ—¶å€™ STOMP é€‚ç”¨äº WebSocketï¼Ÿ</strong></h3><h4 id="ï¼ˆ1ï¼‰WebSocket-vs-STOMP"><a href="#ï¼ˆ1ï¼‰WebSocket-vs-STOMP" class="headerlink" title="ï¼ˆ1ï¼‰WebSocket vs STOMP"></a><strong>ï¼ˆ1ï¼‰WebSocket vs STOMP</strong></h4><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>WebSocket</strong></th><th><strong>STOMP (Simple Text Oriented Messaging Protocol)</strong></th></tr></thead><tbody><tr><td><strong>æ•°æ®æ ¼å¼</strong></td><td>åªèƒ½å‘é€æ–‡æœ¬&#x2F;äºŒè¿›åˆ¶æ•°æ®</td><td>åŸºäº <strong>æ¶ˆæ¯å¸§</strong>ï¼ˆæœ‰ <strong>å‘½ä»¤</strong> å’Œ <strong>å¤´éƒ¨</strong>ï¼‰</td></tr><tr><td><strong>è®¢é˜…æ¨¡å‹</strong></td><td>æ²¡æœ‰å†…ç½®è®¢é˜…æœºåˆ¶</td><td>å†…ç½® <strong>è®¢é˜…&#x2F;å¹¿æ’­</strong> æœºåˆ¶ï¼ˆç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—ï¼‰</td></tr><tr><td><strong>è®¤è¯æ–¹å¼</strong></td><td>éœ€è¦è‡ªå·±å®ç°</td><td>STOMP æä¾› <strong>èº«ä»½è®¤è¯æœºåˆ¶</strong></td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ç‚¹å¯¹ç‚¹èŠå¤©</td><td><strong>ç¾¤èŠã€æ¨é€é€šçŸ¥ã€å®æ—¶åä½œ</strong></td></tr></tbody></table><h4 id="ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆ-STOMP-é€‚ç”¨äº-WebSocketï¼Ÿ"><a href="#ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆ-STOMP-é€‚ç”¨äº-WebSocketï¼Ÿ" class="headerlink" title="ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆ STOMP é€‚ç”¨äº WebSocketï¼Ÿ"></a><strong>ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆ STOMP é€‚ç”¨äº WebSocketï¼Ÿ</strong></h4><ul><li><strong>WebSocket æ˜¯ä¸€ä¸ªåè®®ï¼Œä½†ç¼ºå°‘æ¶ˆæ¯æ ¼å¼</strong> â†’ STOMP è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†<strong>ç»“æ„åŒ–æ¶ˆæ¯</strong>ã€‚</li><li><strong>WebSocket æ²¡æœ‰å†…ç½®è®¢é˜…åŠŸèƒ½</strong> â†’ STOMP æä¾›äº† <strong>å‘å¸ƒ&#x2F;è®¢é˜…</strong> æœºåˆ¶ã€‚</li><li><strong>WebSocket è®¤è¯éœ€è¦è‡ªå·±å®ç°</strong> â†’ STOMP å¯ä»¥ <strong>æºå¸¦ <code>token</code> è®¤è¯</strong>ã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰Spring-WebSocket-STOMP-ç¤ºä¾‹"><a href="#ï¼ˆ3ï¼‰Spring-WebSocket-STOMP-ç¤ºä¾‹" class="headerlink" title="ï¼ˆ3ï¼‰Spring WebSocket + STOMP ç¤ºä¾‹"></a><strong>ï¼ˆ3ï¼‰Spring WebSocket + STOMP ç¤ºä¾‹</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.StompEndpointRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketStompConfig</span> <span class="keyword">implements</span> <span class="title class_">WebSocketMessageBrokerConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> &#123;</span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/ws&quot;</span>).setAllowedOrigins(<span class="string">&quot;*&quot;</span>).withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> &#123;</span><br><span class="line">        registry.enableSimpleBroker(<span class="string">&quot;/topic&quot;</span>);</span><br><span class="line">        registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ4ï¼‰å‰ç«¯å¦‚ä½•è®¢é˜…-STOMP-æ¶ˆæ¯ï¼Ÿ"><a href="#ï¼ˆ4ï¼‰å‰ç«¯å¦‚ä½•è®¢é˜…-STOMP-æ¶ˆæ¯ï¼Ÿ" class="headerlink" title="ï¼ˆ4ï¼‰å‰ç«¯å¦‚ä½•è®¢é˜… STOMP æ¶ˆæ¯ï¼Ÿ"></a><strong>ï¼ˆ4ï¼‰å‰ç«¯å¦‚ä½•è®¢é˜… STOMP æ¶ˆæ¯ï¼Ÿ</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="keyword">new</span> <span class="title class_">SockJS</span>(<span class="string">&#x27;/ws&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> stompClient = <span class="title class_">Stomp</span>.<span class="title function_">over</span>(socket);</span><br><span class="line"></span><br><span class="line">stompClient.<span class="title function_">connect</span>(&#123;&#125;, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    stompClient.<span class="title function_">subscribe</span>(<span class="string">&#x27;/topic/chat&#x27;</span>, <span class="keyword">function</span> (<span class="params">message</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> + message.<span class="property">body</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    stompClient.<span class="title function_">send</span>(<span class="string">&quot;/app/chat&quot;</span>, &#123;&#125;, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="attr">content</span>: <span class="string">&quot;Hello&quot;</span>&#125;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h3 id="3-åœ¨-WebSocket-è¿æ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†èº«ä»½è®¤è¯ï¼Ÿå¦‚ä½•ç¡®ä¿åªæœ‰åˆæ³•ç”¨æˆ·å¯ä»¥å»ºç«‹-WebSocket-è¿æ¥ï¼Ÿ"><a href="#3-åœ¨-WebSocket-è¿æ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†èº«ä»½è®¤è¯ï¼Ÿå¦‚ä½•ç¡®ä¿åªæœ‰åˆæ³•ç”¨æˆ·å¯ä»¥å»ºç«‹-WebSocket-è¿æ¥ï¼Ÿ" class="headerlink" title="3. åœ¨ WebSocket è¿æ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†èº«ä»½è®¤è¯ï¼Ÿå¦‚ä½•ç¡®ä¿åªæœ‰åˆæ³•ç”¨æˆ·å¯ä»¥å»ºç«‹ WebSocket è¿æ¥ï¼Ÿ"></a><strong>3. åœ¨ WebSocket è¿æ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†èº«ä»½è®¤è¯ï¼Ÿå¦‚ä½•ç¡®ä¿åªæœ‰åˆæ³•ç”¨æˆ·å¯ä»¥å»ºç«‹ WebSocket è¿æ¥ï¼Ÿ</strong></h3><h4 id="ï¼ˆ1ï¼‰åŸºäº-HTTP-è®¤è¯ï¼ˆtoken-æ–¹å¼ï¼‰"><a href="#ï¼ˆ1ï¼‰åŸºäº-HTTP-è®¤è¯ï¼ˆtoken-æ–¹å¼ï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰åŸºäº HTTP è®¤è¯ï¼ˆtoken æ–¹å¼ï¼‰"></a><strong>ï¼ˆ1ï¼‰åŸºäº HTTP è®¤è¯ï¼ˆ<code>token</code> æ–¹å¼ï¼‰</strong></h4><ul><li><strong>å®¢æˆ·ç«¯è¿æ¥ WebSocket æ—¶é™„å¸¦ <code>token</code></strong></li><li><strong>åœ¨ WebSocket æœåŠ¡å™¨ç«¯è§£æ <code>token</code> å¹¶æ ¡éªŒ</strong></li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ServerEndpoint(&quot;/chat/&#123;token&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthWebSocketServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECRET_KEY</span> <span class="operator">=</span> <span class="string">&quot;mySecret&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;token&quot;)</span> String token)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!validateToken(token)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                session.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;éæ³•è¿æ¥è¢«æ‹’ç»&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆæ³•ç”¨æˆ·è¿æ¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">validateToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;valid_token&quot;</span>.equals(token); <span class="comment">// å®é™…åº”ä½¿ç”¨ JWT éªŒè¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰åŸºäº-Spring-Security-STOMP-è®¤è¯"><a href="#ï¼ˆ2ï¼‰åŸºäº-Spring-Security-STOMP-è®¤è¯" class="headerlink" title="ï¼ˆ2ï¼‰åŸºäº Spring Security + STOMP è®¤è¯"></a><strong>ï¼ˆ2ï¼‰åŸºäº Spring Security + STOMP è®¤è¯</strong></h4><p>åœ¨ Spring Security + STOMP è®¤è¯ä¸­ï¼Œèº«ä»½è®¤è¯é€šå¸¸åœ¨ <strong>WebSocket æ¡æ‰‹é˜¶æ®µ</strong> è¿›è¡Œï¼Œå¹¶ç”± Spring Security è¿›è¡Œæ‹¦æˆªå’ŒéªŒè¯ã€‚ä»¥ä¸‹æ˜¯æ•´ä¸ªè¿‡ç¨‹çš„æ ¸å¿ƒæ­¥éª¤ï¼š</p><ol><li><strong>ç”¨æˆ·å‘èµ· WebSocket è¿æ¥</strong><ul><li>æµè§ˆå™¨æˆ–å®¢æˆ·ç«¯ä½¿ç”¨ <code>ws://server/ws</code>ï¼ˆæˆ– <code>wss://server/ws</code>ï¼‰å‘èµ· WebSocket è¿æ¥ã€‚</li><li>è¿™ä¸ªè¯·æ±‚ä¼šè¢« <code>registerStompEndpoints</code> ä¸­å®šä¹‰çš„ <code>&quot;/ws&quot;</code> ç«¯ç‚¹æ¥æ”¶ã€‚</li></ul></li><li><strong>Spring Security è¿›è¡Œèº«ä»½è®¤è¯</strong><ul><li>å¦‚æœ WebSocket è¿æ¥å— Spring Security ä¿æŠ¤ï¼Œé‚£ä¹ˆæ¡æ‰‹è¯·æ±‚ï¼ˆHTTP è¯·æ±‚ï¼‰ä¼šç»è¿‡ Spring Security è¿‡æ»¤å™¨é“¾ã€‚</li><li>åœ¨ <code>HandshakeInterceptor</code> æˆ– <code>AuthenticationPrincipalArgumentResolver</code> ä¸­å¯ä»¥æå– <strong>HTTP å¤´ã€JWTã€Session</strong> ç­‰ä¿¡æ¯è¿›è¡Œèº«ä»½è®¤è¯ã€‚</li></ul></li><li><strong>æ¡æ‰‹æˆåŠŸåï¼ŒSTOMP è¿æ¥å»ºç«‹</strong><ul><li>é€šè¿‡ <code>WebSocketAuthConfig</code> ä¸­ <code>configureMessageBroker</code> é…ç½®ï¼ŒSTOMP è¿æ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯å¯ä»¥è®¢é˜… <code>/topic</code> æˆ–å‘é€ <code>/app</code> æ¶ˆæ¯ã€‚</li></ul></li><li><strong>æ¶ˆæ¯è®¤è¯</strong><ul><li>å½“å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼ˆå¦‚ <code>SEND /app/chat</code>ï¼‰ï¼ŒSpring Security ä¼šä½¿ç”¨ <code>ChannelInterceptor</code> è¿›è¡Œèº«ä»½è®¤è¯å’Œæƒé™æ£€æŸ¥ã€‚</li></ul></li></ol><p>Spring Security å¯ä»¥æ‹¦æˆª WebSocket è¿æ¥ï¼Œå¹¶è¿›è¡Œèº«ä»½è®¤è¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketAuthConfig</span> <span class="keyword">implements</span> <span class="title class_">WebSocketMessageBrokerConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> &#123;</span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/ws&quot;</span>).setAllowedOrigins(<span class="string">&quot;*&quot;</span>).withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> &#123;</span><br><span class="line">        registry.enableSimpleBroker(<span class="string">&quot;/topic&quot;</span>);</span><br><span class="line">        registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="4-å¦‚æœ-WebSocket-è¿æ¥æ–­å¼€ï¼Œå¦‚ä½•å®ç°è‡ªåŠ¨é‡è¿ï¼Ÿå‰ç«¯å’Œåç«¯å„è‡ªåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#4-å¦‚æœ-WebSocket-è¿æ¥æ–­å¼€ï¼Œå¦‚ä½•å®ç°è‡ªåŠ¨é‡è¿ï¼Ÿå‰ç«¯å’Œåç«¯å„è‡ªåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="4. å¦‚æœ WebSocket è¿æ¥æ–­å¼€ï¼Œå¦‚ä½•å®ç°è‡ªåŠ¨é‡è¿ï¼Ÿå‰ç«¯å’Œåç«¯å„è‡ªåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ"></a><strong>4. å¦‚æœ WebSocket è¿æ¥æ–­å¼€ï¼Œå¦‚ä½•å®ç°è‡ªåŠ¨é‡è¿ï¼Ÿå‰ç«¯å’Œåç«¯å„è‡ªåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</strong></h3><h4 id="ï¼ˆ1ï¼‰å‰ç«¯å®ç°-WebSocket-è‡ªåŠ¨é‡è¿"><a href="#ï¼ˆ1ï¼‰å‰ç«¯å®ç°-WebSocket-è‡ªåŠ¨é‡è¿" class="headerlink" title="ï¼ˆ1ï¼‰å‰ç«¯å®ç° WebSocket è‡ªåŠ¨é‡è¿"></a><strong>ï¼ˆ1ï¼‰å‰ç«¯å®ç° WebSocket è‡ªåŠ¨é‡è¿</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> socket;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">connect</span>(<span class="params"></span>) &#123;</span><br><span class="line">    socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8080/chat&quot;</span>);</span><br><span class="line"></span><br><span class="line">    socket.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿æ¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    socket.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿æ¥é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    socket.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿æ¥å…³é—­ï¼Œ5 ç§’åé‡è¿&quot;</span>);</span><br><span class="line">        <span class="built_in">setTimeout</span>(connect, <span class="number">5000</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">connect</span>();</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰åç«¯å¤„ç†-WebSocket-é‡è¿"><a href="#ï¼ˆ2ï¼‰åç«¯å¤„ç†-WebSocket-é‡è¿" class="headerlink" title="ï¼ˆ2ï¼‰åç«¯å¤„ç† WebSocket é‡è¿"></a><strong>ï¼ˆ2ï¼‰åç«¯å¤„ç† WebSocket é‡è¿</strong></h4><ul><li><strong>ä½¿ç”¨ <code>ping/pong</code> æœºåˆ¶</strong> æ£€æµ‹æ­»è¿æ¥</li><li><strong>æ¸…ç†æ— æ•ˆè¿æ¥</strong>ï¼Œå¹¶å…è®¸å®¢æˆ·ç«¯é‡è¿</li><li><strong>åŸºäº Redis æˆ–æ•°æ®åº“å­˜å‚¨ç”¨æˆ·è¿æ¥çŠ¶æ€</strong></li></ul><h3 id="1-WebSocket-è¿æ¥è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼ˆå¦‚-10w-ä»¥ä¸Šï¼‰ï¼Œå¦‚ä½•ä¼˜åŒ–-WebSocket-æœåŠ¡å™¨çš„æ€§èƒ½ï¼Ÿ"><a href="#1-WebSocket-è¿æ¥è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼ˆå¦‚-10w-ä»¥ä¸Šï¼‰ï¼Œå¦‚ä½•ä¼˜åŒ–-WebSocket-æœåŠ¡å™¨çš„æ€§èƒ½ï¼Ÿ" class="headerlink" title="1. WebSocket è¿æ¥è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼ˆå¦‚ 10w ä»¥ä¸Šï¼‰ï¼Œå¦‚ä½•ä¼˜åŒ– WebSocket æœåŠ¡å™¨çš„æ€§èƒ½ï¼Ÿ"></a>1. WebSocket è¿æ¥è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼ˆå¦‚ 10w ä»¥ä¸Šï¼‰ï¼Œå¦‚ä½•ä¼˜åŒ– WebSocket æœåŠ¡å™¨çš„æ€§èƒ½ï¼Ÿ</h3><h4 id="1-1-WebSocket-æœåŠ¡å™¨çš„æ€§èƒ½ç“¶é¢ˆ"><a href="#1-1-WebSocket-æœåŠ¡å™¨çš„æ€§èƒ½ç“¶é¢ˆ" class="headerlink" title="1.1 WebSocket æœåŠ¡å™¨çš„æ€§èƒ½ç“¶é¢ˆ"></a>1.1 WebSocket æœåŠ¡å™¨çš„æ€§èƒ½ç“¶é¢ˆ</h4><p>åœ¨é«˜å¹¶å‘ WebSocket æœåŠ¡å™¨ä¸­ï¼Œä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆåŒ…æ‹¬ï¼š</p><ul><li><strong>è¿æ¥ç®¡ç†å¼€é”€</strong>ï¼šæ¯ä¸ª WebSocket è¿æ¥éƒ½éœ€è¦ç»´æŠ¤ <code>Session</code>ï¼Œå ç”¨ä¸€å®šçš„ <strong>å†…å­˜</strong> å’Œ <strong>CPU</strong> èµ„æºã€‚</li><li><strong>I&#x2F;O å¤„ç†èƒ½åŠ›</strong>ï¼šWebSocket éœ€è¦ <strong>é«˜æ•ˆçš„ I&#x2F;O å¤„ç†æ¨¡å‹</strong>ï¼Œå¦åˆ™ä¼šå¯¼è‡´ååé‡ä¸‹é™ã€‚</li><li><strong>æ¶ˆæ¯å¹¿æ’­ä¸åˆ†å‘</strong>ï¼šåœ¨ <strong>ç¾¤èŠæˆ–æ¶ˆæ¯æ¨é€</strong> åœºæ™¯ä¸‹ï¼Œæ¶ˆæ¯çš„åˆ†å‘ä¼šå¯¼è‡´ <strong>CPUã€ç½‘ç»œå¸¦å®½</strong> å¼€é”€è¿‡é«˜ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šå•å°æœåŠ¡å™¨çš„è¿æ¥æ•°ä¸Šé™å—é™ï¼Œå¦‚ä½•<strong>æ°´å¹³æ‰©å±•</strong>éå¸¸å…³é”®ã€‚</li></ul><h4 id="1-2-æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#1-2-æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="1.2 æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ"></a>1.2 æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ</h4><h5 id="1-2-1-é€‰æ‹©åˆé€‚çš„-WebSocket-æœåŠ¡å™¨"><a href="#1-2-1-é€‰æ‹©åˆé€‚çš„-WebSocket-æœåŠ¡å™¨" class="headerlink" title="1.2.1 é€‰æ‹©åˆé€‚çš„ WebSocket æœåŠ¡å™¨"></a>1.2.1 é€‰æ‹©åˆé€‚çš„ WebSocket æœåŠ¡å™¨</h5><ul><li><strong>Netty</strong>ï¼šç›¸æ¯”äº Tomcatã€Spring é»˜è®¤çš„ WebSocket å®ç°ï¼ŒNetty æ›´é€‚åˆ <strong>é«˜å¹¶å‘ WebSocket è¿æ¥</strong>ï¼Œå› ä¸ºå®ƒé‡‡ç”¨ <strong>å¼‚æ­¥ I&#x2F;Oï¼ˆNIOï¼‰</strong>ï¼Œå‡å°‘çº¿ç¨‹é˜»å¡ï¼Œæé«˜ååé‡ã€‚</li><li><strong>Vert.x WebSocket</strong>ï¼šåŸºäº Nettyï¼Œé€‚ç”¨äºé«˜å¹¶å‘ WebSocket åœºæ™¯ã€‚</li></ul><h5 id="1-2-2-é™åˆ¶æ¯ä¸ªè¿æ¥çš„èµ„æºå ç”¨"><a href="#1-2-2-é™åˆ¶æ¯ä¸ªè¿æ¥çš„èµ„æºå ç”¨" class="headerlink" title="1.2.2 é™åˆ¶æ¯ä¸ªè¿æ¥çš„èµ„æºå ç”¨"></a>1.2.2 é™åˆ¶æ¯ä¸ªè¿æ¥çš„èµ„æºå ç”¨</h5><ul><li><strong>å‡å°‘ Session å†…å­˜å ç”¨</strong>ï¼šé¿å…ç›´æ¥åœ¨ JVM å†…å­˜ä¸­å­˜å‚¨è¿‡å¤š WebSocket è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨ <strong>Redis &#x2F; Zookeeper</strong> è¿›è¡Œç®¡ç†ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ä¼˜åŒ–</strong>ï¼šé¿å…æœåŠ¡å™¨ç¼“å­˜å¤§é‡æœªå‘é€çš„æ¶ˆæ¯ï¼Œ<strong>ä½¿ç”¨ Kafka æˆ– Redis è¿›è¡Œæ¶ˆæ¯ç¼“å†²</strong>ï¼Œå¼‚æ­¥æ¨é€æ¶ˆæ¯ã€‚</li></ul><h5 id="1-2-3-ä½¿ç”¨å¼‚æ­¥éé˜»å¡-I-Oï¼ˆReactor-æ¨¡å‹ï¼‰"><a href="#1-2-3-ä½¿ç”¨å¼‚æ­¥éé˜»å¡-I-Oï¼ˆReactor-æ¨¡å‹ï¼‰" class="headerlink" title="1.2.3 ä½¿ç”¨å¼‚æ­¥éé˜»å¡ I&#x2F;Oï¼ˆReactor æ¨¡å‹ï¼‰"></a>1.2.3 ä½¿ç”¨å¼‚æ­¥éé˜»å¡ I&#x2F;Oï¼ˆReactor æ¨¡å‹ï¼‰</h5><ul><li><strong>Tomcat é»˜è®¤ WebSocket é‡‡ç”¨ BIOï¼ˆé˜»å¡ I&#x2F;Oï¼‰</strong>ï¼Œå¯¹äºé«˜å¹¶å‘ä¸å‹å¥½ã€‚</li><li><strong>Netty + Reactorï¼ˆå¦‚ Spring WebFluxï¼‰</strong> é‡‡ç”¨ <strong>äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥å¤„ç†</strong>ï¼Œå¯ä»¥å¤§å¹…æé«˜ååé‡ã€‚</li></ul><h5 id="1-2-4-è´Ÿè½½å‡è¡¡ï¼ˆé›†ç¾¤éƒ¨ç½²ï¼‰"><a href="#1-2-4-è´Ÿè½½å‡è¡¡ï¼ˆé›†ç¾¤éƒ¨ç½²ï¼‰" class="headerlink" title="1.2.4 è´Ÿè½½å‡è¡¡ï¼ˆé›†ç¾¤éƒ¨ç½²ï¼‰"></a>1.2.4 è´Ÿè½½å‡è¡¡ï¼ˆé›†ç¾¤éƒ¨ç½²ï¼‰</h5><ul><li><strong>Nginx + WebSocket åå‘ä»£ç†</strong>ï¼šä½¿ç”¨ <code>sticky session</code>ï¼ˆä¼šè¯ä¿æŒï¼‰ï¼Œç¡®ä¿åŒä¸€ WebSocket è¿æ¥å§‹ç»ˆè·¯ç”±åˆ°åŒä¸€å°æœåŠ¡å™¨ã€‚</li><li><strong>Kubernetes + Ingress</strong>ï¼šé€‚ç”¨äºäº‘åŸç”Ÿæ¶æ„ï¼Œæ”¯æŒ WebSocket çš„è´Ÿè½½å‡è¡¡ã€‚</li></ul><h5 id="1-2-5-æ¶ˆæ¯å‹ç¼©å’Œä¼˜åŒ–"><a href="#1-2-5-æ¶ˆæ¯å‹ç¼©å’Œä¼˜åŒ–" class="headerlink" title="1.2.5 æ¶ˆæ¯å‹ç¼©å’Œä¼˜åŒ–"></a>1.2.5 æ¶ˆæ¯å‹ç¼©å’Œä¼˜åŒ–</h5><ul><li><strong>WebSocket å‹ç¼©æ‰©å±•ï¼ˆPMCEï¼‰</strong>ï¼šå‡å°‘ WebSocket æ¶ˆæ¯ä½“ç§¯ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ã€‚</li><li><strong>JSON â†’ Protobuf</strong> æˆ– <strong>MessagePack</strong>ï¼šå‡å°‘æ•°æ®å¤§å°ï¼Œæé«˜è§£æé€Ÿåº¦ã€‚</li></ul><hr><h3 id="2-WebSocket-é€‚åˆç”¨æ¥åšæ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨å—ï¼Ÿå¦‚æœéœ€è¦å®ç°èŠå¤©è®°å½•æŒä¹…åŒ–ï¼Œè¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ"><a href="#2-WebSocket-é€‚åˆç”¨æ¥åšæ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨å—ï¼Ÿå¦‚æœéœ€è¦å®ç°èŠå¤©è®°å½•æŒä¹…åŒ–ï¼Œè¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ" class="headerlink" title="2. WebSocket é€‚åˆç”¨æ¥åšæ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨å—ï¼Ÿå¦‚æœéœ€è¦å®ç°èŠå¤©è®°å½•æŒä¹…åŒ–ï¼Œè¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ"></a>2. WebSocket é€‚åˆç”¨æ¥åšæ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨å—ï¼Ÿå¦‚æœéœ€è¦å®ç°èŠå¤©è®°å½•æŒä¹…åŒ–ï¼Œè¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ</h3><h4 id="2-1-WebSocket-ä¸é€‚åˆç›´æ¥åšæŒä¹…åŒ–å­˜å‚¨çš„åŸå› "><a href="#2-1-WebSocket-ä¸é€‚åˆç›´æ¥åšæŒä¹…åŒ–å­˜å‚¨çš„åŸå› " class="headerlink" title="2.1 WebSocket ä¸é€‚åˆç›´æ¥åšæŒä¹…åŒ–å­˜å‚¨çš„åŸå› "></a>2.1 WebSocket ä¸é€‚åˆç›´æ¥åšæŒä¹…åŒ–å­˜å‚¨çš„åŸå› </h4><ul><li><strong>WebSocket æ˜¯å®æ—¶é€šä¿¡åè®®</strong>ï¼Œé€‚åˆ <strong>ä½å»¶è¿Ÿä¼ è¾“</strong>ï¼Œä½† <strong>ä¸é€‚åˆæ•°æ®æŒä¹…åŒ–</strong>ã€‚</li><li><strong>æœåŠ¡å™¨é‡å¯æˆ–æ•…éšœæ—¶</strong>ï¼ŒWebSocket è¿æ¥ä¼šä¸¢å¤±ï¼Œ<strong>å¯¼è‡´æ•°æ®ä¸å¯è¿½æº¯</strong>ã€‚</li><li><strong>æ•°æ®åº“å†™å…¥ä¼šå½±å“ååé‡</strong>ï¼Œå¦‚æœæ¯æ¡æ¶ˆæ¯éƒ½ç›´æ¥å†™å…¥æ•°æ®åº“ï¼Œä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚</li></ul><h4 id="2-2-åˆç†çš„èŠå¤©è®°å½•æŒä¹…åŒ–è®¾è®¡"><a href="#2-2-åˆç†çš„èŠå¤©è®°å½•æŒä¹…åŒ–è®¾è®¡" class="headerlink" title="2.2 åˆç†çš„èŠå¤©è®°å½•æŒä¹…åŒ–è®¾è®¡"></a>2.2 åˆç†çš„èŠå¤©è®°å½•æŒä¹…åŒ–è®¾è®¡</h4><h5 id="2-2-1-é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafka-RabbitMQï¼‰"><a href="#2-2-1-é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafka-RabbitMQï¼‰" class="headerlink" title="2.2.1 é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafka &#x2F; RabbitMQï¼‰"></a>2.2.1 é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafka &#x2F; RabbitMQï¼‰</h5><ul><li><p><strong>WebSocket æœåŠ¡å™¨å°†æ¶ˆæ¯å†™å…¥ Kafka</strong>ï¼Œç„¶åç”±åç«¯æ¶ˆè´¹è€… <strong>å¼‚æ­¥å­˜å‚¨åˆ°æ•°æ®åº“</strong>ã€‚</p></li><li><p>ä¼˜ç‚¹</p><p>ï¼š</p><ul><li>è§£è€¦ WebSocket å’Œæ•°æ®åº“å†™å…¥ï¼Œæé«˜ååé‡ã€‚</li><li>å…·å¤‡ <strong>æ¶ˆæ¯æŒä¹…åŒ–ã€å¯è¿½æº¯ã€å¯å›æ”¾</strong> çš„èƒ½åŠ›ã€‚</li></ul></li></ul><h5 id="2-2-2-æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ"><a href="#2-2-2-æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ" class="headerlink" title="2.2.2 æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ"></a>2.2.2 æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ</h5><ul><li><strong>çŸ­æœŸå­˜å‚¨ï¼ˆé«˜é¢‘è®¿é—®ï¼‰</strong>ï¼šä½¿ç”¨ <strong>Redis</strong> ç¼“å­˜æœ€è¿‘çš„èŠå¤©è®°å½•ã€‚</li><li><strong>é•¿æœŸå­˜å‚¨ï¼ˆå†å²è®°å½•ï¼‰</strong>ï¼šä½¿ç”¨ <strong>MongoDB &#x2F; MySQL</strong> è¿›è¡Œå­˜å‚¨ã€‚</li></ul><h5 id="2-2-3-å…¸å‹æ•°æ®åº“è®¾è®¡"><a href="#2-2-3-å…¸å‹æ•°æ®åº“è®¾è®¡" class="headerlink" title="2.2.3 å…¸å‹æ•°æ®åº“è®¾è®¡"></a>2.2.3 å…¸å‹æ•°æ®åº“è®¾è®¡</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> chat_messages (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    sender_id <span class="type">BIGINT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    receiver_id <span class="type">BIGINT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    room_id <span class="type">BIGINT</span>,</span><br><span class="line">    content TEXT <span class="keyword">NOT NULL</span>,</span><br><span class="line">    message_type ENUM(<span class="string">&#x27;TEXT&#x27;</span>, <span class="string">&#x27;IMAGE&#x27;</span>, <span class="string">&#x27;VIDEO&#x27;</span>),</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li><p><strong>æ”¯æŒç§èŠï¼ˆreceiver_idï¼‰å’Œç¾¤èŠï¼ˆroom_idï¼‰</strong></p></li><li><p>ç´¢å¼•ä¼˜åŒ–</p><p>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_chat_room <span class="keyword">ON</span> chat_messages(room_id, created_at);</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="3-åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ç¡®ä¿å¤šä¸ª-WebSocket-æœåŠ¡å™¨ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ï¼Ÿ"><a href="#3-åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ç¡®ä¿å¤šä¸ª-WebSocket-æœåŠ¡å™¨ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ï¼Ÿ" class="headerlink" title="3. åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ç¡®ä¿å¤šä¸ª WebSocket æœåŠ¡å™¨ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ï¼Ÿ"></a>3. åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ç¡®ä¿å¤šä¸ª WebSocket æœåŠ¡å™¨ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ï¼Ÿ</h3><h4 id="3-1-WebSocket-é›†ç¾¤çš„å…³é”®é—®é¢˜"><a href="#3-1-WebSocket-é›†ç¾¤çš„å…³é”®é—®é¢˜" class="headerlink" title="3.1 WebSocket é›†ç¾¤çš„å…³é”®é—®é¢˜"></a>3.1 WebSocket é›†ç¾¤çš„å…³é”®é—®é¢˜</h4><ul><li><strong>WebSocket æœåŠ¡å™¨æ˜¯æœ‰çŠ¶æ€çš„</strong>ï¼Œå¤šä¸ªæœåŠ¡å™¨å®ä¾‹ä¹‹é—´éœ€è¦åŒæ­¥è¿æ¥ä¿¡æ¯ã€‚</li><li><strong>å¦‚ä½•åœ¨ä¸åŒ WebSocket æœåŠ¡å™¨ä¹‹é—´ä¼ é€’æ¶ˆæ¯</strong>ï¼Œä¿è¯æ¶ˆæ¯ <strong>å¹¿æ’­</strong> å’Œ <strong>ç‚¹å¯¹ç‚¹æ¶ˆæ¯</strong> çš„å¯é æ€§ã€‚</li></ul><h4 id="3-2-è§£å†³æ–¹æ¡ˆ"><a href="#3-2-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.2 è§£å†³æ–¹æ¡ˆ"></a>3.2 è§£å†³æ–¹æ¡ˆ</h4><h5 id="3-2-1-ä½¿ç”¨-Redis-Pub-Sub-è¿›è¡Œæ¶ˆæ¯åŒæ­¥"><a href="#3-2-1-ä½¿ç”¨-Redis-Pub-Sub-è¿›è¡Œæ¶ˆæ¯åŒæ­¥" class="headerlink" title="3.2.1 ä½¿ç”¨ Redis Pub&#x2F;Sub è¿›è¡Œæ¶ˆæ¯åŒæ­¥"></a>3.2.1 ä½¿ç”¨ Redis Pub&#x2F;Sub è¿›è¡Œæ¶ˆæ¯åŒæ­¥</h5><ul><li><p>WebSocket æœåŠ¡å™¨é—´é€šè¿‡ </p><p>Redis Pub&#x2F;Sub</p><p> è¿›è¡Œæ¶ˆæ¯å¹¿æ’­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.convertAndSend(<span class="string">&quot;chat-room-123&quot;</span>, message);</span><br></pre></td></tr></table></figure></li><li><p>é€‚ç”¨åœºæ™¯</p><p>ï¼š</p><ul><li>é€‚åˆä¸­å°è§„æ¨¡çš„ WebSocket æœåŠ¡å™¨é›†ç¾¤ã€‚</li></ul></li></ul><h5 id="3-2-2-ä½¿ç”¨-Kafka-è¿›è¡Œæ¶ˆæ¯å¹¿æ’­"><a href="#3-2-2-ä½¿ç”¨-Kafka-è¿›è¡Œæ¶ˆæ¯å¹¿æ’­" class="headerlink" title="3.2.2 ä½¿ç”¨ Kafka è¿›è¡Œæ¶ˆæ¯å¹¿æ’­"></a>3.2.2 ä½¿ç”¨ Kafka è¿›è¡Œæ¶ˆæ¯å¹¿æ’­</h5><ul><li><p><strong>Kafka é€‚ç”¨äºå¤§è§„æ¨¡åˆ†å¸ƒå¼ WebSocket æœåŠ¡å™¨é›†ç¾¤</strong>ã€‚</p></li><li><p>æ¶ˆæ¯æµç¨‹</p><p>ï¼š</p><ul><li>A æœåŠ¡å™¨æ”¶åˆ° WebSocket æ¶ˆæ¯ â†’ å‘å¸ƒåˆ° Kafka â†’ B æœåŠ¡å™¨æ¶ˆè´¹å¹¶è½¬å‘ç»™å¯¹åº”çš„ WebSocket è¿æ¥ã€‚</li></ul></li></ul><h5 id="3-2-3-é‡‡ç”¨-Nginx-Sticky-Session"><a href="#3-2-3-é‡‡ç”¨-Nginx-Sticky-Session" class="headerlink" title="3.2.3 é‡‡ç”¨ Nginx + Sticky Session"></a>3.2.3 é‡‡ç”¨ Nginx + Sticky Session</h5><ul><li>è®©åŒä¸€ä¸ª WebSocket è¿æ¥æ€»æ˜¯è¿æ¥åˆ° <strong>åŒä¸€ä¸ª WebSocket æœåŠ¡å™¨å®ä¾‹</strong>ï¼Œå‡å°‘æœåŠ¡å™¨é—´çš„åŒæ­¥å‹åŠ›ã€‚</li></ul><hr><h3 id="4-å¦‚ä½•å¤„ç†-WebSocket-æœåŠ¡å™¨çš„é«˜å¯ç”¨é—®é¢˜ï¼Ÿ"><a href="#4-å¦‚ä½•å¤„ç†-WebSocket-æœåŠ¡å™¨çš„é«˜å¯ç”¨é—®é¢˜ï¼Ÿ" class="headerlink" title="4. å¦‚ä½•å¤„ç† WebSocket æœåŠ¡å™¨çš„é«˜å¯ç”¨é—®é¢˜ï¼Ÿ"></a>4. å¦‚ä½•å¤„ç† WebSocket æœåŠ¡å™¨çš„é«˜å¯ç”¨é—®é¢˜ï¼Ÿ</h3><h4 id="4-1-WebSocket-é«˜å¯ç”¨é¢ä¸´çš„æŒ‘æˆ˜"><a href="#4-1-WebSocket-é«˜å¯ç”¨é¢ä¸´çš„æŒ‘æˆ˜" class="headerlink" title="4.1 WebSocket é«˜å¯ç”¨é¢ä¸´çš„æŒ‘æˆ˜"></a>4.1 WebSocket é«˜å¯ç”¨é¢ä¸´çš„æŒ‘æˆ˜</h4><ul><li><strong>å¦‚ä½•åœ¨æœåŠ¡å™¨å®•æœºåï¼Œå¿«é€Ÿæ¢å¤ WebSocket è¿æ¥ï¼Ÿ</strong></li><li><strong>å¦‚ä½•åœ¨å¤šä¸ª WebSocket æœåŠ¡å™¨ä¹‹é—´åˆ†æ‹…è´Ÿè½½ï¼Ÿ</strong></li></ul><h4 id="4-2-è§£å†³æ–¹æ¡ˆ"><a href="#4-2-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4.2 è§£å†³æ–¹æ¡ˆ"></a>4.2 è§£å†³æ–¹æ¡ˆ</h4><h5 id="4-2-1-å‰ç«¯è‡ªåŠ¨é‡è¿"><a href="#4-2-1-å‰ç«¯è‡ªåŠ¨é‡è¿" class="headerlink" title="4.2.1 å‰ç«¯è‡ªåŠ¨é‡è¿"></a>4.2.1 å‰ç«¯è‡ªåŠ¨é‡è¿</h5><ul><li><p>å®¢æˆ·ç«¯æ£€æµ‹ WebSocket æ–­å¼€åè‡ªåŠ¨é‡è¿</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">connect</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;wss://yourserver/ws&quot;</span>);</span><br><span class="line">    ws.<span class="property">onclose</span> = <span class="function">() =&gt;</span> <span class="built_in">setTimeout</span>(connect, <span class="number">3000</span>); <span class="comment">// 3 ç§’åé‡è¿</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="4-2-2-ä½¿ç”¨-Redis-å…±äº«è¿æ¥çŠ¶æ€"><a href="#4-2-2-ä½¿ç”¨-Redis-å…±äº«è¿æ¥çŠ¶æ€" class="headerlink" title="4.2.2 ä½¿ç”¨ Redis å…±äº«è¿æ¥çŠ¶æ€"></a>4.2.2 ä½¿ç”¨ Redis å…±äº«è¿æ¥çŠ¶æ€</h5><ul><li><strong>ç”¨æˆ·è¿æ¥ä¿¡æ¯å­˜å…¥ Redis</strong>ï¼Œåœ¨æœåŠ¡å™¨é‡å¯åæ¢å¤ç”¨æˆ·çŠ¶æ€ã€‚</li></ul><h5 id="4-2-3-ä½¿ç”¨-Nginx-è´Ÿè½½å‡è¡¡"><a href="#4-2-3-ä½¿ç”¨-Nginx-è´Ÿè½½å‡è¡¡" class="headerlink" title="4.2.3 ä½¿ç”¨ Nginx è´Ÿè½½å‡è¡¡"></a>4.2.3 ä½¿ç”¨ Nginx è´Ÿè½½å‡è¡¡</h5><ul><li><strong>Nginx åå‘ä»£ç†</strong> ç¡®ä¿ç”¨æˆ·å¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°æ–°çš„ WebSocket æœåŠ¡å™¨ã€‚</li></ul><hr><h3 id="5-åœ¨-WebSocket-æœåŠ¡å™¨ä¸­ï¼Œå¦‚ä½•é˜²æ­¢-DDoS-æ”»å‡»ï¼Ÿ"><a href="#5-åœ¨-WebSocket-æœåŠ¡å™¨ä¸­ï¼Œå¦‚ä½•é˜²æ­¢-DDoS-æ”»å‡»ï¼Ÿ" class="headerlink" title="5. åœ¨ WebSocket æœåŠ¡å™¨ä¸­ï¼Œå¦‚ä½•é˜²æ­¢ DDoS æ”»å‡»ï¼Ÿ"></a>5. åœ¨ WebSocket æœåŠ¡å™¨ä¸­ï¼Œå¦‚ä½•é˜²æ­¢ DDoS æ”»å‡»ï¼Ÿ</h3><h4 id="5-1-WebSocket-å¸¸è§æ”»å‡»æ–¹å¼"><a href="#5-1-WebSocket-å¸¸è§æ”»å‡»æ–¹å¼" class="headerlink" title="5.1 WebSocket å¸¸è§æ”»å‡»æ–¹å¼"></a>5.1 WebSocket å¸¸è§æ”»å‡»æ–¹å¼</h4><ol><li><strong>å¤§é‡æ¶æ„è¿æ¥</strong>ï¼šæ”»å‡»è€…åˆ›å»ºå¤§é‡ WebSocket è¿æ¥ï¼Œè€—å°½æœåŠ¡å™¨èµ„æºã€‚</li><li><strong>å‘é€è¶…å¤§æ¶ˆæ¯</strong>ï¼šæ¶æ„å®¢æˆ·ç«¯å‘é€è¶…å¤§æ¶ˆæ¯ï¼Œå¯¼è‡´æœåŠ¡å™¨ OOMã€‚</li><li><strong>é¢‘ç¹é‡è¿</strong>ï¼šçŸ­æ—¶é—´å†…é¢‘ç¹æ–­å¼€é‡è¿ï¼Œå ç”¨æœåŠ¡å™¨çº¿ç¨‹ã€‚</li></ol><h4 id="5-2-è§£å†³æ–¹æ¡ˆ"><a href="#5-2-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="5.2 è§£å†³æ–¹æ¡ˆ"></a>5.2 è§£å†³æ–¹æ¡ˆ</h4><h5 id="5-2-1-é™åˆ¶è¿æ¥é€Ÿç‡"><a href="#5-2-1-é™åˆ¶è¿æ¥é€Ÿç‡" class="headerlink" title="5.2.1 é™åˆ¶è¿æ¥é€Ÿç‡"></a>5.2.1 é™åˆ¶è¿æ¥é€Ÿç‡</h5><ul><li><p>Nginx é™åˆ¶ WebSocket è¿æ¥æ•°</p><p>ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">limit_conn_zone</span> <span class="variable">$binary_remote_addr</span> zone=addr:<span class="number">10m</span>;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="section">location</span> /ws &#123;</span><br><span class="line">        <span class="attribute">limit_conn</span> addr <span class="number">10</span>; <span class="comment"># æ¯ä¸ª IP é™åˆ¶ 10 ä¸ªè¿æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="5-2-2-é™åˆ¶æ¶ˆæ¯å¤§å°"><a href="#5-2-2-é™åˆ¶æ¶ˆæ¯å¤§å°" class="headerlink" title="5.2.2 é™åˆ¶æ¶ˆæ¯å¤§å°"></a>5.2.2 é™åˆ¶æ¶ˆæ¯å¤§å°</h5><ul><li><p>Tomcat WebSocket é™åˆ¶æ¶ˆæ¯å¤§å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serverEndpointConfig.getUserProperties().put(<span class="string">&quot;org.apache.tomcat.websocket.maxMessageSize&quot;</span>, <span class="number">1024</span> * <span class="number">10</span>);</span><br></pre></td></tr></table></figure></li></ul><h5 id="5-2-3-é‡‡ç”¨-JWT-è®¤è¯"><a href="#5-2-3-é‡‡ç”¨-JWT-è®¤è¯" class="headerlink" title="5.2.3 é‡‡ç”¨ JWT è®¤è¯"></a>5.2.3 é‡‡ç”¨ JWT è®¤è¯</h5><ul><li><p>åªå…è®¸ </p><p>æˆæƒç”¨æˆ·</p><p> è¿æ¥ WebSocketï¼Œé˜²æ­¢æ¶æ„è¿æ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!jwtService.validate(token)) &#123;</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><hr><h2 id="é¡¹ç›®-1"><a href="#é¡¹ç›®-1" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h2><h3 id="SIDC-1"><a href="#SIDC-1" class="headerlink" title="SIDC"></a>SIDC</h3><h4 id="å‰åç«¯é¡µé¢æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½è¿›è¡ŒåŠ å¯†å¤„ç†"><a href="#å‰åç«¯é¡µé¢æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½è¿›è¡ŒåŠ å¯†å¤„ç†" class="headerlink" title="å‰åç«¯é¡µé¢æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½è¿›è¡ŒåŠ å¯†å¤„ç†"></a>å‰åç«¯é¡µé¢æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½è¿›è¡ŒåŠ å¯†å¤„ç†</h4><p>åœ¨å‰åç«¯åŠ å¯†å¤„ç†è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆéœ€è¦é€‰æ‹©åˆé€‚çš„åŠ å¯†ç®—æ³•ã€‚æ ¹æ®åŠ å¯†æ–¹å¼çš„ä¸åŒï¼ŒåŠ å¯†ç®—æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ã€‚å…¶åˆ†ç±»æ ‡å‡†ä¸ºå…¬é’¥å’Œç§é’¥æ˜¯å¦ç›¸åŒï¼Œè‹¥ç›¸åŒåˆ™ä¸ºå¯¹ç§°åŠ å¯†ï¼Œåä¹‹åˆ™ä¸ºéå¯¹ç§°åŠ å¯†ã€‚</p><p>å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ <strong>AES</strong>ï¼Œè€Œéå¯¹ç§°åŠ å¯†ç®—æ³•é€šå¸¸é‡‡ç”¨ <strong>RSA</strong>ã€‚è¯¦ç»†çš„åŠ å¯†ç®—æ³•ä»‹ç»å¯å‚è€ƒ[62 åŠ å¯†ç®—æ³•](<a href="https://fangyaohui.github.io/2025/02/26/62">https://fangyaohui.github.io/2025/02/26/62</a> åŠ å¯†ç®—æ³•&#x2F;)ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¸¸è§çš„åšæ³•æ˜¯ä½¿ç”¨ <strong>RSA</strong> åŠ å¯†ç®—æ³•è¿›è¡Œå¯†é’¥äº¤æ¢ï¼ŒæˆåŠŸäº¤æ¢åï¼Œä½¿ç”¨ <strong>AES</strong> ç®—æ³•è¿›è¡Œæ•°æ®åŠ å¯†å’Œè§£å¯†ã€‚</p><p>æœ¬é¡¹ç›®ä¸­ï¼Œè€ƒè™‘åˆ°æ€§èƒ½ä¸æ˜“ç”¨æ€§ï¼Œé€‰æ‹©äº† <strong>AES</strong> ä½œä¸ºåŠ å¯†ç®—æ³•ã€‚</p><p>ä¸ºæ”¯æŒè¿™ä¸€åŠ å¯†æ–¹å¼ï¼Œå¼€å‘äº†ä¸€ä¸ªæ¨¡å—ï¼Œå°è£…äº†å¯¹æ¥å£è¯·æ±‚è¿›è¡Œè§£å¯†ä¸å“åº”åŠ å¯†çš„åŠŸèƒ½ï¼Œæ–¹ä¾¿æœªæ¥æ‰©å±•å’Œç»´æŠ¤ã€‚</p><p>åœ¨å‰åç«¯åŠ å¯†çš„å®ç°ä¸­ï¼Œå¸¸è§çš„ä¸¤ç§æƒ…å½¢æ˜¯ï¼šä¸€æ˜¯å¯¹è¯·æ±‚ URL ä¸­çš„è·¯å¾„è¿›è¡ŒåŠ å¯†ï¼›äºŒæ˜¯å¯¹è¯·æ±‚ä½“è¿›è¡ŒåŠ å¯†è€Œä¸å¯¹ URL è¿›è¡ŒåŠ å¯†ã€‚è‹¥é€‰æ‹©ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œåˆ™åç«¯æœåŠ¡éœ€è¦åœ¨ç½‘å…³å±‚è§£å¯†è¯·æ±‚è·¯å¾„å¹¶å¤„ç†è¯·æ±‚ä½“ï¼Œä¹‹åå°†è¯·æ±‚è½¬å‘è‡³ç›®æ ‡æ¥å£ï¼›è‹¥é€‰æ‹©ç¬¬äºŒç§æ–¹æ¡ˆï¼Œåˆ™æ— éœ€åœ¨ç½‘å…³å±‚å¤„ç†ï¼Œç›´æ¥å°†è¯·æ±‚è½¬å‘è‡³ç›®æ ‡æ¥å£ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè¯¦ç»†åˆ†æåœ¨åŠ å¯†è§£å¯†è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„æŠ€æœ¯éš¾ç‚¹ã€‚</p><p>é¦–å…ˆï¼Œå‡è®¾ä¸€ä¸ªè¯·æ±‚çš„ URL è¢«åŠ å¯†ï¼Œç»è¿‡ç½‘å…³è§£å¯†åï¼Œè‹¥è¯·æ±‚ä½“æœªè§£å¯†ï¼Œä¸”åœ¨ç›®æ ‡æ¥å£å¤„ç†æ—¶ï¼ŒSpring Boot ä¼šè‡ªåŠ¨è¿›è¡Œå‚æ•°åŒ¹é…ï¼Œæ­¤æ—¶ä¼šå¯¼è‡´ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ï¼Œæ— æ³•è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ã€‚</p><p>å…¶æ¬¡ï¼Œ<strong><code>HttpServletRequest</code></strong> é»˜è®¤æƒ…å†µä¸‹çš„è¾“å…¥æµåªèƒ½è¯»å–ä¸€æ¬¡ï¼Œå› æ­¤å¦‚æœéœ€è¦å¤šæ¬¡è®¿é—®è¯·æ±‚ä½“çš„å†…å®¹ï¼Œéœ€è¦ä½¿ç”¨ <strong><code>ContentCachingRequestWrapper</code></strong> è¿›è¡Œè¯·æ±‚ä½“ç¼“å­˜ã€‚æ­¤è®¾è®¡ç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤šæ¬¡è¯»å–è¯·æ±‚ä½“å†…å®¹çš„åœºæ™¯ï¼Œä¾‹å¦‚åœ¨ AOP ä¸­è§£å¯†è¯·æ±‚ä½“å†…å®¹ã€‚é€šè¿‡è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œå°†åŸå§‹çš„ <strong><code>HttpServletRequest</code></strong> å°è£…ä¸º <strong><code>ContentCachingRequestWrapper</code></strong>ï¼Œä»è€Œæ”¯æŒå¤šæ¬¡è¯»å–è¯·æ±‚ä½“å†…å®¹ã€‚</p><p>ä¸Šè¿°æ˜¯åŠ å¯†è§£å¯†è¿‡ç¨‹ä¸­çš„ç¬¬ä¸€ä¸ªæŠ€æœ¯éš¾ç‚¹ã€‚</p><p>ç¬¬äºŒä¸ªéš¾ç‚¹æ˜¯å¤„ç† PO å®ä½“ç±»ä¸­å±æ€§çš„åŠ è§£å¯†ã€‚éƒ¨åˆ†å±æ€§å¯èƒ½éœ€è¦æŒ‡å®šè¿›è¡ŒåŠ è§£å¯†ï¼Œè¿™å°†å¯¼è‡´å±‚å±‚åµŒå¥—ã€‚è™½ç„¶åŸºç¡€æ•°æ®ç±»å‹çš„åŠ è§£å¯†ç›¸å¯¹ç®€å•ï¼Œä½†å¯¹äºå¼•ç”¨ç±»å‹çš„æ•°æ®ï¼Œåˆ™éœ€è¦é€’å½’æŸ¥æ‰¾è¢«æ³¨è§£æ ‡è®°çš„å±æ€§ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„åŠ è§£å¯†æ“ä½œã€‚å¦‚æœè¯¥å±æ€§æ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™å…¶å¼•ç”¨çš„å±æ€§ä¹Ÿéœ€è¿›è¡Œè§£å¯†ã€‚å› æ­¤ï¼ŒåŸºäºç­–ç•¥å·¥å‚ç­‰è®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥çµæ´»å®ç°è¿™ä¸€éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯åŠ è§£å¯†ç­–ç•¥è®¾è®¡çš„ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CryptStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ å¯†æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> plainText æ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¯†æ–‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">encrypt</span><span class="params">(String plainText)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£å¯†æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encryptedText å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜æ–‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">decrypt</span><span class="params">(String encryptedText)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CryptStrategyFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, CryptStrategy&gt; STRATEGIES = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_STRATEGY</span> <span class="operator">=</span> <span class="string">&quot;default&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å—æ³¨å†Œé»˜è®¤ç­–ç•¥</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        STRATEGIES.put(DEFAULT_STRATEGY, <span class="keyword">new</span> <span class="title class_">DefaultCryptStrategy</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–åŠ å¯†ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name ç­–ç•¥åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åŠ å¯†ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CryptStrategy <span class="title function_">getStrategy</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> STRATEGIES.getOrDefault(name, STRATEGIES.get(DEFAULT_STRATEGY));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–åŠ å¯†ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åŠ å¯†ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CryptStrategy <span class="title function_">getStrategy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> STRATEGIES.get(DEFAULT_STRATEGY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œè‡ªå®šä¹‰åŠ å¯†ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name ç­–ç•¥åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strategy ç­–ç•¥å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">registerStrategy</span><span class="params">(String name, CryptStrategy strategy)</span> &#123;</span><br><span class="line">        STRATEGIES.put(name, strategy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultCryptStrategy</span> <span class="keyword">implements</span> <span class="title class_">CryptStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// AESåŠ å¯†ç®—æ³•æ¨¡å¼å’Œå¡«å……æ–¹å¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALGORITHM</span> <span class="operator">=</span> <span class="string">&quot;AES&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALGORITHM_MODE</span> <span class="operator">=</span> <span class="string">&quot;AES/ECB/PKCS5Padding&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">privateKey</span> <span class="operator">=</span> <span class="string">&quot;fang&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String plainText)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–AESå¯†é’¥</span></span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">key</span> <span class="operator">=</span> generateSecretKey();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºå¯†ç å™¨</span></span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(ALGORITHM_MODE);</span><br><span class="line">            cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰§è¡ŒåŠ å¯†</span></span><br><span class="line">            <span class="type">byte</span>[] encryptedBytes = cipher.doFinal(plainText.getBytes());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿”å›åŠ å¯†ç»“æœï¼ˆè½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">            <span class="keyword">return</span> bytesToHex(encryptedBytes);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œå¹¶è¿”å›null</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decrypt</span><span class="params">(String encryptedText)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯æœ‰æ•ˆçš„åå…­è¿›åˆ¶</span></span><br><span class="line">            <span class="keyword">if</span> (!isHex(encryptedText)) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœä¸æ˜¯æœ‰æ•ˆçš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›åŸå§‹å­—ç¬¦ä¸²ï¼ˆè®¤ä¸ºæ˜¯æ˜æ–‡ï¼‰</span></span><br><span class="line">                <span class="keyword">return</span> encryptedText;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°†åå…­è¿›åˆ¶å¯†æ–‡è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line">            <span class="type">byte</span>[] encryptedBytes = hexToBytes(encryptedText);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–AESå¯†é’¥</span></span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">key</span> <span class="operator">=</span> generateSecretKey();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºå¯†ç å™¨</span></span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(ALGORITHM_MODE);</span><br><span class="line">            cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰§è¡Œè§£å¯†</span></span><br><span class="line">            <span class="type">byte</span>[] decryptedBytes = cipher.doFinal(encryptedBytes);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿”å›è§£å¯†ç»“æœï¼ˆè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(decryptedBytes);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯ç”±äºè§£å¯†å¤±è´¥å¼•èµ·çš„</span></span><br><span class="line">            <span class="comment">// e.printStackTrace();</span></span><br><span class="line">            <span class="comment">// è¿”å›åŸå§‹å­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="keyword">return</span> encryptedText;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®å¯†ç ç”ŸæˆAESå¯†é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> SecretKey</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SecretKey <span class="title function_">generateSecretKey</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">KeyGenerator</span> <span class="variable">keyGenerator</span> <span class="operator">=</span> KeyGenerator.getInstance(ALGORITHM);</span><br><span class="line">        <span class="type">SecureRandom</span> <span class="variable">secureRandom</span> <span class="operator">=</span> SecureRandom.getInstance(<span class="string">&quot;SHA1PRNG&quot;</span>);</span><br><span class="line">        secureRandom.setSeed(DefaultCryptStrategy.privateKey.getBytes());</span><br><span class="line">        keyGenerator.init(<span class="number">128</span>, secureRandom);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(keyGenerator.generateKey().getEncoded(), ALGORITHM);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">bytesToHex</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">hexString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">byte</span> b : bytes) &#123;</span><br><span class="line">            <span class="comment">// å°†æ¯ä¸ªå­—èŠ‚è½¬æ¢ä¸ºä¸¤ä½åå…­è¿›åˆ¶æ•°</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> Integer.toHexString(b &amp; <span class="number">0xFF</span>);</span><br><span class="line">            <span class="keyword">if</span> (hex.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                hexString.append(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            hexString.append(hex.toUpperCase());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hexString.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯æœ‰æ•ˆçš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœæ˜¯æœ‰æ•ˆçš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²è¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isHex</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> || str.length() % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åªåŒ…å«0-9å’ŒA-Få­—ç¬¦</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : str.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Character.isDigit(c) &amp;&amp; (c &lt; <span class="string">&#x27;A&#x27;</span> || c &gt; <span class="string">&#x27;F&#x27;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hexString åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] hexToBytes(String hexString) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> hexString.length();</span><br><span class="line">        <span class="keyword">if</span> (length % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Hex string must have even length.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] result = <span class="keyword">new</span> <span class="title class_">byte</span>[length / <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i += <span class="number">2</span>) &#123;</span><br><span class="line">            result[i / <span class="number">2</span>] = (<span class="type">byte</span>) ((Character.digit(hexString.charAt(i), <span class="number">16</span>) &lt;&lt; <span class="number">4</span>)</span><br><span class="line">                    + Character.digit(hexString.charAt(i + <span class="number">1</span>), <span class="number">16</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç è®¾è®¡äº†ä¸€ä¸ªçµæ´»çš„åŠ è§£å¯†ç­–ç•¥å·¥å‚ï¼Œæ”¯æŒåŠ¨æ€æ·»åŠ è‡ªå®šä¹‰çš„åŠ è§£å¯†ç®—æ³•ã€‚è¿™ç§è®¾è®¡ä¸ºç³»ç»Ÿæ‰©å±•å’Œå®šåˆ¶åŠ å¯†ç®—æ³•æä¾›äº†ä¾¿åˆ©ã€‚</p><h4 id="åŸºäºNettyå®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åŸºäºNettyå®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åŸºäºNettyå®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—"></a>åŸºäºNettyå®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—</h4><p>è¯¦æƒ…è¯·æŸ¥çœ‹<a href="https://fangyaohui.github.io/2025/02/27/66%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">https://fangyaohui.github.io/2025/02/27/66%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</a></p><p>å…·ä½“ä½¿ç”¨åˆ°äº†BlockingQueueå’ŒConcurrentHashMapç‰¹åˆ«éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-15 Java</title>
      <link href="/2025/02/26/75-15%20Java/"/>
      <url>/2025/02/26/75-15%20Java/</url>
      
        <content type="html"><![CDATA[<h1 id="75-15-Java"><a href="#75-15-Java" class="headerlink" title="75-15 Java"></a>75-15 Java</h1><h2 id="Mybatis-plus-Wrappers"><a href="#Mybatis-plus-Wrappers" class="headerlink" title="Mybatis-plus Wrappers"></a>Mybatis-plus Wrappers</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–æ‰€æœ‰æœ‰æ•ˆçš„åº”ç”¨åˆ—è¡¨</span></span><br><span class="line">List&lt;SysApplication&gt; applicationList = applicationMapper.selectList(</span><br><span class="line">      Wrappers.&lt;SysApplication&gt;lambdaQuery()</span><br><span class="line">            .eq(SysApplication::getDelFlag, CommonConstants.STATUS_NORMAL)</span><br><span class="line">            .eq(SysApplication::getStatus, StatusEnum.ENABLE.getCode()));</span><br><span class="line"><span class="keyword">if</span>(CollectionUtils.isEmpty(applicationList))&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯mybatis-plusä¸­å†…ç½®çš„è¿›è¡ŒæŸ¥è¯¢ï¼Œå°†mysqlè¯­å¥è¿›è¡Œäº†å°è£…ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜è¿›è¡Œå•è¡¨è¿›è¡Œæ“ä½œã€‚ä½†æ˜¯å¦‚æœæ¶‰åŠåˆ°å¤šè¡¨æŸ¥è¯¢ï¼Œè¿˜è¯·ä½¿ç”¨Mybatisï¼Œæ‰‹å†™SQLè¯­å¥ã€‚</p><p>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œæœ€å¥½ä½¿ç”¨å…¶ç±»å‹å¯¹åº”çš„isEmptyæ¥è¿›è¡Œåˆ¤æ–­ã€‚</p><h2 id="Stream-ä½¿ç”¨"><a href="#Stream-ä½¿ç”¨" class="headerlink" title="Stream()ä½¿ç”¨"></a>Stream()ä½¿ç”¨</h2><p>å‚è€ƒèµ„æ–™ï¼š[ã€Java åŸºç¡€ç¯‡ã€‘Java Streamæµè¯¦è§£](<a href="https://blog.csdn.net/qq_21484461/article/details/131420683?ops_request_misc=%7B%22request_id%22:%22171704794916800227425520%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171704794916800227425520&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-131420683-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=java">https://blog.csdn.net/qq_21484461/article/details/131420683?ops_request_misc=%7B%22request%5Fid%22%3A%22171704794916800227425520%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=171704794916800227425520&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-131420683-null-null.142^v100^pc_search_result_base1&amp;utm_term=java</a> stream&amp;spm&#x3D;1018.2226.3001.4187)</p><p>Stream ä¸­æ–‡ç§°ä¸º â€œæµâ€ï¼Œé€šè¿‡å°†é›†åˆè½¬æ¢ä¸ºè¿™ä¹ˆä¸€ç§å«åš â€œæµâ€ çš„å…ƒç´ åºåˆ—ï¼Œé€šè¿‡å£°æ˜æ€§æ–¹å¼ï¼Œèƒ½å¤Ÿå¯¹é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œä¸€ç³»åˆ—å¹¶è¡Œæˆ–ä¸²è¡Œçš„æµæ°´çº¿æ“ä½œã€‚</p><p>å‡½æ•°å¼ç¼–ç¨‹å¸¦æ¥çš„å¥½å¤„å°¤ä¸ºæ˜æ˜¾ã€‚è¿™ç§ä»£ç æ›´å¤šåœ°è¡¨è¾¾äº†ä¸šåŠ¡é€»è¾‘çš„æ„å›¾ï¼Œè€Œä¸æ˜¯å®ƒçš„å®ç°æœºåˆ¶ã€‚æ˜“è¯»çš„ä»£ç ä¹Ÿæ˜“äºç»´æŠ¤ã€æ›´å¯é ã€æ›´ä¸å®¹æ˜“å‡ºé”™ã€‚å°†ä¼šé€æ­¥è®°å½•ä½¿ç”¨åˆ°çš„streamæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†ç»„ ground by æŒ‰appIdè¿›è¡Œåˆ†ç»„æ“ä½œ å°†å…¶è½¬åŒ–æˆMap</span></span><br><span class="line">Map&lt;Long, List&lt;SysMenu&gt;&gt; menuNodeListMap = menuList.stream().collect(Collectors.groupingBy(SysMenu::getAppId));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æå–mapä¸­çš„æ‰€æœ‰çš„menuIdå­—æ®µçš„å€¼å½¢æˆä¸€ä¸ªList</span></span><br><span class="line">List&lt;Long&gt; roleMenuIds = userRolesMenuList.stream().map(SysMenu::getMenuId).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨filterè¿‡æ»¤æ‰ä¸€äº›å€¼</span></span><br><span class="line">allMenuNodeList = allMenuNodeList.stream()</span><br><span class="line">      .filter(t -&gt; roleMenuIds.contains(t.getId())</span><br><span class="line">            &amp;&amp; StringUtils.equalsAny(String.valueOf(t.getExtra().get(<span class="string">&quot;menuType&quot;</span>)),</span><br><span class="line">            String.valueOf(<span class="number">0</span>), String.valueOf(<span class="number">1</span>))).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æŸ¥è¯¢åˆ°çš„List&lt;å¯¹è±¡&gt;è½¬åŒ–æˆstreamï¼Œç„¶åå–ä¸¤ä¸ªå­—æ®µåšKeyå’ŒValue</span></span><br><span class="line">Map&lt;Long,Long&gt; roleAppMap = sysRoleAppMapper.selectList(Wrappers.&lt;SysRoleApp&gt;lambdaQuery()</span><br><span class="line">                .eq(SysRoleApp::getAppId,appId))                            .stream().collect(Collectors.toMap(SysRoleApp::getRoleId,SysRoleApp::getAppId));</span><br></pre></td></tr></table></figure><h3 id="Streamæµçš„ä½¿ç”¨æ–¹æ³•"><a href="#Streamæµçš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="Streamæµçš„ä½¿ç”¨æ–¹æ³•"></a>Streamæµçš„ä½¿ç”¨æ–¹æ³•</h3><p>Streamçš„ä½¿ç”¨å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥è¿›è¡Œï¼š</p><ol><li>åˆ›å»ºæµï¼šå¯ä»¥ä»é›†åˆã€æ•°ç»„ã€I&#x2F;Oé€šé“ç­‰æ•°æ®æºä¸­åˆ›å»ºStreamæµï¼› é›†åˆï¼šListã€Mapã€Setã€Queueï¼›</li><li>ä¸­é—´æ“ä½œï¼šå¯¹æµè¿›è¡Œä¸€ç³»åˆ—çš„è½¬æ¢å’Œæ“ä½œï¼Œå¦‚è¿‡æ»¤ã€æ˜ å°„ã€æ’åºç­‰ï¼›</li><li>ç»ˆç«¯æ“ä½œï¼šä»æµä¸­è·å–ç»“æœï¼Œå¦‚èšåˆã€æ”¶é›†ã€éå†ç­‰ã€‚</li></ol><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæµ</span></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">Stream&lt;String&gt; stream = names.stream();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸­é—´æ“ä½œ</span></span><br><span class="line">List&lt;String&gt; filteredNames = names.stream()</span><br><span class="line">                                  .filter(name -&gt; name.startsWith(<span class="string">&quot;A&quot;</span>))</span><br><span class="line">                                  .map(String::toUpperCase)</span><br><span class="line">                                  .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»ˆç«¯æ“ä½œ</span></span><br><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> names.stream().count();</span><br><span class="line">Optional&lt;String&gt; first = names.stream().findFirst();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿‡æ»¤æ“ä½œï¼šä½¿ç”¨filteræ–¹æ³•å¯ä»¥æ ¹æ®æŒ‡å®šçš„æ¡ä»¶è¿‡æ»¤æµä¸­çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œä»ä¸€ä¸ªæ•´æ•°åˆ—è¡¨ä¸­è¿‡æ»¤å‡ºå¶æ•°ï¼š</span></span><br><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line">List&lt;Integer&gt; evenNumbers = numbers.stream()</span><br><span class="line">                                   .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">                                   .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜ å°„æ“ä½œï¼šä½¿ç”¨mapæ–¹æ³•å¯ä»¥å°†æµä¸­çš„å…ƒç´ æ˜ å°„åˆ°å¦ä¸€ä¸ªå€¼ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ä¸­çš„å…ƒç´ è½¬æ¢ä¸ºå¤§å†™ï¼š</span></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">List&lt;String&gt; upperCaseNames = names.stream()</span><br><span class="line">                                   .map(String::toUpperCase)</span><br><span class="line">                                   .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’åºæ“ä½œï¼šä½¿ç”¨sortedæ–¹æ³•å¯ä»¥å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼Œå¯¹ä¸€ä¸ªæ•´æ•°åˆ—è¡¨è¿›è¡Œå‡åºæ’åºï¼š</span></span><br><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">5</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>);</span><br><span class="line">List&lt;Integer&gt; sortedNumbers = numbers.stream()</span><br><span class="line">                                     .sorted()</span><br><span class="line">                                     .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// èšåˆæ“ä½œï¼šä½¿ç”¨reduceæ–¹æ³•å¯ä»¥å°†æµä¸­çš„å…ƒç´ è¿›è¡Œèšåˆæ“ä½œï¼Œä¾‹å¦‚æ±‚å’Œã€æ±‚æœ€å¤§å€¼ç­‰ã€‚ä¾‹å¦‚ï¼Œè®¡ç®—ä¸€ä¸ªæ•´æ•°åˆ—è¡¨çš„æ€»å’Œï¼š</span></span><br><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> numbers.stream()</span><br><span class="line">                 .reduce(<span class="number">0</span>, Integer::sum);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶é›†æ“ä½œï¼šä½¿ç”¨collectæ–¹æ³•å¯ä»¥å°†æµä¸­çš„å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ä¸­çš„å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªæ–°çš„åˆ—è¡¨ä¸­ï¼š</span></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">List&lt;String&gt; collectedNames = names.stream()</span><br><span class="line">                                   .collect(Collectors.toList());</span><br></pre></td></tr></table></figure><h2 id="Lambdaè¡¨è¾¾å¼ä½¿ç”¨"><a href="#Lambdaè¡¨è¾¾å¼ä½¿ç”¨" class="headerlink" title="Lambdaè¡¨è¾¾å¼ä½¿ç”¨"></a>Lambdaè¡¨è¾¾å¼ä½¿ç”¨</h2><p>å‚è€ƒèµ„æ–™ï¼š[ã€Javaç³»åˆ—ã€‘æ·±å…¥è§£æ Lambdaè¡¨è¾¾å¼](<a href="https://blog.csdn.net/weixin_36755535/article/details/131350405?ops_request_misc=%7B%22request_id%22:%22171704867016800227472380%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171704867016800227472380&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-131350405-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=java">https://blog.csdn.net/weixin_36755535/article/details/131350405?ops_request_misc=%7B%22request%5Fid%22%3A%22171704867016800227472380%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=171704867016800227472380&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-131350405-null-null.142^v100^pc_search_result_base1&amp;utm_term=java</a> lambda&amp;spm&#x3D;1018.2226.3001.4187)</p><h3 id="æ¦‚å¿µä»‹ç»"><a href="#æ¦‚å¿µä»‹ç»" class="headerlink" title="æ¦‚å¿µä»‹ç»"></a>æ¦‚å¿µä»‹ç»</h3><p>Java Lambdaè¡¨è¾¾å¼æ˜¯Java 8ä¸­æœ€é‡è¦çš„æ–°ç‰¹æ€§ä¹‹ä¸€ã€‚</p><p>å®ƒä»¬æ˜¯ä¸€ç§å¯ä¼ é€’çš„åŒ¿åå‡½æ•°ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•æˆ–å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œå› æ­¤å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨å®ƒä»¬ã€‚</p><p>Lambdaè¡¨è¾¾å¼çš„ä¸»è¦ç›®çš„æ˜¯ç®€åŒ–Javaä»£ç ï¼Œä½¿å…¶æ›´æ˜“äºé˜…è¯»å’Œç¼–å†™ã€‚</p><p>Lambdaè¡¨è¾¾å¼çš„è¯­æ³•éå¸¸ç®€æ´å’Œæ¸…æ™°ã€‚å®ƒä»¬ç”±å‚æ•°åˆ—è¡¨ã€ç®­å¤´ç¬¦å·å’Œæ–¹æ³•ä½“ç»„æˆã€‚å‚æ•°åˆ—è¡¨æŒ‡å®šä¼ é€’ç»™Lambdaè¡¨è¾¾å¼çš„å‚æ•°ï¼Œç®­å¤´ç¬¦å· â€œ-&gt;â€ åˆ†éš”å‚æ•°åˆ—è¡¨å’Œæ–¹æ³•ä½“ï¼Œæ–¹æ³•ä½“åˆ™åŒ…å«Lambdaè¡¨è¾¾å¼è¦æ‰§è¡Œçš„ä»£ç ã€‚</p><h3 id="Lambdaä¼˜ç‚¹"><a href="#Lambdaä¼˜ç‚¹" class="headerlink" title="Lambdaä¼˜ç‚¹"></a>Lambdaä¼˜ç‚¹</h3><p>Lambdaè¡¨è¾¾å¼çš„ä¸»è¦ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p><ol><li>ç®€åŒ–ä»£ç ï¼šLambdaè¡¨è¾¾å¼å¯ä»¥å°†å†—é•¿å¤æ‚çš„ä»£ç ç®€åŒ–ä¸ºå‡ è¡Œç®€æ´çš„ä»£ç ã€‚</li><li>å¯è¯»æ€§ï¼šLambdaè¡¨è¾¾å¼å¯ä»¥ä½¿ä»£ç æ›´æ˜“äºé˜…è¯»å’Œç†è§£ï¼Œå› ä¸ºå®ƒä»¬æ›´æ¥è¿‘è‡ªç„¶è¯­è¨€ã€‚</li><li>å¯ä¼ é€’æ€§ï¼šLambdaè¡¨è¾¾å¼å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•æˆ–å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œä½¿ä»£ç æ›´å…·å¯é‡ç”¨æ€§å’Œçµæ´»æ€§ã€‚</li><li>å¹¶è¡Œå¤„ç†ï¼šLambdaè¡¨è¾¾å¼å¯ä»¥ä¸Stream APIä¸€èµ·ä½¿ç”¨ï¼Œä½¿Javaç¨‹åºæ›´å®¹æ˜“åœ°è¿›è¡Œå¹¶è¡Œå¤„ç†ã€‚</li></ol><p>Lambdaè¡¨è¾¾å¼æ˜¯Java 8ä¸­æœ€é‡è¦çš„æ–°ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒä»¬ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§æ›´ç®€å•ã€æ›´çµæ´»ã€æ›´æ˜“äºä½¿ç”¨çš„ç¼–ç¨‹æ–¹å¼ã€‚</p><h3 id="ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œå°†Listè½¬åŒ–æˆList"><a href="#ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œå°†Listè½¬åŒ–æˆList" class="headerlink" title="ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œå°†Listè½¬åŒ–æˆList"></a>ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œå°†List<Po>è½¬åŒ–æˆList<Vo></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢æ•°æ®æºé…ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;DatasourceInfoVO&gt; <span class="title function_">queryDatasourceInfoList</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;DataSourceInfoPO&gt; dataSourceInfoPOList = datasourceInfoMapper.selectList(</span><br><span class="line">            Wrappers.&lt;DataSourceInfoPO&gt;lambdaQuery()</span><br><span class="line">            .ne(DataSourceInfoPO::getDelFlag,<span class="string">&quot;1&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataSourceInfoPOList.stream()</span><br><span class="line">            .map(po -&gt; &#123;</span><br><span class="line">                <span class="type">DatasourceInfoVO</span> <span class="variable">datasourceInfoVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatasourceInfoVO</span>();</span><br><span class="line">                BeanUtils.copyProperties(po, datasourceInfoVO);</span><br><span class="line">                <span class="keyword">return</span> datasourceInfoVO;</span><br><span class="line">            &#125;)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Javaå®šæ—¶ä»»åŠ¡"><a href="#Javaå®šæ—¶ä»»åŠ¡" class="headerlink" title="Javaå®šæ—¶ä»»åŠ¡"></a>Javaå®šæ—¶ä»»åŠ¡</h2><h3 id="åŠ æ²¹ç«™ä¸šåŠ¡å®šæ—¶ç»Ÿè®¡ä»£ç é€»è¾‘ç†è§£"><a href="#åŠ æ²¹ç«™ä¸šåŠ¡å®šæ—¶ç»Ÿè®¡ä»£ç é€»è¾‘ç†è§£" class="headerlink" title="åŠ æ²¹ç«™ä¸šåŠ¡å®šæ—¶ç»Ÿè®¡ä»£ç é€»è¾‘ç†è§£"></a>åŠ æ²¹ç«™ä¸šåŠ¡å®šæ—¶ç»Ÿè®¡ä»£ç é€»è¾‘ç†è§£</h3><p>è¿™éƒ¨åˆ†ä»£ç ä½äºpackage com.space.intell.gas.bff.configä¸­ï¼›ç±»InitLoadçš„ä¸»è¦å®ç°æ˜¯å®šæ—¶æ±‡æ€»è®¡ç®—æŒ‡å®šæ—¶é—´æ®µæ•°æ®ã€‚</p><p>ScheduledExecutorService</p><p>åœ¨InitLoadç±»ä¸­æœ‰ä¸€ä¸ªè¿™ä¸ªå®šä¹‰ï¼Œè®©æˆ‘æœ‰äº›ç–‘æƒ‘ï¼Œè¿™ä¸ªçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šæ—¶æ•°æ®åŒæ­¥å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ScheduledExecutorService</span> <span class="variable">periodDataSyncExecutor</span> <span class="operator">=</span> Executors.newSingleThreadScheduledExecutor(</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">NamedThreadFactory</span>(<span class="string">&quot;period-data-sync&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ª<code>ScheduledExecutorService</code> æ¥å£ï¼Œ<code>ScheduledExecutorService</code> æ˜¯ Java ä¸­ç”¨äºè°ƒåº¦æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ¥å£ã€‚</p><p>è¿™é‡Œä½¿ç”¨è¿™ä¸ªæ¥å£æ¥å®Œæˆä¸€ä¸ªJavaåå°çš„å®šæ—¶ä»»åŠ¡ï¼Œä¸€èˆ¬æ¥è¯´å®Œæˆä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ–¹æ¡ˆæœ‰å¦‚ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>JDKè‡ªå¸¦çš„Timer</li><li>JDK1.5+ æ–°å¢çš„ScheduledExecutorService</li><li>Quartz**ï¼š**ç®€å•è€Œå¼ºå¤§çš„JAVAä½œä¸šè°ƒåº¦æ¡†æ¶ï¼Œå¯ä»¥æ”¯æŒåŠ¨æ€çš„Cronè¯­æ³•</li></ul><p>åœ¨æ™ºæ…§åŠ æ²¹ç«™é¡¹ç›®ä¸­ï¼Œé€‰æ‹©äº†ScheduledExecutorServiceæ¥å®Œæˆä¸€ä¸ªå®šæ—¶ç»Ÿè®¡çš„ä»»åŠ¡ã€‚</p><blockquote><p>ScheduledThreadPoolExecutorç»§æ‰¿è‡ªThreadPoolExecutorã€‚å®ƒä¸»è¦ç”¨æ¥åœ¨ç»™å®šçš„å»¶è¿Ÿä¹‹åè¿è¡Œä»»åŠ¡ï¼Œæˆ–è€…å®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚ScheduledThreadPoolExecutorçš„åŠŸèƒ½ä¸Timerç±»ä¼¼ï¼Œä½† ScheduledThreadPoolExecutoråŠŸèƒ½æ›´å¼ºå¤§ã€æ›´çµæ´»ã€‚Timerå¯¹åº”çš„æ˜¯å•ä¸ªåå°çº¿ç¨‹ï¼Œè€Œ ScheduledThreadPoolExecutorå¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­æŒ‡å®šå¤šä¸ªå¯¹åº”çš„åå°çº¿ç¨‹æ•°ã€‚</p></blockquote><p>ScheduledExecutorServiceåŒ…æ‹¬ä¸‰ä¸ªæ–¹æ³•ï¼šschedule()ã€scheduleAtFixedRate()ã€scheduleWithFixedDelay()ã€‚</p><h4 id="schedule"><a href="#schedule" class="headerlink" title="schedule"></a>schedule</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        scheduleTest();</span><br><span class="line">        <span class="comment">//scheduleFixedRate();</span></span><br><span class="line">        <span class="comment">//scheduleWithFixedDelay();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//schedule()çš„ç”¨æ³•,å¯ä»¥å¯¹ä»»åŠ¡è¿›è¡Œå»¶è¿Ÿå¤„ç†</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">scheduleTest</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">cur</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        scheduledExecutorService.schedule(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="comment">//å½“å‰ä»»åŠ¡æ‰§è¡Œæ—¶å€™ï¼Œå¯¹åº”çš„æ—¶é—´</span></span><br><span class="line">                System.out.println(<span class="string">&quot;ç¬¬ä¸€æ¬¡å»¶è¿Ÿäº†&quot;</span>+(System.currentTimeMillis() - cur) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">                <span class="comment">//ä»»åŠ¡æ‰§è¡Œéœ€è¦æ—¶é—´</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">3000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">        scheduledExecutorService.schedule(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="comment">//å½“å‰ä»»åŠ¡æ‰§è¡Œæ—¶å€™ï¼Œå¯¹åº”çš„æ—¶é—´</span></span><br><span class="line">                System.out.println(<span class="string">&quot;ç¬¬äºŒæ¬¡å»¶è¿Ÿäº†&quot;</span>+(System.currentTimeMillis() - cur) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">                <span class="comment">//ä»»åŠ¡æ‰§è¡Œéœ€è¦æ—¶é—´</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">3000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">        scheduledExecutorService.shutdown();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>schedule()æ–¹æ³•ä¸‹éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸€ä¸ªrunnableçº¿ç¨‹ï¼Œå»¶è¿Ÿæ—¶é—´ï¼Œæ—¶é—´å•ä½</p><p>ScheduledExecutorServiceçš„å¼ºå¤§ä¹‹å¤„å°±åœ¨äºå¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­æŒ‡å®šå¤šä¸ªå¯¹åº”çš„åå°çº¿ç¨‹æ•°ï¼Œå¹¶å‘çš„è¿è¡Œå»¶è¿Ÿä»»åŠ¡ã€‚</p><h4 id="scheduleAtFixedRate"><a href="#scheduleAtFixedRate" class="headerlink" title="scheduleAtFixedRate"></a>scheduleAtFixedRate</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//scheduleAtFixedRate()çš„ç”¨æ³•</span></span><br><span class="line">   <span class="comment">//åœ¨scheduleä¸‹ï¼ŒåŠ äº†å‘¨æœŸè¿è¡Œçš„æ¡ä»¶ã€‚</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">scheduleFixedRate</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line">       <span class="comment">//è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">cur</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">       scheduledExecutorService.scheduleAtFixedRate(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">               <span class="comment">//å½“å‰ä»»åŠ¡æ‰§è¡Œæ—¶å€™ï¼Œå¯¹åº”çš„æ—¶é—´</span></span><br><span class="line">               System.out.println(<span class="string">&quot;å»¶è¿Ÿäº†&quot;</span>+(System.currentTimeMillis() - cur) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">               &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,<span class="number">3000</span>,<span class="number">2000</span>,TimeUnit.MILLISECONDS);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”äºschedule()æ–¹æ³•ï¼Œå¤šäº†ä¸€ä¸ªå‚æ•°periodï¼Œå°±æ˜¯å¯ä»¥æŒ‡å®šå‘¨æœŸæ‰§è¡Œã€‚å¦‚ä¸Šä»£ç ï¼Œå‘¨æœŸä¸º2sã€‚å¦‚æœè¿™ä¸ªåŠ å…¥çš„ä»»åŠ¡è¿è¡Œæ—¶é—´è¶…è¿‡äº†åˆšåˆšå®šä¹‰çš„è§„å®šå‘¨æœŸï¼ŒscheduldFixedRateåªè¦åˆ°äº†è§„å®šçš„å‘¨æœŸæ—¶é—´ï¼Œå°±ä¼šé©¬ä¸Šå»æ‰§è¡Œä¸‹ä¸€è½®å›ã€‚</p><h4 id="scheduleWithFixedDelay"><a href="#scheduleWithFixedDelay" class="headerlink" title="scheduleWithFixedDelay"></a>scheduleWithFixedDelay</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//scheduleWithFixedDelay()ç”¨æ³•</span></span><br><span class="line">    <span class="comment">//ä¹Ÿæ˜¯åŠ äº†å‘¨æœŸè¿è¡Œçš„æ¡ä»¶ï¼Œä½†æ˜¯å¿…é¡»æ˜¯ç­‰åˆ°ä¸Šä¸€ä¸ªä»»åŠ¡ç»“æŸåï¼Œè¿›è¡Œå‘¨æœŸå¾ªç¯ã€‚å‘¨æœŸæ—¶é—´å°±æ˜¯ä»»åŠ¡è¿è¡Œæ—¶é—´+delay</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">scheduleWithFixedDelay</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">cur</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        scheduledExecutorService.scheduleWithFixedDelay(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="comment">//å½“å‰ä»»åŠ¡æ‰§è¡Œæ—¶å€™ï¼Œå¯¹åº”çš„æ—¶é—´</span></span><br><span class="line">                System.out.println(<span class="string">&quot;å»¶è¿Ÿäº†&quot;</span>+(System.currentTimeMillis() - cur) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">3000</span>,<span class="number">2000</span>,TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”äºscheduleAtFixedRate()ï¼ŒscheduleWithFixedDelay()æ˜¯æ¯æ¬¡éƒ½è¦æŠŠä»»åŠ¡æ‰§è¡Œå®Œæˆåå†å»¶è¿Ÿå›ºå®šæ—¶é—´åå†æ‰§è¡Œä¸‹ä¸€æ¬¡ã€‚ç»“æœå¦‚ä¸‹ï¼šå‘¨æœŸä¸ºä»»åŠ¡è¿è¡Œæ—¶é—´+delayï¼ˆæŒ‡å®šå‘¨æœŸæ—¶é—´ï¼‰</p><h3 id="initDataSync"><a href="#initDataSync" class="headerlink" title="initDataSync"></a>initDataSync</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initDataSync</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="comment">// åˆå§‹åŒ–ç¼“å­˜ä¸»æ•°æ®</span></span><br><span class="line">   periodRefreshCache();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åˆå§‹åŒ–ç¼“å­˜æŠ¥è­¦è¯­éŸ³é…ç½®</span></span><br><span class="line">   cacheAlarmEventAudioCfg();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åˆ›å»ºå®šæ—¶ä»»åŠ¡</span></span><br><span class="line">   <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">      <span class="comment">// å®šæ—¶åˆ·æ–°ä¸»æ•°æ®åˆ°ç¼“å­˜</span></span><br><span class="line">      periodRefreshCache();</span><br><span class="line"></span><br><span class="line">      <span class="type">DateTime</span> <span class="variable">now</span> <span class="operator">=</span> DateTime.now();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡æ±‡æ€»è®¡ç®—ç«™ç‚¹å†…å¤–è½¦è¾†æ•°é‡</span></span><br><span class="line">      <span class="type">SummarizeStationVehicleStatisticsReqDTO</span> <span class="variable">statisticsReqDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SummarizeStationVehicleStatisticsReqDTO</span>();</span><br><span class="line">      statisticsReqDTO.setStationId(BffSysConstants.DEFAULT_STATION_ID);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         vehicleStEventService.updateStationVehicleSumStatistics(statisticsReqDTO);</span><br><span class="line">      &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡æ±‡æ€»è®¡ç®—ç«™ç‚¹å†…å¤–è½¦è¾†æ•°é‡å¤±è´¥!(&#123;&#125;)&quot;</span>, now, e);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡é¡¾å®¢è¿›ç¦»åº—æ•°æ®</span></span><br><span class="line">      log.info(<span class="string">&quot;æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡é¡¾å®¢è¿›ç¦»åº—æ•°æ®å¼€å§‹(&#123;&#125;)...&quot;</span>, now);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         stShopStatisticsService.periodSaveCustomerSummaryStatistics(<span class="keyword">new</span> <span class="title class_">StShopPeriodInfoDTO</span>());</span><br><span class="line">      &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡é¡¾å®¢è¿›ç¦»åº—æ•°æ®å¤±è´¥!(&#123;&#125;)&quot;</span>, now, e);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å®šæ—¶æ±‡æ€»è®¡ç®—ä¸Šä¸€æ—¶é—´æ®µ(ä¾‹å¦‚:1å°æ—¶,å³ä¸Šä¸€å°æ—¶å†…çš„00:00~59:59)çš„é¡¾å®¢äº‹ä»¶(è¿›ç¦»åº—)æ•°æ®åˆ°æ•°æ®åº“</span></span><br><span class="line">   <span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">   <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">   <span class="type">Date</span> <span class="variable">currentTime</span> <span class="operator">=</span> calendar.getTime();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®¡ç®—ä¸‹ä¸€ä¸ªæ•´ç‚¹çš„æ—¶é—´</span></span><br><span class="line">   calendar.set(Calendar.HOUR_OF_DAY, calendar.get(Calendar.HOUR_OF_DAY) + <span class="number">1</span>);</span><br><span class="line">   calendar.set(Calendar.MINUTE, <span class="number">0</span>);</span><br><span class="line">   calendar.set(Calendar.SECOND, <span class="number">0</span>);</span><br><span class="line">   <span class="type">Date</span> <span class="variable">nextHour</span> <span class="operator">=</span> calendar.getTime();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®¡ç®—ä»å½“å‰æ—¶é—´åˆ°ä¸‹ä¸€ä¸ªæ•´ç‚¹çš„æ—¶é—´é—´éš”</span></span><br><span class="line">   <span class="type">long</span> <span class="variable">delay</span> <span class="operator">=</span> nextHour.getTime() - currentTime.getTime();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å®‰æ’å®šæ—¶ä»»åŠ¡åœ¨ä¸‹ä¸€ä¸ªæ•´ç‚¹æ‰§è¡Œ</span></span><br><span class="line">   periodDataSyncExecutor.scheduleAtFixedRate(task, delay, <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@PostConstruct</code> æ˜¯ Java ä¸­çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨äºæ ‡è®°ä¸€ä¸ªæ–¹æ³•ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•åœ¨å¯¹è±¡è¢«åˆ›å»ºåï¼ˆå³æ„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€æœ‰ä¾èµ–æ³¨å…¥å®Œæˆï¼‰ç«‹å³æ‰§è¡Œï¼Œç›¸å½“äºåˆå§‹åŒ–æ–¹æ³•ã€‚</p><p>è¿™ä¸¤ä¸ªæ–¹æ³•çš„è°ƒç”¨å¦‚æ³¨é‡Šæ‰€è¯´ï¼Œåˆå§‹åŒ–ç¼“å­˜ï¼Œä¿æŒç¼“å­˜çš„ä¸€è‡´æ€§ã€‚ä¸å¯æ›´æ”¹ã€‚å¯¹äºè¿™ä¸¤ä¸ªæ–¹æ³•ä¸€èˆ¬ä¸è¿›è¡Œä¿®æ”¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–ç¼“å­˜ä¸»æ•°æ®</span></span><br><span class="line">   periodRefreshCache();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åˆå§‹åŒ–ç¼“å­˜æŠ¥è­¦è¯­éŸ³é…ç½®</span></span><br><span class="line">   cacheAlarmEventAudioCfg();</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Runnableæ¥å®šä¹‰ä¸€ä¸ªä»»åŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line"><span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œå½“å‰æ—¶é—´ï¼š&quot;</span> + System.currentTimeMillis());</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">   <span class="comment">// å®šæ—¶åˆ·æ–°ä¸»æ•°æ®åˆ°ç¼“å­˜</span></span><br><span class="line">   periodRefreshCache();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">   <span class="type">DateTime</span> <span class="variable">now</span> <span class="operator">=</span> DateTime.now();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡æ±‡æ€»è®¡ç®—ç«™ç‚¹å†…å¤–è½¦è¾†æ•°é‡</span></span><br><span class="line">   <span class="type">SummarizeStationVehicleStatisticsReqDTO</span> <span class="variable">statisticsReqDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SummarizeStationVehicleStatisticsReqDTO</span>();</span><br><span class="line">   statisticsReqDTO.setStationId(BffSysConstants.DEFAULT_STATION_ID);</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      vehicleStEventService.updateStationVehicleSumStatistics(statisticsReqDTO);</span><br><span class="line">   &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">      log.error(<span class="string">&quot;æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡æ±‡æ€»è®¡ç®—ç«™ç‚¹å†…å¤–è½¦è¾†æ•°é‡å¤±è´¥!(&#123;&#125;)&quot;</span>, now, e);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡é¡¾å®¢è¿›ç¦»åº—æ•°æ®</span></span><br><span class="line">   log.info(<span class="string">&quot;æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡é¡¾å®¢è¿›ç¦»åº—æ•°æ®å¼€å§‹(&#123;&#125;)...&quot;</span>, now);</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      stShopStatisticsService.periodSaveCustomerSummaryStatistics(<span class="keyword">new</span> <span class="title class_">StShopPeriodInfoDTO</span>());</span><br><span class="line">   &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">      log.error(<span class="string">&quot;æ¯ä¸ªæ•´ç‚¹æ‰§è¡Œç»Ÿè®¡é¡¾å®¢è¿›ç¦»åº—æ•°æ®å¤±è´¥!(&#123;&#125;)&quot;</span>, now, e);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å› ä¸ºéœ€è¦å®šæœŸæ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œæ‰€ä»¥åœ¨å®šæ—¶ä»»åŠ¡é‡Œä¹Ÿéœ€è¦å®šæ—¶æ›´æ–°ç¼“å­˜æ•°æ®ã€‚</p><p>SummarizeStationVehicleStatisticsReqDTOç±»å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SummarizeStationVehicleStatisticsReqDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç«™ç‚¹ID</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> Long stationId;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç»Ÿè®¡å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="comment">    * å°†ä»¥æ•´ç‚¹å¼€å§‹(00:00)æ±‡æ€»è®¡ç®—</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> LocalDateTime statisticStartTime;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç»Ÿè®¡ç»“æŸæ—¶é—´</span></span><br><span class="line"><span class="comment">    * å°†ä»¥æ•´ç‚¹ç»“æŸ(59:59)æ±‡æ€»è®¡ç®—</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> LocalDateTime statisticEndTime;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è¿›ç«™è½¦è¾†æ•°é‡</span></span><br><span class="line"><span class="comment">    * é»˜è®¤è®¡ç®—æ›´æ–°,ä»…æ‰‹åŠ¨è°ƒæ•´æ—¶ä¼ å‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> Long innerVehicleNum;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç«™å¤–è½¦è¾†æ•°é‡</span></span><br><span class="line"><span class="comment">    * é»˜è®¤è®¡ç®—æ›´æ–°,ä»…æ‰‹åŠ¨è°ƒæ•´æ—¶ä¼ å‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> Long outerVehicleNum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å³éœ€è¦æˆ‘ä»¬è¿›è¡Œç»Ÿè®¡çš„ä¿¡æ¯ã€‚</p><p>ç„¶åè¿™é‡Œè°ƒç”¨äº†updateStationVehicleSumStatisticsæ–¹æ³•ï¼Œæ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„å®ç°é€»è¾‘ã€‚</p><h3 id="updateStationVehicleSumStatistics"><a href="#updateStationVehicleSumStatistics" class="headerlink" title="updateStationVehicleSumStatistics"></a>updateStationVehicleSumStatistics</h3><p>è¿™ä¸ªæ–¹æ³•å®Œæˆçš„æ˜¯å®šæ—¶æ›´æ–°ç«™å†…å¤–è½¦è¾†æ±‡æ€»ç»Ÿè®¡æ•°æ®ã€‚</p><p>è¿™ä¸ªæ–¹æ³•è¢«@Transactionalæ³¨è§£ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªäº‹ç‰©ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"><span class="keyword">if</span>(reqDTO.getStatisticStartTime() == <span class="literal">null</span> || reqDTO.getStatisticEndTime() == <span class="literal">null</span>) &#123;</span><br><span class="line">   <span class="type">LocalDateTime</span> <span class="variable">currentHourTime</span> <span class="operator">=</span> now.withMinute(<span class="number">0</span>).withSecond(<span class="number">0</span>).withNano(<span class="number">0</span>);</span><br><span class="line">   reqDTO.setStatisticStartTime(LocalDateTimeUtil.offset(currentHourTime, -<span class="number">1</span>, ChronoUnit.HOURS));</span><br><span class="line">   reqDTO.setStatisticEndTime(LocalDateTimeUtil.offset(currentHourTime, -<span class="number">1</span>, ChronoUnit.SECONDS));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ol><li><code>LocalDateTime currentHourTime = now.withMinute(0).withSecond(0).withNano(0);</code></li><li>è¿™ä¸€è¡Œä»£ç é¦–å…ˆè·å–äº†å½“å‰çš„æ—¶é—´ <code>now</code>ï¼Œç„¶åé€šè¿‡ <code>withMinute(0)</code> æ–¹æ³•å°†å½“å‰åˆ†é’Ÿæ•°ç½®ä¸ºé›¶ï¼Œé€šè¿‡ <code>withSecond(0)</code> æ–¹æ³•å°†ç§’æ•°ç½®ä¸ºé›¶ï¼Œé€šè¿‡ <code>withNano(0)</code> æ–¹æ³•å°†çº³ç§’æ•°ç½®ä¸ºé›¶ã€‚è¿™æ ·å°±å°†å½“å‰æ—¶é—´è°ƒæ•´ä¸ºå½“å‰å°æ—¶çš„å¼€å§‹æ—¶é—´ï¼Œå³å½“å‰å°æ—¶çš„æ•´ç‚¹å¼€å§‹æ—¶é—´ã€‚</li><li><code>reqDTO.setStatisticStartTime(LocalDateTimeUtil.offset(currentHourTime, -1, ChronoUnit.HOURS));</code></li><li>è¿™ä¸€è¡Œä»£ç å°†ç»Ÿè®¡çš„å¼€å§‹æ—¶é—´è®¾ç½®ä¸ºå½“å‰å°æ—¶çš„å‰ä¸€å°æ—¶ã€‚å®ƒä½¿ç”¨äº†ä¸€ä¸ª <code>LocalDateTimeUtil</code> å·¥å…·ç±»çš„ <code>offset</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šåŸå§‹æ—¶é—´ï¼ˆ<code>currentHourTime</code>ï¼‰ï¼Œåç§»é‡ï¼ˆ-1ï¼‰ï¼Œå’Œæ—¶é—´å•ä½ï¼ˆ<code>ChronoUnit.HOURS</code>ï¼‰ã€‚è¿™æ ·å°±å°†å½“å‰å°æ—¶çš„å¼€å§‹æ—¶é—´å¾€å‰æ¨ä¸€å°æ—¶ï¼Œå¾—åˆ°äº†ç»Ÿè®¡çš„å¼€å§‹æ—¶é—´ã€‚</li><li><code>reqDTO.setStatisticEndTime(LocalDateTimeUtil.offset(currentHourTime, -1, ChronoUnit.SECONDS));</code></li><li>è¿™ä¸€è¡Œä»£ç å°†ç»Ÿè®¡çš„ç»“æŸæ—¶é—´è®¾ç½®ä¸ºå½“å‰å°æ—¶çš„å¼€å§‹æ—¶é—´å‡å»ä¸€ç§’é’Ÿã€‚åŒæ ·ä½¿ç”¨äº† <code>LocalDateTimeUtil</code> å·¥å…·ç±»çš„ <code>offset</code> æ–¹æ³•ï¼Œå°†å½“å‰å°æ—¶çš„å¼€å§‹æ—¶é—´å¾€å‰æ¨ä¸€ç§’é’Ÿï¼Œå¾—åˆ°äº†ç»Ÿè®¡çš„ç»“æŸæ—¶é—´ã€‚</li></ol></blockquote><p>æ³¨æ„å½“å‰æ—¶é—´æ˜¯è¦ç»Ÿè®¡å‰ä¸€ä¸ªå°æ—¶çš„è½¦è¾†æ•°æ®ï¼Œæ¯”å¦‚è¯´ç°åœ¨åœ¨10:12ï¼Œåˆ™éœ€è¦ç»Ÿè®¡çš„æ˜¯9ï¼š00~9ï¼š59çš„æ‰€æœ‰è½¦è¾†æ•°æ®ã€‚</p><p>åé¢çš„ä»£ç é€»è¾‘å°±æ˜¯ç»Ÿè®¡ç«™å†…å¤–çš„è½¦è¾†ï¼Œæš‚ä¸è¿›è¡Œè§£é‡Šã€‚</p><h2 id="æœºåœºé¡¹ç›®ä¸šåŠ¡å®šæ—¶ä»»åŠ¡"><a href="#æœºåœºé¡¹ç›®ä¸šåŠ¡å®šæ—¶ä»»åŠ¡" class="headerlink" title="æœºåœºé¡¹ç›®ä¸šåŠ¡å®šæ—¶ä»»åŠ¡"></a>æœºåœºé¡¹ç›®ä¸šåŠ¡å®šæ—¶ä»»åŠ¡</h2><p>åˆæ­¥æ–¹æ¡ˆï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262041746.jpeg" alt="img"></p><h2 id="Javaæ·±æ‹·è´-æµ…æ‹·è´"><a href="#Javaæ·±æ‹·è´-æµ…æ‹·è´" class="headerlink" title="Javaæ·±æ‹·è´ &amp; æµ…æ‹·è´"></a>Javaæ·±æ‹·è´ &amp; æµ…æ‹·è´</h2><h3 id="æµ…æ‹·è´"><a href="#æµ…æ‹·è´" class="headerlink" title="æµ…æ‹·è´"></a>æµ…æ‹·è´</h3><p>â€‹æµ…æ‹·è´åˆç§°ä¸ºæµ…å¤åˆ¶ï¼Œæµ…å…‹éš†ï¼Œæµ…æ‹·è´æ˜¯æŒ‡æ‹·è´æ—¶åªæ‹·è´å¯¹è±¡æœ¬èº«ï¼ˆåŒ…æ‹¬å¯¹è±¡ä¸­çš„åŸºæœ¬å˜é‡ï¼‰ï¼Œ<strong>è€Œä¸æ‹·è´å¯¹è±¡åŒ…å«çš„å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡</strong>ï¼Œæ‹·è´å‡ºæ¥çš„å¯¹è±¡çš„æ‰€æœ‰å˜é‡çš„å€¼éƒ½å«æœ‰ä¸åŸæ¥å¯¹è±¡ç›¸åŒçš„å€¼ï¼Œè€Œæ‰€æœ‰å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨éƒ½æŒ‡å‘åŸæ¥çš„å¯¹è±¡ï¼Œç®€å•åœ°è¯´ï¼Œ<strong>æµ…æ‹·è´åªæ‹·è´å¯¹è±¡ä¸æ‹·è´å¼•ç”¨</strong>ã€‚</p><h4 id="SpringFrameWork-BeanUtils"><a href="#SpringFrameWork-BeanUtils" class="headerlink" title="SpringFrameWork BeanUtils"></a>SpringFrameWork BeanUtils</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanUtils.copyProperties(å½“å‰å¯¹è±¡ï¼Œéœ€è¦å¤åˆ¶åˆ°çš„å¯¹è±¡);</span><br></pre></td></tr></table></figure><h3 id="æ·±æ‹·è´"><a href="#æ·±æ‹·è´" class="headerlink" title="æ·±æ‹·è´"></a>æ·±æ‹·è´</h3><p>â€‹æ·±æ‹·è´åˆç§°ä¸ºæ·±å¤åˆ¶ï¼Œæ·±å…‹éš†ï¼Œ<strong>æ·±æ‹·è´ä¸ä»…æ‹·è´å¯¹è±¡æœ¬èº«ï¼Œè€Œä¸”è¿˜æ‹·è´å¯¹è±¡åŒ…å«çš„å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡</strong>ï¼Œæ‹·è´å‡ºæ¥çš„å¯¹è±¡çš„æ‰€æœ‰å˜é‡ï¼ˆä¸åŒ…å«é‚£äº›å¼•ç”¨å…¶ä»–å¯¹è±¡çš„å˜é‡ï¼‰çš„å€¼éƒ½å«æœ‰ä¸åŸæ¥å¯¹è±¡çš„ç›¸åŒçš„å€¼ï¼Œé‚£äº›å¼•ç”¨å…¶ä»–å¯¹è±¡çš„å˜é‡å°†æŒ‡å‘æ–°å¤åˆ¶å‡ºæ¥çš„æ–°å¯¹è±¡ï¼Œè€Œä¸æŒ‡å‘åŸæ¥çš„å¯¹è±¡ï¼Œç®€å•åœ°è¯´ï¼Œ<strong>æ·±æ‹·è´ä¸ä»…æ‹·è´å¯¹è±¡ï¼Œè€Œä¸”è¿˜æ‹·è´å¯¹è±¡åŒ…å«çš„å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚</strong></p><h4 id="DozerMapperUtil"><a href="#DozerMapperUtil" class="headerlink" title="DozerMapperUtil"></a>DozerMapperUtil</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> DozerMapperUtil.map(<span class="built_in">this</span>,MetaDsPropPO.class);</span><br></pre></td></tr></table></figure><h3 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262041900.jpg" alt="img_v3_02c6_afd29d78-68dd-42a6-a60b-e69de94cca4g"></p><h2 id="Javaå…³é”®å­—Synchronized"><a href="#Javaå…³é”®å­—Synchronized" class="headerlink" title="Javaå…³é”®å­—Synchronized"></a>Javaå…³é”®å­—Synchronized</h2><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/qq_43843951/article/details/129107202?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171946737316800226522103%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171946737316800226522103&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-129107202-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=synchronized&spm=1018.2226.3001.4187">ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘- synchronizedé”çš„è®¤çŸ¥</a></li></ol><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Synchronized ã€&#x2F;ËˆsÉªÅ‹krÉ™naÉªzd&#x2F;ã€‘æ˜¯ Java è¯­è¨€çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå®ƒå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«çš„èµ„æºï¼Œ<strong>ä»¥é¿å…å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„ç«äº‰æ¡ä»¶å’Œæ­»é”é—®é¢˜</strong>ã€‚synchronizedå¯ä»¥ç”¨æ¥ç»™å¯¹è±¡æˆ–è€…æ–¹æ³•è¿›è¡ŒåŠ é”ï¼Œå½“å¯¹æŸä¸ªå¯¹è±¡æˆ–è€…ä»£ç å—åŠ é”æ—¶ï¼Œ<strong>åŒæ—¶å°±åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œ</strong>ã€‚è¿™ç§å°±æ˜¯äº’æ–¥å…³ç³»ï¼Œè¢«åŠ é”çš„åŒºåŸŸç§°ä¸ºä¸´ç•ŒåŒºï¼Œè€Œé‡Œé¢çš„èµ„æºå°±æ˜¯ä¸´ç•Œèµ„æºã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºçš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±å¿…é¡»ç­‰å¾…ã€‚</p><h4 id="1ã€é€šè¿‡å¯¹è±¡è¿›è¡Œé”"><a href="#1ã€é€šè¿‡å¯¹è±¡è¿›è¡Œé”" class="headerlink" title="1ã€é€šè¿‡å¯¹è±¡è¿›è¡Œé”"></a>1ã€é€šè¿‡å¯¹è±¡è¿›è¡Œé”</h4><p>åœ¨ä»£ç é‡Œï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ ·è¦æƒ³æ‹¿åˆ°ä¸´ç•Œèµ„æºï¼Œå°±å¿…é¡»å…ˆè·å¾—åˆ°è¿™ä¸ªå¯¹è±¡çš„é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">T1_Synchronized01</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">m1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (o) &#123; <span class="comment">// å¿…é¡»å…ˆæ‹¿åˆ°oè¿™ä¸ªé”</span></span><br><span class="line">            count++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; count = &quot;</span> + count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2ã€é€šè¿‡this"><a href="#2ã€é€šè¿‡this" class="headerlink" title="2ã€é€šè¿‡this"></a>2ã€é€šè¿‡this</h4><p>ä½¿ç”¨thisä»£è¡¨é”ä½çš„æ˜¯å½“å‰å¯¹è±¡ï¼Œè¿™ç§æ–¹æ³•ç­‰åŒç›´æ¥æŠŠsynchronizedå…³é”®å­—åŠ åœ¨æ–¹æ³•å‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">T1_Synchronized01</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">m2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123; <span class="comment">// å¿…é¡»å…ˆæ‹¿åˆ°thisçš„é”</span></span><br><span class="line">            count++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; count = &quot;</span> + count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">m3</span><span class="params">()</span> &#123; <span class="comment">// ä¸m2ä¸€æ ·</span></span><br><span class="line">        count++;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; count = &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3ã€é”å®šé™æ€æ–¹æ³•"><a href="#3ã€é”å®šé™æ€æ–¹æ³•" class="headerlink" title="3ã€é”å®šé™æ€æ–¹æ³•"></a>3ã€é”å®šé™æ€æ–¹æ³•</h4><p>é”å®šé™æ€æ–¹æ³•éœ€è¦é€šè¿‡ç±».classï¼Œæˆ–è€…ç›´æ¥åœ¨é™æ€æ–¹æ³•ä¸ŠåŠ ä¸Šå…³é”®å­—ã€‚ä½†æ˜¯ï¼Œç±».classä¸èƒ½ä½¿ç”¨thisæ¥ä»£æ›¿ã€‚æ³¨ï¼šåœ¨åŒä¸€ä¸ªç±»åŠ è½½å™¨ä¸­ï¼Œclassæ˜¯å•ä¾‹çš„ï¼Œè¿™ä¹Ÿå°±èƒ½ä¿è¯synchronizedèƒ½å¤Ÿåªè®©ä¸€ä¸ªçº¿ç¨‹è®¿é—®ä¸´ç•Œèµ„æºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">T1_Synchronized01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m4</span><span class="params">()</span> &#123; <span class="comment">// é™æ€æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">synchronized</span> (T1_Synchronized01.class) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m5</span><span class="params">()</span> &#123;</span><br><span class="line">       System.out.println(Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>A. æ— è®ºsynchronizedå…³é”®å­—åŠ åœ¨æ–¹æ³•ä¸Šè¿˜æ˜¯å¯¹è±¡ä¸Šï¼Œå¦‚æœå®ƒä½œç”¨çš„å¯¹è±¡æ˜¯éé™æ€çš„ï¼Œåˆ™å®ƒå–å¾—çš„é”æ˜¯å¯¹è±¡ï¼›å¦‚æœsynchronizedä½œç”¨çš„å¯¹è±¡æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•æˆ–ä¸€ä¸ªç±»ï¼Œåˆ™å®ƒå–å¾—çš„é”æ˜¯å¯¹ç±»ï¼Œè¯¥ç±»æ‰€æœ‰çš„å¯¹è±¡åŒä¸€æŠŠé”ã€‚ </li><li>B. æ¯ä¸ªå¯¹è±¡åªæœ‰ä¸€ä¸ªé”ï¼ˆlockï¼‰ä¸ä¹‹ç›¸å…³è”ï¼Œè°æ‹¿åˆ°è¿™ä¸ªé”è°å°±å¯ä»¥è¿è¡Œå®ƒæ‰€æ§åˆ¶çš„é‚£æ®µä»£ç ã€‚ </li><li>C. å®ç°åŒæ­¥æ˜¯è¦å¾ˆå¤§çš„ç³»ç»Ÿå¼€é”€ä½œä¸ºä»£ä»·çš„ï¼Œç”šè‡³å¯èƒ½é€ æˆæ­»é”ï¼Œæ‰€ä»¥å°½é‡é¿å…æ— è°“çš„åŒæ­¥æ§åˆ¶ã€‚</li></ul><h2 id="JavaåŸºç¡€"><a href="#JavaåŸºç¡€" class="headerlink" title="JavaåŸºç¡€"></a>JavaåŸºç¡€</h2><h3 id="JVM-vs-JDK-vs-JRE"><a href="#JVM-vs-JDK-vs-JRE" class="headerlink" title="JVM vs JDK vs JRE"></a>JVM vs JDK vs JRE</h3><blockquote><p>JVM (Java Virtual Machine)ã€JDK (Java Development Kit)ã€JRE (Java Runtime Environment) æ˜¯ Java å¼€å‘ä¸è¿è¡Œç¯å¢ƒä¸­çš„ä¸‰ä¸ªé‡è¦æ¦‚å¿µã€‚ç†è§£å®ƒä»¬æœ‰åŠ©äºå…¨é¢æŒæ¡ Java ç”Ÿæ€ç³»ç»Ÿã€‚ä¸‹é¢å°†è¯¦ç»†è§£é‡Šæ¯ä¸ªæ¦‚å¿µï¼Œå¹¶æŒ‡å‡ºå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</p><h3 id="1-JVM-Java-Virtual-Machine-Java-è™šæ‹Ÿæœº"><a href="#1-JVM-Java-Virtual-Machine-Java-è™šæ‹Ÿæœº" class="headerlink" title="1. JVM (Java Virtual Machine) - Java è™šæ‹Ÿæœº"></a>1. JVM (Java Virtual Machine) - Java è™šæ‹Ÿæœº</h3><p><strong>JVM æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>JVM æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œè´Ÿè´£å°†ç¼–è¯‘åçš„ Java å­—èŠ‚ç ï¼ˆ<code>.class</code> æ–‡ä»¶ï¼‰è½¬æ¢ä¸ºæœºå™¨ç ï¼Œå¹¶åœ¨ç‰¹å®šå¹³å°ä¸Šè¿è¡Œã€‚è¿™ä½¿å¾— Java å…·æœ‰â€œå¹³å°æ— å…³æ€§â€çš„ç‰¹æ€§ï¼Œå³â€œå†™ä¸€æ¬¡ï¼Œè¿è¡Œåˆ°å¤„â€ï¼ˆWrite Once, Run Anywhereï¼‰ã€‚</li></ul><p><strong>JVM çš„ä¸»è¦åŠŸèƒ½ï¼š</strong></p><ul><li><strong>åŠ è½½å­—èŠ‚ç </strong>ï¼šJVM è´Ÿè´£ä» <code>.class</code> æ–‡ä»¶ä¸­åŠ è½½å­—èŠ‚ç ã€‚</li><li><strong>å­—èŠ‚ç è§£é‡Šä¸æ‰§è¡Œ</strong>ï¼šå°†å­—èŠ‚ç è§£é‡Šä¸ºæœºå™¨ç ï¼Œæˆ–é€šè¿‡å³æ—¶ç¼–è¯‘ (JIT) å°†å…¶ç›´æ¥ç¼–è¯‘ä¸ºæœºå™¨ç æ‰§è¡Œã€‚</li><li><strong>å†…å­˜ç®¡ç†</strong>ï¼šJVM ç®¡ç† Java åº”ç”¨çš„å†…å­˜ï¼ˆä¾‹å¦‚å †ã€æ ˆã€æ–¹æ³•åŒºç­‰ï¼‰ã€‚</li><li><strong>åƒåœ¾å›æ”¶ (Garbage Collection)</strong>ï¼šè‡ªåŠ¨æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li><li><strong>çº¿ç¨‹ç®¡ç†</strong>ï¼šJVM ä¹Ÿè´Ÿè´£ç®¡ç† Java ä¸­çš„å¤šçº¿ç¨‹æ“ä½œã€‚</li></ul><p><strong>JVM ä¸åŒ…æ‹¬ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>å®ƒä¸åŒ…æ‹¬ç¼–è¯‘å·¥å…·å’Œå¼€å‘å·¥å…·ï¼Œå•çº¯æ˜¯æ‰§è¡Œ Java å­—èŠ‚ç çš„ç¯å¢ƒã€‚</li></ul><h3 id="2-JDK-Java-Development-Kit-Java-å¼€å‘å·¥å…·åŒ…"><a href="#2-JDK-Java-Development-Kit-Java-å¼€å‘å·¥å…·åŒ…" class="headerlink" title="2. JDK (Java Development Kit) - Java å¼€å‘å·¥å…·åŒ…"></a>2. JDK (Java Development Kit) - Java å¼€å‘å·¥å…·åŒ…</h3><p><strong>JDK æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>JDK æ˜¯ Java å¼€å‘è€…çš„å·¥å…·åŒ…ï¼ŒåŒ…å«äº†å¼€å‘ Java åº”ç”¨æ‰€éœ€çš„ä¸€åˆ‡ã€‚å®ƒåŒ…æ‹¬ JREã€ç¼–è¯‘å™¨ (<code>javac</code>)ã€è°ƒè¯•å·¥å…·ã€æ–‡æ¡£ç”Ÿæˆå™¨ç­‰ã€‚</li></ul><p><strong>JDK çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š</strong></p><ol><li><strong>JRE (Java Runtime Environment)</strong>ï¼šç”¨äºè¿è¡Œ Java åº”ç”¨ï¼ŒåŒ…å« JVM å’Œ Java æ ‡å‡†åº“ã€‚</li><li><strong>ç¼–è¯‘å™¨ (<code>javac</code>)</strong>ï¼šå°† Java æºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç ã€‚</li><li><strong>è°ƒè¯•å·¥å…·</strong>ï¼šå¦‚ <code>jdb</code>ï¼Œç”¨äºè°ƒè¯• Java ç¨‹åºã€‚</li><li><strong>æ–‡æ¡£å·¥å…· (<code>javadoc</code>)</strong>ï¼šç”Ÿæˆ Java API æ–‡æ¡£ã€‚</li><li><strong>æ‰“åŒ…å·¥å…· (<code>jar</code>)</strong>ï¼šç”¨äºå°† Java åº”ç”¨ç¨‹åºæ‰“åŒ…æˆ <code>.jar</code> æ–‡ä»¶ã€‚</li></ol><p><strong>JDK çš„ç”¨é€”ï¼š</strong></p><ul><li>JDK æä¾›äº†æ‰€æœ‰å¼€å‘ Java åº”ç”¨ç¨‹åºæ‰€éœ€çš„å·¥å…·ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JDK ç¼–å†™ã€ç¼–è¯‘ã€è°ƒè¯•å’Œè¿è¡Œ Java ä»£ç ã€‚</li></ul><h3 id="3-JRE-Java-Runtime-Environment-Java-è¿è¡Œæ—¶ç¯å¢ƒ"><a href="#3-JRE-Java-Runtime-Environment-Java-è¿è¡Œæ—¶ç¯å¢ƒ" class="headerlink" title="3. JRE (Java Runtime Environment) - Java è¿è¡Œæ—¶ç¯å¢ƒ"></a>3. JRE (Java Runtime Environment) - Java è¿è¡Œæ—¶ç¯å¢ƒ</h3><p><strong>JRE æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>JRE æ˜¯è¿è¡Œ Java åº”ç”¨çš„ç¯å¢ƒã€‚å®ƒåŒ…å« JVM ä»¥åŠ Java çš„ç±»åº“å’Œå…¶ä»–æ”¯æŒæ–‡ä»¶ã€‚JRE æ˜¯ç”¨æˆ·è¿è¡Œ Java åº”ç”¨æ—¶æ‰€éœ€çš„ç¯å¢ƒï¼Œè€Œä¸æ˜¯å¼€å‘è€…å†™ Java ç¨‹åºæ‰€éœ€çš„å·¥å…·åŒ…ã€‚</li></ul><p><strong>JRE çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š</strong></p><ol><li><strong>JVM</strong>ï¼šè´Ÿè´£æ‰§è¡Œ Java å­—èŠ‚ç ã€‚</li><li><strong>Java æ ‡å‡†åº“ï¼ˆç±»åº“ï¼‰</strong>ï¼šå¦‚ <code>java.lang</code>ã€<code>java.util</code>ã€<code>java.io</code> ç­‰ï¼Œæä¾›äº† Java ç¨‹åºå¸¸ç”¨çš„ API å’ŒåŠŸèƒ½ã€‚</li><li><strong>å…¶ä»–è¿è¡Œæ—¶æ”¯æŒæ–‡ä»¶</strong>ï¼šåŒ…æ‹¬æ”¯æŒè¿è¡Œ Java åº”ç”¨ç¨‹åºçš„èµ„æºæ–‡ä»¶ç­‰ã€‚</li></ol><p><strong>JRE çš„ç”¨é€”ï¼š</strong></p><ul><li>JRE æ˜¯ç”¨æˆ·è¿è¡Œå·²ç»ç¼–è¯‘å¥½çš„ Java ç¨‹åºæ‰€éœ€çš„æœ€ä½ç¯å¢ƒï¼Œå®ƒä¸åŒ…æ‹¬å¼€å‘å·¥å…·ã€‚å¯¹äºéå¼€å‘è€…ï¼Œåªè¦æœ‰ JREï¼Œå°±å¯ä»¥è¿è¡Œ Java åº”ç”¨ã€‚</li></ul><h3 id="å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«"><a href="#å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«"></a>å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«</h3><table><thead><tr><th>é¡¹ç›®</th><th>JVM</th><th>JDK</th><th>JRE</th></tr></thead><tbody><tr><td><strong>å®šä¹‰</strong></td><td>Java è™šæ‹Ÿæœºï¼Œç”¨äºæ‰§è¡Œå­—èŠ‚ç </td><td>Java å¼€å‘å·¥å…·åŒ…ï¼ŒåŒ…å«ç¼–è¯‘å™¨ã€è°ƒè¯•å™¨ç­‰</td><td>Java è¿è¡Œæ—¶ç¯å¢ƒï¼Œç”¨äºè¿è¡Œ Java ç¨‹åº</td></tr><tr><td><strong>åŒ…å«å†…å®¹</strong></td><td>ä»… JVM</td><td>åŒ…å« JRE å’Œå¼€å‘å·¥å…·</td><td>JVM å’Œ Java æ ‡å‡†ç±»åº“</td></tr><tr><td><strong>ç”¨é€”</strong></td><td>æ‰§è¡Œ Java ç¨‹åº</td><td>å¼€å‘ Java ç¨‹åº</td><td>è¿è¡Œ Java ç¨‹åº</td></tr><tr><td><strong>å¼€å‘å·¥å…·</strong></td><td>ä¸åŒ…å«</td><td>åŒ…å«ç¼–è¯‘å™¨ç­‰</td><td>ä¸åŒ…å«</td></tr><tr><td><strong>é€‚ç”¨å¯¹è±¡</strong></td><td>ç”¨äºè¿è¡Œå­—èŠ‚ç </td><td>ç”¨äºå¼€å‘è€…ç¼–å†™ã€ç¼–è¯‘å’Œè°ƒè¯•ç¨‹åº</td><td>ç”¨äºæœ€ç»ˆç”¨æˆ·è¿è¡Œ Java åº”ç”¨</td></tr></tbody></table><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>JVM</strong> æ˜¯ Java çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£å°† Java å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ï¼Œå¹¶åœ¨ç‰¹å®šå¹³å°ä¸Šè¿è¡Œã€‚</li><li><strong>JRE</strong> åŒ…å« JVM ä»¥åŠ Java æ ‡å‡†åº“ï¼Œç”¨æˆ·åªéœ€è¦å®‰è£… JRE å°±å¯ä»¥è¿è¡Œ Java ç¨‹åºã€‚</li><li><strong>JDK</strong> æ˜¯å¼€å‘è€…çš„å·¥å…·åŒ…ï¼Œå®ƒåŒ…å« JRE å’Œç”¨äºå¼€å‘ Java åº”ç”¨çš„å·¥å…·ï¼Œå¦‚ç¼–è¯‘å™¨å’Œè°ƒè¯•å·¥å…·ã€‚</li></ul><p>æ€»ä¹‹ï¼Œ<strong>JVM</strong> æ˜¯è¿è¡Œæ—¶çš„æ ¸å¿ƒï¼Œ<strong>JRE</strong> æ˜¯ JVM çš„è¿è¡Œç¯å¢ƒï¼Œè€Œ <strong>JDK</strong> åˆ™æ˜¯åŒ…å« JRE å’Œå¼€å‘å·¥å…·çš„å®Œæ•´å¼€å‘å¥—ä»¶ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262041058.png" alt="image-20240911130110035"></p><p>æœ‰äº›â½…æ³•å’Œä»£ç å—æ˜¯ç»å¸¸éœ€è¦ è¢«è°ƒâ½¤çš„(ä¹Ÿå°±æ˜¯æ‰€è°“çš„çƒ­ç‚¹ä»£ç )ï¼Œæ‰€ä»¥åâ¾¯å¼•è¿›äº† JITï¼ˆjust-in-time compilationï¼‰ ç¼–è¯‘å™¨ï¼Œâ½½ JIT å±äºè¿â¾æ—¶ç¼–è¯‘ã€‚å½“ JIT ç¼–è¯‘å™¨å®Œæˆç¬¬â¼€æ¬¡ç¼–è¯‘åï¼Œå…¶ä¼šå°†å­—èŠ‚ç å¯¹åº”çš„æœºå™¨ç ä¿å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡å¯ä»¥ ç›´æ¥ä½¿â½¤ã€‚â½½æˆ‘ä»¬çŸ¥é“ï¼Œæœºå™¨ç çš„è¿â¾æ•ˆç‡è‚¯å®šæ˜¯â¾¼äº Java è§£é‡Šå™¨çš„ã€‚è¿™ä¹Ÿè§£é‡Šäº†æˆ‘ä»¬ä¸ºä»€ä¹ˆç»å¸¸ ä¼šè¯´ Java æ˜¯ç¼–è¯‘ä¸è§£é‡Šå…±å­˜çš„è¯­â¾” ã€‚</p><blockquote><p>HotSpot é‡‡â½¤äº†æƒ°æ€§è¯„ä¼°(Lazy Evaluation)çš„åšæ³•ï¼Œæ ¹æ®â¼†â¼‹å®šå¾‹ï¼Œæ¶ˆè€—â¼¤éƒ¨åˆ†ç³»ç»Ÿèµ„æºçš„åªæœ‰ é‚£â¼€â¼©éƒ¨åˆ†çš„ä»£ç ï¼ˆçƒ­ç‚¹ä»£ç ï¼‰ï¼Œâ½½è¿™ä¹Ÿå°±æ˜¯ JIT æ‰€éœ€è¦ç¼–è¯‘çš„éƒ¨åˆ†ã€‚JVM ä¼šæ ¹æ®ä»£ç æ¯æ¬¡è¢« æ‰§â¾çš„æƒ…å†µæ”¶é›†ä¿¡æ¯å¹¶ç›¸åº”åœ°åšå‡ºâ¼€äº›ä¼˜åŒ–ï¼Œå› æ­¤æ‰§â¾çš„æ¬¡æ•°è¶Šå¤šï¼Œå®ƒçš„é€Ÿåº¦å°±è¶Šå¿«ã€‚JDK 9 å¼•â¼Šäº†â¼€ç§æ–°çš„ç¼–è¯‘æ¨¡å¼ AOT(Ahead of Time Compilation)ï¼Œå®ƒæ˜¯ç›´æ¥å°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ ç ï¼Œè¿™æ ·å°±é¿å…äº† JIT é¢„çƒ­ç­‰å„â½…â¾¯çš„å¼€é”€ã€‚JDK â½€æŒåˆ†å±‚ç¼–è¯‘å’Œ AOT åä½œä½¿â½¤</p></blockquote><h3 id="ä¸ºä»€ä¹ˆé‡å†™-equals-æ—¶å¿…é¡»é‡å†™-hashCode-â½…æ³•ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé‡å†™-equals-æ—¶å¿…é¡»é‡å†™-hashCode-â½…æ³•ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé‡å†™ equals() æ—¶å¿…é¡»é‡å†™ hashCode() â½…æ³•ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé‡å†™ equals() æ—¶å¿…é¡»é‡å†™ hashCode() â½…æ³•ï¼Ÿ</h3><blockquote><p>ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆé‡å†™äº† <code>equals()</code> ä¹‹åä¹Ÿéœ€è¦é‡å†™ <code>hashCode()</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ã€‚</p><h3 id="ä¾‹å­èƒŒæ™¯ï¼šæ¯”è¾ƒå’Œå­˜å‚¨å­¦ç”Ÿä¿¡æ¯"><a href="#ä¾‹å­èƒŒæ™¯ï¼šæ¯”è¾ƒå’Œå­˜å‚¨å­¦ç”Ÿä¿¡æ¯" class="headerlink" title="ä¾‹å­èƒŒæ™¯ï¼šæ¯”è¾ƒå’Œå­˜å‚¨å­¦ç”Ÿä¿¡æ¯"></a>ä¾‹å­èƒŒæ™¯ï¼šæ¯”è¾ƒå’Œå­˜å‚¨å­¦ç”Ÿä¿¡æ¯</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>Student</code> ç±»ï¼Œè¡¨ç¤ºå­¦ç”Ÿçš„åŸºæœ¬ä¿¡æ¯ã€‚æˆ‘ä»¬éœ€è¦å¯¹è¿™äº›å­¦ç”Ÿå¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ç¡®ä¿ä¸èƒ½æ·»åŠ é‡å¤çš„å­¦ç”Ÿï¼Œå¹¶ä¸”æƒ³æŠŠå®ƒä»¬å­˜å‚¨åœ¨é›†åˆä¸­ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é‡å†™äº† <code>equals()</code> æ–¹æ³•ï¼Œä»¥ç¡®ä¿å½“ä¸¤ä¸ª <code>Student</code> å¯¹è±¡çš„åå­—å’Œå­¦å·ç›¸åŒæ—¶ï¼Œå®ƒä»¬è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ã€‚</p><h3 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h3><h4 id="æ²¡æœ‰é‡å†™-hashCode-çš„æƒ…å†µï¼š"><a href="#æ²¡æœ‰é‡å†™-hashCode-çš„æƒ…å†µï¼š" class="headerlink" title="æ²¡æœ‰é‡å†™ hashCode() çš„æƒ…å†µï¼š"></a>æ²¡æœ‰é‡å†™ <code>hashCode()</code> çš„æƒ…å†µï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == obj) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span> || getClass() != obj.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) obj;</span><br><span class="line">        <span class="keyword">return</span> id == student.id &amp;&amp; name.equals(student.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœªé‡å†™ hashCode()</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;name=&#x27;&quot;</span> + name + <span class="string">&quot;&#x27;, id=&quot;</span> + id + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Set&lt;Student&gt; students = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">101</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">101</span>);</span><br><span class="line"></span><br><span class="line">        students.add(s1);</span><br><span class="line">        students.add(s2);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;å­¦ç”Ÿé›†åˆ: &quot;</span> + students);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œç»“æœï¼š"><a href="#è¿è¡Œç»“æœï¼š" class="headerlink" title="è¿è¡Œç»“æœï¼š"></a>è¿è¡Œç»“æœï¼š</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å­¦ç”Ÿé›†åˆ: [Student&#123;name=&#x27;Alice&#x27;, id=101&#125;, Student&#123;name=&#x27;Alice&#x27;, id=101&#125;]</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜åˆ†æï¼š</strong><br>å°½ç®¡æˆ‘ä»¬é‡å†™äº† <code>equals()</code> æ–¹æ³•ï¼Œä¸¤ä¸ªå­¦ç”Ÿå¯¹è±¡ <code>s1</code> å’Œ <code>s2</code> æ˜¯ç›¸ç­‰çš„ï¼ˆæ ¹æ® <code>equals()</code> åˆ¤æ–­ï¼‰ã€‚ä½†åœ¨ <code>HashSet</code> ä¸­ï¼Œå®ƒä»¬ä¾ç„¶è¢«è®¤ä¸ºæ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œå¹¶ä¸”éƒ½è¢«æ·»åŠ åˆ°äº†é›†åˆä¸­ã€‚è¿™æ˜¯å› ä¸º <code>HashSet</code> åœ¨å­˜å‚¨å…ƒç´ æ—¶ä¸ä»…ä¾èµ– <code>equals()</code>ï¼Œè¿˜ä¾èµ– <code>hashCode()</code>ã€‚</p><p><strong>åŸå› ï¼š</strong></p><ul><li><code>HashSet</code> ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨æ•°æ®ï¼Œæ’å…¥æ—¶ä¼šæ ¹æ®å¯¹è±¡çš„ <code>hashCode()</code> è¿›è¡Œå®šä½ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„ <code>hashCode()</code> ä¸åŒï¼Œå³ä½¿å®ƒä»¬é€šè¿‡ <code>equals()</code> åˆ¤æ–­ç›¸ç­‰ï¼Œ<code>HashSet</code> ä¾ç„¶ä¼šå°†å®ƒä»¬è§†ä¸ºä¸åŒçš„å¯¹è±¡ã€‚</li><li>ç”±äºæˆ‘ä»¬æ²¡æœ‰é‡å†™ <code>hashCode()</code>ï¼Œæ¯æ¬¡ <code>s1</code> å’Œ <code>s2</code> çš„ <code>hashCode()</code> å¯èƒ½ä¸ç›¸åŒï¼Œæ‰€ä»¥ <code>HashSet</code> ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ä¸åŒçš„å¯¹è±¡ã€‚</li></ul><h3 id="é‡å†™-hashCode-çš„æƒ…å†µï¼š"><a href="#é‡å†™-hashCode-çš„æƒ…å†µï¼š" class="headerlink" title="é‡å†™ hashCode() çš„æƒ…å†µï¼š"></a>é‡å†™ <code>hashCode()</code> çš„æƒ…å†µï¼š</h3><p>æˆ‘ä»¬ç°åœ¨é‡å†™ <code>hashCode()</code>ï¼Œç¡®ä¿å½“ä¸¤ä¸ªå¯¹è±¡é€šè¿‡ <code>equals()</code> åˆ¤æ–­ç›¸ç­‰æ—¶ï¼Œå®ƒä»¬çš„å“ˆå¸Œç ä¹Ÿç›¸ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == obj) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span> || getClass() != obj.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) obj;</span><br><span class="line">        <span class="keyword">return</span> id == student.id &amp;&amp; name.equals(student.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(name, id);  <span class="comment">// æ ¹æ® name å’Œ id ç”Ÿæˆå“ˆå¸Œç </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;name=&#x27;&quot;</span> + name + <span class="string">&quot;&#x27;, id=&quot;</span> + id + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Set&lt;Student&gt; students = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">101</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">101</span>);</span><br><span class="line"></span><br><span class="line">        students.add(s1);</span><br><span class="line">        students.add(s2);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;å­¦ç”Ÿé›†åˆ: &quot;</span> + students);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œç»“æœï¼š-1"><a href="#è¿è¡Œç»“æœï¼š-1" class="headerlink" title="è¿è¡Œç»“æœï¼š"></a>è¿è¡Œç»“æœï¼š</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å­¦ç”Ÿé›†åˆ: [Student&#123;name=&#x27;Alice&#x27;, id=101&#125;]</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜è§£å†³ï¼š</strong><br>ç°åœ¨ï¼Œ<code>s1</code> å’Œ <code>s2</code> è¢«æ­£ç¡®åœ°è®¤ä¸ºæ˜¯ç›¸åŒçš„å¯¹è±¡ï¼Œå› ä¸ºæˆ‘ä»¬ç¡®ä¿äº† <code>equals()</code> ç›¸ç­‰çš„å¯¹è±¡ä¹Ÿæ‹¥æœ‰ç›¸åŒçš„å“ˆå¸Œç ã€‚æ‰€ä»¥ <code>HashSet</code> åªå­˜å‚¨äº†ä¸€ä¸ª <code>Student</code> å¯¹è±¡ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦é‡å†™-hashCode-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦é‡å†™-hashCode-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦é‡å†™ hashCode()ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦é‡å†™ <code>hashCode()</code>ï¼Ÿ</h3><ol><li><p><strong>ä¸€è‡´æ€§åŸåˆ™</strong>ï¼š<code>hashCode()</code> å’Œ <code>equals()</code> éœ€è¦ä¿æŒä¸€è‡´ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡ <code>equals()</code> æ–¹æ³•è¢«è®¤ä¸ºç›¸ç­‰ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ <code>hashCode()</code> å¿…é¡»ç›¸åŒã€‚å¦‚æœä¸é‡å†™ <code>hashCode()</code>ï¼Œå³ä½¿ä¸¤ä¸ªå¯¹è±¡åœ¨é€»è¾‘ä¸Šæ˜¯ç›¸ç­‰çš„ï¼Œé›†åˆç±»å¦‚ <code>HashSet</code> æˆ– <code>HashMap</code> ä»ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œä»è€Œå¼•å‘é—®é¢˜ã€‚</p></li><li><p><strong>æ•ˆç‡é—®é¢˜</strong>ï¼š<code>HashSet</code> å’Œ <code>HashMap</code> ç­‰åŸºäºå“ˆå¸Œè¡¨çš„é›†åˆç±»ä½¿ç”¨ <code>hashCode()</code> æ¥å¿«é€Ÿç¡®å®šå¯¹è±¡çš„å­˜å‚¨ä½ç½®ã€‚å¦‚æœæ²¡æœ‰é‡å†™ <code>hashCode()</code>ï¼Œè¿™äº›é›†åˆçš„æ€§èƒ½ä¼šå˜å¾—ä½ä¸‹ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦ä¾èµ– <code>equals()</code> è¿›è¡Œé€ä¸€æ¯”è¾ƒï¼Œè€Œ <code>hashCode()</code> å¯ä»¥å¤§å¹…æé«˜æŸ¥æ‰¾å’Œå­˜å‚¨æ•ˆç‡ã€‚</p></li></ol><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>é‡å†™ <code>equals()</code> æ—¶å¿…é¡»é‡å†™ <code>hashCode()</code>ï¼Œå¦åˆ™ä¼šå¯¼è‡´é›†åˆç±»ä¸­çš„ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚</li><li><code>hashCode()</code> ç”¨äºé«˜æ•ˆå®šä½å¯¹è±¡ï¼Œè€Œ <code>equals()</code> ç”¨äºç²¾ç¡®æ¯”è¾ƒå¯¹è±¡çš„å†…å®¹ã€‚</li></ul></blockquote><h3 id="Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«"><a href="#Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«" class="headerlink" title="Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«"></a>Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«</h3><h4 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h4><p>String ä¸­çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºå¸¸é‡ï¼Œçº¿ç¨‹å®‰å…¨ã€‚ AbstractStringBuilder æ˜¯ StringBuilder ä¸ StringBuffer çš„å…¬å…±â½—ç±»ï¼Œå®šä¹‰äº†â¼€äº›å­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œï¼Œå¦‚ expandCapacity ã€ append ã€ insert ã€ indexOf ç­‰å…¬å…±â½…æ³•ã€‚ StringBuffer å¯¹â½…æ³•åŠ äº†åŒæ­¥é”æˆ–è€… å¯¹è°ƒâ½¤çš„â½…æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ <strong>StringBuilder å¹¶æ²¡æœ‰å¯¹â½…æ³•è¿›â¾åŠ åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯ â¾®çº¿ç¨‹å®‰å…¨çš„ã€‚</strong></p><table><thead><tr><th align="center">åç§°</th><th align="center">çº¿ç¨‹å®‰å…¨æ€§</th></tr></thead><tbody><tr><td align="center">String</td><td align="center">çº¿ç¨‹å®‰å…¨</td></tr><tr><td align="center">StringBuffer</td><td align="center">çº¿ç¨‹å®‰å…¨</td></tr><tr><td align="center">StringBuilder</td><td align="center">éçº¿ç¨‹å®‰å…¨</td></tr></tbody></table><h4 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="headerlink" title="æ€§èƒ½"></a>æ€§èƒ½</h4><p>æ¯æ¬¡å¯¹ String ç±»å‹è¿›â¾æ”¹å˜çš„æ—¶å€™ï¼Œéƒ½ä¼šâ½£æˆâ¼€ä¸ªæ–°çš„ String å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡ã€‚ StringBuffer æ¯æ¬¡éƒ½ä¼šå¯¹ StringBuffer å¯¹è±¡æœ¬èº«è¿›â¾æ“ä½œï¼Œâ½½ä¸æ˜¯â½£æˆæ–°çš„å¯¹è±¡å¹¶æ”¹ å˜å¯¹è±¡å¼•â½¤ã€‚ç›¸åŒæƒ…å†µä¸‹ä½¿â½¤ StringBuilder ç›¸â½ä½¿â½¤ StringBuffer ä»…èƒ½è·å¾— 10%~15% å·¦å³çš„æ€§ èƒ½æå‡ï¼Œä½†å´è¦å†’å¤šçº¿ç¨‹ä¸å®‰å…¨çš„â»›é™©ã€‚</p><p>å¯¹äºä¸‰è€…ä½¿â½¤çš„æ€»ç»“ï¼š </p><ol><li>æ“ä½œå°‘é‡çš„æ•°æ®: é€‚â½¤ String </li><li>å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œâ¼¤é‡æ•°æ®: é€‚â½¤ StringBuilder </li><li>å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œâ¼¤é‡æ•°æ®: é€‚â½¤ StringBuffer</li></ol><h4 id="Stringä¸ºä»€ä¹ˆæ˜¯ä¸å¯ä¿®æ”¹çš„"><a href="#Stringä¸ºä»€ä¹ˆæ˜¯ä¸å¯ä¿®æ”¹çš„" class="headerlink" title="Stringä¸ºä»€ä¹ˆæ˜¯ä¸å¯ä¿®æ”¹çš„"></a>Stringä¸ºä»€ä¹ˆæ˜¯ä¸å¯ä¿®æ”¹çš„</h4><p>è¿™æ˜¯å› ä¸ºä¿å­˜Stringçš„æ•°ç»„è¢«finalä¿®é¥°ä¸”ç§æœ‰ï¼Œå¯¹åº”ç±»ä¹Ÿæ²¡æœ‰æä¾›&#x2F;æš´éœ²æ“ä½œçš„æ–¹æ³•;Stringç±»è¢«finalä¿®é¥°å¯¼è‡´å…¶ä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿›è€Œé¿å…äº†å­ç±»ç ´åStringä¸å¯å˜ã€‚</p><h4 id="ä»å­—èŠ‚ç â»†åº¦åˆ†æ-try-catch-finally-è¿™ä¸ªè¯­æ³•ç³–èƒŒåçš„å®ç°åŸç†ã€‚"><a href="#ä»å­—èŠ‚ç â»†åº¦åˆ†æ-try-catch-finally-è¿™ä¸ªè¯­æ³•ç³–èƒŒåçš„å®ç°åŸç†ã€‚" class="headerlink" title="ä»å­—èŠ‚ç â»†åº¦åˆ†æ try catch finally è¿™ä¸ªè¯­æ³•ç³–èƒŒåçš„å®ç°åŸç†ã€‚"></a>ä»å­—èŠ‚ç â»†åº¦åˆ†æ try catch finally è¿™ä¸ªè¯­æ³•ç³–èƒŒåçš„å®ç°åŸç†ã€‚</h4><blockquote><p>ä»å­—èŠ‚ç å±‚é¢æ¥çœ‹ï¼Œ<code>try-catch-finally</code> é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p><ol><li><strong>æ§åˆ¶æµè·³è½¬</strong>ï¼šJVM ä½¿ç”¨è·³è½¬æŒ‡ä»¤ï¼ˆå¦‚ <code>goto</code>ï¼‰æ¥ç¡®ä¿æ— è®ºåœ¨ <code>try</code> å—ä¸­å‘ç”Ÿä»€ä¹ˆï¼ˆå¼‚å¸¸æˆ–æ­£å¸¸å®Œæˆï¼‰ï¼Œéƒ½å¯ä»¥åœ¨åˆé€‚çš„æ—¶æœºè·³è½¬åˆ° <code>catch</code> å’Œ <code>finally</code> å—ã€‚</li><li><strong>å¼‚å¸¸è¡¨</strong>ï¼šJVM å¹¶ä¸æ˜¯åœ¨æ¯ä¸ªå­—èŠ‚ç æŒ‡ä»¤åé¢éƒ½æ’å…¥å¼‚å¸¸å¤„ç†ä»£ç ï¼Œè€Œæ˜¯é€šè¿‡å¼‚å¸¸è¡¨æ¥æè¿°ä»£ç æ®µä¹‹é—´çš„å…³ç³»ã€‚å¼‚å¸¸è¡¨æŒ‡æ˜äº†åœ¨æŸä¸ªèŒƒå›´å†…å‘ç”Ÿç‰¹å®šç±»å‹çš„å¼‚å¸¸æ—¶ï¼Œåº”è¯¥è·³è½¬åˆ°å“ªä¸ªå­—èŠ‚ç ä½ç½®å¤„ç†ã€‚</li><li><strong>finally çš„æ‰§è¡Œä¿è¯</strong>ï¼šæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œ<code>finally</code> å—æ€»ä¼šè¢«æ‰§è¡Œã€‚å­—èŠ‚ç é€šè¿‡è·³è½¬ï¼ˆ<code>goto</code> æŒ‡ä»¤ï¼‰å’Œå¼‚å¸¸è¡¨ï¼Œç¡®ä¿äº†åœ¨ <code>try</code> å—å’Œ <code>catch</code> å—ä¹‹åï¼Œéƒ½ä¼šè·³è½¬åˆ° <code>finally</code> å—ä¸­ã€‚</li></ol><h3 id="4-é‡è¦ç»“è®º"><a href="#4-é‡è¦ç»“è®º" class="headerlink" title="4. é‡è¦ç»“è®º"></a>4. é‡è¦ç»“è®º</h3><ul><li><strong>å¼‚å¸¸è¡¨</strong> æ˜¯ <code>try-catch-finally</code> çš„æ ¸å¿ƒï¼Œå®ƒæŒ‡æ˜äº†å¼‚å¸¸å‘ç”Ÿæ—¶è¯¥è·³è½¬åˆ°å“ªé‡Œè¿›è¡Œå¤„ç†ã€‚</li><li><strong>æ§åˆ¶æµè·³è½¬</strong> æŒ‡ä»¤ï¼ˆå¦‚ <code>goto</code>ï¼‰ç¡®ä¿äº†å¼‚å¸¸å‘ç”Ÿåä¼šè¿›å…¥ <code>catch</code>ï¼Œå¹¶æœ€ç»ˆè¿›å…¥ <code>finally</code>ï¼Œä»è€Œä¿è¯ <code>finally</code> æ€»æ˜¯è¢«æ‰§è¡Œã€‚</li><li><strong>æ— è®ºå¼‚å¸¸æ˜¯å¦å‘ç”Ÿï¼Œfinally éƒ½ä¼šæ‰§è¡Œ</strong>ï¼Œè¿™æ˜¯ç”±å­—èŠ‚ç ä¸­ <code>goto</code> å’Œå¼‚å¸¸è¡¨å…±åŒä¿è¯çš„ã€‚</li></ul></blockquote><h2 id="Java-é›†åˆ"><a href="#Java-é›†åˆ" class="headerlink" title="Java é›†åˆ"></a>Java é›†åˆ</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262041207.png" alt="image-20240911160249039"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262041359.png" alt="image-20240911160301678"></p><h2 id="JavaåŸºç¡€é¢è¯•"><a href="#JavaåŸºç¡€é¢è¯•" class="headerlink" title="JavaåŸºç¡€é¢è¯•"></a>JavaåŸºç¡€é¢è¯•</h2><h3 id="ä¸ºä»€ä¹ˆStringåœ¨Javaä¸­è¢«è®¾è®¡ä¸ºä¸å¯å˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆStringåœ¨Javaä¸­è¢«è®¾è®¡ä¸ºä¸å¯å˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆStringåœ¨Javaä¸­è¢«è®¾è®¡ä¸ºä¸å¯å˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ<code>String</code>åœ¨Javaä¸­è¢«è®¾è®¡ä¸ºä¸å¯å˜ï¼Ÿ</h3><blockquote><p>ä»å®‰å…¨æ€§çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œæ¯”å¦‚Stringç±»ä¼šé¢‘ç¹çš„å‡ºç°åœ¨æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶åœ°å€URLç­‰æ–¹é¢ï¼Œå¦‚æœå¯å˜çš„è¯ï¼Œæ”»å‡»å¯ä»¥é€šè¿‡æ¶æ„æ”¹å˜å…¶å€¼æ¥è¾¾åˆ°ç ´åç³»ç»Ÿå®‰å…¨æ€§çš„ç›®çš„ï¼›</p><p>ä»çº¿ç¨‹å®‰å…¨æ€§çš„è§’åº¦æ¥çœ‹çš„è¯ï¼Œå› ä¸ºStringçš„ä¸å¯å˜ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå°±æ— éœ€è€ƒè™‘åŒæ­¥é—®é¢˜ï¼›</p><p>ä»å“ˆå¸Œç ç¼“å­˜çš„è§’åº¦æ¥çœ‹ï¼Œå› ä¸ºå“ˆå¸Œæ˜¯é€šè¿‡å¯¹Stringå†…å®¹è®¡ç®—å¾—å‡ºæ¥çš„ï¼Œæ— è®ºæ˜¯hashsetè¿˜æ˜¯hashmapï¼Œå¦‚æœStringå¯å˜ï¼Œé‚£ä¹ˆå…¶ä¿®æ”¹Stringåå…¶å¯¹åº”çš„å“ˆå¸Œç ä¼šå‘ç”Ÿæ”¹å˜ï¼Œè¿›è€Œå½±å“åç»­é›†åˆçš„è¡Œä¸ºï¼›</p><p>ä»å†…å­˜çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ ·å¯ä»¥èŠ‚çº¦å†…å­˜çš„ä½¿ç”¨ï¼Œå› ä¸ºStringçš„ä¸å¯å˜ï¼Œæ‰€ä»¥Stringå…·æœ‰ç›¸åŒå†…å®¹çš„å°±å¯ä»¥ç›´æ¥å¼•ç”¨ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå…¶Stringå‘ç”Ÿæ›´æ”¹ï¼›</p><p>å›ç­”è¿™ä¸ªé—®é¢˜å¯ä»¥ä»ï¼šç³»ç»Ÿå®‰å…¨æ€§ã€èŠ‚çº¦å†…å­˜ã€çº¿ç¨‹å®‰å…¨æ€§ä»¥åŠå“ˆå¸Œç¼“å­˜è§’åº¦ç»§ç»­åˆ†æå›ç­”ã€‚</p></blockquote><h3 id="æŠ½è±¡ç±»-VS-æ¥å£"><a href="#æŠ½è±¡ç±»-VS-æ¥å£" class="headerlink" title="æŠ½è±¡ç±» VS æ¥å£"></a>æŠ½è±¡ç±» VS æ¥å£</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262041074.png" alt="image-20240919210459883"></p><h3 id="è¯·è§£é‡Šå‡ ç§åŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼ï¼Œå¹¶è¯´æ˜å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚"><a href="#è¯·è§£é‡Šå‡ ç§åŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼ï¼Œå¹¶è¯´æ˜å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚" class="headerlink" title="è¯·è§£é‡Šå‡ ç§åŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼ï¼Œå¹¶è¯´æ˜å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚"></a>è¯·è§£é‡Šå‡ ç§åŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼ï¼Œå¹¶è¯´æ˜å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚</h3><blockquote><p>åŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼æœ‰ï¼šJDKåŠ¨æ€ä»£ç†ï¼ŒCGLIBåŠ¨æ€ä»£ç†å’ŒJavassiståŠ¨æ€ä»£ç†ï¼›</p><p>åŠ¨æ€ä»£ç†åœ¨AOPä¸­ç‰¹åˆ«æœ‰ç”¨ï¼ŒAOPé€šè¿‡æ‹¦æˆªç›®æ ‡ç±»ï¼Œä¸ºç›®æ ‡ç±»çš„æ–¹æ³•ç»‡å…¥ç¼–å†™å¥½çš„é€»è¾‘ä»£ç ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æˆ–è€…ä¹‹åç­‰ä¸€äº›å…¶å®ƒæ–¹æ³•ï¼Œåœ¨ç›®æ ‡ç±»çš„åŸºç¡€ä¸Šå¢åŠ åˆ‡é¢é€»è¾‘ï¼Œç”Ÿæˆå¢å¼ºçš„ç›®æ ‡ç±»ï¼›</p><p>JDKåŠ¨æ€ä»£ç†é€šè¿‡JDKå†…éƒ¨è‡ªå¸¦çš„åå°„æœºåˆ¶æ¥å®ç°çš„ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­é€šè¿‡ä½¿ç”¨JDKåŠ¨æ€ä»£ç†æ¥ä»£ç†ç›®æ ‡å¯¹è±¡çš„ä¾‹å­ï¼›</p><p>jdkåŠ¨æ€ä»£ç†æ˜¯jdkåŸç”Ÿå°±æ”¯æŒçš„ä¸€ç§ä»£ç†æ–¹å¼ï¼Œå®ƒçš„å®ç°åŸç†ï¼Œå°±æ˜¯é€šè¿‡è®©targetç±»å’Œä»£ç†ç±»å®ç°åŒä¸€æ¥å£ï¼Œä»£ç†ç±»æŒæœ‰targetå¯¹è±¡ï¼Œæ¥è¾¾åˆ°æ–¹æ³•æ‹¦æˆªçš„ä½œç”¨ï¼Œè¿™æ ·é€šè¿‡æ¥å£çš„æ–¹å¼æœ‰ä¸¤ä¸ªå¼Šç«¯ï¼Œä¸€ä¸ªæ˜¯å¿…é¡»ä¿è¯targetç±»æœ‰æ¥å£ï¼Œç¬¬äºŒä¸ªæ˜¯å¦‚æœæƒ³è¦å¯¹targetç±»çš„æ–¹æ³•è¿›è¡Œä»£ç†æ‹¦æˆªï¼Œé‚£ä¹ˆå°±è¦ä¿è¯è¿™äº›æ–¹æ³•éƒ½è¦åœ¨æ¥å£ä¸­å£°æ˜ï¼Œå®ç°ä¸Šç•¥å¾®æœ‰ç‚¹é™åˆ¶ã€‚</p><p>ç®€å•çš„æ¥è¯´è¿™ä¸ªçš„å±€é™æ€§ï¼Œè¿™ä¸ªå±€é™æ€§å°±åœ¨äºç›®æ ‡ç±»targetç±»å¿…é¡»æœ‰å®ç°æ¥å£ï¼Œå¹¶ä¸”æ‹¦æˆªçš„æ–¹æ³•å¿…é¡»åœ¨æ¥å£ä¸­å®šä¹‰ï¼Œè¿™æ˜¯JDKæœ€å¤§çš„å±€é™æ€§ï¼›</p><p>Cglibæ˜¯ä¸€ä¸ªä¼˜ç§€çš„åŠ¨æ€ä»£ç†æ¡†æ¶ï¼Œå®ƒçš„åº•å±‚ä½¿ç”¨ASMåœ¨å†…å­˜ä¸­åŠ¨æ€çš„ç”Ÿæˆè¢«ä»£ç†ç±»çš„å­ç±»ï¼Œä½¿ç”¨CGLIBå³ä½¿ä»£ç†ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ä¹Ÿå¯ä»¥å®ç°åŠ¨æ€ä»£ç†åŠŸèƒ½ã€‚CGLIBå…·æœ‰ç®€å•æ˜“ç”¨ï¼Œå®ƒçš„è¿è¡Œé€Ÿåº¦è¦è¿œè¿œå¿«äºJDKçš„ProxyåŠ¨æ€ä»£ç†ï¼Œå®ƒé€šè¿‡åˆ›å»ºç›®æ ‡ç±»çš„å­ç±»å¹¶è¦†ç›–å…¶ä¸­çš„æ–¹æ³•æ¥å®ç°ä»£ç†ã€‚</p></blockquote><h2 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h2><h3 id="å‚è€ƒèµ„æ–™-1"><a href="#å‚è€ƒèµ„æ–™-1" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/qwecnsu/article/details/138194103">https://blog.csdn.net/qwecnsu/article/details/138194103</a></li><li></li></ol><h3 id="1-æ³›å‹çš„èƒŒæ™¯ä¸ç›®çš„"><a href="#1-æ³›å‹çš„èƒŒæ™¯ä¸ç›®çš„" class="headerlink" title="1. æ³›å‹çš„èƒŒæ™¯ä¸ç›®çš„"></a>1. <strong>æ³›å‹çš„èƒŒæ™¯ä¸ç›®çš„</strong></h3><p>åœ¨ Java ä¸­ï¼Œæ³›å‹æ˜¯ä¸ºäº†å¢å¼ºç±»å‹å®‰å…¨å’Œæé«˜ä»£ç é‡ç”¨æ€§è€Œå¼•å…¥çš„ã€‚æ³›å‹å…è®¸æˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶æŒ‡å®šç±»å‹ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ä½¿ç”¨åŸå§‹ç±»å‹ï¼Œè¿™æœ‰å‡ ä¸ªæ˜æ˜¾çš„å¥½å¤„ï¼š</p><ul><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé¿å…äº†è¿è¡Œæ—¶å‡ºç°ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚</li><li><strong>ä»£ç å¤ç”¨</strong>ï¼šé€šè¿‡ä¸€ä¸ªç±»æˆ–æ–¹æ³•å¤„ç†ä¸åŒç±»å‹çš„æ•°æ®ï¼Œè€Œä¸éœ€è¦é‡å¤ç¼–å†™å¤šä¸ªç‰ˆæœ¬ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œ<code>List&lt;T&gt;</code> æ˜¯ä¸€ä¸ªå¸¦æœ‰æ³›å‹çš„ç±»ï¼Œå®ƒå…è®¸ä½ åœ¨åˆ›å»ºæ—¶æŒ‡å®šä¸€ä¸ªå…·ä½“ç±»å‹ï¼Œè¿™æ ·åœ¨ä½¿ç”¨è¯¥ç±»å‹æ—¶å°±ä¸éœ€è¦åšç±»å‹è½¬æ¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">stringList.add(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> stringList.get(<span class="number">0</span>);  <span class="comment">// ä¸éœ€è¦å¼ºåˆ¶è½¬æ¢ï¼Œç¼–è¯‘æ—¶å°±ç¡®ä¿ç±»å‹å®‰å…¨</span></span><br></pre></td></tr></table></figure><h3 id="2-æ³›å‹æ“¦é™¤æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-æ³›å‹æ“¦é™¤æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. æ³›å‹æ“¦é™¤æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2. <strong>æ³›å‹æ“¦é™¤æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3><p>æ³›å‹æ“¦é™¤æ˜¯ Java æ³›å‹æœºåˆ¶ä¸­çš„ä¸€ä¸ªç‰¹æ€§ã€‚ç®€å•æ¥è¯´ï¼Œæ³›å‹æ“¦é™¤å°±æ˜¯ç¼–è¯‘å™¨åœ¨ <strong>ç¼–è¯‘æ—¶</strong> ä¼šå°†æ‰€æœ‰æ³›å‹ç±»å‹æ“¦é™¤ï¼ˆç§»é™¤ï¼‰ï¼Œå¹¶æ›¿æ¢ä¸ºå®ƒä»¬çš„åŸå§‹ç±»å‹ï¼ˆraw typesï¼‰ã€‚è¿™æ„å‘³ç€åœ¨ <strong>ç¼–è¯‘å</strong>ï¼Œæ‰€æœ‰æ³›å‹ç±»å‹éƒ½ä¸å†å­˜åœ¨ï¼ŒJVM è¿è¡Œæ—¶æ˜¯æ— æ³•çŸ¥é“æ³›å‹çš„å…·ä½“ç±»å‹çš„ã€‚</p><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘é˜¶æ®µï¼Œç¼–è¯‘å™¨ä¼šå°†æ³›å‹ç±»å‹ <code>String</code> æ“¦é™¤æ‰ï¼Œç”Ÿæˆçš„å­—èŠ‚ç å°†å˜æˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br></pre></td></tr></table></figure><p><strong>é€šè¿‡æ“¦é™¤ï¼ŒJava ä¿è¯äº†å‘åå…¼å®¹æ€§</strong>ï¼Œå› ä¸ºæ—©æœŸçš„ Java ç‰ˆæœ¬å¹¶ä¸æ”¯æŒæ³›å‹ã€‚</p><h3 id="3-ä¸ºä»€ä¹ˆè¦åšæ³›å‹æ“¦é™¤ï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆè¦åšæ³›å‹æ“¦é™¤ï¼Ÿ" class="headerlink" title="3. ä¸ºä»€ä¹ˆè¦åšæ³›å‹æ“¦é™¤ï¼Ÿ"></a>3. <strong>ä¸ºä»€ä¹ˆè¦åšæ³›å‹æ“¦é™¤ï¼Ÿ</strong></h3><ul><li><strong>å‘åå…¼å®¹</strong>ï¼šä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬çš„ Javaã€‚Java çš„æ³›å‹æ˜¯åœ¨ Java 5 ä¸­å¼•å…¥çš„ï¼Œä½†ä¸ºäº†ä¿æŒä¸ Java 1.4 åŠä»¥å‰ç‰ˆæœ¬çš„å…¼å®¹æ€§ï¼Œæ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶ä¼šè¢«ç§»é™¤ï¼Œè¿™æ ·æ—§ç‰ˆ JVM ä»ç„¶å¯ä»¥è¿è¡Œæ–°ä»£ç ã€‚</li><li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šåœ¨è¿è¡Œæ—¶ï¼ŒJVM ä¸éœ€è¦ç»´æŠ¤æ³›å‹çš„ç±»å‹ä¿¡æ¯ï¼Œè¿™å‡è½»äº†è¿è¡Œæ—¶çš„å¼€é”€ã€‚</li></ul><h3 id="4-æ³›å‹æ“¦é™¤çš„å®ç°"><a href="#4-æ³›å‹æ“¦é™¤çš„å®ç°" class="headerlink" title="4. æ³›å‹æ“¦é™¤çš„å®ç°"></a>4. <strong>æ³›å‹æ“¦é™¤çš„å®ç°</strong></h3><p>åœ¨ Java ä¸­ï¼Œæ³›å‹çš„å®ç°æ˜¯é€šè¿‡ <strong>ç±»å‹æ“¦é™¤</strong> æ¥å®Œæˆçš„ã€‚å…·ä½“æ¥è¯´ï¼š</p><ul><li>æ³›å‹ç±»å‹å‚æ•°ä¼šè¢«æ›¿æ¢ä¸º <strong>åŸå§‹ç±»å‹</strong>ï¼ˆraw typeï¼‰ï¼Œé€šå¸¸æ˜¯ <code>Object</code>ï¼Œé™¤éæŒ‡å®šäº†æ³›å‹çš„ä¸Šç•Œï¼ˆä¾‹å¦‚ <code>List&lt;T extends Number&gt;</code>ï¼‰ã€‚</li><li>ä½ ä¸èƒ½ç›´æ¥è·å–æ³›å‹å‚æ•°çš„ç±»å‹ï¼Œå› ä¸ºç¼–è¯‘åçš„å­—èŠ‚ç å¹¶æ²¡æœ‰åŒ…å«è¿™äº›ä¿¡æ¯ã€‚</li></ul><h4 id="ä¾‹å­ï¼šæ³›å‹æ“¦é™¤"><a href="#ä¾‹å­ï¼šæ³›å‹æ“¦é™¤" class="headerlink" title="ä¾‹å­ï¼šæ³›å‹æ“¦é™¤"></a>ä¾‹å­ï¼šæ³›å‹æ“¦é™¤</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> T value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‡è®¾ä½ åˆ›å»ºäº† <code>Box&lt;Integer&gt;</code> ç±»å‹çš„å¯¹è±¡ï¼Œç¼–è¯‘å™¨ä¼šå°†å®ƒè½¬æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>T</code> ä¼šè¢«æ“¦é™¤æˆ <code>Object</code>ï¼Œå› æ­¤ <code>setValue()</code> å’Œ <code>getValue()</code> æ–¹æ³•ä¼šä½¿ç”¨ <code>Object</code> ç±»å‹ã€‚</p><h3 id="5-æ“¦é™¤å¸¦æ¥çš„å½±å“"><a href="#5-æ“¦é™¤å¸¦æ¥çš„å½±å“" class="headerlink" title="5. æ“¦é™¤å¸¦æ¥çš„å½±å“"></a>5. <strong>æ“¦é™¤å¸¦æ¥çš„å½±å“</strong></h3><p>ç”±äºæ“¦é™¤çš„å­˜åœ¨ï¼ŒJava è¿è¡Œæ—¶æ— æ³•ç›´æ¥è®¿é—®æ³›å‹çš„ç±»å‹å‚æ•°ã€‚è¿™ä¼šå¯¼è‡´ä¸€äº›å¸¸è§çš„é™åˆ¶ï¼š</p><ul><li><p><strong>æ— æ³•è¿›è¡Œ <code>instanceof</code> æ£€æŸ¥</strong>ï¼šæ— æ³•æ£€æŸ¥æ³›å‹ç±»å‹çš„å®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span> (list <span class="keyword">instanceof</span> List&lt;String&gt;) &#123;  <span class="comment">// ç¼–è¯‘æ—¶é”™è¯¯</span></span><br><span class="line">    <span class="comment">// é”™è¯¯ï¼šæ— æ³•æ¯”è¾ƒ List&lt;String&gt; ç±»å‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ³›å‹ç±»å‹å‚æ•°çš„ä¿¡æ¯ä¸¢å¤±</strong>ï¼šåœ¨è¿è¡Œæ—¶æ— æ³•çŸ¥é“æ³›å‹çš„å…·ä½“ç±»å‹ã€‚</p></li><li><p><strong>æ— æ³•åˆ›å»ºæ³›å‹æ•°ç»„</strong>ï¼šç”±äºæ³›å‹ä¿¡æ¯åœ¨è¿è¡Œæ—¶ä¸¢å¤±ï¼Œä¸èƒ½åˆ›å»ºå¦‚ <code>new T[10]</code> çš„æ³›å‹æ•°ç»„ã€‚</p></li></ul><h3 id="6-å¦‚ä½•è§£å†³æ³›å‹æ“¦é™¤å¸¦æ¥çš„é™åˆ¶"><a href="#6-å¦‚ä½•è§£å†³æ³›å‹æ“¦é™¤å¸¦æ¥çš„é™åˆ¶" class="headerlink" title="6. å¦‚ä½•è§£å†³æ³›å‹æ“¦é™¤å¸¦æ¥çš„é™åˆ¶"></a>6. <strong>å¦‚ä½•è§£å†³æ³›å‹æ“¦é™¤å¸¦æ¥çš„é™åˆ¶</strong></h3><p>å°½ç®¡æ³›å‹æ“¦é™¤å­˜åœ¨ä¸Šè¿°é™åˆ¶ï¼ŒJava æä¾›äº†ä¸€äº›æ–¹æ³•æ¥å…‹æœè¿™äº›é—®é¢˜ï¼š</p><ul><li><strong>é€šé…ç¬¦ï¼ˆWildcardï¼‰</strong>ï¼šå¯ä»¥ä½¿ç”¨ <code>?</code> æ¥è¡¨ç¤ºä¸ç¡®å®šçš„ç±»å‹ï¼Œä¾‹å¦‚ <code>List&lt;?&gt;</code> è¡¨ç¤ºä»»ä½•ç±»å‹çš„åˆ—è¡¨ã€‚</li><li><strong>åå°„</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨åå°„æ¥è·å–æ³›å‹ä¿¡æ¯ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œæ³›å‹ä¿¡æ¯åªæœ‰åœ¨å£°æ˜æ—¶å¯ç”¨ï¼Œè¿è¡Œæ—¶ä¸å¯å¾—ã€‚</li></ul><h3 id="7-æ³›å‹æ“¦é™¤ä¸ä¸Šç•Œ"><a href="#7-æ³›å‹æ“¦é™¤ä¸ä¸Šç•Œ" class="headerlink" title="7. æ³›å‹æ“¦é™¤ä¸ä¸Šç•Œ"></a>7. <strong>æ³›å‹æ“¦é™¤ä¸ä¸Šç•Œ</strong></h3><p>å¦‚æœæ³›å‹æœ‰ä¸Šç•Œï¼Œæ“¦é™¤ä¼šæ ¹æ®ä¸Šç•Œæ¥å†³å®šåŸå§‹ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å£°æ˜ä¸€ä¸ªæ³›å‹ç±»ä¸º <code>T extends Number</code>ï¼Œåˆ™æ“¦é™¤åçš„ç±»å‹æ˜¯ <code>Number</code>ï¼Œè€Œä¸æ˜¯ <code>Object</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Number</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> T value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>T</code> è¢«æ“¦é™¤ä¸º <code>Number</code>ã€‚</p><h3 id="8-æ€»ç»“"><a href="#8-æ€»ç»“" class="headerlink" title="8. æ€»ç»“"></a>8. <strong>æ€»ç»“</strong></h3><ul><li><strong>æ³›å‹æ“¦é™¤</strong> æ˜¯ Java ç¼–è¯‘å™¨çš„ç‰¹æ€§ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°†æ³›å‹ä¿¡æ¯æ“¦é™¤ï¼Œä¿ç•™åŸå§‹ç±»å‹ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯å‘åå…¼å®¹å’Œä¼˜åŒ–æ€§èƒ½ã€‚</li><li><strong>æ“¦é™¤åçš„ç»“æœ</strong>ï¼šåœ¨ç¼–è¯‘åï¼Œæ³›å‹è¢«æ›¿æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œä¸”è¿è¡Œæ—¶ä¸å†ä¿ç•™æ³›å‹çš„ç±»å‹ä¿¡æ¯ã€‚</li><li><strong>å½±å“</strong>ï¼šæ— æ³•è¿›è¡Œç±»å‹æ£€æŸ¥ã€æ— æ³•è·å–æ³›å‹ç±»å‹å‚æ•°ç­‰ï¼Œä½†å¯ä»¥é€šè¿‡é€šé…ç¬¦å’Œåå°„ç­‰æ‰‹æ®µå…‹æœè¿™äº›é™åˆ¶ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>75-17 SIDC</title>
      <link href="/2025/02/26/75-17%20SIDC%20README/"/>
      <url>/2025/02/26/75-17%20SIDC%20README/</url>
      
        <content type="html"><![CDATA[<h1 id="75-17-SIDC"><a href="#75-17-SIDC" class="headerlink" title="75-17 SIDC"></a>75-17 SIDC</h1><h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a>é¡¹ç›®ç®€ä»‹</h2><p>SIDC æ˜¯ä¸€ä¸ªä¸“ä¸ºæŠ€æœ¯å¼€å‘è€…è®¾è®¡çš„åšå®¢é˜…è¯»ä¸ç®¡ç†å¹³å°ï¼Œæ—¨åœ¨ä¸ºç”¨æˆ·æä¾›é«˜æ•ˆã€ä¾¿æ·çš„åšå®¢åˆ›ä½œä¸åˆ†äº«ä½“éªŒã€‚ä¸ä¼ ç»Ÿçš„åšå®¢å¹³å°ï¼ˆå¦‚ CSDNï¼‰ç›¸æ¯”ï¼ŒSIDC åœ¨åŠŸèƒ½ä¸Šè¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œç‰¹åˆ«æ˜¯åœ¨åšå®¢ä¸Šä¼ ä¸å›¾ç‰‡ç®¡ç†æ–¹é¢ï¼Œæå¤§åœ°æå‡äº†ç”¨æˆ·çš„æ“ä½œæ•ˆç‡ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ SIDC è½»æ¾ä¸Šä¼  Markdown æ ¼å¼çš„åšå®¢å†…å®¹ï¼Œå¹¶åˆ©ç”¨å…¶ç‹¬æœ‰çš„ <strong>ä¸€é”®å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½</strong>ï¼Œè‡ªåŠ¨å°†åšå®¢ä¸­çš„æœ¬åœ°å›¾ç‰‡ä¸Šä¼ è‡³äº‘ç«¯ï¼ŒåŒæ—¶æ™ºèƒ½æ›¿æ¢ Markdown æ–‡ä»¶ä¸­çš„å›¾ç‰‡åœ°å€ï¼Œå½»åº•è§£å†³äº†ä¼ ç»Ÿå¹³å°éœ€è¦æ‰‹åŠ¨é€å¼ ä¸Šä¼ å›¾ç‰‡çš„ç¹çé—®é¢˜ã€‚</p><p>æ­¤å¤–ï¼ŒSIDC è¿˜æä¾›äº†ä¸°å¯Œçš„ç¤¾äº¤äº’åŠ¨åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¹³å°ä¸Šæ·»åŠ å¥½å‹ã€ç§ä¿¡äº¤æµï¼Œç”šè‡³é€šè¿‡åšå®¢ç•™è¨€åŠŸèƒ½ä¸å…¶ä»–å¼€å‘è€…è¿›è¡Œæ·±åº¦è®¨è®ºã€‚æ— è®ºæ˜¯ <strong>åšå®¢é˜…è¯»</strong>ã€<strong>åšå®¢åˆ›ä½œ</strong>ï¼Œè¿˜æ˜¯ <strong>æŠ€æœ¯äº¤æµ</strong>ï¼ŒSIDC éƒ½è‡´åŠ›äºä¸ºç”¨æˆ·æ‰“é€ ä¸€ä¸ªé«˜æ•ˆã€å‹å¥½çš„æŠ€æœ¯ç¤¾åŒºç¯å¢ƒï¼Œå¸®åŠ©å¼€å‘è€…æ›´ä¸“æ³¨äºå†…å®¹åˆ›ä½œä¸çŸ¥è¯†åˆ†äº«ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262042240.png" alt="image-20250226113223684"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043069.png" alt="image-20250226113404272"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043088.png" alt="image-20250226113501879"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043693.png" alt="image-20250226113544607"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043320.png" alt="image-20250226132256925"></p><h2 id="é¡¹ç›®æœ¬åœ°éƒ¨ç½²"><a href="#é¡¹ç›®æœ¬åœ°éƒ¨ç½²" class="headerlink" title="é¡¹ç›®æœ¬åœ°éƒ¨ç½²"></a>é¡¹ç›®æœ¬åœ°éƒ¨ç½²</h2><ol><li>å¯¼å…¥æ•°æ®åº“è‡³æœ¬åœ°ï¼Œä½¿ç”¨çš„æ•°æ®åº“æ˜¯MySQLï¼›<br><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043058.png" alt="image-20250226132710840"></li><li>ç„¶åä¿®æ”¹å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç›¸å…³æœ¬åœ°MySQLæ•°æ®åº“å¯†ç ç¡®ä¿Nacoså¯ä»¥è®¿é—®åˆ°æ•°æ®åº“ï¼›<br><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043619.png" alt="image-20250226133021002"></li><li>å¯åŠ¨Nacosï¼›<br><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043000.png" alt="image-20250226133106467"></li><li>è®¿é—®ä¸Šå›¾ä¸­çš„ç½‘å€ï¼Œç„¶åä¿®æ”¹è¿™é‡Œé¢çš„é…ç½®ï¼Œæ¶‰åŠåˆ°çš„ç›¸å…³é…ç½®æœ‰MySQLã€Redisã€RabbitMQã€MinIOç­‰ç›¸å…³é…ç½®ï¼›<br><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043908.png" alt="image-20250226133427675"></li><li>å¦‚ï¼š<br><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043425.png" alt="image-20250226133528225"></li><li>ç„¶åä¾æ¬¡å¯åŠ¨ï¼š<br><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043945.png" alt="image-20250226133832892"></li><li>ç„¶åå¯åŠ¨å‰ç«¯é¡¹ç›®githubåœ°å€ä¸ºï¼š<a href="https://github.com/fangyaohui/screw-it-development-poetize">https://github.com/fangyaohui/screw-it-development-poetize</a><br>å‘½ä»¤è¡Œæ‰§è¡Œnpm run serveå³å¯</li></ol><h2 id="åŠŸèƒ½æ¨¡å—è®¾è®¡ä»‹ç»"><a href="#åŠŸèƒ½æ¨¡å—è®¾è®¡ä»‹ç»" class="headerlink" title="åŠŸèƒ½æ¨¡å—è®¾è®¡ä»‹ç»"></a>åŠŸèƒ½æ¨¡å—è®¾è®¡ä»‹ç»</h2><h3 id="å³æ—¶é€šä¿¡äº¤æµæ¨¡å—"><a href="#å³æ—¶é€šä¿¡äº¤æµæ¨¡å—" class="headerlink" title="å³æ—¶é€šä¿¡äº¤æµæ¨¡å—"></a>å³æ—¶é€šä¿¡äº¤æµæ¨¡å—</h3><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262114387.png" alt="image-20250226132256925"></p><p>è¯¥å³æ—¶é€šä¿¡äº¤æµæ¨¡å—æ˜¯åŸºäºWebSocketæ¥å®ç°çš„ï¼Œ</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>77 äº‘æœåŠ¡å™¨&amp;Linuxç³»ç»Ÿ</title>
      <link href="/2025/02/26/77%20%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8&amp;Linux%E7%B3%BB%E7%BB%9F/"/>
      <url>/2025/02/26/77%20%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8&amp;Linux%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="77-äº‘æœåŠ¡å™¨-Linuxç³»ç»Ÿ"><a href="#77-äº‘æœåŠ¡å™¨-Linuxç³»ç»Ÿ" class="headerlink" title="77 äº‘æœåŠ¡å™¨&amp;Linuxç³»ç»Ÿ"></a>77 äº‘æœåŠ¡å™¨&amp;Linuxç³»ç»Ÿ</h1><h2 id="äº‘æœåŠ¡åŸºæœ¬ä¿¡æ¯"><a href="#äº‘æœåŠ¡åŸºæœ¬ä¿¡æ¯" class="headerlink" title="äº‘æœåŠ¡åŸºæœ¬ä¿¡æ¯"></a>äº‘æœåŠ¡åŸºæœ¬ä¿¡æ¯</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æœåŠ¡å™¨å¯†ç ï¼š</span><br><span class="line">!Fyh2380514719</span><br><span class="line">åœ°å€ï¼š</span><br><span class="line">https://console.huaweicloud.com/shell?agencyId=fa161028e1e341ab87bbae593a14a674&amp;region=cn-east-3&amp;locale=zh-cn#/remote/suiu94dmgr52arf</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="LinuxåŸºæœ¬å‘½ä»¤"><a href="#LinuxåŸºæœ¬å‘½ä»¤" class="headerlink" title="LinuxåŸºæœ¬å‘½ä»¤"></a>LinuxåŸºæœ¬å‘½ä»¤</h2><h3 id="linux-æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µ-å†…å­˜æ¶ˆè€—ä»å¤§åˆ°å°"><a href="#linux-æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µ-å†…å­˜æ¶ˆè€—ä»å¤§åˆ°å°" class="headerlink" title="linux æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µ å†…å­˜æ¶ˆè€—ä»å¤§åˆ°å°"></a>linux æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µ å†…å­˜æ¶ˆè€—ä»å¤§åˆ°å°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top </span><br></pre></td></tr></table></figure><h3 id="linux-å¼ºåˆ¶åˆ é™¤æ–‡ä»¶å¤¹"><a href="#linux-å¼ºåˆ¶åˆ é™¤æ–‡ä»¶å¤¹" class="headerlink" title="linux å¼ºåˆ¶åˆ é™¤æ–‡ä»¶å¤¹"></a>linux å¼ºåˆ¶åˆ é™¤æ–‡ä»¶å¤¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -rï¼šé€’å½’åˆ é™¤ç›®å½•åŠå…¶å†…å®¹ã€‚</span><br><span class="line">rm -fï¼šå¼ºåˆ¶åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œä¸ä¼šæç¤ºç¡®è®¤ã€‚</span><br><span class="line">rm -rfï¼šé€’å½’åˆ é™¤ç›®å½•åŠå…¶å†…å®¹ï¼Œå¹¶ä¸”ä¸ä¼šæç¤ºç¡®è®¤ã€‚</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç«¯å£å·"><a href="#æŸ¥çœ‹ç«¯å£å·" class="headerlink" title="æŸ¥çœ‹ç«¯å£å·"></a>æŸ¥çœ‹ç«¯å£å·</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tulnp | grep &lt;port&gt;</span><br></pre></td></tr></table></figure><h3 id="å…³é—­æŒ‡å®šç«¯å£å·"><a href="#å…³é—­æŒ‡å®šç«¯å£å·" class="headerlink" title="å…³é—­æŒ‡å®šç«¯å£å·"></a>å…³é—­æŒ‡å®šç«¯å£å·</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tulnp | grep &lt;port&gt;</span><br><span class="line">sudo systemctl stop redis</span><br></pre></td></tr></table></figure><h3 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹firewallæœåŠ¡çŠ¶æ€</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line"># å¼€å¯ã€é‡å¯ã€å…³é—­ã€firewalld.serviceæœåŠ¡</span><br><span class="line"># å¼€å¯</span><br><span class="line">service firewalld start</span><br><span class="line"># é‡å¯</span><br><span class="line">service firewalld restart</span><br><span class="line"># å…³é—­</span><br><span class="line">service firewalld stop</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™</span><br><span class="line">firewall-cmd --list-all    # æŸ¥çœ‹å…¨éƒ¨ä¿¡æ¯</span><br><span class="line">firewall-cmd --list-ports  # åªçœ‹ç«¯å£ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"># å¼€å¯ç«¯å£</span><br><span class="line">å¼€ç«¯å£å‘½ä»¤ï¼šfirewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line">é‡å¯é˜²ç«å¢™ï¼šsystemctl restart firewalld.service</span><br><span class="line"></span><br><span class="line">å‘½ä»¤å«ä¹‰ï¼š</span><br><span class="line">--zone #ä½œç”¨åŸŸ</span><br><span class="line">--add-port=80/tcp  #æ·»åŠ ç«¯å£ï¼Œæ ¼å¼ä¸ºï¼šç«¯å£/é€šè®¯åè®®</span><br><span class="line">--permanent   #æ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆ</span><br><span class="line"></span><br><span class="line">#å¸¸ç”¨çš„firewallå‘½ä»¤å¸¸ç”¨å‘½ä»¤ä»‹ç»</span><br><span class="line">1 firewall-cmd --state                           ##æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ï¼Œæ˜¯å¦æ˜¯running</span><br><span class="line"> 2 firewall-cmd --reload                          ##é‡æ–°è½½å…¥é…ç½®ï¼Œæ¯”å¦‚æ·»åŠ è§„åˆ™ä¹‹åï¼Œéœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤</span><br><span class="line"> 3 firewall-cmd --get-zones                       ##åˆ—å‡ºæ”¯æŒçš„zone</span><br><span class="line"> 4 firewall-cmd --get-services                    ##åˆ—å‡ºæ”¯æŒçš„æœåŠ¡ï¼Œåœ¨åˆ—è¡¨ä¸­çš„æœåŠ¡æ˜¯æ”¾è¡Œçš„</span><br><span class="line"> 5 firewall-cmd --query-service ftp               ##æŸ¥çœ‹ftpæœåŠ¡æ˜¯å¦æ”¯æŒï¼Œè¿”å›yesæˆ–è€…no</span><br><span class="line"> 6 firewall-cmd --add-service=ftp                 ##ä¸´æ—¶å¼€æ”¾ftpæœåŠ¡</span><br><span class="line"> 7 firewall-cmd --add-service=ftp --permanent     ##æ°¸ä¹…å¼€æ”¾ftpæœåŠ¡</span><br><span class="line"> 8 firewall-cmd --remove-service=ftp --permanent  ##æ°¸ä¹…ç§»é™¤ftpæœåŠ¡</span><br><span class="line"> 9 firewall-cmd --add-port=80/tcp --permanent     ##æ°¸ä¹…æ·»åŠ 80ç«¯å£ </span><br><span class="line">10 firewall-cmd --remove-port=80/tcp --permanent  ##æ°¸ä¹…ç§»é™¤80ç«¯å£</span><br><span class="line">11 firewall-cmd --list-ports                      ##æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£</span><br><span class="line">12 iptables -L -n                                 ##æŸ¥çœ‹è§„åˆ™ï¼Œè¿™ä¸ª</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨Rediså’Œminio"><a href="#å¯åŠ¨Rediså’Œminio" class="headerlink" title="å¯åŠ¨Rediså’Œminio"></a>å¯åŠ¨Rediså’Œminio</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ../home/fang/software/redis/redis-6.0.5/src redis-server ../redis.conf</span><br><span class="line"></span><br><span class="line">cd ../usr/local/bin minio server /opt/minio-data/</span><br><span class="line">sudo ./minio server --address :9000 --console-address :9001 /opt/minio-data/</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable redis</span><br><span class="line">systemctl status redis</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /usr/lib/systemd/system/minio.service</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=MinIO</span><br><span class="line">Documentation=https://docs.min.io</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line">AssertFileIsExecutable=/usr/local/Minio/minio</span><br><span class="line">[Service]</span><br><span class="line">WorkingDirectory=/usr/local/</span><br><span class="line"> </span><br><span class="line">#ProtectProc=invisible</span><br><span class="line"> </span><br><span class="line"># æŒ‡å‘3.1èŠ‚ä¸­çš„é…ç½®æ–‡ä»¶</span><br><span class="line">EnvironmentFile=/etc/default/minio</span><br><span class="line"> </span><br><span class="line"># ExecStartPre=/bin/bash -c &quot;if [ -z \&quot;$&#123;MINIO_VOLUMES&#125;\&quot; ]; then echo \&quot;Variable MINIO_VOLUMES not set in /etc/default/minio\&quot;; exit 1; fi&quot;</span><br><span class="line">ExecStart=/usr/local/Minio/minio server --address :9000 --console-address :9001 /minio</span><br><span class="line"> </span><br><span class="line"># Let systemd restart this service always</span><br><span class="line">Restart=always</span><br><span class="line"> </span><br><span class="line"># Specifies the maximum (1M) file descriptor number that can be opened by this process</span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line"> </span><br><span class="line"># Specifies the maximum number of threads this process can create</span><br><span class="line">TasksMax=infinity</span><br><span class="line"> </span><br><span class="line"># Disable timeout logic and wait until process is stopped</span><br><span class="line">TimeoutStopSec=infinity</span><br><span class="line">SendSIGKILL=no</span><br><span class="line">SuccessExitStatus=0</span><br><span class="line"> </span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">Alias=minio.service</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># é‡æ–°åŠ è½½æœåŠ¡é…ç½®æ–‡ä»¶ï¼Œä½¿æœåŠ¡ç”Ÿæ•ˆ</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"> </span><br><span class="line"># å°†æœåŠ¡è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</span><br><span class="line">sudo systemctl enable minio</span><br><span class="line"> </span><br><span class="line"># æœåŠ¡ç«‹å³å¯åŠ¨</span><br><span class="line">sudo systemctl start minio</span><br><span class="line"> </span><br><span class="line"># æŸ¥çœ‹minioæœåŠ¡å½“å‰çŠ¶æ€</span><br><span class="line">systemctl status minio</span><br></pre></td></tr></table></figure><h2 id="Vueé¡¹ç›®æ‰“åŒ…åˆ°æœåŠ¡å™¨"><a href="#Vueé¡¹ç›®æ‰“åŒ…åˆ°æœåŠ¡å™¨" class="headerlink" title="Vueé¡¹ç›®æ‰“åŒ…åˆ°æœåŠ¡å™¨"></a>Vueé¡¹ç›®æ‰“åŒ…åˆ°æœåŠ¡å™¨</h2><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043840.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262043366.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262044524.png" alt="img"></p><h3 id="è§£å†³CORSé—®é¢˜"><a href="#è§£å†³CORSé—®é¢˜" class="headerlink" title="è§£å†³CORSé—®é¢˜"></a>è§£å†³CORSé—®é¢˜</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">worker_processes  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.<span class="property">types</span>;</span><br><span class="line">    default_type  application/json;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    </span><br><span class="line">    keepalive_timeout  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       <span class="number">8080</span>;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        # æŒ‡å®šå‰ç«¯é¡¹ç›®æ‰€åœ¨çš„ä½ç½®</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html/dist;</span><br><span class="line">            index  index.<span class="property">html</span> index.<span class="property">htm</span>;</span><br><span class="line">            # å…è®¸æ‰€æœ‰åŸŸåè®¿é—®</span><br><span class="line">            add_header <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">            # å…è®¸æµè§ˆå™¨è·å–å“åº”ï¼Œå®é™…è¯·æ±‚éœ€è¦åœ¨é¢„æ£€è¯·æ±‚ä¸­éªŒè¯</span><br><span class="line">            add_header <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="string">&#x27;GET, POST, OPTIONS&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            # å…è®¸æµè§ˆå™¨è·å–å“ªäº›å¤´ä¿¡æ¯</span><br><span class="line">            add_header <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="string">&#x27;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            # å…è®¸æµè§ˆå™¨ç¼“å­˜é¢„æ£€è¯·æ±‚çš„ç»“æœ</span><br><span class="line">            add_header <span class="string">&#x27;Access-Control-Max-Age&#x27;</span> <span class="number">1728000</span>;</span><br><span class="line"></span><br><span class="line">            # å…è®¸æºå¸¦å‡­è¯ï¼Œä¾‹å¦‚ <span class="title class_">Cookies</span></span><br><span class="line">            add_header <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> ($request_method = <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">                add_header <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">                add_header <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="string">&#x27;GET, POST, OPTIONS&#x27;</span>;</span><br><span class="line">                add_header <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="string">&#x27;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#x27;</span>;</span><br><span class="line">                add_header <span class="string">&#x27;Access-Control-Max-Age&#x27;</span> <span class="number">1728000</span>;</span><br><span class="line">                add_header <span class="string">&#x27;Content-Type&#x27;</span> <span class="string">&#x27;text/plain charset=UTF-8&#x27;</span>;</span><br><span class="line">                add_header <span class="string">&#x27;Content-Length&#x27;</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">204</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.<span class="property">html</span>;</span><br><span class="line">        location = /50x.<span class="property">html</span> &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location /api &#123;  </span><br><span class="line">            default_type  application/json;</span><br><span class="line">            #internal;  </span><br><span class="line">            keepalive_timeout   30s;  </span><br><span class="line">            keepalive_requests  <span class="number">1000</span>;  </span><br><span class="line">            #æ”¯æŒkeep-alive  </span><br><span class="line">            proxy_http_version <span class="number">1.1</span>;  </span><br><span class="line">            rewrite /<span class="title function_">api</span>(/.*) $1 <span class="keyword">break</span>;  </span><br><span class="line">            proxy_pass_request_headers on;</span><br><span class="line">            #more_clear_input_headers <span class="title class_">Accept</span>-<span class="title class_">Encoding</span>;  </span><br><span class="line">            proxy_next_upstream error timeout;  </span><br><span class="line">            proxy_pass <span class="attr">http</span>:<span class="comment">//127.0.0.1:61237;</span></span><br><span class="line">            #proxy_pass <span class="attr">http</span>:<span class="comment">//backend;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8081</span> max_fails=<span class="number">5</span> fail_timeout=10s weight=<span class="number">1</span>;</span><br><span class="line">        #server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8082</span> max_fails=<span class="number">5</span> fail_timeout=10s weight=<span class="number">1</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="gateway"><a href="#gateway" class="headerlink" title="gateway"></a>gateway</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">globalcors:</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">cors-configurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOriginPatterns:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&#x27;http://localhost:13628&#x27;</span> <span class="comment">#è·¨åŸŸå¤„ç† å…è®¸æ‰€æœ‰çš„åŸŸ</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&#x27;http://localhost:8080&#x27;</span> <span class="comment">#è·¨åŸŸå¤„ç† å…è®¸æ‰€æœ‰çš„åŸŸ</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://localhost&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">3600000</span></span><br></pre></td></tr></table></figure><h3 id="Nginxå¯åŠ¨"><a href="#Nginxå¯åŠ¨" class="headerlink" title="Nginxå¯åŠ¨"></a>Nginxå¯åŠ¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br><span class="line">sudo systemctl start nginx</span><br><span class="line">sudo systemctl stop nginx</span><br><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure><h3 id="Vueé¡¹ç›®æ‰“åŒ…æ”¾ç½®"><a href="#Vueé¡¹ç›®æ‰“åŒ…æ”¾ç½®" class="headerlink" title="Vueé¡¹ç›®æ‰“åŒ…æ”¾ç½®"></a>Vueé¡¹ç›®æ‰“åŒ…æ”¾ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/nginx/html</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">         try_files $uri $uri/ /index.html;</span><br><span class="line">           root   html/dist;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">           # å…è®¸æ‰€æœ‰åŸŸåè®¿é—®</span><br><span class="line">           add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">           # å…è®¸æµè§ˆå™¨è·å–å“åº”ï¼Œå®é™…è¯·æ±‚éœ€è¦åœ¨é¢„æ£€è¯·æ±‚ä¸­éªŒè¯</span><br><span class="line">           add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line"></span><br><span class="line">           # å…è®¸æµè§ˆå™¨è·å–å“ªäº›å¤´ä¿¡æ¯</span><br><span class="line">           add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#x27;;</span><br><span class="line"></span><br><span class="line">           # å…è®¸æµè§ˆå™¨ç¼“å­˜é¢„æ£€è¯·æ±‚çš„ç»“æœ</span><br><span class="line">           add_header &#x27;Access-Control-Max-Age&#x27; 1728000;</span><br><span class="line"></span><br><span class="line">           # å…è®¸æºå¸¦å‡­è¯ï¼Œä¾‹å¦‚ Cookies</span><br><span class="line">           add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;</span><br><span class="line">           if ($request_method = &#x27;OPTIONS&#x27;) &#123;</span><br><span class="line">               add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">               add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line">               add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#x27;;</span><br><span class="line">               add_header &#x27;Access-Control-Max-Age&#x27; 1728000;</span><br><span class="line">               add_header &#x27;Content-Type&#x27; &#x27;text/plain charset=UTF-8&#x27;;</span><br><span class="line">               add_header &#x27;Content-Length&#x27; 0;</span><br><span class="line">               return 204;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>78 Gerrit&amp;GitLab Windowsç¯å¢ƒä¸‹å®‰è£…</title>
      <link href="/2025/02/26/78%20Gerrit&amp;GitLab%E5%AE%89%E8%A3%85/"/>
      <url>/2025/02/26/78%20Gerrit&amp;GitLab%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h1 id="78-Gerrit-GitLab-Windowsç¯å¢ƒä¸‹å®‰è£…"><a href="#78-Gerrit-GitLab-Windowsç¯å¢ƒä¸‹å®‰è£…" class="headerlink" title="78 Gerrit&amp;GitLab Windowsç¯å¢ƒä¸‹å®‰è£…"></a>78 Gerrit&amp;GitLab Windowsç¯å¢ƒä¸‹å®‰è£…</h1><h2 id="Gerrit-Windowså®‰è£…"><a href="#Gerrit-Windowså®‰è£…" class="headerlink" title="Gerrit Windowså®‰è£…"></a>Gerrit Windowså®‰è£…</h2><h3 id="Windows-dockerå®‰è£…"><a href="#Windows-dockerå®‰è£…" class="headerlink" title="Windows dockerå®‰è£…"></a>Windows dockerå®‰è£…</h3><p>è®¾ç½®ä»£ç†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;builder&quot;: &#123;</span><br><span class="line">    &quot;gc&quot;: &#123;</span><br><span class="line">      &quot;defaultKeepStorage&quot;: &quot;20GB&quot;,</span><br><span class="line">      &quot;enabled&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;experimental&quot;: false,</span><br><span class="line">  &quot;features&quot;: &#123;</span><br><span class="line">    &quot;buildkit&quot;: true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">    &quot;https://docker.211678.top&quot;,</span><br><span class="line">    &quot;https://docker.1panel.live&quot;,</span><br><span class="line">    &quot;https://hub.rat.dev&quot;,</span><br><span class="line">    &quot;https://docker.m.daocloud.io&quot;,</span><br><span class="line">    &quot;https://do.nark.eu.org&quot;,</span><br><span class="line">    &quot;https://dockerpull.com&quot;,</span><br><span class="line">    &quot;https://dockerproxy.cn&quot;,</span><br><span class="line">    &quot;https://docker.awsl9527.cn&quot;,</span><br><span class="line">    &quot;https://docker.m.daocloud.io&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JDKå®‰è£…"><a href="#JDKå®‰è£…" class="headerlink" title="JDKå®‰è£…"></a>JDKå®‰è£…</h3><p>å®‰è½¬JAVA11ç‰ˆæœ¬ä¹‹ä¸Šï¼Œæœ¬åœ°éªŒè¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><p>é…ç½®JAVA_HOMEä¸ºJDK17æ‰€åœ¨ç›®å½•ï¼Œé…ç½®ä¸ºJDKç›®å½•ä¸‹çš„binä¸‹å³å¯ã€‚</p><h3 id="Apacheå®‰è£…"><a href="#Apacheå®‰è£…" class="headerlink" title="Apacheå®‰è£…"></a>Apacheå®‰è£…</h3><p><a href="https://blog.csdn.net/qq_40994734/article/details/107142420">https://blog.csdn.net/qq_40994734/article/details/107142420</a></p><h2 id="Gerritå®‰è£…"><a href="#Gerritå®‰è£…" class="headerlink" title="Gerritå®‰è£…"></a>Gerritå®‰è£…</h2><p><a href="https://blog.csdn.net/qq_45939519/article/details/131480503">https://blog.csdn.net/qq_45939519/article/details/131480503</a></p><p><a href="https://www.cnblogs.com/anliven/p/12019974.html">https://www.cnblogs.com/anliven/p/12019974.html</a></p><h2 id="Dockeréƒ¨ç½²Gerrit-GitLab"><a href="#Dockeréƒ¨ç½²Gerrit-GitLab" class="headerlink" title="Dockeréƒ¨ç½²Gerrit&amp;GitLab"></a>Dockeréƒ¨ç½²Gerrit&amp;GitLab</h2><p><a href="https://blog.csdn.net/milk448249712/article/details/115169449">https://blog.csdn.net/milk448249712/article/details/115169449</a></p><p>[CI&#x2F;CD ç¯å¢ƒæ­å»ºï¼šDocker+Jenkins+Gerrit](CI&#x2F;CD ç¯å¢ƒæ­å»ºï¼šDocker+Jenkins+Gerrit)</p><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li><a href="https://www.cnblogs.com/anliven/p/12019974.html">Gerrit - Gerritä¸GitLabé›†æˆ</a></li><li>[CI&#x2F;CD ç¯å¢ƒæ­å»ºï¼šDocker+Jenkins+Gerrit](CI&#x2F;CD ç¯å¢ƒæ­å»ºï¼šDocker+Jenkins+Gerrit)</li></ol><h3 id="å®‰è£…docker-docker-compose"><a href="#å®‰è£…docker-docker-compose" class="headerlink" title="å®‰è£…docker&amp;docker-compose"></a>å®‰è£…docker&amp;docker-compose</h3><p>ç•¥è¿‡</p><h3 id="docker-compose-ymlæ–‡ä»¶"><a href="#docker-compose-ymlæ–‡ä»¶" class="headerlink" title="docker-compose.ymlæ–‡ä»¶"></a>docker-compose.ymlæ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">gerrit:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gerritcodereview/gerrit:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;29418:29418&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8091:8080&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ldap</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/on/host/gerrit/review_site:/var/gerrit/review_site</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/on/host/gerrit/etc:/var/gerrit/etc</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/on/host/gerrit/git:/var/gerrit/git</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/on/host/gerrit/db:/var/gerrit/db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/on/host/gerrit/index:/var/gerrit/index</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/on/host/gerrit/cache:/var/gerrit/cache</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CANONICAL_WEB_URL=http://localhost:8091</span></span><br><span class="line">    <span class="comment"># entrypoint: /entrypoint.sh init</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ldap:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">osixia/openldap</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;389:389&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;636:636&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LDAP_ADMIN_PASSWORD=secret</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/docker/gerrit/ldap/var:/var/lib/ldap</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/docker/gerrit/ldap/etc:/etc/ldap/slapd.d</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ldap-admin:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">osixia/phpldapadmin</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6443:443&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PHPLDAPADMIN_LDAP_HOSTS=ldap</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Gerrit-GitLabè¿æ¥"><a href="#Gerrit-GitLabè¿æ¥" class="headerlink" title="Gerrit&amp;GitLabè¿æ¥"></a>Gerrit&amp;GitLabè¿æ¥</h3><p>dockerä¸­Gerritå®¹å™¨é…ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202502262044049.png" alt="image-20241124203231073"></p><h3 id="4-åœ¨Gerritä¸­åˆ›å»ºé¡¹ç›®"><a href="#4-åœ¨Gerritä¸­åˆ›å»ºé¡¹ç›®" class="headerlink" title="4 - åœ¨Gerritä¸­åˆ›å»ºé¡¹ç›®"></a>4 - åœ¨Gerritä¸­åˆ›å»ºé¡¹ç›®</h3><p>è¯·å‚è€ƒï¼š<a href="https://www.cnblogs.com/anliven/p/12019974.html">https://www.cnblogs.com/anliven/p/12019974.html</a></p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>79-00 æ™ºå·äº‘å¼€å‘æµç¨‹</title>
      <link href="/2025/02/26/79-00%20%E6%99%BA%E5%8D%B7%E4%BA%91%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"/>
      <url>/2025/02/26/79-00%20%E6%99%BA%E5%8D%B7%E4%BA%91%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="79-00-æ™ºå·äº‘å¼€å‘æµç¨‹"><a href="#79-00-æ™ºå·äº‘å¼€å‘æµç¨‹" class="headerlink" title="79-00 æ™ºå·äº‘å¼€å‘æµç¨‹"></a>79-00 æ™ºå·äº‘å¼€å‘æµç¨‹</h1><h2 id="ä¸€ã€éœ€æ±‚åˆ†æä¸è§„åˆ’é˜¶æ®µ"><a href="#ä¸€ã€éœ€æ±‚åˆ†æä¸è§„åˆ’é˜¶æ®µ" class="headerlink" title="ä¸€ã€éœ€æ±‚åˆ†æä¸è§„åˆ’é˜¶æ®µ"></a><strong>ä¸€ã€éœ€æ±‚åˆ†æä¸è§„åˆ’é˜¶æ®µ</strong></h2><h3 id="1-1-ç”¨æˆ·éœ€æ±‚è°ƒç ”"><a href="#1-1-ç”¨æˆ·éœ€æ±‚è°ƒç ”" class="headerlink" title="1.1 ç”¨æˆ·éœ€æ±‚è°ƒç ”"></a><strong>1.1 ç”¨æˆ·éœ€æ±‚è°ƒç ”</strong></h3><p><strong>ç›®æ ‡</strong>ï¼šæ˜ç¡®ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½ã€ç”¨æˆ·è§’è‰²åŠä½¿ç”¨åœºæ™¯ã€‚<br><strong>æ­¥éª¤</strong>ï¼š  </p><ol><li><strong>ç”¨æˆ·è®¿è°ˆ</strong>ï¼šä¸æ•™å¸ˆã€æ•™ç ”å‘˜ã€æ•™è‚²æœºæ„ç®¡ç†è€…è¿›è¡Œæ·±åº¦è®¿è°ˆï¼Œèšç„¦ä»¥ä¸‹é—®é¢˜ï¼š<br>â€¢ å½“å‰ç»„å·æµç¨‹ä¸­çš„ç—›ç‚¹ï¼ˆå¦‚é¢˜åº“åˆ†æ•£ã€é¢˜ç›®ç­›é€‰æ•ˆç‡ä½ï¼‰ã€‚<br>â€¢ æœŸæœ›çš„æ™ºèƒ½åŠŸèƒ½ï¼ˆå¦‚è‡ªåŠ¨åŒ¹é…çŸ¥è¯†ç‚¹ã€éš¾åº¦åˆ†çº§ã€é¢˜å‹æ¯”ä¾‹æ§åˆ¶ï¼‰ã€‚<br>â€¢ å¯¹æ•°æ®åˆ†æçš„éœ€æ±‚ï¼ˆå¦‚å­¦ç”Ÿé”™é¢˜ç»Ÿè®¡ã€è¯•å·è´¨é‡è¯„ä¼°ï¼‰ã€‚  </li><li><strong>é—®å·è°ƒæŸ¥</strong>ï¼šé¢å‘500+ç”¨æˆ·å‘æ”¾é—®å·ï¼Œé‡åŒ–éœ€æ±‚ä¼˜å…ˆçº§ï¼Œä¾‹å¦‚ï¼š<br>â€¢ 80%ç”¨æˆ·éœ€è¦â€œä¸€é”®ç”Ÿæˆç¬¦åˆè€ƒçº²çš„è¯•å·â€ã€‚<br>â€¢ 65%ç”¨æˆ·å¸Œæœ›æ”¯æŒâ€œè·¨å­¦ç§‘ç»„å·â€ã€‚  </li><li><strong>ç«å“åˆ†æ</strong>ï¼šç ”ç©¶åŒç±»äº§å“ï¼ˆå¦‚å­¦ç§‘ç½‘ã€èä¼˜ç½‘ï¼‰ï¼Œæ€»ç»“åŠŸèƒ½äº®ç‚¹ä¸ä¸è¶³ã€‚</li></ol><p><strong>è¾“å‡ºç‰©</strong>ï¼š<br>â€¢ ã€Šç”¨æˆ·éœ€æ±‚è°ƒç ”æŠ¥å‘Šã€‹<br>â€¢ ã€Šç”¨æˆ·ç”»åƒæ–‡æ¡£ã€‹ï¼ˆå¦‚æ•™å¸ˆç”¨æˆ·ã€å­¦æ ¡ç®¡ç†å‘˜ã€å­¦ç”Ÿè§’è‰²ï¼‰ã€‚  </p><hr><h3 id="1-2-éœ€æ±‚å®šä¹‰ä¸åŠŸèƒ½è§„åˆ’"><a href="#1-2-éœ€æ±‚å®šä¹‰ä¸åŠŸèƒ½è§„åˆ’" class="headerlink" title="1.2 éœ€æ±‚å®šä¹‰ä¸åŠŸèƒ½è§„åˆ’"></a><strong>1.2 éœ€æ±‚å®šä¹‰ä¸åŠŸèƒ½è§„åˆ’</strong></h3><p><strong>ç›®æ ‡</strong>ï¼šå°†éœ€æ±‚è½¬åŒ–ä¸ºå…·ä½“åŠŸèƒ½æ¨¡å—å’ŒæŠ€æœ¯æŒ‡æ ‡ã€‚<br><strong>æ­¥éª¤</strong>ï¼š  </p><ol><li><strong>æ ¸å¿ƒåŠŸèƒ½æ‹†è§£</strong>ï¼š<br>â€¢ <strong>æ™ºèƒ½ç»„å·å¼•æ“</strong>ï¼šåŸºäºçŸ¥è¯†ç‚¹å›¾è°±çš„é¢˜ç›®æ¨èç®—æ³•ã€‚<br>â€¢ <strong>é¢˜åº“ç®¡ç†</strong>ï¼šæ”¯æŒé¢˜ç›®æ‰¹é‡å¯¼å…¥ã€æ ‡ç­¾åˆ†ç±»ï¼ˆå­¦ç§‘ã€å¹´çº§ã€éš¾åº¦ï¼‰ã€‚<br>â€¢ <strong>è¯•å·è‡ªå®šä¹‰ç¼–è¾‘</strong>ï¼šæ‰‹åŠ¨è°ƒæ•´é¢˜ç›®é¡ºåºã€æ›¿æ¢é¢˜ç›®ã€è®¾ç½®åˆ†å€¼ä¸æ’ç‰ˆã€‚<br>â€¢ <strong>æ•°æ®åˆ†æé¢æ¿</strong>ï¼šç»„å·è€—æ—¶ç»Ÿè®¡ã€é¢˜ç›®ä½¿ç”¨é¢‘ç‡åˆ†æã€‚  </li><li><strong>éåŠŸèƒ½æ€§éœ€æ±‚</strong>ï¼š<br>â€¢ å“åº”æ—¶é—´ï¼šç»„é¡µç”Ÿæˆâ‰¤3ç§’ï¼ˆ95%åœºæ™¯ï¼‰ã€‚<br>â€¢ å¹¶å‘èƒ½åŠ›ï¼šæ”¯æŒ1000+æ•™å¸ˆåŒæ—¶åœ¨çº¿ç»„å·ã€‚<br>â€¢ å®‰å…¨æ€§ï¼šé¢˜ç›®æ•°æ®åŠ å¯†å­˜å‚¨ï¼Œæƒé™åˆ†çº§ç®¡ç†ã€‚</li></ol><p><strong>è¾“å‡ºç‰©</strong>ï¼š<br>â€¢ ã€Šäº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰ã€‹<br>â€¢ ã€Šç³»ç»ŸåŠŸèƒ½æ¶æ„å›¾ã€‹  </p><hr><h2 id="äºŒã€ç³»ç»Ÿè®¾è®¡é˜¶æ®µ"><a href="#äºŒã€ç³»ç»Ÿè®¾è®¡é˜¶æ®µ" class="headerlink" title="äºŒã€ç³»ç»Ÿè®¾è®¡é˜¶æ®µ"></a><strong>äºŒã€ç³»ç»Ÿè®¾è®¡é˜¶æ®µ</strong></h2><h3 id="2-1-æŠ€æœ¯æ¶æ„è®¾è®¡"><a href="#2-1-æŠ€æœ¯æ¶æ„è®¾è®¡" class="headerlink" title="2.1 æŠ€æœ¯æ¶æ„è®¾è®¡"></a><strong>2.1 æŠ€æœ¯æ¶æ„è®¾è®¡</strong></h3><p><strong>ç›®æ ‡</strong>ï¼šç¡®å®šç³»ç»ŸæŠ€æœ¯æ ˆä¸æ•´ä½“æ¶æ„ã€‚<br><strong>æ­¥éª¤</strong>ï¼š  </p><ol><li><strong>æ¶æ„åˆ†å±‚è®¾è®¡</strong>ï¼š<br>â€¢ <strong>å‰ç«¯</strong>ï¼šVue.js + Element UIï¼ˆæ”¯æŒå¤šç«¯å“åº”å¼ï¼‰ã€‚<br>â€¢ <strong>åç«¯</strong>ï¼šSpring Boot + MyBatis Plusï¼ˆRESTful APIï¼‰ã€‚<br>â€¢ <strong>æ•°æ®åº“</strong>ï¼šMySQLï¼ˆç»“æ„åŒ–æ•°æ®ï¼‰+ MongoDBï¼ˆå­˜å‚¨é¢˜ç›®å†…å®¹ï¼‰ã€‚<br>â€¢ <strong>ç®—æ³•æœåŠ¡</strong>ï¼šPython + TensorFlow&#x2F;PyTorchï¼ˆæ™ºèƒ½æ¨èæ¨¡å‹ï¼‰ã€‚  </li><li><strong>å¾®æœåŠ¡æ‹†åˆ†</strong>ï¼š<br>â€¢ ç”¨æˆ·æœåŠ¡ã€é¢˜åº“æœåŠ¡ã€ç»„å·æœåŠ¡ã€åˆ†ææœåŠ¡ç‹¬ç«‹éƒ¨ç½²ã€‚  </li><li><strong>å…³é”®æŠ€æœ¯é€‰å‹</strong>ï¼š<br>â€¢ <strong>æœç´¢å¼•æ“</strong>ï¼šElasticsearchï¼ˆæ”¯æŒé¢˜ç›®å…¨æ–‡æ£€ç´¢ï¼‰ã€‚<br>â€¢ <strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼šRabbitMQï¼ˆå¼‚æ­¥å¤„ç†æ‰¹é‡ç»„å·è¯·æ±‚ï¼‰ã€‚</li></ol><p><strong>è¾“å‡ºç‰©</strong>ï¼š<br>â€¢ ã€Šç³»ç»ŸæŠ€æœ¯æ¶æ„å›¾ã€‹<br>â€¢ ã€Šå¾®æœåŠ¡æ¥å£å®šä¹‰æ–‡æ¡£ã€‹  </p><hr><h3 id="2-2-æ•°æ®åº“è®¾è®¡"><a href="#2-2-æ•°æ®åº“è®¾è®¡" class="headerlink" title="2.2 æ•°æ®åº“è®¾è®¡"></a><strong>2.2 æ•°æ®åº“è®¾è®¡</strong></h3><p><strong>ç›®æ ‡</strong>ï¼šè®¾è®¡é«˜æ•ˆã€å¯æ‰©å±•çš„æ•°æ®åº“ç»“æ„ã€‚<br><strong>æ­¥éª¤</strong>ï¼š  </p><ol><li><strong>æ ¸å¿ƒè¡¨è®¾è®¡</strong>ï¼š<br>â€¢ <strong>é¢˜ç›®è¡¨ï¼ˆquestionï¼‰</strong>ï¼š    <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id, content, subject_id, grade_id, difficulty, answer, creator_id, create_time  </span><br></pre></td></tr></table></figure>â€¢ <strong>è¯•å·è¡¨ï¼ˆpaperï¼‰</strong>ï¼š    <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id, title, subject_id, total_score, creator_id, generate_time  </span><br></pre></td></tr></table></figure>â€¢ <strong>çŸ¥è¯†ç‚¹è¡¨ï¼ˆknowledge_pointï¼‰</strong>ï¼šæ”¯æŒæ ‘å½¢ç»“æ„å­˜å‚¨çŸ¥è¯†ç‚¹å±‚çº§ã€‚  </li><li><strong>ç´¢å¼•ä¼˜åŒ–</strong>ï¼š<br>â€¢ å¯¹<code>subject_id</code>ã€<code>difficulty</code>å­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚  </li><li><strong>æ•°æ®å®‰å…¨ç­–ç•¥</strong>ï¼š<br>â€¢ æ•æ„Ÿå­—æ®µï¼ˆå¦‚ç­”æ¡ˆï¼‰åŠ å¯†å­˜å‚¨ï¼Œå®¡è®¡æ—¥å¿—è®°å½•æ•°æ®ä¿®æ”¹æ“ä½œã€‚</li></ol><p><strong>è¾“å‡ºç‰©</strong>ï¼š<br>â€¢ ã€Šæ•°æ®åº“ERå›¾ã€‹<br>â€¢ ã€ŠSQLè„šæœ¬ä¸ç´¢å¼•ä¼˜åŒ–æ–¹æ¡ˆã€‹  </p><hr><h3 id="2-3-æ™ºèƒ½ç»„å·ç®—æ³•è®¾è®¡"><a href="#2-3-æ™ºèƒ½ç»„å·ç®—æ³•è®¾è®¡" class="headerlink" title="2.3 æ™ºèƒ½ç»„å·ç®—æ³•è®¾è®¡"></a><strong>2.3 æ™ºèƒ½ç»„å·ç®—æ³•è®¾è®¡</strong></h3><p><strong>ç›®æ ‡</strong>ï¼šå¼€å‘åŸºäºè§„åˆ™çš„ç»„å·å¼•æ“ä¸AIæ¨èæ¨¡å‹ã€‚<br><strong>æ­¥éª¤</strong>ï¼š  </p><ol><li><strong>è§„åˆ™å¼•æ“è®¾è®¡</strong>ï¼š<br>â€¢ æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™ï¼š    <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>  </span><br><span class="line">  <span class="attr">&quot;difficulty&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">0.2</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="number">0.3</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// ç®€å•ã€ä¸­ç­‰ã€éš¾é¢˜å æ¯”  </span></span><br><span class="line">  <span class="attr">&quot;knowledge_points&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å‡ ä½•åˆæ­¥&quot;</span><span class="punctuation">,</span> <span class="string">&quot;å‡½æ•°&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>  </span><br><span class="line">  <span class="attr">&quot;exclude_question_ids&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1001</span><span class="punctuation">,</span> <span class="number">1002</span><span class="punctuation">]</span> <span class="comment">// æ’é™¤å·²ç”¨é¢˜ç›®  </span></span><br><span class="line"><span class="punctuation">&#125;</span>  </span><br></pre></td></tr></table></figure></li><li><strong>AIæ¨èæ¨¡å‹è®­ç»ƒ</strong>ï¼š<br>â€¢ <strong>æ•°æ®å‡†å¤‡</strong>ï¼šå†å²ç»„å·æ•°æ®æ¸…æ´—ï¼Œæ„å»ºé¢˜ç›®-çŸ¥è¯†ç‚¹å…³è”çŸ©é˜µã€‚<br>â€¢ <strong>æ¨¡å‹é€‰æ‹©</strong>ï¼šååŒè¿‡æ»¤ï¼ˆé¢˜ç›®ç›¸ä¼¼åº¦ï¼‰+ çŸ¥è¯†å›¾è°±åµŒå…¥ï¼ˆKG-BERTï¼‰ã€‚<br>â€¢ <strong>æ•ˆæœè¯„ä¼°</strong>ï¼šé€šè¿‡A&#x2F;Bæµ‹è¯•å¯¹æ¯”è§„åˆ™å¼•æ“ä¸AIæ¨¡å‹çš„ç»„å·æ»¡æ„åº¦ã€‚</li></ol><p><strong>è¾“å‡ºç‰©</strong>ï¼š<br>â€¢ ã€Šæ™ºèƒ½ç»„å·ç®—æ³•è®¾è®¡æ–‡æ¡£ã€‹<br>â€¢ ã€Šæ¨¡å‹è®­ç»ƒä¸è°ƒä¼˜æŠ¥å‘Šã€‹  </p><hr><h2 id="ä¸‰ã€å¼€å‘ä¸æµ‹è¯•é˜¶æ®µ"><a href="#ä¸‰ã€å¼€å‘ä¸æµ‹è¯•é˜¶æ®µ" class="headerlink" title="ä¸‰ã€å¼€å‘ä¸æµ‹è¯•é˜¶æ®µ"></a><strong>ä¸‰ã€å¼€å‘ä¸æµ‹è¯•é˜¶æ®µ</strong></h2><h3 id="3-1-æ¨¡å—å¼€å‘è®¡åˆ’"><a href="#3-1-æ¨¡å—å¼€å‘è®¡åˆ’" class="headerlink" title="3.1 æ¨¡å—å¼€å‘è®¡åˆ’"></a><strong>3.1 æ¨¡å—å¼€å‘è®¡åˆ’</strong></h3><p><strong>ç›®æ ‡</strong>ï¼šåˆ†æ¨¡å—å¹¶è¡Œå¼€å‘ï¼Œç¡®ä¿è¿›åº¦å¯æ§ã€‚<br><strong>æ­¥éª¤</strong>ï¼š  </p><ol><li><strong>å¼€å‘ä»»åŠ¡æ‹†åˆ†</strong>ï¼š<br>â€¢ <strong>ç”¨æˆ·æ¨¡å—</strong>ï¼šæ³¨å†Œ&#x2F;ç™»å½•ã€æƒé™ç®¡ç†ï¼ˆRBACï¼‰ã€‚<br>â€¢ <strong>é¢˜åº“æ¨¡å—</strong>ï¼šé¢˜ç›®æ‰¹é‡å¯¼å…¥ï¼ˆExcel&#x2F;Wordè§£æï¼‰ã€æ ‡ç­¾ç®¡ç†ã€‚<br>â€¢ <strong>ç»„å·æ¨¡å—</strong>ï¼šè§„åˆ™é…ç½®ç•Œé¢ã€å®æ—¶é¢„è§ˆã€å¯¼å‡ºPDF&#x2F;Wordã€‚  </li><li><strong>å¼€å‘è§„èŒƒ</strong>ï¼š<br>â€¢ ä»£ç æäº¤å‰éœ€é€šè¿‡SonarQubeé™æ€æ£€æŸ¥ï¼Œåœˆå¤æ‚åº¦â‰¤10ã€‚<br>â€¢ APIæ¥å£éµå¾ªOpenAPI 3.0æ ‡å‡†ï¼Œç”ŸæˆSwaggeræ–‡æ¡£ã€‚</li></ol><p><strong>è¾“å‡ºç‰©</strong>ï¼š<br>â€¢ ã€Šæ¨¡å—å¼€å‘è®¡åˆ’è¡¨ã€‹<br>â€¢ ã€ŠAPIæ¥å£æ–‡æ¡£ã€‹  </p><hr><h3 id="3-2-æµ‹è¯•ç­–ç•¥ä¸æ‰§è¡Œ"><a href="#3-2-æµ‹è¯•ç­–ç•¥ä¸æ‰§è¡Œ" class="headerlink" title="3.2 æµ‹è¯•ç­–ç•¥ä¸æ‰§è¡Œ"></a><strong>3.2 æµ‹è¯•ç­–ç•¥ä¸æ‰§è¡Œ</strong></h3><p><strong>ç›®æ ‡</strong>ï¼šä¿éšœç³»ç»ŸåŠŸèƒ½ç¨³å®šæ€§å’Œæ€§èƒ½è¾¾æ ‡ã€‚<br><strong>æ­¥éª¤</strong>ï¼š  </p><ol><li><strong>æµ‹è¯•ç±»å‹</strong>ï¼š<br>â€¢ <strong>å•å…ƒæµ‹è¯•</strong>ï¼šJUnit + Mockitoï¼ˆè¦†ç›–ç‡â‰¥85%ï¼‰ã€‚<br>â€¢ <strong>é›†æˆæµ‹è¯•</strong>ï¼šTestNGæ¨¡æ‹Ÿå¤šç”¨æˆ·å¹¶å‘ç»„å·æ“ä½œã€‚<br>â€¢ <strong>æ€§èƒ½æµ‹è¯•</strong>ï¼šJMeterå‹æµ‹ï¼ˆå•æœåŠ¡å™¨æ”¯æŒ1000TPSï¼‰ã€‚  </li><li><strong>æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹</strong>ï¼š<br>â€¢ <strong>åœºæ™¯</strong>ï¼šç”¨æˆ·é€‰æ‹©â€œåˆä¸­æ•°å­¦-æœŸä¸­è¯•å·â€ï¼Œè®¾ç½®éš¾åº¦æ¯”ä¾‹3:5:2ï¼Œæ’é™¤å·²ç”¨é¢˜ç›®ã€‚<br>â€¢ <strong>é¢„æœŸ</strong>ï¼š10ç§’å†…ç”Ÿæˆå«30é¢˜çš„è¯•å·ï¼Œä¸”é¢˜ç›®éš¾åº¦åˆ†å¸ƒç¬¦åˆè®¾å®šã€‚</li></ol><p><strong>è¾“å‡ºç‰©</strong>ï¼š<br>â€¢ ã€Šæµ‹è¯•ç”¨ä¾‹é›†ã€‹<br>â€¢ ã€Šæ€§èƒ½æµ‹è¯•æŠ¥å‘Šã€‹  </p><hr><h2 id="å››ã€éƒ¨ç½²ä¸è¿ç»´é˜¶æ®µ"><a href="#å››ã€éƒ¨ç½²ä¸è¿ç»´é˜¶æ®µ" class="headerlink" title="å››ã€éƒ¨ç½²ä¸è¿ç»´é˜¶æ®µ"></a><strong>å››ã€éƒ¨ç½²ä¸è¿ç»´é˜¶æ®µ</strong></h2><h3 id="4-1-ç³»ç»Ÿéƒ¨ç½²æ–¹æ¡ˆ"><a href="#4-1-ç³»ç»Ÿéƒ¨ç½²æ–¹æ¡ˆ" class="headerlink" title="4.1 ç³»ç»Ÿéƒ¨ç½²æ–¹æ¡ˆ"></a><strong>4.1 ç³»ç»Ÿéƒ¨ç½²æ–¹æ¡ˆ</strong></h3><p><strong>ç›®æ ‡</strong>ï¼šå®ç°é«˜å¯ç”¨ã€å¯æ‰©å±•çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚<br><strong>æ­¥éª¤</strong>ï¼š  </p><ol><li><strong>åŸºç¡€è®¾æ–½</strong>ï¼š<br>â€¢ <strong>äº‘æœåŠ¡</strong>ï¼šé˜¿é‡Œäº‘ECS + SLBè´Ÿè½½å‡è¡¡ + RDSæ•°æ®åº“ã€‚<br>â€¢ <strong>å®¹å™¨åŒ–</strong>ï¼šDocker + Kubernetesï¼ˆæ»šåŠ¨æ›´æ–°ã€è‡ªåŠ¨æ‰©ç¼©å®¹ï¼‰ã€‚  </li><li><strong>CI&#x2F;CDæµç¨‹</strong>ï¼š<br>â€¢ Jenkinsè‡ªåŠ¨æ„å»ºé•œåƒï¼Œé€šè¿‡GitLabè§¦å‘æµæ°´çº¿ã€‚</li></ol><p><strong>è¾“å‡ºç‰©</strong>ï¼š<br>â€¢ ã€Šç³»ç»Ÿéƒ¨ç½²æ‰‹å†Œã€‹<br>â€¢ ã€Šç¾å¤‡æ¢å¤æ–¹æ¡ˆã€‹  </p><hr><h3 id="4-2-ç›‘æ§ä¸ç»´æŠ¤"><a href="#4-2-ç›‘æ§ä¸ç»´æŠ¤" class="headerlink" title="4.2 ç›‘æ§ä¸ç»´æŠ¤"></a><strong>4.2 ç›‘æ§ä¸ç»´æŠ¤</strong></h3><p><strong>ç›®æ ‡</strong>ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶æ€ï¼Œå¿«é€Ÿå“åº”é—®é¢˜ã€‚<br><strong>æ­¥éª¤</strong>ï¼š  </p><ol><li><strong>ç›‘æ§å·¥å…·</strong>ï¼š<br>â€¢ Prometheus + Grafanaï¼ˆé‡‡é›†CPUã€å†…å­˜ã€APIå“åº”æ—¶é—´ï¼‰ã€‚<br>â€¢ ELK Stackï¼ˆæ—¥å¿—åˆ†æä¸å¼‚å¸¸å‘Šè­¦ï¼‰ã€‚  </li><li><strong>ç”¨æˆ·åé¦ˆé—­ç¯</strong>ï¼š<br>â€¢ å»ºç«‹ç”¨æˆ·åé¦ˆåˆ†ç±»æœºåˆ¶ï¼ˆå¦‚BUGã€åŠŸèƒ½å»ºè®®ï¼‰ï¼Œä¼˜å…ˆçº§æ’åºå¤„ç†ã€‚</li></ol><p><strong>è¾“å‡ºç‰©</strong>ï¼š<br>â€¢ ã€Šç³»ç»Ÿç›‘æ§çœ‹æ¿é…ç½®æŒ‡å—ã€‹<br>â€¢ ã€Šç”¨æˆ·åé¦ˆå¤„ç†æµç¨‹ã€‹  </p><hr><h2 id="äº”ã€è¿­ä»£ä¼˜åŒ–ä¸å‡çº§"><a href="#äº”ã€è¿­ä»£ä¼˜åŒ–ä¸å‡çº§" class="headerlink" title="äº”ã€è¿­ä»£ä¼˜åŒ–ä¸å‡çº§"></a><strong>äº”ã€è¿­ä»£ä¼˜åŒ–ä¸å‡çº§</strong></h2><h3 id="5-1-ç‰ˆæœ¬è§„åˆ’"><a href="#5-1-ç‰ˆæœ¬è§„åˆ’" class="headerlink" title="5.1 ç‰ˆæœ¬è§„åˆ’"></a><strong>5.1 ç‰ˆæœ¬è§„åˆ’</strong></h3><p>â€¢ <strong>V1.0</strong>ï¼šåŸºç¡€ç»„å·åŠŸèƒ½ + è§„åˆ™å¼•æ“ã€‚<br>â€¢ <strong>V2.0</strong>ï¼šAIæ¨èæ¨¡å‹ + å¤šç«¯åŒæ­¥ç¼–è¾‘ã€‚<br>â€¢ <strong>V3.0</strong>ï¼šè·¨å¹³å°åä½œï¼ˆæ”¯æŒæ•™ç ”ç»„å¤šäººååŒç»„å·ï¼‰ã€‚  </p><hr><h3 id="5-2-æŒç»­ä¼˜åŒ–æ–¹å‘"><a href="#5-2-æŒç»­ä¼˜åŒ–æ–¹å‘" class="headerlink" title="5.2 æŒç»­ä¼˜åŒ–æ–¹å‘"></a><strong>5.2 æŒç»­ä¼˜åŒ–æ–¹å‘</strong></h3><ol><li><strong>ç®—æ³•ä¼˜åŒ–</strong>ï¼šå¼•å…¥å¼ºåŒ–å­¦ä¹ åŠ¨æ€è°ƒæ•´ç»„å·ç­–ç•¥ã€‚  </li><li><strong>ä½“éªŒæå‡</strong>ï¼šå¢åŠ â€œæ™ºèƒ½çº é”™â€åŠŸèƒ½ï¼ˆå¦‚é¢˜å‹ä¸åˆ†å€¼ä¸åŒ¹é…æ—¶è‡ªåŠ¨æé†’ï¼‰ã€‚</li></ol><hr><h2 id="å…­ã€åˆè§„ä¸å®‰å…¨"><a href="#å…­ã€åˆè§„ä¸å®‰å…¨" class="headerlink" title="å…­ã€åˆè§„ä¸å®‰å…¨"></a><strong>å…­ã€åˆè§„ä¸å®‰å…¨</strong></h2><ol><li><strong>æ•°æ®åˆè§„</strong>ï¼šéµå®ˆã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ï¼Œç”¨æˆ·æ•°æ®åŒ¿ååŒ–å¤„ç†ã€‚  </li><li><strong>ç­‰ä¿ä¸‰çº§</strong>ï¼šé€šè¿‡ç½‘ç»œå®‰å…¨ç­‰çº§ä¿æŠ¤è®¤è¯ã€‚</li></ol><hr><p><strong>æ€»å­—æ•°</strong>ï¼š2300å­—<br><strong>äº¤ä»˜ç‰©æ¸…å•</strong>ï¼šéœ€æ±‚æ–‡æ¡£ã€è®¾è®¡å›¾ã€æµ‹è¯•æŠ¥å‘Šç­‰12ç±»äº¤ä»˜ç‰©ã€‚<br><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šå»ºè®®ä½¿ç”¨Jiraæˆ–ç¦…é“è¿›è¡Œå…¨æµç¨‹é¡¹ç›®ç®¡ç†ï¼Œç¡®ä¿å„é˜¶æ®µæ— ç¼è¡”æ¥ã€‚  </p><hr><p>ä»¥ä¸Šæµç¨‹å¯æ ¹æ®å®é™…å›¢é˜Ÿè§„æ¨¡å’ŒæŠ€æœ¯æ ˆçµæ´»è°ƒæ•´ï¼Œä½†éœ€ç¡®ä¿æ ¸å¿ƒæ¨¡å—ï¼ˆå¦‚æ™ºèƒ½ç®—æ³•ä¸é«˜å¹¶å‘è®¾è®¡ï¼‰çš„ä¼˜å…ˆçº§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> otherï¼Œé¡¹ç›® </tag>
            
            <tag> æ™ºå·äº‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>79-01 æ™ºå·äº‘éœ€æ±‚æ–‡æ¡£</title>
      <link href="/2025/02/26/79-01%20%E6%99%BA%E5%8D%B7%E4%BA%91%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/"/>
      <url>/2025/02/26/79-01%20%E6%99%BA%E5%8D%B7%E4%BA%91%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="79-01-æ™ºå·äº‘éœ€æ±‚æ–‡æ¡£"><a href="#79-01-æ™ºå·äº‘éœ€æ±‚æ–‡æ¡£" class="headerlink" title="79-01 æ™ºå·äº‘éœ€æ±‚æ–‡æ¡£"></a>79-01 æ™ºå·äº‘éœ€æ±‚æ–‡æ¡£</h1><h4 id="1-é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡"><a href="#1-é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡" class="headerlink" title="1. é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡"></a>1. é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡</h4><p><strong>èƒŒæ™¯</strong>ï¼šä¸ºæ»¡è¶³æ•™è‚²æœºæ„ã€æ•™å¸ˆåŠå­¦ç”Ÿå¿«é€Ÿç”Ÿæˆä¸ªæ€§åŒ–è¯•å·çš„éœ€æ±‚ï¼Œéœ€å¼€å‘ä¸€ä¸ªæ™ºèƒ½è¯•å·ç”Ÿæˆç³»ç»Ÿï¼Œæ”¯æŒæŒ‰å¹´çº§ã€å­¦ç§‘ã€è¯•å·ç±»å‹ç­‰ç»´åº¦çµæ´»ç»„å·ï¼Œæä¾›ä¾¿æ·çš„ä¸‹è½½åŠŸèƒ½ã€‚<br><strong>ç›®æ ‡</strong>ï¼šå®ç°ç”¨æˆ·è‡ªå®šä¹‰é…ç½®ç”Ÿæˆé«˜è´¨é‡è¯•å·ï¼Œæå‡ç»„å·æ•ˆç‡ï¼Œé™ä½äººå·¥æˆæœ¬ã€‚</p><hr><h4 id="2-ç”¨æˆ·è§’è‰²å®šä¹‰"><a href="#2-ç”¨æˆ·è§’è‰²å®šä¹‰" class="headerlink" title="2. ç”¨æˆ·è§’è‰²å®šä¹‰"></a>2. ç”¨æˆ·è§’è‰²å®šä¹‰</h4><table><thead><tr><th>è§’è‰²</th><th>æè¿°</th><th>æ ¸å¿ƒéœ€æ±‚</th></tr></thead><tbody><tr><td>æ•™å¸ˆ&#x2F;ç”¨æˆ·</td><td>ç”Ÿæˆè¯•å·çš„æ ¸å¿ƒä½¿ç”¨è€…</td><td>å¿«é€Ÿç»„å·ã€é¢„è§ˆã€ä¸‹è½½ã€é…ç½®çµæ´»</td></tr><tr><td>ç®¡ç†å‘˜</td><td>ç³»ç»Ÿåå°ç»´æŠ¤è€…</td><td>ç®¡ç†é¢˜åº“ã€å®¡æ ¸è¯•å·ã€ç›‘æ§ç³»ç»Ÿè¿è¡Œ</td></tr><tr><td>å­¦ç”Ÿ</td><td>æ½œåœ¨è¯•å·ä½¿ç”¨è€…ï¼ˆå¯é€‰ï¼‰</td><td>åœ¨çº¿ç­”é¢˜ã€æŸ¥çœ‹ç­”æ¡ˆï¼ˆæœªæ¥æ‰©å±•åœºæ™¯ï¼‰</td></tr></tbody></table><hr><h4 id="3-æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚"><a href="#3-æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚" class="headerlink" title="3. æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚"></a>3. æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚</h4><h5 id="3-1-è¯•å·é…ç½®æ¨¡å—"><a href="#3-1-è¯•å·é…ç½®æ¨¡å—" class="headerlink" title="3.1 è¯•å·é…ç½®æ¨¡å—"></a>3.1 è¯•å·é…ç½®æ¨¡å—</h5><p>â€¢ <strong>å¹´çº§é€‰æ‹©</strong>ï¼šæ”¯æŒå°å­¦ã€åˆä¸­ã€é«˜ä¸­å…¨å­¦æ®µï¼ˆå¦‚1-12å¹´çº§ï¼‰ã€‚<br>â€¢ <strong>å­¦ç§‘é€‰æ‹©</strong>ï¼šè¯­æ–‡ã€æ•°å­¦ã€è‹±è¯­ã€ç‰©ç†ã€åŒ–å­¦ç­‰ï¼Œæ”¯æŒå¤šå­¦ç§‘æ‰©å±•ã€‚<br>â€¢ <strong>è¯•å·ç±»å‹</strong>ï¼šå•å…ƒå·&#x2F;æœˆè€ƒå·&#x2F;æœŸä¸­æœŸæœ«å·&#x2F;ä¸“é¡¹å·ï¼ˆå¦‚è®¡ç®—é¢˜ä¸“é¡¹ï¼‰ã€‚<br>â€¢ <strong>é«˜çº§é…ç½®</strong>ï¼ˆå¯é€‰ï¼‰ï¼š<br>  â€¢ éš¾åº¦ç­‰çº§ï¼ˆåŸºç¡€&#x2F;æå‡&#x2F;æ‹”é«˜ï¼‰ã€‚<br>  â€¢ çŸ¥è¯†ç‚¹æ ‡ç­¾ç­›é€‰ï¼ˆå¦‚â€œä¸‰è§’å‡½æ•°â€â€œæ¬§å§†å®šå¾‹â€ï¼‰ã€‚<br>  â€¢ é¢˜å‹æ¯”ä¾‹è®¾ç½®ï¼ˆé€‰æ‹©é¢˜30%ã€å¡«ç©ºé¢˜20%ç­‰ï¼‰ã€‚</p><h5 id="3-2-è¯•å·ç”Ÿæˆä¸é¢„è§ˆ"><a href="#3-2-è¯•å·ç”Ÿæˆä¸é¢„è§ˆ" class="headerlink" title="3.2 è¯•å·ç”Ÿæˆä¸é¢„è§ˆ"></a>3.2 è¯•å·ç”Ÿæˆä¸é¢„è§ˆ</h5><p>â€¢ <strong>æ™ºèƒ½ç»„å·é€»è¾‘</strong>ï¼š<br>  â€¢ æ ¹æ®é…ç½®ä»é¢˜åº“ä¸­æŒ‰é¢˜å‹ã€éš¾åº¦ã€çŸ¥è¯†ç‚¹æƒé‡æŠ½å–é¢˜ç›®ã€‚<br>  â€¢ è‡ªåŠ¨è§„é¿é‡å¤çŸ¥è¯†ç‚¹ï¼ˆå¦‚å•å…ƒå·ä¸­åŒä¸€çŸ¥è¯†ç‚¹æœ€å¤šå‡ºç°2æ¬¡ï¼‰ã€‚<br>  â€¢ ç”Ÿæˆè¯•å·ç»“æ„ï¼ˆæ ‡é¢˜ã€è€ƒç”Ÿä¿¡æ¯åŒºã€é¢˜ç›®åŒºã€è¯„åˆ†æ ‡å‡†ï¼‰ã€‚<br>â€¢ <strong>å®æ—¶é¢„è§ˆ</strong>ï¼šç”Ÿæˆåæä¾›HTMLæ ¼å¼é¢„è§ˆï¼Œæ”¯æŒåˆ†é¡µæŸ¥çœ‹ã€‚</p><h5 id="3-3-ä¸‹è½½ä¸æ ¼å¼"><a href="#3-3-ä¸‹è½½ä¸æ ¼å¼" class="headerlink" title="3.3 ä¸‹è½½ä¸æ ¼å¼"></a>3.3 ä¸‹è½½ä¸æ ¼å¼</h5><p>â€¢ <strong>æ–‡ä»¶æ ¼å¼</strong>ï¼šWordï¼ˆ.docxï¼‰ã€PDFï¼ˆ.pdfï¼‰ï¼Œä¿ç•™æ•°å­¦å…¬å¼ã€å›¾è¡¨ã€éŸ³æ ‡ç­‰ç‰¹æ®Šå†…å®¹ã€‚<br>â€¢ <strong>ç‰ˆå¼è¦æ±‚</strong>ï¼šA4çº¸å¼ ã€é¡µçœ‰åŒ…å«â€œæœºå¯†Â·ç¦æ­¢å¤–ä¼ â€æ°´å°ï¼Œé¡µè„šåŒ…å«é¡µç ã€‚</p><h5 id="3-4-é¢˜åº“ç®¡ç†ï¼ˆåå°ï¼‰"><a href="#3-4-é¢˜åº“ç®¡ç†ï¼ˆåå°ï¼‰" class="headerlink" title="3.4 é¢˜åº“ç®¡ç†ï¼ˆåå°ï¼‰"></a>3.4 é¢˜åº“ç®¡ç†ï¼ˆåå°ï¼‰</h5><p>â€¢ <strong>é¢˜ç›®å½•å…¥</strong>ï¼šæ”¯æŒæ‰¹é‡å¯¼å…¥ï¼ˆExcel&#x2F;JSONï¼‰ã€å•é¢˜æ·»åŠ ï¼ˆå¯Œæ–‡æœ¬ç¼–è¾‘å™¨+LaTeXå…¬å¼ï¼‰ã€‚<br>â€¢ <strong>é¢˜ç›®æ ‡ç­¾</strong>ï¼šç»‘å®šå¹´çº§ã€å­¦ç§‘ã€çŸ¥è¯†ç‚¹ã€éš¾åº¦ã€å‡ºé¢˜æ—¶é—´ç­‰å…ƒæ•°æ®ã€‚<br>â€¢ <strong>é¢˜ç›®å®¡æ ¸</strong>ï¼šç®¡ç†å‘˜å®¡æ ¸æœºåˆ¶ç¡®ä¿é¢˜ç›®æ­£ç¡®æ€§ï¼Œæœªå®¡æ ¸é¢˜ç›®ä»…ç”¨äºæµ‹è¯•ç¯å¢ƒã€‚</p><hr><h4 id="4-éåŠŸèƒ½æ€§éœ€æ±‚"><a href="#4-éåŠŸèƒ½æ€§éœ€æ±‚" class="headerlink" title="4. éåŠŸèƒ½æ€§éœ€æ±‚"></a>4. éåŠŸèƒ½æ€§éœ€æ±‚</h4><p>â€¢ <strong>æ€§èƒ½</strong>ï¼šç”Ÿæˆå“åº”æ—¶é—´â‰¤3ç§’ï¼ˆé¢˜åº“è§„æ¨¡10ä¸‡é¢˜ä»¥å†…ï¼‰ã€‚<br>â€¢ <strong>å®‰å…¨æ€§</strong>ï¼šç”¨æˆ·æ•°æ®HTTPSä¼ è¾“ï¼Œè¯•å·ä¸‹è½½é“¾æ¥åŠ å¯†ï¼ˆæœ‰æ•ˆæœŸ2å°æ—¶ï¼‰ã€‚<br>â€¢ <strong>å…¼å®¹æ€§</strong>ï¼šæ”¯æŒChrome&#x2F;Firefox&#x2F;Edgeä¸»æµæµè§ˆå™¨ï¼Œç§»åŠ¨ç«¯é€‚é…ã€‚<br>â€¢ <strong>æ‰©å±•æ€§</strong>ï¼šé¢„ç•™APIæ¥å£ï¼Œæ”¯æŒæœªæ¥ä¸ç¬¬ä¸‰æ–¹æ•™è‚²å¹³å°å¯¹æ¥ã€‚</p><hr><h4 id="5-ç³»ç»Ÿæ¶æ„è®¾è®¡"><a href="#5-ç³»ç»Ÿæ¶æ„è®¾è®¡" class="headerlink" title="5. ç³»ç»Ÿæ¶æ„è®¾è®¡"></a>5. ç³»ç»Ÿæ¶æ„è®¾è®¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">  A[å‰ç«¯] --&gt;|æäº¤é…ç½®| B(APIç½‘å…³)</span><br><span class="line">  B --&gt; C[è¯•å·ç”ŸæˆæœåŠ¡]</span><br><span class="line">  C --&gt; D[é¢˜åº“æ•°æ®åº“]</span><br><span class="line">  C --&gt; E[è¯•å·ç¼“å­˜æ± ]</span><br><span class="line">  E --&gt; F[æ–‡ä»¶ç”ŸæˆæœåŠ¡]</span><br><span class="line">  F --&gt;|ç”Ÿæˆæ–‡ä»¶| G[äº‘å­˜å‚¨]</span><br><span class="line">  G --&gt; H[ä¸‹è½½é“¾æ¥]</span><br></pre></td></tr></table></figure><hr><h4 id="6-å…³é”®ç®—æ³•é€»è¾‘ï¼ˆç¤ºä¾‹ï¼‰"><a href="#6-å…³é”®ç®—æ³•é€»è¾‘ï¼ˆç¤ºä¾‹ï¼‰" class="headerlink" title="6. å…³é”®ç®—æ³•é€»è¾‘ï¼ˆç¤ºä¾‹ï¼‰"></a>6. å…³é”®ç®—æ³•é€»è¾‘ï¼ˆç¤ºä¾‹ï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_paper</span>(<span class="params">config</span>):</span><br><span class="line">    questions = []</span><br><span class="line">    <span class="keyword">for</span> question_type <span class="keyword">in</span> config[<span class="string">&#x27;question_types&#x27;</span>]:</span><br><span class="line">        pool = query_database(</span><br><span class="line">            grade=config[<span class="string">&#x27;grade&#x27;</span>],</span><br><span class="line">            subject=config[<span class="string">&#x27;subject&#x27;</span>],</span><br><span class="line">            difficulty=config[<span class="string">&#x27;difficulty&#x27;</span>],</span><br><span class="line">            tags=config[<span class="string">&#x27;tags&#x27;</span>]</span><br><span class="line">        )</span><br><span class="line">        selected = select_questions(pool, </span><br><span class="line">                                   count=config[<span class="string">&#x27;count_per_type&#x27;</span>],</span><br><span class="line">                                   exclude_ids=used_question_ids)</span><br><span class="line">        questions.extend(selected)</span><br><span class="line">        used_question_ids.update(selected.ids)</span><br><span class="line">    <span class="keyword">return</span> format_to_word(questions)</span><br></pre></td></tr></table></figure><hr><h4 id="7-æµ‹è¯•ç”¨ä¾‹ï¼ˆéƒ¨åˆ†ï¼‰"><a href="#7-æµ‹è¯•ç”¨ä¾‹ï¼ˆéƒ¨åˆ†ï¼‰" class="headerlink" title="7. æµ‹è¯•ç”¨ä¾‹ï¼ˆéƒ¨åˆ†ï¼‰"></a>7. æµ‹è¯•ç”¨ä¾‹ï¼ˆéƒ¨åˆ†ï¼‰</h4><table><thead><tr><th>æµ‹è¯•åœºæ™¯</th><th>è¾“å…¥æ¡ä»¶</th><th>é¢„æœŸç»“æœ</th></tr></thead><tbody><tr><td>ç”Ÿæˆé«˜ä¸‰æ•°å­¦æœŸæœ«å·</td><td>å¹´çº§&#x3D;12ï¼Œå­¦ç§‘&#x3D;æ•°å­¦ï¼Œç±»å‹&#x3D;æœŸæœ«</td><td>ç”Ÿæˆå«30é¢˜ï¼ŒåŒ…å«å¯¼æ•°ã€æ¦‚ç‡é¢˜å‹</td></tr><tr><td>ä¸‹è½½PDFæ–‡ä»¶</td><td>ç‚¹å‡»ä¸‹è½½æŒ‰é’®</td><td>ä¸‹è½½æˆåŠŸï¼Œæ–‡ä»¶å¯æ­£å¸¸æ‰“å¼€</td></tr><tr><td>æœªé€‰æ‹©å­¦ç§‘æäº¤</td><td>å­¦ç§‘&#x3D;ç©º</td><td>æç¤ºâ€œè¯·é€‰æ‹©å­¦ç§‘â€</td></tr></tbody></table><hr><h4 id="8-é¡¹ç›®é‡Œç¨‹ç¢‘"><a href="#8-é¡¹ç›®é‡Œç¨‹ç¢‘" class="headerlink" title="8. é¡¹ç›®é‡Œç¨‹ç¢‘"></a>8. é¡¹ç›®é‡Œç¨‹ç¢‘</h4><p>â€¢ <strong>éœ€æ±‚ç¡®è®¤</strong>ï¼š2023å¹´10æœˆ<br>â€¢ <strong>UIè®¾è®¡å®Œæˆ</strong>ï¼š2023å¹´11æœˆ<br>â€¢ <strong>æ ¸å¿ƒåŠŸèƒ½å¼€å‘</strong>ï¼š2023å¹´12æœˆ-2024å¹´1æœˆ<br>â€¢ <strong>æµ‹è¯•ä¸ä¸Šçº¿</strong>ï¼š2024å¹´2æœˆ  </p><hr><h4 id="9-é£é™©ä¸åº”å¯¹"><a href="#9-é£é™©ä¸åº”å¯¹" class="headerlink" title="9. é£é™©ä¸åº”å¯¹"></a>9. é£é™©ä¸åº”å¯¹</h4><p>â€¢ <strong>é£é™©1</strong>ï¼šé¢˜åº“é¢˜ç›®ä¸è¶³å¯¼è‡´ç»„å·å¤±è´¥<br>  <strong>åº”å¯¹</strong>ï¼šè®¾ç½®å…œåº•æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·æ‰‹åŠ¨æ›¿æ¢é¢˜ç›®æˆ–é™ä½éš¾åº¦è¦æ±‚<br>â€¢ <strong>é£é™©2</strong>ï¼šæ•°å­¦å…¬å¼æ¸²æŸ“å…¼å®¹æ€§é—®é¢˜<br>  <strong>åº”å¯¹</strong>ï¼šWordç‰ˆæœ¬ä½¿ç”¨MathTypeæ’ä»¶ï¼ŒPDFç‰ˆæœ¬ä½¿ç”¨MathJaxæ¸²æŸ“  </p><hr><p><strong>æ–‡æ¡£é™„ä»¶</strong>ï¼š<br>â€¢ è¯¦ç»†ERå›¾ï¼ˆç”¨æˆ·è¡¨ã€é¢˜ç›®è¡¨ã€è¯•å·è¡¨å…³ç³»ï¼‰<br>â€¢ UIåŸå‹å›¾ï¼ˆAxure&#x2F;Figmaé“¾æ¥ï¼‰<br>â€¢ ç¬¬ä¸‰æ–¹æœåŠ¡å¯¹æ¥æ¸…å•ï¼ˆå¦‚äº‘å­˜å‚¨APIå¯†é’¥ç®¡ç†æ–¹æ¡ˆï¼‰</p><hr><p>è¯¥æ–‡æ¡£å·²è¦†ç›–ä»ç”¨æˆ·éœ€æ±‚åˆ°æŠ€æœ¯è½åœ°çš„å…³é”®è·¯å¾„ï¼Œå»ºè®®åœ¨å¼€å‘å‰å¬å¼€éœ€æ±‚è¯„å®¡ä¼šç¡®è®¤ç»†èŠ‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> otherï¼Œé¡¹ç›® </tag>
            
            <tag> æ™ºå·äº‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>81-03 é¢è¯•-è…¾è®¯-äº‘å¹³å°</title>
      <link href="/2025/02/15/81-03%20%E9%9D%A2%E8%AF%95-%E8%85%BE%E8%AE%AF-%E4%BA%91%E5%B9%B3%E5%8F%B0/"/>
      <url>/2025/02/15/81-03%20%E9%9D%A2%E8%AF%95-%E8%85%BE%E8%AE%AF-%E4%BA%91%E5%B9%B3%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="81-03-é¢è¯•-è…¾è®¯-äº‘å¹³å°"><a href="#81-03-é¢è¯•-è…¾è®¯-äº‘å¹³å°" class="headerlink" title="81-03 é¢è¯•-è…¾è®¯-äº‘å¹³å°"></a>81-03 é¢è¯•-è…¾è®¯-äº‘å¹³å°</h1>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>81-02 é¢è¯•-è…¾è®¯-å…¨æ ˆå¼€å‘æš‘æœŸå®ä¹ ç”Ÿ</title>
      <link href="/2025/02/15/81-02%20%E9%9D%A2%E8%AF%95-%E8%85%BE%E8%AE%AF-%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E5%B7%A5%E7%A8%8B%E5%B8%88/"/>
      <url>/2025/02/15/81-02%20%E9%9D%A2%E8%AF%95-%E8%85%BE%E8%AE%AF-%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E5%B7%A5%E7%A8%8B%E5%B8%88/</url>
      
        <content type="html"><![CDATA[<h1 id="81-02-é¢è¯•-è…¾è®¯-å…¨æ ˆå¼€å‘æš‘æœŸå®ä¹ ç”Ÿ"><a href="#81-02-é¢è¯•-è…¾è®¯-å…¨æ ˆå¼€å‘æš‘æœŸå®ä¹ ç”Ÿ" class="headerlink" title="81-02 é¢è¯•-è…¾è®¯-å…¨æ ˆå¼€å‘æš‘æœŸå®ä¹ ç”Ÿ"></a>81-02 é¢è¯•-è…¾è®¯-å…¨æ ˆå¼€å‘æš‘æœŸå®ä¹ ç”Ÿ</h1><p>2025å¹´3æœˆ6æ—¥16:00ä¸‹åˆè…¾è®¯å…¨æ ˆå¼€å‘æš‘æœŸå®ä¹ ç”Ÿé¢è¯•ï¼Œä¸‹é¢å¯¹æ­¤æ¬¡é¢è¯•åšä¸€ä¸ªå°æ€»ç»“ã€‚</p><h2 id="é¢è¯•å†…å®¹"><a href="#é¢è¯•å†…å®¹" class="headerlink" title="é¢è¯•å†…å®¹"></a>é¢è¯•å†…å®¹</h2><ol><li>é¦–å…ˆå°±æ˜¯è‡ªæˆ‘ä»‹ç»ï¼›</li><li>å¼€å§‹è¯¢é—®å®ä¹ ç›¸å…³å†…å®¹ï¼Œä»ç¬¬ä¸€æ®µå®ä¹ å†…å®¹å¼€å§‹ï¼›</li><li>åœ¨ä»£ç è¯„å®¡é˜¶æ®µï¼Œä½ åšäº†å“ªäº›å·¥ä½œï¼Œä½ æ˜¯å¦‚ä½•å¯¹promteè¿›è¡Œä¼˜åŒ–æ“ä½œçš„ï¼›</li><li>åœ¨ä»£ç ä¸Šä¸‹æ–‡è·å–æ–¹é¢ï¼Œä½ åšäº†å“ªäº›æ“ä½œï¼Œä½ æ˜¯å¦‚ä½•ä¿è¯å…¶ä»£ç è·å–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯èƒ½å¤Ÿæå‡ä»£ç è¯„å®¡çš„å‡†ç¡®åº¦çš„ï¼›</li><li>åœ¨ä»£ç è¯„å®¡æ¨¡å—ï¼Œå¦‚æœä¸€æ®µä»£ç åŠ ä»£ç è¯„å®¡çš„ä¸Šä¸‹æ–‡è¿‡é•¿ï¼Œä½ åˆè¯¥å¦‚ä½•è¿›è¡Œæ“ä½œæ‰èƒ½ä¿è¯ä¸æŸå¤±å‡†ç¡®ç‡å‘¢ï¼›</li><li>å¦‚æœä¸€æ¬¡æ€§æäº¤çš„å˜æ›´ä»£ç é‡æ¯”è¾ƒé•¿çš„è¯ï¼Œå¦‚ä½•è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ä½ ä¸€æ¬¡æ€§æäº¤çš„ä»£ç é‡è¿‡é•¿ï¼Œä½ å¦‚ä½•ä¿è¯å¤§æ¨¡å‹çš„æ€§èƒ½ä¸ä¸‹é™ã€‚ä½ ç»™å‡ºçš„æ–¹æ¡ˆæ˜¯ä»€ä¹ˆã€‚</li><li>å¦‚æœä½ ç°åœ¨åšä¸€ä¸ªé¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®å¯¹ä¸€ä¸ªå…·ä½“çš„ä»£ç åº“è¿›è¡Œåˆ†æï¼Œè®©å¤§æ¨¡å‹æ¥è¾“å‡ºè¿™ä¸ªé¡¹ç›®çš„æ¶æ„å›¾æˆ–è€…æ–‡æ¡£ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Œå¦‚ä½•ä¿è¯åœ¨å¤§æ¨¡å‹ä¸Šä¸‹æ–‡å…è®¸çš„èŒƒå›´å†…å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚</li><li>å¯¹äºç¬¬äºŒä¸ªé¡¹ç›®ï¼Œä½ è§‰å¾—è¿™ä¸ªé¡¹ç›®çš„éš¾ç‚¹åœ¨å“ªå‘¢ï¼Ÿé¦–å…ˆå°±æ˜¯è¿™ä¸ªæ•°æ®é‡éå¸¸å¤§ï¼Œä¸€å¤©çš„æ—…å®¢æ•°æ®é‡å¾ˆå¤§ï¼Œä½ æ˜¯å¦‚ä½•è¿›è¡Œå¤„ç†çš„ï¼Œä½ çš„æ–¹æ¡ˆåˆæ˜¯ä»€ä¹ˆï¼›</li><li>æ•°æ®é‡è¿‡å¤§çš„æƒ…å†µä¸‹ï¼Œä½ æ˜¯é€‰ç”¨ä»€ä¹ˆæ•°æ®åº“è¿›è¡Œå­˜å‚¨å‘¢ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li><li>ä½ è¿™é‡Œè¯´çš„ç¬¬ä¸‰æ–¹æ•°æ®å¹³å°é€‚é…ï¼Œæ¯”å¦‚ä½ ç°åœ¨å°±éœ€è¦å¯¹ä¸€ä¸ªæ¥å£è¿›è¡Œå¤šæ¬¡è¯·æ±‚ï¼Œæ¯”å¦‚è¯´ä¸€ç™¾ä¸‡æ•°æ®ï¼Œä½ åˆ†äº”æ¬¡å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œè¯·æ±‚ï¼Œå¦‚æœç¬¬å››æ¬¡è¯·æ±‚å¤±è´¥äº†ï¼Œä½ å¦‚ä½•ä¿è¯æ•°æ®çš„å¹‚ç­‰æ€§ï¼Œä½ å¯¹äºè¿™ç§æƒ…å†µå—ä¼šæ€ä¹ˆè¿›è¡Œå¤„ç†ã€‚è¯·æ±‚å¤±è´¥æœ‰å¾ˆå¤šç§åŸå› ï¼Œæ¯”å¦‚è¯·æ±‚æ¥å£æŒ‚æ‰äº†æˆ–è€…å› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´è¯¥è¯·æ±‚å¤±è´¥ï¼Œä½ å¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µã€‚</li><li>è¯·ä½ è§£é‡Šä¸€ä¸‹æ•°æ®åº“ä¸­çš„ç´¢å¼•ï¼Œç´¢å¼•åˆ†ä¸ºå‡ ç§ç±»å‹ï¼›</li><li>ä½ è¿™é‡Œè¯´åˆ°äº†å»ºç«‹ç´¢å¼•(a,b)ï¼Œè¿™ç§æ˜¯è”åˆç´¢å¼•å¯¹å§ï¼Œè¯·é—®å…¶åº•å±‚ä¸­ä½¿ç”¨çš„B+æ ‘ï¼Œæ˜¯å¦‚ä½•å»ºç«‹è¿™ä¸ªB+æ ‘çš„ï¼Œä½ èƒ½å¤Ÿç»™æˆ‘è§£é‡Šä¸€ä¸‹å—ï¼Ÿ</li><li>ä½ è¿™é‡Œå†™åˆ°äº†SpringBootç­‰è¿è¡Œï¼Œä½ æ˜¯å¦‚ä½•è¿è¡Œè¿™ä¸ªSpringBooté¡¹ç›®çš„å‘¢ï¼Ÿé€šè¿‡JaråŒ…è¿˜æ˜¯å…¶å®ƒæ–¹å¼ï¼Œé‚£ä¹ˆè¿™å…¶ä¸­çš„å¯åŠ¨æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿå…¶åº•å±‚å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿä½ èƒ½å¤Ÿç»™æˆ‘è¯¦ç»†ä»‹ç»ä¸€ä¸‹å—ï¼Ÿ</li><li>æœ€ååé—®ï¼Œæ‚¨è§‰å¾—åœ¨æ­¤æ¬¡é¢è¯•ä¸­æˆ‘å“ªäº›éœ€è¦åŠ å¼ºçš„å‘¢ï¼Ÿé¢è¯•å®˜ç‚¹è¯„ï¼šå°½ç®¡ä½ æœ‰æ¯”è¾ƒä¸°å¯Œçš„é¡¹ç›®å’Œå®ä¹ ç»å† ä½†æ˜¯ä½ å¹¶ä¸æ˜ç™½è¿™ä¸ªé¡¹ç›®çœŸæ­£çš„éš¾ç‚¹åœ¨å“ª å¹¶æ²¡æœ‰å¯¹æ­¤è¿›è¡Œæ·±å…¥çš„æ€è€ƒ å¦å¤–ä½ å¯¹äºåŸºç¡€çŸ¥è¯†çš„æŒæ¡åªçŸ¥å…¶ç„¶ä¸çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œç»§ç»­åŠ æ²¹ã€‚</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ä½“çš„å¼ºåº¦å¯¹äºç›®å‰çš„æˆ‘æ¥è¯´å¾ˆå¤§ï¼Œä¸€æ–¹é¢ä¹Ÿæ€ªæˆ‘å¯¹äºç®€å†ä¸­çš„å®ä¹ é¡¹ç›®ä¸­éå¸¸æ˜æ˜¾çš„éš¾ç‚¹å¹¶æ²¡æœ‰è¿›è¡Œæ·±å…¥çš„æ€è€ƒï¼Œå¯¹äºæ•´ä¸ªå®ä¹ æœŸé—´æ¥è¯´ï¼Œç¼ºä¹æ·±åº¦æ€è€ƒã€‚æ€»ä½“æ¶‰åŠåˆ°çš„å…«è‚¡æ–‡å‡ ä¹æ²¡æœ‰ï¼Œéƒ½æ˜¯åœ¨å®ä¹ é¡¹ç›®ä¸­è¿›è¡Œæ·±æŒ–ï¼Œè¿™åœ¨æ²¡æœ‰è®¤çœŸå‡†å¤‡çš„æƒ…å†µä¸‹ç¢°å£éå¸¸å¤šï¼Œå‡ ä¹å…¨å†›è¦†æ²¡ã€‚å¯¹è‡ªæˆ‘è¡¨ç°è¯„åˆ†ï¼š<strong>1åˆ†ï¼</strong></p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>82-01 ç®€å†-å®ä¹ -é¡¹ç›®é—®é¢˜å½’çº³</title>
      <link href="/2025/02/15/82-01%20%E7%AE%80%E5%8E%86-%E5%AE%9E%E4%B9%A0-%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98%E5%BD%92%E7%BA%B3/"/>
      <url>/2025/02/15/82-01%20%E7%AE%80%E5%8E%86-%E5%AE%9E%E4%B9%A0-%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98%E5%BD%92%E7%BA%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="82-01-ç®€å†-å®ä¹ -é¡¹ç›®é—®é¢˜å½’çº³"><a href="#82-01-ç®€å†-å®ä¹ -é¡¹ç›®é—®é¢˜å½’çº³" class="headerlink" title="82-01 ç®€å†-å®ä¹ -é¡¹ç›®é—®é¢˜å½’çº³"></a>82-01 ç®€å†-å®ä¹ -é¡¹ç›®é—®é¢˜å½’çº³</h1><h2 id="å®ä¹ -ä»£ç è¯„å®¡"><a href="#å®ä¹ -ä»£ç è¯„å®¡" class="headerlink" title="å®ä¹ -ä»£ç è¯„å®¡"></a>å®ä¹ -ä»£ç è¯„å®¡</h2><h3 id="å®ä¹ è´Ÿè´£çš„å·¥ä½œ"><a href="#å®ä¹ è´Ÿè´£çš„å·¥ä½œ" class="headerlink" title="å®ä¹ è´Ÿè´£çš„å·¥ä½œ"></a>å®ä¹ è´Ÿè´£çš„å·¥ä½œ</h3><p>è¿™æ®µå®ä¹ æ˜¯åœ¨ä¸Šæµ·ä¸­å…´è½¯ä»¶æœ‰é™è´£ä»»å…¬å¸ï¼Œå·¥ä½œæ—¶é—´ä¸ºï¼š2024å¹´10æœˆ-2025å¹´01æœˆï¼Œä½œä¸ºè½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆå®ä¹ ç”Ÿåœ¨ICFå…­éƒ¨ã€‚</p><p>åœ¨è¿™æ®µå®ä¹ ä¸­ï¼Œæˆ‘è´Ÿè´£äº†å¯¹ä»£ç è¯„å®¡åé¦ˆä»£ç é‡æ„ï¼Œå¹¶ä¿®æ”¹äº†å…¶ä¸­ä»£ç è¯„å®¡Bugï¼Œè¿™é‡Œå…¶ä¸­æ¶‰åŠåˆ°ä»£ç è¯„å®¡åé¦ˆè·å–Bugä¸”è¯¥ä»£ç ç»“æ„æ··ä¹±ï¼Œç»“æœä¸æ¸…æ™°ã€‚éšåå¯¹ä»£ç è¯„å®¡å•ä½“æ¶æ„æ‹†åˆ†æˆä¸‰ä¸ªå¾®æœåŠ¡ï¼ŒæŒ‰ç…§å„ä¸ªæœåŠ¡èŒè´£è¿›è¡Œåˆ’åˆ†ï¼Œåˆ†åˆ«æ‹†åˆ†ä¸ºï¼šå˜æ›´å•æœåŠ¡ã€ä¸Šä¸‹æ–‡æœåŠ¡ä»¥åŠAIè¯„å®¡æœåŠ¡ã€‚å¹¶é€šè¿‡Dockerå¯¹ä¸‰ä¸ªå¾®æœåŠ¡è¿›è¡Œéƒ¨ç½²ï¼Œä¸”ä¸‰ä¸ªå¾®æœåŠ¡éƒ½é€šè¿‡Redisè¿›è¡Œäº¤æµé€šä¿¡ï¼Œä¸”ä¸Šä¸‹æ–‡æœåŠ¡ä¼šå…·æœ‰å¤šä¸ªçº¿ç¨‹æ¥è¿›è¡Œæ¶ˆè´¹ï¼ŒAIè¯„å®¡æœåŠ¡å¯¹æ¥äºå¤–éƒ¨å¤§æ¨¡å‹é€šä¿¡ï¼Œä½¿ç”¨çº¿ç¨‹æ± æ¥å¯¹å…¶è¿›è¡Œè®¿é—®ï¼Œè·å–åˆ°AIè¯„å®¡å†…å®¹ä¹‹åä¼šæäº¤ç»™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”±å˜æ›´å•æœåŠ¡è·å–æ¶ˆæ¯å¹¶ä¸Šä¼ è‡³GerritæœåŠ¡å™¨ï¼Œä¸”ä¼šå°†è¯¥è¯„å®¡è¿›è¡Œä¿å­˜è‡³æ•°æ®åº“ä¸­ã€‚</p><p>æˆ‘åç»­è¿˜å‚ä¸äº†Promteç¼–å†™ä¼˜åŒ–ï¼ŒæŒ‰ç…§ç›®å‰Promteç¼–å†™è§„èŒƒè¿›è¡Œç¼–å†™ä¼˜åŒ–ï¼Œå¹¶ä¸”ç»“åˆRAGæŠ€æœ¯ä¸­çš„æ£€ç´¢ï¼Œæ„å»ºäº†è¯¥é¡¹ç›®ä»£ç çš„çŸ¥è¯†åº“æ¥å‡å°‘å…¶ä¸Šä¸‹æ–‡è·å–æ—¶é—´ï¼Œå¹¶ä¸”é€šè¿‡è·å–ä¸Šä¸‹æ–‡æ¥æé«˜ä»£ç è¯„å®¡çš„è´¨é‡ã€‚å¹¶ä¸”é‡‡ç”¨æŒ‰æ–‡ä»¶æŒ‰æ–¹æ³•åˆ†å—è¿›è¡Œè¯„å®¡ï¼Œä»è€Œç¼©çŸ­Promteé•¿åº¦ï¼Œæé«˜AIè¯„å®¡çš„é‡‡çº³ç‡ã€‚</p><p>åŒæ—¶å‚ä¸å¼€å‘äº†å‰åç«¯ç®¡ç†å¹³å°å¼€å‘ï¼šç‹¬ç«‹å¼€å‘AIè¯„å®¡ç®¡ç†æœåŠ¡ï¼ˆå‰ç«¯Vueï¼Œåç«¯SpringBootï¼‰ï¼Œæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æç¤ºè¯ ç­–ç•¥ï¼Œå¢å¼ºå¤§æ¨¡å‹è¯„å®¡çš„å¯ä¿¡åº¦ï¼Œæé«˜AIè¯„å®¡çµæ´»æ€§å’Œé€‚é…æ€§ã€‚</p><h3 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h3><p>ä¸‹é¢æ¥ç¨å¾®è¯¦ç»†çš„æè¿°ä¸€ä¸‹æ•´ä¸ªä»£ç è¯„å®¡çš„æµç¨‹ï¼Œä»¥ä¸€ä¸ªæ–°ä»“åº“åŠ å…¥ä»£ç è¯„å®¡åŠŸèƒ½ä¸ºä¾‹ã€‚ä¾‹å¦‚é¡¹ç›®æœ‰ä¸€ä¸ªéƒ¨é—¨ä¸­çš„å…¶ä¸­ä¸€ä¸ªä»£ç åº“å¸Œæœ›æ·»åŠ è¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨æµæ°´çº¿é‚£è¾¹ä¼šé…ç½®å¥½æäº¤ä»£ç åéœ€è¦è§¦å‘è°ƒç”¨æˆ‘ä»¬è¿™è¾¹æœ¬åœ°çš„ä¸€ä¸ªæ¥å£ï¼Œåªè´Ÿè´£è§¦å‘ï¼Œä¸å…³å¿ƒå¯¹æ–¹æ˜¯å¦æ¥å—åˆ°ã€‚</p><p>å˜æ›´å•æœåŠ¡æ¥æ”¶åˆ°äº†ä¸€ä¸ªè¯„å®¡ä»»åŠ¡è¯·æ±‚ä¹‹åï¼Œå¯¹è¿™ä¸ªä»»åŠ¡è¿›è¡Œç®€å•å¤„ç†åï¼Œæ¯”å¦‚è·å–å½“å‰ä»£ç åº“ä»¥åŠæäº¤çš„patchã€‚å½“å‰ä»»åŠ¡å¤„ç†å®Œæˆä¹‹åå°†ä»»åŠ¡æäº¤è‡³æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åä¸Šä¸‹æ–‡æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å–å½“å‰å˜æ›´ä»£ç æ®µçš„ä¸Šä¸‹æ–‡ï¼Œç„¶åå°†å¤„ç†åçš„ç»“æœæäº¤è‡³æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åAIè¯„å®¡æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å–æ¶ˆæ¯ä¹‹ååšä¸€å®šçš„å¤„ç†ä¹‹åæäº¤ç»™å¤§æ¨¡å‹è¿›è¡Œè¯„å®¡ã€‚</p><p>å„ä¸ªæœåŠ¡ä¹‹å‰é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨çš„æ¶ˆæ¯ä¸­é—´ä»¶æ˜¯Redisã€‚æˆ‘ä»¬ä¼šä½¿ç”¨å¤šä¸ªæ¶ˆè´¹è€…å’Œå¤šä¸ªç”Ÿäº§è€…çš„æ¨¡å‹æ¥è¿›è¡Œå¤„ç†ã€‚</p><p>å­˜åœ¨ä¸‹é¢çš„è¿™äº›é—®é¢˜ï¼š</p><ol><li><p>åœ¨è¿™ä¸ªæœåŠ¡é‡Œä½¿ç”¨åˆ°äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¯·é—®ä½ ä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨Redisä½œä¸ºä½ ä»¬é¡¹ç›®ä¸­çš„ä¸­é—´ä»¶å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸é€‰æ‹©ç›®å‰æ¯”è¾ƒæˆç†Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ï¼šKafkaå’ŒRabbitMQç­‰å‘¢ï¼Ÿ</p><blockquote><p><strong>é€‰æ‹©Redisçš„æ ¸å¿ƒåŸå› </strong>ï¼š</p><ul><li><strong>æŠ€æœ¯æ ˆç»Ÿä¸€æ€§</strong>ï¼šå›¢é˜Ÿå·²æœ‰æˆç†Ÿçš„RedisåŸºç¡€è®¾æ–½ï¼ˆé›†ç¾¤ã€ç›‘æ§ã€è¿ç»´ç»éªŒï¼‰ï¼Œå¤ç”¨ç°æœ‰ä¸­é—´ä»¶é™ä½å­¦ä¹ æˆæœ¬å’Œè¿ç»´å¤æ‚åº¦ã€‚</li><li><strong>è½»é‡çº§åœºæ™¯é€‚é…</strong>ï¼šä»£ç è¯„å®¡ä»»åŠ¡å±äº<strong>ä½é¢‘ã€éå¼ºé¡ºåºæ€§ã€æ¶ˆæ¯ä½“è¾ƒå°</strong>çš„åœºæ™¯ï¼ˆä»£ç diffé€šå¸¸ä¸ºKBçº§åˆ«ï¼‰ï¼ŒRediså†…å­˜æ“ä½œçš„é«˜ååé‡ï¼ˆ10ä¸‡çº§QPSï¼‰å®Œå…¨èƒ½æ»¡è¶³éœ€æ±‚ã€‚</li><li><strong>å®æ—¶æ€§è¦æ±‚</strong>ï¼šè¯„å®¡ä»»åŠ¡éœ€è¦å¿«é€Ÿè§¦å‘ï¼ˆç§’çº§å»¶è¿Ÿï¼‰ï¼ŒRedisçš„Pub&#x2F;Subæˆ–Streamsæ¨¡å¼åœ¨ä½å»¶è¿Ÿåœºæ™¯ä¼˜äºKafkaçš„æ‰¹å¤„ç†æ¨¡å‹ã€‚</li><li><strong>ç®€åŒ–æ¶æ„</strong>ï¼šé¿å…å¼•å…¥æ–°çš„ä¸­é—´ä»¶ä¾èµ–ï¼Œå‡å°‘ç³»ç»Ÿå¤æ‚åº¦ã€‚Kafkaéœ€è¦ç»´æŠ¤ZooKeeperé›†ç¾¤ï¼ŒRabbitMQéœ€è¦ç»´æŠ¤Erlangç¯å¢ƒï¼Œè€ŒRediså·²æ˜¯ç°æœ‰åŸºç¡€è®¾æ–½ã€‚</li></ul><p><strong>è§„é¿Kafka&#x2F;RabbitMQçš„è€ƒé‡</strong>ï¼š</p><ul><li>Kafkaçš„å¼ºé¡ºåºæ€§å’Œåˆ†åŒºç‰¹æ€§åœ¨æ­¤åœºæ™¯ä¸­æ— å¿…è¦ï¼Œä¸”å…¶è®¾è®¡æ›´é€‚åˆæ—¥å¿—ç±»å¤§æ•°æ®é‡åœºæ™¯ã€‚</li><li>RabbitMQçš„å¤æ‚è·¯ç”±ï¼ˆExchange&#x2F;Bindingï¼‰å’ŒACKæœºåˆ¶åœ¨æ­¤å¤„å±äºè¿‡åº¦è®¾è®¡ï¼Œä¸”AMQPåè®®çš„è§£æå¼€é”€è¾ƒé«˜ã€‚</li></ul></blockquote></li><li><p>é‚£ä¹ˆä½ é€‰æ‹©ä½¿ç”¨Redisä½œä¸ºä½ çš„ä¸­é—´ä»¶ï¼Œå®ƒä¼šå­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿä½ ä»¬åˆæ˜¯å¦‚ä½•å»è§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿ</p><blockquote><p>1ã€æ¶ˆæ¯å †ç§¯ï¼šç”±äºæ¶ˆè´¹è€…å®•æœºæˆ–è€…æ¶ˆè´¹é€Ÿåº¦è¿‡æ…¢å¯¼è‡´æ¶ˆæ¯è¢«æ¶ˆè´¹çš„å¾ˆæ…¢ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼›</p><p>2ã€æŒä¹…åŒ–å¯é æ€§ï¼šRedisä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œéœ€è¦å¯¹æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼Œä½¿ç”¨RDBå¯èƒ½ä¸¢å¤±éƒ¨åˆ†æ•°æ®ï¼Œä½†æ˜¯ä½¿ç”¨AOFå…¶æ€§èƒ½ä¼šæœ‰æ‰€æŸå¤±ï¼›</p><p>3ã€æ— åŸç”Ÿçš„é‡è¯•é˜Ÿåˆ—ï¼šæ— è¶…æ—¶è‡ªåŠ¨é‡ä¼ ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨ç®¡ç†ï¼›</p><p>4ã€ä¸ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼šRedis pub&#x2F;subæœºåˆ¶æ— ACKæœºåˆ¶ï¼ŒStreaméœ€è¦è‡ªè¡Œå®ç°ï¼›</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>1ã€é€‰æ‹©ä½¿ç”¨Redisä¸­çš„Streamæ•°æ®ç»“æ„ï¼Œè€Œéä½¿ç”¨pub&#x2F;subï¼ŒåŒæ—¶å¯¹Rediså†…å­˜è®¾ç½®é˜ˆå€¼ï¼Œè¶…è¿‡æŒ‡å®šçš„é˜ˆå€¼è§¦å‘è­¦å‘Šï¼ŒåŒæ—¶é™åˆ¶æ¶ˆæ¯é˜Ÿåˆ—çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯Streamé•¿åº¦ï¼›</p><p>2ã€é’ˆå¯¹RedisæŒä¹…åŒ–é—®é¢˜ï¼Œå› ä¸ºRediså¦‚æœé€‰æ‹©ä½¿ç”¨RDBæ¥è¿›è¡ŒæŒä¹…åŒ–çš„è¯ï¼Œå› ä¸ºæ˜¯å¼‚æ­¥å¯¹å½“å‰åˆ›å»ºå¿«ç…§çš„é‚£ä¸€åˆ»çš„Redisè¿›è¡Œåˆ·å±ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ä¸­é—´çš„è¿™æ®µæ—¶é—´çš„æ•°æ®å¯èƒ½å­˜åœ¨ä¸¢å¤±é—®é¢˜ï¼Œä½†æ˜¯AOFæ€§èƒ½è¾ƒå·®ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨ä¸¤è€…çš„æ··åˆå¼ï¼Œå¯¹äºåˆ›å»ºå¿«ç…§çš„é‚£ä¸€åˆ»çš„æ•°æ®é€‰æ‹©ä½¿ç”¨RDBï¼Œè€Œå¯¹äºåé¢æ–°å¢çš„æ•°æ®é€‰æ‹©ä½¿ç”¨AOFï¼›</p><p>3ã€é’ˆå¯¹æ— åŸç”Ÿçš„é‡è¯•é˜Ÿåˆ—ï¼š</p></blockquote></li><li><p>Redisä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿå…¶ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¸è¶³ä¹‹å¤„å‘¢ï¼Ÿä½ ä»¬åˆæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€æ¶ˆæ¯é‡ä¼ ã€æ¶ˆæ¯æŒä¹…åŒ–çš„å‘¢ï¼Ÿ</p></li><li><p>å›åˆ°å˜æ›´å•æœåŠ¡è¿™è¾¹ï¼Œè¿™ä¸ªæœåŠ¡ä¸»è¦èŒè´£æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¤„ç†å“ªäº›äº‹æƒ…ï¼Œä¼šå°†åŒ…å«å“ªäº›ä¿¡æ¯å°è£…æˆä¸€ä¸ªæ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘¢ï¼Ÿ</p><blockquote><p>{<br>  â€œtask_idâ€: â€œtask_123â€,<br>  â€œrepository_urlâ€: â€œssh:&#x2F;&#x2F;gerrit.example.com&#x2F;my_projectâ€,<br>  â€œcommit_idâ€: â€œcommit_abcâ€,<br>  â€œfile_pathâ€: â€œsrc&#x2F;utils&#x2F;math.pyâ€,<br>  â€œdiff_contentâ€: â€œ@@ -1,3 +1,8 @@â€¦â€, &#x2F;&#x2F; ç®€åŒ–çš„Diff<br>  â€œbase_revisionâ€: â€œbase_xyzâ€ &#x2F;&#x2F; åŸºçº¿ç‰ˆæœ¬ï¼ˆçŸ¥è¯†åº“å¯¹åº”æ­¤ç‰ˆæœ¬ï¼‰<br>}</p></blockquote></li><li><p>ä½ ä»¬å˜æ›´å•æœåŠ¡å¯¹æˆ‘æä¾›ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæ˜¯å¦æ˜¯ä»»ä½•äººéƒ½å¯ä»¥ç›´æ¥è¯·æ±‚å‘¢ï¼Ÿå¦‚æœå¯ä»¥æ˜¯å¦ä¼šå­˜åœ¨æ¶æ„å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œå¤§é‡è®¿é—®å¯¼è‡´ä»»åŠ¡ç”Ÿæˆè¿‡å¤šï¼Œä»è€Œå¼•èµ·ç³»ç»Ÿçš„å´©æºƒå‘¢ï¼Ÿä½ ä»¬åˆæ˜¯å¦‚ä½•è€ƒè™‘è§£å†³çš„å‘¢ï¼Ÿ</p><blockquote><ol><li><p><strong>èº«ä»½è®¤è¯ï¼ˆAuthenticationï¼‰</strong></p><p>- </p><p>  API Key + JWT</p><p>  ä»…å…è®¸æºå¸¦æœ‰æ•ˆAPI Keyå’ŒJWTä»¤ç‰Œçš„è¯·æ±‚ï¼š</p><p>  bash</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯·æ±‚å¤´ç¤ºä¾‹</span></span><br><span class="line">Authorization: Bearer &lt;JWT&gt;</span><br><span class="line">X-API-Key: xyz-123-abc</span><br></pre></td></tr></table></figure><ul><li><strong>å¯†é’¥ç®¡ç†</strong>ï¼šé€šè¿‡å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼ˆå¦‚AWS Secrets Managerï¼‰åŠ¨æ€è½®æ¢API Keyã€‚</li><li><strong>JWTæ ¡éªŒ</strong>ï¼šéªŒè¯ç­¾åã€è¿‡æœŸæ—¶é—´åŠæƒé™å£°æ˜ï¼ˆClaimsï¼‰ã€‚</li></ul></li><li><p><strong>æƒé™æ§åˆ¶ï¼ˆAuthorizationï¼‰</strong></p><p>- </p><p>  RBACæ¨¡å‹</p><p>  ï¼š</p><p>  æ ¹æ®è§’è‰²é™åˆ¶å¯è®¿é—®çš„æ¥å£å’Œæ“ä½œï¼š</p><p>  json</p>  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JWT Payloadç¤ºä¾‹</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;roles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;code_reviewer&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scopes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;submit:change_task&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>  ç›¸å…³çš„é™æµç®—æ³•æœ‰å“ªäº›ï¼šæ»‘åŠ¨çª—å£ã€å›ºå®šçª—å£é™æµç®—æ³•ã€æ¼æ¡¶é™æµç®—æ³•ã€<strong>ä»¤ç‰Œæ¡¶ç®—æ³•</strong></p></li></ol></blockquote></li><li><p>ä½ çš„ä¸Šä¸‹é—®æœåŠ¡çš„ä¸»è¦èŒè´£æ˜¯ä»€ä¹ˆï¼Ÿè¿™é‡Œä½ ä»¬æ˜¯å¦‚ä½•å»è·å–ä¸Šä¸‹æ–‡çš„å‘¢ï¼Ÿ</p></li><li><p>ä½ ä»¬å¯¹äºè¿™é‡Œçš„ä¸Šä¸‹æ–‡æœåŠ¡ä¼šé€‰æ‹©å‡ ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹å‘¢ï¼Ÿæ˜¯å¦éœ€è¦ä¿è¯é¡ºåºæ¶ˆè´¹å‘¢ï¼Ÿå¦‚æœéœ€è¦ä½ åˆæ˜¯å¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿ</p><blockquote><p>é‡‡ç”¨åŠ¨æ€çº¿ç¨‹æ± çš„æ–¹å¼æ¥è¿›è¡Œæ¶ˆè´¹ï¼Œæˆ‘ä»¬ä¼šæŒç»­ç›‘æ§å½“å‰é˜Ÿåˆ—é•¿åº¦ï¼Œå¦‚æœç§¯ç´¯çš„æ¶ˆæ¯è¿‡å¤šå°±ä¼šåŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥è¿›è¡Œæ¶ˆè´¹ï¼ŒåŒæ—¶å¦‚æœæ¶ˆæ¯è¾ƒå°‘ï¼Œå°±ä¼šé€æ­¥çš„é”€æ¯çº¿ç¨‹ã€‚</p><p>ä¸éœ€è¦ä¿è¯é¡ºåºæ¶ˆè´¹ã€‚</p></blockquote></li><li><p>ä½ è¿™é‡Œæåˆ°äº†æŠ½è±¡è¯­æ³•æ ‘å’ŒRAGï¼Œä½ å¯¹RAGäº†è§£å¤šå°‘å‘¢ï¼Ÿå…¶æ˜¯å¦‚ä½•æ„å»ºçŸ¥è¯†åº“çš„å‘¢ï¼Ÿ</p><blockquote><h4 id="ä¸€ã€RAGçš„æ ¸å¿ƒåŸç†"><a href="#ä¸€ã€RAGçš„æ ¸å¿ƒåŸç†" class="headerlink" title="ä¸€ã€RAGçš„æ ¸å¿ƒåŸç†"></a><strong>ä¸€ã€RAGçš„æ ¸å¿ƒåŸç†</strong></h4><p>RAGé€šè¿‡<strong>æ£€ç´¢å¤–éƒ¨çŸ¥è¯†åº“</strong>å¢å¼ºç”Ÿæˆæ¨¡å‹ï¼ˆå¦‚GPT-4ï¼‰çš„ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›ï¼Œå…¶æ ¸å¿ƒæµç¨‹ä¸ºï¼š</p><ol><li><strong>æ£€ç´¢ï¼ˆRetrievalï¼‰</strong>ï¼šæ ¹æ®è¾“å…¥é—®é¢˜ï¼Œä»çŸ¥è¯†åº“ä¸­æå–ç›¸å…³æ–‡æ¡£ç‰‡æ®µã€‚</li><li><strong>å¢å¼ºï¼ˆAugmentationï¼‰</strong>ï¼šå°†æ£€ç´¢ç»“æœä¸é—®é¢˜æ‹¼æ¥ï¼Œä½œä¸ºç”Ÿæˆæ¨¡å‹çš„è¾“å…¥ã€‚</li><li><strong>ç”Ÿæˆï¼ˆGenerationï¼‰</strong>ï¼šæ¨¡å‹åŸºäºå¢å¼ºåçš„ä¸Šä¸‹æ–‡ç”Ÿæˆæœ€ç»ˆå›ç­”ã€‚</li></ol><p>åœ¨ä»£ç åœºæ™¯ä¸­ï¼ŒRAGçš„æ£€ç´¢å¯¹è±¡ä¸å†æ˜¯æ™®é€šæ–‡æœ¬ï¼Œè€Œæ˜¯<strong>ç»“æ„åŒ–ä»£ç ç‰‡æ®µåŠå…¶è¯­ä¹‰ä¿¡æ¯</strong>ã€‚</p><h5 id="1-èŠ‚ç‚¹ç±»å‹"><a href="#1-èŠ‚ç‚¹ç±»å‹" class="headerlink" title="1. èŠ‚ç‚¹ç±»å‹"></a><strong>1. èŠ‚ç‚¹ç±»å‹</strong></h5><table><thead><tr><th align="center">èŠ‚ç‚¹ç±»å‹</th><th align="center">å±æ€§ç¤ºä¾‹</th><th align="center">å®ä¾‹è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><strong>Class</strong></td><td align="center"><code>name</code>, <code>package</code>, <code>super_class</code></td><td align="center"><code>UserService</code>ï¼ˆç±»åï¼‰</td></tr><tr><td align="center"><strong>Method</strong></td><td align="center"><code>name</code>, <code>return_type</code>, <code>modifiers</code></td><td align="center"><code>getUserById</code>ï¼ˆæ–¹æ³•åï¼‰</td></tr><tr><td align="center"><strong>Field</strong></td><td align="center"><code>name</code>, <code>type</code>, <code>access</code></td><td align="center"><code>userRepo</code>ï¼ˆå­—æ®µåï¼‰</td></tr><tr><td align="center"><strong>Interface</strong></td><td align="center"><code>name</code>, <code>package</code></td><td align="center"><code>UserRepository</code>ï¼ˆæ¥å£åï¼‰</td></tr><tr><td align="center"><strong>Exception</strong></td><td align="center"><code>name</code>, <code>package</code></td><td align="center"><code>UserNotFoundException</code>ï¼ˆè‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼‰</td></tr></tbody></table><h5 id="2-å…³ç³»ç±»å‹"><a href="#2-å…³ç³»ç±»å‹" class="headerlink" title="2. å…³ç³»ç±»å‹"></a><strong>2. å…³ç³»ç±»å‹</strong></h5><table><thead><tr><th align="center">å…³ç³»</th><th align="center">èµ·ç‚¹</th><th align="center">ç»ˆç‚¹</th><th align="center">å®ä¾‹è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><strong>EXTENDS</strong></td><td align="center"><code>Class</code></td><td align="center"><code>Class</code></td><td align="center"><code>UserService extends BaseService</code></td></tr><tr><td align="center"><strong>IMPLEMENTS</strong></td><td align="center"><code>Class</code></td><td align="center"><code>Interface</code></td><td align="center"><code>UserServiceImpl implements UserService</code></td></tr><tr><td align="center"><strong>CALLS</strong></td><td align="center"><code>Method</code></td><td align="center"><code>Method</code></td><td align="center"><code>UserController.getUser â†’ UserService.getUserById</code></td></tr><tr><td align="center"><strong>HAS_PARAM</strong></td><td align="center"><code>Method</code></td><td align="center"><code>Class</code></td><td align="center"><code>getUserByIdæ–¹æ³•çš„å‚æ•°ç±»å‹ä¸ºLong</code></td></tr><tr><td align="center"><strong>THROWS</strong></td><td align="center"><code>Method</code></td><td align="center"><code>Exception</code></td><td align="center"><code>getUserByIdæŠ›å‡ºUserNotFoundException</code></td></tr></tbody></table></blockquote></li><li><p>ä½ è¯´åˆ°éœ€è¦æ ¹æ®æŠ½è±¡è¯­æ³•æ ‘æ¥å¯¹è¿™ä¸ªæ•´ä¸ªé¡¹ç›®çš„ä¸€ä¸ªç»“æ„è¿›è¡Œè§£æï¼Œä»è€Œæ¥è·å–åˆ°è¿™ä¸ªé¡¹ç›®ä¸­çš„æ–¹æ³•ã€ç±»ã€åŒ…ç­‰ä¿¡æ¯ï¼Œç„¶åæ¥æ„å»ºä¸€ä¸ªçŸ¥è¯†åº“ï¼Œé‚£å¦‚æœåç»­æˆ‘çš„ä¸€ä¸ªæäº¤å•ä¸­æ–°å¢äº†ä¸€ä¸ªåŒ…ORæˆ–è€…åˆ é™¤äº†éƒ¨åˆ†åŒ…ï¼Œä½ çš„çŸ¥è¯†åº“è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿä½ çš„è¿™éƒ¨åˆ†æ–¹æ¡ˆæ˜¯å¦è®¾è®¡åˆç†å‘¢ï¼Ÿ</p><blockquote><p>å¯¹äºå¢åˆ æ”¹ç­‰æƒ…å†µæ¥è¯´éƒ½éœ€è¦å¯¹æ¶‰åŠåˆ°çš„çŸ¥è¯†å›¾è°±çš„æ›´æ–°ï¼Œä½†æ˜¯å¯¹äºå½“å‰æäº¤çš„ä¸€å•æ¥è¯´ï¼Œå…¶æ–°å»ºçš„ä»£ç æ˜¯è¿˜æœªè¿›è¡Œåˆå¹¶çš„ï¼Œæ‰€ä»¥è¯¥å¦‚ä½•å¯¹å…¶æ–°å¢çš„æˆ–è€…ä¿®æ”¹çš„è¿›è¡Œæ„å»ºçŸ¥è¯†å›¾è°±å‘¢ï¼Ÿè¿™ä¸€æ­¥åˆ°åº•æ˜¯åœ¨ä¸Šä¸‹æ–‡æœåŠ¡è¿›è¡Œå¤„ç†è¿˜æ˜¯Gerritéƒ¨é—¨é‚£è¾¹è¿›è¡Œå¤„ç†å‘¢ï¼Ÿ</p><p>è¿™é‡Œæ¶‰åŠåˆ°å¤šä¸ªéƒ¨é—¨ä¹‹é—´çš„åˆä½œä»¥åŠæƒé™é—®é¢˜ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿èµ·è§æˆ‘ä»¬ä¼šé€‰æ‹©å°†è¯¥ä»£ç åº“æ‹‰å–åˆ°æœ¬åœ°è¿›è¡Œåˆ†æå¹¶æ„å»ºçŸ¥è¯†åº“ï¼Œä½†æ˜¯å¯¹äºå…¶ä¸­æ¶‰åŠåˆ°çš„è´¦å·å’Œå¯†ç éƒ½éœ€è¦è¿›è¡ŒåŠ å¯†åå­˜å‚¨ï¼Œ</p><p>å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦å¸®åŠ©ç”¨æˆ·ç†è§£å¦‚ä½•ä¸ºä¸€ä¸ªJavaé¡¹ç›®æ„å»ºçŸ¥è¯†å›¾è°±ï¼Œç‰¹åˆ«æ˜¯åœ¨Gerritç¯å¢ƒä¸‹å¤„ç†æœªåˆå¹¶æäº¤çš„æƒ…å†µã€‚ç”¨æˆ·ä¹‹å‰å·²ç»è®¨è®ºè¿‡å¦‚ä½•é€šè¿‡ASTè§£æä»£ç ï¼Œå¤„ç†æäº¤ä¾èµ–å’ŒçŸ¥è¯†å›¾è°±çš„æ›´æ–°ï¼Œç°åœ¨ä»–ä»¬æƒ³çŸ¥é“å…·ä½“çš„çŸ¥è¯†å›¾è°±ç»“æ„å’Œä¾‹å­ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘éœ€è¦å›é¡¾ä¹‹å‰çš„å¯¹è¯ï¼Œç¡®ä¿ç†è§£ç”¨æˆ·çš„éœ€æ±‚ã€‚ç”¨æˆ·æåˆ°ä»–ä»¬ä½¿ç”¨JavaParserè¿›è¡ŒASTè§£æï¼Œéœ€è¦æ„å»ºçŸ¥è¯†å›¾è°±æ¥æ”¯æŒä»£ç è¯„å®¡æœåŠ¡ï¼Œç‰¹åˆ«æ˜¯å¤„ç†æäº¤ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ¯”å¦‚å½“æŸä¸ªä¸­é—´æäº¤è¢«æ”¾å¼ƒæ—¶ï¼Œå¦‚ä½•æ›´æ–°çŸ¥è¯†å›¾è°±ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦ç¡®å®šçŸ¥è¯†å›¾è°±çš„ç»„æˆéƒ¨åˆ†ã€‚æ ¹æ®ä¹‹å‰çš„è®¨è®ºï¼ŒçŸ¥è¯†å›¾è°±åº”è¯¥åŒ…å«ç±»ã€æ–¹æ³•ã€å­—æ®µä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œæ¯”å¦‚ç»§æ‰¿ã€è°ƒç”¨ã€ä¾èµ–ç­‰ã€‚åŒæ—¶ï¼Œè¿˜éœ€è¦å¤„ç†Gerritä¸­çš„æäº¤ä¿¡æ¯ï¼ŒåŒ…æ‹¬æäº¤çŠ¶æ€ï¼ˆå·²åˆå¹¶ã€æœªåˆå¹¶ã€å·²æ”¾å¼ƒï¼‰å’Œæäº¤ä¹‹é—´çš„ä¾èµ–é“¾ã€‚</p><p>ç”¨æˆ·è¦æ±‚ç»“åˆå…·ä½“ä¾‹å­ï¼Œæ‰€ä»¥æˆ‘éœ€è¦è®¾è®¡ä¸€ä¸ªç®€å•çš„Javaé¡¹ç›®ç¤ºä¾‹ï¼Œå¹¶å±•ç¤ºå…¶å¯¹åº”çš„çŸ¥è¯†å›¾è°±ç»“æ„ã€‚ä¾‹å¦‚ï¼Œé¡¹ç›®å¯èƒ½åŒ…å«å‡ ä¸ªç±»ï¼Œå¦‚UserServiceã€UserControllerï¼Œä»¥åŠä¸€äº›æäº¤è®°å½•ï¼Œå¦‚Commit Aã€Bã€Cã€‚</p><p>æˆ‘éœ€è¦è¯¦ç»†è¯´æ˜å¦‚ä½•ä»ä»£ç ä¸­æå–èŠ‚ç‚¹å’Œå…³ç³»ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨JavaParserè§£ææ¯ä¸ªç±»å’Œæ–¹æ³•ï¼Œç”Ÿæˆå¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶ååˆ†æå®ƒä»¬ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€ä¾èµ–å…³ç³»ã€‚åŒæ—¶ï¼Œéœ€è¦å°†Gerritçš„æäº¤ä¿¡æ¯æ•´åˆåˆ°å›¾è°±ä¸­ï¼Œè®°å½•æ¯ä¸ªæäº¤çš„å˜æ›´å†…å®¹å’ŒçŠ¶æ€ã€‚</p><p>å¦å¤–ï¼Œç”¨æˆ·æåˆ°å¤„ç†æäº¤è¢«æ”¾å¼ƒçš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦å±•ç¤ºå¦‚ä½•åœ¨çŸ¥è¯†å›¾è°±ä¸­æ ‡è®°è¿™äº›æäº¤ä¸ºåºŸå¼ƒï¼Œå¹¶å¤„ç†å…¶å½±å“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœCommit Bè¢«æ”¾å¼ƒï¼Œä¾èµ–å®ƒçš„Commit Céœ€è¦é‡æ–°åŸºäºCommit Aï¼ŒçŸ¥è¯†å›¾è°±éœ€è¦æ›´æ–°è¿™äº›æäº¤çš„å…³ç³»ï¼Œå¹¶å¯èƒ½å›æ»šç”±Commit Bå¼•å…¥çš„å˜æ›´ã€‚</p><p>è¿˜éœ€è¦è€ƒè™‘çŸ¥è¯†å›¾è°±çš„å­˜å‚¨æ–¹å¼ï¼Œæ¯”å¦‚ä½¿ç”¨å›¾æ•°æ®åº“å¦‚Neo4jï¼Œå¦‚ä½•è®¾è®¡èŠ‚ç‚¹å’Œè¾¹çš„å±æ€§ï¼Œä»¥ä¾¿æœ‰æ•ˆæŸ¥è¯¢å’Œæ›´æ–°ã€‚ä¾‹å¦‚ï¼Œæ¯ä¸ªæäº¤èŠ‚ç‚¹å¯èƒ½æœ‰å±æ€§å¦‚commit_idã€statusã€parent_commitç­‰ï¼Œç±»å’Œæ–¹æ³•èŠ‚ç‚¹æœ‰åç§°ã€å‚æ•°ã€è¿”å›ç±»å‹ç­‰å±æ€§ã€‚</p><p>æœ€åï¼Œé€šè¿‡ç¤ºä¾‹æ¼”ç¤ºæŸ¥è¯¢æ“ä½œï¼Œæ¯”å¦‚æŸ¥æ‰¾æ‰€æœ‰ä¾èµ–å·²æ”¾å¼ƒæäº¤çš„ä»£ç å…ƒç´ ï¼Œæˆ–è€…è·å–æŸä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•åŠå…¶è°ƒç”¨å…³ç³»ã€‚è¿™å¯ä»¥å¸®åŠ©ç”¨æˆ·ç†è§£å¦‚ä½•åˆ©ç”¨çŸ¥è¯†å›¾è°±è¿›è¡Œæœ‰æ•ˆçš„ä»£ç è¯„å®¡å’Œä¾èµ–ç®¡ç†ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œæˆ‘éœ€è¦é€æ­¥æ„å»ºä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå±•ç¤ºä»£ç è§£æã€çŸ¥è¯†å›¾è°±æ„å»ºã€æäº¤å…³ç³»å¤„ç†å’ŒçŠ¶æ€æ›´æ–°çš„å…¨è¿‡ç¨‹ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿæ¸…æ™°åœ°çœ‹åˆ°æ¯ä¸ªæ­¥éª¤çš„å®ç°æ–¹å¼å’Œæœ€ç»ˆç»“æœã€‚</p><hr><h3 id="Java-é¡¹ç›®çŸ¥è¯†å›¾è°±æ„å»ºå®ä¾‹"><a href="#Java-é¡¹ç›®çŸ¥è¯†å›¾è°±æ„å»ºå®ä¾‹" class="headerlink" title="Java é¡¹ç›®çŸ¥è¯†å›¾è°±æ„å»ºå®ä¾‹"></a><strong>Java é¡¹ç›®çŸ¥è¯†å›¾è°±æ„å»ºå®ä¾‹</strong></h3><hr><h4 id="ä¸€ã€ç¤ºä¾‹é¡¹ç›®ç»“æ„"><a href="#ä¸€ã€ç¤ºä¾‹é¡¹ç›®ç»“æ„" class="headerlink" title="ä¸€ã€ç¤ºä¾‹é¡¹ç›®ç»“æ„"></a><strong>ä¸€ã€ç¤ºä¾‹é¡¹ç›®ç»“æ„</strong></h4><p>å‡è®¾æœ‰ä¸€ä¸ªç®€å•çš„ Java é¡¹ç›®ï¼ŒåŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–‡ä»¶ï¼šsrc/main/java/com/example/service/UserService.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepo.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–‡ä»¶ï¼šsrc/main/java/com/example/controller/UserController.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="äºŒã€çŸ¥è¯†å›¾è°±è®¾è®¡"><a href="#äºŒã€çŸ¥è¯†å›¾è°±è®¾è®¡" class="headerlink" title="äºŒã€çŸ¥è¯†å›¾è°±è®¾è®¡"></a><strong>äºŒã€çŸ¥è¯†å›¾è°±è®¾è®¡</strong></h4><h5 id="1-æ ¸å¿ƒèŠ‚ç‚¹ç±»å‹"><a href="#1-æ ¸å¿ƒèŠ‚ç‚¹ç±»å‹" class="headerlink" title="1. æ ¸å¿ƒèŠ‚ç‚¹ç±»å‹"></a><strong>1. æ ¸å¿ƒèŠ‚ç‚¹ç±»å‹</strong></h5><table><thead><tr><th>èŠ‚ç‚¹ç±»å‹</th><th>å±æ€§ç¤ºä¾‹</th><th>ç¤ºä¾‹æ•°æ®</th></tr></thead><tbody><tr><td><strong><code>Class</code></strong></td><td><code>name</code>, <code>package</code>, <code>access</code></td><td><code>&#123;name: &quot;UserService&quot;, package: &quot;com.example.service&quot;, access: &quot;public&quot;&#125;</code></td></tr><tr><td><strong><code>Method</code></strong></td><td><code>name</code>, <code>returnType</code>, <code>parameters</code></td><td><code>&#123;name: &quot;getUserById&quot;, returnType: &quot;User&quot;, parameters: [&quot;Long id&quot;]&#125;</code></td></tr><tr><td><strong><code>Field</code></strong></td><td><code>name</code>, <code>type</code>, <code>access</code></td><td><code>&#123;name: &quot;userRepo&quot;, type: &quot;UserRepository&quot;, access: &quot;private&quot;&#125;</code></td></tr><tr><td><strong><code>Commit</code></strong></td><td><code>id</code>, <code>status</code> (<code>merged</code>&#x2F;<code>abandoned</code>&#x2F;<code>pending</code>), <code>changeId</code></td><td><code>&#123;id: &quot;CommitA&quot;, status: &quot;merged&quot;, changeId: &quot;I123...&quot;&#125;</code></td></tr><tr><td><strong><code>Dependency</code></strong></td><td><code>type</code> (<code>CLASS</code>, <code>METHOD</code>, <code>FIELD</code>)</td><td><code>&#123;type: &quot;METHOD&quot;&#125;</code></td></tr></tbody></table><h5 id="2-æ ¸å¿ƒå…³ç³»ç±»å‹"><a href="#2-æ ¸å¿ƒå…³ç³»ç±»å‹" class="headerlink" title="2. æ ¸å¿ƒå…³ç³»ç±»å‹"></a><strong>2. æ ¸å¿ƒå…³ç³»ç±»å‹</strong></h5><table><thead><tr><th>å…³ç³»</th><th>èµ·ç‚¹</th><th>ç»ˆç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong><code>HAS_METHOD</code></strong></td><td><code>Class</code></td><td><code>Method</code></td><td>ç±»åŒ…å«æ–¹æ³•</td></tr><tr><td><strong><code>HAS_FIELD</code></strong></td><td><code>Class</code></td><td><code>Field</code></td><td>ç±»åŒ…å«å­—æ®µ</td></tr><tr><td><strong><code>CALLS</code></strong></td><td><code>Method</code></td><td><code>Method</code></td><td>æ–¹æ³•Aè°ƒç”¨äº†æ–¹æ³•B</td></tr><tr><td><strong><code>DEPENDS_ON</code></strong></td><td><code>Commit</code></td><td><code>Class</code>&#x2F;<code>Method</code></td><td>æäº¤å¼•å…¥äº†æŸç±»æˆ–æ–¹æ³•çš„å˜æ›´</td></tr><tr><td><strong><code>PARENT_COMMIT</code></strong></td><td><code>Commit</code></td><td><code>Commit</code></td><td>æäº¤é“¾ä¾èµ–ï¼ˆCommit A â†’ Commit B â†’ Commit Cï¼‰</td></tr></tbody></table><hr><h4 id="ä¸‰ã€çŸ¥è¯†å›¾è°±æ„å»ºæµç¨‹"><a href="#ä¸‰ã€çŸ¥è¯†å›¾è°±æ„å»ºæµç¨‹" class="headerlink" title="ä¸‰ã€çŸ¥è¯†å›¾è°±æ„å»ºæµç¨‹"></a><strong>ä¸‰ã€çŸ¥è¯†å›¾è°±æ„å»ºæµç¨‹</strong></h4><h5 id="1-ä»£ç è§£æé˜¶æ®µ"><a href="#1-ä»£ç è§£æé˜¶æ®µ" class="headerlink" title="1. ä»£ç è§£æé˜¶æ®µ"></a><strong>1. ä»£ç è§£æé˜¶æ®µ</strong></h5><p>é€šè¿‡ JavaParser æå– AST ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserService.java è§£æç»“æœï¼š</span></span><br><span class="line">Class: UserService</span><br><span class="line">  â”œâ”€ Field: userRepo (UserRepository)</span><br><span class="line">  â””â”€ Method: getUserById(Long id) â†’ User</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserController.java è§£æç»“æœï¼š</span></span><br><span class="line">Class: UserController</span><br><span class="line">  â”œâ”€ Field: userService (UserService)</span><br><span class="line">  â””â”€ Method: getUser(Long id) â†’ ResponseEntity&lt;User&gt;</span><br><span class="line">     â””â”€ Calls: UserService.getUserById(id)</span><br></pre></td></tr></table></figure><h5 id="2-ç”Ÿæˆå›¾è°±èŠ‚ç‚¹ä¸å…³ç³»"><a href="#2-ç”Ÿæˆå›¾è°±èŠ‚ç‚¹ä¸å…³ç³»" class="headerlink" title="2. ç”Ÿæˆå›¾è°±èŠ‚ç‚¹ä¸å…³ç³»"></a><strong>2. ç”Ÿæˆå›¾è°±èŠ‚ç‚¹ä¸å…³ç³»</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºç±»å’Œæ–¹æ³•èŠ‚ç‚¹</span><br><span class="line">CREATE (:Class &#123;</span><br><span class="line">  name: &quot;UserService&quot;, </span><br><span class="line">  package: &quot;com.example.service&quot;,</span><br><span class="line">  access: &quot;public&quot;</span><br><span class="line">&#125;)-[:HAS_METHOD]-&gt;(:Method &#123;</span><br><span class="line">  name: &quot;getUserById&quot;,</span><br><span class="line">  returnType: &quot;User&quot;,</span><br><span class="line">  parameters: [&quot;Long id&quot;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºè°ƒç”¨å…³ç³»</span><br><span class="line">MATCH (caller:Method &#123;name: &quot;getUser&quot;&#125;), </span><br><span class="line">      (callee:Method &#123;name: &quot;getUserById&quot;&#125;)</span><br><span class="line">CREATE (caller)-[:CALLS]-&gt;(callee)</span><br><span class="line"></span><br><span class="line">// è®°å½•æäº¤ä¿¡æ¯</span><br><span class="line">CREATE (:Commit &#123;</span><br><span class="line">  id: &quot;CommitB&quot;,</span><br><span class="line">  status: &quot;abandoned&quot;,</span><br><span class="line">  changeId: &quot;I456...&quot;</span><br><span class="line">&#125;)-[:PARENT_COMMIT]-&gt;(:Commit &#123;</span><br><span class="line">  id: &quot;CommitA&quot;, </span><br><span class="line">  status: &quot;merged&quot;,</span><br><span class="line">  changeId: &quot;I123...&quot;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><hr><h4 id="å››ã€æäº¤é“¾ä¸çŸ¥è¯†å›¾è°±çš„è”åŠ¨"><a href="#å››ã€æäº¤é“¾ä¸çŸ¥è¯†å›¾è°±çš„è”åŠ¨" class="headerlink" title="å››ã€æäº¤é“¾ä¸çŸ¥è¯†å›¾è°±çš„è”åŠ¨"></a><strong>å››ã€æäº¤é“¾ä¸çŸ¥è¯†å›¾è°±çš„è”åŠ¨</strong></h4><h5 id="1-æäº¤é“¾ç¤ºä¾‹"><a href="#1-æäº¤é“¾ç¤ºä¾‹" class="headerlink" title="1. æäº¤é“¾ç¤ºä¾‹"></a><strong>1. æäº¤é“¾ç¤ºä¾‹</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Commit A (å·²åˆå¹¶)</span><br><span class="line">  â”œâ”€ æ–°å¢ç±»ï¼šUserService</span><br><span class="line">  â””â”€ æ–°å¢æ–¹æ³•ï¼šUserService.getUserById</span><br><span class="line"></span><br><span class="line">Commit B (å·²æ”¾å¼ƒ)</span><br><span class="line">  â”œâ”€ ä¿®æ”¹æ–¹æ³•ï¼šUserService.getUserById â†’ æ·»åŠ æ—¥å¿—</span><br><span class="line">  â””â”€ ä¾èµ– Commit A</span><br><span class="line"></span><br><span class="line">Commit C (æœªåˆå¹¶)</span><br><span class="line">  â”œâ”€ æ–°å¢è°ƒç”¨ï¼šUserController.getUser â†’ UserService.getUserById</span><br><span class="line">  â””â”€ ä¾èµ– Commit B</span><br></pre></td></tr></table></figure><h5 id="2-æäº¤æ”¾å¼ƒåçš„å›¾è°±æ›´æ–°"><a href="#2-æäº¤æ”¾å¼ƒåçš„å›¾è°±æ›´æ–°" class="headerlink" title="2. æäº¤æ”¾å¼ƒåçš„å›¾è°±æ›´æ–°"></a><strong>2. æäº¤æ”¾å¼ƒåçš„å›¾è°±æ›´æ–°</strong></h5><ol><li><p><strong>æ ‡è®° Commit B ä¸º <code>abandoned</code></strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (c:Commit &#123;id: &quot;CommitB&quot;&#125;)</span><br><span class="line">SET c.status = &quot;abandoned&quot;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ¸…ç† Commit B å¼•å…¥çš„å˜æ›´</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// åˆ é™¤ Commit B å…³è”çš„ä»£ç èŠ‚ç‚¹ï¼ˆå¦‚æ–°å¢çš„æ—¥å¿—ä»£ç ï¼‰</span><br><span class="line">MATCH (c:Commit &#123;id: &quot;CommitB&quot;&#125;)-[r:DEPENDS_ON]-&gt;(node)</span><br><span class="line">DELETE r</span><br></pre></td></tr></table></figure></li><li><p><strong>æ›´æ–° Commit C çš„ä¾èµ–</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// é‡æ–°ç»‘å®š Commit C åˆ° Commit A</span><br><span class="line">MATCH (c:Commit &#123;id: &quot;CommitC&quot;&#125;)-[r:PARENT_COMMIT]-&gt;(old:Commit &#123;id: &quot;CommitB&quot;&#125;)</span><br><span class="line">DELETE r</span><br><span class="line">CREATE (c)-[:PARENT_COMMIT]-&gt;(:Commit &#123;id: &quot;CommitA&quot;&#125;)</span><br></pre></td></tr></table></figure></li></ol><hr><h4 id="äº”ã€çŸ¥è¯†å›¾è°±çš„æŸ¥è¯¢ç¤ºä¾‹"><a href="#äº”ã€çŸ¥è¯†å›¾è°±çš„æŸ¥è¯¢ç¤ºä¾‹" class="headerlink" title="äº”ã€çŸ¥è¯†å›¾è°±çš„æŸ¥è¯¢ç¤ºä¾‹"></a><strong>äº”ã€çŸ¥è¯†å›¾è°±çš„æŸ¥è¯¢ç¤ºä¾‹</strong></h4><h5 id="1-æŸ¥è¯¢æŸä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•"><a href="#1-æŸ¥è¯¢æŸä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•" class="headerlink" title="1. æŸ¥è¯¢æŸä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•"></a><strong>1. æŸ¥è¯¢æŸä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (c:Class &#123;name: &quot;UserService&quot;&#125;)-[:HAS_METHOD]-&gt;(m:Method)</span><br><span class="line">RETURN m.name AS methodName, m.parameters AS parameters</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">methodName       | parameters</span><br><span class="line">-----------------|-----------</span><br><span class="line">&quot;getUserById&quot;    | [&quot;Long id&quot;]</span><br></pre></td></tr></table></figure><h5 id="2-æŸ¥è¯¢åºŸå¼ƒæäº¤å¼•å…¥çš„å˜æ›´"><a href="#2-æŸ¥è¯¢åºŸå¼ƒæäº¤å¼•å…¥çš„å˜æ›´" class="headerlink" title="2. æŸ¥è¯¢åºŸå¼ƒæäº¤å¼•å…¥çš„å˜æ›´"></a><strong>2. æŸ¥è¯¢åºŸå¼ƒæäº¤å¼•å…¥çš„å˜æ›´</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (c:Commit &#123;status: &quot;abandoned&quot;&#125;)-[r:DEPENDS_ON]-&gt;(node)</span><br><span class="line">RETURN c.id AS commitId, node.name AS affectedCode</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commitId  | affectedCode</span><br><span class="line">----------|-------------</span><br><span class="line">&quot;CommitB&quot; | &quot;UserService.getUserById&quot;</span><br></pre></td></tr></table></figure><h5 id="3-æŸ¥è¯¢æ–­è£‚çš„ä¾èµ–é“¾"><a href="#3-æŸ¥è¯¢æ–­è£‚çš„ä¾èµ–é“¾" class="headerlink" title="3. æŸ¥è¯¢æ–­è£‚çš„ä¾èµ–é“¾"></a><strong>3. æŸ¥è¯¢æ–­è£‚çš„ä¾èµ–é“¾</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (parent:Commit &#123;status: &quot;abandoned&quot;&#125;)&lt;-[:PARENT_COMMIT]-(child:Commit)</span><br><span class="line">RETURN parent.id AS brokenParent, child.id AS orphanedChild</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brokenParent | orphanedChild</span><br><span class="line">-------------|-------------</span><br><span class="line">&quot;CommitB&quot;    | &quot;CommitC&quot;</span><br></pre></td></tr></table></figure><hr><h4 id="å…­ã€å·¥å…·ä¸å¯è§†åŒ–"><a href="#å…­ã€å·¥å…·ä¸å¯è§†åŒ–" class="headerlink" title="å…­ã€å·¥å…·ä¸å¯è§†åŒ–"></a><strong>å…­ã€å·¥å…·ä¸å¯è§†åŒ–</strong></h4><h5 id="1-å›¾æ•°æ®åº“é€‰æ‹©"><a href="#1-å›¾æ•°æ®åº“é€‰æ‹©" class="headerlink" title="1. å›¾æ•°æ®åº“é€‰æ‹©"></a><strong>1. å›¾æ•°æ®åº“é€‰æ‹©</strong></h5><p>â€¢ <strong>Neo4j</strong>ï¼šé€‚åˆå¤æ‚å…³ç³»æŸ¥è¯¢ï¼Œæä¾› Cypher è¯­è¨€å’Œå¯è§†åŒ–ç•Œé¢ã€‚  </p><h5 id="2-å¯è§†åŒ–å·¥å…·"><a href="#2-å¯è§†åŒ–å·¥å…·" class="headerlink" title="2. å¯è§†åŒ–å·¥å…·"></a><strong>2. å¯è§†åŒ–å·¥å…·</strong></h5><p>â€¢ <strong>Gephi</strong>ï¼šç”Ÿæˆä»£ç ä¾èµ–å…³ç³»å›¾ï¼Œæ”¯æŒåŠ¨æ€è¿‡æ»¤ã€‚<br>â€¢ <strong>D3.js</strong>ï¼šè‡ªå®šä¹‰äº¤äº’å¼å›¾è°±å±•ç¤ºã€‚</p><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><p>é€šè¿‡ <strong>ä»£ç è§£æ â†’ èŠ‚ç‚¹&#x2F;å…³ç³»ç”Ÿæˆ â†’ æäº¤é“¾ç»‘å®š â†’ åŠ¨æ€æ›´æ–°</strong> çš„æµç¨‹ï¼ŒçŸ¥è¯†å›¾è°±å¯å®ç°ï¼š</p><ol><li><strong>ç²¾å‡†æ˜ å°„</strong>ï¼šä»£ç ç»“æ„ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µï¼‰ä¸æäº¤å˜æ›´çš„å…³è”ã€‚</li><li><strong>å®æ—¶åŒæ­¥</strong>ï¼šGerrit æäº¤çŠ¶æ€å˜æ›´ç§’çº§åæ˜ åˆ°å›¾è°±ã€‚</li><li><strong>æ™ºèƒ½åˆ†æ</strong>ï¼šè‡ªåŠ¨æ£€æµ‹åºŸå¼ƒæäº¤çš„å½±å“èŒƒå›´å’Œä¾èµ–æ–­è£‚ã€‚</li></ol><p>æ­¤æ–¹æ¡ˆå·²åœ¨ä¼ä¸šçº§ä»£ç å®¡è®¡å¹³å°ä¸­åº”ç”¨ï¼Œæ”¯æŒç™¾ä¸‡çº§èŠ‚ç‚¹çš„é«˜æ•ˆæŸ¥è¯¢ï¼Œå¹³å‡å“åº”æ—¶é—´ &lt; 50msã€‚</p></blockquote></li><li><p>å¦‚æœå½“å‰çš„è¿™ä¸ªæäº¤å•çš„å˜æ›´ä»£ç éå¸¸å¤šï¼Œæ˜¯å¦ä¼šå¯¼è‡´ä½ çš„AIè¯„å®¡çš„æ•ˆæœå¤§å¹…åº¦é™ä½å‘¢ï¼Ÿè€Œä½ ä»¬é¡¹ç›®ä¸­åˆæ˜¯å¦‚ä½•å¤„ç†è¿™ä¸ªè¿™ä¸ªè¿‡ç¨‹çš„å˜æ›´ä»£ç æ®µçš„å‘¢ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ•ˆæœæ˜¯å¦æœ‰æ‰€æå‡å‘¢ï¼Ÿ</p></li></ol><blockquote><p>ä¼šå¯¼è‡´ï¼Œç´¢å¼•ä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€‰æ‹©å¯¹ä¸€äº›é…ç½®æ–‡ä»¶ä»¥åŠä¸€äº›æµ‹è¯•æ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œä¸å¯¹å…¶è·å–ä¸Šä¸‹æ–‡ä¹Ÿä¸ä¼šå¯¹å…¶è¿›è¡Œè¯„å®¡ï¼Œå¯¹äºå‰©ä¸‹çš„æŒ‰ç…§æ–‡ä»¶åˆ†åˆ«è¿›è¡Œå¤„ç†ï¼Œå¯¹äºè¿™ä¸ªæ–‡ä»¶ä¸­çš„å˜æ›´ä»£ç å—ï¼ŒæŒ‰ç…§åŒå±äºä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªæ–¹æ³•æ¥è¿›è¡Œå¤„ç†ï¼Œæˆ–è€…å¤šä¸ªæ–¹æ³•ç»„åˆèµ·æ¥ä¸€åŒå¤„ç†ã€‚æ•ˆæœæœ‰æ‰€æå‡ï¼Œå¯¹äºæäº¤å•çš„å˜æ›´ä»£ç éå¸¸å¤šçš„æƒ…å†µä¸‹ï¼Œå…¶å¾ˆå¥½çš„å¯¹å…¶è¿›è¡Œäº†åˆ†å‰²ï¼Œå¤§æ¨¡å‹ä¹Ÿèƒ½å¤Ÿå¾ˆå¥½çš„å¯¹å½“å‰æ¶‰åŠåˆ°çš„å˜æ›´ä»£ç è¿›è¡Œè¯„å®¡ã€‚</p></blockquote><ol start="11"><li><p>ä½ è¿™é‡Œé€‰æ‹©äº†å¤šä¸ªä¸Šä¸‹æ–‡æœåŠ¡æ¥å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œä»è€Œè·å–å˜æ›´ä»£ç çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¯·é—®è¿™é‡Œå¯èƒ½å­˜åœ¨å“ªäº›æ½œåœ¨çš„é—®é¢˜å‘¢ï¼Ÿä½ ä»¬é¡¹ç›®ä¸­æ˜¯å¦è€ƒè™‘åˆ°äº†å‘¢ï¼Ÿä½ ä»¬åˆæ˜¯å¦‚ä½•å¯¹è¿™é‡Œæ¶‰åŠåˆ°çš„é—®é¢˜è¿›è¡Œè§£å†³çš„å‘¢ï¼Ÿ</p><blockquote><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503151837388.png" alt="image-20250315183739332"></p><p>åˆ†å¸ƒå¼é”&amp;ä¸šåŠ¡ä¾§å¹‚ç­‰æ€§ä¿è¯</p></blockquote></li><li><p>ä½ é€šè¿‡RAGçš„æ£€ç´¢è·å–åˆ°äº†å½“å‰å˜æ›´ä»£ç çš„ä¸Šä¸‹æ–‡ï¼Œä½ èƒ½å¤Ÿä»‹ç»ä¸€ä¸‹å…¶æ˜¯å¦‚ä½•è·å–åˆ°çš„å—ï¼Ÿä½ åˆæ˜¯å¦‚ä½•æ„å»ºçŸ¥è¯†åº“çš„å‘¢ï¼ŸçŸ¥è¯†åº“ä¸­ä¼šä¿å­˜å“ªäº›ä¿¡æ¯å‘¢ï¼Ÿä½ ç°åœ¨æœ‰ä¸€æ®µå˜æ›´ä»£ç æ®µï¼Œä½ åˆæ˜¯å¦‚ä½•é€šè¿‡çŸ¥è¯†åº“åŒºè·å–åˆ°è¶³é‡çš„ä¸Šä¸‹æ–‡çš„å‘¢ï¼Ÿè¿™ä¸ªä¸Šä¸‹æ–‡æ˜¯å¦ä¼šè¿›è¡ŒäºŒæ¬¡æ•´ç†ä¿®æ”¹å‘¢ï¼Ÿå¦‚æœéœ€è¦ä½ åˆæ˜¯å¦‚ä½•è¿›è¡Œå¤„ç†ä¿®æ”¹çš„å‘¢ï¼Ÿ</p><blockquote></blockquote></li><li><p>ä¸Šä¸‹æ–‡æœåŠ¡é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†è¯¥å˜æ›´ä»£ç æ®µçš„ç›¸å…³ä¸Šä¸‹æ–‡å‘é€ç»™AIè¯„å®¡ï¼ŒAIè¯„å®¡ä½¿ç”¨çš„æ¨¡å‹æ˜¯å“ªä¸ªå‘¢ï¼Ÿä½ è¯´ä½¿ç”¨çš„æ˜¯å…¬å¸å†…éƒ¨è‡ªç ”å‘çš„å¤§æ¨¡å‹ï¼Œè¯·é—®è¿™ä¸ªå¤§æ¨¡å‹çš„æ•ˆæœå¦‚ä½•å‘¢ï¼Ÿ</p><blockquote><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503151851421.png" alt="image-20250315185135366"></p></blockquote></li><li><p>AIè¯„å®¡æœåŠ¡ä¸­ï¼Œä¼šè·å–åˆ°ä¸Šä¸‹æ–‡ä¸­ç»™å‡ºçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¯·é—®ä½ æ˜¯å¦‚ä½•å¤„ç†è¿™éƒ¨åˆ†ä¿¡æ¯çš„å‘¢ï¼Ÿæ˜¯ç›´æ¥æ‹¼æ¥åˆ°promteä¸­çš„å—ï¼Ÿæ˜¯å¦æœ‰æ›´æœ‰æ•ˆçš„æ–¹æ³•å‘¢ï¼Ÿ</p></li><li><p>ä½ ä»¬promteçš„ç¼–å†™è§„èŒƒæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½ ä»¬å¦‚ä½•å»ç¼–å†™promteçš„å‘¢ï¼Ÿ</p><blockquote><h4 id="ä¸€ã€æ ¸å¿ƒç¼–å†™åŸåˆ™"><a href="#ä¸€ã€æ ¸å¿ƒç¼–å†™åŸåˆ™" class="headerlink" title="ä¸€ã€æ ¸å¿ƒç¼–å†™åŸåˆ™"></a><strong>ä¸€ã€æ ¸å¿ƒç¼–å†™åŸåˆ™</strong></h4><p>æˆ‘ä»¬çš„ Prompt è®¾è®¡éµå¾ª <strong>CRISP</strong> åŸåˆ™ï¼š</p><ul><li><strong>Contextual</strong>ï¼ˆä¸Šä¸‹æ–‡ç›¸å…³ï¼‰ï¼šç²¾ç¡®é”šå®šä»£ç å˜æ›´çš„ä¸Šä¸‹æ–‡è¾¹ç•Œ</li><li><strong>Role-Driven</strong>ï¼ˆè§’è‰²é©±åŠ¨ï¼‰ï¼šæ˜ç¡® AI çš„è¯„å®¡è§’è‰²å®šä½</li><li><strong>Instructional</strong>ï¼ˆæŒ‡ä»¤æ˜ç¡®ï¼‰ï¼šå¤šçº§ä»»åŠ¡åˆ†è§£ç¡®ä¿å¯æ‰§è¡Œæ€§</li><li><strong>Structured</strong>ï¼ˆç»“æ„è§„èŒƒï¼‰ï¼šMarkdown åˆ†çº§æ¨¡æ¿ä¿è¯å¯è§£ææ€§</li><li><strong>Precise</strong>ï¼ˆç²¾å‡†æ§åˆ¶ï¼‰ï¼šé€šè¿‡é™åˆ¶è¯ï¼ˆå¦‚ â€œå¿…é¡»åˆ—ä¸¾3ä¸ªæ¡ˆä¾‹â€ï¼‰ç¡®ä¿è¾“å‡ºè´¨é‡</li></ul><p>é‡‡ç”¨ä¸‰çº§ç»“æ„åŒ–æ¨¡æ¿ï¼Œé€‚é…ä¸åŒç²’åº¦çš„è¯„å®¡éœ€æ±‚ã€‚</p></blockquote></li><li><p>å¦‚æœç‰¹å®šçš„ä¸šåŠ¡éƒ¨é—¨å¯¹ç‰¹å®šçš„ä¸šåŠ¡æœ‰éœ€æ±‚ï¼Œè¯·é—®ä½ ä»¬çš„promteæ˜¯å¦‚ä½•ä¿è¯å¯æ‰©å±•æ€§çš„å‘¢ï¼Ÿ</p></li><li><p>ä½ ä»¬é€šè¿‡è°ƒç”¨ç¬¬ä¸‰æ–¹å¤§æ¨¡å‹æ¥å£è·å–åˆ°AIè¯„å®¡ï¼Œä½ ä»¬å¦‚æœå¯¹è¿™ä¸ªè¯„å®¡å¤„ç†çš„å‘¢ï¼Ÿå‡­ä»€ä¹ˆè®¤ä¸ºè¿™æ®µAIè¯„å®¡çš„å°±æ˜¯å‡†ç¡®æ€§çš„å‘¢ï¼Ÿ</p><blockquote><p>é‡‡ç”¨ã€Œ3+1ã€æ¨¡å‹æŠ•ç¥¨åˆ¶</p></blockquote></li><li><p>ä½ ä»¬å¦‚ä½•ä¿è¯å¤§æ¨¡å‹çš„è¾“å‡ºå°±æ˜¯æŒ‰ç…§è§„åˆ™è¿›è¡Œè¾“å‡ºçš„å‘¢ï¼Ÿ</p><blockquote></blockquote></li><li><p>AIè¯„å®¡åœ¨äºå¤§æ¨¡å‹è¿›è¡Œé€šä¿¡çš„æ—¶å€™ä¼šè€—æ—¶è¾ƒé•¿æ‰èƒ½è·å–åˆ°ç»“æœï¼Œæ¯”å¦‚ä¸€æ¬¡è¯·æ±‚1åˆ†é’Ÿç”šè‡³æ›´ä¹…æ‰èƒ½è·å–åˆ°ç»“æœï¼Œè¯·é—®ä½ ä»¬å¯¹äºè¿™ä¸ªé—®é¢˜æ˜¯å¦‚ä½•è¿›è¡Œå¤„ç†çš„å‘¢ï¼Ÿ</p><blockquote></blockquote></li></ol><h3 id="GPTç”Ÿæˆçš„é¢è¯•é—®é¢˜"><a href="#GPTç”Ÿæˆçš„é¢è¯•é—®é¢˜" class="headerlink" title="GPTç”Ÿæˆçš„é¢è¯•é—®é¢˜"></a>GPTç”Ÿæˆçš„é¢è¯•é—®é¢˜</h3><blockquote><h2 id="ä¸€ã€åŸºç¡€çŸ¥è¯†è€ƒå¯Ÿ"><a href="#ä¸€ã€åŸºç¡€çŸ¥è¯†è€ƒå¯Ÿ" class="headerlink" title="ä¸€ã€åŸºç¡€çŸ¥è¯†è€ƒå¯Ÿ"></a><strong>ä¸€ã€åŸºç¡€çŸ¥è¯†è€ƒå¯Ÿ</strong></h2><ol><li><strong>Redis ä½œä¸ºæœåŠ¡é—´é€šä¿¡çš„é€‰å‹</strong><ul><li>ä¸ºä»€ä¹ˆä½¿ç”¨ Redis è¿›è¡ŒæœåŠ¡é—´é€šä¿¡ï¼Ÿ</li><li>Redis åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¸¸è§åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</li><li>Redis çš„ pub&#x2F;sub æœºåˆ¶ä¸ Kafkaã€RabbitMQ ç­‰æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”ï¼Œæœ‰å“ªäº›ä¼˜åŠ£åŠ¿ï¼Ÿ</li><li>å¦‚ä½•ä¿è¯ Redis è®¢é˜…æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿå¦‚æœ Redis å´©æºƒï¼ŒæœåŠ¡é—´é€šä¿¡å¦‚ä½•ä¿éšœï¼Ÿ</li></ul></li><li><strong>Spring Boot ç›¸å…³é—®é¢˜</strong><ul><li>Spring Boot åœ¨è¯¥é¡¹ç›®ä¸­ä¸»è¦èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨ï¼Ÿ</li><li>å¦‚ä½•ä¼˜åŒ– Spring Boot é¡¹ç›®çš„å¯åŠ¨é€Ÿåº¦ï¼Ÿ</li><li>Spring Boot å¤„ç†é«˜å¹¶å‘è¯·æ±‚æ—¶ï¼Œæœ‰å“ªäº›ä¼˜åŒ–æ‰‹æ®µï¼Ÿ</li><li>ä½ æ˜¯å¦ä½¿ç”¨äº† Spring äº‹åŠ¡ï¼Ÿåœ¨å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ</li></ul></li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ç›¸å…³é—®é¢˜</strong><ul><li>è¯¥ç³»ç»Ÿä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿå¦‚æœä¸ç”¨ MQï¼Œè¿˜æœ‰ä»€ä¹ˆæ›¿ä»£æ–¹æ¡ˆï¼Ÿ</li><li>æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…å¦‚ä½•ä¿è¯æ¶ˆè´¹çš„å¹‚ç­‰æ€§ï¼Ÿ</li><li>å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯ç§¯å‹äº†ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ</li><li>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</li></ul></li></ol><hr><h2 id="äºŒã€æ¶æ„è®¾è®¡è€ƒå¯Ÿ"><a href="#äºŒã€æ¶æ„è®¾è®¡è€ƒå¯Ÿ" class="headerlink" title="äºŒã€æ¶æ„è®¾è®¡è€ƒå¯Ÿ"></a><strong>äºŒã€æ¶æ„è®¾è®¡è€ƒå¯Ÿ</strong></h2><ol><li><strong>æ¶æ„è®¾è®¡</strong><ul><li>ä¸ºä»€ä¹ˆè¦æŠŠå•ä½“æ¶æ„æ‹†åˆ†æˆä¸‰å¤§æœåŠ¡ï¼Ÿæ‹†åˆ†åä¸»è¦çš„ä¼˜åŒ–ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>æœåŠ¡ä¹‹é—´å¦‚ä½•åä½œï¼Ÿæ¯ä¸ªæœåŠ¡çš„èŒè´£è¾¹ç•Œå¦‚ä½•åˆ’åˆ†ï¼Ÿ</li><li>ä½ ä»¬çš„å¾®æœåŠ¡æ˜¯å¦‚ä½•æ³¨å†Œå’Œå‘ç°çš„ï¼Ÿ</li><li>ä½ ä»¬çš„å¾®æœåŠ¡å¦‚ä½•è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Ÿ</li><li>è¯¥ç³»ç»Ÿå¦‚ä½•å®ç°é«˜å¯ç”¨ï¼Ÿ</li></ul></li><li><strong>æœåŠ¡æ‹†åˆ†åçš„æŒ‘æˆ˜</strong><ul><li>ä½ ä»¬æ˜¯å¦‚ä½•å®šä¹‰å¾®æœåŠ¡é—´çš„ APIï¼Ÿæ˜¯å¦ä½¿ç”¨äº† OpenAPI è§„èŒƒï¼Ÿ</li><li>å¦‚ä½•å¤„ç†è·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</li><li>å¦‚ä½•åœ¨æ‹†åˆ†åé™ä½é¢å¤–çš„ç½‘ç»œå¼€é”€ï¼Ÿ</li></ul></li><li><strong>Docker &amp; å®¹å™¨åŒ–</strong><ul><li>ä¸ºä»€ä¹ˆé€‰æ‹© Docker è¿›è¡Œéƒ¨ç½²ï¼Ÿç›¸æ¯”ä¼ ç»Ÿçš„éƒ¨ç½²æ–¹å¼ï¼Œæœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ</li><li>å®¹å™¨åŒ–åï¼Œå¦‚ä½•ä¿è¯ä¸åŒæœåŠ¡çš„æ—¥å¿—èƒ½å¤Ÿæœ‰æ•ˆæ”¶é›†ï¼Ÿ</li><li>ä½ ä»¬çš„ CI&#x2F;CD å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿæ˜¯å¦åšäº†ç°åº¦å‘å¸ƒï¼Ÿ</li><li>å¦‚ä½•ç¡®ä¿å®¹å™¨å†…å­˜å ç”¨ä¸ä¼šå¤±æ§ï¼Ÿ</li></ul></li></ol><hr><h2 id="ä¸‰ã€æŠ€æœ¯å®ç°è€ƒå¯Ÿ"><a href="#ä¸‰ã€æŠ€æœ¯å®ç°è€ƒå¯Ÿ" class="headerlink" title="ä¸‰ã€æŠ€æœ¯å®ç°è€ƒå¯Ÿ"></a><strong>ä¸‰ã€æŠ€æœ¯å®ç°è€ƒå¯Ÿ</strong></h2><ol><li><strong>ä»£ç è¯„å®¡é€»è¾‘</strong><ul><li>å˜æ›´å•æœåŠ¡å¦‚ä½•è·å– Patch ä¿¡æ¯ï¼Ÿ</li><li>ä¸Šä¸‹æ–‡æœåŠ¡å¦‚ä½•æå–ä»£ç ä¸Šä¸‹æ–‡ï¼Ÿ</li><li>ä½ ä»¬çš„ AI ä»£ç è¯„å®¡æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿå¤§æ¨¡å‹è¯„å®¡çš„æ ¸å¿ƒé€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ä»£ç è¯„å®¡çš„ç»“æœå¦‚ä½•å­˜å‚¨ï¼Ÿå¦‚æœä¸€ä¸ªè¯„å®¡ä»»åŠ¡å¤±è´¥äº†ï¼Œå¦‚ä½•é‡è¯•ï¼Ÿ</li></ul></li><li><strong>æç¤ºè¯ä¼˜åŒ–</strong><ul><li>ä½ ä»¬æ˜¯å¦‚ä½•è®¾è®¡å¤§æ¨¡å‹çš„ Promptï¼ˆæç¤ºè¯ï¼‰çš„ï¼Ÿ</li><li>ä¸åŒç¼–ç¨‹è¯­è¨€ï¼ˆJava&#x2F;C++&#x2F;Pythonï¼‰åœ¨è¯„å®¡æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>ä½ ä»¬å¦‚ä½•è¯„ä¼° AI è¯„å®¡çš„å‡†ç¡®æ€§ï¼Ÿ</li></ul></li></ol><hr><h2 id="å››ã€æ€§èƒ½ä¼˜åŒ–è€ƒå¯Ÿ"><a href="#å››ã€æ€§èƒ½ä¼˜åŒ–è€ƒå¯Ÿ" class="headerlink" title="å››ã€æ€§èƒ½ä¼˜åŒ–è€ƒå¯Ÿ"></a><strong>å››ã€æ€§èƒ½ä¼˜åŒ–è€ƒå¯Ÿ</strong></h2><ol><li><strong>Redis ç›¸å…³ä¼˜åŒ–</strong><ul><li>Redis ä½œä¸ºæœåŠ¡é—´é€šä¿¡çš„æ–¹æ¡ˆï¼Œå¦‚ä½•ä¼˜åŒ–å…¶æ€§èƒ½ï¼Ÿ</li><li>å¦‚ä½•é¿å… Redis çš„çƒ­ç‚¹ Key é—®é¢˜ï¼Ÿ</li><li>Redis å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ</li><li>å¦‚ä½•å‡å°‘ Redis çš„ç½‘ç»œ I&#x2F;Oï¼Ÿ</li></ul></li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ç›¸å…³ä¼˜åŒ–</strong></li></ol><ul><li>å¦‚ä½•ä¼˜åŒ–æ¶ˆæ¯é˜Ÿåˆ—çš„ååé‡ï¼Ÿ</li><li>å¦‚ä½•å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹å»¶è¿Ÿé—®é¢˜ï¼Ÿ</li><li>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„ç¨³å®šæ€§ï¼Ÿ</li></ul><ol><li><strong>æ•°æ®åº“ä¼˜åŒ–</strong></li></ol><ul><li>ä½ çš„ç³»ç»Ÿæ˜¯å¦æœ‰ä½¿ç”¨æ•°æ®åº“ï¼Ÿä¸»è¦å­˜å‚¨ä»€ä¹ˆæ•°æ®ï¼Ÿ</li><li>ä½ ä»¬å¦‚ä½•ä¼˜åŒ–æ•°æ®åº“çš„æŸ¥è¯¢æ€§èƒ½ï¼Ÿ</li></ul><hr><h2 id="äº”ã€è¾¹ç•Œæƒ…å†µå¤„ç†è€ƒå¯Ÿ"><a href="#äº”ã€è¾¹ç•Œæƒ…å†µå¤„ç†è€ƒå¯Ÿ" class="headerlink" title="äº”ã€è¾¹ç•Œæƒ…å†µå¤„ç†è€ƒå¯Ÿ"></a><strong>äº”ã€è¾¹ç•Œæƒ…å†µå¤„ç†è€ƒå¯Ÿ</strong></h2><ol><li><strong>å¼‚å¸¸å¤„ç†</strong></li></ol><ul><li>å¦‚æœå˜æ›´å•æœåŠ¡å¤„ç† Patch å¤±è´¥äº†ï¼Œå¦‚ä½•æ¢å¤ï¼Ÿ</li><li>å¦‚æœä¸Šä¸‹æ–‡æœåŠ¡çš„æ¶ˆè´¹å¤±è´¥äº†ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ</li><li>å¦‚æœ AI è¯„å®¡æœåŠ¡è°ƒç”¨å¤§æ¨¡å‹è¶…æ—¶äº†ï¼Œå¦‚ä½•é™çº§å¤„ç†ï¼Ÿ</li></ul><ol><li><strong>å¹¶å‘ä¸ä¸€è‡´æ€§</strong></li></ol><ul><li>å¦‚æœä¸¤ä¸ªç”¨æˆ·åŒæ—¶æäº¤ä»£ç åˆ°åŒä¸€ä¸ªåˆ†æ”¯ï¼Œç³»ç»Ÿå¦‚ä½•ä¿è¯è¯„å®¡ç»“æœçš„å‡†ç¡®æ€§ï¼Ÿ</li><li>å¦‚æœä¸€ä¸ªè¯„å®¡ä»»åŠ¡è¿›è¡Œåˆ°ä¸€åŠï¼ŒæœåŠ¡å®•æœºäº†ï¼Œå¦‚ä½•ä¿è¯ä»»åŠ¡ä¸ä¸¢å¤±ï¼Ÿ</li></ul><hr><h2 id="å…­ã€å®‰å…¨æ€§è€ƒå¯Ÿ"><a href="#å…­ã€å®‰å…¨æ€§è€ƒå¯Ÿ" class="headerlink" title="å…­ã€å®‰å…¨æ€§è€ƒå¯Ÿ"></a><strong>å…­ã€å®‰å…¨æ€§è€ƒå¯Ÿ</strong></h2><ol><li><strong>æ•°æ®å®‰å…¨</strong></li></ol><ul><li>ä»£ç è¯„å®¡è¿‡ç¨‹ä¸­æ˜¯å¦æ¶‰åŠæ•æ„Ÿæ•°æ®ï¼Ÿå¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ</li><li>ä½ ä»¬å¦‚ä½•æ§åˆ¶ä¸åŒç”¨æˆ·è®¿é—®ä¸åŒä»£ç åº“çš„æƒé™ï¼Ÿ</li></ul><ol><li><strong>API å®‰å…¨</strong></li></ol><ul><li>ä½ ä»¬çš„ API å¦‚ä½•è¿›è¡Œèº«ä»½è®¤è¯å’Œæˆæƒï¼Ÿæ˜¯å¦ä½¿ç”¨äº† JWT æˆ– OAuthï¼Ÿ</li><li>ä½ ä»¬å¦‚ä½•é˜²æ­¢ API è¢«æ¶æ„è°ƒç”¨ï¼Ÿ</li></ul><hr><h2 id="ä¸ƒã€ä¸šåŠ¡åœºæ™¯è®¾è®¡"><a href="#ä¸ƒã€ä¸šåŠ¡åœºæ™¯è®¾è®¡" class="headerlink" title="ä¸ƒã€ä¸šåŠ¡åœºæ™¯è®¾è®¡"></a><strong>ä¸ƒã€ä¸šåŠ¡åœºæ™¯è®¾è®¡</strong></h2><ol><li><strong>ç³»ç»Ÿå¯æ‰©å±•æ€§</strong></li></ol><ul><li>å¦‚æœæœªæ¥ä»£ç åº“æ•°é‡ä» 6 ä¸ªæ‰©å±•åˆ° 60 ä¸ªï¼Œç³»ç»Ÿæ˜¯å¦èƒ½æ‰¿å—ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</li><li>å¦‚ä½•æ”¯æŒæ›´å¤šç¼–ç¨‹è¯­è¨€ï¼Ÿ</li></ul><ol><li><strong>æ•…éšœæ¼”ç»ƒ</strong></li></ol><ul><li>å‡è®¾ Redis çªç„¶å´©æºƒï¼Œä½ ä»¬çš„æœåŠ¡è¿˜èƒ½æ­£å¸¸è¿è¡Œå—ï¼Ÿ</li><li>å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹ç«¯å´©æºƒï¼Œå¦‚ä½•ä¿è¯ç§¯å‹çš„ä»»åŠ¡ä¸ä¼šä¸¢å¤±ï¼Ÿ</li></ul><hr><p>è¿™ä¸ªé—®é¢˜é›†æ¶µç›–äº†<strong>æŠ€æœ¯é€‰å‹ã€æ¶æ„è®¾è®¡ã€å®ç°ç»†èŠ‚ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨æ€§ã€ä¸šåŠ¡å¯æ‰©å±•æ€§</strong>ç­‰å¤šä¸ªç»´åº¦ï¼ŒåŸºæœ¬ç¬¦åˆäº’è”ç½‘å¤§å‚çš„é¢è¯•æ ‡å‡†ã€‚ä½ å¯ä»¥å…ˆå°è¯•å›ç­”è¿™äº›é—®é¢˜ï¼Œå¦‚æœæœ‰ä»»ä½•éš¾ç‚¹æˆ–éœ€è¦è¡¥å……çš„åœ°æ–¹ï¼Œæˆ‘å¯ä»¥å¸®ä½ å®Œå–„ä½ çš„æ€è·¯å’Œå›ç­”ï¼ ğŸš€</p></blockquote><p>æˆ‘ä»¬è¿™è¾¹æ”¶åˆ°äº†æäº¤ä»£ç çš„è¯·æ±‚ï¼Œå¦‚æœè¿™ä¸ªä»£ç åº“æ˜¯æœ€æ–°åŠ å…¥çš„ä»£ç åº“çš„è¯ï¼Œåˆ™éœ€è¦å…ˆå¯¹è¿™ä¸ªä»£ç åº“è¿›è¡Œæ„å»ºçŸ¥è¯†å›¾è°±ã€‚æˆ‘ä»¬éœ€è¦è·å–åˆ°è¿™ä¸ªä»£ç åº“ä¸­çš„ç›¸å…³ç±»ã€æ–¹æ³•å’Œè°ƒç”¨å…³ç³»ï¼Œæ¯”å¦‚åˆ©ç”¨ASTè§£æå·¥å…·æˆ–è€…JavaParaserå·¥å…·ã€‚</p><blockquote><p>JavaParser æ˜¯ä¸€ä¸ªå¼€æºçš„ Java æºä»£ç è§£æå™¨å’Œæ“ä½œåº“ï¼Œå®ƒèƒ½å¤Ÿè§£æ Java æºä»£ç å¹¶æ„å»ºå¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚JavaParser æä¾›äº†ä¸€ç»„ APIï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾åœ°åˆ†æã€ä¿®æ”¹å’Œç”Ÿæˆ Java æºä»£ç ã€‚æ®æ­¤ï¼Œä½ å¯ä»¥é€šè¿‡è¿™äº›APIæ¥å®ç°JavaåŠ¨æ€ç¼–è¯‘ï¼ŒåŸç”Ÿçš„javaåº“æœ‰javax.tools,ä½†å¯æƒœä¸èƒ½æ”¯æŒå¯¹äºASTçš„ä¿®æ”¹</p></blockquote><p>è¿˜æœ‰æ¯”å¦‚ç›¸åº”çš„Git logã€æµ‹è¯•ä»£ç ï¼ˆå¯èƒ½éœ€è¦æ‰‹åŠ¨æä¾›ï¼ŒåŠŸèƒ½å…·ä½“æœªå®ç°ï¼‰ä»¥åŠä¸€äº›å…·ä½“éƒ¨é—¨ä¸­çš„ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ã€‚ç„¶åä½¿ç”¨Neo4jæ¥å­˜å‚¨çŸ¥è¯†å›¾è°±ã€‚</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[UserController] ----calls----&gt; [UserService]</span><br><span class="line">[UserService] ----calls----&gt; [UserRepository]</span><br><span class="line">[UserRepository] ----uses----&gt; [Database]</span><br><span class="line">[UserService] ----tested<span class="built_in">_</span>by----&gt; [UserServiceTest]</span><br><span class="line">[Commit<span class="built_in">_</span>123] ----modified----&gt; [UserController]</span><br><span class="line">[Commit<span class="built_in">_</span>123] ----reviewed<span class="built_in">_</span>in----&gt; [PR<span class="built_in">_</span>45]</span><br><span class="line">[PR<span class="built_in">_</span>45] ----has<span class="built_in">_</span>feedback----&gt; &quot;Optimize saveUser() method&quot;</span><br><span class="line">[SecurityConfig] ----uses----&gt; [SpringSecurity]</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ä½ çš„é—®é¢˜éå¸¸ä¸“ä¸šï¼Œæ¶‰åŠ <strong>å¤§æ¨¡å‹å¦‚ä½•åˆ©ç”¨çŸ¥è¯†å›¾è°±</strong> ä»¥åŠ <strong>ä»£ç åº“çŸ¥è¯†å›¾è°±çš„ç»´æŠ¤ä¸ä¼˜åŒ–</strong>ï¼Œæˆ‘ä¼šç»“åˆå®é™…åœºæ™¯è¿›è¡Œè¯¦ç»†è§£ç­”ã€‚</p><hr><h2 id="é—®é¢˜-1ï¼šå¦‚ä½•è®©å¤§æ¨¡å‹ç›´æ¥ä½¿ç”¨çŸ¥è¯†å›¾è°±ï¼Œä»è€Œå‡å°‘-prompt-çš„è¾“å…¥ï¼Ÿ"><a href="#é—®é¢˜-1ï¼šå¦‚ä½•è®©å¤§æ¨¡å‹ç›´æ¥ä½¿ç”¨çŸ¥è¯†å›¾è°±ï¼Œä»è€Œå‡å°‘-prompt-çš„è¾“å…¥ï¼Ÿ" class="headerlink" title="é—®é¢˜ 1ï¼šå¦‚ä½•è®©å¤§æ¨¡å‹ç›´æ¥ä½¿ç”¨çŸ¥è¯†å›¾è°±ï¼Œä»è€Œå‡å°‘ prompt çš„è¾“å…¥ï¼Ÿ"></a><strong>é—®é¢˜ 1ï¼šå¦‚ä½•è®©å¤§æ¨¡å‹ç›´æ¥ä½¿ç”¨çŸ¥è¯†å›¾è°±ï¼Œä»è€Œå‡å°‘ prompt çš„è¾“å…¥ï¼Ÿ</strong></h2><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a><strong>ç›®æ ‡</strong></h3><ul><li>è®©å¤§æ¨¡å‹è‡ªåŠ¨æ£€ç´¢çŸ¥è¯†å›¾è°±ä¸­çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ä¾èµ–ç”¨æˆ·æä¾›å®Œæ•´çš„ promptã€‚</li><li>è®©å¤§æ¨¡å‹åŸºäºçŸ¥è¯†å›¾è°±å›ç­”é—®é¢˜ï¼Œè€Œä¸æ˜¯çº¯ç²¹ä¾èµ–å‚æ•°å†…éƒ¨çš„çŸ¥è¯†ã€‚</li></ul><h3 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a><strong>å®ç°æ–¹æ¡ˆ</strong></h3><p>å¯ä»¥ä½¿ç”¨ <strong>RAGï¼ˆRetrieval-Augmented Generationï¼‰</strong> æ–¹æ³•ï¼Œå°†çŸ¥è¯†å›¾è°±ä½œä¸ºå¤–éƒ¨çŸ¥è¯†åº“ï¼Œå¹¶åœ¨å¤§æ¨¡å‹å›ç­”å‰è‡ªåŠ¨æŸ¥è¯¢ç›¸å…³çŸ¥è¯†ã€‚å…¶æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p><strong>æ„å»ºçŸ¥è¯†å›¾è°±</strong></p><ul><li><p>çŸ¥è¯†å›¾è°±ä»¥ <strong>å›¾æ•°æ®åº“</strong>ï¼ˆå¦‚ Neo4jï¼‰æˆ– <strong>RDF å­˜å‚¨</strong>ï¼ˆå¦‚ GraphDBï¼‰å­˜å‚¨ã€‚</p></li><li><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦å­˜å‚¨æŸä¸ªä¼ä¸šçš„äº§å“å…³ç³»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(äº§å“A) -[å…¼å®¹]-&gt; (äº§å“B)</span><br><span class="line">(äº§å“A) -[é€‚ç”¨äº]-&gt; (åœºæ™¯1)</span><br><span class="line">(äº§å“B) -[é€‚ç”¨äº]-&gt; (åœºæ™¯2)</span><br></pre></td></tr></table></figure></li><li><p>è¿™äº›ä¿¡æ¯å¯ä»¥é€šè¿‡ <strong>çŸ¥è¯†æŠ½å–</strong>ï¼ˆä»æ–‡æœ¬ã€API æˆ–è¡¨æ ¼ä¸­æå–ï¼‰æˆ– <strong>æ‰‹åŠ¨å»ºæ¨¡</strong> æ„å»ºã€‚</p></li></ul></li><li><p><strong>å¤§æ¨¡å‹æŸ¥è¯¢çŸ¥è¯†å›¾è°±</strong></p><ul><li><p>åœ¨å¤„ç†ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œé¦–å…ˆè½¬æ¢æˆ <strong>æŸ¥è¯¢è¯­å¥</strong>ï¼ˆå¦‚ Cypher æˆ– SPARQLï¼‰ã€‚</p></li><li><p>ä¾‹å¦‚ï¼Œç”¨æˆ·é—®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â€œäº§å“Aæ˜¯å¦å¯ä»¥åœ¨åœºæ™¯2ä¸­ä½¿ç”¨ï¼Ÿâ€</span><br></pre></td></tr></table></figure></li><li><p>è¿™æ¡è‡ªç„¶è¯­è¨€å¯ä»¥è½¬æ¢æˆ Cypher æŸ¥è¯¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Product &#123;name:&quot;äº§å“A&quot;&#125;)-[:å…¼å®¹]-&gt;(p2:Product)-[:é€‚ç”¨äº]-&gt;(s:Scene &#123;name:&quot;åœºæ™¯2&quot;&#125;)</span><br><span class="line">RETURN p2.name</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡æŸ¥è¯¢çŸ¥è¯†å›¾è°±ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ° </p><p>äº§å“B é€‚ç”¨äº åœºæ™¯2ï¼Œè€Œäº§å“A å…¼å®¹ äº§å“B</p><p>ï¼Œæ‰€ä»¥å¤§æ¨¡å‹å¯ä»¥å¾—å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â€œæ˜¯çš„ï¼Œäº§å“Aå¯ä»¥é—´æ¥åœ¨åœºæ™¯2ä¸­ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå…¼å®¹äº§å“Bï¼Œè€Œäº§å“Bé€‚ç”¨äºåœºæ™¯2ã€‚â€</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä¼˜åŒ– Prompt</strong></p><ul><li><p>ç”¨æˆ·ä¸éœ€è¦è¾“å…¥å®Œæ•´èƒŒæ™¯ä¿¡æ¯ï¼Œå¤§æ¨¡å‹å¯ä»¥è‡ªåŠ¨è¡¥å……çŸ¥è¯†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·ï¼šäº§å“Aèƒ½ç”¨å—ï¼Ÿ</span><br><span class="line">å¤§æ¨¡å‹ï¼ˆè‡ªåŠ¨æŸ¥è¯¢çŸ¥è¯†å›¾è°±åå›ç­”ï¼‰ï¼šå¯ä»¥ï¼Œäº§å“Aé€‚ç”¨äºåœºæ™¯Xã€‚</span><br></pre></td></tr></table></figure></li><li><p>è¿™æ ·ç”¨æˆ·çš„ prompt å˜å¾—æ›´ç®€æ´ï¼ŒåŒæ—¶æé«˜äº†å›ç­”å‡†ç¡®æ€§ã€‚</p></li></ul></li></ol><hr><h2 id="é—®é¢˜-2ï¼šä»£ç åº“çŸ¥è¯†å›¾è°±ä¸­æ–¹æ³•è°ƒç”¨å…³ç³»å˜åŒ–åå¦‚ä½•æ›´æ–°ï¼Ÿ"><a href="#é—®é¢˜-2ï¼šä»£ç åº“çŸ¥è¯†å›¾è°±ä¸­æ–¹æ³•è°ƒç”¨å…³ç³»å˜åŒ–åå¦‚ä½•æ›´æ–°ï¼Ÿ" class="headerlink" title="é—®é¢˜ 2ï¼šä»£ç åº“çŸ¥è¯†å›¾è°±ä¸­æ–¹æ³•è°ƒç”¨å…³ç³»å˜åŒ–åå¦‚ä½•æ›´æ–°ï¼Ÿ"></a><strong>é—®é¢˜ 2ï¼šä»£ç åº“çŸ¥è¯†å›¾è°±ä¸­æ–¹æ³•è°ƒç”¨å…³ç³»å˜åŒ–åå¦‚ä½•æ›´æ–°ï¼Ÿ</strong></h2><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a><strong>åœºæ™¯</strong></h3><p>å‡è®¾çŸ¥è¯†å›¾è°±å­˜å‚¨äº†æ–¹æ³•è°ƒç”¨å…³ç³»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(ç±»A.æ–¹æ³•1) -[è°ƒç”¨]-&gt; (ç±»B.æ–¹æ³•2)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä»£ç ï¼ŒæŠŠ <code>ç±»B.æ–¹æ³•2</code> æ”¹æˆ <code>ç±»C.æ–¹æ³•3</code>ï¼Œåˆ™çŸ¥è¯†å›¾è°±åº”æ›´æ–°ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(ç±»A.æ–¹æ³•1) -[è°ƒç”¨]-&gt; (ç±»C.æ–¹æ³•3)</span><br></pre></td></tr></table></figure><h3 id="æ›´æ–°ç­–ç•¥"><a href="#æ›´æ–°ç­–ç•¥" class="headerlink" title="æ›´æ–°ç­–ç•¥"></a><strong>æ›´æ–°ç­–ç•¥</strong></h3><ol><li><p><strong>å¢é‡æ›´æ–°</strong></p><ul><li><strong>å¯¹æ¯”æäº¤å‰åçš„ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</strong></li><li>ä»…åˆ†æ <strong>å—å½±å“çš„æ–‡ä»¶</strong>ï¼Œé¿å…å…¨é‡è§£æï¼Œæé«˜æ•ˆç‡ã€‚</li></ul></li><li><p><strong>è‡ªåŠ¨æ£€æµ‹å˜æ›´</strong></p><ul><li><p>ç›‘å¬ä»£ç å˜æ›´ï¼ˆGit Hook æˆ– CI&#x2F;CD è§¦å‘ï¼‰ã€‚</p></li><li><p>è§£ææ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„ä»£ç ï¼š</p><ul><li><strong>æ–°å¢æ–¹æ³•</strong> â†’ æ·»åŠ æ–°èŠ‚ç‚¹</li><li><strong>åˆ é™¤æ–¹æ³•</strong> â†’ åˆ é™¤æ—§èŠ‚ç‚¹</li><li><strong>ä¿®æ”¹è°ƒç”¨å…³ç³»</strong> â†’ æ›´æ–°è¾¹çš„è¿æ¥</li></ul></li><li><p>å…·ä½“æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (methodCallChanged) &#123;</span><br><span class="line">    graphDB.run(<span class="string">&quot;MATCH (a:Method &#123;name: &#x27;ç±»A.æ–¹æ³•1&#x27;&#125;)-[r:CALLS]-&gt;(b:Method) DELETE r&quot;</span>);</span><br><span class="line">    graphDB.run(<span class="string">&quot;MATCH (a:Method &#123;name: &#x27;ç±»A.æ–¹æ³•1&#x27;&#125;), (c:Method &#123;name: &#x27;ç±»C.æ–¹æ³•3&#x27;&#125;) CREATE (a)-[:CALLS]-&gt;(c)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>çŸ¥è¯†å›¾è°±æ”¯æŒç‰ˆæœ¬ç®¡ç†</strong></p><ul><li><p>è®°å½•æ¯æ¬¡å˜æ›´å‰åçš„çŠ¶æ€ï¼Œæ”¯æŒä»£ç ç‰ˆæœ¬å›æº¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(ç±»A.æ–¹æ³•1) -[è°ƒç”¨ v1]-&gt; (ç±»B.æ–¹æ³•2)</span><br><span class="line">(ç±»A.æ–¹æ³•1) -[è°ƒç”¨ v2]-&gt; (ç±»C.æ–¹æ³•3)</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h2 id="é—®é¢˜-3ï¼šæ˜¯å¦æ¯æ¬¡æäº¤éƒ½éœ€è¦æ›´æ–°çŸ¥è¯†å›¾è°±ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ"><a href="#é—®é¢˜-3ï¼šæ˜¯å¦æ¯æ¬¡æäº¤éƒ½éœ€è¦æ›´æ–°çŸ¥è¯†å›¾è°±ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="é—®é¢˜ 3ï¼šæ˜¯å¦æ¯æ¬¡æäº¤éƒ½éœ€è¦æ›´æ–°çŸ¥è¯†å›¾è°±ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ"></a><strong>é—®é¢˜ 3ï¼šæ˜¯å¦æ¯æ¬¡æäº¤éƒ½éœ€è¦æ›´æ–°çŸ¥è¯†å›¾è°±ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</strong></h2><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a><strong>é—®é¢˜åˆ†æ</strong></h3><ul><li><p>å¦‚æœæ¯æ¬¡æäº¤éƒ½æ›´æ–°</p><p>ï¼Œå¯èƒ½å¯¼è‡´ï¼š</p><ul><li>è§£æ <strong>æ•´ä¸ªä»£ç åº“</strong>ï¼Œéå¸¸è€—æ—¶ï¼ˆå¦‚ JavaParser è§£æå¤§å‹ä»£ç åº“ä¼šæ…¢ï¼‰ã€‚</li><li>è®¸å¤šå˜æ›´ <strong>ä¸å½±å“è°ƒç”¨å…³ç³»</strong>ï¼Œä½†ä»ç„¶è¢«åˆ†æï¼Œå¢åŠ ä¸å¿…è¦çš„å¼€é”€ã€‚</li></ul></li></ul><h3 id="ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong></h3><ol><li><p><strong>æŒ‰éœ€æ›´æ–°</strong></p><ul><li><p>ä»…æ›´æ–°å—å½±å“çš„æ–‡ä»¶</p><p>ï¼Œé¿å…å…¨é‡è§£æï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --name-only HEAD~1 HEAD</span><br></pre></td></tr></table></figure></li><li><p>è·å–æœ¬æ¬¡æäº¤ä¿®æ”¹çš„ Java æ–‡ä»¶ï¼Œå†ç”¨ JavaParser è§£æè¿™äº›æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ•´ä¸ªä»£ç åº“ã€‚</p></li></ul></li><li><p><strong>å¢é‡ AST è§£æ</strong></p><ul><li><p>è§£ææ–°æ—§ä»£ç ï¼Œ</p><p>ä»…è®¡ç®—æ–¹æ³•è°ƒç”¨å·®å¼‚</p><p>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CompilationUnit</span> <span class="variable">oldAST</span> <span class="operator">=</span> StaticJavaParser.parse(oldCode);</span><br><span class="line"><span class="type">CompilationUnit</span> <span class="variable">newAST</span> <span class="operator">=</span> StaticJavaParser.parse(newCode);</span><br><span class="line">compareAndUpdateGraph(oldAST, newAST);</span><br></pre></td></tr></table></figure></li><li><p>è¿™æ ·å¯ä»¥ <strong>é¿å…é‡å¤è§£ææ— å˜åŒ–çš„ä»£ç </strong>ã€‚</p></li></ul></li><li><p><strong>æ‰¹é‡æ›´æ–°</strong></p><ul><li>ä¸æ¯æ¬¡æäº¤éƒ½è§¦å‘ï¼Œè€Œæ˜¯ <strong>å®šæœŸæ‰¹é‡æ›´æ–°</strong>ï¼ˆå¦‚æ¯æ—¥å‡Œæ™¨ 1 ç‚¹ï¼‰ã€‚</li><li>ä½¿ç”¨ <strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼ˆå¦‚ Kafkaï¼‰ï¼Œæ¨é€å˜æ›´è®°å½•ï¼Œåå°å¼‚æ­¥è§£ææ›´æ–°ã€‚</li></ul></li></ol><hr><h2 id="é—®é¢˜-4ï¼šä¸åŒé¡¹ç›®æ˜¯å¦éœ€è¦å•ç‹¬çš„çŸ¥è¯†å›¾è°±ï¼Ÿå¦‚ä½•ç®¡ç†å¤šä¸ªçŸ¥è¯†å›¾è°±ï¼Ÿ"><a href="#é—®é¢˜-4ï¼šä¸åŒé¡¹ç›®æ˜¯å¦éœ€è¦å•ç‹¬çš„çŸ¥è¯†å›¾è°±ï¼Ÿå¦‚ä½•ç®¡ç†å¤šä¸ªçŸ¥è¯†å›¾è°±ï¼Ÿ" class="headerlink" title="é—®é¢˜ 4ï¼šä¸åŒé¡¹ç›®æ˜¯å¦éœ€è¦å•ç‹¬çš„çŸ¥è¯†å›¾è°±ï¼Ÿå¦‚ä½•ç®¡ç†å¤šä¸ªçŸ¥è¯†å›¾è°±ï¼Ÿ"></a><strong>é—®é¢˜ 4ï¼šä¸åŒé¡¹ç›®æ˜¯å¦éœ€è¦å•ç‹¬çš„çŸ¥è¯†å›¾è°±ï¼Ÿå¦‚ä½•ç®¡ç†å¤šä¸ªçŸ¥è¯†å›¾è°±ï¼Ÿ</strong></h2><h3 id="åœºæ™¯-1"><a href="#åœºæ™¯-1" class="headerlink" title="åœºæ™¯"></a><strong>åœºæ™¯</strong></h3><ul><li><strong>ä¸åŒé¡¹ç›®çš„ä»£ç åº“</strong>ï¼Œæ˜¯å¦åº”è¯¥åˆ†åˆ«æ„å»ºçŸ¥è¯†å›¾è°±ï¼Ÿ</li><li><strong>åŒä¸€éƒ¨é—¨çš„å¤šä¸ªé¡¹ç›®</strong>ï¼Œèƒ½å¦å…±ç”¨ä¸€ä¸ªçŸ¥è¯†å›¾è°±ï¼Ÿ</li></ul><h3 id="ä¸¤ç§é€‰æ‹©"><a href="#ä¸¤ç§é€‰æ‹©" class="headerlink" title="ä¸¤ç§é€‰æ‹©"></a><strong>ä¸¤ç§é€‰æ‹©</strong></h3><h4 id="æ–¹æ¡ˆ-1ï¼šæ¯ä¸ªä»£ç åº“ä¸€ä¸ªç‹¬ç«‹çŸ¥è¯†å›¾è°±"><a href="#æ–¹æ¡ˆ-1ï¼šæ¯ä¸ªä»£ç åº“ä¸€ä¸ªç‹¬ç«‹çŸ¥è¯†å›¾è°±" class="headerlink" title="æ–¹æ¡ˆ 1ï¼šæ¯ä¸ªä»£ç åº“ä¸€ä¸ªç‹¬ç«‹çŸ¥è¯†å›¾è°±"></a><strong>æ–¹æ¡ˆ 1ï¼šæ¯ä¸ªä»£ç åº“ä¸€ä¸ªç‹¬ç«‹çŸ¥è¯†å›¾è°±</strong></h4><ul><li>ä¼˜ç‚¹ï¼š<ul><li><strong>éš”ç¦»æ€§å¼º</strong>ï¼Œä¸ä¼šæ··æ·†ä¸åŒé¡¹ç›®çš„è°ƒç”¨å…³ç³»ã€‚</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li><strong>ç®¡ç†å¤æ‚</strong>ï¼Œå¤§æ¨¡å‹æŸ¥è¯¢æ—¶éœ€è¦çŸ¥é“ç”¨å“ªä¸ªå›¾è°±ã€‚</li></ul></li></ul><h4 id="æ–¹æ¡ˆ-2ï¼šå¤šä¸ªé¡¹ç›®å…±äº«ä¸€ä¸ªçŸ¥è¯†å›¾è°±"><a href="#æ–¹æ¡ˆ-2ï¼šå¤šä¸ªé¡¹ç›®å…±äº«ä¸€ä¸ªçŸ¥è¯†å›¾è°±" class="headerlink" title="æ–¹æ¡ˆ 2ï¼šå¤šä¸ªé¡¹ç›®å…±äº«ä¸€ä¸ªçŸ¥è¯†å›¾è°±"></a><strong>æ–¹æ¡ˆ 2ï¼šå¤šä¸ªé¡¹ç›®å…±äº«ä¸€ä¸ªçŸ¥è¯†å›¾è°±</strong></h4><ul><li><p>ä½¿ç”¨å‘½åç©ºé—´</p><p>ï¼Œå¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(ProjectA:ç±»A.æ–¹æ³•1) -[è°ƒç”¨]-&gt; (ProjectA:ç±»B.æ–¹æ³•2)</span><br><span class="line">(ProjectB:ç±»X.æ–¹æ³•Y) -[è°ƒç”¨]-&gt; (ProjectB:ç±»Z.æ–¹æ³•W)</span><br></pre></td></tr></table></figure></li><li><p>å¤§æ¨¡å‹æŸ¥è¯¢æ—¶æŒ‡å®šé¡¹ç›®</p><p>ï¼Œå¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (m:Method) WHERE m.project = &#x27;ProjectA&#x27; RETURN m</span><br></pre></td></tr></table></figure></li><li><p>ä¼˜ç‚¹</p><p>ï¼š</p><ul><li><strong>æŸ¥è¯¢æ—¶è‡ªåŠ¨ç­›é€‰</strong>ï¼Œæ— éœ€æ‰‹åŠ¨é€‰æ‹©çŸ¥è¯†å›¾è°±ã€‚</li><li><strong>å‡å°‘é‡å¤æ•°æ®</strong>ï¼ˆè‹¥å¤šä¸ªé¡¹ç›®å…±ç”¨åŒä¸€æ–¹æ³•ï¼Œå¯ä»¥å…±äº«èŠ‚ç‚¹ï¼‰ã€‚</li></ul></li><li><p>ç¼ºç‚¹</p><p>ï¼š</p><ul><li>éœ€è¦å¯¹å¤§æ¨¡å‹åš <strong>ä¸Šä¸‹æ–‡å¢å¼º</strong>ï¼Œä»¥ä¾¿å®ƒçŸ¥é“æŸ¥è¯¢å“ªä¸ªé¡¹ç›®çš„çŸ¥è¯†å›¾è°±ã€‚</li></ul></li></ul><hr><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2><ol><li><strong>è®©å¤§æ¨¡å‹ä½¿ç”¨çŸ¥è¯†å›¾è°±</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>RAG</strong> æŠ€æœ¯ï¼Œå¤§æ¨¡å‹åœ¨å›ç­”å‰è‡ªåŠ¨æŸ¥è¯¢çŸ¥è¯†å›¾è°±ï¼Œå‡å°‘ç”¨æˆ· prompt å¤æ‚åº¦ã€‚</li></ul></li><li><strong>ä»£ç åº“çŸ¥è¯†å›¾è°±å˜æ›´åå¦‚ä½•æ›´æ–°</strong>ï¼š<ul><li>ç›‘å¬ä»£ç æäº¤ï¼Œ<strong>å¢é‡æ›´æ–° AST</strong>ï¼Œåªä¿®æ”¹å—å½±å“çš„è°ƒç”¨å…³ç³»ã€‚</li></ul></li><li><strong>ä¼˜åŒ–æ›´æ–°æ•ˆç‡</strong>ï¼š<ul><li>ä»…è§£æå˜æ›´çš„æ–‡ä»¶ï¼Œä½¿ç”¨ <strong>å¢é‡ AST</strong> è§£æï¼Œé¿å…å…¨é‡é‡å»ºçŸ¥è¯†å›¾è°±ã€‚</li></ul></li><li><strong>å¤šä¸ªä»£ç åº“çš„çŸ¥è¯†å›¾è°±ç®¡ç†</strong>ï¼š<ul><li>å¯ä»¥ <strong>æ¯ä¸ªä»£ç åº“å•ç‹¬ç»´æŠ¤</strong>ï¼Œä¹Ÿå¯ä»¥ <strong>ç»Ÿä¸€ç®¡ç†ï¼ŒæŒ‰é¡¹ç›®åˆ†éš”</strong>ï¼ŒæŸ¥è¯¢æ—¶è‡ªåŠ¨ç­›é€‰ã€‚</li></ul></li></ol><p>è¿™å¥—æ–¹æ¡ˆèƒ½åœ¨ <strong>ä¿è¯é«˜æ•ˆæ›´æ–°</strong> çš„åŒæ—¶ <strong>å‡å°‘å¤§æ¨¡å‹çš„ prompt ä¾èµ–</strong>ï¼Œå¹¶ä¸”é€‚ç”¨äº <strong>å¤§è§„æ¨¡ä»£ç åº“çš„åˆ†æä¸ç»´æŠ¤</strong>ã€‚</p></blockquote><h3 id="ä»£ç è¯„å®¡å®ä¹ é¡¹ç›®æ¶‰åŠåˆ°çš„éš¾ç‚¹"><a href="#ä»£ç è¯„å®¡å®ä¹ é¡¹ç›®æ¶‰åŠåˆ°çš„éš¾ç‚¹" class="headerlink" title="ä»£ç è¯„å®¡å®ä¹ é¡¹ç›®æ¶‰åŠåˆ°çš„éš¾ç‚¹"></a>ä»£ç è¯„å®¡å®ä¹ é¡¹ç›®æ¶‰åŠåˆ°çš„éš¾ç‚¹</h3><p>é¡¹ç›®èƒŒæ™¯ï¼šç°åœ¨ä½ åœ¨ä¸€å®¶å…¬å¸å¼€å‘äº†ä¸€ä¸ªä»£ç è¯„å®¡ç›¸å…³çš„ç³»ç»Ÿï¼Œä½ è·å–åˆ°ç”¨æˆ·çš„å˜æ›´ä»£ç åï¼Œä½ éœ€è¦è·å–åˆ°è¿™ä¸ªå˜æ›´ä»£ç çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åä¸promptä¸€èµ·åŒ…è£…å‘ç»™å¤§æ¨¡å‹è¿›è¡Œè¯„å®¡ã€‚</p><p>è¿™é‡Œå…¶ä¸­æ¶‰åŠåˆ°çš„éš¾ç‚¹æœ‰ï¼š</p><ol><li>ä»£ç ä¸Šä¸‹æ–‡æå–ï¼›</li><li>Promptä¼˜åŒ–ï¼›</li><li>å¤§æ¨¡å‹è¾“å…¥é•¿åº¦æ§åˆ¶ï¼›</li></ol><h3 id="ä»£ç å®¡æŸ¥å“ªäº›æ–¹é¢çš„å†…å®¹"><a href="#ä»£ç å®¡æŸ¥å“ªäº›æ–¹é¢çš„å†…å®¹" class="headerlink" title="ä»£ç å®¡æŸ¥å“ªäº›æ–¹é¢çš„å†…å®¹"></a>ä»£ç å®¡æŸ¥å“ªäº›æ–¹é¢çš„å†…å®¹</h3><p>é¦–å…ˆçš„ç¬¬ä¸€ç‚¹æ˜¯ä½ çš„promptä»£ç å®¡æŸ¥ä¸»è¦æ˜¯è¯„å®¡å“ªäº›æ–¹é¢çš„é—®é¢˜ï¼š</p><ol><li>é¦–å…ˆå°±æ˜¯ä»£ç ä¸­çš„ä¸€äº›å¸¸è§é—®é¢˜ï¼Œä¾‹å¦‚<strong>å®‰å…¨æ–¹é¢</strong>çš„é—®é¢˜ï¼Œæ¯”å¦‚æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥çš„é£é™©ï¼Œxssæ”»å‡»ï¼Œæœªå¤„ç†çš„å¼‚å¸¸ç­‰æƒ…å†µï¼›</li><li>å…¶æ¬¡å°±æ˜¯æ˜¯å¦å­˜åœ¨<strong>é€»è¾‘æ€§é”™è¯¯</strong>ï¼Œæ¯”å¦‚æ˜¯å¦å­˜åœ¨æ½œåœ¨çš„é€»è¾‘é”™è¯¯æˆ–è€…è¾¹ç•Œæƒ…å†µæœªè€ƒè™‘åˆ°ï¼›</li><li><strong>é£æ ¼ä¸€è‡´æ€§æ£€æŸ¥</strong>ï¼Œæ˜¯å¦ç¬¦åˆé¡¹ç›®çš„ä»£ç è§„èŒƒï¼Œæ¯”å¦‚ä¸€äº›å‘½åæ–¹å¼ç­‰ï¼›</li><li>è¿˜æœ‰å°±æ˜¯<strong>ä»£ç è´¨é‡</strong>ï¼Œä»£ç æ˜¯å¦ç¬¦åˆæœ€ä½³å®è·µï¼Ÿæ˜¯å¦å­˜åœ¨å†—ä½™ç­‰æƒ…å†µï¼›</li></ol><h3 id="Promptä¼˜åŒ–"><a href="#Promptä¼˜åŒ–" class="headerlink" title="Promptä¼˜åŒ–"></a>Promptä¼˜åŒ–</h3><p>é¢è¯•å®˜è¯¢é—®ï¼šä½ æ˜¯å¦‚ä½•è¿›è¡Œpromptä¼˜åŒ–çš„ã€‚å…³äºPromptä¼˜åŒ–ç´§æ‰£ä¸‹é¢å‡ ä¸ªæŠ€æœ¯ç‚¹ï¼Œåˆ†åˆ«ä¸ºPrompt æç¤ºå·¥ç¨‹ã€few shotç¤ºä¾‹å¼•å¯¼ä»¥åŠCoTä¸‰å¤§æŠ€æœ¯ç‚¹è¿›è¡ŒPromptä¼˜åŒ–ã€‚</p><p>Prompt æç¤ºå·¥ç¨‹ï¼šæ¯”å¦‚è®¾å®šè§’è‰²ï¼Œæ˜ç¡®ä»»åŠ¡ï¼Œè¯¦ç»†çš„å‘ŠçŸ¥å¤§æ¨¡å‹åšä»€ä¹ˆï¼Œä»è€Œå‡å°‘å¹»è§‰ã€‚åŒæ—¶æä¾›ç›¸å…³å˜æ›´ä»£ç çš„å¿…è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè®©å¤§æ¨¡å‹æ•è·æ›´å¤šçš„èƒŒæ™¯ä¿¡æ¯ã€‚</p><p>æ·»åŠ Few-shotç¤ºä¾‹ï¼šåœ¨Promptä¸­æ·»åŠ éƒ¨åˆ†å…·æœ‰ä»£è¡¨æ€§çš„æ¡ˆä¾‹ï¼Œè®©å¤§æ¨¡å‹å­¦ä¹ æ¨¡å¼ï¼Œä»è€Œæé«˜è¯„å®¡æ•ˆç‡ã€‚</p><p>ä»»åŠ¡æ‹†è§£ï¼ˆCoTï¼‰ï¼šå¦‚æœç›´æ¥è®©LLMè¿›è¡Œè¯„å®¡ï¼Œå¯èƒ½å¯¼è‡´è·³æ­¥ï¼Œå¯¼è‡´ç»“æœå¹¶ä¸å‡†ç¡®ï¼ŒCoTå¯ä»¥å°†ä»»åŠ¡åˆ†æˆå¤šä¸ªå°ä»»åŠ¡ï¼Œä»è€Œå¼•å¯¼å¤§æ¨¡å‹è¿›è¡Œåˆ†æå›ç­”ã€‚</p><h3 id="ä»£ç ä¸Šä¸‹æ–‡è·å–"><a href="#ä»£ç ä¸Šä¸‹æ–‡è·å–" class="headerlink" title="ä»£ç ä¸Šä¸‹æ–‡è·å–"></a>ä»£ç ä¸Šä¸‹æ–‡è·å–</h3><p>é¢è¯•å¯èƒ½é’ˆå¯¹ä»£ç ä¸Šä¸‹æ–‡è·å–æ¥è¿›è¡Œè¯¢é—®ï¼Œæ¯”å¦‚åœ¨ä½ è¿™ä¸ªé¡¹ç›®ä¸­æ˜¯å¦‚ä½•è·å–åˆ°å½“å‰å˜æ›´ä»£ç çš„ä¸Šä¸‹æ–‡ä¿¡æ¯çš„å‘¢ï¼Ÿ</p><h3 id="RAG"><a href="#RAG" class="headerlink" title="RAG"></a>RAG</h3><p>RAGæ˜¯ä¸€ä¸ªæ£€ç´¢ã€å¢å¼ºå’Œç”Ÿæˆçš„AIæ¡†æ¶ï¼Œå®ƒå¯ä»¥ä¸ºå¤§æ¨¡å‹æä¾›æ›´å¤šçš„å¤–éƒ¨ä¿¡æ¯ï¼Œé€šè¿‡RAGæ£€ç´¢è·å–åˆ°æ›´å¤šçš„ä¿¡æ¯ä¹‹åæ‹¼æ¥åˆ°promteåäº¤ç»™å¤§æ¨¡å‹è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå¤§æ¨¡å‹è·å–åˆ°çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä¼šæ›´å¤šã€‚</p><p>RAGçš„â€œæ£€ç´¢ã€å¢å¼ºã€ç”Ÿæˆâ€ï¼Œè°å¢å¼ºäº†è°ï¼Œè°ç”Ÿæˆäº†ç­”æ¡ˆï¼Œä¸»è¯­å¾ˆé‡è¦ã€‚æ˜¯ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢åˆ°çš„é—®ç­”å¯¹ï¼Œå¢å¼ºäº†LLMçš„æç¤ºè¯ï¼ˆpromptï¼‰ï¼ŒLLMæ‹¿ç€å¢å¼ºåçš„Promptç”Ÿæˆäº†é—®é¢˜ç­”æ¡ˆã€‚</p><h2 id="å®ä¹ -æµ¦ä¸œæ™ºæ…§æœºåœº"><a href="#å®ä¹ -æµ¦ä¸œæ™ºæ…§æœºåœº" class="headerlink" title="å®ä¹ -æµ¦ä¸œæ™ºæ…§æœºåœº"></a>å®ä¹ -æµ¦ä¸œæ™ºæ…§æœºåœº</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç°åœ¨å‡è®¾ä½ æ˜¯ä¸€ä¸ªç»éªŒéå¸¸ä¸°å¯Œçš„Javaåç«¯å¼€å‘è€…ï¼Œç°åœ¨ä½ æ˜¯æ­£åœ¨è´Ÿè´£ä¸€ä¸ªæ™ºæ…§æœºåœºçš„å‡çº§é¡¹ç›®ï¼Œä½ è´Ÿè´£å…¶ä¸­ä¸€ä¸ªæ¨¡å—ï¼Œè¯·</span><br><span class="line">ä½ å¯¹æ­¤æ¥è¿›è¡Œå›ç­”ã€‚</span><br><span class="line">é¦–å…ˆæœºåœºæ˜¯ä½ çš„ç”²æ–¹ï¼Œä½ æœ¬åœ°éœ€è¦è·å–æœºåœºçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚å½“å¤©çš„å®¢æµé‡ã€å½“å‰çš„å®¢æµé‡ã€å½“å¤©å“ªäº›æ—…å®¢ä¼šè¿›è¡Œç™»æœºç­‰</span><br><span class="line">ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä½ å°†ä¼šä»å¦ä¸€ä¸ªæœåŠ¡æä¾›å¹³å°ã€æ¯”å¦‚èˆªå¸ç­‰ä¸€äº›å¹³å°è°ƒç”¨å…¶æ¥å£æ¥è·å–è¿™äº›ä¿¡æ¯ã€‚é‚£ä¹ˆä½ éœ€è¦è®¾è®¡</span><br><span class="line">ä¸€ä¸ªç¬¬ä¸‰æ–¹æ•°æ®é€‚é…å¹³å°ï¼Œåœ¨è¿™ä¸ªå¹³å°ä¸­ä½ ä¼šè®¾è®¡ä¸€ä¸ªæ•°æ®æºè¡¨ã€ä»»åŠ¡è¡¨ã€æ•°æ®æ˜ å°„è¡¨ç­‰ï¼ŒåŒæ—¶ä½ å¯¹æŸäº›æŸ¥è¯¢ä¹‹åå¯èƒ½éœ€è¦</span><br><span class="line">è¿›è¡ŒæŸäº›èšåˆæ“ä½œï¼Œæ¯”å¦‚æ±‚å‡ºå½“å¤©æœ‰å¤šå°‘äººå‡ºå…¥æœºåœºï¼Œç„¶åæŠŠè¿™ä¸ªæ•°æ®ä¿å­˜è‡³æ•°æ®åº“ä¸­ã€‚ç„¶åéœ€è¦æŠŠè¿™äº›ä¿¡æ¯ç”¨äºå¤§å±å¯è§†åŒ–</span><br><span class="line">ã€‚é‚£ä¹ˆè¿™æ˜¯ä½ æ˜¯å¦å°±æ˜¯éœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£æˆ–è€…æ•°æ®åº“ï¼Œè¿™é‡Œå°±ä¼šæ¶‰åŠåˆ°å¾ˆå¤šé—®é¢˜ã€‚ä½ éœ€è¦åˆ—ä¸¾å‡ºæ¥ã€‚</span><br><span class="line">ç¬¬äºŒä¸ªä»»åŠ¡ï¼Œå› ä¸ºæŸäº›æ•°æ®ä½ å¯èƒ½éœ€è¦åœ¨æœ¬åœ°å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´äº’ç›¸ä½¿ç”¨ï¼Œæ¯”å¦‚å½“å‰åŒºåŸŸå†…çš„å€¼ç­äººå‘˜ä¿¡æ¯ã€ä¸€äº›æ—…å®¢çš„åŸºæœ¬ä¿¡æ¯</span><br><span class="line">ç„¶åå¯èƒ½éœ€è¦è·¨è¯­è¨€ç”¨äºPythonç«¯è¿›è¡Œå¼‚å¸¸è¡Œä¸ºåˆ†æç­‰æƒ…å†µï¼Œæ‰€ä»¥ä½ åœ¨è·å–åˆ°ç¬¬ä¸‰æ–¹å¹³å°çš„æ•°æ®ä¹‹åï¼Œä½ ä¼šæŠŠè·å–åˆ°çš„æ•°æ®</span><br><span class="line">ä¿å­˜åˆ°æ•°æ®åº“ä¸­å¹¶ä¹‹åä½¿ç”¨gRPCæ¥è¿›è¡Œä¼ è¾“åˆ†æã€‚ä½ éœ€è¦å¯¹è¿™éƒ¨åˆ†çš„å†…å®¹è¿›è¡Œè¯¦ç»†çš„ä¸€ä¸ªæ¶æ„åˆ†æå¹¶ç»™å‡ºã€‚</span><br><span class="line">ç„¶åæˆ‘éœ€è¦ä½ ç»™æˆ‘å¸®è¿™æ®µå®ä¹ ç»å†å½¢æˆä¸€ä¸ªç®€å†ä¸Šå¯ä»¥ä¹¦å†™çš„ä¸€æ®µè¯ï¼Œæœ€å¥½ä¸è¦åˆ†ç‚¹å›ç­”ã€‚</span><br></pre></td></tr></table></figure><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><blockquote><p>åœ¨åˆšåˆšçš„é¢è¯•ä¸­ï¼Œé¢è¯•å®˜ä¸»è¦è€ƒå¯Ÿäº†ä»¥ä¸‹å‡ ä¸ªæŠ€æœ¯éš¾ç‚¹å’ŒçŸ¥è¯†ç‚¹ï¼š</p><h3 id="1-å¤§æ•°æ®é‡å¤„ç†"><a href="#1-å¤§æ•°æ®é‡å¤„ç†" class="headerlink" title="1. å¤§æ•°æ®é‡å¤„ç†"></a>1. <strong>å¤§æ•°æ®é‡å¤„ç†</strong></h3><ul><li>é¢è¯•å®˜è€ƒå¯Ÿäº†ä½ å¦‚ä½•å¤„ç†<strong>æµ·é‡æ•°æ®</strong>ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹æµ¦ä¸œæ™ºæ…§æœºåœºé¡¹ç›®ä¸­çš„<strong>å¤§è§„æ¨¡æ—…å®¢æ•°æ®</strong>ã€‚</li><li>è€ƒå¯Ÿç‚¹åŒ…æ‹¬ï¼š<ul><li>å¦‚ä½•è¿›è¡Œ<strong>æ•°æ®åˆ†å±‚</strong>æ¶æ„è®¾è®¡ï¼ˆOLTPã€OLAPç­‰ï¼‰ã€‚</li><li>å¦‚ä½•è¿›è¡Œ<strong>åˆ†åº“åˆ†è¡¨</strong>åŠ<strong>æµå¼è®¡ç®—</strong>å¤„ç†ã€‚</li><li>ä½¿ç”¨<strong>Kafka</strong>ç­‰æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿éšœæ•°æ®çš„å®æ—¶æ€§å’Œé«˜ååé‡ã€‚</li></ul></li></ul><h3 id="2-æ•°æ®åº“é€‰å‹"><a href="#2-æ•°æ®åº“é€‰å‹" class="headerlink" title="2. æ•°æ®åº“é€‰å‹"></a>2. <strong>æ•°æ®åº“é€‰å‹</strong></h3><ul><li>é¢è¯•å®˜è€ƒå¯Ÿäº†ä½ åœ¨å¤„ç†å¤§æ•°æ®æ—¶çš„<strong>æ•°æ®åº“é€‰å‹</strong>ï¼Œå¹¶ä¸”è¦æ±‚ä½ é˜è¿°å…·ä½“çš„<strong>å­˜å‚¨æ–¹æ¡ˆ</strong>åŠåŸå› ã€‚</li><li>è€ƒå¯Ÿç‚¹åŒ…æ‹¬ï¼š<ul><li>å¯¹äº<strong>äº‹åŠ¡å‹æ•°æ®</strong>ä½¿ç”¨äº†å“ªäº›æ•°æ®åº“ï¼ˆMySQLã€TiDBç­‰ï¼‰ã€‚</li><li>å¯¹äº<strong>åˆ†æå‹æ•°æ®</strong>é€‰æ‹©äº†å“ªäº›æ•°æ®åº“ï¼ˆClickHouseã€Dorisç­‰ï¼‰ã€‚</li><li><strong>ç¼“å­˜</strong>è§£å†³æ–¹æ¡ˆï¼ˆRedisï¼‰ä»¥åŠå¦‚ä½•å‡å°‘æ•°æ®åº“å‹åŠ›ã€‚</li></ul></li></ul><h3 id="3-ç¬¬ä¸‰æ–¹æ•°æ®å¹³å°é€‚é…ä¸å¹‚ç­‰æ€§ä¿è¯"><a href="#3-ç¬¬ä¸‰æ–¹æ•°æ®å¹³å°é€‚é…ä¸å¹‚ç­‰æ€§ä¿è¯" class="headerlink" title="3. ç¬¬ä¸‰æ–¹æ•°æ®å¹³å°é€‚é…ä¸å¹‚ç­‰æ€§ä¿è¯"></a>3. <strong>ç¬¬ä¸‰æ–¹æ•°æ®å¹³å°é€‚é…ä¸å¹‚ç­‰æ€§ä¿è¯</strong></h3><ul><li>é¢è¯•å®˜è€ƒå¯Ÿäº†ä½ å¦‚ä½•è®¾è®¡<strong>å¤šæ¬¡è¯·æ±‚</strong>åŠ<strong>å¹‚ç­‰æ€§ä¿è¯</strong>ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</li><li>è€ƒå¯Ÿç‚¹åŒ…æ‹¬ï¼š<ul><li>å¦‚ä½•ä½¿ç”¨**å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚request_idï¼‰**ç¡®ä¿å¹‚ç­‰æ€§ã€‚</li><li>è®¾è®¡å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¼šé‡å¤æ’å…¥æˆ–ä¸¢å¤±ã€‚</li><li><strong>é‡è¯•æœºåˆ¶</strong>å’Œå¦‚ä½•åº”å¯¹è¯·æ±‚å¤±è´¥ï¼ˆå¦‚ç½‘ç»œé—®é¢˜ã€æ¥å£æŒ‚æ‰ç­‰ï¼‰ã€‚</li></ul></li></ul><h3 id="4-ç½‘ç»œå¼‚å¸¸åŠè¯·æ±‚å¤±è´¥å¤„ç†"><a href="#4-ç½‘ç»œå¼‚å¸¸åŠè¯·æ±‚å¤±è´¥å¤„ç†" class="headerlink" title="4. ç½‘ç»œå¼‚å¸¸åŠè¯·æ±‚å¤±è´¥å¤„ç†"></a>4. <strong>ç½‘ç»œå¼‚å¸¸åŠè¯·æ±‚å¤±è´¥å¤„ç†</strong></h3><ul><li>é¢è¯•å®˜è€ƒå¯Ÿäº†ä½ åœ¨é¢å¯¹<strong>è¯·æ±‚å¤±è´¥</strong>çš„æƒ…å†µä¸‹çš„åº”å¯¹ç­–ç•¥ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œå¼‚å¸¸çš„æƒ…å†µä¸‹å¦‚ä½•ä¿è¯ç³»ç»Ÿçš„å¯é æ€§å’Œæ•°æ®å®Œæ•´æ€§ã€‚</li><li>è€ƒå¯Ÿç‚¹åŒ…æ‹¬ï¼š<ul><li><strong>æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶</strong>ï¼Œå‡å°‘ç³»ç»Ÿå‹åŠ›ã€‚</li><li><strong>ç†”æ–­ä¸é™æµ</strong>ç­–ç•¥ï¼Œé¿å…å› å•ä¸€æ¥å£æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</li><li><strong>æ—¥å¿—ç›‘æ§</strong>å’Œ<strong>é™çº§æ–¹æ¡ˆ</strong>è®¾è®¡ï¼Œä¿è¯æœåŠ¡é«˜å¯ç”¨æ€§ã€‚</li></ul></li></ul><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™äº›é—®é¢˜è€ƒå¯Ÿäº†ä½ åœ¨<strong>é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡</strong>ã€<strong>å¤§æ•°æ®é‡å­˜å‚¨ä¸å¤„ç†</strong>ã€<strong>åˆ†å¸ƒå¼æ¶æ„è®¾è®¡</strong>ä»¥åŠ<strong>æ•°æ®ä¸€è‡´æ€§å’Œç³»ç»Ÿå¯é æ€§</strong>ç­‰æ–¹é¢çš„çŸ¥è¯†ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤æ‚é¡¹ç›®ä¸­çš„å®é™…é—®é¢˜æ—¶ï¼Œå¦‚ä½•åšå‡ºåˆç†çš„æŠ€æœ¯å†³ç­–å’Œåº”å¯¹ç­–ç•¥ã€‚</p></blockquote><h3 id="æè¿°-1"><a href="#æè¿°-1" class="headerlink" title="æè¿°"></a>æè¿°</h3><p>æœ¬æ®µå®ä¹ æ˜¯åœ¨ä¸Šæµ·è¿½åŠ¿å…¬å¸ï¼Œè¯¥é¡¹ç›®æ˜¯ä¸Šæµ·æµ¦ä¸œæœºåœºçš„æ™ºæ…§æœºåœºé¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ¶‰åŠåˆ°å¤šä¸ªæ¨¡å—ï¼Œæˆ‘æ‰€æ¶‰åŠåˆ°çš„æœ‰ï¼šå¤šåº”ç”¨å•ç‚¹ç™»å½•ã€ç¬¬ä¸‰æ–¹æ•°æ®åº“é€‚é…å¹³å°å‰åç«¯å¼€å‘ã€‚</p><p>å¦‚æœä»…ä»…æ˜¯ä¸Šè¯‰æè¿°çš„å†…å®¹ï¼Œå¹¶ä¸å¤Ÿä¸°å¯Œï¼Œæ‰€ä»¥éœ€è¦å¯¹è¿™éƒ¨åˆ†çš„å†…å®¹è¿›è¡Œæ‰©å±•ã€‚é¦–å…ˆè¿™ä¸ªé¡¹ç›®å°±æ˜¯é’ˆå¯¹äºæµ¦ä¸œæœºåœºçš„æ™ºæ…§æœºåœºå‡çº§é¡¹ç›®ã€‚è¿™å…¶ä¸­æ¶‰åŠåˆ°çš„æŠ€æœ¯ç‚¹ä¼šæœ‰å“ªäº›å‘¢ï¼Ÿ</p><h3 id="å¦‚ä½•ä¿è¯è¯·æ±‚æ¥å£çš„å¹‚ç­‰æ€§"><a href="#å¦‚ä½•ä¿è¯è¯·æ±‚æ¥å£çš„å¹‚ç­‰æ€§" class="headerlink" title="å¦‚ä½•ä¿è¯è¯·æ±‚æ¥å£çš„å¹‚ç­‰æ€§"></a>å¦‚ä½•ä¿è¯è¯·æ±‚æ¥å£çš„å¹‚ç­‰æ€§</h3><blockquote><p>å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦å›ç­”å¦‚ä½•ä¿è¯æ¥å£çš„å¹‚ç­‰æ€§è¿™ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘å¾—ç†è§£ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§ã€‚å¹‚ç­‰æ€§æ˜¯æŒ‡æ— è®ºè°ƒç”¨æ¥å£å¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ä¸€è‡´çš„ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·å¤šæ¬¡ç‚¹å‡»æäº¤è®¢å•ï¼Œç³»ç»Ÿåº”è¯¥åªç”Ÿæˆä¸€ä¸ªè®¢å•ï¼Œè€Œä¸æ˜¯å¤šä¸ªã€‚è¿™åœ¨å®é™…å¼€å‘ä¸­éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½ä¼šé‡å¤å‘é€è¯·æ±‚ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦å›å¿†å¸¸è§çš„ä¿è¯æ¥å£å¹‚ç­‰æ€§çš„æ–¹æ³•ã€‚é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ¯”å¦‚è®¢å•IDæˆ–è€…è¯·æ±‚IDã€‚æ¯æ¬¡è¯·æ±‚æ—¶ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„IDï¼ŒæœåŠ¡ç«¯æ£€æŸ¥è¿™ä¸ªIDæ˜¯å¦å·²ç»å¤„ç†è¿‡ï¼Œå¦‚æœå¤„ç†è¿‡å°±ç›´æ¥è¿”å›ä¹‹å‰çš„ç»“æœï¼Œé¿å…é‡å¤å¤„ç†ã€‚è¿™ç§æ–¹æ³•éœ€è¦æœåŠ¡ç«¯å­˜å‚¨è¿™äº›IDï¼Œå¯èƒ½ä¼šç”¨åˆ°æ•°æ®åº“æˆ–è€…ç¼“å­˜ï¼Œæ¯”å¦‚Redisã€‚</p><p>ç„¶åæ˜¯ä¹è§‚é”ã€‚æ¯”å¦‚åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œå¸¦ä¸Šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œåªæœ‰ç‰ˆæœ¬å·åŒ¹é…çš„æ—¶å€™æ‰æ‰§è¡Œæ›´æ–°ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢é‡å¤æ›´æ–°ã€‚æ¯”å¦‚åœ¨æ‰£å‡åº“å­˜çš„æ—¶å€™ï¼Œå…ˆè¯»å–å½“å‰åº“å­˜å’Œç‰ˆæœ¬å·ï¼Œç„¶åæ›´æ–°æ—¶æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´è¯´æ˜æœ‰å…¶ä»–è¯·æ±‚å·²ç»ä¿®æ”¹è¿‡ï¼Œå°±æ‹’ç»å½“å‰è¯·æ±‚ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯Tokenæœºåˆ¶ã€‚å®¢æˆ·ç«¯åœ¨å‘èµ·è¯·æ±‚å‰å…ˆè·å–ä¸€ä¸ªTokenï¼ŒæœåŠ¡ç«¯ç”Ÿæˆå¹¶ä¿å­˜è¿™ä¸ªTokenï¼Œä¹‹åå®¢æˆ·ç«¯çš„è¯·æ±‚å¿…é¡»æºå¸¦è¿™ä¸ªTokenï¼ŒæœåŠ¡ç«¯å¤„ç†å®Œè¯·æ±‚ååˆ é™¤Tokenã€‚è¿™æ ·é‡å¤çš„è¯·æ±‚ä¼šå› ä¸ºTokenä¸å­˜åœ¨è€Œè¢«æ‹’ç»ã€‚</p><p>è¿˜æœ‰æ•°æ®åº“çš„å”¯ä¸€çº¦æŸï¼Œæ¯”å¦‚åœ¨è¡¨ä¸­è®¾ç½®å”¯ä¸€ç´¢å¼•ï¼Œé˜²æ­¢æ’å…¥é‡å¤çš„æ•°æ®ã€‚æ¯”å¦‚ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œç”¨æˆ·åå¿…é¡»å”¯ä¸€ï¼Œè®¾ç½®å”¯ä¸€ç´¢å¼•åï¼Œé‡å¤æ’å…¥ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä»è€Œä¿è¯å¹‚ç­‰æ€§ã€‚</p><p>å¦å¤–ï¼ŒçŠ¶æ€æœºä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•ã€‚ä¸šåŠ¡æ“ä½œæŒ‰ç…§ä¸€å®šçš„çŠ¶æ€æµè½¬è¿›è¡Œï¼Œæ¯”å¦‚è®¢å•çŠ¶æ€ä»â€œå¾…æ”¯ä»˜â€åˆ°â€œå·²æ”¯ä»˜â€ï¼Œå¦‚æœæ”¶åˆ°é‡å¤çš„æ”¯ä»˜è¯·æ±‚ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥å½“å‰çŠ¶æ€ï¼Œå¦‚æœæ˜¯â€œå·²æ”¯ä»˜â€å°±ç›´æ¥è¿”å›æˆåŠŸï¼Œä¸å†å¤„ç†ã€‚</p><p>ç°åœ¨éœ€è¦è€ƒè™‘ç”¨æˆ·æåˆ°çš„åœºæ™¯ï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ä¸”æ•°æ®é‡å¤§éœ€è¦åˆ†æ‰¹æ¬¡è¯·æ±‚ï¼Œå¯èƒ½å­˜åœ¨å¤±è´¥é‡è¯•ã€‚è¿™æ—¶å€™éœ€è¦ç¡®ä¿å³ä½¿å¤šæ¬¡é‡è¯•ï¼Œæ•°æ®åº“çš„ç»“æœä¸€è‡´ã€‚å¯èƒ½éœ€è¦ç»“åˆå”¯ä¸€æ‰¹æ¬¡IDå’ŒçŠ¶æ€è®°å½•ï¼Œæ¯æ¬¡å¤„ç†å‰æ£€æŸ¥æ‰¹æ¬¡çŠ¶æ€ï¼Œå¦‚æœå·²ç»å¤„ç†è¿‡å°±ç›´æ¥è·³è¿‡ï¼Œå¦åˆ™å¤„ç†å¹¶æ›´æ–°çŠ¶æ€ã€‚</p><p>è¿˜è¦è€ƒè™‘åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é—®é¢˜ï¼Œæ¯”å¦‚ç½‘ç»œå»¶è¿Ÿã€æœåŠ¡å®•æœºç­‰ã€‚å¯èƒ½éœ€è¦å¼•å…¥åˆ†å¸ƒå¼é”æˆ–è€…ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯é¡ºåºå’Œå”¯ä¸€æ€§ã€‚</p><p>ä¸è¿‡ï¼Œç”¨æˆ·åœ¨é—®é¢˜ä¸­æåˆ°äº†è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ï¼Œå¯èƒ½å­˜åœ¨å¤±è´¥çš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦è®¾è®¡é‡è¯•æœºåˆ¶ï¼Œå¹¶ä¸”åœ¨é‡è¯•æ—¶ä¿è¯å¹‚ç­‰æ€§ã€‚æ¯”å¦‚æ¯ä¸ªæ‰¹æ¬¡è¯·æ±‚æœ‰ä¸€ä¸ªå”¯ä¸€IDï¼Œç¬¬ä¸‰æ–¹æ¥å£æ”¯æŒå¹‚ç­‰æ€§ï¼Œæˆ–è€…æœ¬åœ°è®°å½•æ¯ä¸ªæ‰¹æ¬¡çš„çŠ¶æ€ï¼Œé¿å…é‡å¤æäº¤ã€‚</p><p>è¿˜éœ€è¦æ³¨æ„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œæ¯”å¦‚åœ¨éƒ¨åˆ†æ‰¹æ¬¡æˆåŠŸã€éƒ¨åˆ†å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•å›æ»šæˆ–è¡¥å¿ã€‚å¯èƒ½éœ€è¦äº‹åŠ¡æœºåˆ¶æˆ–è€…æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œä¿è¯æ¥å£å¹‚ç­‰æ€§çš„æ–¹æ³•åŒ…æ‹¬å”¯ä¸€IDã€Tokenæœºåˆ¶ã€ä¹è§‚é”ã€æ•°æ®åº“å”¯ä¸€çº¦æŸã€çŠ¶æ€æœºç­‰ã€‚å…·ä½“å®ç°éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹æ³•ï¼Œå¹¶ç»“åˆé‡è¯•æœºåˆ¶å’ŒçŠ¶æ€ç®¡ç†æ¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>ä¿è¯æ¥å£çš„å¹‚ç­‰æ€§å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°ï¼š</p><h3 id="1-å”¯ä¸€è¯·æ±‚æ ‡è¯†ï¼ˆRequest-IDï¼‰"><a href="#1-å”¯ä¸€è¯·æ±‚æ ‡è¯†ï¼ˆRequest-IDï¼‰" class="headerlink" title="1. å”¯ä¸€è¯·æ±‚æ ‡è¯†ï¼ˆRequest IDï¼‰"></a>1. <strong>å”¯ä¸€è¯·æ±‚æ ‡è¯†ï¼ˆRequest IDï¼‰</strong></h3><p>â€¢ <strong>å®ç°æ–¹å¼</strong>ï¼šå®¢æˆ·ç«¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„è¯·æ±‚IDï¼ˆå¦‚UUIDï¼‰ï¼ŒæœåŠ¡ç«¯é€šè¿‡è¯¥IDåˆ¤æ–­è¯·æ±‚æ˜¯å¦é‡å¤ã€‚<br>â€¢ <strong>æ­¥éª¤</strong>ï¼š</p><ol><li>å®¢æˆ·ç«¯ç”Ÿæˆå”¯ä¸€IDï¼Œå¹¶éšè¯·æ±‚å‘é€è‡³æœåŠ¡ç«¯ã€‚</li><li>æœåŠ¡ç«¯åœ¨Redisæˆ–æ•°æ®åº“ä¸­è®°å½•è¯¥IDçš„çŠ¶æ€ï¼ˆå¦‚<code>å·²å¤„ç†</code>&#x2F;<code>æœªå¤„ç†</code>ï¼‰ã€‚</li><li>å¤„ç†è¯·æ±‚å‰ï¼ŒæœåŠ¡ç«¯æ£€æŸ¥è¯¥IDæ˜¯å¦å·²å­˜åœ¨ï¼š<br>â—¦ è‹¥å­˜åœ¨ï¼Œç›´æ¥è¿”å›ä¹‹å‰çš„å¤„ç†ç»“æœã€‚<br>â—¦ è‹¥ä¸å­˜åœ¨ï¼Œå¤„ç†è¯·æ±‚å¹¶æ ‡è®°IDä¸ºå·²å¤„ç†ã€‚<br>â€¢ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ”¯ä»˜ã€è®¢å•æäº¤ç­‰é«˜å¹¶å‘å†™æ“ä½œã€‚</li></ol><h3 id="2-Token-æœºåˆ¶"><a href="#2-Token-æœºåˆ¶" class="headerlink" title="2. Token æœºåˆ¶"></a>2. <strong>Token æœºåˆ¶</strong></h3><p>â€¢ <strong>å®ç°æ–¹å¼</strong>ï¼šå®¢æˆ·ç«¯åœ¨æ‰§è¡Œä¸šåŠ¡æ“ä½œå‰ï¼Œå…ˆç”³è¯·ä¸€ä¸ªä¸€æ¬¡æ€§Tokenã€‚<br>â€¢ <strong>æ­¥éª¤</strong>ï¼š</p><ol><li>å®¢æˆ·ç«¯è°ƒç”¨é¢„æ¥å£ï¼ˆå¦‚<code>/api/get_token</code>ï¼‰è·å–Tokenã€‚</li><li>æœåŠ¡ç«¯ç”ŸæˆTokenå¹¶å­˜å‚¨ï¼ˆå¦‚Redisï¼Œè®¾ç½®çŸ­æ—¶è¿‡æœŸï¼‰ã€‚</li><li>å®¢æˆ·ç«¯æºå¸¦Tokenå‘èµ·æ­£å¼è¯·æ±‚ã€‚</li><li>æœåŠ¡ç«¯éªŒè¯Tokenæ˜¯å¦å­˜åœ¨ï¼š<br>â—¦ å­˜åœ¨ï¼šå¤„ç†è¯·æ±‚å¹¶åˆ é™¤Tokenã€‚<br>â—¦ ä¸å­˜åœ¨ï¼šæ‹’ç»è¯·æ±‚ï¼ˆè§†ä¸ºé‡å¤æäº¤ï¼‰ã€‚<br>â€¢ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè¡¨å•æäº¤ã€æŠ¢è´­ç­‰éœ€é˜²æ­¢é‡å¤æäº¤çš„åœºæ™¯ã€‚</li></ol><h3 id="3-æ•°æ®åº“å”¯ä¸€çº¦æŸ"><a href="#3-æ•°æ®åº“å”¯ä¸€çº¦æŸ" class="headerlink" title="3. æ•°æ®åº“å”¯ä¸€çº¦æŸ"></a>3. <strong>æ•°æ®åº“å”¯ä¸€çº¦æŸ</strong></h3><p>â€¢ <strong>å®ç°æ–¹å¼</strong>ï¼šåˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€ç´¢å¼•æˆ–è”åˆå”¯ä¸€é”®ï¼Œé¿å…é‡å¤æ•°æ®æ’å…¥ã€‚<br>â€¢ <strong>æ­¥éª¤</strong>ï¼š</p><ol><li>è®¾è®¡ä¸šåŠ¡è¡¨æ—¶ï¼Œå¯¹å…³é”®å­—æ®µï¼ˆå¦‚è®¢å•å·ã€ç”¨æˆ·ID+æ´»åŠ¨IDï¼‰æ·»åŠ å”¯ä¸€ç´¢å¼•ã€‚</li><li>æ’å…¥æ•°æ®æ—¶ï¼Œè‹¥è§¦å‘å”¯ä¸€å†²çªï¼Œç›´æ¥æ•è·å¼‚å¸¸å¹¶è¿”å›å·²æœ‰ç»“æœã€‚<br>â€¢ <strong>ç¤ºä¾‹</strong>ï¼š</li></ol>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  order_no <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">UNIQUE</span>,  <span class="comment">-- å”¯ä¸€ç´¢å¼•</span></span><br><span class="line">  user_id <span class="type">INT</span>,</span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>â€¢ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¼˜æƒ åˆ¸é¢†å–ã€è®¢å•åˆ›å»ºç­‰éœ€å”¯ä¸€æ€§çº¦æŸçš„åœºæ™¯ã€‚</p><h3 id="4-ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·æ§åˆ¶ï¼‰"><a href="#4-ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·æ§åˆ¶ï¼‰" class="headerlink" title="4. ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·æ§åˆ¶ï¼‰"></a>4. <strong>ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·æ§åˆ¶ï¼‰</strong></h3><p>â€¢ <strong>å®ç°æ–¹å¼</strong>ï¼šä¸ºæ•°æ®æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œæ›´æ–°æ—¶æ ¡éªŒç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ã€‚<br>â€¢ <strong>æ­¥éª¤</strong>ï¼š</p><ol><li>è¯»å–æ•°æ®æ—¶è·å–å½“å‰ç‰ˆæœ¬å·ï¼ˆå¦‚<code>version=3</code>ï¼‰ã€‚</li><li>æ›´æ–°æ•°æ®æ—¶ï¼Œåœ¨SQLä¸­å¢åŠ ç‰ˆæœ¬å·æ¡ä»¶ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> products </span><br><span class="line"><span class="keyword">SET</span> stock <span class="operator">=</span> stock <span class="operator">-</span> <span class="number">1</span>, version <span class="operator">=</span> version <span class="operator">+</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">100</span> <span class="keyword">AND</span> version <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure></li><li>è‹¥å½±å“è¡Œæ•°ä¸º0ï¼Œè¯´æ˜ç‰ˆæœ¬å·å·²å˜æ›´ï¼Œæ‹’ç»æœ¬æ¬¡è¯·æ±‚ã€‚<br>â€¢ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåº“å­˜æ‰£å‡ã€è´¦æˆ·ä½™é¢ä¿®æ”¹ç­‰å¹¶å‘æ›´æ–°åœºæ™¯ã€‚</li></ol><h3 id="5-çŠ¶æ€æœºï¼ˆä¸šåŠ¡çŠ¶æ€æµè½¬ï¼‰"><a href="#5-çŠ¶æ€æœºï¼ˆä¸šåŠ¡çŠ¶æ€æµè½¬ï¼‰" class="headerlink" title="5. çŠ¶æ€æœºï¼ˆä¸šåŠ¡çŠ¶æ€æµè½¬ï¼‰"></a>5. <strong>çŠ¶æ€æœºï¼ˆä¸šåŠ¡çŠ¶æ€æµè½¬ï¼‰</strong></h3><p>â€¢ <strong>å®ç°æ–¹å¼</strong>ï¼šå®šä¹‰ä¸šåŠ¡çŠ¶æ€æµè½¬è§„åˆ™ï¼Œæ‹’ç»éæ³•çŠ¶æ€å˜æ›´ã€‚<br>â€¢ <strong>æ­¥éª¤</strong>ï¼š</p><ol><li>è®¾è®¡çŠ¶æ€æµè½¬å›¾ï¼ˆå¦‚è®¢å•çŠ¶æ€ï¼š<code>å¾…æ”¯ä»˜ â†’ å·²æ”¯ä»˜ â†’ å·²å®Œæˆ</code>ï¼‰ã€‚</li><li>å¤„ç†è¯·æ±‚æ—¶ï¼Œæ£€æŸ¥å½“å‰çŠ¶æ€æ˜¯å¦å…è®¸å˜æ›´ï¼š<br>â—¦ è‹¥å…è®¸ï¼Œæ›´æ–°çŠ¶æ€å¹¶æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚<br>â—¦ è‹¥ä¸å…è®¸ï¼Œç›´æ¥è¿”å›å½“å‰ç»“æœã€‚<br>â€¢ <strong>ç¤ºä¾‹</strong>ï¼š</li></ol>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (order.getStatus() != <span class="string">&quot;å¾…æ”¯ä»˜&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.error(<span class="string">&quot;è®¢å•å·²æ”¯ä»˜ï¼Œè¯·å‹¿é‡å¤æ“ä½œ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€¢ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè®¢å•çŠ¶æ€å˜æ›´ã€å®¡æ ¸æµç¨‹ç­‰æœ‰ä¸¥æ ¼çŠ¶æ€ä¾èµ–çš„ä¸šåŠ¡ã€‚</p><h3 id="6-åˆ†å¸ƒå¼é”"><a href="#6-åˆ†å¸ƒå¼é”" class="headerlink" title="6. åˆ†å¸ƒå¼é”"></a>6. <strong>åˆ†å¸ƒå¼é”</strong></h3><p>â€¢ <strong>å®ç°æ–¹å¼</strong>ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œé€šè¿‡é”æœºåˆ¶ç¡®ä¿åŒä¸€æ—¶é—´ä»…ä¸€ä¸ªè¯·æ±‚èƒ½æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚<br>â€¢ <strong>æ­¥éª¤</strong>ï¼š</p><ol><li>ä½¿ç”¨Redisæˆ–ZooKeeperå®ç°åˆ†å¸ƒå¼é”ï¼ˆå¦‚<code>SET lock_key 1 NX EX 30</code>ï¼‰ã€‚</li><li>è·å–é”åæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå®Œæˆåé‡Šæ”¾é”ã€‚</li><li>è‹¥è·å–é”å¤±è´¥ï¼Œç›´æ¥è¿”å›æç¤ºæˆ–ç­‰å¾…é‡è¯•ã€‚<br>â€¢ <strong>ä¼˜åŒ–</strong>ï¼šé”ç²’åº¦ç»†åŒ–åˆ°èµ„æºIDï¼ˆå¦‚<code>lock:order:123</code>ï¼‰ï¼Œé¿å…å…¨å±€é”ç«äº‰ã€‚<br>â€¢ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç§’æ€ã€åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç­‰é«˜å¹¶å‘åœºæ™¯ã€‚</li></ol><h3 id="7-æ¶ˆæ¯é˜Ÿåˆ—å»é‡"><a href="#7-æ¶ˆæ¯é˜Ÿåˆ—å»é‡" class="headerlink" title="7. æ¶ˆæ¯é˜Ÿåˆ—å»é‡"></a>7. <strong>æ¶ˆæ¯é˜Ÿåˆ—å»é‡</strong></h3><p>â€¢ <strong>å®ç°æ–¹å¼</strong>ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—çš„ACKæœºåˆ¶å’Œå”¯ä¸€IDå®ç°æ¶ˆè´¹ç«¯å¹‚ç­‰ã€‚<br>â€¢ <strong>æ­¥éª¤</strong>ï¼š</p><ol><li>æ¶ˆæ¯ç”Ÿäº§è€…ä¸ºæ¯æ¡æ¶ˆæ¯ç”Ÿæˆå”¯ä¸€IDã€‚</li><li>æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯å‰ï¼Œæ£€æŸ¥è¯¥IDæ˜¯å¦å·²å¤„ç†ï¼š<br>â—¦ è‹¥å·²å¤„ç†ï¼Œç›´æ¥ACKç¡®è®¤ã€‚<br>â—¦ è‹¥æœªå¤„ç†ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘å¹¶è®°å½•IDã€‚</li><li>ç»“åˆæ•°æ®åº“å”¯ä¸€é”®æˆ–Rediså®ç°å»é‡ã€‚<br>â€¢ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¼‚æ­¥ä»»åŠ¡å¤„ç†ã€å¤§æ•°æ®é‡æ‰¹é‡æ“ä½œã€‚</li></ol><h3 id="8-ç¬¬ä¸‰æ–¹æ¥å£åä½œ"><a href="#8-ç¬¬ä¸‰æ–¹æ¥å£åä½œ" class="headerlink" title="8. ç¬¬ä¸‰æ–¹æ¥å£åä½œ"></a>8. <strong>ç¬¬ä¸‰æ–¹æ¥å£åä½œ</strong></h3><p>â€¢ <strong>å®ç°æ–¹å¼</strong>ï¼šè‹¥æ¥å£ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œéœ€ç¡®ä¿ç¬¬ä¸‰æ–¹æ”¯æŒå¹‚ç­‰æ€§ã€‚<br>â€¢ <strong>æ­¥éª¤</strong>ï¼š</p><ol><li>è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£æ—¶ä¼ é€’å”¯ä¸€IDï¼ˆå¦‚<code>X-Idempotency-Key: request_123</code>ï¼‰ã€‚</li><li>ç¬¬ä¸‰æ–¹æ ¹æ®è¯¥IDä¿è¯ç›¸åŒè¯·æ±‚ä»…å¤„ç†ä¸€æ¬¡ã€‚</li><li>è‹¥ç¬¬ä¸‰æ–¹ä¸æ”¯æŒå¹‚ç­‰ï¼Œæœ¬åœ°éœ€è®°å½•å·²æˆåŠŸè¯·æ±‚çš„IDã€‚<br>â€¢ <strong>ç¤ºä¾‹</strong>ï¼šæ”¯ä»˜æ¥å£ï¼ˆå¦‚æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜é€šå¸¸æ”¯æŒå¹‚ç­‰æ€§ï¼‰ã€‚</li></ol><h3 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>â€¢ <strong>ç®€å•åœºæ™¯</strong>ï¼šä¼˜å…ˆä½¿ç”¨æ•°æ®åº“å”¯ä¸€çº¦æŸæˆ–ä¹è§‚é”ã€‚<br>â€¢ <strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼šç»“åˆRediså”¯ä¸€è¯·æ±‚IDæˆ–åˆ†å¸ƒå¼é”ã€‚<br>â€¢ <strong>ä¾èµ–ç¬¬ä¸‰æ–¹</strong>ï¼šç¡®ä¿ä¼ é€’å”¯ä¸€IDå¹¶åˆ©ç”¨å…¶å¹‚ç­‰æ€§æ”¯æŒã€‚<br>â€¢ <strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šé€šè¿‡é‡è¯•æœºåˆ¶+çŠ¶æ€æœº+å¼‚æ­¥è¡¥å¿ä¿éšœã€‚</p><p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œå¯æœ‰æ•ˆé¿å…é‡å¤è¯·æ±‚å¯¼è‡´çš„è„æ•°æ®æˆ–ä¸šåŠ¡å¼‚å¸¸ï¼Œç¡®ä¿ç³»ç»Ÿå¥å£®æ€§ã€‚</p></blockquote><h3 id="å•ç‚¹ç™»å½•æ¨¡å—"><a href="#å•ç‚¹ç™»å½•æ¨¡å—" class="headerlink" title="å•ç‚¹ç™»å½•æ¨¡å—"></a>å•ç‚¹ç™»å½•æ¨¡å—</h3><ol><li><a href="https://blog.csdn.net/qq_53895518/article/details/136869614?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522a5fef490aca8aec8695bcd9e68568361%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=a5fef490aca8aec8695bcd9e68568361&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-136869614-null-null.142%5Ev102%5Epc_search_result_base6&utm_term=%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95&spm=1018.2226.3001.4187">å•ç‚¹ç™»å½•(SSO)è¯¦è§£â€”â€”è¶…è¯¦ç»†</a></li></ol><p><img src="https://cdn.jsdelivr.net/gh/fangyaohui/Pictures@main/img/202503261524074.webp" alt="image.png"></p><h3 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h3><ol><li><a href="https://blog.csdn.net/qq_40991313/article/details/133797658">ä¸€ç¯‡æ–‡ç« ææ‡‚MySQLçš„åˆ†åº“åˆ†è¡¨ï¼Œä»æ‹†åˆ†åœºæ™¯ã€ç›®æ ‡è¯„ä¼°ã€æ‹†åˆ†æ–¹æ¡ˆã€ä¸åœæœºè¿ç§»ã€ä¸€è‡´æ€§è¡¥å¿ç­‰æ–¹é¢è¯¦ç»†é˜è¿°MySQLæ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ</a></li></ol><h3 id="ç¬¬ä¸‰æ–¹æ•°æ®é€‚é…å¹³å°å¼€å‘"><a href="#ç¬¬ä¸‰æ–¹æ•°æ®é€‚é…å¹³å°å¼€å‘" class="headerlink" title="ç¬¬ä¸‰æ–¹æ•°æ®é€‚é…å¹³å°å¼€å‘"></a>ç¬¬ä¸‰æ–¹æ•°æ®é€‚é…å¹³å°å¼€å‘</h3><p>ç®€å•çš„æ¥è¯´æˆ‘ä»¬ä¼šå®šæ—¶çš„å»è°ƒç”¨æŸäº›ç¬¬ä¸‰æ–¹æ¥å£å»è·å–æ•°æ®å¹¶åŒæ­¥åˆ°æœ¬åœ°æ•°æ®åº“ä¸­ï¼Œè¿™é‡Œä¼šæ¶‰åŠåˆ°å¦‚ä¸‹é—®é¢˜ï¼š</p><h4 id="ç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨é£é™©"><a href="#ç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨é£é™©" class="headerlink" title="ç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨é£é™©"></a>ç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨é£é™©</h4><h5 id="ç¨³å®šæ€§é—®é¢˜"><a href="#ç¨³å®šæ€§é—®é¢˜" class="headerlink" title="ç¨³å®šæ€§é—®é¢˜"></a>ç¨³å®šæ€§é—®é¢˜</h5><p><strong>é—®é¢˜</strong>ï¼šç¬¬ä¸‰æ–¹æœåŠ¡å®•æœºæˆ–å“åº”è¶…æ—¶ï¼ˆå¦‚HTTP 503&#x2F;504é”™è¯¯ï¼‰ï¼Œå¯¼è‡´åŒæ­¥ä»»åŠ¡å¤±è´¥ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>è®¾ç½® <strong>æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥</strong>ï¼ˆå¦‚é¦–æ¬¡1ç§’åé‡è¯•ï¼Œåç»­æ¯æ¬¡ç¿»å€ï¼Œæœ€å¤š5æ¬¡ï¼‰</li><li>ä½¿ç”¨ <strong>ç†”æ–­æœºåˆ¶</strong>ï¼ˆå¦‚Resilience4jï¼‰ï¼Œå½“å¤±è´¥ç‡&gt;50%æ—¶æš‚åœè°ƒç”¨1å°æ—¶</li></ul><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸ºäº†ä¿è¯ç¬¬ä¸‰æ–¹æ¥å£å®•æœºçš„æƒ…å†µå‘ç”Ÿåï¼Œå¯¼è‡´æˆ‘ä»¬è¿™è¾¹çš„æœåŠ¡å‡ºç°é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥é‡‡å–ç†”æ–­çš„æœºåˆ¶ï¼Œå½“å¤±è´¥ç‡è¾¾åˆ°é˜ˆå€¼ä¹‹åï¼Œæš‚åœè¯·æ±‚ï¼Œå¹¶å°†è¯¥æœåŠ¡é™çº§ä½¿ç”¨æŒ‡å®šçš„é»˜è®¤å€¼è¿›è¡Œè¿”å›ï¼ŒåŒæ—¶ä¸ŠæŠ¥å¼‚å¸¸æƒ…å†µã€‚</p><h5 id="é¢‘ç‡é™åˆ¶ä¸é…é¢æ§åˆ¶"><a href="#é¢‘ç‡é™åˆ¶ä¸é…é¢æ§åˆ¶" class="headerlink" title="é¢‘ç‡é™åˆ¶ä¸é…é¢æ§åˆ¶"></a><strong>é¢‘ç‡é™åˆ¶ä¸é…é¢æ§åˆ¶</strong></h5><p><strong>é—®é¢˜</strong>ï¼šç¬¬ä¸‰æ–¹æ¥å£é™åˆ¶è°ƒç”¨é¢‘ç‡ï¼ˆå¦‚æ¯åˆ†é’Ÿ100æ¬¡ï¼‰ï¼Œè¶…é¢è§¦å‘é™æµï¼ˆHTTP 429ï¼‰ã€‚</p><p><strong>æ¡ˆä¾‹</strong>ï¼šå› å…¨é‡åŒæ­¥æ—¶é«˜é¢‘è°ƒç”¨èˆªç©ºå…¬å¸APIï¼ŒIPè¢«åŠ å…¥é»‘åå• <strong>24å°æ—¶</strong>ï¼Œå¯¼è‡´åŒæ­¥ä¸­æ–­ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼šå®ç° <strong>æ¼æ¡¶ç®—æ³•</strong> æ§åˆ¶è°ƒç”¨é€Ÿç‡</p><h4 id="æ•°æ®å¤„ç†ä¸å­˜å‚¨é£é™©"><a href="#æ•°æ®å¤„ç†ä¸å­˜å‚¨é£é™©" class="headerlink" title="æ•°æ®å¤„ç†ä¸å­˜å‚¨é£é™©"></a><strong>æ•°æ®å¤„ç†ä¸å­˜å‚¨é£é™©</strong></h4><h5 id="æ•°æ®ä¸€è‡´æ€§é£é™©"><a href="#æ•°æ®ä¸€è‡´æ€§é£é™©" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§é£é™©"></a><strong>æ•°æ®ä¸€è‡´æ€§é£é™©</strong></h5><ul><li><strong>é—®é¢˜</strong>ï¼šåŒæ­¥è¿‡ç¨‹ä¸­ç¨‹åºå´©æºƒï¼Œå¯¼è‡´ <strong>éƒ¨åˆ†æ•°æ®å†™å…¥æœ¬åœ°åº“ï¼Œéƒ¨åˆ†ä¸¢å¤±</strong>ã€‚</li><li><strong>æ¡ˆä¾‹</strong>ï¼šåŒæ­¥1ä¸‡æ¡æ—…å®¢æ•°æ®æ—¶ï¼ŒæœåŠ¡é‡å¯å¯¼è‡´æœ€å2000æ¡æœªæäº¤ï¼Œéœ€æ‰‹åŠ¨ä¿®å¤ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
            <tag> é¢è¯• </tag>
            
            <tag> å®ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>81-01 é¢è¯•-å°ç±³-æµ‹å¼€</title>
      <link href="/2025/02/15/81-01%20%E9%9D%A2%E8%AF%95-%E5%B0%8F%E7%B1%B3-%E6%B5%8B%E5%BC%80/"/>
      <url>/2025/02/15/81-01%20%E9%9D%A2%E8%AF%95-%E5%B0%8F%E7%B1%B3-%E6%B5%8B%E5%BC%80/</url>
      
        <content type="html"><![CDATA[<h1 id="81-01-é¢è¯•-å°ç±³-æµ‹å¼€"><a href="#81-01-é¢è¯•-å°ç±³-æµ‹å¼€" class="headerlink" title="81-01 é¢è¯•-å°ç±³-æµ‹å¼€"></a>81-01 é¢è¯•-å°ç±³-æµ‹å¼€</h1><p>2025å¹´03æœˆ05æ—¥ä¸‹åˆ14:00é¢è¯•çš„å°ç±³æµ‹å¼€ï¼Œä¸‹é¢å¯¹è¿™æ¬¡é¢è¯•åšä¸€ä¸ªæ€»ç»“ã€‚</p><p>é¦–å…ˆæ˜¯é¢è¯•å†…å®¹ã€‚</p><h2 id="é¢è¯•å†…å®¹"><a href="#é¢è¯•å†…å®¹" class="headerlink" title="é¢è¯•å†…å®¹"></a>é¢è¯•å†…å®¹</h2><ol><li>é¦–å…ˆæ˜¯è‡ªæˆ‘ä»‹ç»ï¼›</li><li>å¯¹ç¬¬ä¸€æ®µå®ä¹ è¿›è¡Œçš„è¯¢é—®ï¼Œæ¯”å¦‚è¿™æ®µå®ä¹ ä½ åšäº†ä»€ä¹ˆï¼Œä½ æ˜¯æ€ä¹ˆåšçš„ï¼Œä½ åœ¨è¿™æ®µå®ä¹ ä¸­è´Ÿè´£çš„æ˜¯ä»€ä¹ˆï¼›</li><li>å¯¹ç¬¬äºŒæ®µå®ä¹ è¿›è¡Œäº†è¯¢é—®ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯åšä»€ä¹ˆçš„ï¼Œä½ åœ¨è¿™æ®µå®ä¹ ä¸­ä½ è´Ÿè´£äº†ä»€ä¹ˆï¼Œä»¥åŠåšäº†ä»€ä¹ˆï¼›</li><li>æ‰‹å†™äº†ä¸€ä¸ªMySQLæŸ¥è¯¢é¢˜ç›®ï¼›</li><li>æ‰‹å†™äº†ä¸€ä¸ªç®—æ³•é¢˜ï¼ˆæœ€é•¿å­ä¸²æŸ¥è¯¢ï¼‰ï¼Œæ€è·¯æœ‰ï¼Œä½†æ˜¯æ²¡å†™å‡ºæ¥ï¼Œç”¨çš„æ»‘åŠ¨çª—å£è§£å†³ï¼›</li><li>è¯¢é—®äº†ä¸€äº›åŸºç¡€Springå…«è‚¡æ–‡ï¼Œä¾‹å¦‚ï¼ˆIOCï¼ŒAOPï¼‰;</li><li>è¯¢é—®äº†å¯¹æµ‹è¯•çš„å¼€å‘ï¼Œä¸ºä»€ä¹ˆè¦é€‰æ‹©æµ‹è¯•ï¼›</li><li>ä¸ªäººçš„æ€§æ ¼å¦‚ä½•ï¼›</li><li>æœ€é•¿å¯ä»¥å®ä¹ å‡ ä¸ªæœˆï¼Œæœ€çŸ­ä¹Ÿè¦6ä¸ªæœˆä»¥ä¸Šï¼›</li><li>åé—®å“ªé‡Œéœ€è¦åŠ å¼ºï¼›</li></ol><h2 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h2><ol><li>å…³äºè‡ªæˆ‘ä»‹ç»éƒ¨åˆ†ï¼Œè¿‡äºç´§å¼ ï¼Œäº‹å‰å¹¶æ²¡æœ‰å‡†å¤‡å¥½è‡ªæˆ‘ä»‹ç»ï¼Œå¯¼è‡´è‡ªæˆ‘ä»‹ç»è¿‡äºæ··ä¹±ï¼Œè¯­è¨€ç»„ç»‡èƒ½åŠ›å¤ªå·®ï¼›</li><li>å¯¹äºç¬¬ä¸€æ®µå®ä¹ çš„è¯¢é—®ï¼Œå›ç­”çš„é©¬é©¬è™è™ï¼Œäº‹å…ˆå¹¶æ²¡æœ‰æƒ³å¥½è¯¥æ€ä¹ˆå›ç­”ï¼Œå¯¼è‡´æœ‰äº›å›ç­”å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œäº‹ååŠ å¼ºï¼›</li><li>å¯¹äºç¬¬äºŒæ®µå®ä¹ çš„è¯¢é—®åŒä¸Šï¼›</li><li>æ‰‹å†™SQLå¥½ä¹…æ²¡å†™äº†ï¼Œå†æç¤ºçš„æƒ…å†µä¸‹å†™å‡ºæ¥äº†ï¼›</li><li>æ‰‹æ’•ç®—æ³•ï¼Œå…¶æœ¬è´¨åˆ·å°‘äº†ï¼Œå¤šåˆ·å¤šåˆ·å¤šåˆ·ï¼›</li><li>Springå…«è‚¡æ–‡éƒ½æ˜¯ä¸€äº›éå¸¸åŸºç¡€çš„ï¼Œå›ç­”çš„è¿˜è¡Œï¼›å› ä¸ºä¹‹å‰èŠ±äº†å¤§é‡çš„æ—¶é—´åœ¨è¿™å…«è‚¡æ–‡ä¸Šé¢ï¼›</li><li>ä¸ºä»€ä¹ˆé€‰æ‹©æµ‹è¯•ï¼Œå¥½å§å…¶å®æˆ‘å¹¶ä¸æ˜¯å¾ˆæƒ³å»ï¼Œå‚åŠ é¢è¯•çš„ä¸»è¦åŸå› æ˜¯å› ä¸ºæƒ³ç§¯ç´¯ä¸€ä¸‹é¢è¯•ç»éªŒï¼Œè¿˜æ˜¯é¢å°‘äº†ï¼Œä¸€é¢è¯•å°±å®¹æ˜“è„‘å­ç©ºç©ºï¼›</li><li>ä¸ªäººæ€§æ ¼ï¼Œå¥½å§ä¸çŸ¥é“æ€ä¹ˆè¯´â€¦â€¦</li></ol><p>æ€»ä½“æ¥è¯´åŠæ ¼ï¼Œä½†å¾—ä¸åˆ°è‰¯ï¼Œä½œä¸ºç¬¬ä¸€æ¬¡é¢è¯•æ¥è¯´ï¼Œæ•ˆæœå¹¶ä¸å¥½ï¼Œæˆ‘å¹¶ä¸æ»¡æ„ã€‚</p><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ol><li>è¯­è¨€ç»„ç»‡èƒ½åŠ›å¤ªå·®äº†ï¼Œä¸çŸ¥é“è¯¥å¦‚ä½•ç»„ç»‡è¯­è¨€è¡¨è¾¾ï¼Œè„‘å­ç©ºç©ºï¼Œäº‹åæƒ³æƒ³å´çŸ¥é“ï¼Œå½“æ—¶å°±ä¸èƒ½æƒ³èµ·æ¥ï¼Œè¯¥åŠ å¼ºï¼›</li><li>SQLè¯­å¥ä¹¦å†™ï¼Œä¹Ÿå¾—åŠ å¼ºï¼›</li><li>ç®—æ³•é¢˜ï¼Œä¸å¿…å¤šè¯´ï¼Œæ¯å¤©2é¢˜ï¼Œåˆ·å»å§ï¼›</li><li>ä¸ªäººæ€§æ ¼è¿™ç§é—®é¢˜éƒ½èƒ½ä¸çŸ¥é“æ€ä¹ˆè¯´çš„ï¼Œå›å»è‡ªå·±å¥½å¥½æƒ³æƒ³æ€ä¹ˆå›ç­”ï¼Œè‡ªå·±æ˜¯ä¸€ä¸ªæ€ä¹ˆæ ·çš„äººï¼›</li></ol><h2 id="è¯„åˆ†"><a href="#è¯„åˆ†" class="headerlink" title="è¯„åˆ†"></a>è¯„åˆ†</h2><p>6åˆ†ï¼</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> æµ‹å¼€ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
